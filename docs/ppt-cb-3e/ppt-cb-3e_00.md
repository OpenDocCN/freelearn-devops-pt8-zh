# 前言

配置管理已经成为系统管理员的必备技能。掌握如何使用配置管理工具，如 Puppet，使管理员能够充分利用自动化配置系统和云资源。从执行任务、编写脚本到在 Puppet 中创建模块，或将任务 Puppet 化，是一个自然的进阶过程。

本书带你走出基础，深入探索 Puppet 的强大功能，详细展示如何解决各种实际问题和应用。每一步都会清晰地告诉你需要输入的命令，并为每个食谱提供完整的代码示例。它将你从对 Puppet 的初步了解，带入对 Puppet 最新和最先进功能、社区最佳实践、扩展和性能的全面与专家级理解。本书新版包括了配置和使用 Hiera、puppetdb 以及操作集中式 puppetmaster 配置的食谱。

本书还包括来自生产系统的真实示例和一些世界上最大规模 Puppet 安装中使用的技术。它将展示如何使用 Puppet 以不同方式完成任务，并指出这些方法的一些优缺点。

这本书的结构设计使你可以随时从任意章节开始，尝试执行一个食谱，而不需要从头到尾逐一阅读。无论你具备何种水平的 Puppet 经验，这本书都能提供适合你的内容——从简单的工作流技巧到高级的高性能 Puppet 架构。

Puppet 是一个不断变化的工具生态系统。我尽力包括了今天我认为重要的所有工具，例如 r10k。#puppet IRC 频道、puppetlabs 博客（[`puppetlabs.com/blog`](http://puppetlabs.com/blog)）和 Forge（[`forge.puppetlabs.com`](http://forge.puppetlabs.com)）是很好的资源，能帮助你随时了解 Puppet 的变化。

# 本书内容

第一章，*Puppet 语言与风格*，介绍了 Puppet 语言，并展示了如何编写清单。Puppet 的静态检查工具 puppet-lint 也被介绍，我们回顾了编写 Puppet 代码的最佳实践。元参数通过示例进行说明。我们还通过使用未来解析器预览了对 Puppet 语言的拟议更改。

第二章，*Puppet 基础设施*，主要讲解如何在你的环境中部署 Puppet。我们介绍了两种主要的安装方法：集中式和去中心化（无主机模式）。我们展示了如何使用 Git 来集中管理代码，还会配置 puppetdb 和 Hiera。

第三章，*编写更好的清单*，讲述了如何组织你的 Puppet 清单。清单用于构建模块；我们介绍了角色和配置文件的概念，用于抽象模块如何应用到机器上。引入了参数化类。我们还展示了如何使用资源数组和资源默认值高效地定义资源。

第四章，*处理文件和包*，展示了如何使用片段（碎片）管理文件。我们介绍了 Ruby（ERB）和 Puppet（EPP）模板的模板化能力。我们还探讨了如何保护存储在 Puppet 清单中的信息。

第五章，*用户和虚拟资源*，涉及虚拟和导出资源的高级主题。虚拟资源是一种定义资源但默认不应用的方式。导出资源类似，但用于将一台机器上的资源应用到一台或多台其他机器上。

第六章，*资源和文件管理*，讲述了如何处理目录以及清除不受 Puppet 控制的资源。我们展示了如何在不同的机器上应用不同的文件资源。管理`/etc/hosts`中主机条目的方法通过导出的资源示例进行了展示。

第七章，*应用管理*，展示了如何使用 Puppet 管理你部署的应用程序。通过使用公共 Forge 模块，我们配置了 Apache、nginx 和 MySQL。

第八章，*节点间协调*，探讨了导出资源。我们使用导出资源来配置 NFS、haproxy 和 iptables。

第九章，*外部工具与 Puppet 生态系统*，展示了如何通过自定义类型和提供者扩展 Puppet，如何创建自定义事实，以及一些更高级的工具，如 Puppet-librarian 和 r10k。

第十章，*监控、报告与故障排除*，是最后一章，我们展示了如何利用 Puppet 查看基础设施中的问题所在。书中展示了一些常见问题及其解决方案。

# 本书的需求

你需要一台能够运行 Linux 虚拟机的计算机。书中的示例使用基于 Debian 和 Enterprise Linux 的发行版。你还需要一个互联网连接，以便使用 puppetlabs 提供的仓库。

# 本书适合人群

本书假设你已经熟悉 Linux 管理。示例需要一定的命令行使用经验和基本的文本文件编辑技能。虽然有益，但不要求有编码经验。

# 约定

在本书中，你会看到许多不同风格的文本，以区分不同类型的信息。以下是这些风格的示例及其含义的解释。

文本中的代码词汇、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟网址、用户输入和推特账号会按如下方式显示：“你可以使用`+`操作符连接数组，或者用`<<`操作符附加它们。”

代码块如下所示：

```
slice ($firewall_rules,2) |$ip, $port| {firewall {"$port from $ip": dport  => $port, source => "$ip", action => 'accept', }
}
```

任何命令行输入或输出都如下所示：

```
Notice: 1
Notice: 2
Notice: 3
Notice: 4
Notice: 5
# cp /usr/src/asterisk-addons/configs/cdr_mysql.conf.sample
 /etc/asterisk/cdr_mysql.conf

```

**新术语**和**重要词汇**以粗体显示。你在屏幕上看到的、菜单或对话框中的词语会像这样出现在文本中：“在这个图表中，很容易看到**Package['ntp']**是第一个应用的资源，接着是**File['/etc/ntp.conf']**，最后是**Service['ntp']**。”

### 注意

警告或重要说明将以框框显示，如此所示。

### 提示

提示和技巧将如下所示。

# 读者反馈

我们始终欢迎读者的反馈。告诉我们你对本书的看法——你喜欢什么，或者不喜欢什么。读者反馈对我们至关重要，因为它帮助我们开发出你真正受益的书籍。

要向我们发送一般反馈，只需通过电子邮件 `<feedback@packtpub.com>` 联系我们，并在邮件主题中提及书名。

如果你在某个话题上有专长，并且有兴趣撰写或为书籍做出贡献，请参阅我们的作者指南：[www.packtpub.com/authors](http://www.packtpub.com/authors)。

# 客户支持

现在你已经是 Packt 书籍的骄傲拥有者，我们为你提供了许多资源，帮助你最大化从购买中获得的收益。

## 下载示例代码

你可以从你在[`www.packtpub.com`](http://www.packtpub.com)购买的所有 Packt 书籍的账户中下载示例代码文件。如果你是从其他地方购买的这本书，可以访问[`www.packtpub.com/support`](http://www.packtpub.com/support)并注册，将代码文件直接通过电子邮件发送给你。

## 勘误

尽管我们已尽最大努力确保内容的准确性，但错误仍然可能发生。如果你在我们的书籍中发现错误——可能是文本或代码中的错误——我们将非常感激你能向我们报告。通过这样做，你可以帮助其他读者避免沮丧，并帮助我们改进该书的后续版本。如果你发现任何勘误，请访问[`www.packtpub.com/submit-errata`](http://www.packtpub.com/submit-errata)报告错误，选择你的书籍，点击**勘误提交表单**链接，并填写勘误详情。一旦你的勘误被验证，提交将被接受，错误信息将被上传到我们的网站，或添加到该书的勘误部分的现有勘误列表中。

要查看先前提交的勘误表，请访问 [`www.packtpub.com/books/content/support`](https://www.packtpub.com/books/content/support) 并在搜索框中输入书名。所需信息将显示在**勘误表**部分。

## 盗版

互联网上侵犯版权材料的盗版问题在所有媒体上持续存在。在 Packt，我们非常重视保护我们的版权和许可证。如果您在互联网上发现我们任何形式的作品的非法副本，请立即向我们提供位置地址或网站名称，以便我们采取措施。

如果您发现了涉嫌盗版材料，请通过 `<copyright@packtpub.com>` 提供链接。

我们感谢您帮助保护我们的作者以及为您带来有价值的内容的能力。

## 问题

如果您在书的任何方面遇到问题，请通过 `<questions@packtpub.com>` 联系我们，我们将尽力解决。
