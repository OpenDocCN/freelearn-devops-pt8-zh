# 前言

写一本技术书有很多错误的方式。一种方式是简单地重复官方文档。另一种是通过一个庞大复杂的例子来引导读者，而这个例子不一定有实际用途，只是展示作者有多聪明。还有一种方式是详尽无遗地列出技术的所有可用功能，以及你可能使用它们的所有方法，却没有足够的指导告诉你哪些功能是真正会用到的，或者哪些功能最好避免。

和你一样，我在工作中读了很多技术书籍。我不需要文档的转述：我可以在线阅读。我也不想看到大量的代码示例，尤其是一些我不需要做的事情。当然，我也不希望看到对每一个功能的无批判的叙述。

我希望的是，作者能够给我一个简明易懂的工具工作原理的解释，详细到让我能够立即开始使用它，但又不至于信息过载。我希望按我可能会使用它们的顺序来学习功能，并且希望能从第一章就开始构建一个能够运行并带来业务价值的东西。

这就是你从本书中可以期待的内容。无论你是开发人员、系统管理员，还是只是对 Puppet 感兴趣，你都会学习到可以立刻应用的 Puppet 技能。没有过多的理论或背景细节，我将向你展示如何安装软件包和配置文件、创建用户、设置定时任务、配置云实例、构建容器等等。每个例子都涉及到你工作中可能需要的真实、实际的内容，你将看到实现它的完整 Puppet 代码，连同每一步的操作说明和你会看到的输出。所有的例子都可以在 GitHub 仓库中下载并进行调整。

每个练习后，我都会详细解释每一行代码的作用和工作原理，帮助你将其调整到你自己的需求中，并让你确信自己理解了每一个细节。到本书结束时，你将具备使用 Puppet 进行实际、有效、日常工作的所有技能，并且你将获得一个完整的示范 Puppet 仓库，可以用最少的努力将你的基础设施搭建起来。

那么，让我们开始吧。

# 本书内容概述

第一章，*开始使用 Puppet*，介绍了 Puppet 并让你快速启动本书附带的 Vagrant 虚拟机。

第二章，*创建你的第一个 manifest*，展示了 Puppet 是如何工作的，以及如何编写代码来管理软件包、文件和服务。

第三章，*使用 Git 管理 Puppet 代码*，介绍了 Git 版本控制工具，展示了如何创建一个代码仓库以存储你的代码，并将其分发到 Puppet 管理的节点。

第四章，*理解 Puppet 资源*，详细讲解了`package`、`file`和`service`资源，并介绍了如何管理用户、SSH 密钥、计划任务和命令的资源。

第五章，*变量、表达式和事实*，介绍了 Puppet 的变量、数据类型、表达式和条件语句，展示了如何使用 Facter 获取节点的数据，以及如何创建你自己的自定义事实。

第六章，*使用 Hiera 管理数据*，解释了 Puppet 的键值数据库，如何使用它来存储和检索数据，包括密钥，并展示了如何根据 Hiera 数据创建 Puppet 资源。

第七章，*掌握模块*，教你如何使用`r10k`工具从 Puppet Forge 安装现成的模块，介绍了四个关键模块，包括标准库，并展示了如何构建你自己的模块。

第八章，*类、角色和配置文件*，介绍了类和定义的资源类型，并展示了使用角色和配置文件来组织 Puppet 代码的最佳方式。

第九章，*使用模板管理文件*，展示了如何利用 Puppet 的 EPP 模板机制构建带有动态数据的复杂配置文件。

第十章，*控制容器*，介绍了 Puppet 对 Docker 容器的新强大支持，并展示了如何使用 Puppet 资源下载、构建和运行容器。

第十一章，*编排云资源*，解释了如何使用 Puppet 在 Amazon AWS 上配置云服务器，并介绍了一个基于 Hiera 数据的完全自动化云基础设施。

第十二章，*综合应用*，带你完成一个完整的 Puppet 基础设施示例，你可以下载并修改以适应你自己的项目，运用前面章节中的所有概念。

# 本书所需内容

你需要一台相对现代的计算机系统和互联网连接。你不需要成为 Unix 专家或经验丰富的系统管理员；我假设你能够安装软件、运行命令和编辑文件，但其他内容我会在接下来的部分逐步解释。

# 本书适合的人群

本书的主要读者群体是那些刚接触 Puppet 的人，包括系统管理员和开发人员，他们希望管理计算机服务器系统以进行配置管理。不要求具有编程或系统管理经验。然而，如果您以前使用过 Puppet，本书将为您提供最新特性和模块的全面介绍，希望您仍能学到许多新知识。

# 规范

本书中包含多种文本样式，用于区分不同类型的信息。以下是这些样式的示例及其含义解释。

文本中的代码词汇、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 用户名将以如下方式显示：“Puppet 可以使用 `file` 资源在节点上管理文件。”

代码块如下所示：

```
file { '/tmp/hello.txt':
  ensure  => file,
  content => "hello, world\n",
}
```

当我们希望您关注代码块的特定部分时，相关行或项目会以粗体显示：

```
file { '/tmp/hello.txt':
 ensure  => file,
  content => "hello, world\n",
}
```

任何命令行输入或输出均按如下方式书写：

```
sudo puppet apply /vagrant/examples/file_hello.pp
Notice: Compiled catalog for ubuntu-xenial in environment production in 0.07 seconds
```

**新术语**和**重要词汇**以粗体显示。您在屏幕上看到的词汇，比如菜单或对话框中的词汇，将以这种方式显示：“在 AWS 控制台中，从**服务**菜单中选择**VPC**。”

### 注意

警告或重要提示会以类似这样的框框形式显示。

### 提示

提示和技巧如下所示。

# 读者反馈

我们始终欢迎读者的反馈。请告诉我们您对这本书的看法——喜欢或不喜欢的地方。读者的反馈对我们非常重要，因为它帮助我们开发出您真正能够从中受益的书籍。

要向我们发送一般反馈，请通过电子邮件 `<feedback@packtpub.com>`，并在邮件主题中注明书名。

如果您在某个领域有专业知识，并且有兴趣为本书撰写或贡献内容，请参见我们的作者指南：[www.packtpub.com/authors](http://www.packtpub.com/authors)。

# 客户支持

既然您已成为 Packt 书籍的骄傲拥有者，我们有许多方法帮助您充分利用您的购买。

## 下载示例代码

您可以从您的账户中下载本书的示例代码文件：[`www.packtpub.com`](http://www.packtpub.com)。如果您从其他地方购买此书，您可以访问[`www.packtpub.com/support`](http://www.packtpub.com/support)并注册以将文件直接发送到您的电子邮件。

您可以按照以下步骤下载代码文件：

1.  使用您的电子邮件地址和密码登录或注册我们的官方网站。

1.  将鼠标悬停在顶部的**支持**选项卡上。

1.  点击**代码下载与勘误表**。

1.  在**搜索**框中输入书名。

1.  选择您要下载代码文件的书籍。

1.  从下拉菜单中选择您购买此书的渠道。

1.  点击**代码下载**。

您还可以通过点击书籍网页上的**代码文件**按钮下载代码文件，该网页可以通过在**搜索框**中输入书籍名称访问。请注意，您需要登录您的 Packt 账户。

下载文件后，请确保使用最新版本的工具解压或提取文件夹：

+   WinRAR / 7-Zip for Windows

+   Zipeg / iZip / UnRarX for Mac

+   7-Zip / PeaZip for Linux

本书的代码包也托管在 GitHub 上，网址如下：

+   [`github.com/bitfield/puppet-beginners-guide-3.git`](https://github.com/bitfield/puppet-beginners-guide-3.git)

+   [`github.com/bitfield/pbg_ntp.git`](https://github.com/bitfield/pbg_ntp.git)

+   [`github.com/bitfield/control-repo-3.git`](https://github.com/bitfield/control-repo-3.git)

您还可以使用 GitHub 上 Packt Publishing 仓库中的代码包：

[`github.com/PacktPublishing/Puppet-5-Beginners-Guide-Third-Edition`](https://github.com/PacktPublishing/Puppet-5-Beginners-Guide-Third-Edition)

我们还在 [`github.com/PacktPublishing/`](https://github.com/PacktPublishing/) 提供了来自我们丰富图书和视频目录的其他代码包。快去看看吧！

## 勘误表

尽管我们已尽力确保内容的准确性，但错误仍然可能发生。如果您在我们的书籍中发现错误——无论是文本还是代码中的错误——我们非常感激您能向我们报告。通过这样做，您可以帮助其他读者避免困扰，并帮助我们改进后续版本。如果您发现任何勘误，请通过访问 [`www.packtpub.com/submit-errata`](http://www.packtpub.com/submit-errata) 来提交，选择您的书籍，点击**勘误提交表单**链接，并输入错误详情。一旦您的勘误得到验证，您的提交将被接受，错误将上传到我们的网站或添加到该书的勘误部分的现有错误列表中。

要查看之前提交的勘误，请访问 [`www.packtpub.com/books/content/support`](https://www.packtpub.com/books/content/support) 并在搜索框中输入书名。所需信息将出现在**勘误**部分。

## 盗版

互联网上的版权材料盗版问题在各类媒体中普遍存在。在 Packt，我们非常重视版权和许可的保护。如果您在互联网上发现我们作品的任何非法副本，请立即提供该位置地址或网站名称，以便我们采取措施。

如有疑问，请通过`<copyright@packtpub.com>`联系我们，并提供涉嫌盗版内容的链接。

感谢您帮助我们保护作者和我们提供宝贵内容的能力。

## 问题

如果你对本书的任何部分有问题，可以通过`<questions@packtpub.com>`联系我们，我们将尽力解决问题。
