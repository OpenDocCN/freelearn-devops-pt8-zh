- en: Chapter 9. Automation and Authentication – Service Management Automation and
    ADFS
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第9章 自动化与认证 - 服务管理自动化和 ADFS
- en: In this chapter, we will be focusing on automating our Windows Azure Pack-based
    cloud solution. You will learn the installation and configuration of **SMA** (**Service
    Management Automation**). You will also learn to create, author, and manage runbooks
    and assets.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将专注于自动化基于 Windows Azure Pack 的云解决方案。你将学习 **SMA**（**服务管理自动化**）的安装与配置。同时，你还将学习如何创建、编写和管理运行书和资产。
- en: 'Along with automation, you will also learn about the authentication, which
    is using ADFS to authenticate for both management and tenant portal. The following
    topics are covered in this chapter:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 除了自动化，你还将学习认证相关内容，包括使用 ADFS 进行管理和租户门户的认证。本章涵盖以下主题：
- en: SMA – overview and architecture
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SMA - 概述和架构
- en: Planning the SMA infrastructure
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 规划 SMA 基础设施
- en: Installing and configuring SMA
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装与配置 SMA
- en: Dealing with SMA assets
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 处理 SMA 资产
- en: Dealing with SMA runbooks
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 处理 SMA 运行书
- en: Enabling ADFS authentication for WAP portals
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为 WAP 门户启用 ADFS 认证
- en: SMA – overview and architecture
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: SMA - 概述和架构
- en: SMA, a part of the system center product family, adds automation capabilities
    to the Windows Azure Pack cloud. SMA enables a cloud provider to automate provisioning,
    monitoring, and managing all resources in a WAP cloud.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: SMA 作为 System Center 产品系列的一部分，为 Windows Azure Pack 云添加了自动化能力。SMA 使得云服务提供商能够自动化
    WAP 云中的所有资源的预配、监控和管理。
- en: 'Let''s take an example. In a large-scale cloud provider scenario, tenants create
    and delete virtual machines in real time on a large scale, that is, hundreds of
    operations everyday. This cloud provider provides multiple capabilities and features
    on VMs hosted on the cloud as a value added to it; such capabilities include the
    following:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们举个例子。在大规模云服务提供商的场景中，租户实时大规模地创建和删除虚拟机，也就是每天有数百个操作。该云服务提供商在云中托管的虚拟机上提供了多个功能和特性，作为其增值服务，这些功能包括：
- en: Backup and disaster recovery
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 备份和灾难恢复
- en: Real-time monitoring
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 实时监控
- en: Antivirus and anti-malware protection
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 防病毒和反恶意软件保护
- en: Automatic point in time state snapshots
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 自动时间点状态快照
- en: Each VM provisioned by tenants needs to be configured in respective tools to
    enable the previous capabilities. And after each deletion of VMs by tenants, their
    respective configuration needs to be removed from backup, monitoring, and so on.
    Assume achieving this in a cloud having hundreds or more VM provisioning operations
    daily using traditional methods.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 租户配置的每个虚拟机都需要在各自的工具中进行配置，以启用前述功能。在租户删除每个虚拟机后，其相应的配置也需要从备份、监控等中移除。假设在云环境中，通过传统方法实现这一点，每天有数百个或更多的虚拟机配置操作。
- en: SMA can drastically simplify and automate these operations. Service providers
    can create SMA runbooks for the provisioning and removal of configurations. Runbooks
    can then be linked with VM create and delete operations which will automatically
    initiate execution of respective runbooks with specific VM parameters.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: SMA 可以大大简化并自动化这些操作。服务提供商可以创建 SMA 运行书，用于虚拟机配置的预配和删除。运行书可以与虚拟机的创建和删除操作关联，这样便会自动启动执行具有特定虚拟机参数的相应运行书。
- en: An overview of SMA
  id: totrans-18
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: SMA 概述
- en: SMA was introduced with the System Center 2012 R2 product family and is included
    in the System Center Orchestrator installation media. It can be used as a standalone
    product as well as along with Windows Azure Pack.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: SMA 是随着 System Center 2012 R2 产品系列推出的，并且包含在 System Center Orchestrator 安装介质中。它可以作为独立产品使用，也可以与
    Windows Azure Pack 一起使用。
- en: SMA provides the automation engine for Microsoft's on-premises cloud infrastructure.
    It relies on Windows PowerShell workflows; that is, almost any tasks that can
    be performed via Windows PowerShell can be automated using SMA.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: SMA 提供了微软本地云基础设施的自动化引擎。它依赖于 Windows PowerShell 工作流，也就是说，几乎任何可以通过 Windows PowerShell
    执行的任务，都可以通过 SMA 进行自动化。
- en: 'PowerShell workflows were introduced with the release of Windows PowerShell
    3.0, and they contain traditional PowerShell cmdlets to execute tasks. Runbooks
    in SMA are authored in PowerShell workflows adding the following capabilities
    of PowerShell workflows:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: PowerShell 工作流是在 Windows PowerShell 3.0 发布时引入的，包含传统的 PowerShell cmdlet 来执行任务。SMA
    中的运行书使用 PowerShell 工作流进行编写，加入了 PowerShell 工作流的以下功能：
- en: Checkpoint or suspend a workflow that is a runbook
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 检查点或挂起一个运行书的工作流
- en: The parallel execution of PowerShell tasks on multiple systems
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在多个系统上并行执行 PowerShell 任务
- en: Natively, SMA does not provide any GUI to create, manage, or execute runbooks.
    Unlike System Center Orchestrator, all runbooks in SMA must be written in PowerShell
    workflows manually.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 本地的 SMA 不提供任何图形界面来创建、管理或执行运行手册。与 System Center Orchestrator 不同，所有 SMA 运行手册必须手动用
    PowerShell 工作流编写。
- en: The Windows Azure Pack administrator portal integrates well with SMA and provides
    GUI for scheduling, executing, and performing other management operations on runbooks.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: Windows Azure Pack 管理员门户与 SMA 集成良好，提供图形界面用于调度、执行以及执行其他管理操作。
- en: It must be noted that SMA functionality isn't available for tenants to create
    and manage their own runbooks.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 必须注意的是，SMA 功能不适用于租户创建和管理自己的运行手册。
- en: Note
  id: totrans-27
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Microsoft Azure automation works on the same architecture as SMA and provides
    similar automation capabilities for customers using Microsoft Azure for hosting
    their IT resources.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: Microsoft Azure 自动化使用与 SMA 相同的架构，并为使用 Microsoft Azure 托管其 IT 资源的客户提供类似的自动化功能。
- en: The architecture of SMA
  id: totrans-29
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: SMA 架构
- en: 'Similar to all other WAP cloud components, SMA is distributed across multiple
    components and provides the flexible architecture to achieve performance and eliminate
    a single point of failure. SMA involves the following components to function:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 与所有其他 WAP 云组件类似，SMA 分布于多个组件之间，提供灵活的架构以提高性能并消除单点故障。SMA 包括以下组件来实现其功能：
- en: The SMA web service
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SMA Web 服务
- en: The SMA runbook worker
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SMA 运行手册工作者
- en: The database server
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据库服务器
- en: The SMA PowerShell module (optional)
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SMA PowerShell 模块（可选）
- en: '**The SMA web service**: The web service is the interface to SMA for all other
    administrative mediums. Windows Azure Pack uses the SMA web service to communicate
    with SMA and for other SMA tasks, such as executing a runbook or getting the status
    of a runbook.'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: '**SMA Web 服务**：Web 服务是所有其他管理媒介与 SMA 之间的接口。Windows Azure Pack 使用 SMA Web 服务与
    SMA 通信，并执行其他 SMA 任务，例如执行运行手册或获取运行手册的状态。'
- en: It exposes a REST endpoint and OData API, which can be leveraged by WAP or any
    other custom developed portal for integration with SMA.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 它暴露了一个 REST 端点和 OData API，可以被 WAP 或任何其他自定义开发的门户用来与 SMA 集成。
- en: It is also responsible for authorization and distribution of runbook execution
    tasks to worker roles.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 它还负责授权和分发运行手册执行任务到工作者角色。
- en: '**The SMA runbook worker**: SMA runbooks'' jobs are executed or processed by
    worker servers. A runbook worker server executes multiple runbooks in isolated
    environments, which are also known as sandboxes. This ensures that activities
    performed by one runbook don''t affect the other runbook that is being executed
    by the same worker server.'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: '**SMA 运行手册工作者**：SMA 运行手册的任务由工作者服务器执行或处理。一个运行手册工作者服务器在隔离环境中执行多个运行手册，这些环境也被称为沙箱。这确保了一个运行手册执行的活动不会影响同一工作者服务器上执行的其他运行手册。'
- en: '**The SMA database**: SMA leverages the Microsoft SQL server database to store
    its configuration and runtime data. SMA database stores SMA runbooks, jobs, and
    other SMA-related objects'' configurations and runtime data.'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: '**SMA 数据库**：SMA 利用 Microsoft SQL Server 数据库来存储其配置和运行时数据。SMA 数据库存储了 SMA 运行手册、任务及其他与
    SMA 相关的对象的配置和运行时数据。'
- en: '**The SMA PowerShell module**: This can be used to automate the automation;
    that is, it provides 40+ PowerShell cmdlet, which can be used by admins to automate
    the process of executing and managing runbooks. The PowerShell module also interacts
    with the SMA web service to perform SMA operations. This can be installed on the
    administrator''s endpoint and can be used as an alternative to the WAP portal
    for SMA operations.'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: '**SMA PowerShell 模块**：可以用来自动化自动化；即它提供了40多个PowerShell cmdlet，管理员可以使用它们来自动化执行和管理运行手册的过程。PowerShell
    模块还与 SMA Web 服务交互，以执行 SMA 操作。该模块可以安装在管理员的端点上，并可作为 SMA 操作的 WAP 门户的替代方案。'
- en: 'The following diagram illustrates the role and flow of SMA components with
    Windows Azure Pack:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 下图展示了 SMA 组件在 Windows Azure Pack 中的角色和流程：
- en: '![The architecture of SMA](img/00246.jpeg)'
  id: totrans-42
  prefs: []
  type: TYPE_IMG
  zh: '![SMA 架构](img/00246.jpeg)'
- en: Planning the SMA infrastructure
  id: totrans-43
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: SMA 基础设施规划
- en: 'SMA works on the distributed architecture to allow an easy and non-disruptive
    scale in and out of the operations. The following aspects must be taken into consideration
    while planning the infrastructure for SMA deployment:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: SMA 基于分布式架构运行，允许操作以简便且不中断的方式进行横向扩展和收缩。在规划 SMA 部署的基础设施时，必须考虑以下几个方面：
- en: Planning for availability
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可用性规划
- en: Planning for performance/capacity
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 性能/容量规划
- en: Planning for availability
  id: totrans-47
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 可用性规划
- en: 'All the components of the SMA solution can be protected against a single point
    of failure by adding redundant servers. The following guidelines include the recommended
    configuration with respect to the availability of each role:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 通过添加冗余服务器，SMA解决方案的所有组件都可以抵御单点故障。以下指南包括每个角色的可用性方面的推荐配置：
- en: '**The SMA web service role**: This is recommended to deploy multiple web service
    roles (the minimum recommendation is two for high availability) and configure
    with a load balancer. Any administrative endpoint such as the WAP portal must
    point to the load balancer to communicate with the SMA web service.'
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**SMA Web服务角色**：建议部署多个Web服务角色（最低推荐部署两个以确保高可用性），并配置负载均衡器。任何管理端点，如WAP门户，都必须指向负载均衡器，以便与SMA
    Web服务进行通信。'
- en: '**The SMA worker role**: It is recommended to deploy multiple SMA worker roles
    (the minimum recommendation is two for high availability) to avoid any single
    point of failure. The SMA web service automatically distributes job tasks to different
    workers ensuring load balancing.'
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**SMA工作角色**：建议部署多个SMA工作角色（最低推荐部署两个以确保高可用性），以避免单点故障。SMA Web服务会自动将作业任务分配到不同的工作节点，以确保负载均衡。'
- en: '**The SMA database**: It is recommended to protect SMA SQL database against
    any single point of failure using SQL availability techniques. SMA database is
    supported to run on the following:'
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**SMA数据库**：建议使用SQL可用性技术来保护SMA SQL数据库，防止任何单点故障。SMA数据库支持在以下环境中运行：'
- en: Standalone SQL server
  id: totrans-52
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 独立SQL服务器
- en: SQL server cluster
  id: totrans-53
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: SQL服务器集群
- en: SQL Always on
  id: totrans-54
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: SQL Always on
- en: '**Virtual machines for SMA servers**: Using virtual machines or hosting SMA
    servers adds another layer of protection against any hardware failure.'
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**SMA服务器的虚拟机**：使用虚拟机或托管SMA服务器可以为硬件故障提供另一层保护。'
- en: Planning for performance and capacity
  id: totrans-56
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 性能和容量规划
- en: 'The following factors should be taken into consideration while planning the
    SMA infrastructure sizing:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 在规划SMA基础设施的大小时，以下因素应考虑在内：
- en: The number of runbooks
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 运行手册的数量
- en: The size of runbooks (activities, variables, connections, and so on)
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 运行手册的大小（活动、变量、连接等）
- en: The average run time of runbooks
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 运行手册的平均运行时间
- en: Remote calls being executed
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 执行的远程调用
- en: 'There is no direct formula to calculate the sizing based on the previous factors.
    The following guidelines can be helpful in sizing SMA servers:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 根据前述因素，无法通过直接公式来计算大小。以下指南有助于为SMA服务器确定大小：
- en: '**The SMA web service**: SMA web service is stateless; that is, it can be scaled
    in and out easily with increased compute and additional servers along with a load
    balancer. Web services are responsible for communicating with administrative consoles,
    such as WAP, and worker roles to assign runbook jobs. High resource utilization
    and requirements are unlikely for the SMA web service unless a large number of
    users start initiating the SMA execution process simultaneously. Two CPU cores
    and 4 GB of RAM (minimum), 8 GB (recommended) are good compute configurations
    to start with.'
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**SMA Web服务**：SMA Web服务是无状态的；也就是说，它可以随着计算资源的增加和附加服务器的增加，轻松进行扩展和缩放，并通过负载均衡器进行配置。Web服务负责与管理控制台（如WAP）以及工作角色进行通信，以分配运行手册作业。除非大量用户同时启动SMA执行过程，否则SMA
    Web服务对资源的需求较低。启动时，建议的计算配置是两核CPU和4 GB RAM（最低配置），推荐8 GB。'
- en: '**The SMA worker**: SMA worker hosts a sandbox to execute runbook jobs that
    aren''t stateless as web services. Each sandbox can handle 30 concurrent jobs,
    and a worker can host a maximum of four sandboxes by default. This comes as 120
    concurrent jobs per worker server. The standard SMA server''s hardware recommends
    two CPU cores and 4 GB of RAM (minimum), but 8 GB is recommended. This can likely
    handle these efficiently. Worker roles can then be scaled out as per usage and
    requirement.'
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**SMA工作节点**：SMA工作节点托管沙箱来执行非无状态的运行手册作业。每个沙箱可以处理30个并发作业，默认情况下，一个工作节点最多可以托管四个沙箱。这意味着每个工作节点可以处理120个并发作业。标准SMA服务器的硬件建议配置为两核CPU和4
    GB RAM（最低配置），但推荐8 GB。这样的配置可以高效处理这些工作。根据使用和需求，工作角色可以进行横向扩展。'
- en: '**The SMA database**: There can only be one database as per the SMA deployment;
    hence, it is recommended to use a dedicated instance for the SMA database in the
    production environment, ensuring that it gets the required compute resources.
    Microsoft recommends using SQL servers for SMA databases with a minimum 8 GB of
    RAM and 8 cores in terms of compute. For storage as per Microsoft guidelines,
    1 month of data with 12 jobs per minute requires 20 GB of disk space. Along with
    this, it is recommended to follow standard Microsoft SQL Server performance and
    capacity guidelines. See [https://technet.microsoft.com/en-us/sqlserver/bb671430.aspx](https://technet.microsoft.com/en-us/sqlserver/bb671430.aspx)
    to learn about SQL server best practices.'
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**SMA 数据库**：每个 SMA 部署只能有一个数据库；因此，建议在生产环境中使用专用实例来承载 SMA 数据库，确保它获得所需的计算资源。微软建议使用具有最低
    8 GB RAM 和 8 核心计算能力的 SQL 服务器来承载 SMA 数据库。在存储方面，根据微软指南，12 个作业每分钟的数据量需要 20 GB 的磁盘空间。并且建议遵循标准的微软
    SQL Server 性能和容量指南。有关 SQL Server 最佳实践，请参阅 [https://technet.microsoft.com/en-us/sqlserver/bb671430.aspx](https://technet.microsoft.com/en-us/sqlserver/bb671430.aspx)。'
- en: Installing and configuring SMA
  id: totrans-66
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装和配置 SMA
- en: SMA installation binaries are located inside System Center Orchestrator Media
    and follows similar installation instructions as per other system center products.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: SMA 安装程序位于 System Center Orchestrator 媒体中，遵循与其他 System Center 产品类似的安装说明。
- en: SMA installation prerequisites
  id: totrans-68
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: SMA 安装前提条件
- en: 'The SMA installation prerequisites can be divided in three categories:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: SMA 安装前提条件可以分为三类：
- en: Software components prerequisites
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 软件组件前提条件
- en: AD accounts prerequisites
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: AD 账户前提条件
- en: SSL certificate prerequisites
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SSL 证书前提条件
- en: Windows Server 2012 R2 is the minimum OS version supported for SMA installation.
    Apart from this, the following software components must be installed before starting
    the SMA installation as SMA installer doesn't automatically install prerequisite
    components.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: Windows Server 2012 R2 是 SMA 安装的最低操作系统版本。除此之外，必须在开始安装 SMA 之前安装以下软件组件，因为 SMA
    安装程序不会自动安装前提组件。
- en: 'Software prerequisite for installing the SMA web service are as follows:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 安装 SMA Web 服务的软硬件前提条件如下：
- en: '**Internet Information Services** (**IIS**) 7.5 or higher'
  id: totrans-75
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**互联网信息服务**（**IIS**）7.5 或更高版本'
- en: IIS basic authentication
  id: totrans-76
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: IIS 基本身份验证
- en: IIS Windows authentication
  id: totrans-77
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: IIS Windows 身份验证
- en: IIS URL authorization
  id: totrans-78
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: IIS URL 授权
- en: ASP.NET 4.5
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ASP.NET 4.5
- en: .NET Framework 3.5 (for the setup program)
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: .NET Framework 3.5（用于安装程序）
- en: .NET Framework 4.5
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: .NET Framework 4.5
- en: WCF HTTP activation
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: WCF HTTP 激活
- en: SQL Server 2012 DB connectivity
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SQL Server 2012 数据库连接
- en: Note
  id: totrans-84
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: To install .NET 3.5 on Windows Server 2012/R2 using Server Manager's **Add Feature**
    wizard, alternate source locations must be specified during the installation,
    and it needs to be pointed to the `sxs` folder under sources in the Windows installation
    media.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 要在 Windows Server 2012/R2 上使用服务器管理器的 **添加功能** 向导安装 .NET 3.5，必须在安装过程中指定备用源位置，并指向
    Windows 安装介质中的 `sxs` 文件夹。
- en: 'Software prerequisites to install the SMA worker role—Windows PowerShell 4.0
    (this is included by default with Windows Server 2012 R2):'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 安装 SMA 工作者角色的软硬件前提条件——Windows PowerShell 4.0（Windows Server 2012 R2 默认包含此版本）：
- en: '**Active Directory Accounts**: It is recommended to create separate dedicated
    accounts and groups for running following services in SMA deployment. The following
    table lists the accounts required for deploying SMA components:'
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**活动目录账户**：建议为运行以下服务创建独立的专用账户和组。下表列出了部署 SMA 组件所需的账户：'
- en: '| Sample account/group name | Account usage | Remarks |'
  id: totrans-88
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| 示例账户/组名称 | 账户用途 | 备注 |'
- en: '| --- | --- | --- |'
  id: totrans-89
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| SMA pool | SMA Application Pool Admin Group | A member of Local Administrators
    |'
  id: totrans-90
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| SMA pool | SMA 应用程序池管理员组 | 本地管理员组成员 |'
- en: '| SMA poolsvc | SMA Pool Web Service Account | A member of Local Administrators
    |'
  id: totrans-91
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| SMA poolsvc | SMA 池 Web 服务账户 | 本地管理员组成员 |'
- en: '| SMA workersvc | SMA Worker Service Account | A member of Local Administrators
    |'
  id: totrans-92
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| SMA workersvc | SMA 工作者服务账户 | 本地管理员组成员 |'
- en: '**SSL certificate**: It is recommended to use an internal CA issued SSL certificate
    for the SMA web service instead of the automatically generated self-signed certificate.
    This certificate must be trusted by the SPF server.'
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**SSL 证书**：建议使用由内部 CA 颁发的 SSL 证书而不是自动生成的自签名证书来安装 SMA Web 服务。此证书必须被 SPF 服务器信任。'
- en: Installing the SMA web service, runbook worker, and PowerShell module
  id: totrans-94
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安装 SMA Web 服务、Runbook 工作者和 PowerShell 模块
- en: 'For the purpose of evaluation in this book, we will be installing all three
    components on a single server. The following steps are required to install the
    SMA web service:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 为了本书中的评估目的，我们将在单台服务器上安装这三个组件。以下步骤用于安装 SMA Web 服务：
- en: Log into the server designated for installing the SMA web service.
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到指定安装 SMA Web 服务的服务器。
- en: Start `SetupOrchestrator.exe` from System Center Orchestrator Media.
  id: totrans-97
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从 System Center Orchestrator 媒体启动`SetupOrchestrator.exe`。
- en: Click on **Web Service** on the **Install** page under **Service Management**.![Installing
    the SMA web service, runbook worker, and PowerShell module](img/00247.jpeg)
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**服务管理**的**安装**页面上，点击**Web 服务**。![安装 SMA Web 服务、运行簿工作者和 PowerShell 模块](img/00247.jpeg)
- en: Click on **Install** to proceed.![Installing the SMA web service, runbook worker,
    and PowerShell module](img/00248.jpeg)
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**安装**以继续。![安装 SMA Web 服务、运行簿工作者和 PowerShell 模块](img/00248.jpeg)
- en: Enter the **Name** and **Organization** names along with the registration key
    if any. The setup will get installed in the evaluation mode if no registration
    key is provided at this stage:![Installing the SMA web service, runbook worker,
    and PowerShell module](img/00249.jpeg)
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入**名称**和**组织**名称，并提供注册密钥（如果有）。如果此时没有提供注册密钥，安装将以评估模式进行：![安装 SMA Web 服务、运行簿工作者和
    PowerShell 模块](img/00249.jpeg)
- en: Agree to the terms and condition to proceed further.
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 同意条款和条件以继续。
- en: The setup will start its prerequisite check and will display any error or warning
    as applicable. Proceed further if all the prerequisites are met:![Installing the
    SMA web service, runbook worker, and PowerShell module](img/00250.jpeg)
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装程序将开始检查先决条件，并显示任何适用的错误或警告。如果所有先决条件都满足，则可以继续：![安装 SMA Web 服务、运行簿工作者和 PowerShell
    模块](img/00250.jpeg)
- en: Enter the database server connection information including the server name,
    port, database name, and credentials. Both Windows and SQL authentication can
    be used:![Installing the SMA web service, runbook worker, and PowerShell module](img/00251.jpeg)
  id: totrans-103
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入数据库服务器连接信息，包括服务器名称、端口、数据库名称和凭据。可以使用 Windows 身份验证和 SQL 身份验证：![安装 SMA Web 服务、运行簿工作者和
    PowerShell 模块](img/00251.jpeg)
- en: Specify security groups or users and credentials to run the web service application
    pool:![Installing the SMA web service, runbook worker, and PowerShell module](img/00252.jpeg)
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 指定安全组或用户及凭据以运行 Web 服务应用程序池：![安装 SMA Web 服务、运行簿工作者和 PowerShell 模块](img/00252.jpeg)
- en: Specify the web service port and SSL certificate to use. The setup can also
    generate a self-signed certificate to use in test environments:![Installing the
    SMA web service, runbook worker, and PowerShell module](img/00253.jpeg)
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 指定 Web 服务端口和 SSL 证书。安装程序还可以生成自签名证书用于测试环境：![安装 SMA Web 服务、运行簿工作者和 PowerShell
    模块](img/00253.jpeg)
- en: Specify a location to store web service files.
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 指定存储 Web 服务文件的位置。
- en: Specify choices for **CEIP** (**Customer Experience Improvement Program**) and
    Microsoft update.
  id: totrans-107
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 指定**CEIP**（**客户体验改进计划**）和 Microsoft 更新的选项。
- en: Review the settings and click on **Install** to start the installation.
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 审查设置后，点击**安装**以开始安装。
- en: Click **Close** on the successful completion; the SMA web service is now installed.
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装成功后，点击**关闭**；SMA Web 服务现已安装。
- en: Installing web worker roles
  id: totrans-110
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安装 Web 工作器角色
- en: 'The following steps are required to install the SMA worker role:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 安装 SMA 工作器角色所需的步骤如下：
- en: Log into the server designated to install the SMA worker.
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到指定安装 SMA 工作器的服务器。
- en: Start `SetupOrchestrator.Exe` from System Center Orchestrator Media.
  id: totrans-113
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从 System Center Orchestrator 媒体启动`SetupOrchestrator.Exe`。
- en: Click on **Runbook Worker** on the **Install** page under Service Management.
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**服务管理**的**安装**页面上，点击**运行簿工作者**。
- en: Enter the **Name** and **Organization** name along with the registration key
    if any. The setup will get installed in the evaluation mode if no registration
    key is provided at this stage.
  id: totrans-115
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入**名称**和**组织**名称，并提供注册密钥（如果有）。如果此时没有提供注册密钥，安装将以评估模式进行。
- en: Agree to the terms and condition to proceed further.
  id: totrans-116
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 同意条款和条件以继续。
- en: The setup will start its prerequisite checks and will display any error or warning
    as applicable. Proceed further if all the prerequisites are met.
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装程序将开始检查先决条件，并显示任何适用的错误或警告。如果所有先决条件都满足，则可以继续。
- en: Enter the database server connection information including the server name,
    port, the database name, and credentials. Both Windows and SQL authentication
    can be used.
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入数据库服务器连接信息，包括服务器名称、端口、数据库名称和凭据。可以使用 Windows 身份验证和 SQL 身份验证。
- en: Specify the service account for running the SMA worker service:![Installing
    web worker roles](img/00254.jpeg)
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 指定用于运行SMA工作服务的服务帐户：![安装Web工作角色](img/00254.jpeg)
- en: Specify a location to store worker files.
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 指定存储工人文件的位置。
- en: Specify choices for CEIP.
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 指定CEIP的选择。
- en: Review the setting and click on **Install** to start the installation.
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 审查设置并点击**安装**以开始安装。
- en: Click on **close** upon successful completion. The SMA runbook worker is now
    installed.
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**关闭**以完成操作。SMA运行书工作者已安装完毕。
- en: The SMA PowerShell module can be installed in a similar manner on administrative
    endpoints.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 可以在管理端点以类似的方式安装SMA PowerShell模块。
- en: Post installation tasks
  id: totrans-125
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安装后任务
- en: 'Ensure to complete the following tasks to have a working SMA deployment for
    the WAP integration:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 确保完成以下任务，以便在WAP集成中实现有效的SMA部署：
- en: Replace the self-signed certificate for SMA web services with trusted SSL in
    production environments.
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在生产环境中，用受信任的SSL证书替换SMA Web服务的自签名证书。
- en: Verify the **SPF** (**Service Provider Foundation**) server trust the SSL certificate
    presented by SMA web service.
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 验证**SPF**（**服务提供商基础架构**）服务器是否信任SMA Web服务所呈现的SSL证书。
- en: Integrating SMA with Windows Azure Pack
  id: totrans-129
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将SMA与Windows Azure Pack集成
- en: 'The following steps are required to integrate SMA with Windows Azure Pack by
    registering SMA endpoints:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 通过注册SMA端点，执行以下步骤以将SMA与Windows Azure Pack集成：
- en: Log into the WAP management portal for administrators.
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录WAP管理门户以进行管理员操作。
- en: Browse through the **automation** workspace:![Integrating SMA with Windows Azure
    Pack](img/00255.jpeg)
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 浏览**自动化**工作区：![将SMA与Windows Azure Pack集成](img/00255.jpeg)
- en: Click on **Register the Service Management Automation Endpoint**.
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**注册服务管理自动化端点**。
- en: Enter the SMA endpoint details along with some credentials:![Integrating SMA
    with Windows Azure Pack](img/00256.jpeg)
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入SMA端点的详细信息和一些凭据：![将SMA与Windows Azure Pack集成](img/00256.jpeg)
- en: The SMA endpoint will be visible in the WAP portal upon a successful registration.
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 成功注册后，SMA端点将在WAP门户中可见。
- en: The **automation** workspace under the WAP portal can now be used for all operations
    related to SMA. The **DASHBOARD** page displays statuses and statistics about
    runbooks and jobs throughout the cloud. Similar dashboards can also be accessed
    per runbook:![Integrating SMA with Windows Azure Pack](img/00257.jpeg)
  id: totrans-136
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: WAP门户下的**自动化**工作区现在可以用于所有与SMA相关的操作。**仪表板**页面显示云中运行书和作业的状态和统计信息。每个运行书也可以访问类似的仪表板：![将SMA与Windows
    Azure Pack集成](img/00257.jpeg)
- en: Dealing with SMA assets
  id: totrans-137
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 处理SMA资产
- en: Assets in a SMA-based automation solution for WAP provide global configurations
    and parameters that can be leveraged by runbooks. For example, it is very likely
    that any runbook being executed for VM cloud's operations may require VMM server
    connection info and credentials. In large environments having hundreds of runbooks,
    instead of defining VMM server connection information and credentials per runbook,
    these can be declared as assets and can be leveraged by all runbooks.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 在基于SMA的WAP自动化解决方案中的资产提供全球配置和参数，可以被运行书（runbooks）利用。例如，执行VM云操作的任何运行书可能需要VMM服务器连接信息和凭据。在拥有数百个运行书的大型环境中，可以将这些VMM服务器连接信息和凭据声明为资产，而不需要在每个运行书中定义，这样它们可以被所有运行书共享。
- en: Declaring such variables at global level in asset also helps in handling changes
    at a later stage in a very smooth manner.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 在资产中声明此类变量有助于在后续阶段平稳地处理变化。
- en: 'Assets in Windows Azure Pack automation include the following:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: Windows Azure Pack自动化中的资产包括以下内容：
- en: Connections
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 连接
- en: Credentials
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 凭据
- en: Variables
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 变量
- en: Schedules
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 日程安排
- en: Modules
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 模块
- en: Asset types and functionalities
  id: totrans-146
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 资产类型和功能
- en: 'The following are the types of assets and their functionalities:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是资产类型及其功能：
- en: '**Connections**: Connections include connectivity details and authorized credentials
    for common services used by runbooks. Examples include services such as SCVMM,
    Azure, or any other available services.'
  id: totrans-148
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**连接**：连接包含常用服务的连接详情和授权凭据，供运行书使用。例如，包括SCVMM、Azure或其他可用服务等服务。'
- en: '**Credentials**: Credentials in WAP automation assets can be compared to Run
    As accounts in SCVMM. Credentials contain a username and password for accounts
    leveraged by runbooks for accessing, modifying, and managing resources across
    the cloud. WAP automation assets can store two types of credentials:'
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**凭据**：WAP自动化资产中的凭据可以与SCVMM中的“以身份运行”（Run As）帐户进行比较。凭据包含用户名和密码，供运行书使用，以访问、修改和管理跨云的资源。WAP自动化资产可以存储两种类型的凭据：'
- en: Windows PowerShell credentials
  id: totrans-150
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows PowerShell凭证
- en: SSL certificates credentials
  id: totrans-151
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: SSL证书凭证
- en: Service providers can add multiple credentials depending upon the permission
    and usage required by runbooks.
  id: totrans-152
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 服务提供商可以根据运行书籍所需的权限和使用情况添加多个凭证。
- en: '**Variables**: As implied by its name, variables can be used to store key values
    used by runbooks. Variables can be defined in the following format:'
  id: totrans-153
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**变量**：顾名思义，变量可以用来存储运行书籍使用的关键值。变量可以按以下格式定义：'
- en: String
  id: totrans-154
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 字符串
- en: Integer
  id: totrans-155
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 整数
- en: Boolean
  id: totrans-156
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 布尔值
- en: Date time
  id: totrans-157
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 日期时间
- en: Variables having confidential values such as password can be encrypted for security.
  id: totrans-158
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 具有敏感值（如密码）的变量可以加密以保证安全性。
- en: '**Schedules**: This can be used to create a regular schedule for any runbook
    to execute; for example, a schedule can be created, which will initiate a runbook
    everyday at some specific time to collect statics data.'
  id: totrans-159
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**计划**：这可以用于为任何运行书籍创建定期的执行计划；例如，可以创建一个计划，每天在特定时间启动运行书籍来收集统计数据。'
- en: '**Modules**: This contains PowerShell modules, which can be used by runbooks
    to execute specific PowerShell cmdlets. Modules can be compared with integration
    packs in System Center Orchestrator.'
  id: totrans-160
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**模块**：这包含PowerShell模块，可以被运行书籍用来执行特定的PowerShell cmdlet。模块可以与System Center Orchestrator中的集成包进行比较。'
- en: Modules help in managing all PowerShell modules in a central point without requiring
    installation at each worker role.
  id: totrans-161
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 模块帮助在一个中心位置管理所有PowerShell模块，无需在每个工作角色中进行安装。
- en: Adding and managing assets
  id: totrans-162
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 添加和管理资产
- en: The **ASSETS** tab under the automation workspace in the WAP management portal
    provides options to add or remove assets.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: '**资产**标签在WAP管理门户的自动化工作区下提供了添加或删除资产的选项。'
- en: 'The following steps are required to add, delete, and modify assets:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 添加、删除和修改资产的步骤如下：
- en: Log into the WAP management portal for administrators.
  id: totrans-165
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到WAP管理门户进行管理员操作。
- en: Browse the **automation** workspace and the **ASSETS** tab.
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 浏览**自动化**工作区和**资产**标签。
- en: By default, all the standard PowerShell modules are included in the WAP portal.
    Any additional module can be imported. Any existing module can be deleted by buttons
    available in the bottom pane:![Adding and managing assets](img/00258.jpeg)
  id: totrans-167
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 默认情况下，所有标准的PowerShell模块都包含在WAP门户中。任何额外的模块都可以被导入。任何现有的模块都可以通过底部窗格中的按钮删除：![添加和管理资产](img/00258.jpeg)
- en: Click on **ADD SETTING** to add a new asset:![Adding and managing assets](img/00259.jpeg)
  id: totrans-168
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**添加设置**以添加新资产：![添加和管理资产](img/00259.jpeg)
- en: Select the type of asset to be added and proceed further.
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择要添加的资产类型并继续。
- en: To create a connection asset, select a connection and provide connection details
    including connection type, name, hostname and credentials. By default, WAP supports
    the following connection types:![Adding and managing assets](img/00260.jpeg)
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要创建一个连接资产，请选择一个连接并提供连接详细信息，包括连接类型、名称、主机名和凭证。默认情况下，WAP支持以下连接类型：![添加和管理资产](img/00260.jpeg)
- en: Add any credentials by selecting add credential on the add service page. Provide
    the credentials type and credentials friendly name and a username, password, or
    the SSL certificate as applicable:![Adding and managing assets](img/00261.jpeg)
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在添加服务页面选择添加凭证来添加任何凭证。提供凭证类型、凭证友好名称和用户名、密码或适用的SSL证书：![添加和管理资产](img/00261.jpeg)
- en: Add any variable by selecting add variable on the add service page provide the
    variable type, variable name, and value with an optional encryption:![Adding and
    managing assets](img/00262.jpeg)![Adding and managing assets](img/00263.jpeg)
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在添加服务页面选择添加变量来添加任何变量，提供变量类型、变量名称和值，并可选择加密：![添加和管理资产](img/00262.jpeg)![添加和管理资产](img/00263.jpeg)
- en: Add any schedule by selecting add schedule on the add service page. Provide
    a schedule name and schedule values including a type (one time or daily) and start
    time:![Adding and managing assets](img/00264.jpeg)
  id: totrans-173
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在添加服务页面选择添加计划来添加任何计划。提供计划名称和计划值，包括类型（一次性或每日）和开始时间：![添加和管理资产](img/00264.jpeg)
- en: The created assets will now be visible in the **ASSETS** tab. They are ready
    for usage by the runbooks.
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建的资产现在将在**资产**标签下可见。它们已准备好供运行书籍使用。
- en: Clicking on any asset will display its configurations; for example, clicking
    on a module will display the module information along with PowerShell cmdlets.
    It will show the following screenshot:![Adding and managing assets](img/00265.jpeg)
  id: totrans-175
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击任何资产将显示其配置；例如，点击一个模块将显示模块信息以及PowerShell cmdlet。它将显示以下截图：![添加和管理资产](img/00265.jpeg)
- en: Additional assets can be created in a similar manner.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 可以以类似的方式创建其他资产。
- en: Dealing with SMA runbooks
  id: totrans-177
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 处理SMA runbooks
- en: SMA runbooks consist of PowerShell workflows, which include PowerShell cmdlets
    to perform specified tasks in an automated manner.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: SMA runbooks由PowerShell工作流组成，其中包括PowerShell cmdlet，以自动化的方式执行指定的任务。
- en: The Runbooks can be managed from the **RUNBOOKS** tab under the **automation**
    workspace WAP portal. Service providers can write PowerShell workflows and runbooks
    anywhere, and then import them in the WAP SMA.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: Runbooks可以从**automation**工作区WAP门户下的**RUNBOOKS**标签进行管理。服务提供商可以在任何地方编写PowerShell工作流和runbook，然后将其导入到WAP
    SMA中。
- en: 'The **RUNBOOKS** tab in the **automation** workspace provides functionality
    to perform the following basic operations on runbooks:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: '**automation**工作区中的**RUNBOOKS**标签提供以下基本操作功能，供对runbooks执行操作：'
- en: Start the execution of any runbook
  id: totrans-181
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 启动任何runbook的执行
- en: Import a runbook to WAP (PS1 file)
  id: totrans-182
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将runbook导入到WAP（PS1文件）
- en: Export any existing runbook to the PS1 file on a local system
  id: totrans-183
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将任何现有的runbook导出为本地系统上的PS1文件
- en: Delete any existing runbook from WAP
  id: totrans-184
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从WAP中删除任何现有的runbook
- en: Note that there is no GUI (drag and drop item) available for authoring runbooks
    such as System Center Orchestrator (SCO); it must be written manually in PowerShell
    workflows.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，编写runbook时没有类似System Center Orchestrator（SCO）的GUI（拖放项）；它必须手动编写PowerShell工作流。
- en: Sample runbooks
  id: totrans-186
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 示例runbooks
- en: Windows Azure Pack along with SMA by default provides a few samples of runbooks
    that can be used and leveraged as a reference to author new runbooks.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: Windows Azure Pack默认提供与SMA一起使用的一些示例runbook，供参考用于编写新runbook。
- en: 'The following steps outline the process to view and manage sample runbooks:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤概述了查看和管理示例runbook的过程：
- en: Log into the WAP management portal for administrators.
  id: totrans-189
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到WAP管理门户（管理员）。
- en: Browse the **automation** workspace and the **RUNBOOKS** tab.
  id: totrans-190
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 浏览**automation**工作区和**RUNBOOKS**标签。
- en: Sample runbooks will be displayed. Click on any sample runbook to see its workflows
    and other configurations.![Sample runbooks](img/00266.jpeg)
  id: totrans-191
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 示例runbooks将显示。点击任何示例runbook以查看其工作流和其他配置。![示例 runbooks](img/00266.jpeg)
- en: Any runbook can be started, imported, exported, and deleted using the buttons
    available in the bottom pane.
  id: totrans-192
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 任何runbook都可以通过底部面板中的按钮启动、导入、导出和删除。
- en: Creating a runbook
  id: totrans-193
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建一个runbook
- en: 'The following steps are required to create a runbook:'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 创建runbook所需的步骤如下：
- en: Log into the WAP management portal for administrators.
  id: totrans-195
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到WAP管理门户（管理员）。
- en: Browse the **automation** workspace and the **RUNBOOKS** tab.
  id: totrans-196
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 浏览**automation**工作区和**RUNBOOKS**标签。
- en: Click on the **NEW** button, select **RUNBOOK** and **QUICK CREATE**:![Creating
    a runbook](img/00267.jpeg)
  id: totrans-197
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**NEW**按钮，选择**RUNBOOK**和**QUICK CREATE**：![创建 runbook](img/00267.jpeg)
- en: The newly created runbook will now be listed under the **RUNBOOKS** tab.
  id: totrans-198
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 新创建的runbook现在将列出在**RUNBOOKS**标签下。
- en: Click on **RUNBOOK NAME** to perform additional operations on the runbook including
    authoring and scheduling.
  id: totrans-199
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**RUNBOOK NAME**执行其他操作，包括编写和调度。
- en: Authoring a runbook
  id: totrans-200
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 编写runbook
- en: Authoring a runbook involves writing PowerShell workflows for the runbook and
    managing runbook versions and modifications throughout the lifecycle.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 编写runbook涉及为runbook编写PowerShell工作流，并在整个生命周期中管理runbook版本和修改。
- en: 'Multiple tools can be leveraged by service providers to author a runbook:'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 服务提供商可以利用多种工具来编写runbook：
- en: Windows PowerShell ISE
  id: totrans-203
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows PowerShell ISE
- en: Visual Studio IDE
  id: totrans-204
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Visual Studio IDE
- en: Windows Azure Pack management portal
  id: totrans-205
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows Azure Pack管理门户
- en: Any other source control or programming tool
  id: totrans-206
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 任何其他源代码控制或编程工具
- en: While authoring runbooks in the Windows Azure Pack administrator portal, it
    can either be in the draft or published version. A published version is used by
    worker servers to execute the workload while initiating a runbook.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 在Windows Azure Pack管理员门户中编写runbook时，它可以是草稿版本或已发布版本。已发布的版本由工作服务器在启动runbook时执行工作负载。
- en: 'The following outlines the steps required to author a runbook in the Windows
    Azure Pack portal:'
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 以下概述了在Windows Azure Pack门户中编写runbook所需的步骤：
- en: First, create runbook by following instructions given in the previous topic.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，按照前面的说明创建runbook。
- en: Select the newly created runbook and browse the **AUTHOR** workspace.
  id: totrans-210
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择新创建的runbook，并浏览**AUTHOR**工作区。
- en: Click on **DRAFT**, and then the workflow writer will be available:![Authoring
    a runbook](img/00268.jpeg)
  id: totrans-211
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**DRAFT**，然后工作流编写器将可用：![编写 runbook](img/00268.jpeg)
- en: Follow the standard Microsoft PowerShell workflow writing guidelines to write
    the workflow for the runbook. See Microsoft documentation at [https://azure.microsoft.com/en-in/documentation/articles/automation-powershell-workflow/](https://azure.microsoft.com/en-in/documentation/articles/automation-powershell-workflow/)
    to learn more about writing PowerShell workflows.
  id: totrans-212
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 请遵循标准的 Microsoft PowerShell 工作流编写指南，为运行手册编写工作流。请参阅 Microsoft 文档 [https://azure.microsoft.com/en-in/documentation/articles/automation-powershell-workflow/](https://azure.microsoft.com/en-in/documentation/articles/automation-powershell-workflow/)
    了解有关编写 PowerShell 工作流的更多信息。
- en: The bottom pane buttons can be leveraged to add additional functionality into
    the runbook, such as adding another runbook (nesting) or adding any activity or
    assets.![Authoring a runbook](img/00269.jpeg)
  id: totrans-213
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 底部面板按钮可用于向运行手册中添加额外功能，如添加另一个运行手册（嵌套）或添加任何活动或资产。![创建运行手册](img/00269.jpeg)
- en: Clicking on **SAVE** will save the current version of the draft. Publishing
    will make this draft available for execution by SMA workers.
  id: totrans-214
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **SAVE** 将保存当前版本的草稿。发布将使此草稿可供 SMA 工作者执行。
- en: Using assets in runbook PowerShell workflows
  id: totrans-215
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在运行手册 PowerShell 工作流中使用资产
- en: 'SMA assets declared at global level can be used inside workflows by the following
    syntax:'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 在全局级别声明的 SMA 资产可以通过以下语法在工作流中使用：
- en: '**Connection**: The following shows an example where connection declared in
    assets is being accessed in the PowerShell workflow:'
  id: totrans-217
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**连接**：以下是一个示例，展示了在资产中声明的连接如何在 PowerShell 工作流中被访问：'
- en: '[PRE0]'
  id: totrans-218
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '**Credentials**: The following PowerShell shows an example where credentials
    declared in assets are being accessed in the PowerShell workflow:'
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**凭证**：以下 PowerShell 示例展示了如何在 PowerShell 工作流中访问在资产中声明的凭证：'
- en: '[PRE1]'
  id: totrans-220
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '**Variable**: The following PowerShell shows an example where a variable declared
    in assets is being accessed in the PowerShell workflow:'
  id: totrans-221
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**变量**：以下 PowerShell 示例展示了如何在 PowerShell 工作流中访问在资产中声明的变量：'
- en: '[PRE2]'
  id: totrans-222
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Scheduling a runbook
  id: totrans-223
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 调度运行手册
- en: Scheduling a runbook will automatically start executing the runbook as per the
    configured date, time, and frequency value. Schedules configured in assets can
    be attached with runbooks; custom schedules can also be created.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 调度运行手册将根据配置的日期、时间和频率值自动启动运行手册的执行。可以将配置在资产中的调度附加到运行手册；也可以创建自定义调度。
- en: 'The following steps are required to author a runbook:'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 创建运行手册所需的步骤如下：
- en: Select the runbook to be scheduled in the WAP portal and browse the **SCHEDULE**
    tab:![Scheduling a runbook](img/00270.jpeg)
  id: totrans-226
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 WAP 门户中选择要调度的运行手册，并浏览 **SCHEDULE** 标签页：![调度运行手册](img/00270.jpeg)
- en: Click on an existing schedule to the leverage schedule created in global assets.
    Click on **ADD A NEW SCHEDULE** to add a new schedule for this runbook.
  id: totrans-227
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击现有的调度以利用在全局资产中创建的调度。点击 **ADD A NEW SCHEDULE** 为该运行手册添加新的调度。
- en: Provide a schedule name and type (one time/daily) along with date and time to
    configure a new schedule.
  id: totrans-228
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供调度名称和类型（一次性/每日）以及日期和时间来配置新的调度。
- en: Click on **Finish** to save the schedule configured for the runbook.
  id: totrans-229
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **Finish** 保存为运行手册配置的调度。
- en: Dealing with jobs
  id: totrans-230
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 处理作业
- en: Whenever a runbook execution is started, a corresponding job is created and
    assigned to a worker role for execution. The worker role stores jobs during runtime
    in a sandbox.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 每当运行手册执行启动时，都会创建一个相应的作业，并分配给工作角色进行执行。工作角色在运行时将作业存储在沙箱中。
- en: Using the Windows Azure pack portal **automation** workspace, we can see the
    status of jobs in real time and for historical data. Jobs can also be stopped,
    suspended, and resumed.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 Windows Azure Pack 门户的 **automation** 工作区，我们可以实时查看作业的状态以及历史数据。作业也可以被停止、暂停和恢复。
- en: 'The following outlines the steps for viewing and dealing with runbooks:'
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 以下概述了查看和处理运行手册的步骤：
- en: The **RUNBOOKS** tab under the **automation** workspace displays the status
    for all runbooks in the WAP cloud:![Dealing with jobs](img/00271.jpeg)
  id: totrans-234
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**自动化** 工作区下的 **RUNBOOKS** 标签页显示 WAP 云中所有运行手册的状态：![处理作业](img/00271.jpeg)'
- en: A job status per runbook can be accessed under the **JOBS** tab for each runbook
    page. Select the job status and timelines to see jobs status as per selected parameters.
  id: totrans-235
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 每个运行手册页面下的 **JOBS** 标签页可以访问每个运行手册的作业状态。选择作业状态和时间线，根据选定的参数查看作业状态。
- en: Configuring the runbook logging
  id: totrans-236
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置运行手册日志记录
- en: 'Windows Azure Pack provides multiple choices to cloud administrators for configuring
    logging levels and types for a runbook. Administrators can choose to enable or
    disable the following level of logging per runbook:'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: Windows Azure Pack为云管理员提供了多个选择，用于配置运行簿的日志级别和类型。管理员可以选择每个运行簿启用或禁用以下日志级别：
- en: Log Debug Records
  id: totrans-238
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 日志调试记录
- en: Log Verbose Records
  id: totrans-239
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 日志详细记录
- en: Log Progress Records
  id: totrans-240
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 日志进度记录
- en: 'The following steps are required to configure logging options for a runbook:'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤是配置运行簿日志选项所需的操作：
- en: Select the runbook and browse the configure tab.
  id: totrans-242
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择运行簿并浏览配置选项卡。
- en: Scroll down to the logging space and configure settings as per requirement;
    click on **SAVE** to save the changed configurations:![Configuring the runbook
    logging](img/00272.jpeg)
  id: totrans-243
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向下滚动到日志区域，并根据需求配置设置；点击**保存**以保存更改的配置：![配置运行簿日志](img/00272.jpeg)
- en: Linking runbooks with VM cloud actions
  id: totrans-244
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 将运行簿与虚拟机云操作链接
- en: Linking runbooks with VM cloud operations enable executing a specified runbook
    only when a specific event or action occurs. Linking a runbook with actions helps
    in getting the required operations performed on objects as soon the objects gets
    created instead of waiting until the next runbook schedule.
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 将运行簿与虚拟机云操作链接，只有在发生特定事件或操作时才执行指定的运行簿。将运行簿与操作链接有助于在对象创建后立即执行所需的操作，而不是等到下一个运行簿计划。
- en: 'The following steps are required to link the runbook with an action in VM clouds:'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤是将运行簿与虚拟机云中的操作链接的要求：
- en: Log into the WAP portal for administrators and browse the **vm clouds** workspace.
  id: totrans-247
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到WAP管理员门户并浏览**虚拟机云**工作区。
- en: Select the **AUTOMATION** tab:![Linking runbooks with VM cloud actions](img/00273.jpeg)
  id: totrans-248
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**自动化**选项卡：![将运行簿与虚拟机云操作链接](img/00273.jpeg)
- en: Click on **LINK AN ACTION WITH A RUNBOOK**.
  id: totrans-249
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**将操作与运行簿链接**。
- en: 'WAP automation supports the following objects of VM clouds to link a runbook
    on the specific action:'
  id: totrans-250
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: WAP自动化支持以下虚拟机云对象，以在特定操作上链接运行簿：
- en: '![Linking runbooks with VM cloud actions](img/00274.jpeg)'
  id: totrans-251
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![将运行簿与虚拟机云操作链接](img/00274.jpeg)'
- en: Select **OBJECT**, **ACTION** and **RUNBOOK** to configure:![Linking runbooks
    with VM cloud actions](img/00275.jpeg)
  id: totrans-252
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**对象**、**操作**和**运行簿**进行配置：![将运行簿与虚拟机云操作链接](img/00275.jpeg)
- en: '**Click** on **finish** to link the runbook with the selected action.'
  id: totrans-253
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**点击** **完成**以将运行簿与选定的操作链接。'
- en: Enabling ADFS authentication for WAP portals
  id: totrans-254
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 启用ADFS身份验证用于WAP门户
- en: Windows Azure Pack standard installation includes authentication sites for both
    admin and tenant portals to leverage their default authentication mechanisms.
    Active directory provides authentication services worldwide. We can leverage AD
    features and capabilities by enabling our WAP portals to use ADFS for authentication.
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: Windows Azure Pack标准安装包括管理员和租户门户的身份验证站点，以利用其默认的身份验证机制。Active Directory提供全球范围的身份验证服务。通过启用WAP门户使用ADFS进行身份验证，我们可以利用AD的功能和特性。
- en: This can enable service providers to authenticate tenant users against the tenant's
    own active directory hosted inside their on-premises infrastructure.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 这可以让服务提供商验证租户用户身份，使用租户自己托管在本地基础设施中的Active Directory。
- en: ADFS authentication architecture and overview – admin and tenant portals
  id: totrans-257
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ADFS身份验证架构和概述 – 管理员和租户门户
- en: By default, Windows Azure Pack portals are configured to use the following authentication
    mechanisms.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Windows Azure Pack门户配置为使用以下身份验证机制。
- en: 'The WAP management portal for administrators: Windows authentication'
  id: totrans-259
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: WAP管理员门户：Windows身份验证
- en: The WAP management portal for tenants—ASP.NET provider
  id: totrans-260
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 租户的WAP管理门户—ASP.NET提供者
- en: 'Active Directory Federations Services are used to simplify login and enable
    true SSO (single sign on) capabilities across the applications and services hosted
    anywhere (on-premises/public clouds). Using ADFS for authentication in Windows
    Azure Pack, cloud providers can secure and simplify authentication mechanisms
    for admins portals. For tenant portals, it will help in enabling single sign on
    for tenant users, leveraging a tenant''s own active directory for authentication.
    The following diagram explains the authentication architecture for Windows Azure
    Pack with ADFS:'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: Active Directory联合服务（ADFS）用于简化登录并启用跨应用程序和服务的真正SSO（单点登录）功能，无论这些应用程序和服务托管在哪里（本地/公共云）。通过在Windows
    Azure Pack中使用ADFS进行身份验证，云提供商可以保护和简化管理员门户的身份验证机制。对于租户门户，它有助于启用租户用户的单点登录，利用租户自己的Active
    Directory进行身份验证。以下图示解释了Windows Azure Pack与ADFS的身份验证架构：
- en: '![ADFS authentication architecture and overview – admin and tenant portals](img/00276.jpeg)'
  id: totrans-262
  prefs: []
  type: TYPE_IMG
  zh: '![ADFS身份验证架构和概览 – 管理员和租户门户](img/00276.jpeg)'
- en: 'Implementing ADFS for the Windows Azure Pack cloud involves the following steps:'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 为Windows Azure Pack云实施ADFS需要以下步骤：
- en: Setting up ADFS farms (both cloud provides and tenants)
  id: totrans-264
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置ADFS农场（包括云提供商和租户）。
- en: Adding the tenant's ADFS as a claim provider to the cloud provider's ADFS
  id: totrans-265
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将租户的ADFS作为声明提供者添加到云提供商的ADFS中。
- en: Adding cloud provider's ADFS as a relying party to tenant's ADFS
  id: totrans-266
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将云提供商的ADFS添加为租户的ADFS的信任方。
- en: Adding the WAP portal (tenant/admin) as a relying party to the cloud provider's
    ADFS
  id: totrans-267
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将WAP门户（租户/管理员）添加为云提供商的ADFS信任方。
- en: Adding the cloud provider's ADFS as a claim provider to the WAP tenant portal
  id: totrans-268
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将云提供商的ADFS添加为WAP租户门户的声明提供者。
- en: Testing and verifying the configuration
  id: totrans-269
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 测试并验证配置。
- en: Setting up ADFS farms and configuring relationship between a provider's and
    tenant's ADFS service isn't covered in this book. See Microsoft ADFS documentation
    at [https://technet.microsoft.com/en-in/windowsserver/dd448613.aspx](https://technet.microsoft.com/en-in/windowsserver/dd448613.aspx)
    to know more about ADFS.
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 本书未涵盖设置ADFS农场和配置提供方与租户之间ADFS服务的关系。有关ADFS的更多信息，请参阅Microsoft ADFS文档：[https://technet.microsoft.com/en-in/windowsserver/dd448613.aspx](https://technet.microsoft.com/en-in/windowsserver/dd448613.aspx)。
- en: Adding the WAP portal as a relying party
  id: totrans-271
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 将WAP门户添加为信任方。
- en: 'The following steps are required to add WAP portals as a relying party to the
    cloud provider''s ADFS service. See [Chapter 3](part0033_split_000.html#VF2I1-b479cf466c26404ca54119871a9b2715
    "Chapter 3. Installing and Configuring Windows Azure Pack"), *Installing and Configuring
    Windows Azure Pack*, to learn more about the Windows Azure Pack architecture and
    role of these components:'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤是将WAP门户添加为云提供商的ADFS服务的信任方。有关Windows Azure Pack架构及其组件角色的更多信息，请参阅[第3章](part0033_split_000.html#VF2I1-b479cf466c26404ca54119871a9b2715
    "第3章 安装和配置Windows Azure Pack")，*安装和配置Windows Azure Pack*：
- en: Log into the ADFS server and open the ADFS console from the server manager.
  id: totrans-273
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到ADFS服务器，并从服务器管理器打开ADFS控制台。
- en: Click on the **Add** relaying party trust.
  id: totrans-274
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**添加**信任中继方。
- en: Provide the federation metadata URL of the WAP server in the given format, that
    is, `https://manage.wapcloud.com/federationmetadata/2007-06/federationmetadata.xml`:![Adding
    the WAP portal as a relying party](img/00277.jpeg)
  id: totrans-275
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供WAP服务器的联合元数据URL，格式为`https://manage.wapcloud.com/federationmetadata/2007-06/federationmetadata.xml`：![添加WAP门户作为信任方](img/00277.jpeg)
- en: Specify **Display Name** and optional note.
  id: totrans-276
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 指定**显示名称**和可选的备注。
- en: Enable or disable the multi-factor authentication as per the service provider's
    decision.
  id: totrans-277
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 根据服务提供商的决策启用或禁用多因素认证。
- en: Select **Permit** to allow all users to access this relying party.
  id: totrans-278
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**允许**以允许所有用户访问此信任方。
- en: On the **Finish** page, select the checkbox for **Edit claims rules**.
  id: totrans-279
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**完成**页面，选中**编辑声明规则**的复选框。
- en: Add the rule with the setting called **Send LDAP Attributes as Claims**.
  id: totrans-280
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加名为**发送LDAP属性作为声明**的规则。
- en: Provide a claim rule name and select **Active Directory** as **Attribute store**.
  id: totrans-281
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供声明规则名称，并选择**Active Directory**作为**属性存储**。
- en: Map the User-Principal-Name LDAP attribute to the UPN called **Outgoing claim
    type**.![Adding the WAP portal as a relying party](img/00278.jpeg)
  id: totrans-282
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将用户主体名称LDAP属性映射到名为**传出声明类型**的UPN。![添加WAP门户作为信任方](img/00278.jpeg)
- en: Add one more rule with the same configuration except changing the binding by
    mapping MapToken-Groups—Qualified by the domain name LDAP attribute to the group
    Outgoing claim type.
  id: totrans-283
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加另一个规则，配置相同，唯一的不同是通过映射MapToken-Groups—由域名LDAP属性限定到组的传出声明类型来更改绑定。
- en: Add another rule with Passthrough or Filter an Incoming Claim rule template.
  id: totrans-284
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加另一个规则，使用传递或筛选传入声明规则模板。
- en: Provide a claim rule name and select **UPN** in the incoming claim type.
  id: totrans-285
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供声明规则名称，并选择传入声明类型中的**UPN**。
- en: Add another rule to Passthrough or Filter an Incoming Claim template with Provide
    claim rule name. Select **Group** in the incoming claim type.
  id: totrans-286
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加另一个规则，使用提供声明规则名称的传递或筛选传入声明模板。在传入声明类型中选择**组**。
- en: Verify the created rules and proceed to finish the configuration wizard.![Adding
    the WAP portal as a relying party](img/00279.jpeg)
  id: totrans-287
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 验证已创建的规则，并继续完成配置向导。![添加WAP门户作为信任方](img/00279.jpeg)
- en: 'Post this run to finish ADFS configurations along with the WAP website identifier:'
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 执行此操作以完成ADFS配置以及WAP网站标识符：
- en: '[PRE3]'
  id: totrans-289
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'To get the identifier, run the following PowerShell. Provide the WAP portal
    party name in cmdlet:'
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 要获取标识符，请运行以下 PowerShell 命令。 在 cmdlet 中提供 WAP 门户方名称：
- en: '[PRE4]'
  id: totrans-291
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Configuring WAP websites to use ADFS
  id: totrans-292
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置 WAP 网站使用 ADFS
- en: 'The following steps are required to configure WAP websites to use ADFS as the
    authentication site. See [Chapter 3](part0033_split_000.html#VF2I1-b479cf466c26404ca54119871a9b2715
    "Chapter 3. Installing and Configuring Windows Azure Pack"), *Installing and Configuring
    Windows Azure Pack*, to learn more about configuring WAP portals:'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 配置 WAP 网站使用 ADFS 作为身份验证站点的步骤如下。请参阅 [第 3 章](part0033_split_000.html#VF2I1-b479cf466c26404ca54119871a9b2715
    "第 3 章：安装和配置 Windows Azure Pack")，*安装和配置 Windows Azure Pack*，以了解更多关于配置 WAP 门户的内容：
- en: 'Execute the following PowerShell on the Windows Azure Pack server to configure
    tenant websites to use ADFS. Tenants can be replaced with an admin to configure
    an admin portal:'
  id: totrans-294
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Windows Azure Pack 服务器上执行以下 PowerShell 命令，以配置租户网站使用 ADFS。租户可以替换为管理员来配置管理员门户：
- en: '[PRE5]'
  id: totrans-295
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Execute the following PowerShell on the Windows Azure Pack server to configure
    the Identity Provider to use ADFS:'
  id: totrans-296
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Windows Azure Pack 服务器上执行以下 PowerShell 命令，以配置身份提供者使用 ADFS：
- en: '[PRE6]'
  id: totrans-297
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Execute the following PowerShell on the Windows Azure Pack server to configure
    the selected user as the administrator of WAP:'
  id: totrans-298
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Windows Azure Pack 服务器上执行以下 PowerShell 命令，将所选用户配置为 WAP 的管理员：
- en: '[PRE7]'
  id: totrans-299
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Post successful configuration, ADFS authentication can be verified by opening
    the WAP portal. The portal will automatically redirect the authentication to the
    ADFS page.
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 配置成功后，可以通过打开 WAP 门户验证 ADFS 身份验证。门户将自动将身份验证重定向到 ADFS 页面。
- en: Summary
  id: totrans-301
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: At the end of this chapter, we have completed building essential services for
    our WAP cloud solution. You learned about building a SMA solution for automating
    the WAP cloud resource provisioning, monitoring, and management. You learned about
    planning, installing, and configuring SMA. You learned about SMA assets and runbooks
    including authoring and managing runbooks.
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章结束时，我们已经完成了构建 WAP 云解决方案的基本服务。你学习了如何构建 SMA 解决方案来自动化 WAP 云资源的提供、监控和管理。你还了解了
    SMA 的规划、安装和配置过程。你学习了 SMA 资产和运行手册，包括编写和管理运行手册。
- en: We also covered using authentication capabilities of ADFS with Windows Azure
    Pack for admin and tenant portal authentication.
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还介绍了如何使用 ADFS 的身份验证功能，通过 Windows Azure Pack 进行管理员和租户门户的身份验证。
- en: In the next chapter, we will look at the extensible architecture of the Windows
    Azure Pack cloud by learning about partner and third-party developed products
    for extending WAP capabilities and features.
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将通过了解合作伙伴和第三方开发的产品来扩展 WAP 功能和特性，从而深入了解 Windows Azure Pack 云的可扩展架构。
