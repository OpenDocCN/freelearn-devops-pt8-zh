<html><head></head><body>
<div id="sbo-rt-content"><div id="_idContainer108">
<h1 class="chapter-number" id="_idParaDest-42"><a id="_idTextAnchor042"/>3</h1>
<h1 id="_idParaDest-43"><a id="_idTextAnchor043"/>Setting Variables, Environments, Approvals, and Checks</h1>
<p>In the previous chapters, we created our first build pipeline by creating jobs and tasks for it and made a trigger to run a build pipeline automatically. This chapter will cover the next step in creating release pipelines. By the end of this chapter, you will have learned how to create a release pipeline so that you can deploy an application on Azure. This involves setting up a variable group library and learning to add and use secret files for specific use cases, such as mobile <span class="No-Break">application deployment.</span></p>
<p>We will cover the following topics in <span class="No-Break">this chapter:</span></p>
<ul>
<li>Creating a service connection for <span class="No-Break">Azure resources</span></li>
<li>Creating a variable <span class="No-Break">group library</span></li>
<li>Uploading and managing a <span class="No-Break">secret file</span></li>
<li>Creating a <span class="No-Break">release pipeline.</span></li>
</ul>
<h1 id="_idParaDest-44"><a id="_idTextAnchor044"/>Creating a service connection for Azure resources</h1>
<p>This section <a id="_idIndexMarker124"/>will teach you how to create a<a id="_idIndexMarker125"/> service connection so that you can release your application on Azure resources. Before creating a service connection, you need to provide an Azure credential that can be obtained from the <span class="No-Break">Azure portal.</span></p>
<h2 id="_idParaDest-45"><a id="_idTextAnchor045"/>Exploring Azure app registration</h2>
<p><strong class="bold">App registrations</strong> is<a id="_idIndexMarker126"/> the portal section where you can obtain Azure credentials, allowing Azure Pipelines to deploy applications to Azure resources. You can create an Azure app registration by performing the <span class="No-Break">following steps:</span></p>
<ol>
<li>Navigate to <a href="https://portal.azure.com">https://portal.azure.com</a> | <strong class="bold">Microsoft </strong><span class="No-Break"><strong class="bold">Entra ID</strong></span><span class="No-Break">.</span></li>
<li>Click on <strong class="bold">App registrations</strong> and then <strong class="bold">+ </strong><span class="No-Break"><strong class="bold">New registration</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer071">
<img alt="Figure 3.1 – The App registrations page" height="569" src="image/B18875_03_01.jpg" width="1265"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.1 – The App registrations page</p>
<ol>
<li value="3">Click on the <strong class="bold">Register an application</strong> option. At this point, you need to provide the name of the registered application, after which you can choose from four options regarding account type. The first is for a single tenant, which means only a single identity in one Azure account. The second option is for multiple identities in one Azure account. The third option is for if there are multiple identities, including personal Microsoft accounts in one Azure account. The last option is only for personal Microsoft accounts in one Azure account. Once you’ve chosen the relevant option, <span class="No-Break">click </span><span class="No-Break"><strong class="bold">Register</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer072">
<img alt="Figure 3.2 – The Register an application page" height="1071" src="image/B18875_03_02.jpg" width="1257"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.2 – The Register an application page</p>
<ol>
<li value="4">After<a id="_idIndexMarker127"/> registering an app ID, navigate to <strong class="bold">Certificates &amp; Secrets</strong> to create a secret. Go to <strong class="bold">+ New client secret</strong> | <strong class="bold">Add a client secret</strong>. Provide the description and expiry date and <span class="No-Break">click </span><span class="No-Break"><strong class="bold">Add</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer073">
<img alt="Figure 3.3 – Certificates and secrets" height="687" src="image/B18875_03_03.jpg" width="1264"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.3 – Certificates and secrets</p>
<ol>
<li value="5">Do not <a id="_idIndexMarker128"/>forget to copy the <em class="italic">secret</em> value – it will disappear, and you cannot recover it after you close <span class="No-Break">this page:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer074">
<img alt="Figure 3.4 – Client secrets" height="233" src="image/B18875_03_04.jpg" width="1228"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.4 – Client secrets</p>
<ol>
<li value="6">Copy the highlighted information to prepare for creating a <span class="No-Break">service connection:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer075">
<img alt="Figure 3.5 – App registration overview" height="227" src="image/B18875_03_05.jpg" width="1081"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.5 – App registration overview</p>
<p>In the following section, we will use this information to create a <span class="No-Break">service connection.</span></p>
<h2 id="_idParaDest-46"><a id="_idTextAnchor046"/>Creating a service connection</h2>
<p>To <a id="_idIndexMarker129"/>deploy an application on Azure, you <a id="_idIndexMarker130"/>need to create a service connection, which is a service account that allows you to access the Azure resource. To do this, follow <span class="No-Break">these instructions:</span></p>
<ol>
<li>After creating an app registration from the Azure portal, navigate to the Azure DevOps page at <a href="https://dev.azure.com/">https://dev.azure.com/</a> and click <span class="No-Break"><strong class="bold">Sign in</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer076">
<img alt="Figure 3.6 – Sign-in page" height="334" src="image/B18875_03_06.jpg" width="812"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.6 – Sign-in page</p>
<ol>
<li value="2">Click on <strong class="bold">Project settings</strong> | <strong class="bold">Service connections</strong> &gt; <strong class="bold">Create </strong><span class="No-Break"><strong class="bold">service connection</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer077">
<img alt="Figure 3.7 – Creating a service connection" height="577" src="image/B18875_03_07.jpg" width="1087"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.7 – Creating a service connection</p>
<ol>
<li value="3">Select <strong class="bold">Azure Resource Manager</strong> and <a id="_idIndexMarker131"/><span class="No-Break">click </span><span class="No-Break"><strong class="bold">Next</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer078">
<img alt="Figure 3.8 – Selecting a service connection type" height="583" src="image/B18875_03_08.jpg" width="679"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.8 – Selecting a service connection type</p>
<ol>
<li value="4">For <strong class="bold">Authentication method</strong>, there <a id="_idIndexMarker132"/>are four options to <span class="No-Break">choose from:</span><ul><li>The first option involves automatically finding service principles in all <span class="No-Break">Azure resources.</span></li><li>The <a id="_idIndexMarker133"/>second option is a manual method where you can enter all information about the app ID. This option allows you to easily connect to <span class="No-Break">Azure resources.</span></li><li>The third option is used for an existing identity that is used for <span class="No-Break">another system.</span></li><li>The final option involves exporting the public profile from the Azure portal page and <span class="No-Break">using it.</span></li></ul><p class="list-inset">For this example, select the second option, <strong class="bold">Service principal (manual)</strong>, and <span class="No-Break">click </span><span class="No-Break"><strong class="bold">Next</strong></span><span class="No-Break">:</span></p></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer079">
<img alt="Figure 3.9 – Choosing an authentication method" height="507" src="image/B18875_03_09.jpg" width="655"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.9 – Choosing an authentication method</p>
<ol>
<li value="5">Fill in the required fields, as follows, and click <strong class="bold">Verify </strong><span class="No-Break"><strong class="bold">and save</strong></span><span class="No-Break">:</span><ul><li><strong class="bold">Environment</strong>: <span class="No-Break"><strong class="source-inline">Azure Cloud</strong></span></li><li><strong class="bold">Scope Level</strong>: <strong class="bold">Subscription</strong> (there are three levels; we’re using this option <a id="_idIndexMarker134"/>because we need to limit the scope of permission to only the subscription level for <span class="No-Break">risk management)</span></li><li><strong class="bold">Subscription Id</strong>: <strong class="source-inline">&lt;Check on </strong><span class="No-Break"><strong class="source-inline">subscription menu&gt;</strong></span></li><li><strong class="bold">Subscription Name</strong>: <strong class="source-inline">&lt;Check on </strong><span class="No-Break"><strong class="source-inline">subscription menu&gt;</strong></span></li><li><strong class="bold">Service Principal Id</strong>: <strong class="source-inline">&lt;Client id of </strong><span class="No-Break"><strong class="source-inline">App registration&gt;</strong></span></li><li><strong class="bold">Credentia</strong>l: <strong class="bold">Service </strong><span class="No-Break"><strong class="bold">principal key</strong></span></li><li><strong class="bold">Service principal key</strong>: <strong class="source-inline">&lt;Secret of </strong><span class="No-Break"><strong class="source-inline">App registration&gt;</strong></span></li><li><strong class="bold">Tenant ID</strong>: <strong class="source-inline">&lt;Tenant ID of </strong><span class="No-Break"><strong class="source-inline">App registration&gt;</strong></span></li><li><strong class="bold">Service connection </strong><span class="No-Break"><strong class="bold">name</strong></span><span class="No-Break">: </span><span class="No-Break"><strong class="source-inline">sp-for-devops</strong></span></li><li><strong class="bold">Security</strong>: Turn <strong class="bold">Grant access permission to all </strong><span class="No-Break"><strong class="bold">pipelines</strong></span><span class="No-Break"> on.</span></li></ul></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer080">
<img alt="Figure 3.10 – Enter Azure service connection details" height="1058" src="image/B18875_03_10.jpg" width="415"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.10 – Enter Azure service connection details</p>
<ol>
<li value="6">You<a id="_idIndexMarker135"/> can now view the new <span class="No-Break">service</span><span class="No-Break"><a id="_idIndexMarker136"/></span><span class="No-Break"> connection:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer081">
<img alt="Figure 3.11 – List of all service connections" height="259" src="image/B18875_03_11.jpg" width="816"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.11 – List of all service connections</p>
<p>In this <a id="_idIndexMarker137"/>section, you <a id="_idIndexMarker138"/>learned how to create a service connection for an Azure resource connection. You will use this when you create a release pipeline for deploying an Azure application. In the next section, you will learn how to create global variables and secret files for use on all Azure pipelines in <span class="No-Break">a project.</span></p>
<h1 id="_idParaDest-47"><a id="_idTextAnchor047"/>Managing global variables and secret files</h1>
<p>Most projects <a id="_idIndexMarker139"/>will use the same value for creating release pipelines, such as the name of the Azure service connection. This section will teach you how to create the variable group and secret files. These resources are essential for sharing common values across multiple pipelines, and include, for instance, a username and password for deploying applications to <span class="No-Break">Microsoft Azure.</span></p>
<h2 id="_idParaDest-48"><a id="_idTextAnchor048"/>Creating a variable group library</h2>
<p>You need<a id="_idIndexMarker140"/> to create a global variable to link to all pipelines if that pipeline needs to use an Azure service connection. Using <a id="_idIndexMarker141"/>variable groups reduces the chances of making mistakes and duplicating values across many pipelines. When you need to update the values, you can do so in a single centralized location instead of throughout <span class="No-Break">all pipelines.</span></p>
<p>You can follow these steps when you need to create variables you wish to share for <span class="No-Break">all pipelines:</span></p>
<ol>
<li>Navigate to your project and click on <strong class="bold">Pipelines</strong> | <strong class="bold">Library</strong> | <span class="No-Break"><strong class="bold">Variable group</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer082">
<img alt="Figure 3.12 – Creating a variable group" height="487" src="image/B18875_03_12.jpg" width="925"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.12 – Creating a variable group</p>
<ol>
<li value="2">Fill in<a id="_idIndexMarker142"/> all the required fields; specify <strong class="bold">Variable group name</strong> and <strong class="bold">Name</strong> with the values that you would like <a id="_idIndexMarker143"/>to share across all pipelines and <span class="No-Break">click </span><span class="No-Break"><strong class="bold">Save</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer083">
<img alt="Figure 3.13 – Entering variable group details" height="730" src="image/B18875_03_13.jpg" width="1078"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.13 – Entering variable group details</p>
<ol>
<li value="3">Edit the <a id="_idIndexMarker144"/>existing pipeline that you need to link to a variable group. Click the <strong class="bold">Edit</strong> option for the <a id="_idIndexMarker145"/>existing pipeline and navigate to <strong class="bold">Variables</strong> | <strong class="bold">Variable groups</strong> | <strong class="bold">Link </strong><span class="No-Break"><strong class="bold">variable group</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer084">
<img alt="Figure 3.14 – Selecting variable groups" height="290" src="image/B18875_03_14.jpg" width="1108"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.14 – Selecting variable groups</p>
<ol>
<li value="4">Select the variable group you just created and <span class="No-Break">click </span><span class="No-Break"><strong class="bold">Link</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer085">
<img alt="Figure 3.15 – Link variable group" height="675" src="image/B18875_03_15.jpg" width="314"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.15 – Link variable group</p>
<ol>
<li value="5">Review all<a id="_idIndexMarker146"/> the values that have been assigned to your variable group and click <strong class="bold">Save &amp; </strong><span class="No-Break"><strong class="bold">queue</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer086">
<img alt="Figure 3.16 – Reviewing and saving the variable group to the pipeline" height="357" src="image/B18875_03_16.jpg" width="1235"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.16 – Reviewing and saving the variable group to the pipeline</p>
<p>In this section, you<a id="_idIndexMarker147"/> learned how to create a variable group to share for all pipelines. You also learned how to link a variable group to the existing pipeline. In the next section, you will learn how to upload secret files and connect them to <span class="No-Break">your pipelines.</span></p>
<h2 id="_idParaDest-49"><a id="_idTextAnchor049"/>Uploading and selecting a secret file</h2>
<p>Secret files<a id="_idIndexMarker148"/> typically<a id="_idIndexMarker149"/> contain sensitive information, such as signing certificates, SSH keys, license files, or mobile provisioning profiles. In some cases, you are responsible for generating such files and in other cases, these files are generated on other platforms. You then must download the file from that platform and make it available to your <span class="No-Break">CI/CD pipelines.</span></p>
<p>For example, to deploy a mobile application such as an iOS application, you must first generate a <strong class="bold">provisioning profile</strong> that<a id="_idIndexMarker150"/> contains information about who is <a id="_idIndexMarker151"/>developing the iOS application, download it, and then link it to <span class="No-Break">the pipeline.</span></p>
<p>To do this, follow <span class="No-Break">these steps:</span></p>
<ol>
<li>Go to <strong class="bold">Pipelines</strong> | <strong class="bold">Library</strong> | <strong class="bold">+ </strong><span class="No-Break"><strong class="bold">Secure file</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer087">
<img alt="Figure 3.17 – Secure file" height="522" src="image/B18875_03_17.jpg" width="1024"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.17 – Secure file</p>
<ol>
<li value="2">Click <strong class="bold">Browse…</strong> to select the <strong class="source-inline">*.mobileprovision</strong> file that you need to keep as a secret file and <span class="No-Break">click </span><span class="No-Break"><strong class="bold">OK</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer088">
<img alt="Figure 3.18 – Upload file" height="360" src="image/B18875_03_18.jpg" width="760"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.18 – Upload file</p>
<ol>
<li value="3">View the<a id="_idIndexMarker152"/> secure file that <span class="No-Break">you uploaded:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer089">
<img alt="Figure 3.19 – Viewing secure files" height="269" src="image/B18875_03_19.jpg" width="1068"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.19 – Viewing secure files</p>
<ol>
<li value="4">Click on <strong class="bold">+</strong> on the relevant job in the pipeline, type <strong class="source-inline">Secure</strong>, and click <strong class="bold">Add</strong> on the <strong class="bold">Download secure </strong><span class="No-Break"><strong class="bold">file</strong></span><span class="No-Break"> task:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer090">
<img alt="Figure 3.20 – The Download secure file task" height="411" src="image/B18875_03_20.jpg" width="1050"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.20 – The Download secure file task</p>
<ol>
<li value="5">In the previous steps, we added the secret file in the global section. We now need to<a id="_idIndexMarker153"/> download it when we use it. To do this, enter the <span class="No-Break">relevant details:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer091">
<img alt="Figure 3.21 – Entering the relevant details" height="443" src="image/B18875_03_21.jpg" width="930"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.21 – Entering the relevant details</p>
<ol>
<li value="6">Click <strong class="bold">+</strong> on the relevant job in the pipeline, type <strong class="source-inline">Command line</strong>, and click <strong class="bold">Add</strong> on the <strong class="bold">Command </strong><span class="No-Break"><strong class="bold">line</strong></span><span class="No-Break"> task:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer092">
<img alt="Figure 3.22 – Adding the Command line task" height="545" src="image/B18875_03_22.jpg" width="1047"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.22 – Adding the Command line task</p>
<ol>
<li value="7">Enter the relevant <strong class="bold">Command line</strong> details: set <strong class="bold">Display name</strong> to <strong class="source-inline">Display secure file path</strong> and for <strong class="bold">Script</strong>, enter <strong class="source-inline">echo $(demo.secureFilePath)</strong>. Click <strong class="bold">Save &amp; </strong><span class="No-Break"><strong class="bold">queue</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer093">
<img alt="Figure 3.23 – Entering details for the Command line task" height="502" src="image/B18875_03_23.jpg" width="951"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.23 – Entering details for the Command line task</p>
<ol>
<li value="8">View<a id="_idIndexMarker154"/> the job to see the <strong class="bold">Display secure </strong><span class="No-Break"><strong class="bold">file</strong></span><span class="No-Break"> log:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer094">
<img alt="Figure 3.24 – Viewing the secure file path" height="732" src="image/B18875_03_24.jpg" width="1490"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.24 – Viewing the secure file path</p>
<p class="callout-heading">Why use secure files?</p>
<p class="callout">These files will be stored securely and encrypted in Azure DevOps for you to use in your pipelines, minimizing the chances for them to be misplaced or misused by <span class="No-Break">your team.</span></p>
<p>This section <a id="_idIndexMarker155"/>taught you how to create secure files and connect them to pipelines. You also learned how to download secure files to pipelines and display them on the command line. In the next section, you will learn how to create a release pipeline that includes both a variable group and a <span class="No-Break">secure file.</span></p>
<h1 id="_idParaDest-50"><a id="_idTextAnchor050"/>Creating a release pipeline</h1>
<p>This section will teach you how to create a release pipeline to deploy the artifact that’s received from a <span class="No-Break">build pipeline.</span></p>
<p>A <strong class="bold">release pipeline</strong> also<a id="_idIndexMarker156"/> includes a secure file and a variable from a variable group of <span class="No-Break">a library.</span></p>
<p>To create<a id="_idIndexMarker157"/> such a pipeline, follow <span class="No-Break">these steps:</span></p>
<ol>
<li>Navigate to <strong class="bold">Pipelines</strong> | <strong class="bold">Releases</strong> | <span class="No-Break"><strong class="bold">New pipeline</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer095">
<img alt="Figure 3.25 – New pipeline" height="579" src="image/B18875_03_25.jpg" width="1263"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.25 – New pipeline</p>
<ol>
<li value="2">Click on the relevant <a id="_idIndexMarker158"/>pipeline, which in this case is <strong class="bold">release-app-dev</strong>. Navigate to <strong class="bold">Pipeline</strong> | <strong class="bold">Artifacts</strong> | <strong class="bold">+ </strong><span class="No-Break"><strong class="bold">Add</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer096">
<img alt="Figure 3.26 – Adding artifacts" height="636" src="image/B18875_03_26.jpg" width="1348"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.26 – Adding artifacts</p>
<ol>
<li value="3">Click <strong class="bold">Build</strong> and select <strong class="bold">PacktAzureDevOps-CI</strong>, then <span class="No-Break">click </span><span class="No-Break"><strong class="bold">Add</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer097">
<img alt="Figure 3.27 – Entering artifact data" height="643" src="image/B18875_03_27.jpg" width="604"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.27 – Entering artifact data</p>
<ol>
<li value="4">Go<a id="_idIndexMarker159"/> to <strong class="bold">Variables</strong> | <strong class="bold">Variable groups</strong> | <strong class="bold">global-var-group</strong> | <span class="No-Break"><strong class="bold">Link</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer098">
<img alt="Figure 3.28 – Link variable group" height="792" src="image/B18875_03_28.jpg" width="1237"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.28 – Link variable group</p>
<ol>
<li value="5">Expand <strong class="bold">global-var-group (1)</strong> to<a id="_idIndexMarker160"/> see all the <span class="No-Break">associated variables:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer099">
<img alt="Figure 3.29 – Reviewing the variables" height="367" src="image/B18875_03_29.jpg" width="1178"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.29 – Reviewing the variables</p>
<ol>
<li value="6">Click <strong class="bold">Download secure file</strong>, then select <strong class="bold">demo.json</strong> and enter <strong class="source-inline">demo</strong> under <span class="No-Break"><strong class="bold">Reference name</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer100">
<img alt="Figure 3.30 – Adding a Download secure file task" height="742" src="image/B18875_03_30.jpg" width="1238"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.30 – Adding a Download secure file task</p>
<ol>
<li value="7">Click<a id="_idIndexMarker161"/> on the <strong class="bold">Command line</strong> task and enter the relevant information, <span class="No-Break">as follows:</span><ul><li><strong class="bold">Display name</strong>: <strong class="source-inline">Display Secure file &amp; </strong><span class="No-Break"><strong class="source-inline">Variables</strong></span></li><li><span class="No-Break"><strong class="bold">Script</strong></span><span class="No-Break">:</span><pre class="source-code">
echo $(demo.secureFilePath)
echo "=============="
echo $(Global.ServerName)</pre></li></ul><p class="list-inset">This can be seen in the <span class="No-Break">following screenshot:</span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer101">
<img alt="Figure 3.31 – Adding a Command line task" height="563" src="image/B18875_03_31.jpg" width="1348"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.31 – Adding a Command line task</p>
<ol>
<li value="8">Click<a id="_idIndexMarker162"/> on <strong class="bold">Agent job</strong>, then select the <span class="No-Break">following options:</span><ul><li><strong class="bold">Agent pool</strong>: <span class="No-Break"><strong class="bold">Azure Pipelines</strong></span></li><li><strong class="bold">Agent </strong><span class="No-Break"><strong class="bold">Specification</strong></span><span class="No-Break">: </span><span class="No-Break"><strong class="bold">ubuntu-latest</strong></span></li></ul><p class="list-inset">Then <span class="No-Break">click </span><span class="No-Break"><strong class="bold">Save</strong></span><span class="No-Break">:</span></p></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer102">
<img alt="Figure 3.32 – Agent job properties." height="416" src="image/B18875_03_32.jpg" width="1093"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.32 – Agent job properties.</p>
<ol>
<li value="9">To create the release pipeline, navigate to <strong class="bold">Releases</strong> | <strong class="bold">PacktAzureDevOps-CD</strong> | <strong class="bold">Releases</strong> | <strong class="bold">Create </strong><span class="No-Break"><strong class="bold">a release</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer103">
<img alt="Figure 3.33 – Create a release" height="484" src="image/B18875_03_33.jpg" width="1235"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.33 – Create a release</p>
<ol>
<li value="10">You <a id="_idIndexMarker163"/>can retain the default values. You can also enter information to describe the purpose of the release pipeline in the <strong class="bold">Release description</strong> box and <span class="No-Break">click </span><span class="No-Break"><strong class="bold">Create</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer104">
<img alt="Figure 3.34 – Confirming the creation of a release pipeline" height="740" src="image/B18875_03_34.jpg" width="882"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.34 – Confirming the creation of a release pipeline</p>
<p class="list-inset">The default <a id="_idIndexMarker164"/>values in the preceding screenshot have different meanings; let’s break <span class="No-Break">them down:</span></p>
<ul>
<li>Stages with an automated trigger will start as soon as the release is created. With this option, you can stop the stage from starting when the release is created and then start it manually from <span class="No-Break">the portal.</span></li>
<li>For <strong class="bold">Artifacts</strong>, the latest version available when creating the release will be the default option that’s selected. This option gives you the chance to select any other version available, such as in the scenario where you want to perform a rollback by deploying a previous version of <span class="No-Break">the artifact.</span></li>
</ul>
<ol>
<li value="11">You can now see the progress of running the <span class="No-Break">release pipeline:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer105">
<img alt="Figure 3.35 – Building a release" height="269" src="image/B18875_03_35.jpg" width="1162"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.35 – Building a release</p>
<ol>
<li value="12">You<a id="_idIndexMarker165"/> can also view the task list by clicking <strong class="bold">Display Secure file &amp; </strong><span class="No-Break"><strong class="bold">Variables</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer106">
<img alt="Figure 3.36 – Viewing the release results" height="398" src="image/B18875_03_36.jpg" width="1080"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.36 – Viewing the release results</p>
<p class="list-inset">The task results will be shown <span class="No-Break">as follows:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer107">
<img alt="Figure 3.37 – Command line task results" height="490" src="image/B18875_03_37.jpg" width="1499"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.37 – Command line task results</p>
<p>With that, you<a id="_idIndexMarker166"/> have learned how to create a release pipeline, including a secure file and a variable group library. You can apply this pattern to any pipeline when <span class="No-Break">creating one.</span></p>
<h1 id="_idParaDest-51"><a id="_idTextAnchor051"/>Summary</h1>
<p>This chapter taught you how to create a release pipeline with variable group libraries and upload and manage a secret file. These components not only enhance the organization and security of your pipelines but also provide a foundation for efficient, <span class="No-Break">consistent deployments.</span></p>
<p>Understanding how to create them will help you orchestrate streamlined, effective interactions between your Azure DevOps pipeline and the Azure ecosystem, a valuable skill for any Azure-powered <span class="No-Break">development project.</span></p>
<p>In the next chapter, you will learn how to customize a build pipeline using YAML and run it on the agent. This YAML will create an advanced build pipeline rather than creating it on the Azure portal and is where you can create parameters for a <span class="No-Break">build pipeline.</span></p>
</div>
</div></body></html>