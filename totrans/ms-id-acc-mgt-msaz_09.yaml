- en: Deploying Solutions on Azure AD and ADFS
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在Azure AD和ADFS上部署解决方案
- en: What's better than using theory directly in a practical lab activity? Nothing,
    in our eyes. Working through [Chapter 6](1f239a9c-c62a-4e40-ab58-ce78cd87e8be.xhtml), *Managing
    Authentication Protocols,* you learned about the different authentication methods
    used in current environments. Now, we'll start to use this knowledge to deploy
    several scenarios to our **Azure AD** and **Active Directory Federation Services **(**ADFS**).
    We will help you to understand all the configuration steps for required a suitable
    authentication environment.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 有什么比直接将理论应用于实践实验活动更好的方法吗？在我们看来，没有。通过学习[第6章](1f239a9c-c62a-4e40-ab58-ce78cd87e8be.xhtml)，*管理身份验证协议*，你了解了当前环境中使用的不同身份验证方法。现在，我们将开始使用这些知识将多个场景部署到我们的**Azure
    AD**和**Active Directory Federation Services**（**ADFS**）中。我们将帮助你理解所有配置步骤，以便为你提供一个合适的身份验证环境。
- en: 'In this chapter, you will extend your current lab environment, install and
    configure the service we connect, and configure your authentication solution to
    handle different methods. We use this approach so that you can understand all
    the stuff from scratch. We highly recommend that you read [Chapter 6](1f239a9c-c62a-4e40-ab58-ce78cd87e8be.xhtml), *Managing
    Authentication Protocols*, before you run through this chapter, which will cover
    the following topics:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你将扩展你当前的实验环境，安装并配置我们要连接的服务，并配置你的身份验证解决方案以处理不同的方法。我们使用这种方法是为了让你从零开始理解所有内容。我们强烈建议在运行本章之前先阅读[第6章](1f239a9c-c62a-4e40-ab58-ce78cd87e8be.xhtml)，*管理身份验证协议*，它将涵盖以下主题：
- en: Basic environment installation and configuration
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基本环境安装与配置
- en: Azure AD authentication deployments
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure AD身份验证部署
- en: ADFS authentication deployments
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ADFS身份验证部署
- en: Integrating Azure MFA into ADFS
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将Azure MFA集成到ADFS中
- en: Are you ready to go? Yes! We'll start by preparing our environment.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 你准备好开始了吗？是的！我们将从准备我们的环境开始。
- en: Basic environment installation and configuration
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 基本环境安装与配置
- en: 'In this chapter, we start to extend our actual simulated on-premises infrastructure
    with the additional servers we need in order to demonstrate and configure different
    capabilities. In the following diagram, we introduce the complete environment
    we''ll have configured after working through all the labs in the book:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们开始扩展我们当前的模拟本地基础设施，添加所需的额外服务器，以展示和配置不同的功能。在下图中，我们展示了在完成书中所有实验后，我们将配置的完整环境：
- en: '![](img/8e724686-e24b-4fc7-a384-c4efe9e8f4da.png)'
  id: totrans-10
  prefs: []
  type: TYPE_IMG
  zh: '![](img/8e724686-e24b-4fc7-a384-c4efe9e8f4da.png)'
- en: Lab environment overview
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 实验环境概述
- en: In this chapter, we will add `YD1APP01` and `YD1URA01` to our environment. `YourDomain1`
    (`YD1`) is used to identify the machine in the correct domain. In our case, we
    used `INODEMOAPP01` as an example. You need to provision the machines with the
    previous values.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将向环境中添加`YD1APP01`和`YD1URA01`。`YourDomain1`（`YD1`）用于标识机器所在的正确域。在我们的例子中，我们使用了`INODEMOAPP01`。你需要根据之前的值来配置这些机器。
- en: You already deployed the `YDADS01` domain controller in [Chapter 2](c0918163-6616-4bdb-aa82-4a65f578d268.xhtml), *Understanding
    Identity Synchronization*. For all future virtual servers, use the same **Azure
    subscription**, the same **resource group**, and the same **virtual network**.
    Join the virtual machines to your existing Active Directory. For the domain controller
    installation, we used `inovitlabs.ch` as an example. In the following chapters,
    we will use similar DNS suffixes. To be clear, we use `inovitdemos.ch` as a continuous
    representation of `inovitlabs.ch` and we will add `azureid.ch` and `leano.ch` for
    the different scenarios.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 你已经在[第2章](c0918163-6616-4bdb-aa82-4a65f578d268.xhtml)，*理解身份同步*中部署了`YDADS01`域控制器。对于所有未来的虚拟服务器，请使用相同的**Azure订阅**、相同的**资源组**以及相同的**虚拟网络**。将虚拟机加入到现有的Active
    Directory中。对于域控制器的安装，我们使用了`inovitlabs.ch`作为示例。在接下来的章节中，我们将使用类似的DNS后缀。为了明确起见，我们使用`inovitdemos.ch`作为`inovitlabs.ch`的延续表示，并将为不同场景添加`azureid.ch`和`leano.ch`。
- en: '`azureid.ch` will be used for the second domain we use without any cloud integration.'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: '`azureid.ch`将用于我们使用的第二个域，且不进行任何云集成。'
- en: '`leano.ch` will be used as a cloud-only environment for business to business
    communication.'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: '`leano.ch`将作为一个仅云环境，用于企业对企业的通信。'
- en: You can use the names you prefer.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用你喜欢的名称。
- en: 'For a better understanding, we show one example for an additional virtual machine,
    and you should run into the following result if you have provisioned all virtual
    machines by the end of the book:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 为了更好地理解，我们展示了一个额外虚拟机的例子，如果你在书的结尾时已经配置了所有虚拟机，你应该得到以下结果：
- en: '![](img/0d5e9c9f-0751-499f-b50d-01c9bd7f9564.png)'
  id: totrans-18
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0d5e9c9f-0751-499f-b50d-01c9bd7f9564.png)'
- en: Virtual machine overview
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟机概述
- en: 'For INODEMOSAPP01 (`YDAPP01`), we use a Standard B4ms (4 VCPUs, 16 GB memory)
    virtual machine with Windows Server 2019\. This virtual machine will be the host
    for running an SQL Server instance, most of our demo apps, and Visual Studio.
    For this reason, we use such a big machine type:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 INODEMOSAPP01（`YDAPP01`），我们使用的是一台标准 B4ms（4 VCPUs，16 GB 内存）虚拟机，运行 Windows
    Server 2019。这台虚拟机会作为 SQL Server 实例的宿主，承载我们大多数的演示应用程序和 Visual Studio。因此，我们使用这样一台较大的机器：
- en: Always use the same resource group
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 始终使用相同的资源组
- en: Always use the same subscription
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 始终使用相同的订阅
- en: Use the size from the previous screenshot (recommended)
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用之前截图中的大小（推荐）
- en: Always use the same virtual network
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 始终使用相同的虚拟网络
- en: Always configure a DNS name for a virtual machine
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 始终为虚拟机配置 DNS 名称
- en: 'You can use the Connect button to download the RDP-connection file:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用“连接”按钮下载 RDP 连接文件：
- en: '![](img/19b96f9c-0759-4ad7-9da5-62422ab9d062.png)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
  zh: '![](img/19b96f9c-0759-4ad7-9da5-62422ab9d062.png)'
- en: VM configuration options
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟机配置选项
- en: 'To make the labs as easy as we can, we define for every machine an RDP inbound
    rule at creation time, and configure a static internal IP address for the virtual
    machine:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 为了让实验尽可能简便，我们为每台虚拟机在创建时定义了 RDP 入站规则，并为虚拟机配置了静态内部 IP 地址：
- en: '![](img/b3477c0c-1950-41aa-81e7-b84fc712c813.png)'
  id: totrans-30
  prefs: []
  type: TYPE_IMG
  zh: '![](img/b3477c0c-1950-41aa-81e7-b84fc712c813.png)'
- en: Firewall configuration
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 防火墙配置
- en: 'If you click on Network Interface, you can configure the static IP:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你点击网络接口，你可以配置静态 IP：
- en: '![](img/1a144a3e-14f6-4d45-a378-ee297d2d2df5.png)'
  id: totrans-33
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1a144a3e-14f6-4d45-a378-ee297d2d2df5.png)'
- en: Static IP configuration
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 静态 IP 配置
- en: 'Next, we need to click on the virtual network to configure our `YDADS01` domain
    controller as the primary DNS server:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们需要点击虚拟网络，配置我们的`YDADS01`域控制器为主要 DNS 服务器：
- en: '![](img/b39aaf18-ed38-4ff1-94e4-7e750b8e110e.png)'
  id: totrans-36
  prefs: []
  type: TYPE_IMG
  zh: '![](img/b39aaf18-ed38-4ff1-94e4-7e750b8e110e.png)'
- en: Custom DNS configuration
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 自定义 DNS 配置
- en: Now we are ready to go, and you can follow the same steps for any additional
    virtual machines. We also provide a scripting solution in the code package of
    the book.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经准备好，你可以按照相同的步骤为任何额外的虚拟机进行配置。我们还在书中的代码包中提供了脚本解决方案。
- en: This configuration is just for lab and demonstration purposes, and not for a
    production environment. We highly recommend that you do the same on your already
    provisioned domain controller configuration.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 此配置仅用于实验和演示目的，不适用于生产环境。我们强烈建议你在已配置的域控制器上进行相同的配置。
- en: 'For this chapter, and specifically the `YD1URA01` virtual machine, we need
    to configure two additional inbound port rules to provide external access to our
    `Web Application Proxy`. We need to open port 80 TCP (HTTP) and 443 TCP (HTTPS).
    The expected configuration should look like the following:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 对于本章，特别是 `YD1URA01` 虚拟机，我们需要配置两个额外的入站端口规则，以便提供外部访问我们的 `Web 应用程序代理`。我们需要打开端口
    80 TCP（HTTP）和端口 443 TCP（HTTPS）。预期的配置应如下所示：
- en: '![](img/1d757751-0725-4b25-abe9-2f714aed5aae.png)'
  id: totrans-41
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1d757751-0725-4b25-abe9-2f714aed5aae.png)'
- en: Firewall configuration
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 防火墙配置
- en: Now that we have discussed the virtual machine setup, you should deploy the
    `YD1APP01` and `YD1URA01` servers to run the following labs in this chapter.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经讨论了虚拟机的设置，你应该部署`YD1APP01`和`YD1URA01`服务器，以运行本章中的以下实验。
- en: Create the certificate for your environment with let's encrypt
  id: totrans-44
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 Let's Encrypt 为你的环境创建证书
- en: To provide a valid certificate for our tasks, we need to install the `Posh-ACME`
    PowerShell module to use let's encrypt as our certificate provider. The certificates
    are valid for three months, without any cost. If you want to use your environment
    for longer, you just need to renew the certificate.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 为了为我们的任务提供有效的证书，我们需要安装`Posh-ACME` PowerShell 模块，使用 Let's Encrypt 作为我们的证书提供商。证书有效期为三个月，且无任何费用。如果你想在更长的时间内使用你的环境，只需续期证书即可。
- en: Find the module description and further information at the following source: [https://docs.microsoft.com/en-us/office365/enterprise/base-configuration-dev-test-environment](https://docs.microsoft.com/en-us/office365/enterprise/base-configuration-dev-test-environment)[ ](https://docs.microsoft.com/en-us/office365/enterprise/base-configuration-dev-test-environment)
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下来源中查找模块描述和更多信息：[https://docs.microsoft.com/en-us/office365/enterprise/base-configuration-dev-test-environment](https://docs.microsoft.com/en-us/office365/enterprise/base-configuration-dev-test-environment)
- en: 'With the following command, you install the module:'
  id: totrans-47
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令安装模块：
- en: '[PRE0]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'After installing the PowerShell module, we can request our certificate (replace
    the DNS suffix with your value):'
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装PowerShell模块后，我们可以请求证书（将DNS后缀替换为您的值）：
- en: '[PRE1]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'You will get a message that you need to create the `TXT` entries in your public
    DNS server required for the domain verification process:'
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您将收到一条消息，提示您需要在公共DNS服务器中创建`TXT`条目，以便完成域验证过程：
- en: '![](img/f4c8739c-4aec-47db-a9a7-f495b63d1a2b.png)'
  id: totrans-52
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f4c8739c-4aec-47db-a9a7-f495b63d1a2b.png)'
- en: Let's encrypt verification entries
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: Let's Encrypt验证条目
- en: 'Create the values in your public DNS like in the following example:'
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照以下示例，在您的公共DNS中创建值：
- en: '[PRE2]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Keep in mind that it requires some time for the values to become active. After
    creating the entries, you can press any key to continue.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住，激活这些值需要一些时间。创建条目后，您可以按任意键继续。
- en: 'After a successful validation, you''ll get a message that you can remove the
    values from your public DNS:'
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 验证成功后，您将收到一条消息，提示您可以从公共DNS中删除这些值：
- en: '![](img/a5700560-539d-40a8-90b8-7ed43f2d1c6e.png)'
  id: totrans-58
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a5700560-539d-40a8-90b8-7ed43f2d1c6e.png)'
- en: Removal note for Let's encrypt verification option
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: Let's Encrypt验证选项的移除说明
- en: 'Your new certificate is created:'
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您的新证书已创建：
- en: '![](img/99920670-2412-4eb6-b889-221fb22f30bf.png)'
  id: totrans-61
  prefs: []
  type: TYPE_IMG
  zh: '![](img/99920670-2412-4eb6-b889-221fb22f30bf.png)'
- en: Newly created certificate information
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 新创建的证书信息
- en: 'Now, we need to find and import the certificate on every server in our environment.
    Use the following cmdlet:'
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们需要在环境中的每台服务器上查找并导入证书。使用以下cmdlet：
- en: '[PRE3]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'The output of the preceding command is as follows:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 上述命令的输出如下：
- en: '![](img/94fb89b8-ad74-4639-9bc1-f7c86ed03b29.png)'
  id: totrans-66
  prefs: []
  type: TYPE_IMG
  zh: '![](img/94fb89b8-ad74-4639-9bc1-f7c86ed03b29.png)'
- en: Certificate information
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 证书信息
- en: Just type `.\cert.pfx` and hit *Enter,* and then follow the import wizard.
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 只需键入`.\cert.pfx`并按*Enter*，然后按照导入向导进行操作。
- en: 'Choose Local Machine for the storage location:'
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择“本地计算机”作为存储位置：
- en: '![](img/4aef7c60-f41d-4d3f-8c19-49b2a8b74604.png)'
  id: totrans-70
  prefs: []
  type: TYPE_IMG
  zh: '![](img/4aef7c60-f41d-4d3f-8c19-49b2a8b74604.png)'
- en: Certificate Import Wizard
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 证书导入向导
- en: 'The default password used from the PowerShell module to protect the `PFX` file
    is `poshacme`. Choose Mark key as exportable only if you want to export the file
    with your own password to use it on other servers:'
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: PowerShell模块默认使用的密码来保护`PFX`文件是`poshacme`。仅当您希望导出文件并使用自己的密码在其他服务器上使用时，才选择将密钥标记为可导出：
- en: '![](img/8708ee63-50c6-49fa-bab9-6a39a33583dc.png)'
  id: totrans-73
  prefs: []
  type: TYPE_IMG
  zh: '![](img/8708ee63-50c6-49fa-bab9-6a39a33583dc.png)'
- en: Certificate import options
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 证书导入选项
- en: 'Now, open the certificate management console for the local machine store with
    the `certlm.msc` command and you are able to verify the installed Certificate:'
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，使用`certlm.msc`命令打开本地计算机存储的证书管理控制台，您可以验证已安装的证书：
- en: '![](img/70dc1696-dc19-4869-a68c-43b2431d5e9f.png)'
  id: totrans-76
  prefs: []
  type: TYPE_IMG
  zh: '![](img/70dc1696-dc19-4869-a68c-43b2431d5e9f.png)'
- en: Certificate store and Subject Alternative Names
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 证书存储和主题备用名称
- en: We don't show this procedure in every following chapter, so be aware that you
    always install the certificate on a new server in your environment.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不会在接下来的每一章中展示此过程，因此请注意，每次在您的环境中新服务器上安装证书时都需要执行此步骤。
- en: Now that we have finished all the preparation tasks, we can install `ADFS` and
    the `Web Application Proxy` for our demo application installations.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经完成了所有准备工作，可以为我们的演示应用程序安装`ADFS`和`Web Application Proxy`。
- en: Installing the ADFS farm on YDADS01
  id: totrans-80
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在YDADS01上安装`ADFS`农场
- en: In our environment, we will install the `ADFS` farm on our domain controller.
    In production, this is not always the recommended option, but for cost saving,
    we'll use this option. Let's start!
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的环境中，我们将在域控制器上安装`ADFS`农场。在生产环境中，这通常不是推荐的选项，但为了节省成本，我们将选择这个选项。让我们开始吧！
- en: 'Create the internal DNS entry for the `ADFS` farm:'
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为`ADFS`农场创建内部DNS条目：
- en: '[PRE4]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Create the internal DNS entries for the demo applications:'
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为演示应用程序创建内部DNS条目：
- en: '[PRE5]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Create the `ADFS` **group managed service account** (**gMSA**):'
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建`ADFS` **组托管服务账户**（**gMSA**）：
- en: '[PRE6]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Install the `ADFS` farm:'
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装`ADFS`农场：
- en: '[PRE7]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Enable `IdP Initiated Signon Page`:'
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启用`IdP Initiated Signon Page`：
- en: '[PRE8]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Check your `ADFS` infrastructure installation, opening the provided links in
    your browser:'
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查您的`ADFS`基础架构安装，通过在浏览器中打开提供的链接：
- en: '[PRE9]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Now, we connect `ADFS` to our Azure AD and change to a federated environment.
    We use the `SupportMultipleDomain` options to be ready for later demonstrations,
    where we integrate a second domain suffix and an additional Active Directory forest:'
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们将`ADFS`连接到我们的Azure AD并切换到联合环境。我们使用`SupportMultipleDomain`选项，为后续演示做准备，其中我们将集成第二个域后缀和额外的Active
    Directory林：
- en: '[PRE10]'
  id: totrans-95
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Next, we install and configure the `Web Application Proxy`.
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们安装并配置`Web应用程序代理`。
- en: Installing the Web Application Proxy on YD1URA01
  id: totrans-97
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在YD1URA01上安装Web应用程序代理
- en: 'We will install the `Web Application Proxy` on `YD1URA01` to provide external
    access to our `ADFS` infrastructure by following these steps:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在`YD1URA01`上安装`Web应用程序代理`，通过以下步骤为我们的`ADFS`基础架构提供外部访问：
- en: 'Open an evaluated PowerShell instance and use the following commands:'
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开一个评估版PowerShell实例，并使用以下命令：
- en: '[PRE11]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Next, we will publish Active Directory `Federation Services` with the `Web
    Application Proxy`:'
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们将通过`Web应用程序代理`发布Active Directory `Federation Services`：
- en: '[PRE12]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Now, we need to create the entries in the public DNS for `ADFS` and the demo
    applications, where you need to use your DNS server names:'
  id: totrans-103
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们需要在公共DNS中为`ADFS`和演示应用程序创建条目，在此过程中需要使用您的DNS服务器名称：
- en: '[PRE13]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Next, we will test the external `ADFS` functionality.
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们将测试外部`ADFS`功能。
- en: Use your administrative virtual machine or any other external client, open [https://login.inovitdemos.ch/adfs/ls/idpinitiatedsignon.aspx](https://login.inovitdemos.ch/adfs/ls/idpinitiatedsignon.aspx) in
    a browser, and log in with one of your test users.
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用您的管理虚拟机或任何其他外部客户端，在浏览器中打开[https://login.inovitdemos.ch/adfs/ls/idpinitiatedsignon.aspx](https://login.inovitdemos.ch/adfs/ls/idpinitiatedsignon.aspx)，并使用您的测试用户之一登录。
- en: Now, we have a working `ADFS` and `Web Application Proxy` infrastructure. The
    only missing actors are the demo applications that we will implement now on the
    `YD1APP01` server and subscribe to several cloud services.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们有一个正常运行的`ADFS`和`Web应用程序代理`基础架构。唯一缺少的角色是我们将在`YD1APP01`服务器上实现的演示应用程序，并订阅多个云服务。
- en: Installing demo applications on (YD1APP01) for ADFS
  id: totrans-108
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在(YD1APP01)上为ADFS安装演示应用程序
- en: For our tasks in this and later chapters, we need to install a SQL Server and
    Management Tools instance on the server.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 对于本章及后续章节中的任务，我们需要在服务器上安装SQL Server和管理工具实例。
- en: 'The following software needs to also be installed on the server:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 服务器上还需要安装以下软件：
- en: 'Visual Studio ([https://bit.ly/2NzB14g](https://bit.ly/2NzB14g)) with the following
    options:'
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Visual Studio ([https://bit.ly/2NzB14g](https://bit.ly/2NzB14g))，并选择以下选项：
- en: '![](img/7ced695a-3e78-4023-9d45-f055d7d665dc.png)'
  id: totrans-112
  prefs: []
  type: TYPE_IMG
  zh: '![](img/7ced695a-3e78-4023-9d45-f055d7d665dc.png)'
- en: Visual Studio package installation options
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: Visual Studio包安装选项
- en: Visual Studio Code ([https://code.visualstudio.com/](https://code.visualstudio.com/))
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Visual Studio Code ([https://code.visualstudio.com/](https://code.visualstudio.com/))
- en: 'Next, we start with the **Internet Information Service** (**IIS**) base installation:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们从**Internet信息服务**（**IIS**）的基本安装开始：
- en: 'Install IIS:'
  id: totrans-116
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装IIS：
- en: '[PRE14]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Now, we install the SQL instance. Create the SQL organizational unit in your
    Active Directory:'
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们安装SQL实例。在您的Active Directory中创建SQL组织单位：
- en: '[PRE15]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Create the service accounts:'
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建服务账户：
- en: '[PRE16]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Next, we can do a standard installation of SQL Server 2017 (Trial Edition: [https://bit.ly/2FoSE6z](https://bit.ly/2FoSE6z)
    ) with a default instance. You can follow the guidance at [https://bit.ly/2lKJ9mi](https://bit.ly/2FoSE6z)
    to install the service.
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们可以进行SQL Server 2017（试用版：[https://bit.ly/2FoSE6z](https://bit.ly/2FoSE6z)
    ）的标准安装，使用默认实例。您可以根据[https://bit.ly/2lKJ9mi](https://bit.ly/2FoSE6z)的指南进行安装。
- en: 'Just use the following parameters to install:'
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 只需使用以下参数进行安装：
- en: In general, use the default settings
  id: totrans-124
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一般情况下，使用默认设置
- en: Add just the database engine and the Full-Text Index as features
  id: totrans-125
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 只添加数据库引擎和全文索引作为功能
- en: Add the current user as administrator
  id: totrans-126
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将当前用户添加为管理员
- en: Use the service accounts for the database engine and the SQL Agent; choose the
    start type to be automatic
  id: totrans-127
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用服务账户来管理数据库引擎和SQL代理；选择启动类型为自动
- en: Download and install SQL Management Studio
  id: totrans-128
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 下载并安装SQL管理工作室
- en: 'After the installation, you should be able to connect to the new SQL instance
    with SQL Management Studio:'
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装完成后，您应该能够使用SQL管理工作室连接到新的SQL实例：
- en: '![](img/0fca3397-1c5d-4889-9aeb-94834713f186.png)'
  id: totrans-130
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0fca3397-1c5d-4889-9aeb-94834713f186.png)'
- en: Connecting to the SQL instance with SQL Management Studio
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 使用SQL管理工作室连接到SQL实例
- en: We use the test site from the Microsoft blog at [https://bit.ly/2QDIqQN](https://bit.ly/2QDIqQN)
    (credit: Emmanuel Boersma), to demonstrate the different authentication methods.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用来自微软博客的测试网站[https://bit.ly/2QDIqQN](https://bit.ly/2QDIqQN)（致谢：Emmanuel
    Boersma）来演示不同的身份验证方法。
- en: Configure the authentication demo apps.
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置认证演示应用。
- en: 'You need to change the bold values to create all demo apps with the following
    values:'
  id: totrans-134
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 你需要更改加粗的值，以便使用以下值创建所有演示应用：
- en: '`basic`'
  id: totrans-135
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`basic`'
- en: '`kerberos`'
  id: totrans-136
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`kerberos`'
- en: '`ntlm`'
  id: totrans-137
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ntlm`'
- en: 'Use the following script:'
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下脚本：
- en: '[PRE17]'
  id: totrans-139
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Next, will add an HTTPS binding to every demo app:'
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，为每个演示应用添加HTTPS绑定：
- en: '![](img/3b02d728-d2da-414a-a5f8-7c66d186d7a4.png)'
  id: totrans-141
  prefs: []
  type: TYPE_IMG
  zh: '![](img/3b02d728-d2da-414a-a5f8-7c66d186d7a4.png)'
- en: IIS demo app configuration overview
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: IIS演示应用配置概览
- en: Do this for every app!
  id: totrans-143
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为每个应用执行此操作！
- en: '![](img/f3ab3d38-2acc-4f33-9182-ea545b9edfd8.png)'
  id: totrans-144
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f3ab3d38-2acc-4f33-9182-ea545b9edfd8.png)'
- en: IIS binding configuration
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 配置IIS绑定
- en: Now, we need to work on some extra tasks for the applications.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们需要处理一些额外的任务。
- en: 'We start with the claims app:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 我们从Claims应用开始：
- en: 'Use the claims demo app package from the code package and execute the script
    (change it to your values before execution):'
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用代码包中的claims演示应用程序包，并执行脚本（执行前请修改为你的值）：
- en: '[PRE18]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Connect the HTTPS binding of the claims demo app to your certificate.
  id: totrans-150
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将claims演示应用的HTTPS绑定到你的证书。
- en: 'Let''s do the tasks for the `kerberos` app:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们来处理`kerberos`应用的任务：
- en: 'Create and configure a service account on`YD1ADS01` to run the application
    pool with the name `svckrbapp`, and with the password never expires option selected.
    Note the password so you can provide it in the following configurations:'
  id: totrans-152
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`YD1ADS01`上创建并配置一个服务账户来运行名为`svckrbapp`的应用程序池，并选择“密码永不过期”选项。记下密码，以便在接下来的配置中使用：
- en: '[PRE19]'
  id: totrans-153
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Next, we need to configure the correct Service Principal Name for the Kerberos
    Delegation scenario later:'
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们需要为Kerberos委派场景配置正确的服务主体名称（SPN）：
- en: '[PRE20]'
  id: totrans-155
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Configure the Kerberos delegation on your `YD1APP01` and `YD1URA01 `computer
    account (for external access) with the `svckrbapp` user account:'
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置`YD1APP01`和`YD1URA01`计算机账户的Kerberos委派（用于外部访问），使用`svckrbapp`用户账户：
- en: '![](img/ff1fc34c-2871-41f1-82d7-4a2b80a7bbfe.png)'
  id: totrans-157
  prefs: []
  type: TYPE_IMG
  zh: '![](img/ff1fc34c-2871-41f1-82d7-4a2b80a7bbfe.png)'
- en: Kerberos Delegation configuration in AD
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 在AD中配置Kerberos委派
- en: Next, we need to jump to your `YD1APP01` server to configure the Kerberos application.
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们需要跳转到`YD1APP01`服务器，配置Kerberos应用。
- en: Under Application pools, click Add a new application pool.
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在应用程序池下，点击添加一个新的应用程序池。
- en: Name the pool Kerberos website and leave the other default values.
  id: totrans-161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将池命名为Kerberos网站，并保留其他默认值。
- en: Click Advanced Settings and change the identity to the `svckrbapp` account.
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击高级设置并将身份更改为`svckrbapp`账户。
- en: Click on the Kerberos website and click Advanced Settings.
  id: totrans-163
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击Kerberos网站并点击高级设置。
- en: 'Change the application pool to the newly created one: Kerberos website.'
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将应用程序池更改为新创建的池：Kerberos网站。
- en: Under IIS Authentication, enable Windows Authentication and disable Anonymous
    Authentication.
  id: totrans-165
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在IIS认证下，启用Windows身份验证并禁用匿名身份验证。
- en: Go to Windows Authentication | Advanced Settings | Clear Enable Kernel-mode.
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入Windows身份验证 | 高级设置 | 清除启用内核模式。
- en: Copy the content of the `authpage` folder from the code package to the Kerberos
    root directory at `C:\inetpub\kerbroot`.
  id: totrans-167
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`authpage`文件夹的内容从代码包复制到Kerberos根目录`C:\inetpub\kerbroot`。
- en: 'Next, we will configure the `ntlm` app:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将配置`ntlm`应用：
- en: Click on the NTLM website and click Advanced Settings
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击NTLM网站并点击高级设置
- en: Change the application pool to Kerberos website
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将应用程序池更改为Kerberos网站
- en: Under IIS Authentication, enable Windows Authentication and disable Anonymous
    Authentication
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在IIS认证下，启用Windows身份验证并禁用匿名身份验证
- en: Go to Windows Authentication | Advanced Settings | Clear Enable Kernel-mode
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入Windows身份验证 | 高级设置 | 清除启用内核模式
- en: Go to Windows Authentication | Advanced Settings | Providers and leave only
    NTLM
  id: totrans-173
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入Windows身份验证 | 高级设置 | 提供程序，只保留NTLM
- en: Copy the content of the `authpage `folder from the code package to the NTLM
    root directory at `C:\inetpub\ntlmroot`
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`authpage`文件夹的内容从代码包复制到NTLM根目录`C:\inetpub\ntlmroot`
- en: 'Next, we will configure the `basic` app:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将配置`basic`应用：
- en: Copy the content of the `authpage` folder from the code package to the basic
    root directory at `C:\inetpub\basicroot`
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`authpage`文件夹的内容从代码包复制到基本根目录`C:\inetpub\basicroot`
- en: In the IIS manager, go to the `basic` app and configure the authentication so
    that just the basic authentication is enabled
  id: totrans-177
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在IIS管理器中，进入`basic`应用并配置认证，使其仅启用基本身份验证
- en: Reboot your `YD1ADS01`, `YD1APP01`, and `YD1URA01` servers before we move on
    to the next steps.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 在继续执行下一步之前，重启你的`YD1ADS01`、`YD1APP01`和`YD1URA01`服务器。
- en: Now that we have finished the on-premises demo apps, we need to sign up for
    some cloud demo apps.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经完成了本地演示应用程序的配置，接下来需要注册一些云端演示应用程序。
- en: Subscribing to demo apps (Azure AD)
  id: totrans-180
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 订阅演示应用程序（Azure AD）
- en: 'To complete all the authentication and information protection labs, we need
    to register for the following cloud applications:'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 为了完成所有认证和信息保护实验，我们需要注册以下云应用程序：
- en: Sign up for a *salesforce developer account: [https://developer.salesforce.com/signup](https://developer.salesforce.com/signup)
  id: totrans-182
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 注册*Salesforce开发者账户：[https://developer.salesforce.com/signup](https://developer.salesforce.com/signup)
- en: Sign up for a service now developer account:[ ](https://bit.ly/2Ji2Ta9)[https://bit.ly/2FniUOC](https://bit.ly/2FniUOC)
  id: totrans-183
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 注册ServiceNow开发者账户：[https://bit.ly/2FniUOC](https://bit.ly/2FniUOC)
- en: Sign up for a business dropbox account trial: [https://bit.ly/1KYht6o](https://bit.ly/1KYht6o)
  id: totrans-184
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 注册Dropbox商务版试用账号：[https://bit.ly/1KYht6o](https://bit.ly/1KYht6o)
- en: Sign up for a LinkedIn account: [https://bit.ly/1k7JbKB](https://bit.ly/1k7JbKB)
  id: totrans-185
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 注册LinkedIn账号：[https://bit.ly/1k7JbKB](https://bit.ly/1k7JbKB)
- en: Sign up for a *Twitter account: [https://bit.ly/1k7JbKB](https://bit.ly/2Ji2Ta9)
  id: totrans-186
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 注册一个*Twitter账号：[https://bit.ly/1k7JbKB](https://bit.ly/2Ji2Ta9)
- en: Sign up for a Google account: [**https://bit.ly/2reCBP3**](https://bit.ly/2reCBP3)
  id: totrans-187
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 注册Google账号：[**https://bit.ly/2reCBP3**](https://bit.ly/2reCBP3)
- en: Sign up for a Okta developer account: [https://bit.ly/2IOw3ix](https://bit.ly/2IOw3ix)
  id: totrans-188
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 注册Okta开发者账户：[https://bit.ly/2IOw3ix](https://bit.ly/2IOw3ix)
- en: Sign up for a Proxyclick trial: [https://bit.ly/2D5BKqV](https://bit.ly/2D5BKqV)
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 注册Proxyclick试用账号：[https://bit.ly/2D5BKqV](https://bit.ly/2D5BKqV)
- en: The applications marked with * will be used in this chapter and the other one
    in the [Chapter 8](efbe1917-c755-4449-b29e-fa4a21e819fd.xhtml), *Using Azure AD
    App Proxy an**d Web Application Proxy* and the following.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 标记为*的应用程序将在本章中使用，另一些将在[第8章](efbe1917-c755-4449-b29e-fa4a21e819fd.xhtml)中使用，*使用Azure
    AD应用程序代理和Web应用程序代理*以及以下内容。
- en: After the successful trial or developer accounts, we can start with our journey
    through the capabilities of Azure AD and ADFS.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 成功试用或开发者账户后，我们可以开始探索Azure AD和ADFS的功能。
- en: Azure AD authentication deployments
  id: totrans-192
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure AD认证部署
- en: 'In this section, we will build applications for our users and work through
    the different authentication mechanisms provided by Azure AD. All the configurations
    we do in this section will be done with global administrator rights and on the
    Azure portal, [https://portal.azure.com](https://portal.azure.com). We will start
    with Salesforce configuration:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将为用户构建应用程序，并演示Azure AD提供的不同认证机制。我们在本节中进行的所有配置将使用全局管理员权限，并在Azure门户[https://portal.azure.com](https://portal.azure.com)上完成。我们将从Salesforce配置开始：
- en: Launch the Azure Active Directory blade and click Enterprise applications.
  id: totrans-194
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动Azure Active Directory面板并点击企业应用程序。
- en: 'Under All applications, click New application:'
  id: totrans-195
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在所有应用程序下，点击新建应用程序：
- en: '![](img/fd9fe36b-62e7-4d3b-b867-44228d1579b1.png)'
  id: totrans-196
  prefs: []
  type: TYPE_IMG
  zh: '![](img/fd9fe36b-62e7-4d3b-b867-44228d1579b1.png)'
- en: New application creation context
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 新建应用程序上下文
- en: 'Type `Salesforce` in the search field:'
  id: totrans-198
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在搜索框中输入`Salesforce`：
- en: '![](img/7cb4b682-19cb-4d96-91ff-fd16e362ad61.png)'
  id: totrans-199
  prefs: []
  type: TYPE_IMG
  zh: '![](img/7cb4b682-19cb-4d96-91ff-fd16e362ad61.png)'
- en: Salesforce enablement
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 启用Salesforce
- en: 'Under Single sing-on, change to SAML authentication:'
  id: totrans-201
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在单点登录下，切换到SAML认证：
- en: '![](img/bfce6ec2-038b-40c2-ac48-458c7b7841d8.png)'
  id: totrans-202
  prefs: []
  type: TYPE_IMG
  zh: '![](img/bfce6ec2-038b-40c2-ac48-458c7b7841d8.png)'
- en: Choosing SAML as the authentication method
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 选择SAML作为认证方法
- en: 'Go to the SAML Signing Certificate section and click Download on Certificate
    (RAW):'
  id: totrans-204
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到SAML签名证书部分并点击下载证书（原始）：
- en: '![](img/982902b6-7a23-4c18-8eaf-a5f80d5db248.png)'
  id: totrans-205
  prefs: []
  type: TYPE_IMG
  zh: '![](img/982902b6-7a23-4c18-8eaf-a5f80d5db248.png)'
- en: Downloading the signing certificate
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 下载签名证书
- en: Now, log in to your Salesforce account and navigate to Identity | Single Sign-On
    Settings.
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，登录到你的Salesforce账户并导航到身份 | 单点登录设置。
- en: 'Edit the SAML settings and click SAML Enabled:'
  id: totrans-208
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 编辑SAML设置并点击启用SAML：
- en: '![](img/0e51bf40-339c-4d68-b688-816db782af02.png)'
  id: totrans-209
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0e51bf40-339c-4d68-b688-816db782af02.png)'
- en: Configuration of SAML in Salesforce
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 在Salesforce中配置SAML
- en: 'Next, we will create new **SAML Single Sign-On Settings**; click New:'
  id: totrans-211
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们将创建新的**SAML单点登录设置**；点击新建：
- en: '![](img/01836c54-7d3f-4b8d-9877-371fd0eedcaf.png)'
  id: totrans-212
  prefs: []
  type: TYPE_IMG
  zh: '![](img/01836c54-7d3f-4b8d-9877-371fd0eedcaf.png)'
- en: New settings dialog
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 新设置对话框
- en: 'To gather the values for the configuration, you need to jump back to your Azure
    portal and copy the three links to Notepad:'
  id: totrans-214
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要收集配置所需的值，你需要返回Azure门户并将三个链接复制到记事本：
- en: '![](img/5b2d7853-6a22-462b-9710-c2528bfa4b35.png)'
  id: totrans-215
  prefs: []
  type: TYPE_IMG
- en: Salesforce configuration information about the Azure AD endpoints
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
- en: 'Fill in the following information on the Salesforce configuration page:'
  id: totrans-217
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/2545a68e-f69c-478a-b6f3-31bd7792c06b.png)'
  id: totrans-218
  prefs: []
  type: TYPE_IMG
- en: Salesforce SAML configuration page
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
- en: Next, we need to configure our Salesforce domain name under SETTINGS | Company
    Settings | My Domain.
  id: totrans-220
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Use your tenant name and click Check Availability and Register Domain:'
  id: totrans-221
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/961bb4ef-5314-4ade-b773-4ce12678854f.png)'
  id: totrans-222
  prefs: []
  type: TYPE_IMG
- en: Salesforce domain registration process
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
- en: The registration process takes about 5-10 minutes.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
- en: 'Refresh the page and Edit the Authentication Configuration:'
  id: totrans-225
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/70b65762-2947-4697-8fdc-cb99170ab5ec.png)'
  id: totrans-226
  prefs: []
  type: TYPE_IMG
- en: Authentication configuration dialog
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
- en: Click Open and Upload a logo from [Chapter 1](54c375d9-b7d0-4478-8777-33935239254b.xhtml), *Building
    and Managing Azure Active Directory*.
  id: totrans-228
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Check AzureADSSO and Save:'
  id: totrans-229
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/7a4c5ca8-0558-447e-9282-4bcce2a342f2.png)'
  id: totrans-230
  prefs: []
  type: TYPE_IMG
- en: Choosing the Authentication service AzureADSSO
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
- en: Click on login and if you are prompted to register your phone, click **I Don't
    want ...**.
  id: totrans-232
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If you are prompted, log in with your Salesforce administrator account.
  id: totrans-233
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Next, under the My Domain section, click Deploy to Users and OK.
  id: totrans-234
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now, we switch back to our **Azure AD** configuration.
  id: totrans-235
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Set the Sign on URL and Identifier (Entity ID) text box values to your value, `https://<TENANT>-dev-ed.my.salesforce.com`:'
  id: totrans-236
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/1be9d8fc-332d-46d7-9b08-49fc3053867b.png)'
  id: totrans-237
  prefs: []
  type: TYPE_IMG
- en: Azure AD Salesforce SAML configuration
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
- en: 'Now that we have configured SAML authentication, we can activate user provisioning
    with Salesforce by following these steps:'
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
- en: Under the Manage section, click Provisioning.
  id: totrans-240
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provisioning Mode drop-down list, set **Automatic.**
  id: totrans-241
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Under Admin Credentials, type in the admin username and password for accessing
    Salesforce.
  id: totrans-242
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Obtain a secret token by switching to the Salesforce administration:'
  id: totrans-243
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/9870154a-5792-4cb0-8aa0-104a2d66164d.png)'
  id: totrans-244
  prefs: []
  type: TYPE_IMG
- en: Secret token creation for provisioning
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
- en: 'Click Reset Security Token and you will receive a new security token by mail:'
  id: totrans-246
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/30eb22f3-1080-4697-affb-bf6e1f519501.png)'
  id: totrans-247
  prefs: []
  type: TYPE_IMG
- en: Get new secret token
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
- en: 'Next, we configure the provisioning settings in the Azure portal. Use the token
    from your mailbox and configure a notification email address:'
  id: totrans-249
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/49b26f6d-3c62-40e1-8c4c-3b4a960a8d99.png)'
  id: totrans-250
  prefs: []
  type: TYPE_IMG
- en: Configuring the provisioning service
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
- en: 'The following message is expected:'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/56994c23-9475-49a5-a68d-f67d11ed3fbe.png)'
  id: totrans-253
  prefs: []
  type: TYPE_IMG
- en: Test the connection to the Salesforce provisioning endpoint
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
- en: To use the newly deployed application, we need to create and assign a group
    to the Salesforce application.
  id: totrans-255
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Create the following group and assign a licensed user from the Sales department:'
  id: totrans-256
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/5d7c9f53-ff94-4725-bb85-7a820e2dfae0.png)'
  id: totrans-257
  prefs: []
  type: TYPE_IMG
- en: Group assignment for Salesforce app access
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
- en: 'Assign this group with the following values:'
  id: totrans-259
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/a5aec567-b0a4-44d0-a6fd-57ea8d3d6df8.png)'
  id: totrans-260
  prefs: []
  type: TYPE_IMG
- en: Role selection
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
- en: Under Manage | Provisioning | Settings, set Provisioning Status to On and leave
    the default Scope.
  id: totrans-262
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the checkbox for Clear current state and restart synchronization and click
    Save.
  id: totrans-263
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“清除当前状态并重新启动同步”复选框，然后点击“保存”。
- en: 'In the Restart Synchronization window, click Yes:'
  id: totrans-264
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在重新启动同步窗口中，点击“是”：
- en: '![](img/26722074-1765-4ce2-b22a-d533ffe53c4b.png)'
  id: totrans-265
  prefs: []
  type: TYPE_IMG
  zh: '![](img/26722074-1765-4ce2-b22a-d533ffe53c4b.png)'
- en: Synchronization and Provisioning status information
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 同步和配置状态信息
- en: Test the application with your assigned test user at [https://myapps.microsoft.com](https://myapps.microsoft.com).
  id: totrans-267
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用你分配的测试用户测试该应用程序，网址为[https://myapps.microsoft.com](https://myapps.microsoft.com)。
- en: 'The following result is expected, a successful logon:'
  id: totrans-268
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以下结果是预期的，即成功登录：
- en: '![](img/6399ab9a-e1ad-4b8a-80cc-a12f68db50bc.png)'
  id: totrans-269
  prefs: []
  type: TYPE_IMG
  zh: '![](img/6399ab9a-e1ad-4b8a-80cc-a12f68db50bc.png)'
- en: Successful logon on Salesforce with test user
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 成功以测试用户身份登录Salesforce
- en: We successfully deployed Salesforce, including SAML and provisioning capabilities,
    to our Azure AD.
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 我们成功将Salesforce部署到我们的Azure AD，包括SAML和配置功能。
- en: 'Now, we will use another feature in Azure AD with Twitter. For this, we use
    the password-based Sign-In option:'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们将使用Azure AD的另一个功能与Twitter配合使用。为此，我们使用基于密码的登录选项：
- en: 'First, we need to add the Twitter app from the application gallery. You already
    know the process from Salesforce:'
  id: totrans-273
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们需要从应用程序库中添加Twitter应用程序。你已经了解了从Salesforce中添加应用程序的过程：
- en: '![](img/8bfe76b4-cf37-45e6-aebd-5dd10370ce89.png)'
  id: totrans-274
  prefs: []
  type: TYPE_IMG
  zh: '![](img/8bfe76b4-cf37-45e6-aebd-5dd10370ce89.png)'
- en: Adding Twitter to app catalog
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 将Twitter添加到应用程序目录
- en: Next, we choose Password-based Single Sign-on mode from the Single Sign-On section.
  id: totrans-276
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们在单点登录部分选择基于密码的单点登录模式。
- en: 'The wizard automatically sets the correct URL to Twitter:'
  id: totrans-277
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向导会自动将正确的URL设置为Twitter：
- en: '![](img/2cdc097f-0b69-4b07-a52f-7d92aeb0afb6.png)'
  id: totrans-278
  prefs: []
  type: TYPE_IMG
  zh: '![](img/2cdc097f-0b69-4b07-a52f-7d92aeb0afb6.png)'
- en: Choosing password-based authentication option
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 选择基于密码的身份验证选项
- en: 'We assign the sales and marketing application access group to the application,
    and the provide the credentials we want to use and hide from the user:'
  id: totrans-280
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将销售和营销应用程序访问组分配给该应用程序，提供我们要使用的凭据并将其隐藏：
- en: '![](img/d2c9e299-cc85-4add-9715-c983d05880ff.png)'
  id: totrans-281
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d2c9e299-cc85-4add-9715-c983d05880ff.png)'
- en: Assigning the Twitter credentials to a group
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 将Twitter凭据分配给组
- en: 'You are also able to Update Credentials on the assigned groups:'
  id: totrans-283
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你还可以在分配的组上更新凭据：
- en: '![](img/01dd30fe-324b-4dee-a771-bd36487f8bac.png)'
  id: totrans-284
  prefs: []
  type: TYPE_IMG
  zh: '![](img/01dd30fe-324b-4dee-a771-bd36487f8bac.png)'
- en: Update credentials option
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 更新凭据选项
- en: Now that we have configured the Twitter app for our sales and marketing users,
    you can test the functionality with the user over at [https://myapps.microsoft.com](https://myapps.microsoft.com).
  id: totrans-286
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们已经为销售和营销用户配置了Twitter应用程序，你可以通过[https://myapps.microsoft.com](https://myapps.microsoft.com)与该用户一起测试功能。
- en: You should have a Single Sign-On experience.
  id: totrans-287
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你应该拥有单点登录体验。
- en: 'Some applications require access to the application''s access panel ([https://myapps.microsoft.com](https://myapps.microsoft.com)).
    In this case, the website requires a browser extension:'
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 一些应用程序需要访问应用程序的访问面板（[https://myapps.microsoft.com](https://myapps.microsoft.com)）。在这种情况下，网站需要一个浏览器扩展：
- en: To configure Microsoft Edge for the access panel extension, launch your browser
    and navigate to [https://myapps.microsoft.com](https://myapps.microsoft.com)
  id: totrans-289
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要为访问面板扩展配置Microsoft Edge，启动浏览器并导航到[https://myapps.microsoft.com](https://myapps.microsoft.com)
- en: Log in as a test user
  id: totrans-290
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以测试用户身份登录
- en: Click on Twitter
  id: totrans-291
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击Twitter
- en: Click Install Now
  id: totrans-292
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击立即安装
- en: Complete the installation wizard to install the My Apps Secure Sign-In Extension
  id: totrans-293
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成安装向导以安装“我的应用程序安全登录扩展”
- en: You get a new extension notification; click Turn it on
  id: totrans-294
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你会收到一个新的扩展通知；点击开启
- en: Relaunch the browser and navigate to [https://myapps.microsoft.com](https://myapps.microsoft.com)
  id: totrans-295
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重新启动浏览器并导航到[https://myapps.microsoft.com](https://myapps.microsoft.com)
- en: Log in as a test user
  id: totrans-296
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以测试用户身份登录
- en: This is our first impression of Azure AD's capabilities. We will dive deeper
    in the next [Chapter 8](efbe1917-c755-4449-b29e-fa4a21e819fd.xhtml), *Using Azure
    AD App Proxy and Web Application Proxy*, and now start to configure our first
    applications in our ADFS infrastructure.
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: 这是我们对Azure AD功能的第一印象。在下一章[第8章](efbe1917-c755-4449-b29e-fa4a21e819fd.xhtml)，*使用Azure
    AD应用代理和Web应用代理*中，我们将深入探讨，并开始在我们的ADFS基础设施中配置第一个应用程序。
- en: ADFS Authentication deployments
  id: totrans-298
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ADFS身份验证部署
- en: 'To configure a claims-based application with **WS-Federation**, we can use
    our claims demo application. With this application, you can test many features
    of ADFS with claims authentication and learn in a more practical way. Run the
    following configuration on your **YD1ADS01**. Later, we''ll configure the application
    to get more experience:'
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
- en: Go to Server Manager, click Tools, and open ADFS Management.
  id: totrans-300
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Expand Trust Relationships and select Relying Party Trusts.
  id: totrans-301
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select Actions, add Relying Party Trust, and click Start.
  id: totrans-302
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'In the box, type `https://claims.inovitdemos.ch`:'
  id: totrans-303
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/0109ea84-b78a-4b3a-b44e-5da0370efa22.png)'
  id: totrans-304
  prefs: []
  type: TYPE_IMG
- en: ADFS relying party trust configuration
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
- en: Click Next.
  id: totrans-306
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Type the display name as `claims Demo Web Site` and click Next.
  id: totrans-307
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select I do not want to configure multi-factor authentication settings for this relying
    party trust currently and click Next.
  id: totrans-308
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select Permit all users to access this relying party, and click Next | Next.
  id: totrans-309
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Clear the Open the Edit Claim Rules dialog box for this relying party trust when
    the wizard closes and click Close.
  id: totrans-310
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Verify the new app with Internet Explorer by typing `https://claims.inovitdemos.ch`:'
  id: totrans-311
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/3945262b-4ff7-41b6-995b-66350ba01f71.png)'
  id: totrans-312
  prefs: []
  type: TYPE_IMG
- en: Claims demo web site
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
- en: The installation script automatically puts the thumbprint of the `Token-Signing`
    certificate in the `web.config` file of the claims web application. If you renew
    the `Token-Signing` certificate, you need to update the thumbprint in the application
    configuration.
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
- en: 'You can gather the `Token-Signing` certificate from our ADFS instance with
    the following command:'
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE21]'
  id: totrans-316
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'The output of the preceding command will look as follows:'
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/16392d3a-4671-4c6f-92eb-50561f192987.png)'
  id: totrans-318
  prefs: []
  type: TYPE_IMG
- en: Get the Token-Signing certificate information
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
- en: 'Another good helper for several test scenarios such as SAML, WS-Federation,
    OAuth2, and the strong authentication methods is the **Claims X-Ray tool** from
    Microsoft, which you can find at [https://bit.ly/2EqoPOi](https://bit.ly/2EqoPOi),
    and it''s quite easy to configure by following these steps:'
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
- en: 'Open an evaluated PowerShell instance on your **YD1ADS01** and run the following
    script:'
  id: totrans-321
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE22]'
  id: totrans-322
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'To use OAuth2, we need to create the required OAuth client:'
  id: totrans-323
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE23]'
  id: totrans-324
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'You will get a WS-Federation Passive Endpoints and SAML Assertion Consumer
    Endpoint and OAuth2 configured:'
  id: totrans-325
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/c274f4e7-132c-4788-856f-f86934c44e04.png)'
  id: totrans-326
  prefs: []
  type: TYPE_IMG
- en: Open a browser and test the basic capabilities with one of your test users on
    the following page: [https://login.inovitdemos.ch/adfs/ls/IdpInitiatedSignon.aspx](https://login.inovitdemos.ch/adfs/ls/IdpInitiatedSignon.aspx).
  id: totrans-327
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Choose ClaimsXRay, log in, and see your token response:'
  id: totrans-328
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/985b533f-1746-41f4-98b2-18d7a83a00a8.png)'
  id: totrans-329
  prefs: []
  type: TYPE_IMG
- en: Get your claim information
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
- en: Now that we have our first helper applications in place, we can start playing
    around with them. You are already able to view two sample implementations with
    WS-Federation, SAML, and OAuth.
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
- en: 'With the Claims X-Ray application, we can run several tests against our ADFS
    instance. For this, we use source at [https://bit.ly/2EqoPOi](https://bit.ly/2EqoPOi):'
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s test our OAuth configuration with the following settings:'
  id: totrans-333
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/8cce6977-847e-479b-a9c8-6936af9aa687.png)'
  id: totrans-334
  prefs: []
  type: TYPE_IMG
- en: Testing the OAuth configuration with the Claims X-Ray tool
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
- en: 'Now, you can analyze your response and you will see that you already work with
    OAuth2:'
  id: totrans-336
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/4b60a275-a90c-4372-ac06-f9d25a003309.png)'
  id: totrans-337
  prefs: []
  type: TYPE_IMG
- en: View the response
  id: totrans-338
  prefs: []
  type: TYPE_NORMAL
- en: 'What about if you want to translate a **SAML Token** into a **Kerberos** one:'
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
- en: 'You can work with the Non claims aware option in `ADFS`, which appears if you
    add a new Relying Party:'
  id: totrans-340
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/486ea529-d160-4a3a-b71d-8ccbdf0fe7a3.png)'
  id: totrans-341
  prefs: []
  type: TYPE_IMG
- en: Adding the Kerberos example app
  id: totrans-342
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s try this with our Kerberos example application:'
  id: totrans-343
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/c0372bd0-76ce-4273-8e4a-d81b7c0c8b34.png)'
  id: totrans-344
  prefs: []
  type: TYPE_IMG
- en: Providing a Display Name
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
- en: 'Click Next and enter [https://kerb.inovitdemos.ch](https://kerb.inovitdemos.ch) in Relying
    party trust identifier:'
  id: totrans-346
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/6ec6d2d3-12e0-40c1-bcc6-ce5ac33d6e54.png)'
  id: totrans-347
  prefs: []
  type: TYPE_IMG
- en: Configuring the identifier
  id: totrans-348
  prefs: []
  type: TYPE_NORMAL
- en: Click Next in the Access Control Policy section and next again until the relying
    party is added.
  id: totrans-349
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: To test the application, we need to configure the Web Application Proxy to publish
    the app externally.
  id: totrans-350
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Log in to **YD1URA01** and publish the **Kerberos application** over at the
    Remote Access Management console:'
  id: totrans-351
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/85793156-3867-4478-9000-2e790fc1efee.png)'
  id: totrans-352
  prefs: []
  type: TYPE_IMG
- en: Publishing the Kerberos app with the Web Application Proxy
  id: totrans-353
  prefs: []
  type: TYPE_NORMAL
- en: Click Next and choose the Web and MSOFBA option.
  id: totrans-354
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Next, choose `Kerberos Demo Web Site` and configure the following settings:'
  id: totrans-355
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/55ad9956-01a0-4c28-9275-1732f5582b32.png)'
  id: totrans-356
  prefs: []
  type: TYPE_IMG
- en: Providing the external/backend server URL and SPN
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
- en: Finish the configuration and jump to your external admin virtual machine or
    any other external client
  id: totrans-358
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open a browser and the Kerberos website, [https://kerb.inovitdemos.ch](https://kerb.inovitdemos.ch),
    and get a successful login
  id: totrans-359
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Before we start to test more applications, we will install the Fiddler Debugging
    tool from [https://bit.ly/2eBzw4C](https://bit.ly/2eBzw4C) to analyze our traffic:'
  id: totrans-360
  prefs: []
  type: TYPE_NORMAL
- en: 'Start the Fiddler debugging tool:'
  id: totrans-361
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/ce2d91c6-51e4-4570-81ce-aba6d4c2aaa4.png)'
  id: totrans-362
  prefs: []
  type: TYPE_IMG
- en: Using Fiddler for authentication analysis
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
- en: 'Configure the HTTPS capture options:'
  id: totrans-364
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/31fe9b4f-e0b0-456b-a002-b1ca0d431f1b.png)'
  id: totrans-365
  prefs: []
  type: TYPE_IMG
- en: Capturing HTTPS traffic with Fiddler
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
- en: Press *F12* to start the debugging and open a browser, and you'll see the traffic produced.
  id: totrans-367
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Integrating Azure MFA (YD1ADS01)
  id: totrans-368
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this section, we just integrate Azure MFA into our ADFS farm. We will customize
    and use this option in [Chapter 8](efbe1917-c755-4449-b29e-fa4a21e819fd.xhtml), *Using
    Azure AD App Proxy and Web Application Proxy*:'
  id: totrans-369
  prefs: []
  type: TYPE_NORMAL
- en: 'First of all, we need to generate a certificate for Azure MFA on each server
    using the following cmdlet:'
  id: totrans-370
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE24]'
  id: totrans-371
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'Next, we set the certificate as the new credential against the Azure Multi-Factor
    Auth client:'
  id: totrans-372
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE25]'
  id: totrans-373
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Now, we can configure the ADFS farm:'
  id: totrans-374
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE26]'
  id: totrans-375
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Afterwards, we can see that Azure MFA is available as the primary authentication
    method for intranet/extranet use:'
  id: totrans-376
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/1c044925-ff3f-4659-931f-6d8e2d733f44.png)'
  id: totrans-377
  prefs: []
  type: TYPE_IMG
- en: ADFS Primary Authentication configuration
  id: totrans-378
  prefs: []
  type: TYPE_NORMAL
- en: ADFS 2019 allows you to use other third-party authentication providers as the
    primary method.
  id: totrans-379
  prefs: []
  type: TYPE_NORMAL
- en: With this configuration, we have successful implemented Azure MFA in our ADFS
    farm.
  id: totrans-380
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  id: totrans-381
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: A lot of practical work, hopefully you liked it! From our perspective, it's
    always the best to work directly with the authentication methods and capabilities
    you have just learned. Working through this chapter moves you to touch Azure AD
    and ADFS to provide several authentication methods. We know that we have many
    pre-configuration tasks, but it helps you to know the application configurations
    and to apply the correct authentication configuration. You touched on WS-Federation,
    SAML, and OAuth2 methods, including Azure AD's user provisioning capabilities.
  id: totrans-382
  prefs: []
  type: TYPE_NORMAL
- en: In the next chapter, we will dive further into the different authentication
    scenarios and also put the application proxy features in place. We'll be happy
    to see you in [Chapter 8](efbe1917-c755-4449-b29e-fa4a21e819fd.xhtml), *Using
    Azure AD App Proxy and Web Application Proxy*.
  id: totrans-383
  prefs: []
  type: TYPE_NORMAL
