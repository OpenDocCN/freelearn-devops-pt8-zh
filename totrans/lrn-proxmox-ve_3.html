<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;Creating Containers"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Creating Containers</h1></div></div></div><div class="blockquote"><table border="0" width="100%" cellspacing="0" cellpadding="0" class="blockquote" summary="Block quote"><tr><td valign="top"> </td><td valign="top"><p>
<span class="emphasis"><em>"Containers within a single operating system are much more efficient, and because of this efficiency, they underpin the future of the cloud infrastructure industry in place of VM architecture...Efficiency demands a future of containers running bare-metal hardware. Virtual machines have had their decade."</em></span>
</p></td><td valign="top"> </td></tr><tr><td valign="top"> </td><td colspan="2" align="right" valign="top" style="text-align: center">--<span class="attribution">
<span class="emphasis"><em>Linux Journal, June 7, 2013</em></span>
</span></td></tr></table></div><p>(<a class="ulink" href="http://www.linuxjournal.com/content/containers%E2%80%94not-virtual-machines%E2%80%94are-future-cloud">http://www.linuxjournal.com/content/containers%E2%80%94not-virtual-machines%E2%80%94are-future-cloud</a>)</p><div class="blockquote"><table border="0" width="100%" cellspacing="0" cellpadding="0" class="blockquote" summary="Block quote"><tr><td valign="top"> </td><td valign="top"><p>
<span class="emphasis"><em>"Everything at Google runs in a container....we start over 2 billion containers per week."</em></span>
</p></td><td valign="top"> </td></tr><tr><td valign="top"> </td><td colspan="2" align="right" valign="top" style="text-align: center">--<span class="attribution">
<span class="emphasis"><em>Joe Beda, a senior staff software engineer for Google Cloud Platform in a talk at Gluecon 2014</em></span>
</span></td></tr></table></div><p>(<a class="ulink" href="http://www.enterprisetech.com/2014/05/28/google-runs-software-containers/">http://www.enterprisetech.com/2014/05/28/google-runs-software-containers/</a>)</p><div class="blockquote"><table border="0" width="100%" cellspacing="0" cellpadding="0" class="blockquote" summary="Block quote"><tr><td valign="top"> </td><td valign="top"><p>
<span class="emphasis"><em>"If you're in data-center or cloud IT circles, you've been hearing about containers in general and Docker in particular non-stop for over a year now. With the release of Docker 1.0 in June, the buzz has become a roar."</em></span>
</p></td><td valign="top"> </td></tr><tr><td valign="top"> </td><td colspan="2" align="right" valign="top" style="text-align: center">--<span class="attribution">
<span class="emphasis"><em>ZDNET, August 4, 2014</em></span>
</span></td></tr></table></div><p>In <a class="link" href="ch02.html" title="Chapter 2. Installing Proxmox VE">Chapter 2</a>, <span class="emphasis"><em>Installing Proxmox VE</em></span>, we walked together through the Proxmox VE installation process.</p><p>This chapter's focus is creating containers from OS templates or virtual appliance templates. By its conclusion, this chapter will have addressed how to obtain templates and derive LXC containers from them with Proxmox VE. Along the way, we'll cover the following subjects:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The advantages of, and an example use case for, containers</li><li class="listitem" style="list-style-type: disc">Logging in to the Proxmox VE web-based management interface</li><li class="listitem" style="list-style-type: disc">Exploring the OS templates and virtual appliances available directly through the management interface</li><li class="listitem" style="list-style-type: disc">Creating a container from both the web-based interface and the command line</li><li class="listitem" style="list-style-type: disc">Starting a new container from the management interface</li><li class="listitem" style="list-style-type: disc">Changing a container's state directly through the PVE console or via the web-based administration interface</li></ul></div><div class="section" title="Understanding the container advantage"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec19"/>Understanding the container advantage</h1></div></div></div><p>
<a class="link" href="ch01.html" title="Chapter 1. Proxmox VE Fundamentals">Chapter 1</a>, <span class="emphasis"><em>Proxmox VE Fundamentals</em></span>, introduced GNU/Linux containers generally and worked particularly at distinguishing them from virtual machines. This section elaborates some advantages of containers, and it imagines a scenario ideal for container deployment.</p><p>Where an administrator could run 10-100 virtual machines on a physical host, she/he could run 100-1000 containers on the same host without compromising significantly on performance (<a class="ulink" href="http://computerpcdeal.com/servers-dell-poweredge/news_2014-06-17-05-30-07-224.html">http://computerpcdeal.com/servers-dell-poweredge/news_2014-06-17-05-30-07-224.html</a>).</p><p>Containers may be thought of, initially, as very lightweight virtual machines, but with much lower overhead and the added value of simplified deployment.</p><div class="section" title="Proxmox VE and the case for LXC"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec14"/>Proxmox VE and the case for LXC</h2></div></div></div><p>Containers are the legacy of FreeBSD jails and have enjoyed a kind of renaissance that has become an increasingly valuable cultural touchstone among computing professionals, particularly since the rise of Docker in June of 2014.</p><p>It's important to keep in mind that Docker was originally reliant on LXC, or Linux Containers, the same technology that Proxmox VE relies on for its containerization layer since the release of 4,0.</p><p>Previous releases, in fact, relied on OpenVZ, another open source container technology. OpenVZ had a reputation for stability and reliability; in stark contrast, until very recently, LXC was described as a kind of young upstart, one with so much promise, but that was nevertheless still immature.</p><p>We see the rapid increase in currency that LXC has enjoyed, which is illustrated in the following screenshot of a Google Trends analysis at <a class="ulink" href="https://www.google.com/trends/explore#q=%2Fm%2F0crds9p%2C%20OpenVZ&amp;cmpt=q&amp;tz=Etc%2FGMT%2B5">https://www.google.com/trends/explore#q=%2Fm%2F0crds9p%2C%20OpenVZ&amp;cmpt=q&amp;tz=Etc%2FGMT%2B5</a>. As a search term, OpenVZ enjoys a very sharp increase in 2006, and its popularity is sustained until about 2009 before it starts to drop off.</p><p>
</p><div class="mediaobject"><img src="graphics/image_03_001.png" alt="Proxmox VE and the case for LXC"/><div class="caption"><p>Interest over time for LXC and OpenVZ from Google Trends</p></div></div><p>
</p><p>Meanwhile, LXC slowly grows in popularity, until 2014—the same year that Docker created a bit of a container uproar—LXC surpasses OpenVZ.</p><p>With the excitement and anxiety that this container renaissance provoked, it makes sense that Proxmox VE turned to LXC for its containerization layer in late 2015; it was cutting edge, it stabilized, and it had the support of contributors from corporations such as IBM and Canonical.</p><p>Terms that are very often interchangeable with containerization, in this context, include <span class="strong"><strong>OS virtualization</strong></span> and <span class="strong"><strong>virtual private servers</strong></span>.</p><p>For an infographic covering the history of containers—beginning with Unix V7 and tracing developments through 2014, visit <a class="ulink" href="http://pivotal.io/platform/infographic/moments-in-container-history">http://pivotal.io/platform/infographic/moments-in-container-history</a>.</p><p>Do note that Proxmox VE 4.1 ships with tools with which OpenVZ containers can be migrated to LXC. To learn more, visit the PVE wiki at <a class="ulink" href="https://pve.proxmox.com/wiki/Convert_OpenVZ_to_LXC">https://pve.proxmox.com/wiki/Convert_OpenVZ_to_LXC</a>.</p><p>Much like a VM, a container is an isolated entity; it can be independently rebooted, allowed isolated root access, and have a unique set of users and groups.</p><p>That same isolation also means, potentially, independent IP addresses, memory, processes, libraries, and configuration files.</p><p>LXC's feature set distinguishes it from full virtualization solutions:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">CPU resources spent on virtualization by the LXC containerization layer will be significantly lower than with full virtualization</li><li class="listitem" style="list-style-type: disc">An authorized container user can change any configuration file and install additional software within a container without interfering with other containers or the Proxmox VE host</li><li class="listitem" style="list-style-type: disc">While containers are fully isolated from each other, they do share dynamic libraries with the host, which greatly saves on RAM</li><li class="listitem" style="list-style-type: disc">Most containers fully boot in seconds, while virtual machines may boot in minutes, on the same resources</li><li class="listitem" style="list-style-type: disc">Because all containers run on the OS kernel of the host system, containers run with near-zero overhead</li><li class="listitem" style="list-style-type: disc">Any container's network traffic is isolated from every other container; traffic snooping between containers is impossible</li><li class="listitem" style="list-style-type: disc">Firewalling may be used inside a container, as may routing manipulation</li></ul></div><p>In practical terms, these features suggest, for example, that containers can be scaled without a restart, and offer improved service efficiency and better performance than virtual machines, generally speaking.</p><p>It is absolutely worth noting that cautious pundits now suggest the celebrated performance advantage of containers and the decreased resources they demand is a diminishing advantage, particularly as more powerful hardware becomes available at a lower price. The argument here is that full virtualization still has a place, and that the benefit of containers is spectral so long as it argues from the perspective that hardware resources are scarce.</p><p>There's truth to this, but it doesn't negate the assertion that in many cases containers can be a less costly alternative to virtual machines without compromising on the quality of service.</p><p>Consider that the advantages articulated previously can directly lead to a longer lifespan for the physical host, as well as flexibility such that containers can be transferred quickly to another physical host to facilitate hardware maintenance; security is improved against certain threat types; and finally, LXC enjoys a thriving community of developers and users, a great resource for support that's available with or without a premium Proxmox VE subscription.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip16"/>Tip</h3><p><span class="strong"><strong>Container security</strong></span></p><p><a class="link" href="ch07.html" title="Chapter 7. Securing Proxmox VE">Chapter 7</a>, <span class="emphasis"><em>Secure Your Servers</em></span>, will focus particularly on virtual machine security.</p><p>While we're certainly in the thrall of a container revolution, there're still outstanding questions about container security and we must be diligent about pursuing questions. The LXC documentation at <a class="ulink" href="https://linuxcontainers.org/lxc/security/">https://linuxcontainers.org/lxc/security/</a> offers some insight. More information is available from SANS Institute at <a class="ulink" href="https://www.sans.org/reading-room/whitepapers/linux/securing-linux-containers-36142">https://www.sans.org/reading-room/whitepapers/linux/securing-linux-containers-36142</a>, and finally, IBM offers some clear guidance at <a class="ulink" href="http://www.ibm.com/developerworks/library/l-lxc-security/">http://www.ibm.com/developerworks/library/l-lxc-security/</a>.</p><p>Nevertheless, in the domain of full virtualization, there are a variety of documents that work toward establishing a security protocol for virtual machines, regardless of the vendor. This gives us information to respond to and with which to develop a dialog.</p><p>Regrettably, this revolution is still young, and no such standards for OS-level virtualization seem readily available yet.</p></div></div><p>This very distinguished feature-set should provoke us to imagine a representative use case for LXC containers immediately; imagine the secondary education institution as a whole, then consider its various computing courses. The potential for consolidation of hardware resources for the two related scenarios is tremendous.</p><p>Computing and information and communication technology students, for example, can each have their own virtual private server with which to experiment and complete guided and independent practice. Each have their own virtual private servers with which to experiment, find inspiration, complete assessments, and realize their innovative visions.</p><p>Moreover, that same physical hardware could host a container each for relevant applications:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A <span class="strong"><strong>learning management system</strong></span> (<span class="strong"><strong>LMS</strong></span>), such as <span class="emphasis"><em>Moodle</em></span></li><li class="listitem" style="list-style-type: disc">A contained social network provided by a web application, such as <span class="emphasis"><em>Elgg</em></span> (<a class="ulink" href="https://elgg.org/about.php">https://elgg.org/about.php</a>)</li><li class="listitem" style="list-style-type: disc">A microblogging system, such as <span class="emphasis"><em>GNU Social</em></span> (<a class="ulink" href="http://gnu.io/social/">http://gnu.io/social/</a>)</li><li class="listitem" style="list-style-type: disc">A directory server, such as <span class="emphasis"><em>openLDAP</em></span>, to provide a single sign-on service across each platform</li><li class="listitem" style="list-style-type: disc">A portfolio system with <span class="emphasis"><em>Mahara</em></span> (<a class="ulink" href="https://mahara.org/">https://mahara.org/</a>)</li><li class="listitem" style="list-style-type: disc">A web filter and firewall solution to protect not only the students, but also the integrity of the data, and confidentiality of the stakeholders, and availability of services</li><li class="listitem" style="list-style-type: disc">A domain controller could be added for additional flexibility and functionality (<a class="ulink" href="https://www.turnkeylinux.org/domain-controller">https://www.turnkeylinux.org/domain-controller</a>)</li></ul></div><p>There's a hitch to containers; they're not a solution for every problem. For example, LXC, the container technology beneath PVE containers, only works with GNU/Linux guests.</p><p>Proxmox VE hosts further limit what Linux distributions are supported for containers. At present, these are the supported distributions and releases:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Debain (6, 7 , 8)</li><li class="listitem" style="list-style-type: disc">CentOS 6</li><li class="listitem" style="list-style-type: disc">Ubuntu (12.04, 14.04, 15.04)</li><li class="listitem" style="list-style-type: disc">Archlinux</li></ul></div><p>This is mentioned with an absolute acknowledgement that 4.1 is a very recent release of PVE, and it's very clear that Proxmox VE will support more distributions with every passing month.</p><p>The next section is committed to the very first step required for us to provide services with containers hosted on PVE—obtaining container templates.</p><p>We'll close this section as a reminder that Proxmox VE is an enterprise-class virtualization platform that supports both containers and full virtualization—precisely because both have a role in the infrastructure.</p></div></div></div>
<div class="section" title="Container templates"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec20"/>Container templates</h1></div></div></div><p>A template is the starting point for an LXC container (abbreviated in Proxmox VE as "CT"). There are two sorts of templates: <span class="strong"><strong>OS templates</strong></span> and <span class="strong"><strong>appliance templates</strong></span>.</p><p>OS templates provide a minimal set of packages from a GNU/Linux distribution, as well as system libraries and scripts, to start up and run the container. They're designed to benefit fully from the GNU/Linux kernel running on the host.</p><p>Aside from basic tools, such as a bash interpreter and utilities, additional software, such as a compiler or a DBMS is not usually incorporated into an OS template.</p><p>In contrast to OS templates, virtual appliances are built on top of JeOS (Just enough Operating System) to provide a very specific service reliably, securely, and with an absolute commitment to efficiency.</p><p>Virtual appliances can provide general functionality, such as LAMP stack; or a specific application, such as GitLab (<a class="ulink" href="https://about.gitlab.com/">https://about.gitlab.com/</a>); a CMS such as WordPress or Drupal; or a web-based network monitoring system such as Observium (<a class="ulink" href="http://www.observium.org/">http://www.observium.org/</a>).</p><p>The most compelling aspect of virtual appliances is that they just work with minimal configuration or requisite tuning by the user.</p><p>Both OS templates and virtual appliances are available via the Proxmox VE management interface. At this point, all the available appliances are provided by <span class="strong"><strong>TurnKeyGNU/Linux</strong></span>; who provide access to over 190 appliances, from web applications to SDKs (software development kits), as well as administrative templates for monitoring network activity, providing LDAP or a Domain Controller, and many more.</p><p>
</p><div class="mediaobject"><img src="graphics/image_03_002.png" alt="Container templates"/><div class="caption"><p>Website for the TurnKey GNU/Linux appliance library</p></div></div><p>
</p><p>Each of these appliances is built from the same JeOS version of Debian, called Turnkey GNU/Linux Core (Debian 8), and features at least shellinabox, OpenSSH server, and a customized Webmin.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip17"/>Tip</h3><p>
<span class="strong"><strong>TurnKey GNU/Linux Core</strong></span></p><p>See <a class="ulink" href="http://www.turnkeylinux.org/core">http://www.turnkeylinux.org/core</a> for more information on TurnKey GNU/Linux Core.</p></div></div></div>
<div class="section" title="Downloading templates"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec21"/>Downloading templates</h1></div></div></div><p>Templates are available directly through the Proxmox VE management interface, which offers both OS templates and virtual appliance templates.</p><p>In this section, we'll login to the web-based management interface, navigate to storage in the server view, and then browse the list of available templates.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note18"/>Note</h3><p>To follow along, your Proxmox VE host must be capable of accessing the Internet.</p></div></div><div class="section" title="Logging in to Proxmox VE's web interface"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec15"/>Logging in to Proxmox VE's web interface</h2></div></div></div><p>To get started, login to Proxmox VE from a workstation on the same LAN; point a browser to port 8006 of the IP address of your Proxmox VE instance using SSL/TLS. The machine configured in this chapter has an address of <code class="literal">192.168.1.80</code>; to access this machine, for example, one can simply navigate to <code class="literal">https://192.168.1.80:8006</code> in a (JavaScript enabled) browser.</p><p>Because PVE has a self-signed certificate, the browser will warn that the connection can't be trusted. Firefox, for example, will present a window like this:</p><p>
</p><div class="mediaobject"><img src="graphics/image_03_003.png" alt="Logging in to Proxmox VE's web interface"/><div class="caption"><p>The Insecure Connection dialog (in Firefox)</p></div></div><p>
</p><p>Firefox users can proceed as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">To move forward in Firefox, select <span class="strong"><strong>Advanced</strong></span> and click on the <span class="strong"><strong>Add Exception...</strong></span> button that is revealed.</li><li class="listitem">On the <span class="strong"><strong>Add Security Exception</strong></span> dialog that pops up, click on <span class="strong"><strong>Confirm Security Exception</strong></span> while noting that you may choose to store this exception permanently by selecting the <span class="strong"><strong>Permanently store this exception</strong></span> check box (this dialog is captured in the following screenshot):</li></ol></div><p>
</p><div class="mediaobject"><img src="graphics/image_03_004.png" alt="Logging in to Proxmox VE's web interface"/><div class="caption"><p>The Add Security Exception dialog (in Firefox)</p></div></div><p>
</p><p>If you're using Google Chrome to access the administrative interface, you should see a page similar to the following screenshot:</p><p>
</p><div class="mediaobject"><img src="graphics/image_03_005.png" alt="Logging in to Proxmox VE's web interface"/><div class="caption"><p>Privacy Error dialog in Google Chrome</p></div></div><p>
</p><p>To disregard this (somewhat discomforting) alert:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Scroll to the bottom of the page.</li><li class="listitem">Click on <span class="strong"><strong>Advanced.</strong></span></li><li class="listitem">Click on <span class="strong"><strong>Proceed to 192.168.1.80.</strong></span></li></ol></div><p>Two things to note about this link: it is appended with "unsafe" as a reminder that this can be a security risk and of steps for chrome users.</p><p>Whichever browser is used, be sure to replace <code class="literal">192.168.1.80</code> with the IP address of your Proxmox VE host.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note19"/>Note</h3><p>For explanations of these browser alerts, see the resources on self-signed certificates in relation to TLS/SSL:</p><p><a class="ulink" href="http://en.wikipedia.org/wiki/Self-signed_certificate">http://en.wikipedia.org/wiki/Self-signed_certificate</a></p><p>
<a class="ulink" href="http://en.wikipedia.org/wiki/HTTPS">http://en.wikipedia.org/wiki/HTTPS</a></p><p>
<a class="ulink" href="http://security.stackexchange.com/questions/8110/what-are-the-risks-of-self-signing-a-certificate-for-ssl">http://security.stackexchange.com/questions/8110/what-are-the-risks-of-self-signing-a-certificate-for-ssl</a>
</p></div></div><p>When the page loads completely, proceed to login with username <code class="literal">root</code> and the password that you determined during installation in <a class="link" href="ch02.html" title="Chapter 2. Installing Proxmox VE">Chapter 2</a>, <span class="emphasis"><em>Installing Proxmox VE</em></span>.</p><p>Select the <span class="strong"><strong>Realm</strong></span> called <span class="strong"><strong>Linux PAM Standard Authentication</strong></span>. The final field determines the language of the web interface. Make the selection of your choice and click on <span class="strong"><strong>Login</strong></span> to proceed.</p><p>
</p><div class="mediaobject"><img src="graphics/image_03_006.png" alt="Logging in to Proxmox VE's web interface"/><div class="caption"><p>The login dialog for Proxmox VE web-management interface</p></div></div><p>
</p><p>After successfully logging in, you'll have your first view of the Proxmox VE administration GUI.</p></div><div class="section" title="Browsing available container templates"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec16"/>Browsing available container templates</h2></div></div></div><p>In the left column, toward the banner, the selected view should already be set to <span class="strong"><strong>Server View</strong></span>:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Expand the resource tree directly under <span class="strong"><strong>Server View</strong></span> (the Datacenter node). At the bottom of the resource tree in the left frame will be storage that's local to the physical host and labeled <span class="strong"><strong>local</strong></span> followed by your hostname in parenthesis; in the following screenshot, the hostname is <code class="literal">pve4</code> and the storage node is simply labeled local (<code class="literal">pve4</code>).</li><li class="listitem">Select the storage node local to your server; in the following screenshot, for example, select <span class="strong"><strong>local </strong></span><span class="strong"><strong>(pve4)</strong></span>:<p>
</p><div class="mediaobject"><img src="graphics/image_03_007.png" alt="Browsing available container templates"/><div class="caption"><p>Server View and Resource Tree (expanded to reveal local (pve4))</p></div></div><p>
</p></li><li class="listitem">Three tabs will appear in the right frame; <span class="strong"><strong>Summary</strong></span>, <span class="strong"><strong>Content</strong></span>, and <span class="strong"><strong>Permissions</strong></span>.<p>Select the <span class="strong"><strong>Content</strong></span> tab to reveal both a <span class="strong"><strong>Templates</strong></span> button and an <span class="strong"><strong>Upload</strong></span> button.</p><p>
</p><div class="mediaobject"><img src="graphics/image_03_008.png" alt="Browsing available container templates"/><div class="caption"><p>Local storage for the PVE node called pve4. Screenshot to visualize locations of local (PVE4), as well as the Templates and Upload buttons</p></div></div><p>
</p></li></ol></div><p>To browse the list or download an OS template and virtual appliance provided through the PVE interface, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Click on the <span class="strong"><strong>Templates</strong></span> tab.</li><li class="listitem">Scroll through the pop-up browser window until you find a template that suits your interests.</li></ol></div><p>
</p><div class="mediaobject"><img src="graphics/image_03_010.png" alt="Browsing available container templates"/><div class="caption"><p>A glimpse at a few of the container templates available through the Proxmox VE interface</p></div></div><p>
</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip20"/>Tip</h3><p>
<span class="strong"><strong>Turnkey GNU/Linux Appliance Library</strong></span></p><p>If you decide you want to know more about a particular Turnkey GNU/Linux appliance, point your browser to <a class="ulink" href="http://www.turnkeylinux.org/all">http://www.turnkeylinux.org/all</a> and have a look at the elaborated description and feature lists for each appliance.</p></div></div></div><div class="section" title="Downloading a container"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec17"/>Downloading a container</h2></div></div></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip21"/>Tip</h3><p>For the remainder of the chapter, I'll be working with the Ubuntu 14.04-standard template. While it's recommended that you follow along, there are many exciting templates to start from.</p></div></div><p>
</p><div class="mediaobject"><img src="graphics/image_03_011.png" alt="Downloading a container"/><div class="caption"><p>Preparing to create a Ubuntu 14.04.1 container</p></div></div><p>
</p><p>Once you've selected an OS or appliance template:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Click to select your choice.</li><li class="listitem">Click on the <span class="strong"><strong>Download</strong></span> button.</li></ol></div><p>The template will be saved to PVE's local storage in <code class="literal">/usr/share/vz/cache/templates/</code>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip22"/>Tip</h3><p>If the list of available templates in the web interface seems incomplete, it can be refreshed from the command line of the PVE host. Access the command line interface by logging on to the host locally, via SSH, or using the noVNC console available on the web interface.After authenticating, refresh the list of templates by simply entering <code class="literal">pveam</code> at the prompt.</p></div></div><p>Now that a template is downloaded, a container can be built from it. In the next section, we'll configure and create the first template.</p></div></div>
<div class="section" title="From template to container"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec22"/>From template to container</h1></div></div></div><p>You may have noted that when you've highlighted an item in storage—ISO or template, the option to <span class="strong"><strong>Create CT</strong></span> (container) or <span class="strong"><strong>Create VM</strong></span> (virtual machine) appears at the top of the right-hand frame. To build a container from a template with Proxmox VE:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Have, at least, the following information ready:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A password for the root user</li><li class="listitem" style="list-style-type: disc">A name for the host</li><li class="listitem" style="list-style-type: disc">A free IPv4 address for the host</li><li class="listitem" style="list-style-type: disc">Max amount of RAM</li><li class="listitem" style="list-style-type: disc">CPU count</li><li class="listitem" style="list-style-type: disc">An idea of the storage space you want for the (virtual) hard drive (in GB)</li><li class="listitem" style="list-style-type: disc">The IPv4 address of the internet gateway</li><li class="listitem" style="list-style-type: disc">The appropriate subnet mask of the network the host is on</li></ul></div></li><li class="listitem">Once you're certain of this information, select the template in local that you want to build a container from.</li><li class="listitem">Click on the <span class="strong"><strong>Create CT</strong></span> button at the top right (see the following screenshot).<p>
</p><div class="mediaobject"><img src="graphics/image_03_012.png" alt="From template to container"/></div><p>
</p><div class="caption"><p>Create CT and VM to appear at the top of the right-hand corner</p></div><p>
</p></li><li class="listitem">Clicking on <span class="strong"><strong>Create CT</strong></span> will start the <span class="strong"><strong>Create LXC Container</strong></span> dialog, which provides a GUI for configuring the container.<p>The first tab is <span class="strong"><strong>General</strong></span>:</p><p>
</p><div class="mediaobject"><img src="graphics/image_03_013.png" alt="From template to container"/><div class="caption"><p>The General tab of the container creation dialog</p></div></div><p>
</p><p>Use this dialog to define the hostname and confirm the password of the root user. The VM ID field auto-populates and auto-increments in the Web interface: the first guest created will have a default <span class="strong"><strong>VM ID</strong></span> of <code class="literal">100</code>, the next <code class="literal">101</code>, and so on.</p></li><li class="listitem">Click on <span class="strong"><strong>Next</strong></span> to proceed to the <span class="strong"><strong>Template</strong></span> tab, illustrated here:<p>
</p><div class="mediaobject"><img src="graphics/image_03_014.png" alt="From template to container"/><div class="caption"><p>The Template tab of the container creation dialog</p></div></div><p>
</p></li><li class="listitem">To follow this text, choose <span class="strong"><strong>Ubuntu-14.04-standard_14.04-1_amd64.tar.gz</strong></span> from the drop-down <span class="strong"><strong>Template</strong></span> menu and click <span class="strong"><strong>Next</strong></span> to continue to the <span class="strong"><strong>Root Disk</strong></span> tab.<p>
</p><div class="mediaobject"><img src="graphics/image_03_015.png" alt="From template to container"/><div class="caption"><p>The Root Disk tab of the container creation dialog</p></div></div><p>
</p><p>At this stage, <span class="strong"><strong>Storage</strong></span> is defined as <span class="strong"><strong>local</strong></span> and there are no alternatives available. Define the size of the virtual disk for the container to suit your preferences (but work to avoid a <span class="strong"><strong>Disk Size</strong></span> of less than 4 GB).</p></li><li class="listitem">Click on <span class="strong"><strong>Next</strong></span> to define a <span class="strong"><strong>CPU</strong></span> limit and units for the container. For the purpose of this text, let's leave these settings at the default.<p>
</p><div class="mediaobject"><img src="graphics/image_03_016.png" alt="From template to container"/><div class="caption"><p>The CPU tab of the container creation dialog</p></div></div><p>
</p></li><li class="listitem">Click on <span class="strong"><strong>Next</strong></span> to configure <span class="strong"><strong>Memory</strong></span> for the container.<p>
</p><div class="mediaobject"><img src="graphics/image_03_017.png" alt="From template to container"/><div class="caption"><p>The Memory tab of the container creation dialog</p></div></div><p>
</p></li><li class="listitem">Once again, the defaults are good for our purposes, so we'll move forward from the <span class="strong"><strong>Memory</strong></span> tab onto the <span class="strong"><strong>Network</strong></span> tab:</li></ol></div><p>
</p><div class="mediaobject"><img src="graphics/image_03_018.png" alt="From template to container"/><div class="caption"><p>The Network tab of the container creation dialog</p></div></div><p>
</p><p>The <span class="strong"><strong>Network</strong></span> tab assumes some prior knowledge about the configuration of the network the container is joining. Since the PVE host is at <code class="literal">192.168.1.80</code> in this case, this first container will be addressed as <code class="literal">192.168.1.81</code>, a static address I'm confident won't conflict with other devices. Static is selected instead of DHCP at the top right of the tab.</p><p>Be sure to indicate the scope in the <span class="strong"><strong>IPv4/CIDR</strong></span> field. In this case, the subnet mask is 255.255.255.0, so the IP address is appended with <code class="literal">/24</code>. If the correct subnet mask for the network included more addresses, as 255.255.0.0 would, simply append <code class="literal">/16</code> instead, for example. For those of us who don't have the CIDR notation at the ready, there's a calculator available at <a class="ulink" href="http://www.subnet-calculator.com/cidr.php">http://www.subnet-calculator.com/cidr.php</a>.</p><p>For our purposes, <span class="strong"><strong>IPv6</strong></span> isn't of concern; choose the <span class="strong"><strong>DHCP</strong></span> radio button and then check out the left column of the <span class="strong"><strong>Network</strong></span> tab.</p><p>
<span class="strong"><strong>Name</strong></span> refers to how the virtual network interface will appear inside the container; the default, <span class="strong"><strong>eth0</strong></span>, is precisely what we want.</p><p>The <span class="strong"><strong>Bridge</strong></span> field asks which bridge on the host to connect the container to. In the preceding screenshot, <code class="literal">vmbr0</code> is the default, and only, choice; the machine I'm using has only one NIC, and it is defined in the host as <code class="literal">vmbr0</code>.</p><p>When ready to commit the settings in the <span class="strong"><strong>Network</strong></span> tab, click on <span class="strong"><strong>Next</strong></span> to point the container to a DNS server.</p><p>
</p><div class="mediaobject"><img src="graphics/image_03_019.png" alt="From template to container"/><div class="caption"><p>The DNS tab of the container creation dialog</p></div></div><p>
</p><p>Again, in the case of my network, the default setting in which the <span class="strong"><strong>DNS domain</strong></span> field is set to <span class="strong"><strong>use host settings</strong></span> is a perfect fit. To review and commit the configuration, click on <span class="strong"><strong>Next</strong></span>.</p><p>
</p><div class="mediaobject"><img src="graphics/image_03_020.png" alt="From template to container"/><div class="caption"><p>The Confirm tab in the container creation dialog</p></div></div><p>
</p><p>The <span class="strong"><strong>Confirm</strong></span> tab offers a configuration summary, as well as an opportunity the revisit some configuration decisions. Click on <span class="strong"><strong>Back</strong></span> to make adjustments or <span class="strong"><strong>Finish</strong></span> to begin the container creation task.</p><p>As soon as <span class="strong"><strong>Finish</strong></span> is clicked, the configuration dialog closes and a new window opens in the browser that offers an opportunity to watch PVE build the LXC container from the template based on your configuration:</p><p>
</p><div class="mediaobject"><img src="graphics/image_03_021.png" alt="From template to container"/><div class="caption"><p>The output of Task viewer as the container creation completes</p></div></div><p>
</p><p>When the <span class="strong"><strong>Task viewer</strong></span> window outputs <code class="literal">TASK OK</code>, the container is ready to use. The <span class="strong"><strong>Task viewer</strong></span> window can be closed.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note23"/>Note</h3><p>A container can also be created from a template using a PVE host's command line using the <code class="literal">pct</code> create command. The following bash script illustrates the use of this command to create a container nearly identical to the one created through the web-based procedure detailed previously:</p></div></div><pre class="programlisting">#!/bin/bash &#13;#### Set Variables #### &#13;$hostname="trusty-chapter3" &#13;$vmid="100" &#13;$template-path="/var/lib/vz/template/cache" &#13;$storage="local" &#13;$description="trusty container for Chapter 3" &#13;$template=" Ubuntu-14.04-standard_14.04-1_amd64.tar.gz" &#13;$ip="192.168.1.81/24" &#13;$nameserver="8.8.8.8" &#13;$ram="1024" &#13;$rootpw="changeme" &#13;$rootfs="4" &#13;$gateway="192.168.1.1" &#13;$bridge="vmbr0" &#13;$if="eth0" &#13;#### Execute pct create using variable substitution #### &#13;pct create $vmid \ &#13;  $template-path/$template \ &#13;  -description $description \ &#13;  -rootfs $rootfs \ &#13;  -hostname $hostname \ &#13;  -memory $ram \ &#13;  -nameserver $nameserver \ &#13;  -storage $storage \ &#13;  -password $rootpw \ &#13;  -net0 name=$if,ip=$ip,gw=$gateway,bridge=$bridge &#13;</pre><p>In most cases, making changes to a container's configuration and adding virtual devices is a simple matter that can be accomplished through the web interface. To edit the configuration or add devices:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select the container in <span class="strong"><strong>Server</strong></span> view in the left frame of the interface.</li><li class="listitem">In the frame on the right, look below the <span class="strong"><strong>Start</strong></span> button for a group of tabs (shown in the following screenshot).</li><li class="listitem">Match the task you want to complete to the tab name.</li><li class="listitem">Use the <span class="strong"><strong>Add</strong></span> and <span class="strong"><strong>Edit</strong></span> buttons to make the desired changes.</li></ol></div><p>
</p><div class="mediaobject"><img src="graphics/image_03_022.png" alt="From template to container"/><div class="caption"><p>Most container configuration changes can be made through the PVE Web interface</p></div></div><p>
</p><p>The next section is about controlling the state of any given container; for example, how to start it and stop it.</p></div>
<div class="section" title="Starting and stopping containers"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec23"/>Starting and stopping containers</h1></div></div></div><p>To start the container, select it in the left pane; the icon should be black and gray, indicating a container that is not running.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In the following screenshot, my container is identified with a VM ID of <span class="strong"><strong>100</strong></span> and the name <span class="strong"><strong>trusty-chapter3</strong></span>:<p>
</p><div class="mediaobject"><img src="graphics/image_03_023.png" alt="Starting and stopping containers"/><div class="caption"><p>Icon of stopped container</p></div></div><p>
</p></li><li class="listitem">In the upper-right corner of the interface, start the container by clicking on the <span class="strong"><strong>Start</strong></span> button:</li></ol></div><p>
</p><div class="mediaobject"><img src="graphics/image_03_024.png" alt="Starting and stopping containers"/><div class="caption"><p>Container Start button</p></div></div><p>
</p><p>When the container start up process is complete, it is signified in the left frame of the interface by a change in the color of the container's icon; it should now be green, black, and grey instead of simply black and grey; the green addition to the icon is a quick way to visually distinguish a running container from a stopped one.</p><p>
</p><div class="mediaobject"><img src="graphics/image_03_025.png" alt="Starting and stopping containers"/><div class="caption"><p>The icon of a running container is green, black, and grey</p></div></div><p>
</p><p>In the resource tree, in the left frame, select the running container.</p><p>On the right side of the screen, several buttons become available:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Clicking on <span class="strong"><strong>Shutdown</strong></span> will shut down the container gracefully</li><li class="listitem" style="list-style-type: disc">The <span class="strong"><strong>Stop</strong></span> button, by way of contrast, will halt the container abruptly</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Migrate</strong></span> allows us to move, even a running container between the Proxmox VE cluster nodes without causing any service outages or other downtime</li><li class="listitem" style="list-style-type: disc">The <span class="strong"><strong>Remove</strong></span> button will delete a stopped container. Note that there is no recovery option if the container is not backed up.</li></ul></div><p>To suspend a container, choose the container's <span class="strong"><strong>Backup</strong></span> tab in the PVE web interface. Click on <span class="strong"><strong>Backup now</strong></span>, and in the dialog box that appears, select <span class="strong"><strong>Suspend</strong></span> from the <span class="strong"><strong>Mode</strong></span> drop-down menu. Click on the <span class="strong"><strong>Backup</strong></span> button to suspend the container and close the dialog.</p><p>
</p><div class="mediaobject"><img src="graphics/image_03_026.png" alt="Starting and stopping containers"/><div class="caption"><p>Containers can be suspended from the PVE Web interface</p></div></div><p>
</p><div class="section" title="Changing container states with the command line"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec18"/>Changing container states with the command line</h2></div></div></div><p>A container's state may also be controlled from a PVE host's command line (whether via SSH session, noVNC console, or logged in to the physical host).</p><p>To start the container described in this chapter and assigned the VM ID of 100, enter <code class="literal">pct start 100</code>. Likewise, the same container can be brought down with <code class="literal">pct stop 100</code>.</p><p>Templates can be backed up from either the PVE command line or the web interface. To learn more about backing up and restoring containers, visit the Proxmox wiki at <a class="ulink" href="https://pve.proxmox.com/wiki/Linux_Container#Backup_container">https://pve.proxmox.com/wiki/Linux_Container#Backup_container</a>.</p></div><div class="section" title="Accessing a container"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec19"/>Accessing a container</h2></div></div></div><p>Most OS templates available through Proxmox VE are initially configured to be accessed either through the noVNC console, which can be launched from the management web interface, or from the PVE command line interface.</p><p>That's not to say OpenSSH isn't installed; in fact, I haven't seen a template without the OpenSSH server installed. The OS templates simply aren't configured at launch so the root user can login with a password. (However, TurnKey Linux's appliances can be accessed through SSH by the root account using a password.)</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip24"/>Tip</h3><p>The pct enter command makes it a breeze to access a container from the PVE host's command line interface. To enter the container developed in this chapter, I could access the PVE host via SSH, for example, by logging in as the root user; then, I could follow <code class="literal">pct enter</code> with the VM ID of the container, which in this case is <code class="literal">100</code>. Simply type <code class="literal">pct enter 100</code> at the prompt and press 
<span class="strong"><strong>Enter
</strong></span> to drop into a shell within the container.</p></div></div><p>To access a running container through the <span class="strong"><strong>noVNC</strong></span> console, select the running template in the web interface, and then select <span class="strong"><strong>Console</strong></span> at the top right of the browser, and select <span class="strong"><strong>noVNC</strong></span> from the drop-down menu.</p><p>
</p><div class="mediaobject"><img src="graphics/image_03_027.png" alt="Accessing a container"/><div class="caption"><p>When a started container is selected, the Console button appears in the top-right corner of the page</p></div></div><p>
</p><p>Alternatively, select the running template as described previously, but instead of clicking on the <span class="strong"><strong>Console</strong></span> drop-down menu, choose the <span class="strong"><strong>Console</strong></span> tab for the container.</p><p>If you have access to a terminal via the console, as illustrated in the following screenshot, you're all set to create users, install packages, and make other configuration changes to make the container your own.</p><p>
</p><div class="mediaobject"><img src="graphics/image_03_028.png" alt="Accessing a container"/><div class="caption"><p>Reconfiguring a Ubuntu container's time-zone data from noVNC console session</p></div></div><p>
</p><p>If the console launches but displays only a black screen and an unresponsive cursor, try pressing 
<span class="strong"><strong>Enter
</strong></span> and look for a log in prompt. If that doesn't work, consider that some containers have to be restarted once to prompt for credentials; restart the container and then once more, launch the noVNC console. If the noVNC screen is still dark, press 
<span class="strong"><strong>Enter
</strong></span> to finesse a prompt from it.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note25"/>Note</h3><p>You'll want to configure locales and the time zone for most containers. <code class="literal">dpkg-reconfigure locales</code> will lead you through a brief dialog to determine which locales are available on a Debian or Ubuntu container. <code class="literal">dpkg-reconfigure tzdata</code> will lead you through the necessary steps to setup or reconfigure the time zone data for a Debian or Ubuntu container.</p></div></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec24"/>Summary</h1></div></div></div><p>This chapter detailed the process of developing containers from LXC templates. We explored the promise of LXC containers in Proxmox VE, and outlined an example use case that could be generalized to other circumstances and that demonstrated how the Proxmox VE container's features could add value, flexibility, and extensibility to an organization's IT infrastructure.</p><p>After describing how to derive a container from a template, we explored ways to manipulate containers from both the command line and the web interface.</p><p>In <a class="link" href="ch04.html" title="Chapter 4. Creating Virtual Machines">Chapter 4</a>, <span class="emphasis"><em>Creating Virtual Machines</em></span>, we will identify advantages of virtual machines over containers and explore some use cases. At the close of the chapter, we'll have walked through the creation of Microsoft Windows and GNU/Linux virtual machines from ISOs.</p><p>With what we know now about containers, it'll be exciting to explore the place for virtual machines in a culture whose fascination is fixed on containerization.</p></div></body></html>