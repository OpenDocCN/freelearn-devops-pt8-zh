<html><head></head><body><div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Azure App Service</h1>
                </header>
            
            <article>
                
<p>Azure App Service is one of the biggest and most commonly used services available in the Azure cloud. It allows for easy development of web applications with multiple features available (such as support for different platforms, including .NET, PHP, and Java), manual and automated scaling, and different performance options. It's a general platform and runtime that fuels other services, such as WebJobs and Azure Functions.</p>
<p>In this chapter, you will learn about the following:</p>
<ul>
<li>Creating and deploying Azure App Service</li>
<li>Working with different operating systems and platforms</li>
<li>Choosing the right App Service Plan and what their features <span>are</span></li>
<li>Securing App Service using different security providers</li>
<li>Diagnosing and monitoring your applications</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Technical requirements</h1>
                </header>
            
            <article>
                
<p>To perform the exercises in this chapter, you will need the following:</p>
<ul>
<li>Access to an Azure subscription</li>
<li>Visual Studio 2017 with Azure development workload installed</li>
<li>Visual Studio Code installed (available at <a href="https://code.visualstudio.com/">https://code.visualstudio.com/</a>)</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Creating and deploying Azure App Service</h1>
                </header>
            
            <article>
                
<p>To get started with Azure App Service, you have to learn how to create that service and deploy your code. You will see how Azure provides many different ways for doing so, and each path can be easier or harder, depending on your current needs and the specification of your application. However, the strength of a cloud and <strong>Platform as a Service</strong> (<strong>PaaS</strong>) offering lies in the straightforward and intuitive process of provisioning new components of your system. </p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Creating Azure App Service using the Azure Portal</h1>
                </header>
            
            <article>
                
<p>To begin with App Service, I will show you how you can create your very first web app using the Azure Portal. In fact, all you need is your mouse and keyboard (because each application has to have a name)—neither external hardware nor detailed configuration information is required here, because Azure will do everything for you.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Selecting Azure Web App from available services</h1>
                </header>
            
            <article>
                
<p>To create Azure App Service in the Azure Portal, you <span>first </span><span>have to find it in the list of available services. The easiest way to do so is to click on </span><span class="packt_screen">+ Create a resource </span><span>button and search for </span><kbd>Web App</kbd><span>:</span></p>
<div class="CDPAlignCenter CDPAlign"><img src="Images/d25025a9-6da7-46da-a085-d5c4df60ac68.png" style="width:55.58em;height:23.25em;" width="824" height="344"/></div>
<div class="packt_tip">Instead of using the <span class="packt_screen">+ Create a resource</span><strong> </strong>button, you can click on <span class="packt_screen">App Services</span>—it will forward you to a different view, where you can create an App Service by clicking on the <span class="packt_screen">+ Add</span><strong> </strong>button. This is true for all of the most popular Azure services, such as SQL databases, virtual machines, and storage accounts.</div>
<p>As you can see, the Azure Portal tries to help you find the service most relevant to the search string. When you click on the <span class="packt_screen">Web App</span><em> </em>item, you will see another screen containing multiple similar items, all related in some way to the one you are searching for:</p>
<div class="CDPAlignCenter CDPAlign"><img src="Images/771e53e1-40c7-4474-a6c9-38cb3d536f89.png" style="width:55.67em;height:22.58em;" width="1151" height="467"/></div>
<p>For the purpose of this exercise, select <span class="packt_screen">Web App</span><em>, </em>and then click on the <span class="packt_screen">Create</span> button at the right bottom of the screen.</p>
<div class="packt_tip">In the beginning, it is always easier to select the most generic option when it comes to choosing a service. When you gain more experience and become more familiar with available services, you will see that Azure offers many useful preconfigured setups (such as an integrated Web App and SQL database), which can be used to shorten development and configure all services in one place.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Configuring an Azure web app</h1>
                </header>
            
            <article>
                
<p>When you click on the <span class="packt_screen">Create </span>button, you will see a screen where you can enter all the information needed to create a web app. All required fields are marked using an <span class="packt_screen">*</span> (asterisk) symbol:</p>
<div class="CDPAlignCenter CDPAlign"><img src="Images/3e19505b-02ec-4a46-9718-e0c32ebd700f.png" width="362" height="442"/></div>
<p>As you can see, when creating a web app, we have to fill almost all fields (with a little exception regarding the <span class="packt_screen">Application Insights</span><em> </em>radio button, which we will cover in the next chapters). Let's focus on each field separately, so we have a better understanding of how they work:</p>
<ul>
<li><span class="packt_screen">App name</span>: This field represents the domain name of your application. It is important to select both a unique and valid name, as it cannot be changed later on. Please note that you can easily attach your own custom domain if needed.</li>
<li><span class="packt_screen">Subscription</span>: If you have access to more than one subscription, you will be given an opportunity to select the right one for this particular resource. Thanks to that, you will be able to differentiate the cost between, for example, different projects.</li>
<li><span class="packt_screen">Resource Group</span>: In Azure, each resource has to be a part of a logic container, called a resource group. This does not imply any additional cost by itself, so you do not have to worry about creating multiple r<span>esource groups.</span></li>
<li><span class="packt_screen">OS</span>: Currently in Azure, you can create a web app using the different operating systems of <span class="packt_screen">Windows</span>, <span class="packt_screen">Linux</span>, or <span class="packt_screen">Docker</span> containers. This choice can impact both cost and performance, so make sure you have chosen the right operating system for your needs.</li>
<li><span class="packt_screen">App Service plan/Location</span>: App Services in Azure are directly linked to App Service Plans, which provide different features and performance depending on the option you choose. </li>
</ul>
<div class="packt_tip">It is always a good practice to leverage r<span>esource group</span>s and separate your resources using a specific filter, such as the lifetime of resources, or the given environment (that is, production, staging, or testing). Resource groups gives you better control over deployed services and allows for more granular control over who can access a resource.</div>
<p>Since you are just starting with Azure, you probably do not have any App Service Plans<em> </em>created. As we cannot create an App Service without an App Service Plan, we will sort this now.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Creating an App Service Plan</h1>
                </header>
            
            <article>
                
<p>When you click on <span class="packt_screen">App Service plan/Location</span>,<em> </em>you will see a screen with the <span class="packt_screen">+ Create new</span><strong> </strong>button, allowing for the creation of a new App Service Plan. It should look like this:</p>
<div class="CDPAlignCenter CDPAlign"><img src="Images/1acd596c-c079-47e0-ba22-7c53cc59b574.png" style="width:19.83em;height:16.50em;" width="288" height="240"/></div>
<p>As you can see, we have to enter three fields:</p>
<ul>
<li><span class="packt_screen">App Service plan</span>: This is the name of your App Service Plan, which has to be unique within a resource group.</li>
<li><span class="packt_screen">Location</span>: Thanks to this setting, we can locate our App Service Plan<em> </em>in a specific region. This sometimes implies different features are available.</li>
<li><span class="packt_screen">Pricing tier</span>: When you click on this item, you will see another screen presenting available features for different available tiers. This choice is really important feature-wise, and will depend in most cases on the environmental characteristics you are planning (such as <span class="packt_screen">Dev / Test</span> environments, <span class="packt_screen">Production</span> applications, whether you need deployment slots or not, and so on):</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="Images/edd53982-1497-4613-bf74-1c81e19b9245.png" width="1139" height="755"/></div>
<p>As you can see in the preceding screenshot, we have three categories of App Service Plans:</p>
<ul>
<li><span class="packt_screen">Dev / Test</span>: This one contains F, D, and B tiers (which stand for free, shared, and basic). They are designed for simple dev/test scenarios and lightweight web applications that do not need features such as autoscaling or backups.</li>
<li><span class="packt_screen">Production</span>: This offers powerful machines and advanced features that are useful in many realistic scenarios, <span>such as </span>APIs, e-commerce, and popular portals.</li>
<li><span class="packt_screen">Isolated</span>: This uses the same hardware as the <span class="packt_screen">Production </span>tier, but with even more features and possibilities to isolate your web apps from external access. This is the most expensive category, but can be helpful when creating systems that cannot be made available publicly. </li>
</ul>
<div class="packt_tip">It is important to remember that tiers F and D have a limited amount of computing time per day. That means that once you exceed the limit (60 minutes for the F tier, and 240 minutes for the D tier) of your processing time, your application <span>w</span><span>ill become unavailable and </span>be suspended until the next day. </div>
<p>For the purpose of this exercise, I would recommend selecting any tier from the <span class="packt_screen">Dev / Test</span><strong> </strong>category. Once you are satisfied with the option you've selected, you can click the <span class="packt_screen">Apply </span>button. My configuration, for example, looks like this:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/b9ca6d80-e7b8-43f8-a4ec-7d9ae54dbbb8.png" width="295" height="260"/></div>
<div class="packt_tip">Remember<span> that you can always upgrade (or scale up) the instance of your </span>App Service Plan, for example,<span> when you need a specific feature or the popularity of your application has grown. This is one of the biggest advantages of cloud over on-premises, where you would have to buy and set up new machines on your own.</span></div>
<p>Now, you can click <span class="packt_screen">OK</span>, and you will return to the <span class="packt_screen">Web App</span><em> </em>blade, where you can enter missing fields. Here, you can see the whole configuration of my web app:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/341e2e9e-587f-4f68-a505-7a8d334a420f.png" width="299" height="428"/></div>
<p>Now the only thing left is to click on the <span class="packt_screen">Create </span>button and wait several seconds for the creation of a new resource. During this time, Azure will validate the template and parameters, and orchestrate multiple underlying controllers to create a service. Once a new resource is created, you should see a notification and be able to see in your resources. To quickly validate this, click on the <span class="packt_screen">All resources</span><strong> </strong>button on the left and filter all of them using, for example, the name of the App Service<em> </em>you have created:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/2f37303d-c5eb-473e-bc8e-951577adbaf9.png" width="1015" height="408"/></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Creating an Azure App Service using Visual Studio</h1>
                </header>
            
            <article>
                
<p><span>If you do not want to create your</span> web apps <span>using the Azure Portal, you can use Microsoft Visual Studio, which has built-in integration for many different Azure services.</span></p>
<div class="packt_infobox">This exercise was created using Microsoft Visual Studio 2017 (15.6.4) with Azure workloads installed. If you want to configure your instance and ensure everything is set up correctly, please follow the short tutorial available at <a href="https://docs.microsoft.com/en-us/dotnet/azure/dotnet-tools?view=azure-dotnet&amp;tabs=windows">https://docs.microsoft.com/en-us/dotnet/azure/dotnet-tools?view=azure-dotnet&amp;tabs=windows</a>.</div>
<p class="mce-root"/>
<p class="mce-root"/>
<p>In Visual Studio, click on <span class="packt_screen">File</span> | <span class="packt_screen">New</span> <span class="packt_screen">Project</span>. This will display a <span class="packt_screen">New Project</span><em> </em>window, where you can find plenty of different templates for starting with a new application. Because we are interested in cloud projects, let's start with the <span class="packt_screen">Cloud </span>category:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/aeb13a1b-55c3-47e1-9634-f2d04dbb9f25.png" width="936" height="647"/></div>
<p>Since we are working with App Services <span>in this chapter</span>, the template we are interested in is <span class="packt_screen">ASP.NET Web Application (.NET Framework)</span>. The other valid option here is also <span class="packt_screen">ASP.NET Core Web Application</span>—feel free to use it if you feel confident enough to work with the latest .NET releases, as we will cover both scenarios. When you are satisfied with your choice, click <span class="packt_screen">OK</span>.</p>
<p class="mce-root"/>
<p>The next step is the selection of the proper template. Here, you have multiple options, such as the following:</p>
<ul>
<li><span class="packt_screen">Empty</span>: The most simple option, which lets you have full control over installed packages and overall structure</li>
<li><span class="packt_screen">Web Forms</span>: The oldest available framework for building web applications, using many built-in controls with data access</li>
<li><span class="packt_screen">MVC</span>: A well-known <strong>model-view-controller</strong> (<strong>MVC</strong>) architecture, which took the place of <span class="packt_screen">Web Forms</span></li>
<li><span class="packt_screen">Web API</span>: A template for creating RESTful HTTP services using the .NET programming stack</li>
<li><span class="packt_screen">Single Page Application</span>:<strong> </strong>This template comes with plenty of additional tools for building client-side interactions</li>
</ul>
<p>All the preceding options should be more or less familiar to you. However, thanks to installing the Azure toolset, you should have access to two additional templates:</p>
<ul>
<li><span class="packt_screen">Azure API App</span>: This offers additional integrations with different Azure services such as Azure AD, API Management, and Logic apps</li>
<li><span class="packt_screen">Azure Mobile App</span>: A template for building mobile backends</li>
</ul>
<p>However, we will cover those two in the next sections of this chapter. For now, to proceed, let's select <span class="packt_screen">MVC</span>,<span class="packt_screen"> </span>as this is the most common and simplest of all templates listed here. Use the default options for this template and click<span class="packt_screen"> </span><span class="packt_screen">OK</span>.</p>
<div class="packt_tip">You have probably noticed an additional button, which I have not described, <span class="packt_screen">Change Authentication</span>. It allows for selecting the method used for authenticating access to your web application. We will cover that feature in the section describing the security of web apps in Azure.</div>
<p>After several seconds, Visual Studio should generate a project based on the selected template. I believe it should look familiar to you, as it is not that different to a traditional web application created from an MVC template. I am sure you cannot wait to see whether it works—do not wait any longer, and press <em>F5</em> to start the application.</p>
<p class="mce-root"/>
<p class="mce-root"/>
<p>You should see a screen similar to mine:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/6f739326-3727-49fe-8c8a-170e349b1112.png" width="923" height="774"/></div>
<p>As you can see, it is the same generic template that you would see when starting with a traditional project. The question is, how can we deploy it to Azure to have our website working in the cloud? </p>
<p>Let's stop our website running locally and go back to Visual Studio for a moment. When you right-click on a project icon, you will see a context menu. There, between multiple different options, you can click on <span class="packt_screen">Publish...</span>:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/16afcf0b-dd55-4989-864d-ccff48f53076.png" width="511" height="391"/></div>
<p>Since this is a cloud project, you will see additional options besides <span class="packt_screen">IIS</span>, <span class="packt_screen">FTP</span>, and <span class="packt_screen">Folder</span>:</p>
<ul>
<li><span class="packt_screen">App Service</span>: This is for deploying your application to a PaaS service</li>
<li><span class="packt_screen">Azure Virtual Machines</span>: This is for deploying your application to a virtual machine that you have configured</li>
</ul>
<div class="packt_infobox">Because the topic of this book is PaaS services, we will not cover deploying a web app to a virtual machine. However, if you are interested in doing so, proper instructions are available at <a href="https://github.com/aspnet/Tooling/blob/AspNetVMs/docs/create-asp-net-vm-with-webdeploy.md">https://github.com/aspnet/Tooling/blob/AspNetVMs/docs/create-asp-net-vm-with-webdeploy.md</a>.</div>
<p>For now, let's select <span class="packt_screen">App Service</span>. You should see two different options:</p>
<ul>
<li><span class="packt_screen">Create new</span>: For deploying an application to a freshly created App Service</li>
<li><span class="packt_screen">Select existing</span>: This option is only useful if you have already deployed your site</li>
</ul>
<p class="mce-root"/>
<p>Because we are just starting, the option we are interested in is <span class="packt_screen">Create new</span>. After clicking on <span class="packt_screen">Publish...</span>, you will see another screen, where you can enter all the required parameters. If you read the previous section about creating an App Service using the Azure Portal, some fields should look familiar—in fact, you are doing the very same thing as you would do in the portal. If you skipped this section, I strongly recommend that you go back and read the descriptions. After configuring my web app, my screen looks like this:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/183d65d2-ea81-4327-9875-1fe3cc95a308.png" style="width:52.00em;height:38.83em;" width="795" height="594"/></p>
<div class="packt_tip">Remember that you can create both resource groups and App Service Plans directly from the preceding screen. If you do not like the options listed there, you can click on the <span class="packt_screen">New...</span><strong> </strong>button, which will guide you through the process of creating a new resource. This is another advantage of tools such as Visual Studio, as you do not have to leave your programming environment to work with Azure.</div>
<p>If you are satisfied with the current configuration, the last thing left is to click on the <span class="packt_screen">Create </span>button and wait a moment for the application deployment to complete. Additionally, Visual Studio will prepare a publish profile that you can reuse whenever you want to. We will have a look at it, as it will help us in the next section of this chapter. Once deployment is completed, you should see your web application open automatically in your default browser:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/b8c8ef3f-2beb-4407-b5e8-5d56b52a8325.png" style="width:44.83em;height:32.33em;" width="899" height="650"/></div>
<p>Congratulations! You have just created and deployed your very first App Service. If you take a look at the URL, you'll see that it contains the name you set in the Visual Studio wizard. All web apps in Azure can be accessed using the following URL format: </p>
<p class="mce-root"><kbd>http(s)://{appservicename}.azurewebsites.net</kbd></p>
<p>This also explains why a name has to be unique: since, by default, all web applications hosted as Azure Web Apps are available publicly, you have to select a name that is not already in use in another URL. In the next section, we will try to use FTP to deploy our application, as an alternative to using Visual Studio.</p>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Deploying Azure App Service using FTP</h1>
                </header>
            
            <article>
                
<p>Using Visual Studio for deployments is a good idea for testing things and development, but for sure, it cannot be used for deploying production environments. The easiest option to upload files to App Service is FTP, which is already integrated with this particular Azure resource.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Deploying Azure App Service with user-level credentials</h1>
                </header>
            
            <article>
                
<p>When you go to the Azure Portal and select the Web App you created previously, take a look at the <span class="packt_screen">Overview </span>screen—you will see plenty of information regarding this service, such as current <span class="packt_screen">Status</span>, <span class="packt_screen">Location</span>, and <span class="packt_screen">URL</span>. Among all that information, there is an FTP section containing three different parameters:</p>
<ul>
<li><span class="packt_screen">FTP/deployment username</span>: A name that you will use when connecting to your Web App using FTP client</li>
<li><span class="packt_screen">FTP hostname</span>: A host that should be used when creating an FTP connection</li>
<li><span class="packt_screen">FTPS hostname</span>: The same host as the previous one, but allowing for secure connection</li>
</ul>
<p>My App Service currently looks like this:</p>
<div class="CDPAlignCenter CDPAlign"><img src="Images/978663e6-b2ce-4cb1-9181-8a2d65d58517.png" width="1296" height="347"/></div>
<p>All FTP information can be found in the bottom-right corner of the whole section. What we need now is the FTP client that we will use to connect to the server. I do not have any particular recommendation when it comes to selecting such an application. Personally, I prefer using <span class="packt_screen">FileZilla </span>for managing my FTP connections and file transfers. You can, however, use whichever client you like, as all are quite similar regarding functionality. Before we start uploading files to the server, we need one more thing, a password for the user. To generate a new password, go to the <span class="packt_screen">Deployment credentials</span><strong> </strong>blade, which can be found on the left in the <span class="packt_screen">DEPLOYMENT </span>section of App Service<em> </em>features:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/87297fca-c084-423e-8cd9-8fcdca858e88.png" style="width:43.83em;height:29.00em;" width="698" height="462"/></div>
<p>Here, you can set two fields:</p>
<ul>
<li>Username for FTP user</li>
<li>Password for this particular user</li>
</ul>
<p class="mce-root"/>
<p class="mce-root"/>
<p>You may wonder how this is connected to the previous username, which can be found on the <span class="packt_screen">Overview </span>screen. The difference is quite simple: using <span class="packt_screen">Deployment credentials</span>,<strong> </strong>you are creating a new user that will be used for all applications in all subscriptions associated with your Microsoft Azure account. This has the implication that you will be able to use the very same credentials for each App Service you deploy. This is not ideal for every scenario you will face, but for the purpose of this exercise, let's set a user and use it for deployment. In the next part of this section, I will show you how to retrieve credentials from a <span class="packt_screen">Publish Profile</span> generated by Visual Studio. Once you enter a username and a password, press <span class="packt_screen">Save</span>. Now, we can go to the FTP client and use these credentials for setting a connection. Here, you can see my configuration (note that your username has to be in the following format: <kbd>&lt;appservicename&gt;\&lt;ftpusername&gt;</kbd>):</p>
<div class="CDPAlignCenter CDPAlign"><img src="Images/2bdd1d05-5ceb-46bd-8da2-7c66a8156418.png" width="743" height="204"/></div>
<p>Once you connect to a server, you will see a list of available directories. The very first level contains the following:</p>
<ul>
<li><kbd>LogFiles</kbd>: Files containing diagnostic information regarding running App Service</li>
<li><kbd>site</kbd><strong>:</strong> Your Web App working files are stored here</li>
</ul>
<p>We will cover <kbd>LogFiles</kbd> in the next sections of this chapter, describing monitoring and diagnosing an application. For now, we are interested in the <kbd>site</kbd> folder. When you enter it, you will see other directories: <kbd>deployments</kbd>, <kbd>locks</kbd>, and <kbd>wwwroot</kbd>. The last one should be familiar for those of you who have worked with IIS, as this is the most common name of the folder containing a web application. In fact, this is the working directory of your App Service, where all necessary files should be uploaded. Here, you have the full structure of an empty web app:</p>
<div class="CDPAlignCenter CDPAlign"><img src="Images/843f9e08-7b23-4939-920f-680c6d0538c3.png" width="617" height="298"/></div>
<p>Now that you know how App Service is structured, you can deploy your files and see whether or not it works. If you want, you can reuse a project from the previous exercise, or upload a brand new website. </p>
<div class="packt_tip">If you want to reuse files, you can publish a project once again, but this time, instead of publishing it directly to Azure, create a new <span class="packt_screen">Publish Profile</span> and use a folder as the target. Once Visual Studio finishes creating the package, simply copy files from the output directory to the FTP location using your FTP client.</div>
<p>Here are the files from a previous project of mine uploaded to my FTP server:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/3586dd63-2c54-40bc-b4c1-06fc1e498303.png" style="width:45.08em;height:34.33em;" width="613" height="466"/></div>
<p>Now, when I go to the URL of my website, I will see a working application:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/e34dcfcc-4b1d-4f04-a647-4780e28147b2.png" style="width:46.33em;height:31.58em;" width="878" height="601"/></div>
<p>Great—you have just learned how to leverage the FTP feature of App Services to deploy an application from any location and environment. However, as I mentioned earlier, we are using user-level credentials, which will be the same for all web apps that you deploy within your subscription. How do we achieve the same result using an app-level username and password?</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Deploying Azure App Service using app-level credentials</h1>
                </header>
            
            <article>
                
<p>There are two ways to deploy an application using app-level credentials:</p>
<ul>
<li>Download them from the Azure Portal</li>
<li>Configure WebDeploy in Visual Studio</li>
</ul>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Downloading app-level credentials from the Azure Portal</h1>
                </header>
            
            <article>
                
<p>When you go to your App Service and click on the <span class="packt_screen">Overview </span>blade, you will see the <span class="packt_screen">Get publish profile</span><strong> </strong>button at the top, as shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="Images/6e246ee7-9b44-4cac-a7f0-12b9d1a867f2.png" width="936" height="146"/></div>
<p>Now, when you click on it, your browser will download a <kbd>.PublishProfile</kbd><strong> </strong>file. Please open it to check its content. Here is an example file from my web app:</p>
<pre class="mce-root">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br/> &lt;publishData&gt;<br/> &lt;publishProfile profileName="cloudcomrade01 - Web Deploy" publishMethod="MSDeploy" publishUrl="cloudcomrade01.scm.azurewebsites.net:443" msdeploySite="cloudcomrade01" userName="$cloudcomrade01" userPWD="LEebknaDdg0KS6SgScLuXlwtzxvwYway7ssoKxCSkCLi6Gw0HRyt2iEGMLbP" destinationAppUrl="http://cloudcomrade01.azurewebsites.net" SQLServerDBConnectionString="" mySQLDBConnectionString="" hostingProviderForumLink="" controlPanelLink="http://windows.azure.com" webSystem="WebSites"&gt;<br/> &lt;databases /&gt;<br/> &lt;/publishProfile&gt;<br/> &lt;publishProfile profileName="cloudcomrade01 - FTP" publishMethod="FTP" publishUrl="ftp://waws-prod-am2-197.ftp.azurewebsites.windows.net/site/wwwroot" ftpPassiveMode="True" userName="cloudcomrade01\$cloudcomrade01" userPWD="LEebknaDdg0KS6SgScLuXlwtzxvwYway7ssoKxCSkCLi6Gw0HRyt2iEGMLbP" destinationAppUrl="http://cloudcomrade01.azurewebsites.net" SQLServerDBConnectionString="" mySQLDBConnectionString="" hostingProviderForumLink="" controlPanelLink="http://windows.azure.com" webSystem="WebSites"&gt;<br/> &lt;databases /&gt;<br/> &lt;/publishProfile&gt;<br/> &lt;/publishData&gt;</pre>
<p>As you can see, it is a simple XML file containing plenty of useful information. What we are interested in currently is both the <kbd>userName</kbd> and <kbd>userPWD</kbd> properties. Those are what we have been searching for—app-level credentials automatically created on App Service<em> </em>creation. You can use these instead of the user-level ones that we created previously.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Configuring WebDeploy in Visual Studio</h1>
                </header>
            
            <article>
                
<p>To check how to configure <strong>WebDeploy </strong>in Visual Studio, please go through all steps from the beginning of <em>Creating an Azure App Service using Visual Studio</em> section about publishing an application from this IDE. If you have done that, go once more to the <span class="packt_screen">Publish </span>screen.</p>
<div class="packt_tip"><span>If you want to import a publish profile from the previous section, then on the </span><span class="packt_screen">Publish </span><span>screen, you can click on the </span><span class="packt_screen">New Profile...</span><strong> </strong><span>button and then select the </span><span class="packt_screen">Import Profile...</span><strong> </strong><span>option, which allows you to select a profile file generated previously.</span></div>
<p>When you click on the <span class="packt_screen">Configure </span>button, you will see another window containing the whole configuration of your deployment:</p>
<div class="CDPAlignCenter CDPAlign"><img src="Images/f0cd688f-39a8-43f1-b8e5-c07f0164051f.png" style="width:43.50em;height:33.92em;" width="698" height="544"/></div>
<p>As you can see, it contains a completely different set of information, which does not reflect the user-level settings you have configured. </p>
<p class="mce-root"/>
<p class="mce-root"/>
<div class="packt_infobox">Please do remember the difference between user-level and app-level credentials. Note that multiple users with access to a given app can use their own user-level credentials individually. What is more, to be able to use app-level credentials, you have to have at least a <span class="packt_screen">Contributor </span>role on a specific App Service. If you are only a <span class="packt_screen">Reader</span>, you will not able to access those credentials. </div>
<p>The choice between app-level and user-level credentials depends solely on the process of delivering your application. In most cases, <span>you don't need to check</span> by checking and setting them, as tools such as Visual Studio or Azure DevOps (formerly Visual Studio Team Services) obtain and use them implicitly. App-level credentials are often only used when we are in need of manual deployment.</p>
<div class="packt_tip">You can always reset app-level credentials (for instance, if current ones should be revoked, because of some kind of security issue) from the <span class="packt_screen">Overview </span>blade. Next to the <span class="packt_screen">Get publish profile</span><strong> </strong>button, you can find the <span class="packt_screen">Reset publish profile </span>option, which will set a new username and password.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Creating Azure App Services using Visual Studio Code</h1>
                </header>
            
            <article>
                
<p>Microsoft Visual Studio is not the only available IDE that allows you to work with Azure App Services. Because this Azure service supports different technology stacks, including .NET, JS, PHP, Java, and so on, you can easily leverage its capabilities to host different websites using different runtimes. For instance, let's assume that we have the following PHP code that displays a <kbd>Hello World</kbd> message:</p>
<pre>&lt;?php<br/>echo('Hello world from Azure App Service - PHP here!');<br/>?&gt;</pre>
<p>Such a simple PHP application can be easily created in any available IDE that supports the PHP language. For the purpose of this exercise, I chose Visual Studio Code, an open source editor, as it can easily <span>be</span><span> </span><span>extended using many different plugins. To make things easier, you can install the following extensions:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/e213c125-f54c-43ce-a198-d28d15adb053.png" width="1188" height="410"/></p>
<p>With this plugin installed, you will be able to easily deploy your applications from within the IDE, without the need to go to the portal or use other methods. To push the application to the cloud, you have to go to the <span class="packt_screen">AZURE </span>tab and find the <span class="packt_screen">APP SERVICE</span><strong> </strong>section. </p>
<div class="packt_infobox">Before the first use of these extensions, you may need to authenticate them. Follow the displayed instructions and Visual Studio Code will connect to your subscriptions.</div>
<p>Before we deploy our simple PHP application, we have to create an Azure App Service. To do so, you will have to click on the <span class="packt_screen">Create New Web App...</span><strong> </strong>button:</p>
<div class="CDPAlignCenter CDPAlign"><img src="Images/7689d233-0ff5-4d2b-bbe0-d3bf1b03816b.png" width="559" height="179"/></div>
<p>The wizard is a little bit different than in Microsoft Visual Studio, as it acts similarly to a command line, where you provide all fields and information one after another. In Visual Studio Code, you will have to enter the following:</p>
<ul>
<li>The Azure App Service name</li>
<li>The operating system of your choice</li>
<li>The runtime version</li>
</ul>
<p>In this particular example, I specified the following:</p>
<ul>
<li><kbd>handsonazure-euw-appservice</kbd></li>
<li>Linux</li>
<li>PHP 7.2</li>
</ul>
<p>Once the provisioning is complete, Visual Studio Code will ask you whether to deploy the application. Select <span class="packt_screen">OK</span>,<strong> </strong>and then choose the folder to deploy to:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/25bb7477-17dc-434d-b7ea-7c9195c15211.png" width="680" height="141"/></p>
<p>Once everything is set and ready, you will see a notification informing you that you are now able to browse the website:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/bd67d5a7-a495-4469-9717-322512740203.png" style="width:33.58em;height:9.92em;" width="467" height="138"/></p>
<p>When you click on the <span class="packt_screen">Browse Website</span><strong> </strong>button, you will be forwarded to the freshly deployed web application. Note that this extension allows you to directly manage the service from within the IDE, and gives you access to different features, including application settings, deployment slots, and Azure WebJobs (the latter of which is described in <a href="9d2dde2d-9d55-4da6-b914-aa66281f1d80.xhtml" target="_blank">Chapter 2</a>, <em><span>Azure WebJobs</span></em>). Here, you can see the working example hosted within Azure:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/aaac4515-da58-477f-82c0-ba3a286714fa.png" style="width:25.08em;height:6.92em;" width="381" height="105"/></p>
<p>The important thing here is that by using the same path, you will be able to host a variety of different runtimes inside different Azure App Services. It doesn't matter whether it is a Java application, a Python script, or a Node.js backend—they are all supported and can be easily developed using IDEs such as Visual Studio Code.</p>
<div class="packt_tip">When using Visual Studio Code with the presented extension, you might want to have more control over the creation of a resource. To enable <span class="packt_screen">Advanced Creation</span>, go to the <span class="packt_screen">File</span> | <span class="packt_screen">Preferences</span> | <span class="packt_screen">Settings</span> window, find the <span class="packt_screen">Extensions</span><strong> </strong>section, and then click on the <span class="packt_screen">App Service: Advanced Creation </span>checkbox.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Working with different operating systems and platforms</h1>
                </header>
            
            <article>
                
<p>Currently, App Services supports a couple of different configurations when it comes to selecting operating system, runtime, and a platform. The following are some of the possible options for running your website using App Services:</p>
<ul>
<li><span class="packt_screen">.NET Core </span></li>
<li><span class="packt_screen">.NET Framework</span></li>
<li><span class="packt_screen">Node.js</span></li>
<li><span class="packt_screen">PHP</span></li>
<li><span class="packt_screen">Java</span></li>
<li><span class="packt_screen">Python</span></li>
<li><span class="packt_screen">Static HTML website</span></li>
</ul>
<p class="mce-root"/>
<p class="mce-root"/>
<p>Additionally, you can select a platform (<span class="packt_screen">32-bit</span><strong> </strong>or <span class="packt_screen">64-bit</span>), HTTP version (<span class="packt_screen">1.1 </span>or <span class="packt_screen">2.0</span>), and underlying operating system (<span class="packt_screen">Windows</span>, <span class="packt_screen">Linux</span>, or <span class="packt_screen">Container</span>). Let's start by selecting a proper operating system for our application.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Selecting an operating system</h1>
                </header>
            
            <article>
                
<p>To select an operating system to run your web app, we have to create a new application in Azure. Currently, there is no possibility to change this setting after an App Service is created. To create a new website, go to the Azure Portal and click on <span class="packt_screen">+ Create a resource</span>. On the new screen, search for <kbd>Web App</kbd><strong> </strong>and select the first item displayed (or just return to the beginning of the <em>Selecting Azure Web App from available services</em> section and perform all the steps mentioned there).</p>
<p>On the <span class="packt_screen">Web App - Creat</span><span class="packt_screen">e</span><strong> </strong>screen, you have an <span class="packt_screen">OS</span> field. You'll have three options:</p>
<ul>
<li><span class="packt_screen">Windows</span>: The most common option for .NET applications, suitable for running .NET Framework, Java, Node.js, or PHP sites.</li>
<li><span class="packt_screen">Linux</span>: If you have an application written in .NET Core, you can leverage this <span>operating system </span>and its unique features. Additionally, you can run Java, Node.js, PHP, and Python applications as well.</li>
<li><span class="packt_screen">Docker</span>: Offers Web App for Containers, which we'll cover later in this book. Besides running all of the previous platforms, it allows hosting applications written in languages not currently supported in App Services (such as Go, for example).</li>
</ul>
<p>The choice is yours. Each operating system has different characteristics: <span class="packt_screen">Linux</span><strong> </strong>is perfect for running Python applications, as <span class="packt_screen">Windows </span>has some performance issues regarding this language; on the other hand, you may have many websites written in .NET Framework, which are optimized for <span class="packt_screen">Windows </span>systems. Each of the operating system options also has different pricing. Let's compare <span class="packt_screen">Windows </span>and <span class="packt_screen">Linux </span>here:</p>
<table style="border-collapse: collapse;width: 100%" border="1">
<tbody>
<tr>
<td class="CDPAlignLeft CDPAlign"/>
<td class="CDPAlignLeft CDPAlign"><span class="packt_screen"><span>BASIC</span></span></td>
<td class="CDPAlignLeft CDPAlign"><span><span class="packt_screen">STANDARD</span></span></td>
<td class="CDPAlignLeft CDPAlign"><span><span class="packt_screen">PREMIUM</span></span></td>
<td><span><span class="packt_screen">ISOLATED</span></span></td>
</tr>
<tr>
<td>Price per hour (Linux)</td>
<td>$0.071</td>
<td>$0.095</td>
<td>$0.19</td>
<td>N/A</td>
</tr>
<tr>
<td>Price per hour (Windows)</td>
<td>$0.075</td>
<td>$0.10</td>
<td>$0.20</td>
<td>$0.40</td>
</tr>
</tbody>
</table>
<p> </p>
<p class="mce-root">As you can see, there are small differences between these two <span>operating systems</span>. More importantly, Linux does not <span>currently </span>support the<span> </span><span class="packt_screen">Free</span><span> and </span><span class="packt_screen">Shared </span>tiers. The <span class="packt_screen">Isolated </span>tier is currently in public preview, and should not be used for production workloads, but this, of course, can change in the future. When you have considered all the pros and cons, you can create an App Service powered by the operating system of your choice.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Selecting different platforms</h1>
                </header>
            
            <article>
                
<p>In the previous section, you learned how to choose a proper <span>operating system</span> for your application. This is, of course, not everything needed to run a website—you have to also enable a specific language if you want to deploy, for example, PHP code. To do so, go to your App Service (you have many options by which to do this: either choose <span class="packt_screen">App Services</span><strong> </strong>from the Azure Portal menu on the left and select your <span class="packt_screen">Web App</span>, or go to the resource group<strong> </strong>you created by choosing it from <strong>R</strong><span class="packt_screen">esource Groups</span><strong> </strong>blade) and then select the <span class="packt_screen">Application settings</span> blade:</p>
<div class="CDPAlignCenter CDPAlign"><img src="Images/30e6556d-dad5-4462-b998-093703f180fc.png" style="width:50.92em;height:40.17em;" width="841" height="663"/></div>
<p>Initially, you could feel a bit overwhelmed by all those options available, but soon, as you gain more and more experience, all will become clear. You might have noticed the <span class="packt_screen">Upgrade to enable</span><strong> </strong>links here—some features, such as <span class="packt_screen">Platform </span>or <span class="packt_screen">Always On</span>,<strong> </strong>are only available from the <span class="packt_screen">B1</span><strong> </strong>tier upward.</p>
<div class="packt_tip">Remember that the <span class="packt_screen">Always On</span><strong> </strong>feature could become crucial in some specific scenarios, as it defines whether your application is always running or not (so it can become idle when no one uses it). As you will learn in the coming sections, setting <span class="packt_screen">Always On </span>to <span class="packt_screen">On </span>is required when running, for example, continuous Web Jobs or Azure Functions.</div>
<p>Currently, we are interested in all options mentioning a programming language. These options include the following:</p>
<ul>
<li><span class="packt_screen">.NET Framework version </span></li>
<li><span class="packt_screen">PHP version</span></li>
<li><span class="packt_screen">Python version</span></li>
<li><span class="packt_screen">Java version</span></li>
</ul>
<p>By default, your App Service supports two languages: <span class="packt_screen">.NET Framework <span>version </span></span>and <span class="packt_screen">PHP <span>version</span></span>. To run, for instance, Python or Java, you would have to set an appropriate setting to a specific version such as enable Java support using Java version dropdown.</p>
<div class="packt_tip">As mentioned earlier, always select the correct operating system powering your App Service, depending on the language that you chose for your application. While it is possible to run PHP or Python on Windows, selecting Linux, is recommended, could be recommended, as many libraries and packages can run only under this particular <span>operating system</span>. </div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Working with application settings
</h1>
                </header>
            
            <article>
                
<p>The <span class="packt_screen">Application settings</span><strong> </strong>blade offers more than simply enabling or disabling available features. When you scroll down, you will see additional sections, including the following:</p>
<ul>
<li><span class="packt_screen">Debugging</span>: If you want to enable remote debugging, you can toggle the <span class="packt_screen">Remote debugging</span><strong> </strong>option to <span class="packt_screen">On</span>. This will allow you to set the Visual Studio version that you would like to use to debug your application locally.</li>
<li><span class="packt_screen">Application settings</span>: This section contains settings used by your application while running.</li>
<li><span class="packt_screen">Connection strings</span>: You can define a connection string for your website directly in the Azure Portal.</li>
<li><span class="packt_screen">Default documents</span>: If you would like to have a custom default document (that is, the starting point of your application), you can set it in this section.</li>
<li><span class="packt_screen">Handler mappings</span>: Sometimes, you need to specify a custom handler for a specific file extension or URL. Here, you can add the appropriate configuration to do so.</li>
<li><span class="packt_screen">Virtual applications and directories</span>: If you need to have multiple applications in your App Service, you can map virtual paths to a physical path here. </li>
</ul>
<div class="packt_tip">Remember that <span class="packt_screen">Application settings</span><strong> </strong>for .NET applications are injected at runtime and will override existing settings stored in your <kbd>web.config</kbd>. When it comes to other platforms (.NET, Java, Node.js), settings from this section will be injected as environment variables, to which you can refer. This is also true for <span class="packt_screen">Connection strings</span>.</div>
<p><span><span class="packt_screen">Application settings</span> in Azure are always encrypted when stored. What is more, you can easily secure them by disallowing all users from accessing them. </span></p>
<div class="packt_tip"><span class="packt_screen">Connection strings </span>for platforms other than .NET are always prefixed with appropriate connection type. There are four possibilities: <span><kbd>SQLCONNSTR_</kbd>, <kbd>MYSQLCONNSTR_</kbd>, <kbd>SQLAZURECONNSTR_</kbd></span>, <span>and <kbd>CUSTOMCONNSTR_</kbd>.</span></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Different App Service Plans and features</h1>
                </header>
            
            <article>
                
<p>We touched on this topic at the beginning of this chapter, so you should have an idea of what we are going to cover now. As you remember, when App Service is created, you have to select (or create) an App Service Plan, which defines both available performance and additional features. Let's cover all three categories, this time focusing on the differences between each tier.</p>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Dev/Test App Service Plans</h1>
                </header>
            
            <article>
                
<p>App Service Plans designed for development and testing environments can be found in the <span class="packt_screen">Dev / Test</span><strong> </strong>category:</p>
<div class="CDPAlignCenter CDPAlign"><img src="Images/31d3eab0-f5a8-45cb-856e-5d03459fa3de.png" width="1276" height="636"/></div>
<p>We have three different tiers available:</p>
<ul>
<li><strong>F1 (Free)</strong>: The most basic option, with shared infrastructure, 1 GB of memory available, and 60 minutes of compute per day. When using shared tiers, some features of App Services are unavailable (such as <span class="packt_screen">Always on</span>, or your selected platform). F1 is perfect for quick-testing or deploying an application for a presentation or demonstration. You will not be charged for using this App Service Plan.</li>
<li><strong>D1 (Shared)</strong>: Similar to <span class="packt_screen">F1</span>, but this also allows for setting a custom domain for your App Service. What is more, you can run your application four times longer than when using the free tier. Still, this is shared infrastructure, so some features cannot be used. </li>
<li><strong>B1</strong>: The first tier recommended for running production workloads. It guarantees dedicated A-series machines, and more memory and storage. It is also the first tier that you can scale—although only manually. The <span class="packt_screen">Basic </span>tier comes with additional versions (<span class="packt_screen">B2 </span>and <span class="packt_screen">B3</span>), which provide more compute power.</li>
</ul>
<div class="packt_infobox">If you are obligated to run your application in Azure in services defined by a <strong>service level agreement</strong> (<strong><span>SLA</span></strong>), remember that you cannot use the <span class="packt_screen">Free </span>or <span class="packt_screen">Shared </span>tiers, as they do not support this.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Production App Service Plans</h1>
                </header>
            
            <article>
                
<p>In this category, there are many more options when it comes to choosing different features available. Remember that, in terms of hardware, the <span class="packt_screen">Basic </span>tier offers the very same performance as the <span class="packt_screen">Standard </span>tier:</p>
<div class="CDPAlignCenter CDPAlign"><img src="Images/0310b053-421f-458b-973d-c10243faeeaa.png" width="1281" height="523"/></div>
<p>Here, we can choose between the following:</p>
<ul>
<li><strong>Standard (S1)</strong>: The same A-series as <span class="packt_screen">B1</span>. What we are getting here is autoscaling, staging slots, backups, and the possibility to use Traffic Manager (which will be described in coming chapters). This is the best tier for most production applications, as it supports blue-green deployment scenarios and can handle a bigger load (thanks to integration with Traffic Manager). If you need more compute power, you can choose either <span class="packt_screen">S2 </span>or <span class="packt_screen">S3</span>.</li>
<li><strong>Premium (P1v2)</strong>: This is the new recommended option replacing <span class="packt_screen">P1</span>,<span class="packt_screen"> </span>with new Dv2-series virtual machines underneath. It offers better performance and higher limits when it comes to scaling (a maximum of 20 instances, compared to 10 in <span class="packt_screen">Standard</span>) and staging slots. You also have the option to choose <span class="packt_screen">P2</span><strong> </strong>or <span class="packt_screen">P3</span>.</li>
</ul>
<div class="packt_tip">Remember that the maximum amount of instances in particular tiers is subject to availability. In most cases, these are only soft limits that can be raised after contacting support.</div>
<p>In general, <span class="packt_screen">Standard </span>should meet most requirements when it comes to performance, reliability, and automation possibilities. However, if you are going to run a very popular website in Azure, you may need Premium, as it offers more flexibility and better scalability.</p>
<div class="packt_infobox">One of the most important things to remember is how scaling affects the pricing. In general, you have two options: either you scale up (changing tier to a higher one) or scale out (by deploying multiple instances of the same application). If you are paying, for example, $40 for an <span class="packt_screen">S1 </span>instance, when you scale out to 10 instances, you will pay $400 in total—$40 for each instance running.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Isolated App Service Plans</h1>
                </header>
            
            <article>
                
<p>Sometimes you need even more than the <span class="packt_screen">Premium </span>tier has to offer. Maybe you have to isolate your application from an external network. Maybe you would like to offer access only to some specific users. Maybe 20 instances are still not enough. This is why Azure introduced the <span class="packt_screen">Isolated </span>category:</p>
<div class="CDPAlignCenter CDPAlign"><img src="Images/8bc3bdba-cca3-46ad-bfc8-2e029c961323.png" width="925" height="223"/></div>
<p>In this category, we have only one tier divided into three versions:</p>
<ul>
<li><strong>Isolated (I1/I2/I3)</strong>: The same virtual machines as in the <span class="packt_screen">Premium </span>tier (<span class="packt_screen">Dv2</span>). Also includes huge storage to store your files (1 TB), private app access, an integrated virtual network (so you can access, for example, internal applications), and a more stable environment. This is the most expensive tier, but offers the most when it comes to functionality and the range of features provided.</li>
</ul>
<div class="packt_tip">In general, the <span class="packt_screen">Isolated </span>tier is the most stable one when it comes to handling a huge load. While <span class="packt_screen">Standard </span>or <span class="packt_screen">Premium</span><strong> </strong>tiers become unresponsive pretty quickly when utilization hits 100%, <span class="packt_screen">Isolated </span>App Services need more time to return the <kbd>HTTP 503 Service Unavailable</kbd> response. Take this into account if you need a really reliable service that cannot be broken easily.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Securing App Services using different security providers</h1>
                </header>
            
            <article>
                
<p>Most web applications have to be secured in some way, either by using your own security system or third-party identity providers, such as Facebook, Google, or Twitter. While working with the traditional application hosted on-premises, you often have to configure everything on your own. PaaS solutions, such as Azure App Services, already possess this functionality and make it easily accessible, thanks to the <span class="packt_screen">Authentication / Authorization</span><strong> </strong>feature. In this section, you will learn how to set it <span>up</span><span> </span><span>so users will be prompted to log in. </span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Configuring authentication/authorization in the Azure Portal</h1>
                </header>
            
            <article>
                
<p>As with most PaaS services, you can configure the features of App Services directly from the portal. Thanks to such an approach, you have all options in one place and can easily switch between them.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Using Azure Active Directory to secure App Services</h1>
                </header>
            
            <article>
                
<p>Go to your App Service and the find <span class="packt_screen">Authentication / Authorization</span><strong> </strong>blade on the left, next to <span class="packt_screen">Application settings</span> as mentioned previously. When you click on it, you will see a screen for configuration:</p>
<div class="CDPAlignCenter CDPAlign"><img src="Images/b0ba9ede-94cf-4148-bbd9-992babd591ad.png" style="width:52.75em;height:40.67em;" width="840" height="648"/></div>
<p>As you can see, it is <span>currently</span><span> </span><span>disabled. When you toggle the </span><span class="packt_screen">App Service Authentication</span><strong> </strong><span>feature to </span><span class="packt_screen">On</span><span>, you will see new options available, with which you can configure authentication for your web app:</span></p>
<div class="CDPAlignCenter CDPAlign"><img src="Images/cacac686-cce8-4e64-8286-edc9d4634693.png" style="width:43.67em;height:46.42em;" width="705" height="750"/></div>
<p>Change the <span class="packt_screen">Action to take when request is not authenticated</span> field to any value available. The portal will display the following information:</p>
<div><kbd>To enable Authentication / Authorization please ensure all your custom domains have corresponding SSL bindings .net version is configured to "4.5" and manage pipeline mode is set to "Integrated".</kbd></div>
<p>Since we do not have a custom domain now, no action needs to be taken. The same applies to the .NET version and pipeline mode—if you have not changed the default parameters of your application, everything should be set correctly already. Let's now select one authentication provider and configure it—we will start with Azure Active Directory.</p>
<div class="packt_infobox">You do not have to be an expert with Azure <span>Active Directory </span>to use it with App Service, especially now there is the possibility to let the Azure Portal configure it for you. However, if you would like to learn more about this service, the best place to start is its documentation: <a href="https://docs.microsoft.com/en-us/azure/active-directory/active-directory-whatis">https://docs.microsoft.com/en-us/azure/active-directory/active-directory-whatis</a>. </div>
<p>When you click on the <span class="packt_screen">Azure Active Directory</span><em> </em>option, you will see a new screen where you can configure integration. Firstly, you have to select the <span class="packt_screen">Management Mode</span>:</p>
<ul>
<li><span class="packt_screen">Off</span>: Azure <span>Active Directory </span>authentication is disabled.</li>
<li><span class="packt_screen">Express</span>: A quick way to configure authentication for your App Service using Azure AD. You will have to either select an already existing Azure <span>Active Directory </span>application or let the Azure Portal create a new one for you. </li>
<li><span class="packt_screen">Advanced</span>: If <span class="packt_screen">Express </span>is not enough for you, you can always enter all necessary parameters on your own. With this option, you will be able to configure integration by providing information about <span class="packt_screen">Client ID</span>, <span class="packt_screen">Issuer URL</span>, and optionally, <span class="packt_screen">Client Secret</span>. All of these parameters can be found when browsing your Azure <span>Active Directory </span>application.</li>
</ul>
<p>To start, I recommend using the <span class="packt_screen">Express </span>option, as configuring applications in Azure Active Directory is beyond scope of this book. For now, you only need to provide a name for the application and click <span class="packt_screen">OK</span>. You will go back to the previous screen, where you should be able to see that one authentication provider is already configured:</p>
<div class="CDPAlignCenter CDPAlign"><img src="Images/da5b0ab5-905a-4477-9208-88f69e761e2f.png" style="width:35.75em;height:42.58em;" width="630" height="751"/></div>
<p>Now, let's click the <span class="packt_screen">Save </span>button. After a moment, everything should be set and you can <span>now</span><span> </span><span>access your application to see whether securing it works. Go to the </span><span class="packt_screen">Overview </span><span>blade and click on th</span>e URL lin<span>k, or enter it directly in your browser. When a default page is loaded, you will not see it, but rather will be redirected to the login page.</span></p>
<p class="mce-root"/>
<div class="packt_infobox">For this particular exercise, I have assumed that you have your application already deployed. If you have not, please go back to the previous sections and deploy your code with either <span>Visual Studio</span> or FTP.</div>
<p>Since we configured Azure <span>Active Directory </span>as our authentication provider, a user will be asked to give this particular application consent to access their information. </p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Using other authentication providers</h1>
                </header>
            
            <article>
                
<p>As you can see, Azure <span>Active Directory </span>is not the only security provider available for App Services. We can select Facebook, Google, or even Twitter to handle authentication and authorization for us. This is especially helpful when you have a public application for people using different social media websites, as they can use their accounts from other applications and quickly sign in when entering your website. To use other authentication providers than Azure <span>Active Directory,</span> you have to create an application in one of the mentioned portals. In fact, there is no difference whether you select Facebook, Google, or Twitter—you will have to provide two fields:</p>
<ul>
<li>An <span class="packt_screen">App ID</span> and <span class="packt_screen">App Secret</span><strong> </strong>for Facebook</li>
<li>A <span class="packt_screen">Client Id</span> and <span class="packt_screen">Client Secret</span><strong> </strong>for Google</li>
<li>An <span class="packt_screen">API Key</span> and <span class="packt_screen">API Secret</span><strong> </strong>for Twitter</li>
</ul>
<div class="packt_infobox">We will not cover in this book how to create an application in other authentication providers. However, proper instructions can be found at <a href="https://developers.facebook.com/docs/apps/register/">https://developers.facebook.com/docs/apps/register/</a>, <a href="https://developers.google.com/identity/sign-in/web/sign-in">https://developers.google.com/identity/sign-in/web/sign-in</a>, <a href="https://developer.twitter.com/en/docs/basics/authentication/guides/access-tokens.html">https://developer.twitter.com/en/docs/basics/authentication/guides/access-tokens.html</a>.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Diagnostics and monitoring of App Services</h1>
                </header>
            
            <article>
                
<p>The last section of this chapter will show you how you can diagnose and monitor App Services that you've deployed. Those operations are crucial when you have a working application, as errors and performance issues always crop up, especially in popular services. Thanks to multiple integrated tools in Azure Web Apps, you can be sure that you'll always have enough information to find and fix a problem.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">The Overview blade</h1>
                </header>
            
            <article>
                
<p>The very first thing you probably already noticed is the charts visible in the <span class="packt_screen">Overview </span>blade:</p>
<div class="CDPAlignCenter CDPAlign"><img src="Images/8ad509a0-6f14-48dd-a8c8-54e6368bee46.png" width="1353" height="667"/></div>
<p>They provide basic insight into the behavior of your application, such as data transfer, the number of requests, or HTTP 500 errors. Let's click on any of those charts—you will see another important screen, which we will look at now.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Metrics</h1>
                </header>
            
            <article>
                
<p>The <span class="packt_screen">Metrics </span>blade gives you more detailed information and a better view of a specific parameter. On the left, there are many different metrics to choose from. You create your own chart by selecting more than only one parameter.</p>
<div class="packt_tip">Remember that you can only choose metrics of the same unit—there is no possibility, for example, to connect the number of loaded assemblies and average response time.</div>
<p>On this screen, you can also change the chart's time range. This is very useful when searching for related issues (such as <span class="packt_screen">Data In</span><strong> </strong>and <span class="packt_screen">Memory working set</span><strong> </strong>to check how much memory your application needs to handle incoming data).</p>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Monitoring</h1>
                </header>
            
            <article>
                
<p>Let's go back to the main screen of App Service. There, when you scroll down, you will see a <span class="packt_screen">MONITORING </span>section containing even more useful features.</p>
<p>Click on the <span class="packt_screen">Log stream</span><strong> </strong>blade. You will see a black screen with the following information:</p>
<div><kbd>Application logs are switched off. You can turn them on using the 'Diagnostic logs' settings.</kbd></div>
<p>Apparently, we do not have this feature available for now. Let's go to the <span class="packt_screen">Diagnostic log</span><strong> </strong>blade. It offers some interesting features regarding logging, including the following:</p>
<ul>
<li><span class="packt_screen">Application logging (filesystem)</span>: Collects diagnostic traces</li>
<li><span class="packt_screen">Application logging (blog)</span>: The same as the <span class="packt_screen">filesystem</span> option, but this time logs are stored within the <em>Azure Storage</em> account</li>
<li><span class="packt_screen">Web server logging</span>: Gathers diagnostics about a web server</li>
<li><span class="packt_screen">Detailed error messages</span>: If you feel current messages are not sufficient, you can turn on this feature to get more information</li>
<li><span class="packt_screen">Failed request tracing</span>: Gathers information about failed requests</li>
</ul>
<p>Additionally, you can find the FTP location of all logs with user information to log in. Since we need<span class="packt_screen"> Application logging </span>for<span class="packt_screen"> Log stream</span>, let's turn this feature on. Now, we can go back to <span class="packt_screen">Log stream</span><strong> </strong>to see what kind of information we are gathering:</p>
<div class="CDPAlignCenter CDPAlign"><img src="Images/d45c939f-6bba-48ec-92f5-cf38033d41f6.png" width="1210" height="446"/></div>
<div class="packt_tip">If you do not see any information in <span class="packt_screen">Log stream</span>, make sure you have set the correct level of logging. For all information possible, use <span class="packt_screen">Verbose</span>.</div>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, you have learned what App Services <span>are, </span>and how to build and deploy a simple application that can easily <span>be </span>pushed to Azure. Learning the basics of this particular service is crucial for understanding other topics mentioned in this book, such as WebJobs or Azure Functions. Always remember that you can initially use the <span class="packt_screen">Free </span>tier to avoid paying for an application when testing or developing, and then scale up when you need to do so. I strongly recommend you play around a little bit with Web Apps, as the cloud component has a lot more to it, and some other features are not that obvious initially. We will cover more advanced features such as integration with Traffic Manager, Azure SQL database, and scaling scenarios in the next chapters.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Questions</h1>
                </header>
            
            <article>
                
<ol>
<li>Do the terms "App Service" and "Web App" refer to the same Azure service?</li>
<li>How many categories of App Service Plans are there currently in Azure?</li>
<li>Why should <span class="packt_screen">Free </span>and <span class="packt_screen">Shared </span>tiers not be used for running production workloads?</li>
<li>How many authentication providers can you set up in App Services?</li>
<li>Is there any difference in hardware between the <span class="packt_screen">Basic</span>, <span class="packt_screen">Standard</span>, and <span class="packt_screen">Premium </span>tiers?</li>
<li>What do you need to enable to see logs in the <span class="packt_screen">Log stream</span>?</li>
<li>Can you attach a custom domain to each tier available in App Services?</li>
<li>Can you attach more than one App Service to an App Service Plan?</li>
<li>Which operating systems are available for App Services?</li>
<li>Can you change <span>operating system</span> after App Service creation?</li>
<li>Is it possible to deploy application files to App Services using FTPS? Where can<span> you</span> find the proper location address?</li>
<li>What is the difference between user-level and app-level credentials in App Services?</li>
<li>What is the difference between scaling up and scaling out?</li>
<li>Let's say that you pay $50 for one instance of App Service per month. How much will <span>you </span>pay if you scale up to 10 instances?</li>
<li>What is the purpose of using the <span class="packt_screen">Isolated </span>tier in App Services?</li>
<li>Is it possible to run a Go application in App Services?</li>
</ol>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Further reading</h1>
                </header>
            
            <article>
                
<ul>
<li>Azure App Service documentation: <a href="https://docs.microsoft.com/en-us/azure/app-service/">https://docs.microsoft.com/en-us/azure/app-service/</a></li>
<li>Best practices for Azure App Service: <a href="https://docs.microsoft.com/en-us/azure/app-service/app-service-best-practices">https://docs.microsoft.com/en-us/azure/app-service/app-service-best-practices</a></li>
<li>Reference architectures for Web Apps: <a href="https://docs.microsoft.com/en-us/azure/architecture/reference-architectures/app-service-web-app/basic-web-app">https://docs.microsoft.com/en-us/azure/architecture/reference-architectures/app-service-web-app/</a></li>
<li>Deployment slots: <a href="https://docs.microsoft.com/en-us/azure/app-service/web-sites-staged-publishing">https://docs.microsoft.com/en-us/azure/app-service/web-sites-staged-publishing</a></li>
</ul>


            </article>

            
        </section>
    </div>



  </body></html>