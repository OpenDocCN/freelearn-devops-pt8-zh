<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Chapter&#xA0;3.&#xA0;Installing and Configuring Windows Azure Pack" id="VF2I1-b479cf466c26404ca54119871a9b2715"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03" class="calibre1"/>Chapter 3. Installing and Configuring Windows Azure Pack</h1></div></div></div><p class="calibre8">In the previous chapter, we covered planning and configuration of Cloud Fabric Infrastructure, which is used to host the Cloud Fabric management and tenant workloads. Moving ahead, in this chapter we shall cover the installation and configuration of Windows Azure Pack websites, APIs, and authentication sites. We shall also cover post deployment steps such as customizing portal names and certificates as per enterprise and service providers' needs.</p><p class="calibre8">We will be covering the following topics in this chapter:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Windows Azure Pack deployment model review</li><li class="listitem">Installing and configuring Windows Azure Pack</li><li class="listitem">Installing Windows Azure Pack in a distributed model</li><li class="listitem">Required firewall ports for WAP components</li><li class="listitem">Customizing WAP portals' accessibility and certificates summary</li><li class="listitem">Registering the Service Provider Foundation with WAP</li></ul></div></div>

<div class="book" title="Chapter&#xA0;3.&#xA0;Installing and Configuring Windows Azure Pack" id="VF2I1-b479cf466c26404ca54119871a9b2715">
<div class="book" title="Windows Azure Pack deployment models review"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch03lvl1sec26" class="calibre1"/>Windows Azure Pack deployment models review</h1></div></div></div><p class="calibre8">In <a class="calibre1" title="Chapter 1. Know Windows Azure Pack and Its Architecture" href="part0015_split_000.html#E9OE1-b479cf466c26404ca54119871a9b2715">Chapter 1</a>, <span class="strong"><em class="calibre12">Know Windows Azure Pack and Its Architecture</em></span>, we covered the architecture and various <a id="id376" class="calibre1"/>deployment models for an organization's private cloud and a service provider's cloud needs. Let's have a review of possible<a id="id377" class="calibre1"/> and recommended<a id="id378" class="calibre1"/> deployment models before starting actual installation of <span class="strong"><strong class="calibre9">Windows Azure Pack</strong></span> (<span class="strong"><strong class="calibre9">WAP</strong></span>).</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre9">Express Deployment Architecture</strong></span>: In Express Deployment Architecture, all components of WAP (portals, APIs, and authentication sites) are installed on a single Windows<a id="id379" class="calibre1"/> Server 2012/Windows Server 2012 R2. It doesn't provide any high availability and is suitable only for testing, development, and deployments. For the purpose of evaluating WAP in this book, we shall be following the Express Deployment model.</li><li class="listitem"><span class="strong"><strong class="calibre9">Distributed Deployment Architecture</strong></span>: In Distributed Deployment Architecture, WAP<a id="id380" class="calibre1"/> roles such as Admin/Tenant portals or API's. authentication sites are deployed in a distributed manner involving multiple Windows servers to provide scalability<a id="id381" class="calibre1"/> and high availability in a<a id="id382" class="calibre1"/> secure manner. Distributed Deployment Architecture can be customized as per requirement, such as adding a <span class="strong"><strong class="calibre9">high availability</strong></span> (<span class="strong"><strong class="calibre9">HA</strong></span>) layer only<a id="id383" class="calibre1"/> for particular roles instead of all. This is suitable for production deployments.</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Installing and configuring Windows Azure Pack"><div class="book" id="10DJ42-b479cf466c26404ca54119871a9b2715"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec27" class="calibre1"/>Installing and configuring Windows Azure Pack</h1></div></div></div><p class="calibre8"><span class="strong"><strong class="calibre9">Microsoft Web Platform Installer</strong></span> (<span class="strong"><strong class="calibre9">WEB PI</strong></span>) is used to install Windows Azure Pack components in both <a id="id384" class="calibre1"/>Express and Distributed Architectures. Microsoft Web Platform is a free tool available, which is used to download and install latest components of Microsoft Web platform-related <a id="id385" class="calibre1"/>components such as IIS, .NET, web development tools, web applications, Windows Azure Pack, and so on. Web PI automatically detects the<a id="id386" class="calibre1"/> operating system on which it's executed and displays only compatible solutions available for download and installation.</p><p class="calibre8">Before downloading and starting Web Platform installer, we need to ensure that Windows Azure Pack installation prerequisites are completed. Let's finish up the prerequisites before starting the installation.</p></div>

<div class="book" title="Installing and configuring Windows Azure Pack">
<div class="book" title="WAP installation prerequisite"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec46" class="calibre1"/>WAP installation prerequisite</h2></div></div></div><p class="calibre8">For the purpose of evaluation, we<a id="id387" class="calibre1"/> are installing Windows Azure Pack in the Express Deployment model. The following hardware and software prerequisites<a id="id388" class="calibre1"/> have to be met before starting the installation. Please follow <a class="calibre1" title="Chapter 1. Know Windows Azure Pack and Its Architecture" href="part0015_split_000.html#E9OE1-b479cf466c26404ca54119871a9b2715">Chapter 1</a>, <span class="strong"><em class="calibre12">Know Windows Azure Pack and Its Architecture</em></span>, for details on hardware requirements and for the deployment model of Express and Distributed Deployment Architectures.</p><div class="book"><ul class="itemizedlist"><li class="listitem">Active Directory user accounts:<div class="book"><ul class="itemizedlist1"><li class="listitem">Create the following user accounts and groups in Active Directory for Windows Azure Pack components authentication:<div class="informalexample"><table border="1" class="calibre16"><colgroup class="calibre17"><col class="calibre18"/><col class="calibre18"/><col class="calibre18"/></colgroup><thead class="calibre19"><tr class="calibre20"><th valign="bottom" class="calibre25">
<p class="calibre22">Account Name</p>
</th><th valign="bottom" class="calibre25">
<p class="calibre22">Purpose</p>
</th><th valign="bottom" class="calibre25">
<p class="calibre22">Permissions</p>
</th></tr></thead><tbody class="calibre23"><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Wapsvc</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Service account for WAP Web Services</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Member of local administrator group on WAP servers and WAP Admins Group Member</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Wapadmin</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Administrator account to manage WAP Cloud</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Member of local administrator group on WAP servers + WAPAdmins Group Member</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Wapadmins</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">WAP Administrators Group</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Member of local administrator group on WAP servers</p>
</td></tr></tbody></table></div></li></ul></div></li><li class="listitem">Hardware<a id="id389" class="calibre1"/> requirements:<div class="book"><ul class="itemizedlist1"><li class="listitem">Windows Server 2012 R2 VM or physical server</li><li class="listitem">8 GB RAM (no dynamic memory)</li><li class="listitem">50 GB of available disk space</li></ul></div></li><li class="listitem">Software requirements:<div class="book"><ul class="itemizedlist1"><li class="listitem">Windows Server 2012 /2012 R2 operating system. All the latest features and support are available with Windows Server 2012 R2. See the feature compatibility guide if deploying on Windows Server 2012.</li><li class="listitem">Microsoft Web<a id="id390" class="calibre1"/> Platform Installer 5, available at <a class="calibre1" href="http://www.microsoft.com/web/downloads/platform.aspx">http://www.microsoft.com/web/downloads/platform.aspx</a>.</li><li class="listitem">Microsoft .NET Framework 3.5 Service Pack. Install using the server manager <a id="id391" class="calibre1"/>and add features wizard.</li><li class="listitem">IIS (Internet Information Service). Component of Windows Server OS. Web Platform installer can install it automatically before WAP installation. Add Management Console manually later.</li><li class="listitem">Microsoft .NET Framework 4.5 Extended with ASP.NET for Windows 8. It can be installed using the Server Manager's Add Feature wizard. WEB PI can also automatically install this before starting WAP installation.</li><li class="listitem">Internet Explorer enhanced security configuration for administrators should be disabled. Use Server Manager to disable it.</li></ul></div><div class="note" title="Note"><h3 class="title2"><a id="note19" class="calibre1"/>Note</h3><p class="calibre8">Installing .NET Framework 3.5 on Windows Server 2012 or 2012 R2 requires specifying an alternate<a id="id392" class="calibre1"/> location for .NET files in the Add Roles and Features wizard. Visit <a class="calibre1" href="https://technet.microsoft.com/en-in/library/dn482071.aspx">https://technet.microsoft.com/en-in/library/dn482071.aspx</a> for more information on this.</p></div></li></ul></div></div></div>

<div class="book" title="Installing and configuring Windows Azure Pack">
<div class="book" title="Installing Windows Azure Pack: Portal and API Express"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec47" class="calibre1"/>Installing Windows Azure Pack: Portal and API Express</h2></div></div></div><p class="calibre8">We can start installing Windows Azure Pack after successful completion of the prerequisites.</p><p class="calibre8">Follow the following steps to install WAP Express:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Log on to the WAP<a id="id393" class="calibre1"/> server.</li><li class="listitem" value="2">Start Microsoft Web PI (Microsoft Web Platform Installer).</li><li class="listitem" value="3">Search <span class="strong"><strong class="calibre9">Windows Azure Pack: Portal and API Express</strong></span>. Web PI will automatically detect that it's running and Windows Server 2012 R2 will display only compatible products for download and installation.</li><li class="listitem" value="4">Search for <span class="strong"><strong class="calibre9">Windows Azure Pack: Portal and API Express</strong></span>. This will automatically download and install all WAP components that are a part of Express Deployment.<div class="mediaobject"><img src="../images/00035.jpeg" alt="Installing Windows Azure Pack: Portal and API Express" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="5">Click <span class="strong"><strong class="calibre9">Add</strong></span> to select the highlighted entry for download and installation.</li><li class="listitem" value="6">Select <span class="strong"><strong class="calibre9">Install</strong></span> to proceed further.</li><li class="listitem" value="7">Web PI wizard will show the prerequisites and optional components that can be installed. You may choose to remove extra components such as partner provided extensions if you are not planning to use them.<div class="mediaobject"><img src="../images/00036.jpeg" alt="Installing Windows Azure Pack: Portal and API Express" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="8">Remove any extra<a id="id394" class="calibre1"/> or not used components and click <span class="strong"><strong class="calibre9">I Accept</strong></span> to proceed further.</li><li class="listitem" value="9">Select Microsoft updates settings as per your requirement. It is recommended to enable Microsoft updates to keep WAP and other components updated with the latest features and fixes using the Windows Update Console itself.</li><li class="listitem" value="10">Wizard will start downloading and installing WAP components and prerequisites, as shown in the following screenshot:<div class="mediaobject"><img src="../images/00037.jpeg" alt="Installing Windows Azure Pack: Portal and API Express" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="11">Successful installation will take you to the <span class="strong"><strong class="calibre9">CONFIGURE</strong></span> page, which provides details on<a id="id395" class="calibre1"/> configuring the WAP installed components, as shown in the following screenshot. WAP creates a site named Windows Azure Pack Configuration Site in IIS for configuration and integration of all the WAP components and databases during the initial setup. Click on <span class="strong"><strong class="calibre9">Continue</strong></span> to proceed further. Clicking <span class="strong"><strong class="calibre9">Continue</strong></span> will also open the configuration site page, which can be configured now or closed to configure the settings later.<div class="mediaobject"><img src="../images/00038.jpeg" alt="Installing Windows Azure Pack: Portal and API Express" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="12">Review the installed <a id="id396" class="calibre1"/>components summary and finish the wizard. See installation logs in case of any errors. Exit the Web PI Console.</li><li class="listitem" value="13">Installed components can be verified in the Programs and Features (<code class="email">appwiz.cpl</code>) management console.<div class="note" title="Note"><h3 class="title2"><a id="tip17" class="calibre1"/>Tip</h3><p class="calibre8">Microsoft Web PI always contains the latest available version along with updates of Windows Azure Pack components.</p></div></li></ol><div class="calibre27"/></div></div></div>

<div class="book" title="Installing and configuring Windows Azure Pack">
<div class="book" title="Configuring Windows Azure Pack Express Deployment"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec48" class="calibre1"/>Configuring Windows Azure Pack Express Deployment</h2></div></div></div><p class="calibre8">In the preceding topic, we only installed those WAP components that were not ready to be used yet. Now, we<a id="id397" class="calibre1"/> need to configure all the WAP components (installed on a single server) by integrating with its management database and so on. Windows Azure Pack Configuration Site is used to configure the installation. You can open WAP Configuration Site by opening IE and its URL, or by using the Start menu icon.</p><p class="calibre8">Steps to configure a WAP Express installation are as follows:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Launch Internet Explorer with <span class="strong"><strong class="calibre9">Run as administrator</strong></span>.</li><li class="listitem" value="2">Open Windows Azure Pack Configuration Site accessible at <code class="email">https://localhost:30101/</code>.</li><li class="listitem" value="3">If any SSL warning comes up, click <span class="strong"><strong class="calibre9">continue</strong></span> to this website.</li><li class="listitem" value="4">Click <span class="strong"><strong class="calibre9">configure now</strong></span> to proceed further.<div class="mediaobject"><img src="../images/00039.jpeg" alt="Configuring Windows Azure Pack Express Deployment" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="5">Provide<a id="id398" class="calibre1"/> the required information in the <span class="strong"><strong class="calibre9">Database Server Setup</strong></span> wizard:<div class="book"><ul class="itemizedlist1"><li class="listitem"><span class="strong"><strong class="calibre9">SERVER NAME</strong></span>: FQDN of the SQL Server used to the host cloud management database.</li><li class="listitem"><span class="strong"><strong class="calibre9">AUTHENTICATION TYPE</strong></span>: Windows Authentication or SQL authentication.</li><li class="listitem"><span class="strong"><strong class="calibre9">DATABASE SERVER ADMIN USERNAME</strong></span> and <span class="strong"><strong class="calibre9">DATABASE SERVER ADMIN PASSWORD</strong></span>: The wizard will automatically detect if the username and password is correct before proceeding further.</li><li class="listitem"><span class="strong"><strong class="calibre9">Configuration Store Passphrase</strong></span>: WAP uses encryption and decryption to store and retrieve secret data from the configuration stored on SQL. This passphrase will be used to encrypt and decrypt the data. The same passphrase has to be used while configuring all the servers in a Distributed Deployment.</li></ul></div><div class="mediaobject"><img src="../images/00040.jpeg" alt="Configuring Windows Azure Pack Express Deployment" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="6">Select yes or<a id="id399" class="calibre1"/> no to participate in the <span class="strong"><strong class="calibre9">Customer Experience Improvement Program</strong></span>.</li><li class="listitem" value="7">Review the components to be configured and click the checkmark at the bottom right-hand side.<div class="mediaobject"><img src="../images/00041.jpeg" alt="Configuring Windows Azure Pack Express Deployment" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="8"><span class="strong"><strong class="calibre9">WINDOWS AZURE PACK SETUP</strong></span> will start configuring each role. It will take a few minutes for the configuration to finish. Hit <span class="strong"><strong class="calibre9">finish</strong></span> once the configuration is <a id="id400" class="calibre1"/>completed and is successful for all components.</li><li class="listitem" value="9">The configuration is completed. Now you can proceed further to verify the deployment and to the next steps.</li></ol><div class="calibre27"/></div><div class="informalexample" title="Note"><h3 class="title2"><a id="tip18" class="calibre1"/>Tip</h3><p class="calibre8">Log out and login back to the WAP server post completion of the configuration. This creates the necessary security permissions to log into portals.</p></div><div class="mediaobject"><img src="../images/00042.jpeg" alt="Configuring Windows Azure Pack Express Deployment" class="calibre10"/></div><p class="calibre11"> </p></div></div>

<div class="book" title="Installing and configuring Windows Azure Pack">
<div class="book" title="Validating a successful deployment"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch03lvl2sec49" class="calibre1"/>Validating a successful deployment</h2></div></div></div><p class="calibre8">After completion of the configuration wizard, it's good to quickly run some tests to verify if deployment and<a id="id401" class="calibre1"/> database integration is completed successfully. Perform the following checks to verify if deployment is successful:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Verify if all Internet Information Services (IIS) websites and applications are created on the WAP server. Use <span class="strong"><strong class="calibre9">Internet Information Services (IIS) Manager</strong></span> to verify this. Install IIS Manager using Server Manager if not installed.<div class="mediaobject"><img src="../images/00043.jpeg" alt="Validating a successful deployment" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem">Verify if all <a id="id402" class="calibre1"/>WAP databases are created on the SQL server specified during setup. Use SQL Management Studio to access the SQL Management Server. Access the WAP database server and expend databases to see all the databases created on the server:<div class="mediaobject"><img src="../images/00044.jpeg" alt="Validating a successful deployment" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem">Verify login to the Admin portal and the Tenant portal accessibility. Try logging into the Admin portal:<p class="calibre15">Admin portal URL: <code class="email">https://WAPServer:30091</code></p><p class="calibre15">Tenant portal URL: <code class="email">https://WAPServer:30081</code></p></li><li class="listitem">Run Microsoft Best Practice Analyzer for Windows Azure Pack to identify any gaps in <a id="id403" class="calibre1"/>deployment.</li></ul></div><div class="informalexample" title="Note"><h3 class="title2"><a id="tip19" class="calibre1"/>Tip</h3><p class="calibre8">The account used to install WAP components has to be used for logging into the Admin portal. Additional co-administrators can be added by adding users in MgmtSvc Operators local group on the WAP server.</p><p class="calibre8">Microsoft Best Practice Analyzer for Windows Azure Pack can be downloaded and installed using Microsoft Web Platform Installer (WebPI).</p></div></div></div>
<div class="book" title="Installing Windows Azure Pack in a Distributed architecture" id="11C3M1-b479cf466c26404ca54119871a9b2715"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec28" class="calibre1"/>Installing Windows Azure Pack in a Distributed architecture</h1></div></div></div><p class="calibre8">Installation of Windows Azure Pack in a Distributed architecture is similar to Express installation. In<a id="id404" class="calibre1"/> a Distributed architecture, instead of selecting Windows Azure Pack: Portal and API Express, individual <a id="id405" class="calibre1"/>components such as Admin site and Admin authentication sites are selected and installed on multiple servers.</p><p class="calibre8"><span class="strong"><strong class="calibre9">Microsoft Web Platform Installer</strong></span> (<span class="strong"><strong class="calibre9">Web PI</strong></span>) is used to select individual components and installation of each of<a id="id406" class="calibre1"/> them on all the WAP servers. Let's have a look at the steps to deploy WAP in a Distributed architecture.</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Complete the hardware and software prerequisite on all WAP servers (see <a class="calibre1" title="Chapter 1. Know Windows Azure Pack and Its Architecture" href="part0015_split_000.html#E9OE1-b479cf466c26404ca54119871a9b2715">Chapter 1</a>, <span class="strong"><em class="calibre12">Know Windows Azure Pack and Its Architecture</em></span>, for various deployment topologies of WAP in a Distributed architecture, last topic for software prerequisites).</li><li class="listitem" value="2">Verify required firewall ports allowed in Windows or network firewalls.</li><li class="listitem" value="3">Deploy any load balancers (physical or logical) for WAP virtual machines as per architecture.</li><li class="listitem" value="4">Install and run Microsoft Web Platform Installer on WAP servers in a sequential manner.</li><li class="listitem" value="5">Follow the given sequence to install and configure WAP components on multiple servers:<div class="book"><ol class="orderedlist1"><li class="listitem" value="1">Install and configure WAP Service Management APIs (Admin API, Tenant API, and Tenant Public API)</li><li class="listitem" value="2">Install and configure WAP Management portals (Admin site, Tenant site, and so on)</li><li class="listitem" value="3">Install and configure authentication sites (Admin Authentication site and Tenant Authentication sites)</li><li class="listitem" value="4">Install and configure other components such as resource providers, and so on</li></ol><div class="calibre27"/></div></li><li class="listitem" value="6">During configuration, provide SQL server details and the passphrase. Note down the passphrase as it has to be exactly the same while configuring all other components. It is<a id="id407" class="calibre1"/> a good idea to make a note of it, as there is no way to recover the passphrase if lost.</li><li class="listitem" value="7">Configure load balancers to distribute traffic and DNS records.</li><li class="listitem" value="8">Customize the <a id="id408" class="calibre1"/>portal and authentication site's URL and ports for load balanced names.</li><li class="listitem" value="9">Replace self-signed certificates with trusted SSL certificates for websites.</li><li class="listitem" value="10">Test deployment and complete post deployment best practices such as running BPA.</li></ol><div class="calibre27"/></div><p class="calibre8">Changing portal URLs and ports, and replacing SSL certificates, is covered in further topics.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note20" class="calibre1"/>Note</h3><p class="calibre8">By default, Windows Azure Pack portals uses HTTPS. If you try to open portals on HTTP, it will result in a page cannot be displayed error. To accept HTTP traffic for portals, create additional binding in IIS for each website pointing to port 80 along with the default HTTPS.</p><p class="calibre8">Web.Config of each portal already has a rule of redirecting HTTP traffic to HTTPS, which comes into action after adding binding for port 80.</p></div></div>
<div class="book" title="Required firewall ports for WAP components" id="12AK81-b479cf466c26404ca54119871a9b2715"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec29" class="calibre1"/>Required firewall ports for WAP components</h1></div></div></div><p class="calibre8">The following<a id="id409" class="calibre1"/> networks ports have to be allowed in networks or <a id="id410" class="calibre1"/>any other external firewalls to enable communication between WAP components and websites access by admins or tenants.</p><p class="calibre8">Windows Azure Pack automatically creates rules in Windows firewall (if enabled) for these ports. Note that the following list includes only the default ports used by WAP components; add other ports if using any customized ports.</p><div class="informalexample"><table border="1" class="calibre16"><colgroup class="calibre17"><col class="calibre18"/><col class="calibre18"/><col class="calibre18"/></colgroup><thead class="calibre19"><tr class="calibre20"><th valign="bottom" class="calibre25">
<p class="calibre22">WAP Service</p>
</th><th valign="bottom" class="calibre25">
<p class="calibre22">Port Number</p>
</th><th valign="bottom" class="calibre25">
<p class="calibre22">Scope</p>
</th></tr></thead><tbody class="calibre23"><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Admin API</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">30004</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Any IP required to access Admin API. It is usually cloud management IP range.</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Management portal for Admins</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">30091</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Any IP required to access admin portal. It is usually cloud management IP range.</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Windows authentication site (used for admin portal authentication)</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">30072</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Any IP<a id="id411" class="indexterm"/> required to access admin portal. It is usually cloud management IP range.</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Configuration site</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">30101</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Local WAP components subnet. This will be accessed during initial setup.</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Monitoring site</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">30020</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Any IP required to access monitoring services. It is usually cloud management range.</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">MySQL Resource Provider</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">30012</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Any IP<a id="id412" class="indexterm"/> address using specified service.</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">SQL Server or MySQL Resource Provider</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">30010</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Any IP address using specified service.</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Tenant API</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">30005</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Any IP address using specified service.</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Tenant public API</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">30006</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Any IP address using specified service. Usually all Internet IP ranges.</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Management portal for tenants</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">30081</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Any IP address using specified service. Usually all Internet IP ranges.</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Tenant authentication site</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">30071</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Any IP address using specified service. Usually all Internet IP ranges.</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Usage</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">30022</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Any IP address using specified service.</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">WebAppGallery</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">30018</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Any IP address using specified service.</p>
</td></tr></tbody></table></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Customizing WAP portal's accessibility and certificates"><div class="book" id="1394Q2-b479cf466c26404ca54119871a9b2715"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec30" class="calibre1"/>Customizing WAP portal's accessibility and certificates</h1></div></div></div><p class="calibre8">By default, WAP <a id="id413" class="calibre1"/>websites use server hostnames as website URL, default <a id="id414" class="calibre1"/>port number, and self-signed certificates. In this topic, we will change the website's name, that is, URL, default port (such as 30081 to 443 for tenant portal) and SSL certificate with internal or public certificates as required. It is recommended to customize these portals' configuration for better security and user experience.</p><p class="calibre8">Assume a user experience of a tenant portal, also known as a customer portal, with complex enough URL and a custom port to <a id="id415" class="calibre1"/>add with disturbing security warnings of untrusted SSL certificates. Windows Azure Pack provides flexibilities to change URLs and ports along with trusted SSL<a id="id416" class="calibre1"/> certificates for WAP websites for improved security and smooth end user experience.</p><p class="calibre8">Before getting things into action, let's understand which websites come into the picture for the user logins (Admin or Tenant) WAP portal use claim-based authentication mechanism during the login process, as follows:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">The user opens their respective portals such as admin portal or tenant portal by entering the WAP server's hostname with the port.</li><li class="listitem" value="2">The admin site redirects the webpage to the respective authentication site webpage.</li><li class="listitem" value="3">The user enters their credentials with a mechanism such as Windows Authentication/ASP.NET Authentication, or ADFS. Upon successful authentication, the user is provided with a security access token and redirected to the portal webpage again.</li><li class="listitem" value="4">The admin portal webpage accepts the security token of the user and display the portal as per services/permissions available with the user.</li></ol><div class="calibre27"/></div><p class="calibre8">As we learned, four websites plays a role in getting a user authenticated and getting their personalized portal as per role. In order to provide smooth user experience, we need to customize names, ports, and have trusted certificates for the following WAP websites:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Admin management portal</li><li class="listitem">Admin authentication site</li><li class="listitem">Tenant management portal</li><li class="listitem">Tenant authentication site</li></ul></div><p class="calibre8">For an organization's private cloud, in most cases all these websites will be accessible from inside the organizations only, which makes it feasible to use an internal <span class="strong"><strong class="calibre9">CA</strong></span> (<span class="strong"><strong class="calibre9">Certification Authority</strong></span>) provided SSL certificates for all websites.</p><p class="calibre8">In a service provider scenario, the Tenant portal will be accessible over the public Internet; whereas the Admin portal is likely to be accessed inside the provider's network only. In such cases, SSL certificates issued by public CA should be used for the Tenant management portal and Authentication site, whereas an internal CA can be leveraged for the Admin portal and Admin authentication site.</p><p class="calibre8">This makes the recommendation clear that internal CA provided SSL certificates should be used for portal and authentication sites to be used inside corporate LAN, where any public portal or authentication sites should be assigned SSL certificates issued by Public trusted CAs.</p><p class="calibre8">Overall, the following recommendations have to be performed for user accessible websites to improve<a id="id417" class="calibre1"/> user experience and security:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Use simpler URLs for Admin and Tenant websites</li><li class="listitem">Use standard ports such as 443 (HTTPS) to avoid any complexity in URLs</li><li class="listitem">Use trusted SSL certificates to avoid any SSL related security warnings</li></ul></div><p class="calibre8">To implement the preceding recommendations, the following operations have to be performed in a WAP Cloud solution:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Create DNS records for new URLs (in internal DNS and Public DNS servers.)</li><li class="listitem" value="2">Generate and import trusted SSL certificates for each website.</li><li class="listitem" value="3">Configure <a id="id418" class="calibre1"/>website bindings to use new URLs, ports, and certificates.</li><li class="listitem" value="4">Update the Windows Azure Pack Configuration database with new URLs and ports.</li></ol><div class="calibre27"/></div></div>

<div class="book" title="Customizing WAP portal's accessibility and certificates">
<div class="book" title="Configure portal's DNS names"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec50" class="calibre1"/>Configure portal's DNS names</h2></div></div></div><p class="calibre8">By default, WAP <a id="id419" class="calibre1"/>management portals and authentication sites use the following ports.</p><p class="calibre8">The following are WAP <a id="id420" class="calibre1"/>websites' default URLs and ports:</p><div class="informalexample"><table border="1" class="calibre16"><colgroup class="calibre17"><col class="calibre18"/><col class="calibre18"/><col class="calibre18"/></colgroup><thead class="calibre19"><tr class="calibre20"><th valign="bottom" class="calibre25">
<p class="calibre22">Site Name</p>
</th><th valign="bottom" class="calibre25">
<p class="calibre22">URL</p>
</th><th valign="bottom" class="calibre25">
<p class="calibre22">Port</p>
</th></tr></thead><tbody class="calibre23"><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Management Portal for Administrator</p>
</td><td valign="top" class="calibre24">
<p class="calibre22"><code class="literal">https://WAPServer:30091</code></p>
</td><td valign="top" class="calibre24">
<p class="calibre22">30091</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Admin Authentication Site</p>
</td><td valign="top" class="calibre24">
<p class="calibre22"><code class="literal">https://WAPServer:30072</code></p>
</td><td valign="top" class="calibre24">
<p class="calibre22">30072</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Management Portal for Tenants</p>
</td><td valign="top" class="calibre24">
<p class="calibre22"><code class="literal">https://WAPServer:30081</code></p>
</td><td valign="top" class="calibre24">
<p class="calibre22">30081</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Tenant Authentication Site</p>
</td><td valign="top" class="calibre24">
<p class="calibre22"><code class="literal">https://WAPServer:30071</code></p>
</td><td valign="top" class="calibre24">
<p class="calibre22">30071</p>
</td></tr></tbody></table></div><p class="calibre8">For evaluation purposes, we shall be changing URLs and ports as per the following table. Organizations and service providers may choose their own names and ports as per their choice.</p><div class="informalexample"><table border="1" class="calibre16"><colgroup class="calibre17"><col class="calibre18"/><col class="calibre18"/><col class="calibre18"/></colgroup><thead class="calibre19"><tr class="calibre20"><th valign="bottom" class="calibre25">
<p class="calibre22">Site Name</p>
</th><th valign="bottom" class="calibre25">
<p class="calibre22">URL</p>
</th><th valign="bottom" class="calibre25">
<p class="calibre22">Port</p>
</th></tr></thead><tbody class="calibre23"><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Management Portal for Administrator</p>
</td><td valign="top" class="calibre24">
<p class="calibre22"><code class="literal">https://admin.wapcloud.com</code></p>
</td><td valign="top" class="calibre24">
<p class="calibre22">443</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Admin Authentication Site</p>
</td><td valign="top" class="calibre24">
<p class="calibre22"><code class="literal">https://adminauth.wapcloud.com</code></p>
</td><td valign="top" class="calibre24">
<p class="calibre22">443</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Management Portal for Tenants</p>
</td><td valign="top" class="calibre24">
<p class="calibre22"><code class="literal">https://manage.wapcloud.com</code></p>
</td><td valign="top" class="calibre24">
<p class="calibre22">443</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Tenant Authentication Site</p>
</td><td valign="top" class="calibre24">
<p class="calibre22"><code class="literal">https://manageauth.wapcloud.com</code></p>
</td><td valign="top" class="calibre24">
<p class="calibre22">443</p>
</td></tr></tbody></table></div><p class="calibre8">"<code class="email">A</code>" records and "<code class="email">PTR</code>" records need to be created in internal and external DNS servers for the preceding names<a id="id421" class="calibre1"/> pointing to the WAP server. Changes in Public DNS servers are required if any of the services are accessible over the Internet like tenant<a id="id422" class="calibre1"/> portals and authentication sites.</p><p class="calibre8">DNS Manager can be used to create records in the internal DNS server. Use the following steps to create the records:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open DNS Manager on the DNS server.</li><li class="listitem" value="2">Right click on <span class="strong"><strong class="calibre9">DNS Zone</strong></span> and create a new record button.</li><li class="listitem" value="3">Provide the name and IP of portal and WAP server, as follows:<div class="mediaobject"><img src="../images/00045.jpeg" alt="Configure portal's DNS names" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="4">Select <span class="strong"><strong class="calibre9">Create associated pointer (PTR) record</strong></span>.</li><li class="listitem" value="5">Create all required records using the same method.</li></ol><div class="calibre27"/></div></div></div>

<div class="book" title="Customizing WAP portal's accessibility and certificates">
<div class="book" title="Getting SSL certificates for WAP websites"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec51" class="calibre1"/>Getting SSL certificates for WAP websites</h2></div></div></div><p class="calibre8">Getting SSL certificates for WAP management portals and authentication sites is similar to getting SSL for any other websites running on any web server. SSL certificates are usually requested and assigned online by any CA authority, or offline by creating a certificate request file at the<a id="id423" class="calibre1"/> IIS server and then submitting a certificate request file to Public CA providers to get the required SSL.</p><p class="calibre8">Active Directory Certificate Services, that is, internal Enterprise CA can be used to assign certificates for portals accessible inside corporate networks only, such as management portals for administrators and so on. For the purpose of evaluation, we shall be using internal Windows ADCS Services as a CA to assign certificates to the websites.</p><p class="calibre8">Assuming that you <a id="id424" class="calibre1"/>already have an Enterprise CA configured inside your organization (Active Directory Certificate Services), the following are the steps required to request and assign SSL certificates for WAP websites:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Log on to WAP server and open IIS Manager.</li><li class="listitem" value="2">Select Your IIS server name and then <span class="strong"><strong class="calibre9">Server Certificates</strong></span> on the homepage.</li><li class="listitem" value="3">The <span class="strong"><strong class="calibre9">Server Certificates</strong></span> window will display all existing self-signed or other certificates being used in the IIS server.</li><li class="listitem" value="4">Click <span class="strong"><strong class="calibre9">Request Domain Certificate</strong></span> in the actions pane.</li><li class="listitem" value="5">Providing the <span class="strong"><strong class="calibre9">Common Name</strong></span>, <span class="strong"><strong class="calibre9">Organization</strong></span>, <span class="strong"><strong class="calibre9">Organizational Unit</strong></span>, <span class="strong"><strong class="calibre9">City/locality</strong></span>, <span class="strong"><strong class="calibre9">State/province</strong></span> and <span class="strong"><strong class="calibre9">Country/region</strong></span> details as requested, as shown in the following screenshot. The <span class="strong"><strong class="calibre9">Common name</strong></span> would be the FQDN of the website it is<a id="id425" class="calibre1"/> being requested for.<div class="mediaobject"><img src="../images/00046.jpeg" alt="Getting SSL certificates for WAP websites" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="6">Specify the CA<a id="id426" class="calibre1"/> name and server name where ADCS is running and configured. Assign a friendly name for the certificate for easy identification and management.<div class="mediaobject"><img src="../images/00047.jpeg" alt="Getting SSL certificates for WAP websites" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="7">Clicking on <span class="strong"><strong class="calibre9">Finish</strong></span> will<a id="id427" class="calibre1"/> request and import certificates in IIS, as shown in the following screenshot:<div class="mediaobject"><img src="../images/00048.jpeg" alt="Getting SSL certificates for WAP websites" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="8">Request certificates for all three remaining websites.</li></ol><div class="calibre27"/></div><p class="calibre8">To request the SSL <a id="id428" class="calibre1"/>certificate from a Public CA, perform the following steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open <span class="strong"><strong class="calibre9">IIS Manager</strong></span> | <span class="strong"><strong class="calibre9">IIS Server Home </strong></span>| <span class="strong"><strong class="calibre9">Server Certificates</strong></span>.</li><li class="listitem" value="2">Click <span class="strong"><strong class="calibre9">Create Certificate Request</strong></span> in the <span class="strong"><strong class="calibre9">Actions</strong></span> pane.</li><li class="listitem" value="3">Provides the <span class="strong"><strong class="calibre9">Common Name</strong></span>, <span class="strong"><strong class="calibre9">Organization</strong></span>, <span class="strong"><strong class="calibre9">Organizational Unit</strong></span>, <span class="strong"><strong class="calibre9">City/locality</strong></span>, <span class="strong"><strong class="calibre9">State/province</strong></span> and <span class="strong"><strong class="calibre9">Country/region</strong></span> details as requested. The <span class="strong"><strong class="calibre9">Common name</strong></span> would be the FQDN of the website it is being requested for.</li><li class="listitem" value="4">Select <span class="strong"><strong class="calibre9">Cryptographer service provider</strong></span> and <span class="strong"><strong class="calibre9">Bit length</strong></span> as per the Public CA.</li><li class="listitem" value="5">Specify the file name and location to extract the certificate request file.</li><li class="listitem" value="6">Submit this request file to Public CA online or through offline method. CA will generate<a id="id429" class="calibre1"/> SSL certificates as per details received in the certificate request file.</li><li class="listitem" value="7">Click <span class="strong"><strong class="calibre9">Complete Certificate request </strong></span>in the <span class="strong"><strong class="calibre9">Actions</strong></span> pane of IIS Manager's server certificate menu.</li><li class="listitem" value="8">Provide file path for the certificate file provided by CA.</li><li class="listitem" value="9">The certificate will be added into IIS.</li></ol><div class="calibre27"/></div></div></div>

<div class="book" title="Customizing WAP portal's accessibility and certificates">
<div class="book" title="Configuring site binding to use new URL's, port and SSL"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec52" class="calibre1"/>Configuring site binding to use new URL's, port and SSL</h2></div></div></div><p class="calibre8">Now, we need to configure WAP websites to use these new names, ports, and SSL certificates. Follow these<a id="id430" class="calibre1"/> steps to do this:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open IIS Manager on the WAP s<a id="id431" class="calibre1"/>erver and browse through the websites.</li><li class="listitem" value="2">Select <span class="strong"><strong class="calibre9">MgmtSvc-AdminSite</strong></span> to select Management portals for the administrator site.</li><li class="listitem" value="3">Click on <span class="strong"><strong class="calibre9">Bindings</strong></span> on the<a id="id432" class="calibre1"/> <span class="strong"><strong class="calibre9">Actions</strong></span> pane.</li><li class="listitem" value="4">Select existing HTTPS binding and click <span class="strong"><strong class="calibre9">Edit Bindings</strong></span>.</li><li class="listitem" value="5">Provide a new <span class="strong"><strong class="calibre9">Port</strong></span> number and <span class="strong"><strong class="calibre9">Host name </strong></span>and select newly created <span class="strong"><strong class="calibre9">SSL certificate</strong></span> for the Admin site.</li><li class="listitem" value="6">Select the <span class="strong"><strong class="calibre9">Require Server Name Indication</strong></span> checkbox.</li><li class="listitem" value="7">Submit the changes by clicking <span class="strong"><strong class="calibre9">OK</strong></span>.</li><li class="listitem" value="8">Repeat the preceding steps for the remaining websites.<div class="mediaobject"><img src="../images/00049.jpeg" alt="Configuring site binding to use new URL's, port and SSL" class="calibre10"/></div><p class="calibre26"> </p></li></ol><div class="calibre27"/></div><p class="calibre8">The following are the IIS website names and the corresponding WAP websites:</p><div class="informalexample"><table border="1" class="calibre16"><colgroup class="calibre17"><col class="calibre18"/><col class="calibre18"/></colgroup><thead class="calibre19"><tr class="calibre20"><th valign="bottom" class="calibre25">
<p class="calibre22">IIS WebSite Name</p>
</th><th valign="bottom" class="calibre25">
<p class="calibre22">WAP component</p>
</th></tr></thead><tbody class="calibre23"><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">MgmtSvc-AdminSite</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Management Portal for Administrators</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">MgmtSvc-WindowsAuthSite</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Admin Authentication Site</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">MgmtSvc-TenantSite</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Management Portal for Administrators</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">MgmtSvc-AuthSite</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Tenant Authentication Site</p>
</td></tr></tbody></table></div></div></div>

<div class="book" title="Customizing WAP portal's accessibility and certificates">
<div class="book" title="Updating changes in the Windows Azure Pack database"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch03lvl2sec53" class="calibre1"/>Updating changes in the Windows Azure Pack database</h2></div></div></div><p class="calibre8">All changes performed in the previous steps have to be updated in the Windows Azure Pack configuration store to make them effective. Let's update the changes made in portal URLs and ports in the WAP<a id="id433" class="calibre1"/> Configuration database residing on the Management SQL Server.</p><p class="calibre8">Windows Azure Pack PowerShell will be used to update the changes. We need to update the value in the following three configurations in the WAP DB for both admin and tenant portals:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre9">Portal FQDN</strong></span>: Configured<a id="id434" class="calibre1"/> by using <code class="email">Set-MgmtSvcFqdn</code> in the PowerShell cmdlet, this will update FQDN for websites' portals in the WAP database such as <code class="email">admin.wapcloud.com</code>.</li><li class="listitem"><span class="strong"><strong class="calibre9">Authentication Service Relay</strong></span>: Configured by using <code class="email">Set-MgmtSvcRelyingPartySettings</code> in the PowerShell cmdlet, this will update the URL of the authentication site in the WAP database. This URL will be used by the portal to redirect when<a id="id435" class="calibre1"/> the user accesses the portal without any security token.</li><li class="listitem"><span class="strong"><strong class="calibre9">Authentication Service Redirection</strong></span>: Configured by using <code class="email">Set-MgmtSvcIdentityProviderSettings</code> in the PowerShell cmdlet, this updates the redirection URL used by the authentication site post user authentication. This <a id="id436" class="calibre1"/>URL will be used by the authentication site to redirect the user to the admin or tenant portal after authentication.</li></ul></div><p class="calibre8">Sample URLs are given in PowerShell cmdlets next, they need to be replaced with actual names for production deployments. Steps for updating new websites' URLs and ports in the WAP database are as follows:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Log into WAP Server as a WAP administrator.</li><li class="listitem" value="2">Run Windows PowerShell as an administrator.</li><li class="listitem" value="3">Import the Windows Azure Pack PowerShell module by executing the following commands:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre9">Import-Module -Name MgmtSvcConfig</strong></span>
</pre></div></li><li class="listitem" value="4">Update the Admin portal FQDN by issuing the following command in the PowerShell. FQDN in this cmdlet is the admin portal's FQDN:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre9">Set-MgmtSvcFqdn -Namespace "AdminSite" -FullyQualifiedDomainName "admin.wapcloud.com" -Port 443 -Server "WAPMGT-SQLDB-01.wapcloud.com"</strong></span>
</pre></div></li><li class="listitem" value="5">Update the Admin Authentication site FQDN by issuing the following PowerShell. FQDN in this cmdlet is admin authentication site's FQDN:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre9">Set-MgmtSvcFqdn -Namespace "WindowsAuthSite" -FullyQualifiedDomainName "adminauth.wapcloud.com" -Port 443 -Server "WAPMGT-SQLDB-01.wapcloud.com"</strong></span>
</pre></div></li><li class="listitem" value="6">Update the Admin Authenticate site redirection changes by issuing the following PowerShell. FQDN in this cmdlet is admin authentication site's FQDN:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre9">Set-MgmtSvcRelyingPartySettings –Target Admin –MetadataEndpoint 'https://adminauth.wapcloud.com:443/FederationMetadata/2007-06/FederationMetadata.xml' -ConnectionString "Data Source=WAPMGT-SQLDB-01.wapcloud.com ;User ID=sa; Password=*******"</strong></span>
</pre></div></li><li class="listitem" value="7">Update the Authenticate Service redirection by issuing the following PowerShell. FQDN in this cmdlet is admin portal's FQDN:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre9">Set-MgmtSvcIdentityProviderSettings –Target Windows –MetadataEndpoint 'https://admin.wapcloud.com/FederationMetadata/2007-06/FederationMetadata.xml' -ConnectionString "Data Source=WAPMGT-SQLDB-01.wapcloud.com ;User ID=sa;Password=********"</strong></span>
</pre></div></li><li class="listitem" value="8">Update the<a id="id437" class="calibre1"/> Tenant Admin portal FQDN by issuing the following PowerShell. FQDN in this cmdlet is the Tenant portal's FQDN:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre9">Set-MgmtSvcFqdn -Namespace "TenantSite" -FullyQualifiedDomainName "manage.wapcloud.com" -Port 443 -Server "WAPMGT-SQLDB-01.wapcloud.com"</strong></span>
</pre></div></li><li class="listitem" value="9">Update the Tenant Authentication portal FQDN by issuing the following PowerShell. FQDN in this cmdlet is the tenant authentication portal's FQDN:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre9">Set-MgmtSvcFqdn -Namespace "AuthSite" -FullyQualifiedDomainName "manageauth.wapcloud.com" -Port 443 -Server "WAPMGT-SQLDB-01.wapcloud.com"</strong></span>
</pre></div></li><li class="listitem" value="10">Update the Tenant Authenticate redirection site changes by issuing the following PowerShell. FQDN in this cmdlet is the tenant authentication site's FQDN:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre9">Set-MgmtSvcRelyingPartySettings –Target Tenant –MetadataEndpoint 'https://manageauth.wapcloud.com:443/FederationMetadata/2007-06/FederationMetadata.xml' -ConnectionString "Data Source=WAPMGT-SQLDB-01.wapcloud.com ;User ID=sa; Password=*******"</strong></span>
</pre></div></li><li class="listitem" value="11">Update the tenant Authenticate Service redirection by issuing the following PowerShell. FQDN in this cmdlet is the tenant admin portal's FQDN:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre9">Set-MgmtSvcIdentityProviderSettings –Target Membership –MetadataEndpoint 'https://manage.wapcloud.com/FederationMetadata/2007-06/FederationMetadata.xml' -ConnectionString "Data Source=WAPMGT-SQLDB-01.wapcloud.com ;User ID=sa;Password=********"</strong></span>
</pre></div></li><li class="listitem" value="12">Successful updated configuration will give an output as follows:<div class="mediaobject"><img src="../images/00050.jpeg" alt="Updating changes in the Windows Azure Pack database" class="calibre10"/></div><p class="calibre26"> </p></li></ol><div class="calibre27"/></div></div></div>

<div class="book" title="Customizing WAP portal's accessibility and certificates">
<div class="book" title="Verifying portal customizations"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch03lvl2sec54" class="calibre1"/>Verifying portal customizations</h2></div></div></div><p class="calibre8">The following steps can<a id="id438" class="calibre1"/> be followed to verify if customization made in the previous section is effective:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Verify if portal URLs and port customizations are working fine by logging into both tenant and admin portals.</li><li class="listitem" value="2">Check SSL certificates of websites by clicking on the SSL button in the web browser for the website.</li><li class="listitem" value="3">Verify no SSL trust related warnings are displayed during login or accessing the portal.</li></ol><div class="calibre27"/></div></div></div>
<div class="book" title="Registering Service Provider Foundation with WAP" id="147LC1-b479cf466c26404ca54119871a9b2715"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec31" class="calibre1"/>Registering Service Provider Foundation with WAP</h1></div></div></div><p class="calibre8">Now that we have <a id="id439" class="calibre1"/>our portal ready for Admin and Tenant usage, it's time to integrate or make WAP APIs communicate with Fabric prepared in the<a id="id440" class="calibre1"/> previous chapter. In this section, we will register Service Provider Foundation with Windows Azure pack Service Management APIs.</p><p class="calibre8">See <a class="calibre1" title="Chapter 1. Know Windows Azure Pack and Its Architecture" href="part0015_split_000.html#E9OE1-b479cf466c26404ca54119871a9b2715">Chapter 1</a>, <span class="strong"><em class="calibre12">Know Windows Azure Pack and Its Architecture</em></span>, System Centre integration section, to learn more about integration between WAP APIs and SPF.</p><p class="calibre8">Before registering, verify if SPF is deployed and configured properly to ensure successful registration:</p><div class="book"><ul class="itemizedlist"><li class="listitem">There is network reachability on required ports between the WAP server and SPF</li><li class="listitem">SPF application pools identity are running as a domain user</li><li class="listitem">The SPF App Pool identity user has admin permissions on SCVMM and SPF DB</li><li class="listitem">The local user is created on SPF server for WAP integration. Ensure that this local user is added to the SPF Local Groups Server (<code class="email">SPF_Admin</code>, <code class="email">SPF_Provider</code>, <code class="email">SPF_Usage</code>, and <code class="email">SPF_VMM</code>)</li></ul></div><p class="calibre8">Steps to register SPF Endpoint in WAP are as follows:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Log into the WAP admin portal using WAP administrator credentials.</li><li class="listitem" value="2">
Select VM clouds. Opening the VM clouds page will give the option to register SPF. If not available, click on the Quick Start(<span class="strong"><img src="../images/00051.jpeg" alt="Registering Service Provider Foundation with WAP" class="calibre28"/></span>) button.
</li><li class="listitem" value="3">Select <span class="strong"><strong class="calibre9">Register System Center Service Provider Foundation</strong></span>.<div class="mediaobject"><img src="../images/00052.jpeg" alt="Registering Service Provider Foundation with WAP" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="4">Provide the <a id="id441" class="calibre1"/>SPF server FQDN and login credentials:<p class="calibre15">SPF Server: <code class="email">https://WAPMGT-SCSPF-01:8090/</code></p><p class="calibre15">Use the spflocal account created earlier in <a class="calibre1" title="Chapter 2. Getting the Cloud Fabric Ready" href="part0023_split_000.html#LTSU2-b479cf466c26404ca54119871a9b2715">Chapter 2</a>, <span class="strong"><em class="calibre12">Getting the Cloud Fabric Ready</em></span>, during SPF installation. Do not provide any domain name or computer <a id="id442" class="calibre1"/>name in the login name.</p><div class="mediaobject"><img src="../images/00053.jpeg" alt="Registering Service Provider Foundation with WAP" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="5">The registration task starts by clicking on the checkmark.<div class="mediaobject"><img src="../images/00054.jpeg" alt="Registering Service Provider Foundation with WAP" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="6">Click <span class="strong"><strong class="calibre9">OK</strong></span> once registration is successfully completed:<div class="mediaobject"><img src="../images/00055.jpeg" alt="Registering Service Provider Foundation with WAP" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="7">Now, we can<a id="id443" class="calibre1"/> start integrating SCVMM and building IaaS services, which <a id="id444" class="calibre1"/>will be covered in next chapter.</li></ol><div class="calibre27"/></div></div>
<div class="book" title="Summary" id="1565U1-b479cf466c26404ca54119871a9b2715"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec32" class="calibre1"/>Summary</h1></div></div></div><p class="calibre8">In this chapter, we learned about installation and configuration of Windows Azure Pack in the Express Deployment model and Distributed Deployment model. We did an installation and configuration walkthrough of different WAP components.</p><p class="calibre8">We also covered customizing portals' URLs, ports, and SSL certificates to provide better user experience and to comply with organizations' and cloud providers' needs. At the end of this chapter, we customized Admin and Tenant portals accessible for users (Admin and Tenant users), waiting to offer cloud services.</p><p class="calibre8">In the next chapter, we shall be building IaaS cloud offering catalogues.</p></div></body></html>