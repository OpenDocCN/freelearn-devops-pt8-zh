- en: Chapter 4. Building VM Clouds and IaaS Offerings
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In the previous chapter, we installed and configured Windows Azure Pack components.
    The portals accessible to admins and tenants, available at this point of time,
    are just plain with respect to cloud services offering. In this chapter, we will
    build VM Clouds with the integration of Windows Azure Pack, SPF, and SCVMM. Windows
    Azure Pack VM Clouds are used to provide IaaS (Infrastructure as a Service) capabilities,
    such as virtual machines, virtual networks, and so on.
  prefs: []
  type: TYPE_NORMAL
- en: You will learn about VM Cloud's architecture, planning, and implementation.
    Furthermore, we will start building the cloud offerings, such as VMs and templates,
    gallery resources and their integration, and mapping with fabric resources in
    SCVMM. You will learn to use Microsoft-provided standard cloud services gallery
    items as well as develop custom gallery items for custom needs.
  prefs: []
  type: TYPE_NORMAL
- en: 'In this chapter, we will be covering the following topic:'
  prefs: []
  type: TYPE_NORMAL
- en: VM Clouds overview
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Registering SCVMM with Windows Azure Pack
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Building a SCVMM cloud for Windows Azure Pack cloud
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Preparing OS images for a cloud catalogue (Windows and Linux VMs)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: IaaS virtual machine offerings – standalone VM versus VM role
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Building standalone VM IaaS offerings
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The VM Role architecture
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Building VM Role IaaS offerings using gallery resources
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using the **GRIT** (**Gallery Resource Import**) tool
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Developing VM Role gallery resources using VM Role Authoring Tool
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Accessing tenant's virtual machines – Windows Azure Pack Console Connect
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: VM Clouds overview
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: VM Clouds in Windows Azure Pack cloud solution is a top-level umbrella to provide
    IaaS services. Clouds created in **System Center Virtual Machine** **Manager (SCVMM)**
    are represented as VM Clouds in the Windows Azure Pack management portal.
  prefs: []
  type: TYPE_NORMAL
- en: VM Clouds can be used to provide IaaS services with multitenancy capabilities.
    In Windows Azure Pack-based cloud, cloud plans and subscriptions and cloud offering
    catalogues and fabric resources are provisioned, mapped, and managed on a VM Cloud
    level.
  prefs: []
  type: TYPE_NORMAL
- en: Windows Azure Pack uses SPF to communicate with VMM for all operations and management
    with respect to VM Clouds. There can be a multiple number of VM Clouds created
    in one or more SCVMM as per requirements; it is recommended to only single or
    fewer VM Clouds.
  prefs: []
  type: TYPE_NORMAL
- en: Use case for creating multiple VM Cloud includes GEO site locations, dedicated
    hardware services to tenants, backup/secondary/DR infrastructure, or as per the
    features available as per the cloud provider's strategy; but, they are not limited
    to these.
  prefs: []
  type: TYPE_NORMAL
- en: IaaS services include virtual machines, virtual networks, and IaaS machines
    with automated application deployment, and they are provided using VM Clouds.
    But, they are not limited to these.
  prefs: []
  type: TYPE_NORMAL
- en: VM Clouds are responsible for delivering IaaS services including virtual machines
    and networks along with automated application deployment inside the virtual machines.
  prefs: []
  type: TYPE_NORMAL
- en: Registering SCVMM with Windows Azure Pack
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Before we start building VM Clouds and IaaS offerings, we must register our
    SCVMM instance with Windows Azure Pack. This is also called stamp registration.
  prefs: []
  type: TYPE_NORMAL
- en: 'The following steps need to be carried out for registering SCVMM stamp with
    Windows Azure Pack:'
  prefs: []
  type: TYPE_NORMAL
- en: Log into the Windows Azure Pack Management portal for administrators.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Browse the **vm clouds** workspace.![Registering SCVMM with Windows Azure Pack](img/00056.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **USE AN EXISTING VIRTUAL MACHINE CLOUD PROVIDER TO PROVISION VIRTUAL
    MACHINES**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provide **VIRTUAL MACHINE MANAGER SERVER FQDN** and **PORT NUMBER** (if customized).
    Note that it doesn't ask for credentials as Windows Azure Pack uses the service
    provider foundation VMM service account for accessing VMM. Enter **REMOTE DESKTOP
    GATEWAY FQDN**, which will be used for Azure Pack Console Connect. This can be
    configured later as a remote Desktop Gateway is covered later in this chapter.![Registering
    SCVMM with Windows Azure Pack](img/00057.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Upon successful registration, VMM stamps will be displayed in the **CLOUDS**
    workspace in the Windows Azure Pack portal.![Registering SCVMM with Windows Azure
    Pack](img/00058.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Review the Windows Azure Pack registration error, Windows Azure Pack, SPF, and
    VMM logs in case of any registration failure.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: We do not see any cloud listed in the Windows Azure Pack portal at this point
    as we have only integrated the virtualization machine cloud provider. Now, we
    will start building VM Clouds.
  prefs: []
  type: TYPE_NORMAL
- en: Building a SCVMM cloud for Windows Azure Pack cloud
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: A cloud in **SCVMM** is an umbrella containing our VMM fabric resources, such
    as compute (hypervisors), networking, and storage along with resources, such as
    VM, services, and templates. A cloud created in SCVMM is used by Windows Azure
    Pack to offer IaaS services to tenants using plans and subscriptions.
  prefs: []
  type: TYPE_NORMAL
- en: A cloud in SCVMM can be created using SCVMM host groups, which may contain different
    hypervisors or can be created from the VMware resource pool. At the time of writing
    this book, Windows Azure Pack VM Cloud didn't support SCVMM cloud created using
    the VMware resource pool.
  prefs: []
  type: TYPE_NORMAL
- en: Note that though VMware or server resources can be added in a SCVMM Cloud, IaaS
    resource provisioning on these via Windows Azure Pack tenant portal isn't possible.
    At this point of time, only Hyper-V is the supported hypervisor for IaaS services
    in a WAP VM Cloud. The third-party partner solutions are available for using Windows
    Azure Pack with VMware-based virtualization solutions. This limitation is applicable
    only for tenants' IaaS workloads, VMware/Xen, and other based VMs that can be
    used to host Windows Azure Pack management servers, websites, DBaaS servers, and
    more.
  prefs: []
  type: TYPE_NORMAL
- en: Before creating a SCVMM cloud, let's have a look at the SCVMM cloud's requirements
    with respect to Windows Azure Pack VM Cloud support.
  prefs: []
  type: TYPE_NORMAL
- en: Requirements for Windows Azure Pack VM Clouds
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'While creating a SCVMM cloud, consider the following prerequisites that need
    to be taken care of with respect to the Windows Azure Pack VM Cloud:'
  prefs: []
  type: TYPE_NORMAL
- en: An SCVMM cloud must be created from host groups. A cloud created with VMware
    resource pool is not supported by Windows Azure Pack at this point of time.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The cloud capability profile (ESX server, Hyper-V, or XenServer) must not be
    selected while creating the cloud.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A cloud capacity (compute/network/storage resource) must be selected as per
    the available capacity. The limits of these resources will be applicable for tenants
    using Windows Azure Pack cloud while provisioning resources.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Logical network planned for Windows Azure Pack must be already created and associated
    with the SCVMM cloud.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The VMM library share must be already created and configured with the cloud.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Service Management Automation** (**SMA**) will be discussed in the upcoming
    chapters. If it is being used for automation with respect to the SCVMM cloud,
    then the SMA web service certificate must be trusted on the SPF server. This will
    be discussed in detail in [Chapter 9](part0082_split_000.html#2E6E41-b479cf466c26404ca54119871a9b2715
    "Chapter 9. Automation and Authentication – Service Management Automation and
    ADFS"), *Automation and Authentication – Service Management Automation and ADFS*.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Creating a cloud in SCVMM
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The SCVMM management console is used to create a cloud in VMM. Before creating
    a cloud, verify that you have configured all the required fabric components. See
    [Chapter 2](part0023_split_000.html#LTSU2-b479cf466c26404ca54119871a9b2715 "Chapter 2. Getting
    the Cloud Fabric Ready"), *Getting the Cloud Fabric Ready*, to review the fabric
    components requirements.
  prefs: []
  type: TYPE_NORMAL
- en: 'Carry out these steps to create the SCVMM cloud:'
  prefs: []
  type: TYPE_NORMAL
- en: Log into the SCVMM server using the VMM console with administrative access.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Create Cloud** in the **Home** ribbon.![Creating a cloud in SCVMM](img/00059.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provide the cloud name and description in **Create Cloud Wizard**.![Creating
    a cloud in SCVMM](img/00060.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the **Host groups** cloud that is to be used for Windows Azure Pack tenant's
    workload in the **Select resource for this cloud** section. The wizard will also
    display the capacity or host groups in terms of CPU's memory and network.![Creating
    a cloud in SCVMM](img/00061.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: On the **Logical Networks** page, select logical network or networks created
    for the usage of Windows Azure Pack Cloud. It will be used by tenants to create
    and use VM networks. This will leverage network virtualization for provisioning
    virtual networks for tenants independent of each other. See [Chapter 2](part0023_split_000.html#LTSU2-b479cf466c26404ca54119871a9b2715
    "Chapter 2. Getting the Cloud Fabric Ready"), *Getting the Cloud Fabric Ready*,
    to learn more about network virtualization.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: Note that logical networks assigned with physical network adaptors on Hyper-V
    hosts will only be visible on this page.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '![Creating a cloud in SCVMM](img/00062.jpeg)'
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: Optionally, select **Load Balancers** to be made available for access in this
    cloud.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Optionally, select **VIP Templates** for cloud usage. VIP templates are used
    in conjunction with load balancers for virtual IPs and other related configurations.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Optionally, select **Port Classifications** to be used for cloud resources.
    The port profile can be used to specify **QOS** (**Quality of Service**) at the
    cloud layer along with a granular control at the Windows Azure Pack plans level.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Optionally, select **Storage** to be used to store virtual machines for this
    cloud. See [Chapter 2](part0023_split_000.html#LTSU2-b479cf466c26404ca54119871a9b2715
    "Chapter 2. Getting the Cloud Fabric Ready"), *Getting the Cloud Fabric Ready*,
    to know more on storage options for the Windows Azure Pack cloud.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the stored VM path and read only library shares for cloud usage.![Creating
    a cloud in SCVMM](img/00063.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Capacity** to know about the cloud capacity available for usage by
    tenants. This is one of the most important settings at the SCVMM layer for the
    cloud. The capacity should be wisely selected as per the availability of resources.
    This capacity limit will be applicable for all the tenants that the IaaS workload
    has hosted inside the cloud. The tenant level capacity limit shall be configured
    and at the Windows Azure Pack plan's level. While values such as CPU and memory
    are self-explanatory, custom quota values in capacity are values defined for virtual
    machine templates based upon parameters such as size. Later, these are used for
    restricting maximum resources provisioned by any self-service user in cloud.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: Note that custom quota points provide backward compatibility and are only applicable
    for self-service users created in VMM 2008 R2\. These aren't applicable for Windows
    Azure Pack VM Clouds.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '![Creating a cloud in SCVMM](img/00064.jpeg)'
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: On the **Capability Profiles** page, do not select any of the profiles (ESX/Hyper-V/XenServer).
    Windows Azure Pack doesn't support using a SCVMM cloud with a capability profile
    for IaaS workload of tenants.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If applicable, add any **Cloud Disaster Recovery Solutions** on **Replication
    Groups** page.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Review the settings on the **Summary** page.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Finish** to create the cloud.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: View the jobs to verify the status of cloud creation jobs. The newly created
    cloud will be visible in the **SCVMM VMs** and **Service Management** workspaces.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: Azure Site Recovery, Microsoft's cloud-based disaster recovery offering, can
    be leveraged for protecting SCVMM clouds against disasters. See [https://azure.microsoft.com/en-in/services/site-recovery/](https://azure.microsoft.com/en-in/services/site-recovery/)
    to learn more about Azure Site Recovery.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Verifying a SCVMM cloud in the Windows Azure Pack portal
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'We created a SCVMM cloud in the previous topic. In order to use it for building
    IaaS cloud offerings, it must be visible in the Windows Azure Pack Management
    portal for administrators under VM Clouds. Service provider foundation does the
    job of synchronizing the changes made at SCVMM and Windows Azure Pack level and
    vice versa. Let''s verify that the cloud is visible in the Windows Azure Pack
    Management portal:'
  prefs: []
  type: TYPE_NORMAL
- en: Log into the Windows Azure Pack Management portal for administrators.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Browse the **VM CLOUDS** sections.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Expand the currently registered SCVMM stamp.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The newly created cloud in the previous topic will be visible.![Verifying a
    SCVMM cloud in the Windows Azure Pack portal](img/00065.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If you do not see the newly created cloud listed in the Windows Azure Pack Management
    portal, verify the status of **Create new Cloud** Job in VMM. Have a look at the
    SPF SCVMM and Windows Azure Pack Integration checklist and status.
  prefs: []
  type: TYPE_NORMAL
- en: The SCVMM **Jobs** window provides clear details, comprising events occurred
    to perform any particular task along with individual status. This can be handy
    for any troubleshooting operation.
  prefs: []
  type: TYPE_NORMAL
- en: '![Verifying a SCVMM cloud in the Windows Azure Pack portal](img/00066.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: With this topic, we have successfully integrated our fabric and cloud with Windows
    Azure Pack. Furthermore, we will start creating cloud offerings for our Windows
    Azure Pack cloud.
  prefs: []
  type: TYPE_NORMAL
- en: Preparing OS images for a cloud catalogue (Windows and Linux VMs)
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: A cloud offering catalogue can be compared with any online shopping websites
    items catalogue. In any online shopping website, there are different types of
    items available for purchase, and then each item maybe available in different
    sizes or versions.
  prefs: []
  type: TYPE_NORMAL
- en: Customers choose items available in the given catalogue and make a purchase.
    The similar purchase aspect applies in the case of cloud catalogues. If we see
    any public cloud provider, such as Microsoft, Amazon, and more such catalogues
    for virtual machines offerings, there would be a range of operating systems available
    in different formats, such as Vanilla OS or an OS customized for particular application
    or workload type, which are available in different size configurations (CPU/memory/storage
    capacity). There can be other characteristics as well as differentiating catalogues,
    such as high availability, performance, features, and so on.
  prefs: []
  type: TYPE_NORMAL
- en: In the case of Windows Azure Pack-based cloud solution, SCVMM VM templates and
    Windows Azure Pack gallery items are the backbone of cloud catalogues. Both VM
    templates and gallery items rely on preinstalled OS VHDXs for the provisioning
    of virtual machines and applications. This Hyper-V **Virtual Hard Disk** (**VHD**)
    or VHDXs is stored in the VMM library for usage by VM templates and gallery resources.
  prefs: []
  type: TYPE_NORMAL
- en: In this section, we will cover the planning and execution of the preparation
    of virtual disks for VM templates and gallery items.
  prefs: []
  type: TYPE_NORMAL
- en: Planning VM images
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Preparing VM images and catalogues is a continuous process in any cloud solution
    since the cloud has to fulfil the daily changing needs of IT solutions. The number
    and types of images to be prepared for any cloud will depend on the provider's
    strategy and offerings portfolio.
  prefs: []
  type: TYPE_NORMAL
- en: In a generic scenario for a Windows Azure Pack-based cloud solution, the following
    images can be prepared for both organizations and service providers cloud solutions.
  prefs: []
  type: TYPE_NORMAL
- en: 'The following are based upon the operating systems supported by Hyper-V:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Images for all the available and supported Windows operating systems are as
    follows:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Windows Server 2012 R2
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Windows Server 2012
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Windows Server 2008 R2 SP1
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Windows Client Operating Systems (Win 7/8/8.1)
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Images for all available and supported Unix/Linux flavor operating systems
    are as follows:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Red Hat Enterprise Linux
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Cent OS
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Any other supported Unix distributions
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Any other Hyper-V supported operating system
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'For the size of the operating system disk, Windows Azure Pack provides the
    same size to the tenant''s virtual machines as that of the VHD''s template. Though
    it can be customized using Windows Azure Pack automation capabilities, it''s a
    good idea to have OS virtual disks available in multiple size variants such as
    the following:'
  prefs: []
  type: TYPE_NORMAL
- en: 150 GB
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 100 GB
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 80 GB
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 40 GB
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Any other size as per the organization's or tenant's needs
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In applications or workload specific OS disk Infrastructure as a Service (IaaS)
    Virtual machines are not just about providing plain operating systems for tenants'
    workloads; it can also provide servers with preconfigured applications of automated
    application deployment as per tenant's requirement; examples include web servers,
    dedicated database server dedicated for tenant, and so on. Separate OS disks can
    be created for applications or workload specific offerings having specific preinstalled
    or configuration apps or platforms for deploying applications (such as .NET framework).
  prefs: []
  type: TYPE_NORMAL
- en: Preparing a Sysprepped virtual disk for Windows OS virtual machine
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Each Windows operating system has a unique identifier attached, that is, a SID
    (secure ID). To avoid any SID conflict, Sysprep is used for VMs deployed using
    template VHD.
  prefs: []
  type: TYPE_NORMAL
- en: Once planning is completed for VM images to be prepared, the following instructions
    can be followed to prepare a Sysprepped virtual disk.
  prefs: []
  type: TYPE_NORMAL
- en: 'Steps for preparing VHD for Windows operating systems templates are as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: Create a Hyper-V virtual machine.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Mount OS installation ISO and install the operating system.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Install or verify Hyper-V integration services.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Configure any required local hardening policies.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Configure the accessibility setting such as enabling RDP and configuring Windows
    Firewall.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Install required agents (Antivirus, Backup, and so on).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Install any required Windows Roles and features if applicable.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Install any other third-party applications if applicable.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Add any script in start-up (such as Windows activation, agents configuration,
    and application deployment).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Update OS with the latest Windows patches and services packs.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Perform the necessary housekeeping such as removing installation media, event
    viewer logs, temp files, and more.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Have a final look at the OS to identify any missing component or issue.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: For generalizing the OS image using Sysprep, we can find `Sysprep.exe` in `C:\Windows\System32\Sysprep`
    folder. Select **Enter System Out-of-Box Experience (OOBE)** in **System Clean-up
    Action** with the **Generalize** option checked. Select **Shutdown** in **Shutdown
    Options** to power off the VM post in completion of Sysprep.![Preparing a Sysprepped
    virtual disk for Windows OS virtual machine](img/00067.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Post completion of this process, the virtual disk file can be copied to the
    VMM library for the usage of templates. It's a good idea to keep multiple copies
    of the prepared disk file for future usage and rollback.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Product key, hostname, and other values configured in the virtual disk don't
    have any effect on the provisioned VM using this. These will not be used after
    the Sysprep process.
  prefs: []
  type: TYPE_NORMAL
- en: Preparing VHDX for a Linux OS virtual machine
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Linux operating systems don't have any SID associates; hence, it does not require
    any Sysprep operation to be performed. However, there are additional considerations
    that need to be followed for generalizing OS image for the Linux workload.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s carry out the following steps to prepare the Linux OS image:'
  prefs: []
  type: TYPE_NORMAL
- en: Finalize the Linux version, partitions/LVM configurations, and more.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Mount the OS installation ISO and install the operating system.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Install or verify **Linux Integration Services** (**LIS**).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Configure any required local hardening policies.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Install required agents (Antivirus, Backup, and so on).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Install the SCVMM guest agent.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Install any other third-party applications if applicable.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Add any script in start-up (such as agents configuration /application deployment).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Update the OS with the latest patches and updates.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Perform some necessary housekeeping, such as removing installation media, logs,
    temp files, and so on.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Have a final look at the OS to identify any missing components or issues.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Remove any IP configuration and shutdown the virtual machine.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Post completion of this process, the virtual disk file can be copied to the
    VMM library for the usage of templates. It's a good idea to keep multiple copies
    of prepared disk file for future usage and rollback.
  prefs: []
  type: TYPE_NORMAL
- en: 'The SCVMM guest agent for the Linux operating system can be found on `C:\Program
    Files\Microsoft System Center 2012\Virtual Machine Manager\agents\Linux` on the
    VMM management server. Copy the agents into the Linux VM and execute the following
    commands for installation:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Run the following command:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Run either of the following commands as applicable for x86 or x64:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: IaaS virtual machine offerings – standalone VM versus VM Role
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Windows Azure Pack-based cloud solution provides the following two options
    to tenants for provisioning virtual machine workloads:'
  prefs: []
  type: TYPE_NORMAL
- en: Standalone virtual machine
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Virtual machine role (VM Role)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Standalone virtual machine
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Standalone virtual machine in Windows Azure Pack tenant admin portal is a direct
    mapping between standalone the VM offerings catalogue and the VM template created
    and configured in SCVMM.
  prefs: []
  type: TYPE_NORMAL
- en: For a standalone virtual machine, all the configurations are performed at the
    SCVMM level. The Windows Azure Pack portal is used to create virtual machine using
    predefined configurations in the SCVMM VM template. This does not give any flexibility
    to the tenant user to customize VM as per custom needs.
  prefs: []
  type: TYPE_NORMAL
- en: Cloud administrator needs to precreate multiple SCVMM VM templates for different
    sizes and options for providing flexibility to tenants in terms of choice. Any
    changes in the existing standalone VM offering has to be performed at the SCVMM
    end only.
  prefs: []
  type: TYPE_NORMAL
- en: Since standalone VM in Windows Azure Pack uses SCVMM VM templates directly,
    it is normally used to provide the vanilla operating system or OS with preinstalled
    or configured applications. It cannot be used to install applications as per tenants'
    needs in an automated fashion (which is provided by the service template engine
    in SCVMM).
  prefs: []
  type: TYPE_NORMAL
- en: In further topics, you will learn to create a SCVMM VM template, which can be
    used by standalone VM Role in Windows Azure Pack.
  prefs: []
  type: TYPE_NORMAL
- en: VM Role
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: VM Role in Windows Azure Pack provides a customizable self-service wizard for
    tenant users to request for virtual machines, which gives flexibility to tenant
    users to customize their virtual machines as per requirements. VM Roles can also
    be used to deploy automated applications at the top of virtual machines being
    delivered in the same self-service manner.
  prefs: []
  type: TYPE_NORMAL
- en: Unlike standalone VM Role, VM Role uses a service template engine of SCVMM for
    provisioning OS and apps.
  prefs: []
  type: TYPE_NORMAL
- en: VM Role in Windows Azure Pack subscription may contain multiple virtual machines
    of the same type or application and can be scaled easily (by just moving a sliding
    bar).
  prefs: []
  type: TYPE_NORMAL
- en: 'VM Role provides a lot of flexibilities over standalone VMs such as the following:'
  prefs: []
  type: TYPE_NORMAL
- en: Customizable self-service wizard for tenant's VM requests
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: With VM Role, tenants control VM configurations and deployment with options
    provided by the cloud provider, which removes any dependency on the VMM administrator
    for any VM changes required on the standard template.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: It adds extreme automation capabilities with the integration of **SMA** (**Service
    Management Automation**)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: It deploys applications and not just virtual machines in a self-service automated
    manner
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: It deploys and manage multiple instances of the same type under a single umbrella
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: It scales out the number of instances in just one click (by moving a slider)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: It provides the flexibility of using Hyper-V differencing or dedicated disks
    (added in CU5) for operating systems saving ample amount of disk space and management
    in larger deployments
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Microsoft and third-party vendors provide a wide range of preconfigured gallery
    items for VM Roles for standard usage. Custom VM Roles can also be developed which
    makes sky the limit for VM Role offerings possibilities.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In further topics, you will learn architecture, implementation, and other aspects
    of VM Roles.
  prefs: []
  type: TYPE_NORMAL
- en: Building standalone VM IaaS offerings
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: For every standalone VM offering in Windows Azure pack cloud, there has to be
    a direct mapping present with VM template in the SCVMM library. The VM template
    in the SCVMM library can be configured using a virtual disk prepared in the earlier
    topics. Let's start creating VM templates in SCVMM for Windows Azure Pack usage.
    Multiple templates can be created using the same VHD and defined hardware/OS profile
    combinations to provide flexible options for tenants for deploying VM workloads.
  prefs: []
  type: TYPE_NORMAL
- en: Requirements for using VM templates for Windows Azure Pack
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The following consideration must be taken care while creating VM templates
    to be used for a standalone VM in Windows Azure Pack:'
  prefs: []
  type: TYPE_NORMAL
- en: There must not be any cloud capability profile selected on the hardware profile
    page in the template creation wizard. The same case applies in case of any preconfigured
    hardware profile that is being used.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The VHD that is being used to create the template must have a remote desktop
    enabled.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: While creating the VM template, the guest OS profile must be selected from the
    drop-down list. It should not be selected as none.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Creating a SCVMM virtual machine template for Windows Azure Pack standalone
    VM Cloud offerings
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Before creating VM templates, prepare the required VHDs for templates and copy
    them to the VMM library.
  prefs: []
  type: TYPE_NORMAL
- en: 'Steps for creating a VM template for the standalone VM Role are as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: Log into SCVMM using the VMM management console with administrator privileges.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Navigate to the **Library** workspace and expand **Templates**.![Creating a
    SCVMM virtual machine template for Windows Azure Pack standalone VM Cloud offerings](img/00068.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click **Create VM Template** to start the VM template wizard.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Use an Existing VM template or virtual hard disk stored in the library**.
    You can also choose **From an existing virtual machine that is deployed on a host**
    if the VHD file isn't already copied to the VMM library.![Creating a SCVMM virtual
    machine template for Windows Azure Pack standalone VM Cloud offerings](img/00069.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Browse** to select VHD from the disks available in the VMM library.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provide the Template Name, Description, and Generation. Use a self-explanatory
    name and description that provides details about VM as this will be visible to
    the tenant user on the Windows Azure Pack portal. It's a good idea to include
    both hardware and software configurations along with the feature set available
    in the description.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: The generation of VM describes features and functionality available with virtual
    machines. Generation 2 VM introduces the Hyper-V 2012 R2; it provides support
    for the UEFI firmware, all synthetic devices, and more. See [https://technet.microsoft.com/en-in/library/dn282285.aspx](https://technet.microsoft.com/en-in/library/dn282285.aspx)
    to learn more about generation 2 virtual machines.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '![Creating a SCVMM virtual machine template for Windows Azure Pack standalone
    VM Cloud offerings](img/00070.jpeg)'
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: Use a precreated hardware profile or custom settings to customize hardware for
    the template. Ensure that no cloud capability profile is selected. Any hardware
    change in the offering at later storage has to be done in the hardware profile
    properties of the VM template.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Configure a proper network configuration such as virtual switch name, IP pool,
    and MAC (has to be static) as per the tenant's requirement. Add any additional
    hardware such as data disks at this stage.![Creating a SCVMM virtual machine template
    for Windows Azure Pack standalone VM Cloud offerings](img/00071.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Configure operating system profile settings. Do not select none in the OS profile
    settings; instead, precreate **Guest OS profiles** and select it from the drop-down
    list. Make necessary changes, such as Windows OS version, administrator password,
    time zone, product key, Domain/Workgroup, scripts to run, and so on. Do not select
    any Roles and features to add in this page. These are supported only with service
    templates or VM Role.![Creating a SCVMM virtual machine template for Windows Azure
    Pack standalone VM Cloud offerings](img/00072.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select none for the application profile and SQL profile settings as these aren't
    supported with standalone VM.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Review the settings on the **Summary** page and finish the wizard for creating
    the VM template.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: View job status under the **Jobs** windows in **Settings**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The newly created template will be available in the VMM library workspace under
    the **VM Templates** section.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Testing the VM template functionality
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Before assigning this standalone VM template in a Windows Azure Pack deployment,
    it''s a good idea to test the configuration by provisioning a test virtual machine
    using the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Log into SCVMM and browse the **VM template** section under the **Library**
    workspace.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Right-click on the newly created VM template and select **Create Virtual Machine**.![Testing
    the VM template functionality](img/00073.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provide the VM name and description. It's good to use the same the VM name and
    hostname for any VM to ensure consistency and easy identification at each layer.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Customize the hardware and guest OS profile if required.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the newly created cloud or host group as the destination for VM.![Testing
    the VM template functionality](img/00074.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Configure the operating system computer name and add custom properties such
    as server power on/off action.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Review the selected values in the summary and click on **Create** to start creating
    this virtual machine.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Monitor the VM creation job for any errors; browse VMs and the service workspace
    in SCVMM management console post successful completion.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Log into the newly created virtual machine and verify the expected results as
    per the configuration.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The VM Role architecture
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: VM Role in Windows Azure Pack adds greater flexibilities and self-service capabilities
    in IaaS offerings. VM Role is not just about providing virtual machines for tenant's
    workload, it takes IaaS services to another level by offering automated applications
    deployment in VM in a self-service manner.
  prefs: []
  type: TYPE_NORMAL
- en: VM Role packages are developed in JSON and provide resources or values, which
    are used to provision virtual machines and applications. **JSON** (**JavaScript
    Object Notation**) is a lightweight format used for data interchanging.
  prefs: []
  type: TYPE_NORMAL
- en: JSON files for a VM Role along with metadata such as logos, resources, and more
    make a VM Role package.
  prefs: []
  type: TYPE_NORMAL
- en: 'A VM Role is primarily made up of two components/packages as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: Resource Definition package
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Resource Extension package
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Before diving into these packages, let's understand VM Role's working mechanism.
    In a traditional scenario without any self-service portal, VM creation requires
    some set of input as variables, such as hardware configuration (the number of
    CPUs, the amount of memory, and more) and network configurations (virtual switch
    ), which are provided by virtualization administrators during the VM creation
    process. Similar things happen in a cloud-based self-service scenario where some
    value, such as VM name, configuration, and so on, would be provided to tenants
    as per their needs and some will be preconfigured by the cloud administrator,
    such as the hypervisor host to use, or SCVMM cloud to leverage for deploying VM.
  prefs: []
  type: TYPE_NORMAL
- en: In Windows Azure Pack-based cloud solution, a tenant user will provide tenant-specific
    values in Windows Azure Pack tenant portal using a self-service wizard. These
    values need to be passed to SCVMM where it will add up the administrator specified
    values and start the creation of virtual machine. In a similar manner, application
    deployment on IaaS services will also have to get values from the tenant user
    and administrator to deploy applications.
  prefs: []
  type: TYPE_NORMAL
- en: All these operations have to be done in a self-service and automated manner.
  prefs: []
  type: TYPE_NORMAL
- en: VM Role packages or gallery resource packages that were mentioned previously
    facilitate the preceding functionalities.
  prefs: []
  type: TYPE_NORMAL
- en: Resource definition packages
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: A resource definition package consists of VM configuration or values available
    to tenant users in a self-service wizard and their mapping with resourced resources
    in SCVMM, defined via a resource extension package. The definition of resource
    also contains a small package called `View Definition`, which includes values
    and graphical images visible to tenant users. If applicable, view resource definition
    values are mapped to the resource extension, and they are passed to VMM for VM
    and application deployment. Resource definition packages are stored with the `.resdefpkg`
    extension and gets imported in Windows Azure Pack.
  prefs: []
  type: TYPE_NORMAL
- en: 'Overall, the following files make up the resource definition package:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Resource Definition file** **(RESDEF File)**: It contains all parameters
    required by SCVMM—from VM Role to provisioning virtual machines and services'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**View Definition file** **(VIEWDEF File)**: It contains forms and icon mapping
    (Publisher icon/Resource icon) that are visible to tenant users while requesting
    IaaS resource using the VM Role gallery items'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Icons**: These icons are visible to tenant users in the list of gallery items'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Localization files**: These files are used to display the gallery item self-service
    deployment wizard with localized values'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Resource definition package includes conditions or parameters values, which
    must be met at SCVMM resource level to know which hard disk to use for OS or data
    . These values need to be configured on resources stored in SCVMM for VM Role
    usage. For example, a VM Role for Windows Server 2012 R2 VM is likely to have
    a condition configured that uses VHD available in SCVMM with the operating system
    family Windows Server 2012 and so on. Only compatible resources are available
    to tenant users to choose in the gallery resource deployment wizard.
  prefs: []
  type: TYPE_NORMAL
- en: Resources extension packages
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Resources extension packages are imported in System Center Virtual Machine Manager.
    Extension packages are used to provision the applications as a part of VM Role
    deployment. This is an optional component of VM Role and is used only while deploying
    VM Roles with automated applications provisioning. This can be compared to application
    profiles in VMM service templates. Resource extension leverages the SCVMM service
    template engine for executing application logic.
  prefs: []
  type: TYPE_NORMAL
- en: Parameters configured in resource extension packages are mapped to parameters
    in resource definition.
  prefs: []
  type: TYPE_NORMAL
- en: Along with resource extension packages, some VM Roles also contain **Application
    payload**.
  prefs: []
  type: TYPE_NORMAL
- en: Application payload contains resources such as installation binaries or media
    and scripts and other prerequisites for application deployment. This is an optional
    component, and its necessity varies from application to application.
  prefs: []
  type: TYPE_NORMAL
- en: Getting VM Role gallery resources
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Gallery resources consist of required packages such as resource definition
    packages, resource extension packages, and application payloads for any VM Role.
    Organizations or service providers choose the following ways to get gallery resources
    for their Cloud VM Role offerings:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Use Microsoft or third party provided gallery resources**: The Microsoft
    web platform installer includes a wide range of ready-made gallery resources for
    various offering, such as Windows Server Virtual Machine, web servers, domain
    controllers, and more. These gallery items can be downloaded and customized as
    per specific environment-based requirements'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Develop own custom gallery items**: Organizations or service providers may
    also choose to develop their own gallery items in JSON. This gives the flexibility
    of offering almost everything in the Windows Azure Pack-based cloud solution.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Dealing with gallery items – available tools
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'While JSON files and packages look more of developer stuff instead of IT professional,
    there are certain tools available that can be leveraged by IT professionals or
    cloud providers to deal with gallery items without any development knowledge (at
    least language specific). Microsoft and third-party vendors provide the following
    tools for dealing with gallery items in Windows Azure Pack-based deployment:'
  prefs: []
  type: TYPE_NORMAL
- en: '**VM Role authoring tool**: This tool can be used to create, view, and edit
    gallery item packages, such as resource definition package, resource extension
    package, and more. It can also be used to edit Microsoft or vendor provided gallery
    items for custom modifications. This tool is developed by CodePlex ([https://vmRoleauthor.codeplex.com/](https://vmRoleauthor.codeplex.com/)).'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Gallery resource import tool**: This tool simplifies the process of importing
    resource definition package into Windows Azure Pack, resource extension package
    into SCVMM, and sets the properties of resources such as hard disks. This tool
    is completely written in PowerShell.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Building VM Role IaaS offerings using gallery resources
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Microsoft and some third-party vendors have developed a wide range of standard
    gallery items for public usage. These gallery items can be downloaded and used
    by organizations or service providers for their cloud IaaS offerings. The beauty
    is that these can also be customized or modified to meet specific custom requirements.
  prefs: []
  type: TYPE_NORMAL
- en: The Microsoft Web Platform installer is used to download the Microsoft provided
    Windows Azure Pack gallery items.
  prefs: []
  type: TYPE_NORMAL
- en: Downloading gallery items using Microsoft Web PI
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Windows Azure Pack gallery items aren''t available in the standard WEB PI downloads
    list; custom feeds have to be added. Let''s have a look at the steps to download
    these resources:'
  prefs: []
  type: TYPE_NORMAL
- en: Log into Windows Azure Pack or any other server with Internet connectivity.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Launch **Microsoft Web Platform Installer** ([https://www.microsoft.com/web/downloads/platform.aspx](https://www.microsoft.com/web/downloads/platform.aspx)).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the **Options** link at the bottom of Web PI.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Add [http://www.microsoft.com/web/webpi/partners/servicemodels.xml](http://www.microsoft.com/web/webpi/partners/servicemodels.xml)
    in **Custom Feeds**.![Downloading gallery items using Microsoft Web PI](img/00075.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The new **Service Models** options will now be available in the Web PI.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Browse through the **Server Model** option and **Gallery Resource**. Select
    **Add** for gallery resources to be downloaded.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Clicking on **Install** will download these gallery resources on a local folder
    on a server where PI is running.![Downloading gallery items using Microsoft Web
    PI](img/00076.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Preparing and importing gallery resources in Windows Azure Pack and SCVMM
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Each gallery resource downloaded from Web PI usually contains one or more packages
    from the following:'
  prefs: []
  type: TYPE_NORMAL
- en: One or more Resource Definition Packages
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Resource Extension Packages
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: ReadMe file
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Any other application payload files
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The `ReadMe` file in gallery resources files usually contains a description
    about VM Role, package details, other application payload details, and download
    link if applicable. The most important thing is that it contains instructions
    for preparing SCVMM resources to be used for provisioning VM and applications.
  prefs: []
  type: TYPE_NORMAL
- en: 'Importing a gallery item in Windows Azure Pack/SCVMM and making it usable usually
    consists of the following operations:'
  prefs: []
  type: TYPE_NORMAL
- en: Download gallery resources and any application payload specified in the. `ReadMe`
    file.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Prepare operating system or data disks as specified in `ReadMe`. The OS disk
    must be prepared with `sysprep` and uploaded to the VMM library.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Import Resource Extension Package in SCVMM.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Prepare virtual hard disks (OS/data disks) properties as specified in `ReadMe`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Import Resource Definition Packages in Windows Azure Pack.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Perform any other additional tasks if required as per the `ReadMe` file.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Test the provisioning.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Importing resource extension packages in SCVMM
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Windows PowerShell cmdlet is used to import resource extension packages in SCVMM.
    There is no VMM or Windows Azure Pack GUI available to perform this function at
    this point of time.
  prefs: []
  type: TYPE_NORMAL
- en: 'The following PowerShell commands can be used to import this:'
  prefs: []
  type: TYPE_NORMAL
- en: Launch Virtual Machine Manager PowerShell Module.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Connect to the VMM server using admin privileges. The following PowerShell
    code can be used for connecting to the VMM server in a PowerShell session:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Enter VMM FQDN on the computer name attribute value. This will connect to the
    VMM service using credentials logged into Windows.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Execute the following PowerShell as per requirements to import the resource
    extension in VMM.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'The following code will import the Resource Extension named `SampleVMRole.resextpkg`
    stored at the `SystemDrive\GalleryResources\Sample-VMRole-Pkg\MyVMRole.resextpkg`
    folder in the SCVMM library named `MSSCVMMLibrary`:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Verify successful import by checking resource extension imported status using
    the following PowerShell command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: The results will display all the Resource Extension imported in SCVMM.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Configuring virtual hard disks properties for VM Role
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Each VM Role gallery resource requires at least one OS virtual disk for VM deployment,
    and optionally, it requires one or more additional data disks. Since VMM usually
    contains lots of virtual hard disks, VHD properties such as OS name, OS family
    name and release, and tags are used to identify disks compatible with a specific
    VM Role.
  prefs: []
  type: TYPE_NORMAL
- en: Each gallery resource has its own specific values for the previously mentioned
    parameters, which are defined in the `ReadMe` file. These parameters need to be
    configured manually on virtual hard disks prepared for the given VMM Role. All
    the compatible virtual hard disks, as per required parameters, are made available
    to tenant users' self-service portal while requesting for resources.
  prefs: []
  type: TYPE_NORMAL
- en: 'For example, the following attributes are required to be configured to the
    virtual hard disks that are available for a given gallery resource, which provisions
    VMs for Windows Server 2012 operating systems:'
  prefs: []
  type: TYPE_NORMAL
- en: '| **Configuration** | Install the following software:'
  prefs: []
  type: TYPE_NORMAL
- en: Windows Server 2012
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '|'
  prefs: []
  type: TYPE_NORMAL
- en: '| **The Operating System property** | Use one of the following:'
  prefs: []
  type: TYPE_NORMAL
- en: 64-bit edition of Windows Server 2012 Datacenter
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 64-bit edition of Windows Server 2012 Standard
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 64-bit edition of Windows Server 2012 Essentials
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Windows Server 2012 R2 Datacenter Preview
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Windows Server 2012 R2 Standard Preview
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Windows Server 2012 R2 Essentials Preview
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '|'
  prefs: []
  type: TYPE_NORMAL
- en: '| **The Familyname property** | Consider the following values for a familyname:'
  prefs: []
  type: TYPE_NORMAL
- en: Windows Server 2012 Datacenter
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Windows Server 2012 Standard
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Windows Server 2012 Essentials
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Windows Server 2012 R2 Datacenter Preview
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Windows Server 2012 R2 Standard Preview
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Windows Server 2012 R2 Essentials Preview
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '|'
  prefs: []
  type: TYPE_NORMAL
- en: '| **Tags** | Add all of the following tags:'
  prefs: []
  type: TYPE_NORMAL
- en: Windows Server 2012
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Windows Server 2012 R2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '|'
  prefs: []
  type: TYPE_NORMAL
- en: These parameters can be configured using VMM GUI or VMM PowerShell. Tags parameter
    can only be configured using VMM PowerShell.
  prefs: []
  type: TYPE_NORMAL
- en: Configuring the operating system property
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: The operating system property specifies the operating system installed inside
    the virtual hard disk. This can be configured using the VMM management console
    or PowerShell.
  prefs: []
  type: TYPE_NORMAL
- en: 'In the following sample PowerShell, values can be replaced as per the gallery
    resource specific `Readme` file values:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: For data disks, the operating system property must be set to *None*.
  prefs: []
  type: TYPE_NORMAL
- en: Configuring family name and release property
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: The `familyName` and `release` properties are the configuration behind virtual
    disk availability in the tenant self-service provisioning wizard. All virtual
    disks having `familyName` and `release` properties configured, as per gallery
    resources requirements, are visible to a tenant user for usage.
  prefs: []
  type: TYPE_NORMAL
- en: The `familyName` usually contains OS version and VM Role specific values, such
    as webserver, domain controller, and so on. The `release` property usually controls
    multiple versions of virtual hard disks and is usually mentioned as 1.0.0.0, 1.0.0.1,
    1.1.0.0 and more.
  prefs: []
  type: TYPE_NORMAL
- en: 'The `familyName` and `release` properties can be configured using the VMM administrator
    console or PowerShell. See the following sample PowerShell for configuring the
    `familyName` and `release` properties for virtual hard disks. The values can be
    replaced as per requirements provided in the gallery resource `Readme` file:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: Data disks may have values, such as SQL DB disk, larger disks, smaller disks,
    and so on.
  prefs: []
  type: TYPE_NORMAL
- en: Configuring the tags property
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: The `tags` property must be configured properly as per gallery resource requirements
    to make it available for provisioning. While it is a must for operating systems
    disks to have `tags` configured, data disks may or may not have `tags` specific
    requirement. Tags may be words defining Roles or features that VM Roles provides.
  prefs: []
  type: TYPE_NORMAL
- en: Tags can be configured only using VMM PowerShell. There is no VMM GUI option
    available at this point of time for configuring `tags` on virtual hard disks.
  prefs: []
  type: TYPE_NORMAL
- en: 'See the following sample PowerShell for configuring the `tags` property for
    virtual hard disks. Values can be replaced as per requirements provided in the
    gallery resource `Readme` file:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: PowerShell for configuring virtual disk properties must be executed on VMM PowerShell
    or Windows PowerShell, loaded with VMM modules, connected with the SCVMM instance.
  prefs: []
  type: TYPE_NORMAL
- en: Importing the Resource Definition package in Windows Azure Pack
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The Windows Azure Pack management or administrator portal or Windows Azure Pack
    PowerShell can be used to import gallery Resource Definition package in Windows
    Azure Pack.
  prefs: []
  type: TYPE_NORMAL
- en: 'The following are the steps for importing gallery resource definition package
    in Windows Azure Pack:'
  prefs: []
  type: TYPE_NORMAL
- en: Log into the Windows Azure Pack management portal for administrators.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Navigate to the **vm clouds** workspace.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the **GALLERY** tab.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **IMPORT** button from the tasks pane.![Importing the Resource Definition
    package in Windows Azure Pack](img/00077.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the resource definition file (`RESDEFPKG`) to be imported.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Items will be listed in the gallery upon successful import.![Importing the Resource
    Definition package in Windows Azure Pack](img/00078.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Imported gallery items can now be tested for deployment using Windows Azure
    Pack tenant portal. This will be covered in detail in the next chapter.
  prefs: []
  type: TYPE_NORMAL
- en: Using GRIT (Gallery Resource Import) tool
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: GRIT, also known as Gallery Resource Import tool, is a Microsoft provided tool
    written in PowerShell. It can be used to ease the gallery resource downloading
    and installing process covered in the previous topic. The GRIT tool provides a
    graphical user interface for the lifecycle of gallery resource installation or
    import.
  prefs: []
  type: TYPE_NORMAL
- en: It is recommended to use the GRIT tool while dealing with gallery resources
    for ease administrator and to avoid any human errors in PowerShell scripts.
  prefs: []
  type: TYPE_NORMAL
- en: GRIT functionalities
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'GRIT provides the following capabilities in an easy-to-use graphical user interface:'
  prefs: []
  type: TYPE_NORMAL
- en: It can be used with both Microsoft provided gallery resources as well as custom
    developed resources
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: It can download gallery resources directly from Microsoft (no need for a web
    PI)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Importing of Resource Extension files
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Importing of Resource Definition files
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: It can compare and configure virtual disk properties (for both OS and data disks)
    required for gallery resource with disks available in the VMM library
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: It makes gallery items private and public (this is discussed in detail in the
    next chapter)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Removal of Resource Definition or Extension files
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using GRIT for dealing with gallery resource
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The latest version of the GRIT tool is 1.2, which can be download from [https://gallery.technet.microsoft.com/Gallery-Resource-Import-2273ce71](https://gallery.technet.microsoft.com/Gallery-Resource-Import-2273ce71).
    The GRIT tool needs to have access to SCVMM, SPF, and Windows Azure Pack; hence,
    the SPF server is the best place to run the tool.
  prefs: []
  type: TYPE_NORMAL
- en: 'We need to carry out the following steps to use GRIT:'
  prefs: []
  type: TYPE_NORMAL
- en: Download the GRIT tool and log into Windows with an account having permission
    on SCVMM, SPF, and Windows Azure Pack.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Execute the downloaded `GalleryResourceImportTool.ps1` PowerShell script with
    elevated access.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The PowerShell script execution will start with check parameters and prerequisites.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: It will launch a GUI console similar to the following, depending upon Internet
    access.![Using GRIT for dealing with gallery resource](img/00079.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Browse your local computer for gallery resource files or select any online available
    gallery resource to download and import the files.![Using GRIT for dealing with
    gallery resource](img/00080.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the **Virtual Disks Configuration** page to set VHD properties.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Choose an operating system version from the drop-down list as applicable.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Choosing the OS version will automatically display the available VHD and its
    status (matching with requirement specified in VM Role packages). Select VHD to
    use this particular gallery items, and hit **Apply These OS Disk Settings to Selected
    Disks(s) and Refresh List** to apply OS disk parameters and **Apply These Data
    Disk Settings to Selected Disks(s) and Refresh List** to apply data disk parameters.
    The refreshing list will display disks configured with status as green, which
    means configured.![Using GRIT for dealing with gallery resource](img/00081.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the **Gallery Resource Import** page to import Resource Extension and
    Definition packages in SCVMM and Windows Azure Pack respectively.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Choose **VMM Library** **Share** from the drop down list.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Import Resource Extension**, **Import Resource Definition**, or both
    as applicable.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Make Gallery Item Public** if required (this is discussed in detail
    in the next chapter).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Clicking on import will import the resource Extension and Definition packages
    in SCVMM and Windows Azure Pack respectively.![Using GRIT for dealing with gallery
    resource](img/00082.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The **Bonus tools** page can be used to access additional features such as removing
    extension and definition packages or making any definition package private.![Using
    GRIT for dealing with gallery resource](img/00083.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Developing VM Role gallery resource using VM Role Authoring tool
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: VM Role Authoring tool is published as an open source project on CodePlex. It
    provides an easy-to use-GUI for developing custom gallery resources for Windows
    Azure Pack VM Role.
  prefs: []
  type: TYPE_NORMAL
- en: With VM Role Authoring tool, the components of VM Role such as Resource Definition
    package and Resource Extension package can be developed from scratch, and it can
    also be used to modify the available gallery items at Microsoft for environmental
    specific requirements.
  prefs: []
  type: TYPE_NORMAL
- en: 'VM Role Authoring tool can be used for VM Roles developing and modifications
    operations, including:'
  prefs: []
  type: TYPE_NORMAL
- en: A Resource Definition package
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: View Definition packages and localized resource files
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Resource Extension packages for Windows and Linux machines
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The mapping of parameters and values of Resource Definition to Resource Extension
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Getting the VM Role Authoring tool
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: This tool is available on the CodePlex site. The latest, stable version available
    at the point of writing this book was 1.1.
  prefs: []
  type: TYPE_NORMAL
- en: Any supported Windows system can be used for developing VM Roles using this
    tool.
  prefs: []
  type: TYPE_NORMAL
- en: You can the download VM Role Authoring tool from [https://vmroleauthor.codeplex.com/](https://vmroleauthor.codeplex.com/).
    Post downloading, the tool can be extracted to any location in the system.
  prefs: []
  type: TYPE_NORMAL
- en: Developing sample gallery resource – VM Role
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: VM Roles are written in JSON language. The VM Role Authoring tool adds a basic
    graphic user interface to it. Using VM Role Authoring tool, IT professionals can
    develop custom gallery resources without the knowledge of JSON (it's good to have
    it though).
  prefs: []
  type: TYPE_NORMAL
- en: 'The VM Role Authoring tool displays each configuration and bindings in two
    ways:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Editor View: This provide GUI.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'JSON View: This is the configuration view in the advanced JSON language. It
    can be modified for any deep custom modifications.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Let's create a sample VM Role gallery resource for a Windows machine IaaS VM
    Role to learn more about using VM Role Authoring tool and developing custom VM
    Roles.
  prefs: []
  type: TYPE_NORMAL
- en: 'The following are the steps to create VM Role:'
  prefs: []
  type: TYPE_NORMAL
- en: Execute `VM Role Authoring Tool.exe`.![Developing sample gallery resource –
    VM Role](img/00084.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provide the package name and directory to store the gallery resources.![Developing
    sample gallery resource – VM Role](img/00085.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provide gallery resources called **Version** and **Publisher**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: .
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '![Developing sample gallery resource – VM Role](img/00086.jpeg)'
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: '**Resource Requirements** contains parameters that are required to be set on
    virtual hard disks to be used for provisioning of this VM Role. Enter parameters
    such as Tags.![Developing sample gallery resource – VM Role](img/00087.jpeg)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Expand **Application Profile (Windows)** and select **Roles & Features**. This
    option can be used to enable Windows Roles and features in VM Role post deployment
    in an automated fashion. Select the compatible OS and required Roles and features.![Developing
    sample gallery resource – VM Role](img/00088.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Click on **Add** and select **Web Application** / **SQL DAC Application** /
    **Script Application** or anything else, as applicable for automated application
    installation. This feature enables cloud providers to deliver more than IaaS:
    automated web, applications, and database provisioning at the top of Vanilla IaaS
    services.![Developing sample gallery resource – VM Role](img/00089.jpeg)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **File** and select the new **Resource Definition** file. Provide the
    Resource Definition file name and location. Add **Version** and **Publisher**
    properties.![Developing sample gallery resource – VM Role](img/00090.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the **Extension Reference** page, binding or mapping between Resource Definition
    and Resource Extension parameters is performed. Select the available Resource
    Extension package. It will populate **Name** and **Publisher** details and more
    automatically.![Developing sample gallery resource – VM Role](img/00091.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the **Parameters** tab, add values to be provided by tenant users in self-service
    form.![Developing sample gallery resource – VM Role](img/00092.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The **Scale Out** configuration adds easy (by just moving a slider) scale in
    and scale out features for this VM Role. Minimum, initial, and maximum instance
    counts can be provided.![Developing sample gallery resource – VM Role](img/00093.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Hardware Profile** provides options to tenant users with respect to the size
    of VM in terms of compute (CPU and memory). **Param.VMRoleVMSize** provides standard
    Azure size available to tenant users, such as extra small, small, and so on.![Developing
    sample gallery resource – VM Role](img/00094.jpeg)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In **Storage Profile**, cloud administrators can add additional VDHXs to VM
    Role such as data disks and DB disks as applicable. Parameters such as tags and
    others need to be defined for each disk added in VM Role.![Developing sample gallery
    resource – VM Role](img/00095.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Network Profile** provides options to configure networking options for a
    VM Role such as NIC connectivity, load balancers, and more. Additional network
    adaptors can be used using the **Add** button.![Developing sample gallery resource
    – VM Role](img/00096.jpeg)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Operating System Profile** provides OS options to configure such as local
    administrator password, machine to join domain, or workgroup. Tenant specific
    settings can be entered by user in a self-service wizard. Map values to the self-service
    wizard using generate new parameter in the drop-down list.![Developing sample
    gallery resource – VM Role](img/00097.jpeg)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the **ViewDefinition** section, graphical icons such as **Label**, **PublisherLabel**,
    and **Description** that are available to tenant users in the gallery catalogue
    can be added.![Developing sample gallery resource – VM Role](img/00098.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Validate** to verify all configurations and mapping.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Save** to save packages and other components.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: These packages can now be imported to Windows Azure Pack and SCVMM respectively.
    See the previous topic to see how to import gallery resources.
  prefs: []
  type: TYPE_NORMAL
- en: With VM Role Authoring tool, JSON language scripting capabilities, and **Service
    Management Automation** (**SMA**), service providers may configure XaaS (anything
    as a service) cloud service offerings.
  prefs: []
  type: TYPE_NORMAL
- en: The virtual machine Role example kit
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Microsoft provides a virtual machine Role example kit, which can be used as
    a reference for developing custom VM Role using VM Role Authoring tool.
  prefs: []
  type: TYPE_NORMAL
- en: The example kit contains example configurations of Resource Extension packages,
    Resource Definition packages, payload, custom scripts, and a lot more. This can
    help cloud providers in developing customer VM Role gallery resources.
  prefs: []
  type: TYPE_NORMAL
- en: The virtual machine Role example kit can be downloaded from [http://blogs.technet.com/b/privatecloud/archive/2013/12/11/virtual-machine-Role-example-kit.aspx](http://blogs.technet.com/b/privatecloud/archive/2013/12/11/virtual-machine-Role-example-kit.aspx).
  prefs: []
  type: TYPE_NORMAL
- en: Accessing tenant virtual machines – Windows Azure Pack Console Connect
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Windows Azure Pack provides two ways of connecting to virtual machine for tenants:'
  prefs: []
  type: TYPE_NORMAL
- en: Remote desktop connection
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Windows Azure Pack Console Connect
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Remote desktop connection in a Windows Azure Pack Cloud works in the traditional
    RDP mechanism, requiring network connectivity to VM guest OS, RDP to be enabled,
    firewall rules to allow RDP communications, and lots more. If machines need to
    be accessed on Internet (service provider cloud scenarios), public IP would also
    be required.
  prefs: []
  type: TYPE_NORMAL
- en: The other option, Windows Azure Pack Console Connect, solves the challenges
    of RDP method. It provides access to VM guest OS through Hypervisor host using
    remote desktop gateways. Console Connect does not require any network reachability
    to the guest OS.
  prefs: []
  type: TYPE_NORMAL
- en: The Console Connect gives access to tenant users of their VM in similar way
    as of VM connect for Hyper-V manager over SSL using remote desktop gateway.
  prefs: []
  type: TYPE_NORMAL
- en: Console Connect doesn't have any dependency on the state of the operating system
    inside virtual machine (powered off, crashed, or something else). Since Console
    Connect works in a different way from RDP, few RDP features such as clipboard
    redirection, drives mapping, sound and printer redirection, and more aren't available.
  prefs: []
  type: TYPE_NORMAL
- en: Windows Azure Pack Console Connect architecture
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Windows Azure Pack Console Connect leverages the Remote Desktop Gateway services
    of Windows Server 2012 R2 for establishing Console Connect to VM via an underlying
    hypervisor on SSL.
  prefs: []
  type: TYPE_NORMAL
- en: Console Connect doesn't use any guest OS (inside VM) level authentication. It
    works upon SSL certificate token claim-based authentication. This requires Windows
    Azure Pack, SPF, remote desktop gateway server, VMM, and Hyper-V hosts to trust
    each other.
  prefs: []
  type: TYPE_NORMAL
- en: Windows Azure Pack along with the remote desktop gateway, SPF, and SCVMM authenticates
    users and authorizes access to virtual machine and generate token assigned to
    tenants for accessing this particular VM. This token is used by Hyper-V host to
    ensure that tenant users get access to only authorized virtual machine.
  prefs: []
  type: TYPE_NORMAL
- en: This process isn't visible to tenant users. When a tenant user connects to any
    VM using Console Connect on the Azure Pack portal, it downloads a RDM file containing
    all required connectivity details. Running this RDP file connects user to the
    VM's console.
  prefs: []
  type: TYPE_NORMAL
- en: '![Windows Azure Pack Console Connect architecture](img/00099.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Diagram Source: TechNet'
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: All servers participating in the Console Connect architecture must run Windows
    Server 2012 R2.
  prefs: []
  type: TYPE_NORMAL
- en: Minimum RDP version for Console Connect at the client end is 8.1.
  prefs: []
  type: TYPE_NORMAL
- en: Preparing certificates for Console Connect deployment
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: A trust relationship needs to be configured between remote the Desktop Gateway
    Server, SPF, SCVMM, and Hyper-V hosts to support claim token-based authentication.
    Single or multiple SSL certificates can be used to establish this trust relationship.
  prefs: []
  type: TYPE_NORMAL
- en: 'The SSL certificate used for Console Connect must meet the following requirements:'
  prefs: []
  type: TYPE_NORMAL
- en: The certificate must be valid, which is not expired
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The key usage field must contain a digital signature
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The enhanced key usage field must contain the following client authentication
    object identifier: (1.3.6.1.5.5.7.3.2)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Root certificates for the **certification authority** (**CA**) that issued the
    certificate must be installed in the Trusted Root Certification Authorities certificate
    store
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The cryptographic service provider for the certificate must support SHA256
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: SSL certificates can be self-signed as well as issued from any internal enterprise
    or public certificate authority. It is recommended to use CA provided SSL for
    better management and easy renewals.
  prefs: []
  type: TYPE_NORMAL
- en: Deploying Console Connect
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Deploying Windows Azure Pack Console Connect requires multiple operations to
    be performed, such as importing the Console Connect certificate, configuring RDS
    Gateway, and adding RDS Gateway in Windows Azure Pack.
  prefs: []
  type: TYPE_NORMAL
- en: Importing trusted certificates (Console Connect) to management servers
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Instead of importing a Console Connect certificate to each Hyper-V hosts individually,
    it can first be imported in the VMM database, and then be distributed to Hyper-V
    hosts. For this, the following steps are carried out:'
  prefs: []
  type: TYPE_NORMAL
- en: Execute VMM PowerShell on as an administrator.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Connect to the SCVMM server using the `Set-SCVMMServer` PowerShell cmdlet.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Use the following script to import the certificate in the VMM DB. Update highlighted
    values as per environmental specific details:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Wait for all Hyper-V hosts to refresh in SCVMM, or manual refresh it by logging
    into the VMM management console.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'If you use a self-signed certificate, import the public key of the certificate
    to the trusted root certification authorities certificate store for the Hyper-V
    hosts. Restart the Hyper-V management service post import:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Import a certificate to the SPF server; here, PowerShell can be used:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Configure the service provider foundation to use this certificate to create
    claim tokens using the following PowerShell cmdlet. Replace thumbprint values
    as applicable:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Define token lifetime in minutes from 1 to 60\. Thumbprint value of SSL certificate
    can be found using the following PowerShell cmdlet:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Setting up Remote Desktop Services Gateway
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'To set up Remote Desktop Services Gateway, the following steps are carried
    out:'
  prefs: []
  type: TYPE_NORMAL
- en: Log into the VM designated for RDS Gateway Role.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Install the Remote Desktop Gateway component using **Add Roles and Features**
    in Server Manager.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Install the Microsoft System Center Virtual Machine Manager Console Connect
    Gateway component on the Remote Desktop Gateway server. The MSI installer for
    SCVMM Console Connect Gateway can be found in the SCVMM installation media location
    `CDLayout.EVAL\amd64\Setup\msi\RDGatewayFedAuth`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Import the public key of the certificate into the personal certificate store:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Configure the RDS Gateway server to accept tokens using Console Connect SSL
    and hash algorithms.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'This is configured using the `TrustedIssuerCertificateHashes` and `AllowedHashAlgorithms`
    properties in the **Windows Management Instrumentation** (**WMI**) `FedAuthSettings`
    class. Use the following PowerShell to configure the RDS Gateway server:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Replace the server as thumbprint values with environment-specific values:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Configure the SSL certificate for RDS Gateway server. This certificate will
    be used to identify RDS server by clients. Use the RDS Gateway manager to create
    a self-signed SSL or use the existing trusted SSL.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Verify the configuration at SCVMM, Hyper-V hosts, SPF, and RDS Gateway server.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Registering RDS Gateway server in Windows Azure Pack
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Windows Azure Pack provides the option to register Remote Desktop Gateway server
    while registering the SCVMM stamp. The RDS Gateway server must be registered with
    mapping to the VMM server to function.
  prefs: []
  type: TYPE_NORMAL
- en: Any existing registered SCVMM connection can also be modified to add RDS Gateway
    at a later stage.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s see the following steps for registering RDS Gateway:'
  prefs: []
  type: TYPE_NORMAL
- en: Log into the Windows Azure Pack management portal and browse to the VM Clouds.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select an existing SCVMM registration and click on **Edit**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provide RDS Gateway FQDN and click on **Finish** to complete the configuration.![Registering
    RDS Gateway server in Windows Azure Pack](img/00100.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Securing the Console Connect deployment
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Windows Azure Pack Console Connect uses SSL token-based claim authentication.
    It is recommended to consider the following security recommendations while deploying
    the Console Connect environment:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Token Lifetime: RDP File downloaded by the tenant user for accessing VM console
    contains the `EndpointFedAuth` token to verify user''s authenticity. It is recommended
    to configure token lifetime to small values such as 1 or 2 minutes to eliminate
    the security risk of losing or leaking this file.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Configure strong firewall and security policies on the RDS Gateway server to
    protect it from malicious users or attacks. For example, it's a good idea to block
    the RDP (3389) port.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Access to the certificate store on the SCVMM server generating token should
    be restricted.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: It is recommend to use a CA-provided certificate with a valid chain for the
    Hyper-V host. This will prevent the RDP connection warning related to the identification
    of the computer's identity.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The RDP file downloaded by tenant user contains hostname/network details of
    Hyper-V server hosting that machine. This allows tenant users to see hypervisor
    host network details. It is recommended to secure Hyper-V hosts and prevent Internet
    access to avoid the misuse of these details.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: With this chapter, we are ready with a Windows Azure Pack-based cloud solution
    having IaaS services ready for tenants. You learned about Windows Azure Pack VM
    Clouds architecture and steps for building SCVMM cloud for Windows Azure Pack.
    You learned about building IaaS offerings, also known as catalogues, for Windows
    and Linux operating systems. We also covered creating custom offerings using the
    VM Role authoring tool as well as using GRIT for easy import of gallery resources
    in Windows Azure Pack and SCVMM.
  prefs: []
  type: TYPE_NORMAL
- en: Accessing virtual machines using RDP and Console Connect along with Console
    Connect architecture and deployment was also covered.
  prefs: []
  type: TYPE_NORMAL
- en: In the next chapter, we will be assigning these services to tenants using Windows
    Azure Pack plans and subscriptions.
  prefs: []
  type: TYPE_NORMAL
