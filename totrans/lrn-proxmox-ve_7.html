<html><head></head><body><div class="chapter" title="Chapter&#xA0;7.&#xA0;Securing Proxmox VE"><div class="titlepage"><div><div><h1 class="title"><a id="ch07"/>Chapter 7. Securing Proxmox VE</h1></div></div></div><div class="blockquote"><table border="0" width="100%" cellspacing="0" cellpadding="0" class="blockquote" summary="Block quote"><tr><td valign="top"> </td><td valign="top"><p>"Abstraction may be discovered or produced, may be material or immaterial, but abstraction is what every hack produces and affirms....To hack is to produce or apply the abstract to information and the possibility of new worlds"</p></td><td valign="top"> </td></tr><tr><td valign="top"> </td><td colspan="2" align="right" valign="top" style="text-align: center">--<span class="attribution">
<span class="emphasis"><em>A Hacker Manifesto, McKenzie Wark</em></span>
</span></td></tr></table></div><div class="blockquote"><table border="0" width="100%" cellspacing="0" cellpadding="0" class="blockquote" summary="Block quote"><tr><td valign="top"> </td><td valign="top"><p>
<span class="emphasis"><em>"Putting it bluntly, virtualization is deception."</em></span>
</p></td><td valign="top"> </td></tr><tr><td valign="top"> </td><td colspan="2" align="right" valign="top" style="text-align: center">--<span class="attribution">
<span class="emphasis"><em>Data Center Virtualization Essentials, Gustavo Alessandro Andrade Santana</em></span>
</span></td></tr></table></div><div class="blockquote"><table border="0" width="100%" cellspacing="0" cellpadding="0" class="blockquote" summary="Block quote"><tr><td valign="top"> </td><td valign="top"><p>
<span class="emphasis"><em>"The enemy knows the system being used..."</em></span>
</p></td><td valign="top"> </td></tr><tr><td valign="top"> </td><td colspan="2" align="right" valign="top" style="text-align: center">--<span class="attribution">
<span class="emphasis"><em>Shannon's Maxim</em></span>
</span></td></tr></table></div><div class="blockquote"><table border="0" width="100%" cellspacing="0" cellpadding="0" class="blockquote" summary="Block quote"><tr><td valign="top"> </td><td valign="top"><p>
<span class="emphasis"><em>"Security through obscurity is not an answer."</em></span>
</p></td><td valign="top"> </td></tr><tr><td valign="top"> </td><td colspan="2" align="right" valign="top" style="text-align: center">--<span class="attribution">
<span class="emphasis"><em>Information Security: Principles and Practices, Merkow and Breithaupt</em></span>
</span></td></tr></table></div><div class="blockquote"><table border="0" width="100%" cellspacing="0" cellpadding="0" class="blockquote" summary="Block quote"><tr><td valign="top"> </td><td valign="top"><p>
<span class="emphasis"><em>"Containers have quickly become a popular cloud-optimization strategy for enterprises, however, what do we really know about the security implications?"</em></span>
</p></td><td valign="top"> </td></tr><tr><td valign="top"> </td><td colspan="2" align="right" valign="top" style="text-align: center">--<span class="attribution">
<span class="emphasis"><em>Kowsik Guruswamy</em></span>
</span></td></tr></table></div><p>The end goal of this chapter is to support you in mitigating threats to the security of your Proxmox VE infrastructure.</p><p>We start by enumerating and articulating the potential benefits of virtualization on infrastructure security.</p><p>However, these benefits must not be relied on unconditionally or discussed uncritically; we must qualify them here.</p><p>Moreover, we must expose the potential security risks virtualization can inject into the infrastructure.</p><p>Ultimately, this chapter commits to providing strategies for mitigating security threats to our Proxmox VE hosts and guests.</p><p>Security assurance is, of course, a sprawling field, and often includes not only threat mitigation, but also policy making, monitoring, incident response, and forensics. Our focus here is exclusively on mitigating vulnerabilities specific to Proxmox VE hosts.</p><p>Towards that end, then, the goals of security are defined here in accordance with tradition:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Maintaining the <span class="emphasis"><em>confidentiality</em></span> of a system</li><li class="listitem" style="list-style-type: disc">Assuring its <span class="emphasis"><em>integrity</em></span></li><li class="listitem" style="list-style-type: disc">Providing consistent <span class="emphasis"><em>availability</em></span> of services</li></ul></div><p>
</p><div class="mediaobject"><img src="graphics/B01784_07_01-3.png" alt="Securing Proxmox VE"/><div class="caption"><p>Security triad</p></div></div><p>
</p><p>The preceding illustration suggests that these three points are not isolated: the whole picture consists of three mutual relationships: one between confidentiality and integrity; one between confidentiality and availability; and, finally, one between integrity and availability. Too much or too little emphasis on one point distorts our Platonic triangle, a symbolic representation of our impossible ideal.</p><p>Given our end goal—mitigating threats—this chapter proceeds along the following vector:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Examining the potential security rewards of virtualization</li><li class="listitem" style="list-style-type: disc">Interrogating those rewards and exploring the potential vulnerabilities virtualization introduces</li><li class="listitem" style="list-style-type: disc">Acting directly to mitigate threats</li></ul></div><div class="section" title="Security benefits of virtualization"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec35"/>Security benefits of virtualization</h1></div></div></div><p>Introducing well-planned, deliberate, and well-executed virtualization into an infrastructure delivers some very compelling security benefits.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note63"/>Note</h3><div class="blockquote"><table border="0" width="100%" cellspacing="0" cellpadding="0" class="blockquote" summary="Block quote"><tr><td valign="top"> </td><td valign="top"><p>"The abstraction of IT resources that masks the physical nature and boundaries of those resources..."</p></td><td valign="top"> </td></tr><tr><td valign="top"> </td><td colspan="2" align="right" valign="top" style="text-align: center">--<span class="attribution">
<span class="emphasis"><em>Virtualization as defined by Gartner's IT Glossary (<a class="ulink" href="http://www.gartner.com/it-glossary/virtualization">http://www.gartner.com/it-glossary/virtualization</a>).</em></span>
</span></td></tr></table></div><p>Let's be clear about one thing with regard to this common trope representing virtualization as a deceptive masquerade: security through obscurity does not work. The use of secrecy for the design or implementation of a system to provide security is a failing proposition.</p><p>In enumerating the security benefits of virtualization, this section purposefully avoids suggesting that abstraction and the obfuscation it permits are an effective security strategy.</p></div></div><p>We'll see as the chapter develops that none of the security rewards promised by virtualization advocates can be realized without a good understanding of networking, systems administration, type 2 hypervisors, VMs, and containers. The following is also required:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Rigorous planning based in part on defense in depth</li><li class="listitem" style="list-style-type: disc">Flawless realization of those plans</li><li class="listitem" style="list-style-type: disc">Excellent management throughout the lifecycle of all guests.</li></ul></div><p>Given all of the preceding, there are very clear security benefits to virtualization with Proxmox VE:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Reduction of the physical attack surface</li><li class="listitem" style="list-style-type: disc">VM isolation</li><li class="listitem" style="list-style-type: disc">Ability to restore to prior states</li><li class="listitem" style="list-style-type: disc">Hardware abstraction</li><li class="listitem" style="list-style-type: disc">Network segmentation support</li><li class="listitem" style="list-style-type: disc">Encapsulation and portability</li><li class="listitem" style="list-style-type: disc">Physical security</li><li class="listitem" style="list-style-type: disc">Fine privilege control</li><li class="listitem" style="list-style-type: disc">Integrated firewalls</li></ul></div><div class="section" title="Attack surface reduction"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec36"/>Attack surface reduction</h2></div></div></div><p>Moving to a virtual infrastructure reduces your physical attack surface in accordance with your virtual machine density. The more physical servers we convert to Proxmox VE guests, in conjunction with how densely we pack guests onto our Proxmox VE hosts, the fewer servers there are to ensure protection from potentially devastating physical attacks, for example.</p><p>Virtualization has an inherent potential to reduce the attack surface of an infrastructure in several ways; we'll focus here on how it reduces the number of physical hosts providing services.</p><p>
</p><div class="mediaobject"><img src="graphics/B01784_07_02-3.png" alt="Attack surface reduction"/><div class="caption"><p>Visualizing attack vectors and the attack surface</p></div></div><p>
</p><p>Where we were once protecting, say, 15 machines from physical attack, there might be one or two physical Proxmox VE hosts to protect, for example.</p><p>We have to be critical here and realize this can open up new vulnerabilities and frustrating problems to resolve.</p><p>The Proxmox VE host becomes monolithic, so:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">If there's an unpatched vulnerability in Debian 8, PVE, or KVM and QEMU, the confidentiality, integrity, and availability of all the virtual machines hosted by that instance are also threatened.</li><li class="listitem" style="list-style-type: disc">If an attacker gains physical access to the PVE host or hosts, the security and sanctity of all guests, both containers and virtual machines, are most certainly in doubt. If that's troubling, consider too that your snapshots and backups may have disappeared.</li></ul></div><p>There's no doubt virtualization reduces the overall attack surface of your infrastructure, and in several ways; however, as articulated previously, this does not relieve us of any burdens, it just gives those burdens higher stakes while making them less complex to address.</p></div><div class="section" title="Isolation"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec37"/>Isolation</h2></div></div></div><p>Virtualization encourages isolation. One VM doesn't naturally affect another VM, even if it is on the same host.</p><p>This tendency toward isolation suggests that destructive malware infecting a virtual server won't necessarily escape and spread to other virtual servers, even when they share a host.</p><p>If there's an oversight however, such as naively sharing data between two guests, or (worse) sharing data between a guest and the host, attacks can be devastating. Therefore, resist the temptation to create file shares among VMs on PVE; for the sake of security, do not share files between a Proxmox VE host and any of its guests.</p><p>Here the importance of documenting your infrastructure and writing a well-deliberated and well-enforced security policy is clear.</p></div><div class="section" title="Availability of prior states"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec38"/>Availability of prior states</h2></div></div></div><p>In the event an attack against a Proxmox VE guest succeeds, the guest can be rolled back to a prior state via backups or snapshots, effectively minimizing the time it takes to recover from an attack. (Note, however, that any data or information that changed between the time of the selected backup and the moment it is restored will be lost during a rollback.)</p><p>
</p><div class="mediaobject"><img src="graphics/B01784_07_03-3.png" alt="Availability of prior states"/><div class="caption"><p>Rolling back involves applying a former version of a guest's storage file to the virtual machine or container</p></div></div><p>
</p><p>So, it's logical that the ability to restore to a prior state isn't an unconditional advantage of virtualization, even if it's an integrated feature of Proxmox VE; snapshots and backups must be integral to the well-thought out and executed lifecycle of the PVE guests and part of a well-defined and enforced policy.</p></div><div class="section" title="Hardware abstraction"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec39"/>Hardware abstraction</h2></div></div></div><p>A fundamentally compelling characteristic of full virtualization is the abstraction of a computer from the physical hardware.</p><p>Imagine that a Proxmox VE guest with a well-organized trove of information collected over months is compromised and its hard drive destroyed in an attack that would have rendered physical storage unsalvageable—destruction of storage on a virtual disk does no damage to the physical storage that hosted it. When prior states are available to restore from, a snapshot or a backup can be restored onto the same hardware.</p><p>Without condition, damage dealt to virtual components has no effect on the physical host. This is an inherent reward for abstraction.</p></div><div class="section" title="Segmentation"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec40"/>Segmentation</h2></div></div></div><p>If an infrastructure is to be virtualized with Proxmox VE, take advantage of the network segmentation technologies it supports, such as VLAN tags, bridges, IPs masquerading with NAT, and per-guest firewalls. Use these technologies to make VMs or containers available to a limited population of users with legitimate business needs that call for a limited level of access.</p><p>
</p><div class="mediaobject"><img src="graphics/B01784_07_04-4.png" alt="Segmentation"/><div class="caption"><p>Visualizing segmentation and trust zones with Proxmox VE</p></div></div><p>
</p><p>To make the most of this valuable potential, think rigorously about sufficient trust zones as you plan your infrastructure.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note64"/>Note</h3><p>A trust zone is a network segment within which data flows relatively unrestricted, while data flowing in and out of the trust zone is subject to stronger restrictions.</p></div></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip65"/>Tip</h3><p>
<span class="strong"><strong>Open vSwitch</strong></span></p><p>As an alternative to the bridges, bonds, and VLAN interfaces native to Linux, Proxmox VE supports Open vSwitch.</p><p>Open vSwitch is an open source, software implementation of a distributed, multilayer switch. It's production-ready and designed with virtualization specifically in mind.</p><p>To learn more about Open vSwitch, including features and potential drawbacks, visit its website at <a class="ulink" href="http://openvswitch.org">http://openvswitch.org</a>. To learn more about Proxmox VE's support of Open vSwitch, visit the Proxmox wiki at <a class="ulink" href="https://pve.proxmox.com/wiki/Open_vSwitch">https://pve.proxmox.com/wiki/Open_vSwitch</a>.</p></div></div></div><div class="section" title="Encapsulation and portability"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec41"/>Encapsulation and portability</h2></div></div></div><p>As described in <a class="link" href="ch05.html" title="Chapter 5. Working with Virtual Disks">Chapter 5</a>, <span class="emphasis"><em>Working with Virtual Disks</em></span>, with full virtualization all information on virtual servers, including boot disks, is saved as a file; this is an example of encapsulation.</p><p>Invaluably, encapsulation serves the portability of the VM; even as an attacker works to compromise a PVE host, its guests can be moved, without halting, to another host in a cluster. Live migration—migrating an active guest from one PVE host to another in the same cluster—helps assure availability even in the case of an ongoing attack against a host.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip66"/>Tip</h3><p>
<span class="strong"><strong>On Clustering and High Availability</strong></span></p><p>For more on these topics, see <span class="emphasis"><em>Mastering Proxmox, Proxmox High Availability</em></span>, and <span class="emphasis"><em>Proxmox Cookbook</em></span> from Packt Publishing.</p></div></div></div><div class="section" title="Physical security"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec42"/>Physical security</h2></div></div></div><p>When an attacker gains access to a physical server, the availability, confidentiality, and integrity it should demonstrate are absolutely in doubt.</p><p>To put it bluntly (and to appropriate a phrase from Scott Culp), if an attacker has physical access to your Proxmox VE host, it's not your host anymore.</p><p>As described previously, a very powerful benefit of virtualization is that the number of physical hosts decreases as the services they provided move to VMs or containers, effectively reducing the attack vectors, since the fewer machines there are to find physical space for, the fewer there are to gain illegitimate access to.</p><p>Nevertheless, include in your policy the procedures by which the PVE hosts, the storage, and the intermediate distribution frame (that is, the wiring closet) are to be physically secured against illegitimate access, and enforce the policy consistently and without exception; this means you've mitigated a potentially devastating threat.</p></div><div class="section" title="Fine privilege control"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec43"/>Fine privilege control</h2></div></div></div><p>With defense in depth and the principle of least-privilege in mind, consider the fine control of user access and restrictions that's realized when each service is moved to a discrete VM or container—in contrast to keeping multiple services running on a single physical server.</p><p>In a virtual infrastructure, a user privileged to access one service is not explicitly privileged to another as we can imagine they would be if the services were shared on a single hardware server. We can restrict access to Debian, finely define a user's role in relation to each VM and container via the PVE web interface, and further refine privileges on the guest OS level and the application level.</p><p>
</p><div class="mediaobject"><img src="graphics/B01784_07_06-3.png" alt="Fine privilege control"/><div class="caption"><p>Some layers to consider in the practice of "defense in depth"</p></div></div><p>
</p><p>By default, the Proxmox VE management interface is authorized through GNU/Linux's default authentication system (<span class="strong"><strong>PAM</strong></span>), and root is the only user. However, the authentication system for the web interface can be changed from PAM to PVE's system, to Active Directory, or to LDAP.</p><p>Whatever the authentication mechanism, specific users can be assigned different roles, or privileges, for each individual VM or container.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip67"/>Tip</h3><p>
<span class="strong"><strong>PVE User Management</strong></span></p><p>To learn more about PVE's user management  features, see the user management page of the Proxmox wiki: <a class="ulink" href="https://pve.proxmox.com/wiki/User_Management">https://pve.proxmox.com/wiki/User_Management</a>.</p></div></div><p>There are a host of predefined roles for users or groups that ship with PVE; and we can create new roles with different privileges and restrictions as necessary.</p></div><div class="section" title="PVE firewall features"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec44"/>PVE firewall features</h2></div></div></div><p>Proxmox VE provides flexible firewall features based on iptables.</p><p>These features can be configured via the administration interface or the command line to provide several layers of protection, as this allows rulesets to accept and reject traffic per guest server, per PVE host, and for an entire cluster.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note68"/>Note</h3><p>To learn more about the Proxmox VE firewall, visit the official documentation at <a class="ulink" href="https://pve.proxmox.com/wiki/Proxmox_VE_Firewall">https://pve.proxmox.com/wiki/Proxmox_VE_Firewall</a>, where detailed configuration examples are available.</p></div></div><p>It's rather critical that PVE be protected by a firewall.</p><p>Proxmox VE 3.4 relies on the following ports:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">8006 (web interface)</li><li class="listitem" style="list-style-type: disc">85 (pvedaemon—configured to listen only on 127.0.0.1)</li><li class="listitem" style="list-style-type: disc">5900-5999 (VNC web console)</li><li class="listitem" style="list-style-type: disc">22 (sshd; used for cluster actions as well as a means to access a remote shell)</li><li class="listitem" style="list-style-type: disc">5404, 5405 UDP (CMAN multicast—if you run a cluster)</li></ul></div><p>Proxmox VE 4.0 saw some changes to Proxmox VE's port usage:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">8006 (web interface)</li><li class="listitem" style="list-style-type: disc">85 (pvedaemon-configured to listen only on 127.0.0.1)</li><li class="listitem" style="list-style-type: disc">5900-5999 (VNC web console)</li><li class="listitem" style="list-style-type: disc">3128 (SPICE console)</li><li class="listitem" style="list-style-type: disc">22 (SSH access-now optional)</li><li class="listitem" style="list-style-type: disc">111 (rpcbind)</li><li class="listitem" style="list-style-type: disc">5404, 5405 UDP (corosync multicast if you run a cluster)</li></ul></div><p>Use your firewall experience to restrict access to these ports from subnets and IP ranges that don't have a legitimate need to access them.</p></div></div></div>
<div class="section" title="Aggravated vulnerabilities"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec36"/>Aggravated vulnerabilities</h1></div></div></div><p>Virtualization's potential security benefits are certainly compelling, but many are quite conditional and altogether they are certainly no panacea.</p><p>Moreover, virtualization introduces new threats to an infrastructure—threats that otherwise either wouldn't be a concern at all or are exacerbated by virtualization.</p><p>This section calls attention to vulnerabilities that are historically problematic for virtual infrastructures:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Denial of service attacks</li><li class="listitem" style="list-style-type: disc">VM escape and hyper jumping</li><li class="listitem" style="list-style-type: disc">Server sprawl</li><li class="listitem" style="list-style-type: disc">Growing complexity</li></ul></div><div class="section" title="Denial of service attacks"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec45"/>Denial of service attacks</h2></div></div></div><p>
<span class="strong"><strong>Denial of service</strong></span> (<span class="strong"><strong>DoS</strong></span>) attacks come in a wide variety of flavors. However, the immediate intent is the same: overwhelming a network, and its administrators, by generating large amounts of illegitimate traffic.</p><p>
<span class="strong"><strong>Distributed denial of service</strong></span> (<span class="strong"><strong>DDoS</strong></span>) and DoS attacks are cheap, effective, and increasingly common. On the surface, they seem to be most effective at rendering services unavailable or unusable. More insidious, perhaps, is that, by keeping administrators' hands full as they cope with illegitimate traffic, other attacks can be launched without attracting their immediate attention.</p><p>Unfortunately, DoS attacks are particularly powerful against virtual infrastructures, wherein overwhelmed virtual hosts will certainly threaten the availability of virtual guests and the services they provide.</p><p>
</p><div class="mediaobject"><img src="graphics/B01784_07_07-3.png" alt="Denial of service attacks"/><div class="caption"><p>Visualizing a DDoS attack</p></div></div><p>
</p><p>In addition, research published in 2013 found that DoS attacks are significantly more potent where virtual machines are involved:</p><div class="blockquote"><table border="0" width="100%" cellspacing="0" cellpadding="0" class="blockquote" summary="Block quote"><tr><td valign="top"> </td><td valign="top"><p>
<span class="emphasis"><em>"[Under] DoS attack, the performance of a web server hosted in a VM can degrade by up to 23%, while that of a nonvirtualized server hosted on the same hardware degrades by only 8%. Even with relatively light attacks, the file system and memory access performance of hypervisor-based virtualization degrades at a much higher rate than their nonvirtualized counterparts."</em></span>
</p></td><td valign="top"> </td></tr><tr><td valign="top"> </td><td colspan="2" align="right" valign="top" style="text-align: center">--<span class="attribution">
<span class="emphasis"><em>Performance of Virtual Machines Under Networked Denial of Service Attacks: Experiments and Analysis, Shea and Liu, <a class="ulink" href="http://www.cs.sfu.ca/~jcliu/Papers/PerformanceofVirtualMachines.pdf">http://www.cs.sfu.ca/~jcliu/Papers/PerformanceofVirtualMachines.pdf</a>
</em></span>
</span></td></tr></table></div><p>Clearly, in some areas, we may take solace in some security benefits of virtualization; however, DoS and DDoS attacks are one threat we cannot turn away from.</p><p>When migrating services from physical machines to Proxmox VE guests, work to define and deploy not only preventative measures, but also rapid response protocols. This calls for the implementation of monitoring and alert systems, as well as a firewall configuration that deliberately takes such attacks into consideration.</p><p>Each type of DoS attack has its own array of detection and mitigation strategies. To mitigate against SYN flooding attacks, for example, see section three of <a class="ulink" href="http://tools.ietf.org/html/rfc4987">http://tools.ietf.org/html/rfc4987</a>.</p></div><div class="section" title="VM escape and hyper jumping"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec46"/>VM escape and hyper jumping</h2></div></div></div><p>
<span class="strong"><strong>Virtual machine escape</strong></span> occurs when an attacker successfully "breaks out" of a virtual machine and interacts with the host operating system.</p><p>In a similar vein, <span class="strong"><strong>VM jumping</strong></span>, or hyper jumping as it is sometimes referred to, is the process of gaining illegitimate access to a virtual machine via another virtual machine.</p><p>Presumably encapsulated and isolated environments, virtual machines run operating systems that shouldn't know that they are virtualized; there should be no way to break out of the virtual machine to interact directly with the parent hypervisor. For the same reasons, it should be impossible to illegitimately access a virtual machine through another virtual machine.</p><p>VM escape exploits are particularly devastating since the hypervisor controls the execution of all of the virtual machines and containers on the host. Consequently, an attacker that can gain access to the hypervisor can then win control over every guest running on the PVE host; since the hypervisor is between the physical hardware and the guest operating system, a successful VM escape will enable attackers to simply circumvent security controls implemented on the virtual machine.</p><p>VM escapes and hyper jumping should be an intellectual exercise, a fascinating theoretical problem. Unfortunately, that's simply not the case.</p><p>During the production of this book, for example, several VM escape vulnerabilities have emerged. Perhaps the vulnerability that captured the most attention was the one dubbed <span class="emphasis"><em>VENOM</em></span> by researchers (<a class="ulink" href="http://venom.crowdstrike.com/">http://venom.crowdstrike.com/</a>):</p><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em>"VENOM, CVE-2015-3456, is a security vulnerability in the virtual floppy drive code used by many computer virtualization platforms. This vulnerability may allow an attacker to escape from the confines of an affected virtual machine (VM) guest and potentially obtain code-execution access to the host. Absent mitigation, this VM escape could open access to the host system and all other VMs running on that host, potentially giving adversaries significant elevated access to the host's local network and adjacent systems.</em></span>
</p></blockquote></div><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em>"Exploitation of the VENOM vulnerability can expose access to corporate intellectual property (IP), in addition to sensitive and personally identifiable information (PII), potentially impacting the thousands of organizations and millions of end users that rely on affected VMs for the allocation of shared computing resources, as well as connectivity, storage, security, and privacy."</em></span>
</p></blockquote></div><p>
</p><div class="mediaobject"><img src="graphics/B01784_07_09-3.png" alt="VM escape and hyper jumping"/><div class="caption"><p>Venom attack scenario</p></div></div><p>
</p><p>Unfortunately, the many "computer virtualization platforms" invoked by the disclosure included all QEMU-based platforms; this includes Proxmox VE.</p><p>In the case of VENOM, a patch was available from Debian the same day the vulnerability was disclosed. A PVE administrator simply had to upgrade, in Debian fashion, and then restart guest virtual machines:</p><pre class="programlisting">apt-get clean
apt-get update
</pre><p>After a shutdown and restart of all VMs on the Proxmox VE host, the vulnerability was gone. There was no need to even reboot the PVE host.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note69"/>Note</h3><p>The bug was introduced unknowingly in the QEMU source when the QEMU Floppy Drive Controller was introduced in 2004.</p></div></div><p>So it seems virtualization's celebrated isolation is not absolute.</p><p>From VENOM, we can learn some direct preventative actions that can be taken to mitigate emerging VM escape vulnerabilities:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Keep Proxmox VE and Debian routinely patched. There are a variety of ways to automate the patching process; we'll walk through one method in the next section. Since Proxmox VE is patched through the same mechanism as Debian, patches to both are applied simultaneously.</li><li class="listitem" style="list-style-type: disc">Patch operating systems and applications running on virtual machines and containers. On Debian and Ubuntu guests, use the apt tool; on Microsoft Windows and Server guests, set a reasonable Windows Update policy to ensure urgent updates are applied.</li><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Don't</em></span> install virtual machine features you do not need. Doing so increases your attack surface unnecessarily. Be particularly attentive to what virtual devices are attached to your VM; if you don't need a virtual optical drive or floppy disk drive on the VM, either deliberately avoid installing them or remove them from the VM when you no longer need them.</li><li class="listitem" style="list-style-type: disc">Avoid running software and services that are not essential to your guests' primary roles.</li><li class="listitem" style="list-style-type: disc">However, weigh the benefits of running endpoint security software on a virtual machine; in his September 2015 article, "The Curious Case of the Escaping Virtual Machine," Bunmi Sowandi suggests that such software will detect malicious code trying to run in a VM before it has a chance to "escape". (<a class="ulink" href="http://vmturbo.com/about-virtualization/the-curious-case-of-the-escaping-virtual-machine/">http://vmturbo.com/about-virtualization/the-curious-case-of-the-escaping-virtual-machine/</a>)</li></ul></div><p>As we learned from VENOM, the best protection against VM escape and hyper jumping exploits is routine and well-thought out patch management.</p></div><div class="section" title="Virtualization sprawl"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec47"/>Virtualization sprawl</h2></div></div></div><p>In the context of virtual infrastructure, sprawl refers to the tendency of virtual servers to proliferate faster than administrators can properly manage. Sprawl encourages poor management decisions, hasty undeliberated action, sloppy configuration mistakes, and missed opportunities to mitigate threats.</p><p>From a security perspective, therefore, virtualization sprawl presents dire problems as administrators miss security patches, fail to harden services, and perhaps expose the network, the hypervisors, and storage nodes unnecessarily.</p><p>A helpful article on the Hewlett Packard site suggests some best practices to reduce the impact of sprawl effectively. Like many security issues explored in this chapter, the suggested solution is excellent planning, deliberated deployment, and writing and enforcing a security policy that includes VM lifecycle management. The article (<a class="ulink" href="http://h30499.www3.hp.com/t5/Grounded-in-the-Cloud/5-ways-to-get-control-of-virtualization-sprawl/ba-p/6170959">http://h30499.www3.hp.com/t5/Grounded-in-the-Cloud/5-ways-to-get-control-of-virtualization-sprawl/ba-p/6170959</a>) puts particular emphasis on the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Whenever possible, create VMs and containers from "golden images" that include patches, patch policy, audit policies, software, and software policies</li></ul></div><p>
</p><div class="mediaobject"><img src="graphics/B01784_07_10-3.png" alt="Virtualization sprawl"/><div class="caption"><p>End-to-end lifecycle and policy management for VMs and VM template</p></div></div><p>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Proactively update policy-based enforcement on VMs as well as VM templates (and containers and container templates)</li></ul></div><p>
</p><div class="mediaobject"><img src="graphics/B01784_07_11-3.png" alt="Virtualization sprawl"/></div><p>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Systematically manage the lifecycle and compliance of virtual servers from end to end (including, for example, routine snapshots or backups, and applying patches and upgrades)</li></ul></div><p>The article is insistent on conveying two messages successfully:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A well-thought-out security policy, which administrators can realistically comply with, is absolutely essential for keeping sprawl in check</li><li class="listitem" style="list-style-type: disc">Tasks that can be automated must be automated</li></ul></div><p>Virtualization sprawl encourages disorder; tame it with automation driven by a well-thought-out policy that's followed in the practice of daily administration.</p></div><div class="section" title="At war with complexity"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec48"/>At war with complexity</h2></div></div></div><div class="blockquote"><table border="0" width="100%" cellspacing="0" cellpadding="0" class="blockquote" summary="Block quote"><tr><td valign="top"> </td><td valign="top"><p>
<span class="emphasis"><em>"A network architecture should be as clean and simple to understand as it can be. It should be possible to briefly...draw a few simple pictures to illustrate that design...."</em></span>
</p><p>
<span class="emphasis"><em>"Having a clear understanding of the traffic flow on your network puts you in control of it. Not understanding the network puts you at the mercy of its vagaries."</em></span>
</p></td><td valign="top"> </td></tr><tr><td valign="top"> </td><td colspan="2" align="right" valign="top" style="text-align: center">--<span class="attribution">
<span class="emphasis"><em>The Practice of System and Network Administration, 2E 2007</em></span>
</span></td></tr></table></div><p>Given that virtualization encourages sprawl and given that secure virtual infrastructures demand segmentation, it's not entirely surprising that virtualization encourages problematic network complexity.</p><p>As network complexity goes up, so too does the pain that administrators suffer, since they must keep accurate documentation, troubleshoot connectivity problems on the fly, and sometimes provide actionable information for third-party support providers.</p><p>The "chaos approach" encouraged by infrastructure virtualization is not a reliable model to use in a network where the availability of every component matters (<span class="emphasis"><em>The Practice of System and Network Administration</em></span>).</p><p>To limit network complexity, consider that the campus' network architects, engineers, and administrators should all be able to sketch, without aids, the key features and basic structure of the network topology.</p><p>According to Limoncelli, Hogan, and Chalup, the network architecture is neither clean enough, comprehensible enough, nor simple enough if this network map can't be relatively easily rendered. Maps of the physical and logical networks should absolutely be part of the system documentation and revised to reflect any modifications from the previous topology.</p><p>Taking the risk of sounding redundant squarely in the face, the best way to tame network complexity is to ensure the network can be explained and diagrammed, logically and physically, without the support of additional resources. If that's not the case, re-evaluate the architecture and see where it can be simplified without sacrificing security.</p></div></div>
<div class="section" title="Taking action"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec38"/>Taking action</h1></div></div></div><p>If you're not yet virtualizing infrastructure, or you're not otherwise in a position to develop a strategic security policy, there're tactics you can take in the meantime to mitigate some threats to your Proxmox virtual environment:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Secure the bootloader</li><li class="listitem" style="list-style-type: disc">If possible, lock down the BIOS/UEFI</li><li class="listitem" style="list-style-type: disc">Absolutely prohibit remote access to Proxmox VE's user interfaces</li><li class="listitem" style="list-style-type: disc">Disable root access via SSH; consider prohibiting sudo access as well</li><li class="listitem" style="list-style-type: disc">Use Fail2ban to prevent brute-force attacks</li><li class="listitem" style="list-style-type: disc">Rely on key-based SSH authentication</li><li class="listitem" style="list-style-type: disc">Maintain security patches for Proxmox VE and its guests</li><li class="listitem" style="list-style-type: disc">Consider an enterprise support subscription</li></ul></div><p>The practical procedures that follow are a strong (and immediate) complement to the less concrete strategies articulated previously.</p><p>This concluding section thus walks through these immediate tactical mitigation objectives to provide immediate support as you come to terms with Proxmox VE.</p><div class="section" title="Protecting the boot process"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec49"/>Protecting the boot process</h2></div></div></div><p>In this section, we work to assure that OS and application-level authentication isn't rendered useless by an attacker with physical access who can thoroughly bypass these mechanisms.</p><p>We can think of booting as a four-stage process:</p><p>
</p><div class="mediaobject"><img src="graphics/B01784_07_12-3.png" alt="Protecting the boot process"/><div class="caption"><p>A generic boot process</p></div></div><p>
</p><p>During this process, the system can be vulnerable:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">An unsecured BIOS can be directed to boot from an attacker's storage device, allowing them to compromise the confidentiality and integrity of data stored on the Proxmox VE host and interfere with the availability of the services and virtual servers the host has intended to provide.</li><li class="listitem" style="list-style-type: disc">By manipulating an unsecured bootloader, attackers can gain root access to a machine and compromise its confidentiality, integrity, and availability.</li></ul></div><p>Using either method, the attacker effectively owns the machine. Let's do our best to lock down the BIOS/UEFI on our hosts and GRUB 2.0, the bootloader for Proxmox VE 3.4 and 4.1.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip70"/>Tip</h3><p>To learn more about the Debian bootstrap process, visit <a class="ulink" href="https://www.debian.org/doc/manuals/debian-reference/ch03.en.html#_an_overview_of_the_boot_strap_process">https://www.debian.org/doc/manuals/debian-reference/ch03.en.html#_an_overview_of_the_boot_strap_process</a>.</p></div></div><div class="section" title="Locking down the bootloader"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec8"/>Locking down the bootloader</h3></div></div></div><p>OS-level authentication restrictions can be very simply defeated on an otherwise secure Proxmox VE machine by manipulating GRUB 2, Proxmox VE's bootloader. See, for example, <a class="ulink" href="http://linuxconfig.org/ubuntu-14-04-lost-password-recovery">http://linuxconfig.org/ubuntu-14-04-lost-password-recovery</a>, wherein the process is fully articulated. The gist of an attack looks like this:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Reboot and enter the GRUB 2 menu immediately after startup.</li><li class="listitem">Modify the boot options.</li><li class="listitem">Boot the system based on your modifications.</li><li class="listitem">Change the root password of the system.</li><li class="listitem">Shutdown and restart.</li><li class="listitem">Login with the new password.</li></ol></div><p>For an experienced GNU/Linux administrator, it's likely a familiar process; it's identical to how we reset a lost root password.</p><p>GRUB 2 offers extensive customization, and with it, the power to disable access to GRUB 2 options generally, as well as to specific menu options.</p><p>We will walk through the universal protection of GRUB 2 menu entries to enable access by a single superuser with an unencrypted password. This will prohibit attackers as well as sloppy or disgruntled colleagues from editing a GRUB entry or accessing a GRUB command line.</p><p>To follow this procedure, you must:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Have root privileges</li><li class="listitem" style="list-style-type: disc">Determine a superuser name and password to be used (we will use the name <code class="literal">admin</code> and the password <code class="literal">pve</code>)</li><li class="listitem" style="list-style-type: disc">Edit GRUB configuration files from the command line</li><li class="listitem" style="list-style-type: disc">Update the GRUB 2 configuration with the update-grub command</li></ul></div><p>Let's get started:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log into a shell on your Proxmox VE host; if PVE is configured with an IP address of 192.168.1.200, access a shell via SSH from a workstation on the same network:
<pre class="programlisting">    ssh root@192.168.1.200&#13;
</pre></li><li class="listitem">Open <code class="literal">/etc/grub.d/00_header</code> using a plaintext editor; this example uses <code class="literal">nano</code> as the editor:<pre class="programlisting">    nano /etc/grub.d/00_header&#13;
</pre></li><li class="listitem">Append the following lines to the bottom of the text:<pre class="programlisting">    cat &lt;&lt; EOF&#13;
    set superusers="admin"&#13;
    password admin pve&#13;
    EOF&#13;
</pre></li><li class="listitem">Save the document and exit the editor; in <code class="literal">nano</code>, use 
<span class="emphasis"><em>Ctrl</em></span> +<span class="emphasis"><em>X</em></span>, then <span class="emphasis"><em>Y</em></span>, and then 
<span class="emphasis"><em>Enter</em></span> to return to a shell prompt.</li><li class="listitem">Open <code class="literal">/etc/grub.d/10_linux</code> in <code class="literal">nano</code>:
<pre class="programlisting">    nano /etc/grub.d/10_linux&#13;
</pre></li><li class="listitem">Seek the following group of lines in <code class="literal">/etc/grub.d/10_linux</code>:
<pre class="programlisting">    echo "menuentry '$(echo "$title" | grub_quote)' ${CLASS} \$menuentry_id_option 'gnulinux-$version-$type-$boot_device_id' {" | sed "s/^/$submenu_indentation/"&#13;
    &#13;
    else&#13;
    &#13;
    echo "menuentry '$(echo "$os" | grub_quote)' ${CLASS}  \$menuentry_id_option 'gnulinux-simple-$boot_device_id' {" | sed "s/^/$submenu_indentation/"&#13;
</pre></li><li class="listitem">In the last line, insert <code class="literal">--unrestricted</code> between <code class="literal">${CLASS}</code> and <code class="literal">\$menuentry;</code> the resultant line appears as follows:
<pre class="programlisting">    echo "menuentry '$(echo "$os" | grub_quote)' ${CLASS} --unrestricted \$menuentry_id_option 'gnulinux-simple-$boot_device_id' {" | sed "s/^/$submenu_indentation/"&#13;
</pre></li><li class="listitem">Save the revised document and exit the editor; in <code class="literal">nano</code>, use 
<span class="strong"><strong>Ctrl
</strong></span> + 
<span class="strong"><strong>X
</strong></span> to exit, press 
<span class="strong"><strong>Y
</strong></span> to confirm, and then press 
<span class="strong"><strong>Enter
</strong></span> to return to a shell prompt.</li><li class="listitem">Finally, prompt GRUB 2 to reconfigure itself based on the changes:</li></ol></div><pre class="programlisting">    update-grub&#13;</pre><p>When you reboot, you should find that PVE will start normally if left uninterrupted. However, if you try to edit a menu entry, boot from a submenu, or access a GRUB command line, you should find that you're required to authenticate.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip71"/>Tip</h3><p>For more on GRUB security, visit the following links:<a class="ulink" href="https://help.ubuntu.com/community/Grub2/Passwords">https://help.ubuntu.com/community/Grub2/Passwords</a></p><p>
<a class="ulink" href="http://www.gnu.org/software/grub/manual/grub.html#Security">http://www.gnu.org/software/grub/manual/grub.html#Security</a>
</p></div></div><p>As the article at <a class="ulink" href="http://opensourceforu.efytimes.com/2013/03/playing-hide-and-seek-with-passwords/">http://opensourceforu.efytimes.com/2013/03/playing-hide-and-seek-with-passwords/</a> points out, this password can still be bypassed by configuring BIOS/UEFI to boot from the attacker's boot device. If your hardware allows, you probably want to secure this first stage of the boot process so would-be malefactors won't be able to finagle the Proxmox VE host to boot from their own devices.</p></div><div class="section" title="Locking down BIOS/UEFI"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec9"/>Locking down BIOS/UEFI</h3></div></div></div><p>By securing the bootloader, GRUB 2, we can prevent a user from bypassing OS security and gaining root privileges on the Proxmox VE host.</p><p>However, attackers can still simply bypass even the bootloader's security by booting instead from their own media. From there, they can mount the machine's secondary storage and make immediate decisions for you about its confidentiality and integrity. If an attacker is particularly deliberate, he/she can install a cunning means to access the machine remotely at a later date.</p><p>To mitigate this threat, we can, depending on our firmware, password protect the boot device settings in either the BIOS or UEFI.</p><p>Since there's an unwieldy array of BIOS and UEFI firmware vendors, we'll articulate a vision for what we'd like to do, and then hope our systems will cooperate.</p><p>The objective is to manipulate the BIOS/UEFI so it operates as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Allows the system to cold-boot without any interruption</li><li class="listitem" style="list-style-type: disc">Requires authentication to change the boot device</li><li class="listitem" style="list-style-type: disc">Prohibits entering the setup manager without authentication</li></ul></div><p>This configuration can be tricky and is largely contingent on the BIOS/UEFI vendor.</p><p>Ideally, a machine with BIOS will allow you to do the following:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Enter the BIOS configuration when starting your PC. After power on, press the prompted key to enter <span class="strong"><strong>BIOS Setup Utility</strong></span>; sometimes, it's the F key, <span class="strong"><strong>Delete</strong></span>,or <span class="strong"><strong>ESC</strong></span>. On some Lenovo machines, it's <span class="strong"><strong>Enter</strong></span>. In the case of VMWare's PhoenixBIOS, <span class="strong"><strong>F2</strong></span> is used to access the setup utility (access to this interface is what we want to make impossible or frustrating for an attacker):<p>
</p><div class="mediaobject"><img src="graphics/image_07_012.png" alt="Locking down BIOS/UEFI"/><div class="caption"><p>PhoenixBIOS, included with VMware Workstation, uses F2 to enter setup, F12 for network boot, and ESC for the boot menu.</p></div></div><p>
</p></li><li class="listitem">Once you enter <span class="strong"><strong>SETUP</strong></span>, navigate to a security tab. On the machines I've accessed, setting the administrator password will require the same credentials of anyone trying to enter the setup utility. On the PhoenixBios for VMware Workstation virtual machines, I can still boot without authenticating. So far so good.</li><li class="listitem">However, when the preceding screenshot invites users to press 
<span class="emphasis"><em>F12</em></span> for network boot or <span class="emphasis"><em>Esc</em></span> for the boot menu, they'll find these are unrestricted. In this case, any attempt to lock down BIOS for security is really quite devastated.</li><li class="listitem">If available, navigate to the boot settings in the SETUP utility. If the option is available in the Boot menu, disable devices that aren't used and that you don't want to use, such as network boot and boot from optical drives or USB devices.</li><li class="listitem">Again, depending on availability, navigate to boot priority and set the boot priority of the remaining devices. Some systems allow you to use the 
<span class="strong"><strong>D</strong></span> key to disable devices.</li></ol></div><p>Ideally, your BIOS setup tool allows you to disable boot devices or password protect the boot device menu as well as the SETUP tool itself. Furthermore, it'll hopefully let you set a supervisor password without prompting you to authenticate to boot. If the boot process is interrupted to ask for authentication, there's the potential for a lot of unnecessary, and perhaps unplanned, down-time for the services users are relying on.</p><p>The settings recommended previously were possible in about half of the physical machines I surveyed for the chapter.</p><p>If your machine does provide for this ideal scenario, realize that, at best, losing the BIOS passwords means you've lost your license to reconfigure or troubleshoot the physical machine. In case of a lost password, you'll need to research how to bypass the security that you once felt was keeping bad guys out. The reset process is awkward, inconsistent, a time sink, and may not work.</p><p>It's essential, therefore, to keep a safe copy of any credentials you use to restrict access to BIOS or UEFI.</p><p>To learn more about securing the specific BIOS/UEFI system for your Proxmox VE host, look for the documentation from the computer or BIOS manufacturers or from community users on the Web.</p><p>If protecting the boot process to your satisfaction is not possible with the BIOS or UEFI you're stuck with, compensate by making sure access to the physical host is absolutely secure with alarmed door locks, key passes that log ingress and egress, and so on.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip72"/>Tip</h3><p>
<span class="strong"><strong>Secure Boot and Proxmox</strong></span></p><p>
<span class="strong"><strong>
</strong></span>Proxmox VE does not support the Secure Boot feature of UEFI.</p></div></div></div></div><div class="section" title="Hardening the OS and hypervisor"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec50"/>Hardening the OS and hypervisor</h2></div></div></div><p>The objective here is to ensure the security of both Proxmox VE (3.4 and 4.0) and Debian, its underlying operating system. Because Proxmox VE and Debian are inextricably bound, it's appropriate to address them together.</p><div class="section" title="Prohibit remote access to the hypervisor"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec10"/>Prohibit remote access to the hypervisor</h3></div></div></div><p>Pundits specifically committed to secure virtual infrastructures are insistent on this point: remote access to the hypervisor must be forbidden.</p><p>This directive must be qualified: it's absolutely appropriate it's absolutely appropriate to run a Proxmox VE host heedlessly (sans display) and to access it from another workstation on the same LAN via both SSH and the web-based administration interface.</p><p>What you want to avoid at all costs is making PVE ports, particularly 22 and 8006, public-facing and accessible to the Internet. Unless VPN is configured, Proxmox VE absolutely should not be available from outside the LAN.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip73"/>Tip</h3><p>OpenVPN is an open-source package for providing VPN services; if you're considering a VPN solution, read more about OpenVPN at <a class="ulink" href="https://wiki.debian.org/OpenVPN">https:///wiki.debian.org/OpenVPN</a>.</p></div></div></div><div class="section" title="Harden SSH"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec11"/>Harden SSH</h3></div></div></div><p>Proxmox VE is designed to have two access alternatives:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Access to a command line interface via SSH</li><li class="listitem" style="list-style-type: disc">Access via the Web-based administrative interface</li></ul></div><p>SSH must be an available option so administrators can make configuration changes to the underlying operating system. Moreover, as we saw in <a class="link" href="ch03.html" title="Chapter 3. Creating Containers">Chapter 3</a>, <span class="emphasis"><em>Creating Containers</em></span> and <a class="link" href="ch04.html" title="Chapter 4. Creating Virtual Machines">Chapter 4</a>, <span class="emphasis"><em>Creating Virtual Machines</em></span>, we may choose to take care of a significant amount of Proxmox VE administrative tasks via the command line.</p><p>So SSH can't be disabled outright in the name of security. However, in the name of security assurance, we must fine-tune the configuration of SSH to mitigate threats, whether from disgruntled or sloppy colleagues or outside attacks.</p><p>Our objectives here are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Disabling direct root account access via SSH</li><li class="listitem" style="list-style-type: disc">Mitigating brute-force password attacks against SSH</li><li class="listitem" style="list-style-type: disc">Limiting access by IP</li><li class="listitem" style="list-style-type: disc">Using encrypted keys rather than passwords to authenticate over SSH</li></ul></div><div class="section" title="Disabling root account access via SSH"><div class="titlepage"><div><div><h4 class="title"><a id="ch07lvl4sec13"/>Disabling root account access via SSH</h4></div></div></div><p>This procedure is critical and absolutely necessary. First, let's create our own accounts with which to log in. We'll then use the new account to log in, escalate privileges using the <code class="literal">su -</code> command, and then follow a simple procedure to disable the root from logging in through SSH.</p><p>Once this procedure is complete, we'll log in using the new account for the foreseeable future; to perform a procedure that requires root's privileges, we'll simply use the <code class="literal">su -</code> command to temporarily escalate the privileges of this user account, by following these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Choose a username and password you intend to use to administer Proxmox VE via SSH.</li><li class="listitem">Via SSH, log in as the root using the credentials you created during the installation of Proxmox VE.</li><li class="listitem">Use the adduser command, followed by the username you've chosen, to create a new account:
<pre class="programlisting">    adduser rgoldman&#13;
</pre></li><li class="listitem">Follow the prompts to create and confirm the new account's password.</li><li class="listitem">Enter the full name you'd like associated with the new account.</li><li class="listitem">You may choose to ignore the remaining prompts for additional information, such as office number, address, and telephone number.</li><li class="listitem">Press <span class="emphasis"><em>Y</em></span> and <span class="emphasis"><em>Enter</em></span> to confirm the creation of the new user.<p>
</p><div class="mediaobject"><img src="graphics/image_07_013.png" alt="Disabling root account access via SSH"/><div class="caption"><p>Creating a new user within a command line prompt</p></div></div><p>
</p></li><li class="listitem">Use the <code class="literal">exit</code> command to close the SSH session.</li><li class="listitem">Reconnect to Proxmox VE using the new account name:
<pre class="programlisting">    ssh rgoldman@192.168.1.200&#13;
</pre></li><li class="listitem">Use the <code class="literal">su -</code> command to escalate privileges and enter the root's password to continue.</li><li class="listitem">Edit <code class="literal">/etc/ssh/sshd_config</code> using <code class="literal">nano</code>:<pre class="programlisting">    nano /etc/ssh/sshd_config&#13;
</pre></li><li class="listitem">Seek the following section using the arrow keys or the 
<span class="strong"><strong>PageDown
</strong></span> key:
<pre class="programlisting">    #LoginGraceTime 2m&#13;
    #PermitRootLogin no&#13;
    #StrictModes yes&#13;
    #MaxAuthTries 6</pre></li><li class="listitem">In this file, the <code class="literal">#</code> symbol signifies that the line is a comment and is not to be considered as part of the SSH daemon's configuration. Let's remove the <code class="literal">#</code> symbol from the second line to enable the directive:<pre class="programlisting">    PermitRootLogin no&#13;
</pre></li><li class="listitem">Save and exit the revised configuration file: 
<span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>X</em></span>, <span class="emphasis"><em>Y</em></span>, <span class="emphasis"><em>Enter</em></span>.
</li><li class="listitem">We can restart the SSH daemon without it affecting our session:
<pre class="programlisting">    /etc/init.d/ssh restart&#13;
</pre></li><li class="listitem">Now, let's test to ensure root can no longer log in. Start by entering <code class="literal">exit</code> to leave the <code class="literal">su</code> mode, and <code class="literal">exit</code> again to close SSH.</li><li class="listitem">Start a new SSH session as the root:
<pre class="programlisting">    ssh root@192.168.1.200&#13;
</pre></li></ol></div><p>Access should be denied, without the opportunity to enter a password.</p></div><div class="section" title="Preventing brute-force attacks against SSH"><div class="titlepage"><div><div><h4 class="title"><a id="ch07lvl4sec14"/>Preventing brute-force attacks against SSH</h4></div></div></div><p>As long as SSH daemon is configured to use password authentication, it's vulnerable to brute-force password attacks. One mitigation strategy is to install and configure Fail2ban, a powerful tool designed to detect attacks on a service and ban the offending IP address from which the attacks originate for a predefined period. Fail2ban effectively increases the cost in resources and the time attackers have to invest to continue a brute force password attack.</p><p>To make use of Fail2ban, follow this procedure:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Login via SSH and your new user account.</li><li class="listitem">Escalate privileges:<pre class="programlisting">    su -&#13;
</pre></li><li class="listitem">Install Fail2ban:<pre class="programlisting">    apt-get update &amp;&amp; apt-get install -y fail2ban&#13;
</pre></li><li class="listitem">Copy the default configuration called <code class="literal">jail.conf</code> to a new file called <code class="literal">jail.local</code>:<pre class="programlisting">    cp /etc/fail2ban/jail.conf /etc/fail2ban/jain.local</pre></li><li class="listitem">Open the new file in an editor such as <code class="literal">nano</code>:
<pre class="programlisting">    nano /etc/fail2ban/jail.local&#13;
</pre></li><li class="listitem">Cofirm Fail2ban's configuration for SSH in the following stanza:<pre class="programlisting">    [ssh]&#13;
    enabled   = true&#13;
    port      = ssh&#13;
    filter    = sshd&#13;
    logpath   = /var/log/auth.log&#13;
    maxretry  = 6&#13;
</pre></li><li class="listitem">Save the file and exit <code class="literal">nano</code> with 
<span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>X</em></span>, <span class="emphasis"><em>Y</em></span>, 
<span class="emphasis"><em>Enter</em></span>.
</li><li class="listitem">If any changes were necessary, restart Fail2ban:</li></ol></div><pre class="programlisting">    /etc/init.d/fail2ban restart&#13;</pre><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note74"/>Note</h3><p>Fail2ban can also be configured to protect PVE's web-based administration interface from brute-force attacks.</p><p>First, add the following to <code class="literal">/etc/fail2ban/jail.local</code>:</p><pre class="programlisting">[proxmox]
enabled = true
port = 8006, https
filter = proxmox
logpath = /var/log/daemon.log
maxretry = 3
bantime = 3600 # 1 hour</pre></div></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note75"/>Note</h3><p>Then, create the filter by entering <code class="literal">nano /etc/fail2ban/filter.d/proxmox.conf</code> at the command line.</p><p>Enter the following lines:</p><pre class="programlisting">[Definition]
failregex = pvedaemon\[.*authentication
failure;
rhost= &lt;host&gt; user=.* msg=.* ignoreregex =</pre></div></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note76"/>Note</h3><p>Save the file and exit <code class="literal">nano</code> with 
<span class="emphasis"><em>Ctrl</em></span> +<span class="emphasis"><em>X</em></span>, <span class="emphasis"><em>Y</em></span>, <span class="emphasis"><em>Enter</em></span>.
<span class="emphasis"><em>Restart</em></span> Fail2ban to activate the new configuration:</p><pre class="programlisting">    /etc/init.d/fail2ban restart&#13;</pre></div></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note77"/>Note</h3><p>With Fail2ban configured as described previously, failure to authenticate successfully three times in a row in the web interface will prohibit the client from connecting again for a full hour:</p><p>
</p><div class="mediaobject"><img src="graphics/B01784_07_15.png" alt="Preventing brute-force attacks against SSH"/><div class="caption"><p>After three unsuccessful attempts to log in to the PVE web interface</p></div></div><p>
</p></div></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip78"/>Tip</h3><p>
<span class="strong"><strong>More on Fail2ban</strong></span></p><p>To learn more about Fail2ban and how it works, visit <a class="ulink" href="http://www.fail2ban.org/wiki/index.php/Main_Page">http://www.fail2ban.org/wiki/index.php/Main_Page</a>.</p><p>To learn more about Fail2ban and Proxmox VE, visit the Proxmox Wiki at <a class="ulink" href="https://pve.proxmox.com/wiki/Fail2ban">https://pve.proxmox.com/wiki/Fail2ban</a>.</p></div></div></div><div class="section" title="Relying on key-based authentication"><div class="titlepage"><div><div><h4 class="title"><a id="ch07lvl4sec15"/>Relying on key-based authentication</h4></div></div></div><p>Another way to secure SSH access to a Proxmox VE server is to rely on key-based authentication instead of password authentication. The advantage to this authentication method is that you can disable password authentication altogether and not have to worry about the strength of legitimate users' passwords. Another benefit is that you can use the same key to authenticate to any number of SSH servers.</p><p>To make use of this feature, we'll start by generating an SSH key pair. Once you have a public and private key that can be used to authenticate, we'll place the public key on the PVE host so that we can use SSH key authentication to log in. Once these two procedures are complete, you'll check to see whether you can log in to your PVE host.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip79"/>Tip</h3><p>In the examples that follow, <code class="literal">rgoldman</code> is used as a placeholder for the username, while 192.168.1.200 is used as a placeholder for PVE's IP address. Please replace each as appropriate.</p></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">On a workstation on the same LAN as the PVE host, generate an SSH key pair:<pre class="programlisting">    ssh-keygen&#13;
</pre></li><li class="listitem">Confirm the key location at the first prompt by pressing 
<span class="strong"><strong>Enter</strong></span>:
<pre class="programlisting">    Generating public/private rsa key pair.&#13;
    Enter file in which to save the key (/home/rgoldman/.ssh/id_rsa):&#13;
</pre></li><li class="listitem">At the next prompts, you may choose to create and confirm an optional passphrase; using a passphrase will prevent an attacker from accessing the PVE host from your workstation. On the other hand, you'll have to enter the passphrase every time you wish to authenticate with the key:
<pre class="programlisting">    Created directory '/home/rgoldman/.ssh'.&#13;
    Enter passphrase (empty for no passphrase):&#13;
    Enter same passphrase again:</pre></li><li class="listitem">Look for confirmation that the key has been created—you should see an output to the terminal similar to the following:<pre class="programlisting">    Your identification has been saved in /home/rgoldman/.ssh/id_rsa.&#13;
    Your public key has been saved in /home/rgoldman/.ssh/id_rsa.pub.&#13;
    The key fingerprint is:&#13;
    a9:49:2e:2a:5e:33:3e:a9:de:4e:77:11:58:b6:90:26 username@remote_host&#13;
    The key's randomart image is:&#13;
    +--[ RSA 2048]----+&#13;
    |     ..o         |&#13;
    |   E o= .        |&#13;
    |    o. o         |&#13;
    |        ..       |&#13;
    |      ..S        |&#13;
    |     o o.        |&#13;
    |   =o.+.         |&#13;
    |. =++..          |&#13;
    |o=++.            |&#13;
    +-----------------+&#13;
</pre><p>An output similar to the preceding example confirms that you have a public and private key that you can use to authenticate.</p><p>Next, let's place the public key on the PVE host so that you can use the SSH key authentication to login.</p></li><li class="listitem">Confirm the presence of the keys by listing the contents of <code class="literal">~/.ssh/</code>; ensure that both <code class="literal">id_rsa</code> and <code class="literal">id_rsa.pub</code> are present in the results:

<pre class="programlisting">    ls ~/.ssh/&#13;
</pre></li><li class="listitem">Next, push the new public key to the PVE host using the <code class="literal">ssh-copy-id</code> tool with the following syntax (assuming the username is <code class="literal">rgoldman</code> and the PVE host is at <code class="literal">192.168.1.200</code>):<pre class="programlisting">    ssh-copy-id rgoldman@192.168.1.200&#13;
</pre></li><li class="listitem">That's it. Now confirm you can login without a password:<pre class="programlisting">    ssh rgoldman@192.168.1.200&#13;
</pre></li></ol></div><p>If you were able to login to your PVE account using SSH without a password, you have successfully configured SSH key-based authentication for your account.</p><p>The image that follows illustrates the transaction:</p><p>
</p><div class="mediaobject"><img src="graphics/B01784_07_16-3.png" alt="Relying on key-based authentication"/><div class="caption"><p>SSH key authentication</p></div></div><p>
</p><p>Note, however, that your password-based authentication mechanism is still active; the SSH server is still exposed to brute-force or social engineering attacks.</p><p>The following steps will disable password-based authentication on your server. Certainly, don't proceed here if you plan to access PVE from other hosts but haven't copied the key yet (or if you are not yet confident with key-based authentication):</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Using SSH, log in to the PVE host from a local workstation.</li><li class="listitem">Escalate privileges:
<pre class="programlisting">    su -&#13;
</pre></li><li class="listitem">Open the SSH daemon configuration using <code class="literal">nano</code> or another plaintext editor:
<pre class="programlisting">    nano /etc/ssh/sshd_config&#13;
</pre></li><li class="listitem">Browse the contents of the file for the following directive:
<pre class="programlisting">    PasswordAuthentication yes&#13;
</pre></li><li class="listitem">Change the directive so it is as follows:
<pre class="programlisting">    PasswordAuthentication no&#13;
</pre></li><li class="listitem">Save the file and close the editor with 
<span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>X</em></span>, <span class="emphasis"><em>Y
</em></span>, <span class="emphasis"><em>Enter</em></span>.
</li><li class="listitem">Restart the SSH daemon:<pre class="programlisting">    /etc/init.d/ssh restart&#13;
</pre></li></ol></div><p>We can now access Proxmox VE via SSH without worrying about the strength of our passwords or being vulnerable to brute force attacks or social engineering attacks.</p><p>Note, however, it's imperative when we rely on key-based authentication that we keep our keys absolutely secure. This means, in part, remembering consistently to lock our workstations and protect our workstation accounts with strong passwords.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip80"/>Tip</h3><p>
<span class="strong"><strong>Learn more about SSH</strong></span></p><p>To learn more about SSH and authentication, consider visiting the following resources:</p><p><a class="ulink" href="https://www.debian-administration.org/article/530/SSH_with_authentication_key_instead_of_password">https://www.debian-administration.org/article/530/SSH_with_authentication_key_instead_of_password</a></p><p>
<a class="ulink" href="https://www.digitalocean.com/community/tutorials/how-to-configure-ssh-key-based-authentication-on-a-linux-server">https://www.digitalocean.com/community/tutorials/how-to-configure-ssh-key-based-authentication-on-a-linux-server</a></p><p>
<a class="ulink" href="https://debian-handbook.info/browse/stable/sect.remote-login.html">https://debian-handbook.info/browse/stable/sect.remote-login.html</a></p><p>For additional hardening strategies for SSH, visit <a class="ulink" href="http://howto.biapy.com/en/debian-gnu-linux/system/security/harden-the-ssh-access-security-on-debian">http://howto.biapy.com/en/debian-gnu-linux/system/security/harden-the-ssh-access-security-on-debian</a>.</p></div></div></div></div><div class="section" title="Managing patches"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec12"/>Managing patches</h3></div></div></div><p>As we discovered, the patch for the VENOM exploit was available for Debian the same day the exploit was made public; PVE administrators simply had to update and upgrade and restart PVE guests to eliminate the threat. This should drive home the importance of applying security patches not only for the Proxmox VE host, but also for its guests, whether they are containers or virtual machines.</p><p>However, routinely applying patches for several machines is tedious no matter the assurance it provides.</p><p>For the PVE hosts and Ubuntu or Debian guests, there are several tools to relieve the tedium. Finding the sweet spot between fully automated upgrades with minimal interactivity and doing due diligence to ensure patch candidates won't disrupt operations is where the magic happens.</p><p>In this section, we'll configure a tool called <span class="strong"><strong>unattended-upgrades</strong></span> to routinely apply only security upgrades. We'll leave other patches to our best judgement.</p><p>Use the APT tool to install unattended-upgrades:</p><pre class="programlisting">su -
apt-get update
apt-get install -y unattended-upgrades</pre><p>Then, configure the automated security upgrades:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">The default configuration file for the unattended-upgrades package is at <code class="literal">/etc/apt/apt.conf.d/50unattended-upgrades</code>; let's take a look at it:<pre class="programlisting">    nano /etc/apt/apt.conf.d/50unattended-upgrades&#13;
</pre></li><li class="listitem">Look for the following stanza (the <code class="literal">//</code> characters preceding some lines effectively comment out directives so they are ignored):<pre class="programlisting">    // Automatically upgrade packages from these (origin:archive) pairs&#13;
    Unattended-Upgrade::Allowed-Origins {&#13;
            "${distro_id}:${distro_codename}-security";&#13;
    //      "${distro_id}:${distro_codename}-updates";&#13;
    //      "${distro_id}:${distro_codename}-proposed";&#13;
    //      "${distro_id}:${distro_codename}-backports";&#13;
    };&#13;
</pre></li><li class="listitem">Ensure that the line with "<code class="literal">${distro_id}:${distro_codename}-security</code>"; is not commented out. This directive signals the utility to allow unattended-upgrades from security repositories, and only from security repositories.</li><li class="listitem">Exit the configuration file by pressing 
<span class="emphasis"><em>Ctrl
</em></span> + 
<span class="emphasis"><em>X
</em></span>, 
<span class="emphasis"><em>Y
</em></span>, and 
<span class="emphasis"><em>Enter
</em></span> to preserve any changes you may have made.</li><li class="listitem">Next, let's check the configuration of <code class="literal">/etc/apt/apt.conf.d/20auto-upgrade</code> to ensure that Debian is configured to periodically update package lists and that unattended-upgrades are enabled:
<pre class="programlisting">    nano /etc/apt/apt.conf.d/20auto-upgrade&#13;
</pre></li><li class="listitem">Ensure that the following lines appear in the file as they do here:
<pre class="programlisting">    APT::Periodic::Update-Package-Lists "1";&#13;
    APT::Periodic::Unattended-Upgrade "1";&#13;
</pre></li><li class="listitem">With unattended-upgrades configured, de-escalate privileges by entering <code class="literal">exit</code> in the terminal.</li></ol></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip81"/>Tip</h3><p>Changes made by the unattended-upgrades utility are logged in <code class="literal">/var/log/unattended-upgrades/unattended-upgrades.log</code>.</p></div></div><p>The same package can be used to automate security patch applications for Proxmox VE guests running Ubuntu, Debian, or LinuxMint.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip82"/>Tip</h3><p>To learn more about the unattended-upgrades package, see the following documentation:<a class="ulink" href="https://wiki.debian.org/UnattendedUpgrades">https://wiki.debian.org/UnattendedUpgrades</a></p><p>
<a class="ulink" href="https://debian-handbook.info/browse/stable/sect.regular-upgrades.html">https://debian-handbook.info/browse/stable/sect.regular-upgrades.html</a>
</p></div></div><div class="section" title="Enterprise subscriptions"><div class="titlepage"><div><div><h4 class="title"><a id="ch07lvl4sec16"/>Enterprise subscriptions</h4></div></div></div><p>Though PVE may be open source, Proxmox Server Solutions (the company behind Proxmox VE) very strongly encourages users to invest in subscriptions for Proxmox VE (<a class="ulink" href="https://www.proxmox.com/en/proxmox-ve/support">https://www.proxmox.com/en/proxmox-ve/support</a>):</p><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em>"A Proxmox VE subscription is the easy and affordable solution to get access to the Proxmox VE Enterprise repository, to stable software updates and security enhancements, as well as to technical support services. A subscription helps you to run Proxmox VE with confidence in your company."</em></span>
</p></blockquote></div><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em>"By combining great open source software with quality-assured services and support the Proxmox VE Subscription helps you to deploy and maintain the best stable and secure open source virtualization environment"</em></span>
</p></blockquote></div><p>Security wise, there is a strong advantage to obtaining a subscription: Proxmox Server Solutions provides subscribers with access to the enterprise repository, which provides stable and "enhanced" security updates.</p><p>In contrast, users of the <code class="literal">pve-no-subscription</code> repositories have access to patches that are perhaps more cutting-edge, but also less stable.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip83"/>Tip</h3><p>Another benefit of a Proxmox subscription is access to dedicated, professional support. This is far from a commentary on community support, which has in all cases been fantastic in my experience. However, subscription support will track a ticket and promise prompt solutions. In a production environment, this can certainly make a critical difference.</p></div></div><p>There are four subscription plans available: premium, standard, basic, and community (this last plan does not offer a support plan, but it does offer access to the enterprise repository). Plans are priced per month per CPU socket (<a class="ulink" href="https://www.proxmox.com/en/proxmox-ve/pricing">https://www.proxmox.com/en/proxmox-ve/pricing</a>).</p><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em>"Subscriptions are licensed per physical server and CPU socket. In a Proxmox VE Cluster, you need to have the same subscription level for all your servers. Subscription period is one year from purchase date."</em></span>
</p></blockquote></div><p>Technical support is provided to subscribers via a web and email-based customer portal (in English or German).</p><p>Community support, by contrast, is available via the public support forum (<a class="ulink" href="https://forum.proxmox.com">https://forum.proxmox.com</a>) or via IRC (the <code class="literal">##proxmox</code> channel on the Freenode network).</p><p>
</p><div class="mediaobject"><img src="graphics/image_07_016.png" alt="Enterprise subscriptions"/><div class="caption"><p>Proxmox community support forum</p></div></div><p>
</p><p>A video tutorial is available to guide subscribers in uploading a subscription key to Proxmox VE and installing new updates at <a class="ulink" href="https://www.proxmox.com/en/training/video-tutorials/item/install-updates">https://www.proxmox.com/en/training/video-tutorials/item/install-updates</a>.</p><p>From a security perspective then, the <code class="literal">pve-no-subscription</code> repository is characterized on the site as offering patches that are not quite stable enough for production, while the enterprise repository promises enhanced security patches. You'll have to make a deliberate choice for your use case.</p><p>If you're moving services that are not mission-critical to a virtual infrastructure with Proxmox VE, perhaps community support and the <code class="literal">pve-no-subscription</code> options will work well for you. Otherwise, give all due consideration to an appropriate subscription option.</p></div></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec39"/>Summary</h1></div></div></div><p>The security and information that assurance administrators can realistically provide is clearly never as exhaustive as it is exhausting.</p><p>In the first section of this chapter, you learned that hardware virtualization has inherent security benefits.</p><p>However, you also learned that many promising benefits are undermined if they're not supported by thorough planning of the virtual infrastructure, explicit policy-making up front, and a flawless deployment, all followed by unflagging policy enforcement and ongoing virtual server lifecycle management.</p><p>We then outlined threats that are either unique to virtualized infrastructures or aggravated in the context of virtualization. Each point was followed by either concrete action to mitigate the threat or links to resources for more details on addressing a potential problem.</p><p>We concluded with concrete, step-by-step remedies that could be initiated immediately, even as you continue to explore and assess Proxmox VE.</p></div></body></html>