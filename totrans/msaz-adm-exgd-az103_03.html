<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Analyzing Resource Utilization and Consumption</h1>
                </header>
            
            <article>
                
<p><span>In the previous chapter, we covered how to create and manage the different aspects of Azure subscriptions and resources. </span></p>
<p>This chapter will cover the second part of <em>M</em><span><em>anaging Azure Subscriptions and Resources </em></span>objective<span>. In this chapter</span><span>, we are going to illustrate how to monitor your different Azure resources using Azure Monitor. You will learn about the different capabilities of Azure Monitor and how to create and analyze different metrics and alerts, thereby using Azure Monitor to provide valuable insights about the performance and behavior of all your Azure resources. To finish this chapter, we're going to look at Azure Log Analytics and how it's integrated inside Azure Monitor. You'll also learn how to create Log Search Query functions.</span></p>
<p>The following topics will be covered in this chapter:</p>
<ul>
<li>Azure Monitor</li>
<li><span>Creating and analyzing metrics and alerts</span></li>
<li>Creating action groups</li>
<li>Configuring diagnostic settings on resources</li>
<li>Azure Log Analytics</li>
<li>Utilizing Log Search Query functions</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Azure Monitor</h1>
                </header>
            
            <article>
                
<p>Azure Monitor is a monitoring solution in the Azure portal that delivers a <span>comprehensive solution for collecting, analyzing, and acting on telemetry from cloud and on-premises environments. It can be used to monitor various aspects (for instance, the performance of applications) and identify issues affecting those applications and other resources that depend on them.</span></p>
<p>The data that is collected by Azure Monitor fits into two fundamental types: metrics and logs. Metrics describe an aspect of a system at a particular point in time and are displayed in numerical values. They are capable of supporting near real-time scenarios. Logs are different from metrics. They contain data that is organized into records, with different sets of properties for each type. Data like events, traces, and performance data are stored as logs. They can then be combined for analysis purposes.</p>
<p>Azure Monitor supports data collection from a variety of Azure resources, which are all displayed in the overview page in the Azure portal. Azure Monitor provides the following metrics and logs:</p>
<ul>
<li><strong>Application monitoring data</strong>: This will consist of data about the functionality and performance of the application and the code that is written, regardless of its platform.</li>
<li><strong>Guest OS monitoring data</strong>: <span>This will consist of data about the</span> operating system on which your application is running. This could be running in any cloud or on-premises.</li>
<li><strong>Azure resource monitoring data</strong>: <span>This will consist of data about the</span> operation of an Azure resource.</li>
<li><strong>Azure subscription monitoring data</strong>: <span>This will consist of data about the</span> operation and management of an Azure subscription, as well as data about the health and operation of Azure itself.</li>
<li><strong>Azure tenant monitoring data</strong>: <span>This will consist of data about the</span> operation of tenant-level Azure services, such as Azure Active Directory.</li>
</ul>
<div class="packt_infobox"><span>Azure Monitor now integrates the capabilities of Log Analytics and Application Insights together. You can also keep using Log Analytics and Application Insights on their own.</span></div>
<p>Now that we have some basic knowledge about Azure Monitor, we are going to look at how to a<span>nalyze alerts and metrics across subscriptions.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating and analyzing metrics and alerts</h1>
                </header>
            
            <article>
                
<p>To <span>analyze alerts and metrics across Azure Monitor, we need to go to the monitoring resource inside the Azure portal. In the upcoming sections, we will set up metrics and alerts and show you how to analyze them.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Metrics</h1>
                </header>
            
            <article>
                
<p><span>Metrics describe an aspect of a system at a particular point in time and are displayed in numerical values. They are capable of supporting near real-time scenarios. </span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a metric</h1>
                </header>
            
            <article>
                
<p><span>To display the metrics for the various Azure resources in Azure Monitor, perform the following steps: </span></p>
<ol>
<li><span>Navigate to the Azure portal by opening </span><a href="https://portal.azure.com">https://portal.azure.com</a>.</li>
</ol>
<ol start="2">
<li>In the left-hand menu, select <span class="packt_screen">Monitoring</span> to open the <span class="packt_screen">Azure Monitor</span> overview blade:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/6730de09-ae3d-4896-8951-3e490ba7ac8c.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Azure Monitor overview</div>
<ol start="3">
<li>First, we're going to look at metrics. Therefore, in the left-hand menu, select <strong><span class="packt_screen">Metrics</span></strong>, or select the <span class="packt_screen"><strong>Explore Metrics</strong></span> button from the overview blade.</li>
</ol>
<ol start="4">
<li>In the <span class="packt_screen">M</span><span class="packt_screen">etrics</span> overview blade, click on the <strong><span class="packt_screen">+ Select a resource</span></strong> button. A new blade will open up where you can select the subscription, the resource group, and the resource type. Select the subscription that was used for the demonstration of the previous chapter, select <kbd>PacktResourceGroup</kbd>, and then select the VM (in my case, Linux). You can filter by other resource types, as well:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/fced2333-7433-40e0-a817-3b436698a79a.png"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Selecting the resources</div>
<ol start="5">
<li>Click on <strong><span class="packt_screen">Apply</span></strong>.</li>
</ol>
<ol start="6">
<li>Then, you can select the metric type. Select <span class="packt_screen"><strong>CPU </strong><strong>Credits Consumed</strong></span>, <span>for instance:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/d8d61712-0cb0-4d74-873c-54ca969fe289.png"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref"><span>Metric type</span></div>
<div class="packt_tip"><br/>
<span>Take some time to look at the different metrics that you can choose from. This may be a part of the exam questions.</span></div>
<ol start="7">
<li class="CDPAlignLeft CDPAlign">You can select a different type of aggregation as well, like the count, average, and more, in the filter box. In the top-right of the blade, you can select a different time range for your metric as well:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/76bedc2d-dd64-4018-91c6-fccea0679000.png" style="width:23.17em;height:17.33em;"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Time ranges</div>
<ol start="8">
<li>You can also pin this metric to the overview dashboard in the Azure portal. Therefore, click on the <strong><span class="packt_screen">Pin to dashboard</span></strong> button, and then choose to pin it to the current dashboard or create a new dashboard for it. For now, select <span class="packt_screen"><strong>Pin</strong> <strong>to current dashboard</strong></span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/3645735b-7874-488b-b9c1-8270642b0412.png" style="width:26.75em;height:12.83em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Pin metric to dashboard</div>
<ol start="9">
<li>If you now select <strong><span class="packt_screen">Dashboard</span></strong> from the left-hand menu, you'll see that this metric is added to it. This way, you can easily analyze this metric without the need to open Azure Monitor.</li>
</ol>
<div class="packt_infobox">Metrics are also available directly from the Azure resource blades. So, for instance, if you have a VM, go to the VM resource by selecting it. Then, in the left-hand menu, under <strong><span class="packt_screen">Monitoring</span></strong>, you can select <strong><span class="packt_screen">Metrics</span></strong>.</div>
<p>In the next section, we're going to look at how to set up and analyze alerts in Azure Monitor.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Alerts</h1>
                </header>
            
            <article>
                
<p>With alerts, Azure can<span> </span><span>proactively notify you when critical conditions occur in the Azure or on-premises environment. Alerts can also attempt to take corrective actions automatically. Alert rules that are based on metrics will provide near real-time alerting, based on the metric. </span>Alerts that are created based on logs can merge data from different resources together.</p>
<p>The alerts in Azure Monitor use action groups, which are unique sets of recipients and actions that can be shared across multiple rules. These action groups can use<span> </span>Webhooks to start external actions, based on the requirements that are set up for this alert.<span> These external actions can then be picked up by different Azure resources, like runbooks, functions, or logic apps. </span>Webhooks<span> </span>can also be used for adding these alerts to external <span><strong>IT Service Management</strong> (</span><strong>ITSM</strong><span>)</span> <span>tools.</span>  </p>
<p><span>You can also set alerts for all the different Azure resources. In the following sections, we are going to create an alert.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating an alert</h1>
                </header>
            
            <article>
                
<p>To create an alert, perform the following steps:</p>
<ol>
<li>From the <span class="packt_screen">Azure Monitor</span> overview blade, in the left-hand menu, select <strong><span class="packt_screen">Alerts</span></strong>. You can also go to the alerts settings by clicking on <strong><span class="packt_screen">Create alert</span></strong> in order to create an alert directly<strong>.</strong></li>
<li>In the <span class="packt_screen">Alerts</span> blade, click on <strong><span class="packt_screen">+ New alert rule</span> </strong>in the top menu:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/144ea88e-610f-43c6-a992-66e27f3e4eae.png"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Creating a new alert</div>
<ol start="3">
<li class="CDPAlignLeft CDPAlign">The <strong><span class="packt_screen">Create rule</span></strong> blade is displayed. Here, you can create the rule and action groups. To create a new rule, you need to first select the resource. Click on the <strong><span class="packt_screen">Select</span></strong> button under the <span class="packt_screen">RESOURCE</span> section:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/dbdde4fc-b227-45cc-bf08-195ef17f1e24.png"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Creating a new rule</div>
<ol start="4">
<li class="CDPAlignLeft CDPAlign">In the next blade, you can filter by the subscription and resource type. Select <span class="packt_screen">Virtual machines</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/aa20ea67-3a97-48b9-9523-5051c4dd5178.png" style="width:42.92em;height:50.33em;"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Filtering by subscription and resource type</div>
<ol start="5">
<li>Select the VM that we created in the previous chapter from the list and click <strong><span class="packt_screen">Done</span></strong>.</li>
<li>Now that we have a resource selected, we're going to set up the condition. Click on <strong><span class="packt_screen">Add condition</span></strong>.</li>
<li>The condition blade is open, and so we can filter by a certain signal. Select <strong><span class="packt_screen">Percentage CPU</span></strong> and click <strong><span class="packt_screen">Done</span></strong>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/1dfccb7a-fb8f-4901-8186-10c2198469b3.png"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Filtering on a signal</div>
<ol start="8">
<li>Next, you can set the alert logic for this alert. You can choose multiple operators, set the aggregation type, and set the threshold value for this alert. Set the following:
<ul>
<li><strong><span class="packt_screen">Operator</span></strong>: <span class="packt_screen">Greater than</span></li>
<li><strong><span class="packt_screen">Aggregation type</span></strong>: <span class="packt_screen">Average</span></li>
<li><strong><span class="packt_screen">Threshold Value</span></strong>: <span class="packt_screen">90%</span></li>
</ul>
</li>
<li>Leave <span class="packt_screen">Evaluated based on</span> with its default settings.</li>
</ol>
<ol start="10">
<li class="CDPAlignLeft CDPAlign">This alert will notify you when the CPU of the virtual machines is greater than 90% over a five minute period of time. Azure Monitor will check this every minute:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/901eb9dd-8f07-419d-ae00-26c3265180f3.png" style="width:41.92em;height:49.17em;"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Setting condition values</div>
<ol start="11">
<li>Click on <strong><span class="packt_screen">Done</span></strong> to create this condition.</li>
<li>Now, we have to create an action group to send the alert to. This is then responsible for handling the alert and taking further action on it. The action group that you create here can be reused across other alerts as well. So, in our case, we will create an email action group that will send out an email to a certain email address. After its creation, you can add this existing action group to other alerts. Under <strong><span class="packt_screen">Action group</span></strong>, select the <strong><span class="packt_screen">Create new</span></strong> button.</li>
<li>In the <span class="packt_screen">Action Group</span> blade, add the following settings:
<ul>
<li><strong><span class="packt_screen">Action group name</span></strong>: <kbd>Send email</kbd></li>
<li><strong><span class="packt_screen">Short name</span></strong>: <kbd>email</kbd></li>
<li><strong><span class="packt_screen">Subscription</span></strong>: Select the subscription where the VM is created, as well</li>
<li><strong><span class="packt_screen">Resource group</span></strong>: Select <span class="packt_screen">Default-ActivitiyLogAlerts</span> (to be created)</li>
</ul>
</li>
<li>Then, we have to provide the actual action. Add the following values:
<ul>
<li><strong><span class="packt_screen">Action name</span></strong>: <kbd>email</kbd></li>
<li><strong><span class="packt_screen">Action type</span></strong>: <span class="packt_screen">Email/SMS/Push/Voice</span></li>
</ul>
</li>
</ol>
<ol start="15">
<li class="CDPAlignLeft CDPAlign">Then, select <span class="packt_screen">Edit details</span> and select the <span class="packt_screen">Email</span> checkbox. Provide an email address and click on the <span class="packt_screen">OK</span> button:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/47529632-fd70-4510-966f-879c0a612eda.png"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Creating an action group</div>
<ol start="16">
<li>Click on <strong><span class="packt_screen">OK</span></strong> again.</li>
</ol>
<ol start="17">
<li class="CDPAlignLeft CDPAlign">Finally, you have to specify an alert name, set the severity level of the alert, and click on <strong><span class="packt_screen">Create alert rule</span></strong>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/2a72ed4b-9c8d-41bc-b4b6-605832027b16.png"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Alert settings</div>
<p class="mce-root"/>
<p>We have now created an alert and an action group that will alert a user via email when the CPU goes over 90%. In the next section, we're going to configure diagnostic settings on resources.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring diagnostic settings on resources</h1>
                </header>
            
            <article>
                
<p>You can also configure diagnostic settings on different Azure resources. There are two types of diagnostic logs available in Azure Monitor:</p>
<ul>
<li class="mce-root"><strong><span class="packt_screen">Tenant logs</span></strong>: <span>These logs consist of all the tenant-level services that exist outside of an Azure subscription. An example of this is the Azure Active Directory logs.</span></li>
<li><strong><span class="packt_screen">Resource logs</span></strong>: <span>These logs consist of all the data from the resources that are deployed inside an Azure subscription; for example, virtual machines, storage accounts, and network security groups.</span></li>
</ul>
<p>The contents of these logs are different for every Azure resource. These logs differ from <span>guest OS-level diagnostic logs. To collect OS-level logs, an agent needs to be installed on the virtual machine. The diagnostic logs don't require an agent to be installed; they can be accessed directly from the Azure portal.</span></p>
<p>The logs that can be accessed are stored inside a storage account and can be used for auditing or manual inspection purposes. You can specify the retention time in days by using the resource diagnostic settings<span>.<strong> </strong>You can also stream the logs to event hubs to analyze them in PowerBI, or insert them into a third-party service. These logs can also be analyzed with Azure Monitor. Then, there will be no need to store them in a storage account first.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Enabling diagnostic settings</h1>
                </header>
            
            <article>
                
<p>To enable the diagnostic settings for resources, perform the following steps:</p>
<ol>
<li><span>Navigate to the Azure portal by opening </span><a href="https://portal.azure.com">https://portal.azure.com</a>.</li>
<li>Go to the VM that we created in the previous chapter again. Make sure that the VM is running, and in the left-hand menu, under <strong><span class="packt_screen">Monitoring</span></strong>, select <strong><span class="packt_screen">Diagnostic settings</span></strong>. </li>
<li>The <span class="packt_screen">Diagnostic Settings</span> blade will open up. You will need to select a storage account where the metrics can be stored. </li>
</ol>
<ol start="4">
<li class="CDPAlignLeft CDPAlign">Click on the <strong><span class="packt_screen">Enable guest-level monitoring</span></strong> button to update the diagnostic settings for the virtual machine:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/83053967-e924-44a4-8e7b-909ac8faf189.png"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Enabling diagnostic settings for a virtual machine</div>
<ol start="5">
<li>When the settings are updated, you can go to <span class="packt_screen">Metrics</span> in the top menu to set the metrics that are collected. The <span class="packt_screen">syslog</span> blade is used for setting the minimum log level.</li>
<li>New metrics will be available from the metrics blade after enabling diagnostic logging in Azure Monitor. You can analyze them in the same way that we did earlier in this chapter, in the <em>Metrics</em> section.</li>
</ol>
<p>In the next section, we're going to look at the Azure Log Analytics service, which is now a part of Azure Monitor as well.</p>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Viewing alerts in Log Analytics</h1>
                </header>
            
            <article>
                
<p class="mce-root">Azure Log Analytics is a service that collects telemetry data from various Azure resources and on-premises resources. All of that data is stored inside a Log Analytics workspace, which is based on the Azure Data Explorer. It uses the Kusto Query Language, which is also used by Azure Data Explorer to retrieve and analyze the data. </p>
<p>Analyzing this data can be done from Azure Monitor. All the analysis functionalities are integrated in there. The term <span class="packt_screen">Log Analytics</span><span> now primarily applies to the blade in the Azure portal where you can analyze metric data.</span></p>
<p>Before we are able to display, monitor, and query the logs from Azure Monitor, we need to create a Log Analytics workspace. For that, we have to perform the following steps:</p>
<ol>
<li><span>Navigate to the Azure portal by opening </span><a href="https://portal.azure.com">https://portal.azure.com</a>.</li>
<li>Click on<span class="packt_screen"> <strong>Create a new resource</strong></span>.</li>
<li>Type <kbd>Log Analytics</kbd> in the search box and create a new workspace.</li>
<li>Add the following values:
<ul>
<li><strong><span class="packt_screen">Log Analytics workspace</span></strong>: <kbd>PacktWorkspace</kbd></li>
<li><strong><span class="packt_screen">Subscription</span></strong>: Select a subscription</li>
<li><strong><span class="packt_screen">Resource group</span></strong>: Create a new one and call it <kbd>PacktWorkspace</kbd></li>
<li><strong><span class="packt_screen">Location</span></strong>: <span class="packt_screen">West US</span></li>
<li><strong><span class="packt_screen">Pricing tier</span></strong>: Keep the default one, which is <strong><span class="packt_screen">per GB</span></strong></li>
</ul>
</li>
<li>Click on the <strong><span class="packt_screen">OK</span> </strong>button to create the workspace.</li>
</ol>
<div class="packt_infobox">You can also create this workspace from Azure Monitor. Go to the <span class="packt_screen">Azure Monitor</span> blade, and under <span class="packt_screen"><strong>Insights</strong></span> in the left-hand menu, select <strong><span class="packt_screen">More</span></strong>. When no workspace has been created, Azure will ask to create one.</div>
<p>Now that we have created a <span>Log Analytics workspace, we can use it inside Azure Monitor to create some queries to retrieve data. We will do this in the next section.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Utilizing Log Search Query functions</h1>
                </header>
            
            <article>
                
<p>Azure Monitor is now integrated with the features and capabilities that Log Analytics was offering. This also includes creating search queries across the different logs and metrics by using the Kusto<span> Query Language.</span></p>
<p><span>To retrieve any type of data from Azure Monitor, a query is required. Whether you are configuring an alert rule, analyzing data in the Azure portal, retrieving data using the Azure Monitor Logs API, or being notified of a particular condition, a query is used.</span></p>
<p>The following list provides an overview of all the different ways queries are used by Azure Monitor:</p>
<ul>
<li><strong><span class="packt_screen">Portal</span></strong>: From the Azure portal, an interactive analysis of log data can be performed. In there, you can create and edit queries and analyze the results in a variety of formats and visualizations.</li>
<li><strong><span class="packt_screen">Dashboards</span></strong>: The results of a query can be pinned to a dashboard. This way, results can be visualized and shared with other users.</li>
<li><strong><span class="packt_screen">Views</span></strong>: By using the View Designer in Azure Monitor, you can create custom views of your data. This data is provided by queries as well.</li>
<li><strong><span class="packt_screen">Alert rules</span></strong>: Alert rules are also made up of queries. </li>
<li><strong><span class="packt_screen">Export</span></strong>: Exports of data to Excel or PowerBI are created with queries. The query defines the data to export.</li>
<li><strong><span class="packt_screen">Azure Monitor Logs API</span></strong>: The Azure Monitor Logs API allows any REST API client to retrieve log data from the workspace. The API request includes a query to retrieve the data.</li>
<li><strong>PowerShell</strong>: You can run a PowerShell script from a command line or an Azure Automation runbook that uses <kbd>Get-AzOperationalInsightsSearchResults</kbd> to retrieve log data from Azure Monitor. You need to create a query for this cmdlet to retrieve the data. </li>
</ul>
<p>In the following section, we are going to create some queries to retrieve data from the logs in Azure Monitor.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Querying logs in Azure Monitor</h1>
                </header>
            
            <article>
                
<p>To query logs in Azure monitor, perform the following steps:</p>
<ol>
<li><span>Navigate to the Azure portal by opening </span><a href="https://portal.azure.com">https://portal.azure.com</a>.</li>
<li>In the left-hand menu, select <span class="packt_screen">Monitoring</span> to open the <span class="packt_screen">Azure Monitor</span> overview blade. Under <strong><span class="packt_screen">Insights</span></strong>,<strong> </strong>select <strong><span class="packt_screen">More</span></strong>. This will open the Log Analytics workspace that we created in the previous step.  </li>
</ol>
<ol start="3">
<li class="CDPAlignLeft CDPAlign">On the overview page, click on <strong><span class="packt_screen">Logs</span></strong> in the top menu. This will open the Azure Monitor query editor:</li>
</ol>
<div class="CDPAlignCenter CDPAlign packt_figref"><img src="assets/6be43f8e-e690-43d1-a3fe-27cbf3a03a4e.png"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref"><span>Azure Monitor query editor</span></div>
<ol start="4">
<li class="CDPAlignLeft CDPAlign">Here, you can select some default queries. They are displayed at the bottom part of the screen. There are queries for retrieving unavailable computers, the last heartbeat of a computer, and much more. Add the following queries to the query editor window to retrieve data:</li>
</ol>
<ul>
<li style="list-style-type: none">
<ul>
<li><span>This</span> query will retrieve t<span>he to</span><span>p 10 comp</span><span>uter</span><span>s with the most error events over the past day:</span></li>
</ul>
</li>
</ul>
<pre style="padding-left: 150px">Event | where (EventLevelName == "Error") | where (TimeGenerated &gt; ago(1days)) | summarize ErrorCount = count() by Computer | top 10 by ErrorCount desc</pre>
<p class="mce-root"/>
<p class="mce-root"/>
<ul>
<li style="list-style-type: none">
<ul>
<li>This query will create a <span>line chart with the processor utilization for each computer from last week:</span></li>
</ul>
</li>
</ul>
<pre style="padding-left: 150px">Perf | where ObjectName == "Processor" and CounterName == "% Processor Time" | where TimeGenerated between (startofweek(ago(7d)) .. endofweek(ago(7d)) ) | summarize avg(CounterValue) by Computer, bin(TimeGenerated, 5min) | render timechart </pre>
<div class="packt_infobox">A detailed overview and tutorial on how to get started with the Kusto<span> Query Language</span> is beyond the scope of this book. If you want to find out more about this query language, you can refer to <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/log-query/get-started-queries">https://docs.microsoft.com/en-us/azure/azure-monitor/log-query/get-started-queries</a>.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p><span>In this chapter,</span> <span>we covered the second part of the <em>Managing Azure Subscriptions and Resources</em> objective. We covered the various aspects of </span><span>Azure Monitor and how you can use metrics to monitor all of your Azure resources and alerts in order to get notified when certain things are happening with your Azure resources. We also used Azure Log Analytics and created queries so that we could get valuable data out of the logs.</span></p>
<p>In the next chapter, we will cover the third (and final) part of this exam objective. In that chapter, we will cover how to manage <strong>role-based access control</strong> (<strong>RBAC</strong>).</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Questions</h1>
                </header>
            
            <article>
                
<p><span>Answer the following questions to test your knowledge of the information in this chapter. You can find the answers in the <em>Assessments</em> section at the end of this book:</span></p>
<ol start="1">
<li>Is Azure Log Analytics now a part of Azure Monitor?
<ul>
<li>Yes</li>
<li>No</li>
</ul>
</li>
<li>Suppose that you want to create a query to retrieve specific log data from a virtual machine. Do you need to write a SQL statement to retrieve this?
<ul>
<li>Yes</li>
<li>No</li>
</ul>
</li>
</ol>
<ol start="3">
<li>Are action groups used to enable metrics for Azure Monitor?
<ul>
<li>Yes</li>
<li>No</li>
</ul>
</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Further reading</h1>
                </header>
            
            <article>
                
<p><span>You can check out the following links for more information about the topics that were covered in this chapter:</span></p>
<ul>
<li><em>Azure Monitor overview</em>: <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/overview">https://docs.microsoft.com/en-us/azure/azure-monitor/overview</a></li>
<li><em>Collect and consume log data from your Azure resources</em>: <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/platform/diagnostic-logs-overview">https://docs.microsoft.com/en-us/azure/azure-monitor/platform/diagnostic-logs-overview</a></li>
<li><em>Analyze log data in Azure Monitor</em>: <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/log-query/log-query-overview">https://docs.microsoft.com/en-us/azure/azure-monitor/log-query/log-query-overview</a></li>
<li><em>Create custom views by using View Designer in Azure Monitor</em>: <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/platform/view-designer">https://docs.microsoft.com/en-us/azure/azure-monitor/platform/view-designer</a></li>
<li><em>Azure Monitor naming and terminology changes</em>: <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/terminology">https://docs.microsoft.com/en-us/azure/azure-monitor/terminology</a></li>
</ul>


            </article>

            
        </section>
    </body></html>