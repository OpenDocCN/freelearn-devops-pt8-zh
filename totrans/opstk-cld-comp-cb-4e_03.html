<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Chapter&#xA0;3.&#xA0;Keystone &#x2013; OpenStack Identity Service" id="11C3M1-189e69df43a248268db97cde1b1a8e47"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03" class="calibre1"/>Chapter 3. Keystone – OpenStack Identity Service</h1></div></div></div><p class="calibre10">In this chapter, we will cover the following topics:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Introduction – OpenStack Identity</li><li class="listitem">Creating OpenStack domains in Keystone</li><li class="listitem">Enabling domains in the OpenStack dashboard</li><li class="listitem">Creating OpenStack projects in Keystone</li><li class="listitem">Configuring roles in Keystone</li><li class="listitem">Adding users in Keystone</li><li class="listitem">Configuring groups in Keystone</li><li class="listitem">Deleting projects</li><li class="listitem">Deleting users</li><li class="listitem">Deleting roles</li><li class="listitem">Deleting groups</li><li class="listitem">Deleting domains</li><li class="listitem">OpenStack endpoint information</li></ul></div></div>

<div class="book" title="Chapter&#xA0;3.&#xA0;Keystone &#x2013; OpenStack Identity Service" id="11C3M1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="Introduction – OpenStack Identity"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch03lvl1sec32" class="calibre1"/>Introduction – OpenStack Identity</h1></div></div></div><p class="calibre10">The OpenStack<a id="id139" class="calibre1"/> Identity service, known as <span class="strong"><strong class="calibre2">Keystone</strong></span>
<a id="id140" class="calibre1"/>, provides services for authenticating and managing user accounts and role information for our OpenStack cloud environment.</p><p class="calibre10">It is a crucial service that underpins the authentication and verification between all of our OpenStack cloud services and is the first service that needs to be installed within an OpenStack environment. The OpenStack Identity service authenticates users and projects by sending a validated authorization token between all OpenStack services. This token is passed to the other services, such as Storage and Compute, to grant user access to specific functionalities. Therefore, configuration of the OpenStack Identity service must be completed first before using any of the other services. Setting up of the Identity service involves the creation of appropriate roles for users and services, projects, the user accounts, and the service API endpoints that make up our cloud infrastructure. Since we are using Ansible for deploying our environment (refer to <a class="calibre1" title="Chapter 1. Installing OpenStack with Ansible" href="part0014_split_000.html#DB7S2-189e69df43a248268db97cde1b1a8e47">Chapter 1</a>, <span class="strong"><em class="calibre18">Installing OpenStack with Ansible</em></span> for more details), all the basic configuration is done for us in the Ansible playbooks.</p><p class="calibre10">In Keystone, we have the concepts of domains, projects, roles, users, and user groups. A Keystone <a id="id141" class="calibre1"/>domain (not to be confused with a DNS domain) is a high level OpenStack Identity resource that contains projects, users, and groups. A project has resources such as users, images, and instances, as well as networks in it that can be restricted only to that particular project, unless explicitly shared with others. A user can belong to one or more projects and is able to switch between them to gain access to those resources. Users within a project can have various roles assigned. Users can be organized into user groups and the groups can have roles assigned to them. In the most basic scenario, a user can be assigned either the role of admin or just be a member. When a user has admin privileges within a project, the admin is able to utilize features that can affect the project (such as modifying external networks), whereas a normal <a id="id142" class="calibre1"/>user is assigned the member role. This member role is generally assigned to perform user-related roles, such as spinning up instances, creating volumes, and creating isolated, project-specific networks.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note04" class="calibre1"/>Note</h3><p class="calibre10">Projects used to be called <span class="strong"><strong class="calibre2">tenants</strong></span> in early versions of OpenStack.</p></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Creating OpenStack domains in Keystone" id="12AK81-189e69df43a248268db97cde1b1a8e47"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec33" class="calibre1"/>Creating OpenStack domains in Keystone</h1></div></div></div><p class="calibre10">If you <a id="id143" class="calibre1"/>wish to use more than one domain for your OpenStack deployment, consider using separate domains. Think of domains <a id="id144" class="calibre1"/>as separate accounts or departments in large organizations. For this section, we will create a domain for our project, called <code class="email">bookstore</code>.</p></div>

<div class="book" title="Creating OpenStack domains in Keystone" id="12AK81-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec66" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre10">Ensure that you are logged on to a correctly configured OpenStack client and can access the OpenStack environment as a user with admin privileges.</p><p class="calibre10">Refer to <a class="calibre1" title="Chapter 2. The OpenStack Client" href="part0024_split_000.html#MSDG1-189e69df43a248268db97cde1b1a8e47">Chapter 2</a>, <span class="strong"><em class="calibre18">The OpenStack Client</em></span>, for details of setting up your environment to use OpenStack command-line client.</p></div></div>

<div class="book" title="Creating OpenStack domains in Keystone" id="12AK81-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec67" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre10">To create a domain in our OpenStack environment, perform the following step:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">We start by creating a domain called <code class="email">bookstore</code> as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack domain create --description "Book domain" bookstore</strong></span>
</pre></div><p class="calibre22">The output will look similar to this:</p><div class="mediaobject"><img src="../images/00017.jpeg" alt="How to do it…" class="calibre16"/></div><p class="calibre23"> </p></li></ol><div class="calibre20"/></div></div></div>

<div class="book" title="Creating OpenStack domains in Keystone" id="12AK81-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec68" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre10">In OpenStack, high level identity resources can be grouped under different domains. If you have <a id="id145" class="calibre1"/>to manage distinct organizations within your OpenStack environment, having separate domains for managing them might be very beneficial. By default, your OpenStack environment most likely <a id="id146" class="calibre1"/>has a default domain called "Default." By running the preceding command, we just created an additional domain that can used to manage resources related to this book. The syntax is as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack domain create --description &lt;description&gt; &lt;name&gt;</strong></span>
</pre></div><p class="calibre10">The <code class="email">description</code> parameter is also optional, but highly recommended. The domain name must be unique to other domains in the environment.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note05" class="calibre1"/>Note</h3><p class="calibre10">In our recipes, we will use the <code class="email">--domain</code> parameter and specify a domain name. If the domain is not specified, the OpenStack command-line client will use the domain set for the current user that was specified in the <code class="email">openrc</code> file. Most likely, that will be the <code class="email">default</code> domain.</p></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Enabling domains in the OpenStack dashboard" id="1394Q1-189e69df43a248268db97cde1b1a8e47"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec34" class="calibre1"/>Enabling domains in the OpenStack dashboard</h1></div></div></div><p class="calibre10">If you <a id="id147" class="calibre1"/>are using multiple domains in your OpenStack environment, you will need to enable them in the OpenStack dashboard (Horizon) as well. To do so, the <code class="email">OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT</code> variable in <a id="id148" class="calibre1"/>Horizon settings needs to be set to <code class="email">True</code>. In this example, we will show you how to do so using OpenStack Ansible playbook.</p></div>

<div class="book" title="Enabling domains in the OpenStack dashboard" id="1394Q1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec69" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre10">We are going to use Ansible to update Horizon settings. Make sure that you have access to your <code class="email">openstack-ansible</code> deployment host.</p></div></div>

<div class="book" title="Enabling domains in the OpenStack dashboard" id="1394Q1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec70" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre10">To enable multidomain support in the OpenStack dashboard, we will update one horizon variable, <code class="email">OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT</code> in <code class="email">local_settings.py</code> using the <code class="email">openstack-ansible</code> deployment tool. First, you will need to connect to your <code class="email">openstack-ansible</code> deployment host. Once connected, execute the following steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Edit the <code class="email">/etc/openstack_deploy/user_variables.yml</code> file to add the following line:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">horizon_keystone_multidomain_support: True</strong></span>
</pre></div></li><li class="listitem" value="2">Deploy Horizon with the <code class="email">openstack-ansible</code> command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack-ansible</strong></span>
<span class="strong"><strong class="calibre2"> /opt/openstack-ansible/playbooks/os-horizon-install.yml</strong></span>
</pre></div><p class="calibre22">The <code class="email">openstack-ansible</code> command produces a lot of output. For brevity, its output has been omitted.</p></li><li class="listitem" value="3">Launch the OpenStack dashboard to verify that the login screen now shows domain field:<div class="mediaobject"><img src="../images/00018.jpeg" alt="How to do it…" class="calibre16"/></div><p class="calibre23"> </p></li></ol><div class="calibre20"/></div></div></div>

<div class="book" title="Enabling domains in the OpenStack dashboard" id="1394Q1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec71" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre10">In OpenStack, if you are taking advantage of the multiple domain functionality, you have full control <a id="id149" class="calibre1"/>via command-line tools. However, if you want to be able to use the OpenStack dashboard with multiple domains, you will need to enable Horizon's multidomain support. To do so, you need to update the Horizon <a id="id150" class="calibre1"/>settings file. Since we are using the <code class="email">openstack-ansible</code> tool, we updated the <code class="email">user_variables.yml</code> file and ran the <code class="email">openstack-ansible</code> command. This command updated the required variable and restarted the <code class="email">apache2</code> (HTTP server) services on the Horizon container.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Creating OpenStack projects in Keystone" id="147LC1-189e69df43a248268db97cde1b1a8e47"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec35" class="calibre1"/>Creating OpenStack projects in Keystone</h1></div></div></div><p class="calibre10">Users can't <a id="id151" class="calibre1"/>be created without having a project assigned to them, so these must be created first. For this section, we will create a project <a id="id152" class="calibre1"/>for our users, called <code class="email">cookbook</code>.</p></div>

<div class="book" title="Creating OpenStack projects in Keystone" id="147LC1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec72" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre10">Ensure that you are logged on to a correctly configured OpenStack client and can access the OpenStack environment as a user with admin privileges.</p><p class="calibre10">Refer to <a class="calibre1" title="Chapter 2. The OpenStack Client" href="part0024_split_000.html#MSDG1-189e69df43a248268db97cde1b1a8e47">Chapter 2</a>, <span class="strong"><em class="calibre18">The OpenStack Client</em></span>, for details of setting up your environment to use OpenStack command-line client.</p></div></div>

<div class="book" title="Creating OpenStack projects in Keystone" id="147LC1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec73" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre10">To create a project in our OpenStack environment, perform the following steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">We start by creating a project called <code class="email">cookbook</code> as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack project create --domain bookstore</strong></span>
<span class="strong"><strong class="calibre2">    --description "Cookbook Project" cookbook</strong></span>
</pre></div><p class="calibre22">The command should produce the output similar to this:</p><div class="mediaobject"><img src="../images/00019.jpeg" alt="How to do it…" class="calibre16"/></div><p class="calibre23"> </p></li></ol><div class="calibre20"/></div></div></div>

<div class="book" title="Creating OpenStack projects in Keystone" id="147LC1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec74" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre10">By running <a id="id153" class="calibre1"/>the preceding command, we just <a id="id154" class="calibre1"/>created a project in our <code class="email">bookstore</code> domain. The syntax is as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack project create --domain &lt;domain&gt;</strong></span>
<span class="strong"><strong class="calibre2">    --description &lt;description&gt; &lt;name&gt;</strong></span>
</pre></div><p class="calibre10">The <code class="email">domain</code> parameter is optional, used to determine which domain the project will belong to. If omitted, the project will be created in the <code class="email">default</code> domain. The <code class="email">description</code> parameter is also optional, but highly recommended. The <code class="email">name</code> parameter has to be unique to the installation.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Configuring roles in Keystone" id="1565U1-189e69df43a248268db97cde1b1a8e47"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec36" class="calibre1"/>Configuring roles in Keystone</h1></div></div></div><p class="calibre10">Roles are <a id="id155" class="calibre1"/>the permissions given to users within a project. Roles <a id="id156" class="calibre1"/>can also be scoped to a particular domain, making it possible to restrict permissions for particular users to a domain and project. If you used Ansible to install your OpenStack environment, it should already contain some default roles, such as <code class="email">admin</code> and <code class="email">_member_</code>. Here we will configure one role, a <code class="email">cloud_admin</code> role that allows for administration of our example <code class="email">bookstore</code> domain environment and a <code class="email">user</code> role for the <code class="email">default</code> domain that is given to ordinary users who will be using the cloud environment.</p></div>

<div class="book" title="Configuring roles in Keystone" id="1565U1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec75" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre10">Ensure that <a id="id157" class="calibre1"/>you are logged on to a correctly configured <a id="id158" class="calibre1"/>OpenStack client and can access the OpenStack environment as a user with admin privileges.</p><p class="calibre10">Refer to <a class="calibre1" title="Chapter 2. The OpenStack Client" href="part0024_split_000.html#MSDG1-189e69df43a248268db97cde1b1a8e47">Chapter 2</a>, <span class="strong"><em class="calibre18">The OpenStack Client</em></span>, for details of setting up your environment to use OpenStack command-line client.</p></div></div>

<div class="book" title="Configuring roles in Keystone" id="1565U1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec76" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre10">To create the required roles in our OpenStack environment, perform the following steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Creation of the <code class="email">cloud_admin</code> role is done as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack role create --domain bookstore cloud_admin:</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00020.jpeg" alt="How to do it…" class="calibre16"/></div><p class="calibre23"> </p></li><li class="listitem" value="2">To configure the <code class="email">user</code> role for the <code class="email">default</code> domain, execute the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack role create user</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00021.jpeg" alt="How to do it…" class="calibre16"/></div><p class="calibre23"> </p><p class="calibre22">This command created a new role called <code class="email">user</code>. Since we didn't specify a domain, it was created under the <code class="email">default</code> domain.</p></li><li class="listitem" value="3">View roles <a id="id159" class="calibre1"/>associated with the <code class="email">bookstore</code> domain:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack role list --domain bookstore</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00022.jpeg" alt="How to do it…" class="calibre16"/></div><p class="calibre23"> </p></li><li class="listitem" value="4">List roles <a id="id160" class="calibre1"/>associated with the current admin user:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack role list</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00023.jpeg" alt="How to do it…" class="calibre16"/></div><p class="calibre23"> </p></li></ol><div class="calibre20"/></div></div></div>

<div class="book" title="Configuring roles in Keystone" id="1565U1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec77" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre10">Creation of <a id="id161" class="calibre1"/>roles is simply achieved using the OpenStack client, specifying the <code class="email">role create</code> option with the following syntax:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack role create --domain &lt;domain_name&gt; &lt;role_name&gt;</strong></span>
</pre></div><p class="calibre10">The <code class="email">domain_name</code> attribute is optional, if you omit it, a role for the <code class="email">default</code> domain will be created.</p><p class="calibre10">For the <code class="email">role_name</code> attribute, the <code class="email">admin</code> and <code class="email">_member_</code> roles names cannot be used again. The <code class="email">admin</code> role is set by default in OpenStack code starting with the Pike release, and in releases <a id="id162" class="calibre1"/>before Pike in the <code class="email">/etc/keystone/policy.json</code> file, as having administrative rights:</p><div class="informalexample"><pre class="programlisting">{
    "admin_required": "role:admin or is_admin:1",
}</pre></div><p class="calibre10">The <code class="email">_member_</code> role is also configured by default in the dashboard when a nonadmin user is created through the web interface.</p><p class="calibre10">On creation of the role, the ID associated with the role is returned, and we can use it when assigning roles to users. To see a list of roles and the associated IDs in our environment, we can issue the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack role list --domain &lt;domain_name&gt;</strong></span>
</pre></div><div class="informalexample" title="Note"><h3 class="title2"><a id="note06" class="calibre1"/>Note</h3><p class="calibre10">If the <code class="email">domain</code> parameter is not specified, you will see roles associated only with your current user's domain.</p></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Adding users in Keystone"><div class="book" id="164MG2-189e69df43a248268db97cde1b1a8e47"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec37" class="calibre1"/>Adding users in Keystone</h1></div></div></div><p class="calibre10">Adding <a id="id163" class="calibre1"/>users to OpenStack Identity service requires the user to belong to a domain or a project in the domain and to be assigned a role defined <a id="id164" class="calibre1"/>in the domain or the project. For this section, we will create two users. The first user will be named <code class="email">cloud_admin</code> and will have the <code class="email">cloud_admin</code> role assigned to them in the <code class="email">cookbook</code> project. The second user will be named <code class="email">reader</code> and will have the default <code class="email">_member_</code> role assigned to them in the same <code class="email">cookbook</code> project.</p></div>

<div class="book" title="Adding users in Keystone">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec78" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre10">Ensure that you are logged on to a correctly configured OpenStack client and can access the OpenStack environment as a user with admin privileges.</p><p class="calibre10">Refer to <a class="calibre1" title="Chapter 2. The OpenStack Client" href="part0024_split_000.html#MSDG1-189e69df43a248268db97cde1b1a8e47">Chapter 2</a>, <span class="strong"><em class="calibre18">The OpenStack Client</em></span>, for details of setting up your environment to use OpenStack command-line client.</p></div></div>

<div class="book" title="Adding users in Keystone">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec79" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre10">In order to create a user in OpenStack and assign roles to it, we will need to execute the commands listed below.</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">First, get the <code class="email">bookstore</code> domain ID or domain name:<div class="mediaobject"><img src="../images/00024.jpeg" alt="How to do it…" class="calibre16"/></div><p class="calibre23"> </p></li><li class="listitem" value="2">Using the <code class="email">bookstore</code> domain name, create a new <code class="email">cloud_admin</code> user:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack user create --domain bookstore</strong></span>
<span class="strong"><strong class="calibre2">    --password verysecret</strong></span>
<span class="strong"><strong class="calibre2">    cloud_admin</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00025.jpeg" alt="How to do it…" class="calibre16"/></div><p class="calibre23"> </p></li><li class="listitem" value="3">Next, get <a id="id165" class="calibre1"/>a cookbook project ID or project name:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack project list</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00026.jpeg" alt="How to do it…" class="calibre16"/></div><p class="calibre23"> </p></li><li class="listitem" value="4">Create <a id="id166" class="calibre1"/>the <code class="email">reader</code> user in the <code class="email">bookstore</code> domain <code class="email">cookbook</code> project:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack user create --domain bookstore</strong></span>
<span class="strong"><strong class="calibre2">    --project cookbook</strong></span>
<span class="strong"><strong class="calibre2">    --password verysecret</strong></span>
<span class="strong"><strong class="calibre2">    reader</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00027.jpeg" alt="How to do it…" class="calibre16"/></div><p class="calibre23"> </p></li><li class="listitem" value="5">Assign <code class="email">cloud_admin</code> user to the <code class="email">admin</code> role:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack role add --domain bookstore</strong></span>
<span class="strong"><strong class="calibre2">    --user cloud_admin</strong></span>
<span class="strong"><strong class="calibre2">    --role-domain bookstore</strong></span>
<span class="strong"><strong class="calibre2">    admin</strong></span>
</pre></div><p class="calibre22">There is no output from this command.</p></li><li class="listitem" value="6">Assign <a id="id167" class="calibre1"/>the <code class="email">reader</code> user to the <code class="email">_member_</code> role:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack role add --project cookbook</strong></span>
<span class="strong"><strong class="calibre2">    --user reader _member_</strong></span>
</pre></div><p class="calibre22">There is no output from this command.</p></li><li class="listitem" value="7">List <a id="id168" class="calibre1"/>user and role assignment:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack role assignment list</strong></span>
</pre></div><p class="calibre22">The output will be a matrix of role, user, group, project, and domain IDs. We omit the example output due to sheer size of the table that contains a matrix of IDs for each role, user, group, project, domain, and whether the role was inherited.</p></li></ol><div class="calibre20"/></div></div></div>

<div class="book" title="Adding users in Keystone">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec80" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre10">Adding users in the OpenStack Identity service involves a number of steps and dependencies. First, a domain and a project are required for the user to be part of. A user must always belong to a domain. If there are no custom domains created, a <code class="email">default</code> domain will be used. Once the project exists, the user can be added. At this point, the user has no role associated, so the final step is to assign the role to this user, such as <code class="email">_member_,</code> <code class="email">admin</code>, or a custom role.</p><p class="calibre10">To create <a id="id169" class="calibre1"/>a user with the <code class="email">user create</code> option, the syntax is as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack user create --domain &lt;domain&gt;</strong></span>
<span class="strong"><strong class="calibre2">    --password &lt;password&gt; &lt;user_name&gt;</strong></span>
</pre></div><p class="calibre10">The <code class="email">user_name</code> attribute is an arbitrary name, but cannot contain any spaces. A <code class="email">password</code> attribute must be present. In the previous examples, these were set to <code class="email">verysecret</code>. If the <code class="email">domain</code> attribute is not specified, the <code class="email">default</code> domain will be set.</p><p class="calibre10">To assign a role to a user with the <code class="email">role add</code> option, the syntax is as follows for the <code class="email">default</code> domain:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack role add --project &lt;project&gt;</strong></span>
<span class="strong"><strong class="calibre2">    --user &lt;user&gt;</strong></span>
<span class="strong"><strong class="calibre2">    &lt;role&gt;</strong></span>
</pre></div><p class="calibre10">For a user <a id="id170" class="calibre1"/>in a custom domain, use the following syntax to assign a role:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack role add --domain &lt;domain&gt;</strong></span>
<span class="strong"><strong class="calibre2">    --user &lt;user&gt;</strong></span>
<span class="strong"><strong class="calibre2">    --role-domain &lt;role_domain&gt;</strong></span>
<span class="strong"><strong class="calibre2">    &lt;role&gt;</strong></span>
</pre></div><p class="calibre10">The <code class="email">role_domain</code> parameter is the name (or ID) of the domain to which the role belongs.</p><p class="calibre10">We will also need to have the names or IDs of the user, role, and project in order to assign roles to users. These names or IDs can be found using the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack project list</strong></span>
<span class="strong"><strong class="calibre2">    openstack user list</strong></span>
<span class="strong"><strong class="calibre2">    openstack role list</strong></span>
</pre></div><p class="calibre10">The <code class="email">--domain &lt;domain&gt;</code> option is only required if custom domains are used. To obtain a list of domains, issue the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack domain list </strong></span>
</pre></div><p class="calibre10">To get a matrix of domain, project, user, and role assignments, use the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack </strong></span>
<span class="strong"><strong class="calibre2">role assignment list</strong></span>
</pre></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Configuring groups in Keystone"><div class="book" id="173722-189e69df43a248268db97cde1b1a8e47"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec38" class="calibre1"/>Configuring groups in Keystone</h1></div></div></div><p class="calibre10">If you <a id="id171" class="calibre1"/>wish to organize users by their roles, you can create a user group using Keystone groups. Groups are owned by a domain. In this example, we will create one group, <code class="email">reader_group</code>, and set a <code class="email">cloud_admin</code> role to it. We will <a id="id172" class="calibre1"/>also add two users to it, <code class="email">reader</code> and <code class="email">reader1</code>. We will also verify that the users belong to the group, as well as remove one of the users afterwards.</p></div>

<div class="book" title="Configuring groups in Keystone">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec81" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre10">Ensure that you are logged on to a correctly configured OpenStack client and can access the OpenStack environment as a user with admin privileges.</p><p class="calibre10">Refer to <a class="calibre1" title="Chapter 2. The OpenStack Client" href="part0024_split_000.html#MSDG1-189e69df43a248268db97cde1b1a8e47">Chapter 2</a>, <span class="strong"><em class="calibre18">The OpenStack Client</em></span>, for details of setting up your environment to use OpenStack command-line client.</p></div></div>

<div class="book" title="Configuring groups in Keystone">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec82" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre10">In order to create groups and assign users to them, we will need to execute the following steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Start by creating a group:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack group create --domain bookstore</strong></span>
<span class="strong"><strong class="calibre2">    --description "Bookstore reader group"</strong></span>
<span class="strong"><strong class="calibre2">    reader_group</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00028.jpeg" alt="How to do it…" class="calibre16"/></div><p class="calibre23"> </p></li><li class="listitem" value="2">List existing groups:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack group list</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00029.jpeg" alt="How to do it…" class="calibre16"/></div><p class="calibre23"> </p></li><li class="listitem" value="3">Add group to the role:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack role add --group reader_group</strong></span>
<span class="strong"><strong class="calibre2">    --domain bookstore</strong></span>
<span class="strong"><strong class="calibre2">    --role-domain bookstore</strong></span>
<span class="strong"><strong class="calibre2">    cloud_admin</strong></span>
</pre></div><p class="calibre22">Both the <code class="email">--domain</code> and <code class="email">--role-domain</code> parameters are needed. There is no output to this command.</p></li><li class="listitem" value="4">Add the <code class="email">reader</code> user to the group:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack group add user --group-domain bookstore</strong></span>
<span class="strong"><strong class="calibre2">    --user-domain bookstore</strong></span>
<span class="strong"><strong class="calibre2">    reader_group</strong></span>
<span class="strong"><strong class="calibre2">    reader</strong></span>
</pre></div><p class="calibre22">This produces a message like the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">reader added to group reader_group</strong></span>
</pre></div></li><li class="listitem" value="5">Add the <code class="email">reader1</code> user to the group:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack group add user --group-domain bookstore</strong></span>
<span class="strong"><strong class="calibre2">    --user-domain bookstore</strong></span>
<span class="strong"><strong class="calibre2">    reader_group</strong></span>
<span class="strong"><strong class="calibre2">    reader1</strong></span>
</pre></div><p class="calibre22">This should output the following message:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">reader1 added to group reader_group</strong></span>
</pre></div></li><li class="listitem" value="6">Check <a id="id173" class="calibre1"/>that <code class="email">reader</code> is in the <code class="email">reader_group</code> group:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack group contains user reader_group reader</strong></span>
</pre></div><p class="calibre22">This should output the following message:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">reader in group reader_group</strong></span>
</pre></div></li><li class="listitem" value="7">Check <a id="id174" class="calibre1"/>that <code class="email">reader1</code> is in the <code class="email">reader_group</code> group:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack group contains user readergroup reader1</strong></span>
</pre></div><p class="calibre22">This produces a message like the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">reader1 in group readergroup</strong></span>
</pre></div></li><li class="listitem" value="8">Remove the <code class="email">reader1</code> user from the <code class="email">reader_group</code> group:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack group remove user reader_group reader1</strong></span>
</pre></div><p class="calibre22">This produces a message like the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">reader1 removed from group reader_group</strong></span>
</pre></div></li><li class="listitem" value="9">Check again whether <code class="email">reader1</code> is in the <code class="email">reader_group</code> group:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack group contains user reader_group reader1</strong></span>
</pre></div><p class="calibre22">This produces a message like the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">reader1 not</strong></span>
<span class="strong"><strong class="calibre2"> in group reader_group</strong></span>
</pre></div></li></ol><div class="calibre20"/></div></div></div>

<div class="book" title="Configuring groups in Keystone">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec83" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre10">Adding users <a id="id175" class="calibre1"/>to identity groups is a good way to grant them specific set of roles without individually assigning each role to a user. If you have to manage users that always get the same set of roles, you can create a user group <a id="id176" class="calibre1"/>and add or remove users as needed, rather than setting individual roles to each user. Roles are assigned to the group in a similar fashion that they are assigned to the user. In our example, we first created a custom group, <code class="email">reader_group</code>. The command for creating groups is as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack group create --domain &lt;domain-name&gt; </strong></span>
<span class="strong"><strong class="calibre2">    --description &lt;group-description&gt;</strong></span>
<span class="strong"><strong class="calibre2">    &lt;group-name&gt;</strong></span>
</pre></div><p class="calibre10">Since we are using a custom domain in our example, <code class="email">&lt;domain-name&gt;</code> is needed. However, if <code class="email">&lt;domain-name&gt;</code> is omitted, domain for the current user will be used.</p><div class="book" title="Add group to a role:"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch03lvl3sec29" class="calibre1"/>Add group to a role:</h3></div></div></div><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack role add --group &lt;group&gt;</strong></span>
<span class="strong"><strong class="calibre2">    --domain &lt;domain&gt;</strong></span>
<span class="strong"><strong class="calibre2">    --role-domain &lt;role_domain&gt;</strong></span>
<span class="strong"><strong class="calibre2">    &lt;role&gt;</strong></span>
</pre></div><p class="calibre10">The <code class="email">role_domain</code> parameter is the name (or ID) of the domain to which the role belongs.</p><p class="calibre10">We will <a id="id177" class="calibre1"/>also need to have the name of the group, the name of the role, and the name of the project in order to assign roles to users. These names can be found using the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack project list</strong></span>
<span class="strong"><strong class="calibre2">    openstack group list</strong></span>
<span class="strong"><strong class="calibre2">    openstack role list</strong></span>
</pre></div><p class="calibre10">Pass <code class="email">--domain &lt;domain&gt;</code> as an option to the preceding commands if you have custom domains. To obtain a list of domains:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack domain list</strong></span>
</pre></div><p class="calibre10">To add a user to the group, use the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack group add user --group-domain &lt;group_domain&gt;</strong></span>
<span class="strong"><strong class="calibre2">    --user-domain &lt;user_domain&gt;</strong></span>
<span class="strong"><strong class="calibre2">    &lt;group&gt;</strong></span>
<span class="strong"><strong class="calibre2">    &lt;user&gt;</strong></span>
</pre></div><p class="calibre10">To remove a user from the group, execute the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack group remove user &lt;group&gt; &lt;user&gt;</strong></span>
</pre></div><p class="calibre10">To verify <a id="id178" class="calibre1"/>if the user belongs to the group, use this command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack group contains user &lt;group&gt; &lt;user&gt;</strong></span>
</pre></div><p class="calibre10">To get a matrix of domain, project, user, group, and role assignments, use the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack role assignment list</strong></span>
</pre></div><p class="calibre10">You can also use IDs instead of names for projects for all of the preceding commands instead of names.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note07" class="calibre1"/>Note</h3><p class="calibre10">Groups were introduced in Keystone v3.</p></div></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Deleting projects" id="181NK1-189e69df43a248268db97cde1b1a8e47"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec39" class="calibre1"/>Deleting projects</h1></div></div></div><p class="calibre10">Projects <a id="id179" class="calibre1"/>can be deleted even if they have users associated with them, so be sure to delete users and other project assets before deleting a project, otherwise you risk having orphaned resources. In this example, we will show how to delete a project named <code class="email">oldbook</code>.</p></div>

<div class="book" title="Deleting projects" id="181NK1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec84" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre10">Ensure that you are logged on to a correctly configured OpenStack client and can access the OpenStack environment as a user with admin privileges.</p><p class="calibre10">Refer to <a class="calibre1" title="Chapter 2. The OpenStack Client" href="part0024_split_000.html#MSDG1-189e69df43a248268db97cde1b1a8e47">Chapter 2</a>, <span class="strong"><em class="calibre18">The OpenStack Client</em></span>, for details of setting up your environment to use OpenStack command-line client.</p></div></div>

<div class="book" title="Deleting projects" id="181NK1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec85" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre10">In order to delete a project, execute the following commands:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Get the project's name from a current project list:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack project list</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00030.jpeg" alt="How to do it…" class="calibre16"/></div><p class="calibre23"> </p></li><li class="listitem" value="2">Delete the project:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack project delete oldbook</strong></span>
</pre></div><p class="calibre22">This command will have no output.</p></li></ol><div class="calibre20"/></div></div></div>

<div class="book" title="Deleting projects" id="181NK1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec86" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre10">Deleting <a id="id180" class="calibre1"/>unnecessary projects is simple when using OpenStack command-line tool. Be sure to delete only empty projects. Start with a command to get existing projects:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack project list</strong></span>
</pre></div><p class="calibre10">Delete a project by executing the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack project delete &lt;project&gt;</strong></span>
</pre></div><p class="calibre10">Here, the <code class="email">&lt;project&gt;</code> parameter can be either project ID or project name.</p><p class="calibre10">If project has users assigned, they will not be deleted, but the project will be.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Deleting users" id="190861-189e69df43a248268db97cde1b1a8e47"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec40" class="calibre1"/>Deleting users</h1></div></div></div><p class="calibre10">Removing <a id="id181" class="calibre1"/>users from OpenStack Identity is a simple one step process. In this example, we will show how to delete a user named <code class="email">oldreader</code>.</p></div>

<div class="book" title="Deleting users" id="190861-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec87" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre10">Ensure that you are logged on to a correctly configured OpenStack client and can access the OpenStack environment as a user with admin privileges.</p><p class="calibre10">Refer to <a class="calibre1" title="Chapter 2. The OpenStack Client" href="part0024_split_000.html#MSDG1-189e69df43a248268db97cde1b1a8e47">Chapter 2</a>, <span class="strong"><em class="calibre18">The OpenStack Client</em></span>, for details of setting up your environment to use OpenStack command-line client.</p></div></div>

<div class="book" title="Deleting users" id="190861-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec88" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre10">In order <a id="id182" class="calibre1"/>to delete a user, execute the following commands:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Get the user's name from the users in a current domain:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack user list</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00031.jpeg" alt="How to do it…" class="calibre16"/></div><p class="calibre23"> </p></li><li class="listitem" value="2">Delete the <code class="email">oldreader</code> user:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack user delete oldreader</strong></span>
</pre></div><p class="calibre22">This command will have no output.</p></li></ol><div class="calibre20"/></div></div></div>

<div class="book" title="Deleting users" id="190861-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec89" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre10">Deleting unnecessary users is simple when using OpenStack command-line tool. Start with a command to get existing users:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack user list</strong></span>
</pre></div><p class="calibre10">Delete a <a id="id183" class="calibre1"/>user by executing the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack user delete &lt;user&gt;</strong></span>
</pre></div><p class="calibre10">Here the <code class="email">&lt;user&gt;</code> parameter can be either user ID or username.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Deleting roles" id="19UOO1-189e69df43a248268db97cde1b1a8e47"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec41" class="calibre1"/>Deleting roles</h1></div></div></div><p class="calibre10">Removing <a id="id184" class="calibre1"/>roles from the OpenStack Identity is a simple one step. In this example, we will show how to delete a role named <code class="email">oldrole</code>.</p></div>

<div class="book" title="Deleting roles" id="19UOO1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec90" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre10">Ensure that you are logged on to a correctly configured OpenStack client and can access the OpenStack environment as a user with admin privileges.</p><p class="calibre10">Refer to <a class="calibre1" title="Chapter 2. The OpenStack Client" href="part0024_split_000.html#MSDG1-189e69df43a248268db97cde1b1a8e47">Chapter 2</a>, <span class="strong"><em class="calibre18">The OpenStack Client</em></span>, for details of setting up your environment to use OpenStack command-line client.</p></div></div>

<div class="book" title="Deleting roles" id="19UOO1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec91" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre10">In order to delete a role, execute the following commands:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Get the role's name from a current role list:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack role list</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00032.jpeg" alt="How to do it…" class="calibre16"/></div><p class="calibre23"> </p></li><li class="listitem" value="2">Delete the <code class="email">oldrole</code> role:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack role delete oldrole</strong></span>
</pre></div><p class="calibre22">This command will have no output.</p></li></ol><div class="calibre20"/></div></div></div>

<div class="book" title="Deleting roles" id="19UOO1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec92" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre10">Deleting <a id="id185" class="calibre1"/>unnecessary roles is simple when using OpenStack command-line tool. Start with a command to get an existing role:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack role list</strong></span>
</pre></div><p class="calibre10">Delete a role by executing the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack role delete &lt;role&gt;</strong></span>
</pre></div><p class="calibre10">Here the <code class="email">&lt;role&gt;</code> parameter can be either role ID or role name.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Deleting groups" id="1AT9A1-189e69df43a248268db97cde1b1a8e47"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec42" class="calibre1"/>Deleting groups</h1></div></div></div><p class="calibre10">Removing <a id="id186" class="calibre1"/>user groups from the OpenStack Identity service is a simple one step. In this example, we will show how to delete a group named <code class="email">oldgroup</code>. Note that when you delete a group, it doesn't delete the users assigned to the group. The role and group permission mappings will be gone, and as a result, users may lose permissions.</p></div>

<div class="book" title="Deleting groups" id="1AT9A1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec93" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre10">Ensure that you are logged on to a correctly configured OpenStack client and can access the OpenStack environment as a user with admin privileges.</p><p class="calibre10">Refer to <a class="calibre1" title="Chapter 2. The OpenStack Client" href="part0024_split_000.html#MSDG1-189e69df43a248268db97cde1b1a8e47">Chapter 2</a>, <span class="strong"><em class="calibre18">The OpenStack Client</em></span>, for details of setting up your environment to use OpenStack command-line client.</p></div></div>

<div class="book" title="Deleting groups" id="1AT9A1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec94" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre10">In order to delete a user group, execute the following commands:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Get the group's name from a current group list:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack group list</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00033.jpeg" alt="How to do it…" class="calibre16"/></div><p class="calibre23"> </p></li><li class="listitem" value="2">Delete the <code class="email">oldgroup</code> group:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack group delete oldgroup</strong></span>
</pre></div><p class="calibre22">This command will have no output.</p></li></ol><div class="calibre20"/></div></div></div>

<div class="book" title="Deleting groups" id="1AT9A1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec95" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre10">Deleting unnecessary groups is simple when using OpenStack command-line tool. Start with a command to get existing group:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack group list</strong></span>
</pre></div><p class="calibre10">Delete a group by executing the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack group delete &lt;group&gt;</strong></span>
</pre></div><p class="calibre10">Here the <code class="email">&lt;group&gt;</code> parameter can be either group ID or group name.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Deleting domains" id="1BRPS1-189e69df43a248268db97cde1b1a8e47"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec43" class="calibre1"/>Deleting domains</h1></div></div></div><p class="calibre10">Keystone <a id="id187" class="calibre1"/>domains can be deleted if there are no users associated with them. If there are any users associated with the domain when trying to delete it, an error will be shown. In this example, we will show how to delete a domain that is no longer being used, called <code class="email">olddomain</code>.</p></div>

<div class="book" title="Deleting domains" id="1BRPS1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec96" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre10">Ensure that you are logged on to a correctly configured OpenStack client and can access the OpenStack environment as a user with admin privileges.</p><p class="calibre10">Refer to <a class="calibre1" title="Chapter 2. The OpenStack Client" href="part0024_split_000.html#MSDG1-189e69df43a248268db97cde1b1a8e47">Chapter 2</a>, <span class="strong"><em class="calibre18">The OpenStack Client</em></span>, for details of setting up your environment to use OpenStack command-line client.</p></div></div>

<div class="book" title="Deleting domains" id="1BRPS1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec97" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre10">In order <a id="id188" class="calibre1"/>to delete a domain, execute the following commands:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Get the domain's name from a current domain list:<div class="mediaobject"><img src="../images/00034.jpeg" alt="How to do it…" class="calibre16"/></div><p class="calibre23"> </p></li><li class="listitem" value="2">Verify that there are no users associated with the <code class="email">olddomain</code> domain that we will be deleting:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack user list --domain olddomain</strong></span>
</pre></div><p class="calibre22">This list should be empty before proceeding. If it is not, delete all the users before proceeding to the next step.</p></li><li class="listitem" value="3">Disable the domain:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack domain set --disable  olddomain</strong></span>
</pre></div><p class="calibre22">This command will have no output.</p></li><li class="listitem" value="4">Delete domain:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack domain delete olddomain</strong></span>
</pre></div><p class="calibre22">If successful, this command will have no output.</p></li></ol><div class="calibre20"/></div></div></div>

<div class="book" title="Deleting domains" id="1BRPS1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec98" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre10">Deleting unnecessary domains requires that domains have no users associated with them.</p><p class="calibre10">Verify that there are no users attached to this domain:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack user list --domain &lt;domain&gt;</strong></span>
</pre></div><p class="calibre10">Deleting a <a id="id189" class="calibre1"/>domain requires that it first be disabled. A domain can be disabled even if there are users attached to it:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack domain set --disable  &lt;domain&gt;</strong></span>
</pre></div><p class="calibre10">Only after a domain is disabled and no longer has any users associated with it, will you be able to delete a domain:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack domain delete &lt;domain&gt;</strong></span>
</pre></div><p class="calibre10">If you need to delete users, refer to the <span class="strong"><em class="calibre18">Deleting users</em></span> recipe, earlier in this chapter.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="OpenStack endpoint information" id="1CQAE1-189e69df43a248268db97cde1b1a8e47"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec44" class="calibre1"/>OpenStack endpoint information</h1></div></div></div><p class="calibre10">If you need <a id="id190" class="calibre1"/>to find out the endpoint information for different OpenStack services, or the services running on the OpenStack installation, use the OpenStack service catalog. If you need to automate any OpenStack tasks or are integrating any other tools with OpenStack, catalog will also come in handy. The catalog lists services and endpoint information for each of them. The catalog may be different for each deployment.</p></div>

<div class="book" title="OpenStack endpoint information" id="1CQAE1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec99" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre10">Ensure that you are logged on to a correctly configured OpenStack client and can access the OpenStack environment as a user with admin privileges.</p><p class="calibre10">Refer to <a class="calibre1" title="Chapter 2. The OpenStack Client" href="part0024_split_000.html#MSDG1-189e69df43a248268db97cde1b1a8e47">Chapter 2</a>, <span class="strong"><em class="calibre18">The OpenStack Client</em></span>, for details of setting up your environment to use OpenStack command-line client.</p></div></div>

<div class="book" title="OpenStack endpoint information" id="1CQAE1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec100" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre10">To list OpenStack catalog information, execute the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack catalog list</strong></span>
</pre></div></div></div>

<div class="book" title="OpenStack endpoint information" id="1CQAE1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec101" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre10">In OpenStack, different <a id="id191" class="calibre1"/>service API endpoints can be found out using the OpenStack catalog. The catalog will list all the OpenStack services that it knows about and their respective internal, admin, and public URLs. The catalog <a id="id192" class="calibre1"/>is also handy if you are trying to automate any of the OpenStack tasks. On the <span class="strong"><strong class="calibre2">Command-Line Interface</strong></span> (<span class="strong"><strong class="calibre2">CLI</strong></span>), list the available endpoints by running the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack catalog list</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00035.jpeg" alt="How it works…" class="calibre16"/></div><p class="calibre17"> </p><p class="calibre10">The output from our <code class="email">catalog</code> command has been trunkated for this example. The full catalog command will list all the installed services.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note08" class="calibre1"/>Note</h3><p class="calibre10">The service catalog will be different for each OpenStack installation.</p></div></div></div></body></html>