<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Chapter&#xA0;2.&#xA0;Getting the Cloud Fabric Ready"><div class="book" id="LTSU2-b479cf466c26404ca54119871a9b2715"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02" class="calibre1"/>Chapter 2. Getting the Cloud Fabric Ready</h1></div></div></div><p class="calibre8">Fabric is one of the most important and crucial part of any traditional data center or cloud solution. Cloud fabric essentially includes, but is not limited to compute, network, storage, and hypervisors. Well designed and deployed fabric infrastructure is the way towards smooth operations of any cloud or traditional data center. In this chapter, we will cover all aspects of planning and deploying cloud fabric for our Windows Azure Pack-based cloud solution. It will help you understand fabric requirements and deployment practices for a WAP-based cloud solution. We will also include installation and configuration of major components such as SQL DB, SCVMM, SPF, and so on. We will be covering planning guidelines for both organizations' private cloud as well as for service providers' cloud. This fabric infrastructure will be used to deliver IaaS services in our WAP cloud.</p><p class="calibre8">We will cover the following topics in this chapter:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Cloud fabric infrastructure planning</li><li class="listitem">Hyper-V deployment best practices</li><li class="listitem">Setting up virtual machines for cloud management fabric</li><li class="listitem">Planning and deploying SQL Server for cloud management DB</li><li class="listitem">Installing and configuring <span class="strong"><strong class="calibre9">System Center Virtual Machine Manager</strong></span> (<span class="strong"><strong class="calibre9">SCVMM</strong></span>)</li><li class="listitem">Planning and configuring cloud compute hypervisor layer with SCVMM</li><li class="listitem">Planning and configuring cloud network with SCVMM</li><li class="listitem">Planning and configuring cloud storage with SCVMM</li><li class="listitem">Planning and deploying System Center Service Provider Foundation</li></ul></div></div>

<div class="book" title="Chapter&#xA0;2.&#xA0;Getting the Cloud Fabric Ready">
<div class="book" title="Cloud fabric infrastructure planning"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch02lvl1sec16" class="calibre1"/>Cloud fabric infrastructure planning</h1></div></div></div><p class="calibre8">Planning a<a id="id145" class="calibre1"/> cloud fabric infrastructure involves practice and involvement of business and technical decision makers. Cloud fabric has to be planned in such a manner that ensures that services are available for the business in a reliable and efficient manner. Current infrastructure assessment, forecasting and future resource planning, cloud service catalogues, along with strategic vision and financials are the key facts to consider while planning for cloud infrastructure. Let's have a look at the foundation and basic principles for planning a WAP-based cloud fabric infrastructure for delivering IaaS services.</p></div></div>

<div class="book" title="Chapter&#xA0;2.&#xA0;Getting the Cloud Fabric Ready">
<div class="book" title="Cloud fabric infrastructure planning">
<div class="book" title="Choosing the hardware"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch02lvl2sec20" class="calibre1"/>Choosing the hardware</h2></div></div></div><p class="calibre8">While choosing hardware for your cloud infrastructure, there is a long list of precautions to be taken care of. The following <a id="id146" class="calibre1"/>are some of these precautions:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Follow the Microsoft certified hardware and software supportability and compatibility list. It is not a mandatory requirement as a WAP-based solution can be installed on almost any x86 based virtualization supported hardware, however, it is recommended to go with Microsoft certified hardware to avoid any glitches at a later stage in production. Getting support could be challenging sometimes while using non-supported hardware.</li><li class="listitem">While going for commodity hardware, check for compatibility and features of individual pieces of server such as NIC cards and so on.</li><li class="listitem">Use latest hardware supporting new features such as RDMA and other hardware offloading capabilities to take advantage of all capabilities of your hypervisor and cloud layer.</li><li class="listitem">Check for the scalability flexibilities, sufficient number of processors, memory, PCI slots can be helpful in increasing resources as and when required.</li><li class="listitem">Hardware failure happens, it's a good idea to check for hardware vendor support and SLAs in case of hardware failure part replacement and more.</li><li class="listitem">While comparing multiple hardware options for your cloud, include data center physical requirements (space, power, cooling, and so on) as one of the parameters, physical requirements usually become constraints in the real world.</li></ul></div><p class="calibre8">While all preceding points are valid, today's data center technologies trends include software defined strategy. Using commodity hardware with best of breed software runs the data centers. It is fairly possible and good to use commodity hardware in your WAP cloud solution, though building the commodity hardware has to be planned very carefully.</p><p class="calibre8">For example, using non-supported disk drives leads to IOPS related performance issues, and the same goes for NIC speed and features. Follow the industry best practice guideline along with Microsoft Hyper-V compatibility and features support while designing commodity hardware.</p><p class="calibre8">Choosing a combination of both proprietary and commodity hardware is also not uncommon; organizations can choose to run critical workload on proprietary hardware to ensure performance and support, whereas use commodity hardware for less critical or test and development workloads.</p><p class="calibre8">Enabling commodity<a id="id147" class="calibre1"/> hardware options is helping small and midsized businesses (SMBs) to utilize enterprise class virtualization and cloud technologies for their IT needs in a limited budget. The same goes for the cloud service providers, small vendors with budget constraints can also get into the cloud services market using commodity hardware.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip06" class="calibre1"/>Tip</h3><p class="calibre8">The Microsoft supportability<a id="id148" class="calibre1"/> and compatibility list can be accessed at <a class="calibre1" href="https://www.windowsservercatalog.com/">https://www.windowsservercatalog.com/</a>.</p></div></div></div></div>

<div class="book" title="Chapter&#xA0;2.&#xA0;Getting the Cloud Fabric Ready">
<div class="book" title="Cloud fabric infrastructure planning">
<div class="book" title="Sizing the hardware"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch02lvl2sec21" class="calibre1"/>Sizing the hardware</h2></div></div></div><p class="calibre8">After choosing the<a id="id149" class="calibre1"/> hardware, the next thing which comes is sizing. Sizing for a cloud fabric for a private cloud and service provider cloud is an altogether different science with a common foundation of data center infrastructures sizing<a id="id150" class="calibre1"/> practice. Projecting future needs is the most important aspect while sizing any cloud hardware that is cloud should be able to handle hardware needs for the next <span class="strong"><em class="calibre12">X</em></span> years, depending upon businesses strategy. Microsoft provides MAP toolkit (Microsoft Assessment and Planning) which can be utilized by organizations and service providers for accessing current infra and planning for target infrastructure.</p><p class="calibre8">Let's have a look at few major sizing best practices and procedures for both private clouds and service providers' cloud.</p><p class="calibre8">Sizing the cloud hardware for private cloud:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Assess current<a id="id151" class="calibre1"/> workload requirements and plan hardware as per Hyper-V Server Virtualization sizing guidelines pertaining to virtual CPUs, memory, and more.</li><li class="listitem">Utilize MAP toolkit to assess current running workload in traditional computing.</li><li class="listitem">Perform server consolidation planning if P2V or hardware refresh is also planned.</li><li class="listitem">List down the expected new workload requirements (like new application planned in the near future and so on.)</li><li class="listitem">List down the expected resources increment in the coming <span class="strong"><em class="calibre12">X</em></span> years in terms of compute, network, and storage.</li><li class="listitem">Analyze isolated infrastructure requirements if any (a few apps may need to be isolated from each other in terms of network/server due to compliance and more.)</li><li class="listitem">Factor for<a id="id152" class="calibre1"/> <span class="strong"><strong class="calibre9">Business Continuity and Disaster Recovery</strong></span> (<span class="strong"><strong class="calibre9">BCDR</strong></span>) planning.</li><li class="listitem">Bring all collected <a id="id153" class="calibre1"/>details together and size the hardware as per Hyper-V virtualization and IT infrastructure sizing guidelines.</li><li class="listitem">Add hardware requirements for cloud management infrastructure depending upon workload to be managed.</li></ul></div><p class="calibre8">Sizing the cloud hardware for service provider cloud:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Access <a id="id154" class="calibre1"/>customer needs and technological requirements in service providers' technology space</li><li class="listitem">Define technology offering and flexibilities in terms of infra and apps with their fabric requirements</li><li class="listitem">Set business goals like having <span class="strong"><em class="calibre12">X</em></span> number of resources/customers in the coming <span class="strong"><em class="calibre12">X</em></span> years as per service provider's strategy</li><li class="listitem">Bring all collected details and strategy decisions together and size the hardware as per Hyper-V virtualization and IT infrastructure sizing guidelines</li><li class="listitem">Add hardware requirements for cloud management infrastructure depending upon the workload to be managed as planned here.</li></ul></div><div class="informalexample" title="Note"><h3 class="title2"><a id="note11" class="calibre1"/>Note</h3><p class="calibre8">Sizing the hardware for cloud or any traditional data center is an altogether different detailed study and practice. The above mentioned guidelines are to help readers in understanding the base foundation for cloud fabric hardware planning. Refer to product and practice specific technical and economical guidelines for a production sizing.</p></div></div></div></div>

<div class="book" title="Chapter&#xA0;2.&#xA0;Getting the Cloud Fabric Ready">
<div class="book" title="Cloud fabric infrastructure planning">
<div class="book" title="Choosing hypervisor's deployment options and editions"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch02lvl2sec22" class="calibre1"/>Choosing hypervisor's deployment options and editions</h2></div></div></div><p class="calibre8">Microsoft added a <a id="id155" class="calibre1"/>variety of all enterprise<a id="id156" class="calibre1"/> class virtualization<a id="id157" class="calibre1"/> features to Windows Server 2012. With Windows Server 2012 / R2 Hyper-V becomes the enterprise class proven virtualization platform supporting greater flexibility and scalability.</p><p class="calibre8">Microsoft Windows Server 2012 R2 Hyper-V provides an enterprise class virtualization platform for WAP-based cloud solution. Hyper-V can be deployed in three ways:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Windows Server 2012 R2 Server with GUI with Hyper-V role</li><li class="listitem">Windows Server 2012 R2 Server Core with Hyper-V role</li><li class="listitem">Hyper-V Server 2012 R2 (free)</li></ul></div><p class="calibre8">The <span class="strong"><strong class="calibre9">Server with GUI</strong></span> option installs<a id="id158" class="calibre1"/> and configures all user interface options, such as server manager, desktop experience, and so on. It installs Windows Server also in the same traditional manner with all features and functionality available.</p><p class="calibre8">The <span class="strong"><strong class="calibre9">Server Core</strong></span> version is <a id="id159" class="calibre1"/>a stripped down<a id="id160" class="calibre1"/> version of full installation, in this no GUI components gets installed. It has to be managed via a command line, PowerShell or remote server management options. Benefits <a id="id161" class="calibre1"/>of deploying the Server Core version includes but is not limited to less resource consumption, less disk footprint, better security by reducing attack surface of eliminated components in comparison to the Server with GUI option, and so on.</p><p class="calibre8">It is recommended to deploy <a id="id162" class="calibre1"/>Server Core in a cloud infrastructure for hypervisor's as these servers shall be used for running VMs only. This can take advantage of server core deployment benefits in large infrastructures.</p><p class="calibre8">With Windows Server 2012 and R2, it is possible to switch between full editions and core edition after deployment. Administrators can choose to install the Server with GUI initially and switch to the core version post configuration for easy deployment.</p><div class="book" title="Windows Server editions"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec01" class="calibre1"/>Windows Server editions</h3></div></div></div><p class="calibre8">There are multiple<a id="id163" class="calibre1"/> editions of Windows Server such as Essentials, Foundation, and so on, but majorly for any virtualization needs below two editions are used:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Windows Server Standard edition</li><li class="listitem">Windows Server Data center edition</li></ul></div><p class="calibre8">Both Standard and Data center editions of Windows Server is licensed on processor basis, one license per two processors. Both Standard and Data center editions provide the same set of features, the difference lies in the virtualization rights. Standard edition allows you to run two virtual machines with Windows Server OS, in the case of Data center edition the number goes unlimited. Taking a scenario Windows Server 2012 R2 Standard edition licensed hypervisor hosts allows you to create two virtual machines with Windows Server 2012/R2 Standard Guest OS without purchasing any additional licensing. Licensing downgrade rights apply for running<a id="id164" class="calibre1"/> VM with Windows Server 2008 R2 OS.</p></div><div class="book" title="Choosing the right edition for your cloud"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec02" class="calibre1"/>Choosing the right edition for your cloud</h3></div></div></div><p class="calibre8">Choosing the right<a id="id165" class="calibre1"/> edition depends upon the type and number of operating systems in the cloud infrastructure. It's recommended to go with the Data center edition if virtualized workload includes Windows as Guest OS majorly. Standard edition can be helpful and budgetary while the number of virtual machines with Windows OS isn't high.</p><p class="calibre8">As a best possible solution, in a large infrastructure combination of both Standard and Data center editions can be utilized depending on the OS of virtualized workload.</p><p class="calibre8">While for organizations it will depend on workload nature if it is Windows or non-Windows to choose the right edition, server providers can use a combination of both Data center/Standard edition to service customers' requests for both Windows and non-Windows infra requirements.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip07" class="calibre1"/>Tip</h3><p class="calibre8">Refer to the Windows<a id="id166" class="calibre1"/> Server 2012 product and edition comparison guide on <a class="calibre1" href="http://www.microsoft.com/">http://www.microsoft.com/</a> for detailed comparison between various Windows editions.</p></div></div><div class="book" title="Free Microsoft Hyper-V Server 2012 R2"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec03" class="calibre1"/>Free Microsoft Hyper-V Server 2012 R2</h3></div></div></div><p class="calibre8">Microsoft Hyper-V Server 2012 R2 (also known as Standalone Hyper-V) is a free (yes, completely free) edition<a id="id167" class="calibre1"/> of Microsoft's proprietary hypervisor. It is a stripped down version of Windows Server operating system comprising only hypervisor and virtualization capabilities, Windows Server drivers, and supporting components such as cluster capabilities. Free Hyper-V version doesn't include any additional Windows feature apart from hypervisor, making it available with less footprint, management burden, and attack surface.</p><p class="calibre8">Free Hyper-V Server 2012 R2 provides free access to Hyper-V virtualization capabilities only, virtual machine guest OS licensing has to be separately considered. If you are running Windows Server OS inside a virtual machine, it's a good idea to use Standard or Data center edition depending upon the count of Windows VMs. This edition can be helpful in scenarios where Guest OS inside VMs wouldn't be Windows.</p><p class="calibre8">A major use case of free Hyper-V Server is to be utilized by organizations or service providers for hosting non-Windows workloads.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note12" class="calibre1"/>Note</h3><p class="calibre8">Ensure to check for the supportability of the free Hyper-V version while extending WAP cloud solution with custom offerings or partner provided solutions.</p></div><p class="calibre8">Microsoft Hyper-V is the best choice for a WAP-based cloud solution, though there are integration possibilities<a id="id168" class="calibre1"/> with other hypervisor's vendors such as VMware and Citrix. See product specific guidelines to choose the edition and deployment model along with the supportability matrix of features while choosing VMware or Citrix.</p></div></div></div></div>

<div class="book" title="Chapter&#xA0;2.&#xA0;Getting the Cloud Fabric Ready">
<div class="book" title="Cloud fabric infrastructure planning">
<div class="book" title="Choosing the system center deployment options and edition"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch02lvl2sec23" class="calibre1"/>Choosing the system center deployment options and edition</h2></div></div></div><p class="calibre8">Microsoft System <a id="id169" class="calibre1"/>Center 2012 R2 is the core management component for delivering cloud services in a WAP-based<a id="id170" class="calibre1"/> cloud solution. System Center products can be deployed in multiple ways such as:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Physical or virtual machines</li><li class="listitem">Standalone or high availability mode (product dependent)</li></ul></div><p class="calibre8">System Center<a id="id171" class="calibre1"/> components requires Windows Server as an operating system to run. It can be in a virtual machine or a physical server. Since we virtualize every piece of our cloud management and tenant workload, it doesn't make sense to keep system center components on physical servers unless there is some specific requirement or exception.</p><p class="calibre8">For both organizations and service providers, it is recommended to deploy system center components inside virtual machines to take the advantage of hypervisor level HA and other capabilities.</p><p class="calibre8">Along with hypervisor HA, deploying servers in Guest OS or app level HA adds additional benefits such as application level failure detection and load balancing.</p><p class="calibre8">System Center products can be deployed in OS/app level cluster or redundant mode.</p><p class="calibre8">Organizations or service providers can choose a combination of standalone or HA mode products depending upon their <a id="id172" class="calibre1"/>availability business and technical requirements.</p><div class="book" title="System Center editions"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec04" class="calibre1"/>System Center editions</h3></div></div></div><p class="calibre8">System Center is available as a suite in two editions. When you buy a System Center suite you are entitled to<a id="id173" class="calibre1"/> use all components (except SCCM) depending upon licensing.</p><p class="calibre8">The two editions of the System Center suites are as follows:</p><div class="book"><ul class="itemizedlist"><li class="listitem">System Center Standard edition</li><li class="listitem">System Center Data center edition</li></ul></div><p class="calibre8">Licensing is required only for a number of endpoints being managed by system center components. There is no licensing required for running the system center components. Licensing is available in a similar fashion with Windows Server that is a processor-based licensing (two products per license). There is no difference in terms of features with Standard and Data center editions; the difference lies in the number of virtual instances you can manage with Standard and <a id="id174" class="calibre1"/>Data center editions. With Standard edition, two <span class="strong"><strong class="calibre9">OSEs</strong></span> (<span class="strong"><strong class="calibre9">Operating System Environments</strong></span>) can be managed by the System Center and is unlimited in the case of Data center edition. Microsoft licensing policy may change from time to time and depending upon agreements such as EA/SA and so on. It is recommended to touch base with Microsoft for planning licenses and editions.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip08" class="calibre1"/>Tip</h3><p class="calibre8">Refer the <span class="strong"><em class="calibre12">How to buy System Center 2012 R2</em></span> page on Microsoft's official website to know more on licensing and comparisons.</p></div><p class="calibre8">Choosing the right edition for System Center for organizations and service providers directly corresponds to the edition chosen for Windows Server. It's good to go with System Center Data center edition to manage Windows Server Data center edition and vice versa to enable a consistent feature set and flexibilities.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note13" class="calibre1"/>Note</h3><p class="calibre8">The licensing details given are up to the date of writing this chapter; licensing policies may change in future, and it is advised to consult while planning for licensing and editions.</p></div></div></div></div></div>

<div class="book" title="Chapter&#xA0;2.&#xA0;Getting the Cloud Fabric Ready">
<div class="book" title="Cloud fabric infrastructure planning">
<div class="book" title="Cloud management infra and tenant workload infrastructure"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_6"><a id="ch02lvl2sec24" class="calibre1"/>Cloud management infra and tenant workload infrastructure</h2></div></div></div><p class="calibre8">A cloud infrastructure is usually segregated in two categories, cloud management and tenant workload. Let's have a look at these two:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre9">Cloud Management Infrastructure</strong></span>: Management infrastructure or management cluster is <a id="id175" class="calibre1"/>used to host virtual machines for cloud management components such as Windows Azure Pack server and system center components. It is recommended to have a separate hypervisor cluster dedicatedly for hosting cloud management workload. The sizing of the management cluster would depend upon the number of services offered and the size of tenant workload to be managed.</li><li class="listitem"><span class="strong"><strong class="calibre9">Tenant Workload Infrastructure</strong></span>: Tenant workload infrastructure is used for hosting customers' cloud resources such as virtual machines and databases. Tenant <a id="id176" class="calibre1"/>workload infrastructure has to be designed keeping available cloud services, QoS and SLAs in mind.</li></ul></div></div></div></div>

<div class="book" title="Chapter&#xA0;2.&#xA0;Getting the Cloud Fabric Ready">
<div class="book" title="Cloud fabric infrastructure planning">
<div class="book" title="Core MS infrastructure services planning"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_7"><a id="ch02lvl2sec25" class="calibre1"/>Core MS infrastructure services planning</h2></div></div></div><p class="calibre8">Microsoft's WAP-based cloud<a id="id177" class="calibre1"/> solution uses core Microsoft core infrastructure services such as Active Directory, DNS, DHCP, and so on for foundation operations such as authentication and more. These core infrastructure services have to be deployed with product specific guidelines and industry best practices to ensure availability and efficiency . Let's have a look at the core services and the deployment best practices:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre9">Active Directory</strong></span>: Microsoft AD is the most critical component of most of MS infrastructure solutions including WAP cloud solution. AD is used for authentication, authorization along with other capabilities in WAP cloud. AD deployment can be<a id="id178" class="calibre1"/> planned with redundancy (deploying additional domain controllers) and security best practices. Regular backup and disaster recovery should be planned for Active Directory infrastructure.</li><li class="listitem"><span class="strong"><strong class="calibre9">DNS</strong></span>: Usually co-located with <a id="id179" class="calibre1"/>AD, DNS provides name resolution for the entire cloud. DNS failure may cause entire cloud failure, hence it needs to be planned to ensure every time availability and security from attacks. Regular backup and DR should be planned.</li><li class="listitem"><span class="strong"><strong class="calibre9">NTP</strong></span>: Another crucial component<a id="id180" class="calibre1"/> of any cloud or any IT solution, NTP ensures time synchronization among all cloud resources. Time lag may cause the entire cloud solution to fail as well as incorrect billing. The NTP device must be highly available as well as <a id="id181" class="calibre1"/>accurate. All components should be configured to use the same NTP device. Domain joined <a id="id182" class="calibre1"/>Windows operating systems utilize the domain controller (PDC role) for time synchronization.<div class="note" title="Note"><h3 class="title2"><a id="tip09" class="calibre1"/>Tip</h3><p class="calibre8">Follow Microsoft's guidelines while virtualizing domain controllers holding NTP role. See <a class="calibre1" href="https://technet.microsoft.com/en-us/library/virtual_active_directory_domain_controller_virtualization_hyperv%28v=ws.10%29.aspx">https://technet.microsoft.com/en-us/library/virtual_active_directory_domain_controller_virtualization_hyperv%28v=ws.10%29.aspx</a> to know more.</p></div></li><li class="listitem"><span class="strong"><strong class="calibre9">DHCP</strong></span>: Dynamic Host Configuration<a id="id183" class="calibre1"/> Protocol can be utilized for Dynamic IP address allocation and management. The deployment of DHCP should be highly available and efficient for serving cloud IP address requirements.</li><li class="listitem"><span class="strong"><strong class="calibre9">Other infrastructure supporting services (PXE Boot server, IPAM and so on)</strong></span>: Depending upon <a id="id184" class="calibre1"/>deployment and use cases other MS services such as PXE boot and deployment server<a id="id185" class="calibre1"/> for bare metal provisioning or network boot, WSUS or SCCM for patch management, IPAM for IP address management, jump servers for centralized access, security products should be deployed in an efficient and highly available manner as applicable.</li></ul></div><div class="informalexample" title="Note"><h3 class="title2"><a id="tip10" class="calibre1"/>Tip</h3><p class="calibre8">Planning and deployment options for cloud network and storage shall be discussed in the coming topics in this chapter.</p></div></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Hyper-V deployment best practices"><div class="book" id="MSDG2-b479cf466c26404ca54119871a9b2715"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec17" class="calibre1"/>Hyper-V deployment best practices</h1></div></div></div><p class="calibre8">Hypervisor is the core<a id="id186" class="calibre1"/> foundation of WAP-based cloud infrastructure as every virtual machine including management workload VMs such as WAP<a id="id187" class="calibre1"/> admin/tenant portal VM, SCVMM, SPF will be running inside a VM on Hyper-V host only. Let's have a look at a few of the deployment best practices of Hyper-V Server.</p><p class="calibre8">It is recommended to <a id="id188" class="calibre1"/>maintain symmetry in terms of configuration, best practices applied across all Hyper-V hosts. SCVMM and AD group policies can be used to configure and manage Hyper-V configurations and policies across all the hosts.</p><p class="calibre8">Centralized management is the key element in every cloud solution.</p></div>

<div class="book" title="Hyper-V deployment best practices">
<div class="book" title="Hyper-V installation best practices"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch02lvl2sec26" class="calibre1"/>Hyper-V installation best practices</h2></div></div></div><p class="calibre8">Though Windows Server 2012 R2 Hyper-V installation is quite straightforward. It's recommended to follow <a id="id189" class="calibre1"/>best practices of Hyper-V installation for a smooth and stable virtualized infrastructure.</p><p class="calibre8">Best practices for hypervisor installation <a id="id190" class="calibre1"/>are as follows:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre9">Supported hardware and latest hardware firmware</strong></span>: It is recommended to use supported hardware for proven performance and stability. Always ensure to update the firmware of the server's hardware or chassis or blades as applicable.</li><li class="listitem"><span class="strong"><strong class="calibre9">Install OS using hardware vendor provided tools</strong></span>: Major server hardware vendors provide their proprietary tools for installing operating system such as HP intelligent provisioning. This ensures that the hypervisor is deployed with proper hardware-specific drivers and integration tools.</li><li class="listitem"><span class="strong"><strong class="calibre9">Choose correct deployment option</strong></span>: In a cloud infrastructure, it is recommended to use the Server Core version to utilize the benefits of the Server Core deployment, such as less disk footprint and attack surface, which reduces management and updates burden. If you deploy the Server with GUI, it is advised to remove all unnecessary components.</li><li class="listitem"><span class="strong"><strong class="calibre9">Latest device drivers</strong></span>: Use the latest device drivers for hardware devices regardless of the proprietary and commodity hardware.</li><li class="listitem"><span class="strong"><strong class="calibre9">Windows updates</strong></span>: Ensure to update the hypervisor with the latest patches and service packs that are available. It is recommended to have patch management solutions deployed for ensuring the continuous deployment of the latest hot fixes.</li><li class="listitem"><span class="strong"><strong class="calibre9">Page file</strong></span>: Hyper-V server<a id="id191" class="calibre1"/> automatically manages page file size as per the physical memory that is installed in the system. It should be set to <span class="strong"><strong class="calibre9">System Managed</strong></span>.</li><li class="listitem"><span class="strong"><strong class="calibre9">Windows firewall</strong></span>: Configure Windows firewall rules as per environmental requirements. An organization may choose to disable the firewall if the port level access is being managed by network firewalls.</li><li class="listitem"><span class="strong"><strong class="calibre9">Hypervisor hardening and VA</strong></span>: Apply standard security policies as per the organization's defined<a id="id192" class="calibre1"/> standard. Perform necessary vulnerability assessments and remediation as per the organization's policies.</li><li class="listitem"><span class="strong"><strong class="calibre9">Naming convention and domain</strong></span>: Ensure to follow the proper hostname convention and join<a id="id193" class="calibre1"/> the domain wherever applicable. For cluster nodes, it is required to join hosts to<a id="id194" class="calibre1"/> the domain.</li></ul></div></div></div>

<div class="book" title="Hyper-V deployment best practices">
<div class="book" title="Hyper-V networking best practices"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch02lvl2sec27" class="calibre1"/>Hyper-V networking best practices</h2></div></div></div><p class="calibre8">Best practices for Hyper-V <a id="id195" class="calibre1"/>networking are as follows:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre9">Separate network for Hyper-V and VM network traffic</strong></span>: A separate physical and logical network should be considered for management traffic such as host<a id="id196" class="calibre1"/> management and live migration, and another for virtual machine traffic as per the VM network zone such as internal, DMZ, and so on.</li><li class="listitem"><span class="strong"><strong class="calibre9">Configure redundancy at physical network path</strong></span>: Configure at least two NIC adaptors connecting to two different network switch in each network team. Ensure not to have any single point of failure.</li><li class="listitem"><span class="strong"><strong class="calibre9">Configure teaming and load balancing policies</strong></span>: Windows Server 2012 /R2 provides multiple load balancing policies(Hyper-V port, address hash, dynamic balancing, and so on) which provides maximum performance and reliability for Hyper-V network. Ensure to configure proper NIC teaming load balancing policies.</li><li class="listitem"><span class="strong"><strong class="calibre9">Separate network for IP storage traffic</strong></span>: It is recommended to use a separate physical and logical network for IP based storage traffic such as iSCSI, SMB, and so on.</li><li class="listitem"><span class="strong"><strong class="calibre9">Implement network QoS</strong></span>: Use the Hyper-V network <span class="strong"><strong class="calibre9">Quality of Service</strong></span> (<span class="strong"><strong class="calibre9">QoS</strong></span>) feature to ensure that no single VM becomes the network bandwidth constraints for other VMs. It becomes important to implement QOD in a WAP-based cloud solution to ensure providing request network bandwidth to tenants' virtual<a id="id197" class="calibre1"/> machines as per their plan and subscription.</li><li class="listitem"><span class="strong"><strong class="calibre9">Monitor network usage</strong></span>: Monitor Hyper-V network virtualization continuously to plan to get insight of network usage and plan for future scalability.</li><li class="listitem"><span class="strong"><strong class="calibre9">Use SDN (Software Defined Networking)</strong></span>: This is not a Hyper-V networking best practice, but looking at cloud solution using SDN, aka network virtualization, <a id="id198" class="calibre1"/>can enable automated provisioning, management and flexibilities for cloud <a id="id199" class="calibre1"/>networking.</li></ul></div></div></div>

<div class="book" title="Hyper-V deployment best practices">
<div class="book" title="Hyper-V storage deployment best practices"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch02lvl2sec28" class="calibre1"/>Hyper-V storage deployment best practices</h2></div></div></div><p class="calibre8">Best practices for Hyper-V storage <a id="id200" class="calibre1"/>deployment are as<a id="id201" class="calibre1"/> follows:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre9">Ensure redundancy for storage path</strong></span>: Use multipath IO for storage paths. Eliminate any single <a id="id202" class="calibre1"/>point of failure at server port, storage port, or SAN switch and so on. Configure multipathing policies as per SAN provider guidelines for reliability and efficiency.</li><li class="listitem"><span class="strong"><strong class="calibre9">Using vhdx</strong></span>: New virtual disk file format that is vhdx was introduced with Windows Server 2012. VHD provides multiple benefits over older format VHD in terms of performance and reliability. Use vhdx instead of vhd unless exceptionally required.</li><li class="listitem"><span class="strong"><strong class="calibre9">Size volumes and CSV properly</strong></span>: Sizing workload VMs is important in terms of capacity and IOPS. Oversized volumes may cause performance and outage issues.</li><li class="listitem"><span class="strong"><strong class="calibre9">Implement storage QoS</strong></span>: Use Hyper-V storage quality of service feature to ensure that no single VM becomes the storage performance constraints for other VMs with respect to IOPS. It is a must for a WAP-based cloud solution to ensure providing requested storage IOPS to tenants' virtual machines as per their plan and subscription.</li><li class="listitem"><span class="strong"><strong class="calibre9">Monitor storage usage</strong></span>: Monitor Hyper-V storage continuously for capacity and performance to plan to get insight of network usage and plan for future scalability.</li><li class="listitem"><span class="strong"><strong class="calibre9">Use SDS/SMI-S/SMP integrations</strong></span>: This is not a Hyper-V storage best practice, but from a<a id="id203" class="calibre1"/> cloud prospective it is recommended to use SDS (Software Defined Storage), SMI-S provider array integration for better provisioning, management and automation for cloud storage.</li></ul></div></div></div>

<div class="book" title="Hyper-V deployment best practices">
<div class="book" title="Hyper-V virtual machine deployment best practices"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch02lvl2sec29" class="calibre1"/>Hyper-V virtual machine deployment best practices</h2></div></div></div><p class="calibre8">Best practices<a id="id204" class="calibre1"/> for Hyper-V virtual machine deployment<a id="id205" class="calibre1"/> are as<a id="id206" class="calibre1"/> follows:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre9">Properly sizing of VM Compute</strong></span>: A greater number of virtual CPUs doesn't guarantee more performance, assign CPUs to VMs as per actual application requirements. The same goes for memory. Ensure not to oversize or undersize virtual machines.</li><li class="listitem"><span class="strong"><strong class="calibre9">Use Generation-2 VM</strong></span>: Generation 2 VMs provide multiple features over Generation-1 VMs such as UEFI boot, synthetic hardware, faster installation and booting time and more. It is recommended to use Generation-2 VMs unless specifically required.</li><li class="listitem"><span class="strong"><strong class="calibre9">Use dynamic memory</strong></span>: It is recommended to use dynamic memory to make the most out of physical RAM available in your server. Using dynamic memory in a large <a id="id207" class="calibre1"/>cloud environment can help in increasing host density. It is recommended to plan carefully while using dynamic memory to avoid any performance hit on any of the virtual machines or hosts.</li><li class="listitem"><span class="strong"><strong class="calibre9">Use non-uniform memory access (NUMA) if supported</strong></span>: NUMA helps virtual machines having multiple virtual CPUs assigned to scale and perform better by facilitating it to use local cache and memory bus of the CPU executing its instruction. NUMA is dependent upon hardware architecture.</li><li class="listitem"><span class="strong"><strong class="calibre9">Remove unused virtual hardware</strong></span>: It's recommended to use unused virtual hardware such as a floppy drive and so on.</li><li class="listitem"><span class="strong"><strong class="calibre9">Use proper integration services</strong></span>: Integration service are installed inside guest operating systems to make those virtualization aware and avail features such as graceful shutdown from Hyper-V manager, time sync, data exchange and so on. All the latest Windows operating systems by default include integration service, for non-Windows OS it may be required to manually install integration services.</li><li class="listitem"><span class="strong"><strong class="calibre9">Monitor virtual machine usage</strong></span>: Monitor VM usage continuously for compute and take<a id="id208" class="calibre1"/> necessary corrective action for oversized and undersized virtual machines.</li></ul></div></div></div>

<div class="book" title="Hyper-V deployment best practices">
<div class="book" title="Hyper-V cluster and mobility deployment best practices"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch02lvl2sec30" class="calibre1"/>Hyper-V cluster and mobility deployment best practices</h2></div></div></div><p class="calibre8">Best practices for Hyper-V<a id="id209" class="calibre1"/> cluster and mobility deployment are as follows:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre9">Cluster Validation Report</strong></span>: Microsoft Windows' failover cluster provides features to<a id="id210" class="calibre1"/> examine the nodes with respect to Hyper-V configuration, inventory, network, storage and system configuration before deploying a cluster. Any error or warning produced by validation check should be remediated with the necessary corrective actions. Successfully validated cluster is the key to smooth Hyper-V HA functionalities.</li><li class="listitem"><span class="strong"><strong class="calibre9">Use SCVMM to deploy and manage highly available virtual machines</strong></span>: This isn't particularly related to Hyper-V cluster best practice, but for a cloud solution it is recommended to deploy and manage Hyper-V cluster and mobility via SCVMM.</li><li class="listitem"><span class="strong"><strong class="calibre9">Use separate network for live migration</strong></span>: It is recommended to use separate physical <a id="id211" class="calibre1"/>and logical network live migration traffic for reliability and performance.</li><li class="listitem"><span class="strong"><strong class="calibre9">Cluster Aware Updating</strong></span>: It is recommended to use CAU for patching and upgrading cluster nodes. With this organizations and service providers can ensure no outages to end customers during the patching of hypervisors. WSUS can be integrated with VMM to automate updates to Hyper-V hosts.</li></ul></div></div></div>
<div class="book" title="Setting up virtual machines for cloud management fabric" id="NQU21-b479cf466c26404ca54119871a9b2715"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec18" class="calibre1"/>Setting up virtual machines for cloud management fabric</h1></div></div></div><p class="calibre8">Enough of planning and<a id="id212" class="calibre1"/> best practices, it is time to get things in action. Let us setup virtual machines to host our cloud infrastructure. These <a id="id213" class="calibre1"/>VMs shall host cloud management infrastructure and be hosted on the cloud management cluster.</p><p class="calibre8">Create a user in Active Directory for joining these servers into the Active Directory domain.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note14" class="calibre1"/>Note</h3><p class="calibre8">Add one redundant VM for each type of VM below, except WAP server (see <a class="calibre1" title="Chapter 1. Know Windows Azure Pack and Its Architecture" href="part0015_split_000.html#E9OE1-b479cf466c26404ca54119871a9b2715">Chapter 1</a>, <span class="strong"><em class="calibre12">Know Windows Azure Pack and Its Architecture</em></span>, for WAP HA), to provide highly available fabric. See product specific guidelines for configuring HA for respective components.</p></div><div class="informalexample"><table border="1" class="calibre16"><colgroup class="calibre17"><col class="calibre18"/><col class="calibre18"/><col class="calibre18"/><col class="calibre18"/></colgroup><thead class="calibre19"><tr class="calibre20"><th valign="bottom" class="calibre25">
<p class="calibre22">Sr. Num</p>
</th><th valign="bottom" class="calibre25">
<p class="calibre22">VM Name</p>
</th><th valign="bottom" class="calibre25">
<p class="calibre22">Compute Configuration</p>
</th><th valign="bottom" class="calibre25">
<p class="calibre22">Purpose of VM</p>
</th></tr></thead><tbody class="calibre23"><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">1</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">WAPMGT-SQLDB-01</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">4 CPU, 12 GB RAM</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Host SQL databases for entire WAP solution database needs</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">2</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">WAPMGTSCVMM-01*</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">4 CPU, 12 GB RAM</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">System Center Virtual Machine Manager</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">3</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">WAPMGT-SCSPF-01</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">2 CPU, 8GB RAM</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Service Provider Foundation</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">4</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">WAPMGT-SCSMA-01</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">2 CPU, 8 GB RAM</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Service Management Automation</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">5</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">WAPMGT-ACRDG-01</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">2 CPU, 8 GB RAM</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Remote Desktop Gateway Server for providing Azure Console Connect</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">6</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">WAPMGT-WAPSR-01</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">2 CPU, 8 GB RAM</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Windows Azure Pack (Express Installation Model)</p>
</td></tr></tbody></table></div><div class="informalexample" title="Note"><h3 class="title2"><a id="note15" class="calibre1"/>Note</h3><p class="calibre8">These VM c<a id="id214" class="calibre1"/>onfiguration used in this book is only for evaluation purpose, follow guidelines discussed in <a class="calibre1" title="Chapter 1. Know Windows Azure Pack and Its Architecture" href="part0015_split_000.html#E9OE1-b479cf466c26404ca54119871a9b2715">Chapter 1</a>, <span class="strong"><em class="calibre12">Know Windows Azure Pack and Its Architecture</em></span> and this chapter along with product specific documentation for production deployment.</p></div><p class="calibre8">All VMs mentioned<a id="id215" class="calibre1"/> above shall be configured with the following common settings:</p><div class="book"><ul class="itemizedlist"><li class="listitem">127 GB disk (dynamic expanding disk)</li><li class="listitem">Windows Server 2012 R2 DC/STD edition operating system</li><li class="listitem">Single NIC card connected to Hyper-V virtual switch (external)</li><li class="listitem">Dynamic memory not being used</li><li class="listitem">All integration services available</li><li class="listitem">Highly available in a Hyper-V cluster (recommended, not mandatory)</li></ul></div><p class="calibre8">The post VM deployment steps are as follows:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Active Windows operating system</li><li class="listitem">Assign static IPv4 address</li><li class="listitem">Assign hostname as per naming convention</li><li class="listitem">Join the server to domain</li><li class="listitem">Turn off Windows<a id="id216" class="calibre1"/> firewall or create firewall<a id="id217" class="calibre1"/> rules as applicable</li></ul></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Planning and deploying SQL Server for cloud management DB"><div class="book" id="OPEK2-b479cf466c26404ca54119871a9b2715"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec19" class="calibre1"/>Planning and deploying SQL Server for cloud management DB</h1></div></div></div><p class="calibre8">All components<a id="id218" class="calibre1"/> of Windows Azure Pack and system<a id="id219" class="calibre1"/> center uses SQL Server database to store its configuration, run time data, historical usage data etc. Failure of the database is directly<a id="id220" class="calibre1"/> proportional to the <a id="id221" class="calibre1"/>failure of respective components.</p></div>

<div class="book" title="Planning and deploying SQL Server for cloud management DB">
<div class="book" title="Choosing the database server version and deployment model"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch02lvl2sec31" class="calibre1"/>Choosing the database server version and deployment model</h2></div></div></div><p class="calibre8">In a bare minimum <a id="id222" class="calibre1"/>deployment, this SQL Server for<a id="id223" class="calibre1"/> management databases shall be used by the following components:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Windows Azure Pack components</li><li class="listitem">SCVMM</li><li class="listitem">SPF</li><li class="listitem">SMA</li></ul></div><p class="calibre8">While choosing the database version a deployment model, supportability and compatibility has to be aligned with respect to each of the components mentioned previously.</p><p class="calibre8">Windows Azure Pack supports the following MS SQL Server versions for managing databases:</p><div class="book"><ul class="itemizedlist"><li class="listitem">MS SQL Server 2008 Service Pack 3</li><li class="listitem">MS SQL Server 2008 R2 Service Pack 2</li><li class="listitem">MS SQL Server 2012 Service Pack 1</li><li class="listitem">MS SQL Server 2012 Service Pack 2</li><li class="listitem">MS SQL Server 2014</li></ul></div><p class="calibre8">System Center 2012 R2 has different SQL Server version support differentiating upon components. Taking the common and latest, MS SQL 2012 SP1 is the supported SQL version for Windows Azure Pack and all System Center products, MS SQL 2012 SP2 and MS SQL 2014 is supported for WAP components and all System Center 2012 R2 components except app controller. Organizations or cloud providers can choose between SQL 2012 SP1, SQL 2012 SP2 and SQL 2014 depending upon the components installed.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip11" class="calibre1"/>Tip</h3><p class="calibre8">SQL Support matrix for <a id="id224" class="calibre1"/>System Center 2012 R2 can be accessed at <a class="calibre1" href="https://technet.microsoft.com/en-us/library/dn281933.aspx">https://technet.microsoft.com/en-us/library/dn281933.aspx</a></p></div><p class="calibre8">The deployment<a id="id225" class="calibre1"/> model in SQL Server can be deployed in multiple ways with respect to placement, failover, and so on. WAP management database deployment is supported in following ways:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Standalone SQL Server deployment</li><li class="listitem">SQL Server failover cluster</li><li class="listitem">SQL Server AlwaysOn availability groups</li></ul></div><p class="calibre8">Choosing the right deployment model for your cloud management databases depends upon deployment strategy. Standalone deployment works fine but becomes a single point of failure. Failure in the management database will cause failure of all cloud management components<a id="id226" class="calibre1"/> functionalities.</p><p class="calibre8">SQL Cluster (active/passive) and SQL AlwaysOn availability group can be used to add redundancy for management databases eliminating any single point of failure.</p><p class="calibre8">While both options provide redundancy for SQL Server, AlwaysOn adds greater flexibility and reliability by enabling clusters without any shared storage and protection at database level, which is at instance level in case of SQL Cluster.</p><p class="calibre8">More on SQL Cluster versus SQL can be found at <a class="calibre1" href="https://msdn.microsoft.com/en-us/library/ff929171.aspx">https://msdn.microsoft.com/en-us/library/ff929171.aspx</a>.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip12" class="calibre1"/>Tip</h3><p class="calibre8">SQL cluster functionalities is available in MS SQL Standard edition where AlwaysOn requires Enterprise edition license.</p></div><p class="calibre8">While installing SQL for management databases, the following features are required to be installed. Default collation will work when deploying for English language. See product specific guidelines for other languages:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Common features:<div class="book"><ul class="itemizedlist1"><li class="listitem">Database engine</li><li class="listitem">Management tools</li></ul></div></li><li class="listitem">Product specific features:<div class="book"><ul class="itemizedlist1"><li class="listitem">Full text search (for SC operations Manager and Service Manager)</li><li class="listitem">Reporting services (for SC operations Manager and Service Manager)</li><li class="listitem">Analysis services (For SC Service Manager)</li></ul></div></li></ul></div><p class="calibre8">Additional consideration<a id="id227" class="calibre1"/> while deploying SQL Server for WAP and System Center 2012 R2 include:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Deploy additional SQL Server/instances in a large production setup to avoid any performance issues.</li><li class="listitem">Reporting services instances cannot be shared between components.</li><li class="listitem">Configure pre-size and automatically grow along with monitoring for efficient and undisrupted management databases.</li><li class="listitem">SQL authentication<a id="id228" class="calibre1"/> needs to be enabled on the SQL Server before installing Windows Azure Pack components. If Windows authentication is planned for configuration, the current user has to be added as an administrator on the SQL Server.</li><li class="listitem">SQL AlwaysOn availability groups functionality is not supported for a named instance for System Center Service Manager Database, it is supported for default server instance only.</li></ul></div><div class="informalexample" title="Note"><h3 class="title2"><a id="note16" class="calibre1"/>Note</h3><p class="calibre8">SQL Express Edition can be used WAP in Express deployment. For WAP distributed deployment and system center components Standard edition is the minimum edition supported. Choose SQL edition depending upon the features and HA model discussed above.</p></div></div></div>

<div class="book" title="Planning and deploying SQL Server for cloud management DB">
<div class="book" title="Installing and configuring SQL Server 2012 SP2"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch02lvl2sec32" class="calibre1"/>Installing and configuring SQL Server 2012 SP2</h2></div></div></div><p class="calibre8">For the purpose<a id="id229" class="calibre1"/> of evaluation in this book, we shall be using <a id="id230" class="calibre1"/>SQL Server 2012 SP2 standalone installation as the DB server. This database server shall be used by all WAP and system center components.</p><div class="book"><ul class="itemizedlist"><li class="listitem">Installation prerequisite:<div class="book"><ul class="itemizedlist1"><li class="listitem">A set of hardware and software prerequisite has to be met before deploying SQL Server</li></ul></div></li><li class="listitem">Software requirements:<p class="calibre15">Install the following components on SQL Server VM before installing SQL Server:</p><div class="book"><ul class="itemizedlist1"><li class="listitem">.NET 3.5 SP1 Framework</li><li class="listitem">Windows PowerShell (installed by default)</li><li class="listitem">Network protocol and libraries (like shared memory, named pipe, TCP IP—available by default)</li></ul></div></li><li class="listitem">Active <a id="id231" class="calibre1"/>Directory accounts requirements:<div class="book"><ul class="itemizedlist1"><li class="listitem">Create a user<a id="id232" class="calibre1"/> account in AD for SQL Server administration and services login account<div class="informalexample"><table border="1" class="calibre16"><colgroup class="calibre17"><col class="calibre18"/><col class="calibre18"/><col class="calibre18"/></colgroup><thead class="calibre19"><tr class="calibre20"><th valign="bottom" class="calibre25">
<p class="calibre22">Account Name</p>
</th><th valign="bottom" class="calibre25">
<p class="calibre22">Purpose</p>
</th><th valign="bottom" class="calibre25">
<p class="calibre22">Permissions</p>
</th></tr></thead><tbody class="calibre23"><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Sqldbadmin</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">SQL DB administrator user</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Member of local administrator group on SVMM + DB admin</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Sqldb-svc</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Service account for SQL Server Service</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Member of local administrator group on SVMM + DB admin</p>
</td></tr></tbody></table></div></li><li class="listitem">Add created user accounts in the local administrator's group on SQL Server Windows OS.</li></ul></div></li></ul></div><div class="book" title="Installation procedure"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec05" class="calibre1"/>Installation procedure</h3></div></div></div><p class="calibre8">The following is the installation<a id="id233" class="calibre1"/> procedure to be followed:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Download MS SQL Server 2012 SP1 installation media and mount on SQL VM.</li><li class="listitem" value="2">Execute the setup file from installation media and select <span class="strong"><strong class="calibre9">Standalone installation</strong></span>.</li><li class="listitem" value="3">SQL setup will start a valid validation check for installing the SQL Server setup support file. All tests must report green to green to proceed further.</li><li class="listitem" value="4">Enter the product key (embedded in licensed media) or select evaluation mode installation option as applicable.</li><li class="listitem" value="5">Accept the license terms and proceed further to install setup files.</li><li class="listitem" value="6">Verify the setup support rules result. All results must pass successfully to proceed further.</li><li class="listitem" value="7">Select <span class="strong"><strong class="calibre9">SQL Server Feature Installation</strong></span> on the <span class="strong"><strong class="calibre9">Setup Role</strong></span> page.<div class="mediaobject"><img src="../images/00008.jpeg" alt="Installation procedure" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="8">Select <a id="id234" class="calibre1"/><span class="strong"><strong class="calibre9">Database Engine Services</strong></span>, <span class="strong"><strong class="calibre9">Client Tools Connectivity</strong></span> and <span class="strong"><strong class="calibre9">Management Tools - Basic</strong></span> on the <span class="strong"><strong class="calibre9">Features</strong></span> page (select features as per product specific requirements discussed in the last topic).<div class="mediaobject"><img src="../images/00009.jpeg" alt="Installation procedure" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="9">Verify the installation rules<a id="id235" class="calibre1"/> status, all rules must pass successfully in order to proceed further.</li><li class="listitem" value="10">Change the instance name to a name of your choice. For the purpose of evaluation we are using the <span class="strong"><strong class="calibre9">Default instance</strong></span>.<div class="mediaobject"><img src="../images/00010.jpeg" alt="Installation procedure" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="11">Verify the disk<a id="id236" class="calibre1"/> space requirement and available space to proceed further.</li><li class="listitem" value="12">Change the default service account for the SQL Server agent and database engine to the Active Directory account created earlier.<div class="mediaobject"><img src="../images/00011.jpeg" alt="Installation procedure" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="13">Select <span class="strong"><strong class="calibre9">Mixed Mode</strong></span> <a id="id237" class="calibre1"/>authentication on the <span class="strong"><strong class="calibre9">Database Engine Configuration</strong></span> page. Provide "<code class="email">sa</code>" as the password and add the current logged in user (SQLDBADMIN) into SQL administrators. Change the data directories location to different drives if applicable.<div class="mediaobject"><img src="../images/00012.jpeg" alt="Installation procedure" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="14">Choose the error reporting option if you wish to participate in error reporting to Microsoft.</li><li class="listitem" value="15">Verify the installation<a id="id238" class="calibre1"/> configuration rule status. Each rule must pass successfully to proceed further.</li><li class="listitem" value="16">Verify the installation option selected summary.</li><li class="listitem" value="17">SQL Setup will start installing SQL DB Server as per the inputs provided.</li><li class="listitem" value="18">Close the wizard once installation finishes successfully, review setup logs in case of any errors.</li></ol><div class="calibre27"/></div></div></div></div>

<div class="book" title="Planning and deploying SQL Server for cloud management DB">
<div class="book" title="Post installation tasks"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch02lvl2sec33" class="calibre1"/>Post installation tasks</h2></div></div></div><p class="calibre8">Configure the following tasks<a id="id239" class="calibre1"/> after successfully installing SQL Server 2012 SP1:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Login into SQL Server using SQL Management Studio and verify successful installation. Also verify whether the system databases such as <code class="email">master</code>, <code class="email">tempdb</code> are created.</li><li class="listitem" value="2">Create a login for SCVMM, SPF, and WAP admin Active Directory user. Permissions can be defined later. Browse through the <span class="strong"><strong class="calibre9">Security</strong></span> | <span class="strong"><strong class="calibre9">Logins</strong></span> menu and right click on <span class="strong"><strong class="calibre9">Logins </strong></span>to create the SQL user.</li><li class="listitem" value="3">Configure the SQL Server network port for remote access using SQL Server Configuration Manager. By<a id="id240" class="calibre1"/> default it's <span class="strong"><strong class="calibre9">1433</strong></span>.</li></ol><div class="calibre27"/></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Planning and deploying SCVMM 2012 R2"><div class="book" id="PNV62-b479cf466c26404ca54119871a9b2715"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec20" class="calibre1"/>Planning and deploying SCVMM 2012 R2</h1></div></div></div><p class="calibre8">System Center virtual <a id="id241" class="calibre1"/>machine manager is the heart of the solution and is responsible for delivering IaaS services for the Windows Azure Pack based cloud solution. SCVMM is responsible for provisioning and managing the life cycle of IaaS resources such as virtual machines, virtual networks and so on.</p><p class="calibre8">SCVMM manages<a id="id242" class="calibre1"/> not only the hypervisor and virtual machines resources but also is responsible for provisioning and managing network and storage resources for cloud virtual machines. SCVMM provides flexibility to integrate with third party network and storage providers for automated provisioning and management. In a nutshell, SCVMM is core resource provider for IaaS offerings for WAP cloud solution.</p><p class="calibre8">SCVMM comes as a part of system center suite. WAP communicates with SCVMM for IaaS services via <span class="strong"><strong class="calibre9">SPF</strong></span> (<span class="strong"><strong class="calibre9">Service Provider Foundation</strong></span>). In this section we will cover VMM architecture and deployment models along with installation walkthrough.</p></div>

<div class="book" title="Planning and deploying SCVMM 2012 R2">
<div class="book" title="The VMM architecture and deployment model"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch02lvl2sec34" class="calibre1"/>The VMM architecture and deployment model</h2></div></div></div><p class="calibre8">VMM server is made up <a id="id243" class="calibre1"/>of multiple components which can be deployed together on a single server or on a different server in a distributed fashion to achieve scalability and availability. VMM requires a SQL Server database to store all <a id="id244" class="calibre1"/>configurations and run time data. Components of overall VMM working solutions are as follows:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre9">VMM Management Server</strong></span>: This server is responsible for the execution of all tasks SCVMM is participating in. It installs System Center Virtual Machine management services <a id="id245" class="calibre1"/>which communicates with all other system center VMM and non-system center components for provisioning and controlling the fabric. This can be protected from SPOF by deploying in HA mode on the top of Microsoft Failover Cluster.</li><li class="listitem"><span class="strong"><strong class="calibre9">VMM Management Console</strong></span>: Management console is used by administrators for connecting to VMM management<a id="id246" class="calibre1"/> services and performing administrative tasks. It gets installed on VMM management server by default, you can also install it in your management endpoints for SCVMM administration. .</li><li class="listitem"><span class="strong"><strong class="calibre9">VMM Database</strong></span>: VMM database is a Microsoft SQL Server provided database which stores VMM configuration such as hosts, networks, virtual machine, and so on, along<a id="id247" class="calibre1"/> with run time data. VMM is highly dependent on this database to function, it is highly recommended to protect this database using SQL HA techniques in production deployment.</li><li class="listitem"><span class="strong"><strong class="calibre9">VMM library and library server</strong></span>: VMM library stores all resources that are used to deploy <a id="id248" class="calibre1"/>VMs or services. VMM library typically includes VHDs, templates, ISO files, network and storage profiles and so on. VMM library is <a id="id249" class="calibre1"/>stored in a file share hosted on a library server.</li><li class="listitem"><span class="strong"><strong class="calibre9">VMM Agent</strong></span>: VMM agent is<a id="id250" class="calibre1"/> not a server component, it facilitates communication between hypervisor and VMM. VMM agent gets installed on hypervisor while adding hosts in VMM. It can also be manually installed in case of any isolated environmental restrictions.</li></ul></div><p class="calibre8">All components here except VMM database (provided by SQL) are available in SCVMM 2012 R2 installation media.</p><div class="book" title="VMM deployment models"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec06" class="calibre1"/>VMM deployment models</h3></div></div></div><p class="calibre8">SCVMM works on a<a id="id251" class="calibre1"/> distributed architecture which enables it to provide multiple<a id="id252" class="calibre1"/> flexible deployment options. Organizations can choose to increase components such as management server or library server for scalability needs. Majorly, SCVMM can be deployed in three ways:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre9">Standalone deployment</strong></span>: In standalone deployment all server components of VMM (VMM management server, VMM console, VMM library server and VMM SQL database) are installed on a<a id="id253" class="calibre1"/> single server. This deployment model facilitates a minimum deployment footprint and is suitable for test and non-production architectures. It doesn't provide any redundancy for any of the components.</li><li class="listitem"><span class="strong"><strong class="calibre9">Distributed deployment</strong></span>: In a distributed deployment, organizations can choose to install a <a id="id254" class="calibre1"/>management server, library server and database server of three or more different servers to achieve availability and scalability. VMM database can be protected using SQL high availability techniques</li><li class="listitem"><span class="strong"><strong class="calibre9">SCVMM in high availability mode</strong></span>: SCVMM supports deployment in cluster mode using<a id="id255" class="calibre1"/> Windows Failover Cluster. Virtual machine management server can be protected using HA deployment mode, along with protected DB using SQL HA techniques. This is recommended for production deployment eliminating any single point of failure.</li></ul></div></div></div></div>

<div class="book" title="Planning and deploying SCVMM 2012 R2">
<div class="book" title="Installing System Center Virtual Machine Manager 2012 R2"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch02lvl2sec35" class="calibre1"/>Installing System Center Virtual Machine Manager 2012 R2</h2></div></div></div><p class="calibre8">For the purpose <a id="id256" class="calibre1"/>of evaluation in this book, we shall be deploying VMM<a id="id257" class="calibre1"/> Management Server, VMM Console and VMM Library Server and share on a single machine. Cloud Management SQL database server shall be utilized for hosting VMM database.</p><div class="book" title="Installation prerequisites"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec07" class="calibre1"/>Installation prerequisites</h3></div></div></div><p class="calibre8">Multiple Active Directory accounts with specific permission are required for SCVMM to work. Let's have a look at the<a id="id258" class="calibre1"/> recommended accounts and permissions for SCVMM usage.</p><p class="calibre8">AD user account and group for SCVMM:</p><div class="informalexample"><table border="1" class="calibre16"><colgroup class="calibre17"><col class="calibre18"/><col class="calibre18"/><col class="calibre18"/></colgroup><thead class="calibre19"><tr class="calibre20"><th valign="bottom" class="calibre25">
<p class="calibre22">Account Name</p>
</th><th valign="bottom" class="calibre25">
<p class="calibre22">Purpose</p>
</th><th valign="bottom" class="calibre25">
<p class="calibre22">Permissions</p>
</th></tr></thead><tbody class="calibre23"><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Scvmmadmin</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">SCVMM admin user for administrative tasks</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Member of local administrator group on SVMM + DB Admin</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Scvmmsvc</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Service account for SCVMM service</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Member of local administrator group on SVMM + DB Admin</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Scvmm-runasadmin</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Run as account for SCVMM operation</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Admin permissions on SCVMM and other resources being managed such as Hyper-V hosts.</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Scvmm-admins</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Security group for administrators</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Admin permissions on SCVMM</p>
</td></tr></tbody></table></div><p class="calibre8">Add SCVMM admin and service account as a part of "scvmm-admin" security group</p></div><div class="book" title="Software prerequisite"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec08" class="calibre1"/>Software prerequisite</h3></div></div></div><p class="calibre8">VMM takes care of installing most of the software prerequisites except Windows Access and development kit (Windows ADK) and SQL database related tools. Install the following components <a id="id259" class="calibre1"/>as a part of the software prerequisite for deploying System Center Virtual Machine Manager 2012 R2:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Features from Windows assessment and development toolkit:<div class="book"><ul class="itemizedlist1"><li class="listitem">Deployment tools</li><li class="listitem">Windows pre-installation environment (Windows PE)</li></ul></div></li><li class="listitem">SQL Server connectivity tools:<div class="book"><ul class="itemizedlist1"><li class="listitem">SQL Server 2012 command line utilities</li><li class="listitem">Microsoft SQL Server native client</li></ul></div></li></ul></div><p class="calibre8">Apart from installing, VMM has the following software components requirements which the setup takes care of during installation:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Windows Remote Management (WinRM 2.0) Service</li><li class="listitem">Microsoft .NET framework 4 or 4.5</li><li class="listitem">Windows PowerShell 2.0</li></ul></div><div class="informalexample" title="Note"><h3 class="title2"><a id="note17" class="calibre1"/>Note</h3><p class="calibre8">Windows<a id="id260" class="calibre1"/> ADK can be download from <a class="calibre1" href="https://www.microsoft.com/en-in/download/details.aspx?id=39982">https://www.microsoft.com/en-in/download/details.aspx?id=39982</a>, SQL connectivity tools can be downloaded from <a class="calibre1" href="http://www.microsoft.com/en-in/download/details.aspx?id=29065">http://www.microsoft.com/en-in/download/details.aspx?id=29065</a>. These are also available in SQL Server 2012 installation <a id="id261" class="calibre1"/>media.</p></div></div><div class="book" title="Installation procedure"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec09" class="calibre1"/>Installation procedure</h3></div></div></div><p class="calibre8">For evaluation purposes, we shall be deploying VMM Management Server, VMM console and library server on a<a id="id262" class="calibre1"/> single machine.</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Download MS System Center 2012 R2 Virtual Machine Management installation media and mount on SCVMM VM.</li><li class="listitem" value="2">Execute the setup file from installation media and click <span class="strong"><strong class="calibre9">Install</strong></span>.<div class="mediaobject"><img src="../images/00013.jpeg" alt="Installation procedure" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="3">Select the <a id="id263" class="calibre1"/><span class="strong"><strong class="calibre9">VMM Management Server</strong></span> feature to install, it will automatically select <span class="strong"><strong class="calibre9">VMM console</strong></span> as well.<div class="mediaobject"><img src="../images/00014.jpeg" alt="Installation procedure" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="4">Enter the name and organization details along with the product key provided by Microsoft for your system center licenses. VMM will be installed in evaluation mode if no product key is specified. You can choose to provide the product key at a later stage as well, post installation.</li><li class="listitem" value="5">Accept the <a id="id264" class="calibre1"/>evaluation/product license terms and proceed further.</li><li class="listitem" value="6">Choose <span class="strong"><strong class="calibre9">Yes</strong></span> or <span class="strong"><strong class="calibre9">No</strong></span> to participate in the <span class="strong"><strong class="calibre9">Customer Experience Improvement Program</strong></span>.</li><li class="listitem" value="7">Turn on or off for Microsoft Update, with turning it on you can update VMM using automatic updates.</li><li class="listitem" value="8">Specify the SCVMM installation location, by default it is in <code class="email">C:\Program Files\Microsoft System Center 2012 R2\Virtual Machine Manager</code>.</li><li class="listitem" value="9">Clicking <span class="strong"><strong class="calibre9">Next</strong></span> will start the prerequisite check and will return with an error or warning if any of the prerequisites defined in the previous section aren't completed. Complete any pending prerequisites if any and proceed further.</li><li class="listitem" value="10">Provide the database configuration on this page. You can choose to use existing DB created in SQL instance for VMM or may choose to create a new database. Change the SQL port if changed in SQL post-installation tasks.</li><li class="listitem" value="11">Verify Database configuration and proceed further.<div class="mediaobject"><img src="../images/00015.jpeg" alt="Installation procedure" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="12">Configure the<a id="id265" class="calibre1"/> service account for SCVMM services login. For SCVMM in HA mode, this has to be a domain account. Provide the location to store the Distributed Encryption key location in AD if deploying in HA mode. More on deployment in HA mode is covered in the next section.<div class="mediaobject"><img src="../images/00016.jpeg" alt="Installation procedure" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="13">Customize <a id="id266" class="calibre1"/>network ports for SCVMM communication if required.</li><li class="listitem" value="14">Create a library share on the library disk and provide name and location. This will act as a SCVMM library which can be used to store resources such as VHDs, templates and so on. By default VMM setup takes <code class="email">C:\Program Data\Virtual Machine Manager Library Files</code> as the library share location.<div class="mediaobject"><img src="../images/00017.jpeg" alt="Installation procedure" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="15">Review <a id="id267" class="calibre1"/>the installation configuration summary and start installation.</li><li class="listitem" value="16">Close the Wizard on successful installation.</li></ol><div class="calibre27"/></div><div class="informalexample" title="Note"><h3 class="title2"><a id="tip13" class="calibre1"/>Tip</h3><p class="calibre8">VMM Installation logs are located at <code class="email">%SystemDrive%\ProgramData\ VMMLogs\</code></p><p class="calibre8">There is a known issue of installation failing while having—SCVMM in computer name of SCVMM server. You can try renaming the server by removing "<code class="email">-</code>" from hostname or changing it to <code class="email">scvmm</code> or any other characters.</p></div></div><div class="book" title="Post-installation tasks"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec10" class="calibre1"/>Post-installation tasks</h3></div></div></div><p class="calibre8">Following are the <a id="id268" class="calibre1"/>post installation tasks:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Verify successful VMM installation by logging into VMM server using VMM console.</li><li class="listitem" value="2">Add SCVMM-admins group to SCVMM administrator in VMM console settings.</li><li class="listitem" value="3">Create RunAs accounts for hypervisor and more related operations.</li><li class="listitem" value="4">Update <a id="id269" class="calibre1"/>SCVMM with the latest updates and patches.</li></ol><div class="calibre27"/></div></div></div></div>

<div class="book" title="Planning and deploying SCVMM 2012 R2">
<div class="book" title="Highly available SCVMM architecture and deployment"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch02lvl2sec36" class="calibre1"/>Highly available SCVMM architecture and deployment</h2></div></div></div><p class="calibre8">As covered in <span class="strong"><em class="calibre12">VMM</em></span> <a id="id270" class="calibre1"/>
<span class="strong"><em class="calibre12">architecture and deployment models</em></span> section, SCVMM can be deployed in high availability mode using Windows Server Failover<a id="id271" class="calibre1"/> Clustering. By deploying SCVMM in high availability mode on the top of Microsoft Windows Failover Cluster Services, it can be protected against both hardware and software level failures.</p><p class="calibre8">Deploying SCVMM management <a id="id272" class="calibre1"/>server in a cluster has some prerequisite which needs to be fulfilled:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre9">VMM Service Account</strong></span>: The Virtual Machine Management service on the SCVMM server must be configured to run with a domain account. You cannot use a local system account to run a VMM service in HA mode. This service account has to be a member of the local administrator's group on SCVMM server Windows.</li><li class="listitem"><span class="strong"><strong class="calibre9">Container in Active Directory for Distributed Key Management</strong></span>: VMM stores all configurations and user account details such as RunAs account credentials in a SQL database. Credentials security is of utmost importance in every scenario, and SCVMM takes care of security by storing these credentials in encrypted form.</li></ul></div><p class="calibre8">There are two ways to encrypt these credentials:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre9">DPAPI</strong></span>: DPAPI uses<a id="id273" class="calibre1"/> computer hardware ID (on which SCVMM is installed) to encrypt the credentials.</li><li class="listitem"><span class="strong"><strong class="calibre9">DKM</strong></span>: In the case of DKM<a id="id274" class="calibre1"/> SCVMM, it stores the encrypted keys in a container in Active Directory. These encryption keys aren't tied to any physical parameter of any of SCVMM server.</li></ul></div><p class="calibre8">In a clustered deployment, SCVMM Virtual Machine Management service shall be running on multiple nodes which make DPAPI encryption technique unusable. For cluster deployment DKM is mandatory to be used.</p><p class="calibre8">As a prerequisite of deploying SCVMM in a cluster, a container needs to be created in Active Directory prior to installing SCVMM. This container will be used to store the encrypted keys for various SCVMM credentials.</p><p class="calibre8">Steps to deploy a highly available VMM Management Server are as follows:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Complete the prerequisite for VMM service account and AD container.</li><li class="listitem" value="2">Join VMM servers to Windows Server Failover Cluster.</li><li class="listitem" value="3">Execute the SCVMM installation setup; the setup automatically detects that setup is running on cluster node and gives the option to deploy VMM in highly available mode.</li><li class="listitem" value="4">Follow the<a id="id275" class="calibre1"/> SCVMM installation guidelines given<a id="id276" class="calibre1"/> in the last topic.</li><li class="listitem" value="5">Provide a cluster name and DKM container location when asked.</li><li class="listitem" value="6">Add other SCVMM node by executing the setup, the setup will automatically detect the cluster and SCVMM configuration deployed.</li><li class="listitem" value="7">Once deployed successfully, Failover Cluster Manager can be used to view cluster status and switch services as and when required.</li></ol><div class="calibre27"/></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Planning and configuring hypervisor compute layer with SCVMM" id="QMFO1-b479cf466c26404ca54119871a9b2715"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec21" class="calibre1"/>Planning and configuring hypervisor compute layer with SCVMM</h1></div></div></div><p class="calibre8">In this section we <a id="id277" class="calibre1"/>will learn to plan and configure<a id="id278" class="calibre1"/> hypervisor resources such as Hyper-V hosts and clusters, VMware and Citrix hypervisors. In a <a id="id279" class="calibre1"/>WAP-based cloud solution the hypervisor layer has to be in control of SCVMM for IaaS services provisioning <a id="id280" class="calibre1"/>and lifecycle management.</p><p class="calibre8">In this section we will cover various ways of adding and managing a hypervisor layer in SCVMM.</p></div>

<div class="book" title="Planning and configuring hypervisor compute layer with SCVMM" id="QMFO1-b479cf466c26404ca54119871a9b2715">
<div class="book" title="Planning and creating SCVMM host groups"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch02lvl2sec37" class="calibre1"/>Planning and creating SCVMM host groups</h2></div></div></div><p class="calibre8">In a large scale <a id="id281" class="calibre1"/>cloud deployment comprising hundreds of Hyper-V hosts and thousands of virtual machines or more, managing the hosts effectively in terms of resource <a id="id282" class="calibre1"/>provisioning and controlling becomes challenging. SCVMM host groups can be used to avoid such challenges, it provides flexibilities to group multiple hypervisor hosts and uses as a single entity for resource provisioning and management.</p><p class="calibre8">Host group planning would have a different foundation and strategy for organizations and service providers. A few common options are as follows:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Site or geo location</li><li class="listitem">Performance and capabilities such as fault tolerance and so on</li><li class="listitem">Isolated environment of the web zone environment such as DMZ</li><li class="listitem">Dedicated host groups for large tenants in a service provider's cloud</li><li class="listitem">Host groups with or without BC and DR</li><li class="listitem">Cloud management infra and tenant workload infra</li><li class="listitem">Many more</li></ul></div><p class="calibre8">We can add Hyper-V hosts or clusters and VMware/Citrix hosts in a host group and define various<a id="id283" class="calibre1"/> settings at host group level such as:</p><div class="book"><ul class="itemizedlist"><li class="listitem">General settings.</li><li class="listitem">Placement rules.</li><li class="listitem">Host reserve settings (CPU, memory, network and storage bandwidth, and so on.)</li><li class="listitem">Dynamic optimization.</li><li class="listitem">Power optimization.</li><li class="listitem">Network and storage resources and quota.</li><li class="listitem">PRO configuration.</li><li class="listitem">Custom properties.</li></ul></div><p class="calibre8">Host groups can be nested to providers' greater level of hierarchy and management. By default child host groups inherit parent host group settings and policies, which can be overridden at child <a id="id284" class="calibre1"/>host group level. Hypervisor hosts can be moved from one host group to another.</p><p class="calibre8">You can create SCVMM cloud consisting of multiple host groups. SCVMM cloud will be discussed in detail in <a class="calibre1" title="Chapter 4. Building VM Clouds and IaaS Offerings" href="part0040_split_000.html#164MG1-b479cf466c26404ca54119871a9b2715">Chapter 4</a>, <span class="strong"><em class="calibre12">Building VM Clouds and IaaS Offerings</em></span>.</p></div></div>

<div class="book" title="Planning and configuring hypervisor compute layer with SCVMM" id="QMFO1-b479cf466c26404ca54119871a9b2715">
<div class="book" title="Creating host groups"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch02lvl2sec38" class="calibre1"/>Creating host groups</h2></div></div></div><p class="calibre8">Following are the steps to<a id="id285" class="calibre1"/> create host groups:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Login to SCVMM server using VMM console and open fabric workspace.</li><li class="listitem" value="2">Expand <span class="strong"><strong class="calibre9">Servers</strong></span> in the <span class="strong"><strong class="calibre9">Fabric</strong></span> menu, right click on <span class="strong"><strong class="calibre9">All Hosts</strong></span>.<div class="mediaobject"><img src="../images/00018.jpeg" alt="Creating host groups" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="3">Click <span class="strong"><strong class="calibre9">Create Host Group</strong></span> and provide the host group friendly name.</li><li class="listitem" value="4">Configure host<a id="id286" class="calibre1"/> group properties.<div class="mediaobject"><img src="../images/00019.jpeg" alt="Creating host groups" class="calibre10"/></div><p class="calibre26"> </p></li></ol><div class="calibre27"/></div></div></div>

<div class="book" title="Planning and configuring hypervisor compute layer with SCVMM" id="QMFO1-b479cf466c26404ca54119871a9b2715">
<div class="book" title="Adding virtual machine hosts in host groups"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch02lvl2sec39" class="calibre1"/>Adding virtual machine hosts in host groups</h2></div></div></div><p class="calibre8">After creating host groups, we can add virtual machine hosts in their respective group to apply host group level<a id="id287" class="calibre1"/> policies. We can choose to add already configured hypervisor or cluster or perform bare metal provisioning using <a id="id288" class="calibre1"/>SCVMM. We can also create a <a id="id289" class="calibre1"/>Hyper-V cluster of already configured standalone Hyper-V hosts using SCVMM.</p><div class="book" title="Adding Hyper-V host in a host group"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec11" class="calibre1"/>Adding Hyper-V host in a host group</h3></div></div></div><p class="calibre8">Following are the steps to <a id="id290" class="calibre1"/>add a Hyper-V host in a host group:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Login to SCVMM server using VMM console and open fabric workspace.</li><li class="listitem" value="2">Right click on host group created and select <span class="strong"><strong class="calibre9">Add Hyper-V Hosts and Clusters</strong></span>.<div class="mediaobject"><img src="../images/00020.jpeg" alt="Adding Hyper-V host in a host group" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="3">Provide the Windows Server location in the given option.</li><li class="listitem" value="4">Provide credentials for accessing the host by using RunAs account or manual credentials.</li><li class="listitem" value="5">Fill in discovery scope details depending upon the server location provided earlier.</li><li class="listitem" value="6">Select target host groups and host setting.</li><li class="listitem" value="7">Review the <a id="id291" class="calibre1"/>configuration summary and finish the wizard to add the host.<div class="mediaobject"><img src="../images/00021.jpeg" alt="Adding Hyper-V host in a host group" class="calibre10"/></div><p class="calibre26"> </p></li></ol><div class="calibre27"/></div></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Planning and configuring cloud network fabric with SCVMM"><div class="book" id="RL0A2-b479cf466c26404ca54119871a9b2715"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec22" class="calibre1"/>Planning and configuring cloud network fabric with SCVMM</h1></div></div></div><p class="calibre8">Cloud network is the most <a id="id292" class="calibre1"/>crucial and complex piece of any private or service provider's cloud. Cloud network has to be efficient and flexible enough to<a id="id293" class="calibre1"/> handle daily <a id="id294" class="calibre1"/>changing networking needs<a id="id295" class="calibre1"/> of tenants and businesses. Software defined networking is a key pillar of providing automated and flexible networking for tenants with complete isolation and extensibilities. In this section we will learn various cloud network solution components for both private cloud and service providers' cloud in a WAP cloud.</p><p class="calibre8">Before getting into tenant workload networking needs, it is crucial to note that networking for cloud management infra and tenant workload infrastructure should be kept separate. Also known as Control Plane and Data Plane in networking languages, management infra <a id="id296" class="calibre1"/>networking should be kept separate in terms of provisioning and management. Demystifying the recommendation, assume a scenario where cloud network is down due to some issue with the physical network, and you are not able to make any changes to the cloud network solution to get it up and running because network controller VM was also running on the same problematic network. Follow the same cloud management and tenant workload infrastructure<a id="id297" class="calibre1"/> recommendation while designing cloud networking Control and Data plane.</p><p class="calibre8">Private cloud and service providers' cloud would have different networking requirement, let's have a look at major cloud networking requirement for both and their solution in our WAP cloud:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Cloud networking needs for a private cloud:<div class="book"><ul class="itemizedlist1"><li class="listitem">Secure and reliable virtual networking with easy management</li><li class="listitem">Isolated network capabilities for <a id="id298" class="calibre1"/><span class="strong"><strong class="calibre9">T&amp;D environments</strong></span></li><li class="listitem">Separate zone separated by firewall depending upon network traffic</li><li class="listitem">Faster and automated network provisioning</li><li class="listitem">IP address automated allocation and managed</li><li class="listitem">Extensibility to support custom needs</li><li class="listitem">Quality of service control</li><li class="listitem">Load balancing and physical network integration capabilities</li><li class="listitem">Hardware independent configurations</li></ul></div></li><li class="listitem">Cloud networking needs for a service provider's cloud:<div class="book"><ul class="itemizedlist1"><li class="listitem">Complete isolation between different tenants' networks while using the same physical network</li><li class="listitem">Extensibility to support hybrid networking model with a tenant's on-premises deployment</li><li class="listitem">Automated provisioning and tenant controlled management</li><li class="listitem">Advanced address translation capabilities with limited resources such as gateways and more for public facing services</li><li class="listitem">No IP range usage constraints</li><li class="listitem">Easily manageable and open to dynamic changes</li><li class="listitem">Quality of service as per the tenant's plans and subscriptions</li><li class="listitem">All enterprise class networking features such as load balancing and physical network integrated or hardware independent configurations</li></ul></div></li></ul></div><p class="calibre8">WAP along with<a id="id299" class="calibre1"/> system center and Hyper-V provides true cloud networking capabilities for requirements of private clouds and service <a id="id300" class="calibre1"/>providers' cloud. Networking capabilities of SCVMM such as logical networks and switches, network load balancing integration, network virtualization (the BIG thing), network virtualization gateways, port profiles along with automation and self-service experience of Windows Azure Pack provide solutions to all these requirements of organizations and service providers.</p></div>

<div class="book" title="Planning and configuring cloud network fabric with SCVMM">
<div class="book" title="Network Virtualization"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch02lvl2sec40" class="calibre1"/>Network Virtualization</h2></div></div></div><p class="calibre8">Network Virtualization allows us to create multiple independent networks on the same physical hardware, traveling and routing on the same physical NIC cards and network switches/routes with <a id="id301" class="calibre1"/>complete isolation to each other. Network Virtualization is the foundation of one of the most modern networking technologies today, that is Software Defined Networking. Network Virtualization enables transforming of traditional physical network devices such as routers, firewalls, and load balancers into software. Software Defined Networking enables all networking features from layer 2 to 7 with isolation and multi-tenancy. Network Virtualization is a must have technology for cloud service providers in order to facilitate flexible isolated networking for tenants without any dependency on each other.</p><p class="calibre8">Hyper-V <span class="strong"><strong class="calibre9">Network Virtualization using General Routing Encapsulation</strong></span> (<span class="strong"><strong class="calibre9">NVGRE</strong></span>) mechanism is used to<a id="id302" class="calibre1"/> facilitate virtualized networks for virtual machines. Windows Azure Pack with SCVMM and Hyper-V provides true self service automated virtual networks for private and service providers' cloud solutions. Hyper-V and VMM provides Network Virtualization gateways to enable virtualized network traffic communication with physical networks and the outside world.</p><p class="calibre8">Each VM connected to a virtualized network has two IP associated with it, one from the virtual network known as<a id="id303" class="calibre1"/> <span class="strong"><strong class="calibre9">customer address</strong></span> (<span class="strong"><strong class="calibre9">CA</strong></span>) and the other from a cloud <span class="strong"><strong class="calibre9">provider's address</strong></span> (<span class="strong"><strong class="calibre9">PA</strong></span>). Hyper-V Network Virtualization encapsulates the CA address network<a id="id304" class="calibre1"/> packet using PA, source and destination IP and virtual network ID while transmitting the packet so that it can travel on a physical network. On the receiver end it decapsulates the packet and transmits the packet with the CA address only in the other virtual machine.</p><p class="calibre8">Network Virtualization works at Hyper-V virtual switch level on Hyper-V hosts. Hyper-V virtual switch on Server 2012 onwards can be extended to provide additional functionalities apart from default layer 2 responsibilities. Additional extension can be programmed and implemented on a virtual switch for additional features for network and security such as network filtering, virtual firewalls, and so on. This enables a true Software Defined Network infrastructure.</p><p class="calibre8">There is no separate dedicated NIC requirements for implementing network virtualization, we can use same NIC or virtual switch for both types of traffic including traditional networks as<a id="id305" class="calibre1"/> well as virtualized networks.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip14" class="calibre1"/>Tip</h3><p class="calibre8">The provider address doesn't need to be the IP of physical NIC or team, in VMM it comes from the IP pool configured in the logical network.</p></div></div></div>

<div class="book" title="Planning and configuring cloud network fabric with SCVMM">
<div class="book" title="Configuring networking fabric in SCVMM"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch02lvl2sec41" class="calibre1"/>Configuring networking fabric in SCVMM</h2></div></div></div><p class="calibre8">In this section<a id="id306" class="calibre1"/> we will configure networking fabric in SCVMM for traditional and virtualized networks. There are multiple network resources<a id="id307" class="calibre1"/> when it comes to configuring networking<a id="id308" class="calibre1"/> fabric in VMM:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Logical network</li><li class="listitem">MAC address pools</li><li class="listitem">Load balancers</li><li class="listitem">VIP templates</li><li class="listitem">Logical switches</li><li class="listitem">Port profiles</li><li class="listitem">Port classifications</li><li class="listitem">Network service</li><li class="listitem">VM networks (available in VM and services workspace)</li></ul></div><div class="book" title="Logical networks"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec12" class="calibre1"/>Logical networks</h3></div></div></div><p class="calibre8">A logical network in<a id="id309" class="calibre1"/> SCVMM is the top level hierarchy of SCVMM network fabric. It can be used to represent a network site, or a<a id="id310" class="calibre1"/> different network domain. Logical networks can consist of multiple virtual machine networks. Multiple logical networks can be created such as production network, T&amp;D logical network. Logical networks can be assigned to hosts and host groups.</p><p class="calibre8">In a traditional network, create logical network corresponding to a physical network in your environment such as DMZ, backup, internal and so on. One virtual machine network per logical network shall be created in this scenario.</p><p class="calibre8">Network Virtualization is <a id="id311" class="calibre1"/>enabled at logical network level.</p><div class="book" title="Creating a logical network"><div class="book"><div class="book"><div class="book"><h4 class="title3"><a id="ch02lvl4sec01" class="calibre1"/>Creating a logical network</h4></div></div></div><p class="calibre8">The following steps have to<a id="id312" class="calibre1"/> be followed to create a logical network:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Login to VMM server using VMM console and select fabric workspace.</li><li class="listitem" value="2">Expand <span class="strong"><strong class="calibre9">Networking</strong></span> and click on <span class="strong"><strong class="calibre9">Logical Networks</strong></span>.</li><li class="listitem" value="3">Right click on <span class="strong"><strong class="calibre9">Logical Networks</strong></span> and click on <span class="strong"><strong class="calibre9">Create Logical Network</strong></span>.<div class="mediaobject"><img src="../images/00022.jpeg" alt="Creating a logical network" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="4">Type the name of the logical network such as <span class="strong"><strong class="calibre9">WAP-CLOUD-PROD</strong></span>, along with the optional description for easy identification in case of large deployments. Select <span class="strong"><strong class="calibre9">One connected network</strong></span> or VLAN based network or PVLAN network as per your network topology.<div class="mediaobject"><img src="../images/00023.jpeg" alt="Creating a logical network" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="5">Click <span class="strong"><strong class="calibre9">Next</strong></span> and add the<a id="id313" class="calibre1"/> network site in the logical network. Select a host group that can use this logical network along with the <span class="strong"><strong class="calibre9">VLAN</strong></span> ID and <span class="strong"><strong class="calibre9">IP subnet</strong></span>.<div class="mediaobject"><img src="../images/00024.jpeg" alt="Creating a logical network" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="6">Review the <a id="id314" class="calibre1"/>configurations on the <span class="strong"><strong class="calibre9">Summary</strong></span> page and click <span class="strong"><strong class="calibre9">Finish</strong></span> to create the network.</li></ol><div class="calibre27"/></div></div><div class="book" title="Creating an IP pool for the newly created logical network"><div class="book"><div class="book"><div class="book"><h4 class="title3"><a id="ch02lvl4sec02" class="calibre1"/>Creating an IP pool for the newly created logical network</h4></div></div></div><p class="calibre8">IP pools are<a id="id315" class="calibre1"/> created to provide a usable IP address range to VMM for IP allocation. IP pools assigned to a logical network are also used to provide PA (provider address) in Network Virtualization.</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open <span class="strong"><strong class="calibre9">Fabric</strong></span> | <span class="strong"><strong class="calibre9">Networking</strong></span> in VMM console.</li><li class="listitem" value="2">Expand the logical network and right click on the logical network to select <span class="strong"><strong class="calibre9">Create IP Pool</strong></span>.<div class="mediaobject"><img src="../images/00025.jpeg" alt="Creating an IP pool for the newly created logical network" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="3">Provide the<a id="id316" class="calibre1"/> IP pool name and description and select the logical network we created.</li><li class="listitem" value="4">On <span class="strong"><strong class="calibre9">Network Sites</strong></span>, click <span class="strong"><strong class="calibre9">Use an existing network site</strong></span>.</li><li class="listitem" value="5">Next enter a usable IP range.<div class="mediaobject"><img src="../images/00026.jpeg" alt="Creating an IP pool for the newly created logical network" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="6">Provide a gateway for the given IP range.</li><li class="listitem" value="7">Configure DNS, DNS Suffix and WINS settings if any.</li><li class="listitem" value="8">Review the settings on the <span class="strong"><strong class="calibre9">Summary</strong></span> page and create the IP pool.</li></ol><div class="calibre27"/></div></div><div class="book" title="Creating a Virtualized VM Network and IP Pool on the Logical Network"><div class="book"><div class="book"><div class="book"><h4 class="title3"><a id="ch02lvl4sec03" class="calibre1"/>Creating a Virtualized VM Network and IP Pool on the Logical Network</h4></div></div></div><p class="calibre8">VM networks are used by<a id="id317" class="calibre1"/> virtual machine network adaptors to connect with a virtualized VM network use a logical network for PA. In a traditional network scenario one VM<a id="id318" class="calibre1"/> network is created per logical network and used by virtual machines. It is also possible to automatically create virtual network corresponding to the logical network.</p></div><div class="book" title="Create a VM network"><div class="book"><div class="book"><div class="book"><h4 class="title3"><a id="ch02lvl4sec04" class="calibre1"/>Create a VM network</h4></div></div></div><p class="calibre8">The following are the steps to<a id="id319" class="calibre1"/> create a VM network:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Login to the VMM console and select <span class="strong"><strong class="calibre9">Logical Network</strong></span>.</li><li class="listitem" value="2">Right click on <span class="strong"><strong class="calibre9">Logical Network</strong></span> and select <span class="strong"><strong class="calibre9">Create VM network</strong></span>.</li><li class="listitem" value="3">Provide name and description for VM network for identification. Select corresponding logical network.</li><li class="listitem" value="4">Configure the Isolation setting, click <span class="strong"><strong class="calibre9">Isolation using Hyper-V network virtualization</strong></span> for isolated networks.<div class="mediaobject"><img src="../images/00027.jpeg" alt="Create a VM network" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="5">Provide the Virtual Network <span class="strong"><strong class="calibre9">Name</strong></span> and <span class="strong"><strong class="calibre9">Subnet</strong></span>.<div class="mediaobject"><img src="../images/00028.jpeg" alt="Create a VM network" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="6">Select a Hyper-V Network Virtualization gateway if any.</li><li class="listitem" value="7">Review the configuration and finish the wizard for creating the VM network.</li></ol><div class="calibre27"/></div><p class="calibre8">Create an IP pool for<a id="id320" class="calibre1"/> each VM network created by using the Create IP Pool wizard for VM network.</p><p class="calibre8">The next steps in a private or service provider's cloud networking deployment is to create and attach all logical network and VM networks as per cloud network design and attach to host groups accordingly.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip15" class="calibre1"/>Tip</h3><p class="calibre8">VM Network management wizard is available in the "VM and Services" workspace in VMM Console, not in fabric workspace.</p></div><p class="calibre8">Apart from logical networks, VM networks and IP pools, VMM provides multiple other network resources mentioned above to add greater management control and flexibility on your cloud's network fabric.</p></div></div><div class="book" title="MAC address pool"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec13" class="calibre1"/>MAC address pool</h3></div></div></div><p class="calibre8">MAC address pool allows <a id="id321" class="calibre1"/>you to provide a custom static MAC address for your virtual machine. While the VMM given MAC address pool is created by default, you can always create a new one as per requirement.</p></div><div class="book" title="Load balancers"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec14" class="calibre1"/>Load balancers</h3></div></div></div><p class="calibre8">By using load balancing, you<a id="id322" class="calibre1"/> can easily distribute traffic between multiple servers for a scaled application. SCVMM has inbuilt support of using Microsoft NLB as a native load balancing provider, you can also add custom configurations for supported third party load balancer integration such as F5, Citrix and more. Custom configuration providers need to be installed for third party integration.</p></div><div class="book" title="VIP template"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec15" class="calibre1"/>VIP template</h3></div></div></div><p class="calibre8">VIP templates are configurations <a id="id323" class="calibre1"/>which are utilized by load balancers for virtual IP needs. They can be used for configuring VIP configuration for load balancing traffic rules such for HTTPS and so on.</p></div><div class="book" title="Logical switches"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec16" class="calibre1"/>Logical switches</h3></div></div></div><p class="calibre8">These enable centralized <a id="id324" class="calibre1"/>networking deployment on your Hyper-V hosts. Logical switches can be configured to use specific port mapping, classifications and extensions.</p></div><div class="book" title="Port profiles"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec17" class="calibre1"/>Port profiles</h3></div></div></div><p class="calibre8">Port profiles enable deploying <a id="id325" class="calibre1"/>consistent network settings such as QoS, and advanced security features across all Hyper-V hosts.</p></div><div class="book" title="Port classifications"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec18" class="calibre1"/>Port classifications</h3></div></div></div><p class="calibre8">Port classifications can be used to classify ports<a id="id326" class="calibre1"/> such as 10GB networks, low bandwidth networks.</p></div><div class="book" title="Network service"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec19" class="calibre1"/>Network service</h3></div></div></div><p class="calibre8">In network services, third party<a id="id327" class="calibre1"/> network devices can be integrated with SCVMM such as TOR switches and so on.</p></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Planning and configuring cloud storage fabric with SCVMM" id="SJGS1-b479cf466c26404ca54119871a9b2715"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec23" class="calibre1"/>Planning and configuring cloud storage fabric with SCVMM</h1></div></div></div><p class="calibre8">Microsoft Windows <a id="id328" class="calibre1"/>Azure Pack based cloud solution support both block based storage and file based storage configured with<a id="id329" class="calibre1"/> VMM for storing virtual machines and other cloud IaaS resources.</p><p class="calibre8">Storage requirements <a id="id330" class="calibre1"/>and solutions are likely to be different for<a id="id331" class="calibre1"/> private clouds and service provider clouds. While it is common to see traditional enterprise class SAN storage solutions in private clouds, software defined storage solutions on commodity hardware are also in use for both private and service provider cloud solution. VMM supports a wide range of storage solution integration for automated provisioning and management solving storage challenges for both private clouds and service<a id="id332" class="calibre1"/> provider clouds.</p><p class="calibre8">In the case of block based storage, VMM <a id="id333" class="calibre1"/>can take advantage of <span class="strong"><strong class="calibre9">Storage Area Network</strong></span> (<span class="strong"><strong class="calibre9">SAN</strong></span>) using Fibre Channel, iSCSI and <a id="id334" class="calibre1"/>SAS storage connectivity solutions for storing virtual machines and resources.</p><p class="calibre8">For file based storages, VMM<a id="id335" class="calibre1"/> can be integrated with storage solutions supporting SMB 3.0 protocol for file based storage access. Windows server file <a id="id336" class="calibre1"/>server provides SMB capabilities, enabling shared storage capabilities without purchasing expensive storage array solutions.</p></div>

<div class="book" title="Planning and configuring cloud storage fabric with SCVMM" id="SJGS1-b479cf466c26404ca54119871a9b2715">
<div class="book" title="Cloud storage deployment options in VMM"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch02lvl2sec42" class="calibre1"/>Cloud storage deployment options in VMM</h2></div></div></div><p class="calibre8">There are various options available in VMM to store virtual machines and other cloud resources. Every storage appears to Hyper-V hosts as local or remote storage, local storage stands for storage devices<a id="id337" class="calibre1"/> locally attached or assigned to hosts where remote storage defines remotely connected LUNs. Let's have a look at major options for providing storage fabric in a VMM environment.</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre9">Directly attached storage (DAS)</strong></span>: This is storage disks connected directly to hypervisor hosts, commonly in a form of disk drive inside a server chassis connected via inbuilt RAID controller or SAS based JBOD connectivity. This is dedicated to each <a id="id338" class="calibre1"/>host and isn't shared. This doesn't provide any high availability or host failure tolerance, hence is not recommended for production usage.</li><li class="listitem"><span class="strong"><strong class="calibre9">Traditional SAN arrays</strong></span>: Enterprise class storage solutions from leading vendors such as EMC, NetApp, Hitachi and so on, comes under this category. These solutions can be used to store virtual machines on LUNs using FC/iSCSI and other <a id="id339" class="calibre1"/>connectivity mechanisms. VMM can be integrated with iSCSI target arrays by supporting both static and dynamic discovery.</li><li class="listitem"><span class="strong"><strong class="calibre9">Storage solutions with SMI-S or SMP providers</strong></span>: Storage solutions which support integration <a id="id340" class="calibre1"/>with SCVMM using SMI-S or SMP protocol comes under this category. SMI-S enables automated storage provisioning and management using VMM console enabling a true automated cloud solution. It is recommended to integrate any supported existing traditional storage with VMM in a private cloud<a id="id341" class="calibre1"/> for automation at storage layer. See vendor specific guidelines for configuring SMI-S for VMM integration.</li><li class="listitem"><span class="strong"><strong class="calibre9">File storage (SMB 3.0)</strong></span>: With <a id="id342" class="calibre1"/>Windows Server 2012 R2 Hyper-V supports storing virtual machines on file shares accessible via SMB protocol. Windows Server based file server clusters can be deployed and integrated with VMM for storing cloud virtual machines and resources.</li><li class="listitem"><span class="strong"><strong class="calibre9">Scale out file server</strong></span>: Scale out file server is a Windows Server feature which ensures continuous availability of file share storage across multiple hosts simultaneously. SOFS<a id="id343" class="calibre1"/> can take advantages of JBOD connected for file server nodes to provide always available file shares to Hyper-V hosts. SOFS uses SMB protocol for providing storage access. SOFS can be easily provisioned and managed using System Center Virtual Machine Manager.</li><li class="listitem"><span class="strong"><strong class="calibre9">Software Defined Storage (Microsoft Storage Spaces)</strong></span>: In today's era of Software Defined<a id="id344" class="calibre1"/> infrastructure, Microsoft provides Windows storage spaces which can be utilized for delivering storage solutions on commodity hardware without purchasing expensive storage arrays. This can be utilized by cloud service providers for providing shared storage features and capabilities without investing<a id="id345" class="calibre1"/> in traditional storage solutions. Microsoft storage space groups physical disks together in a storage pool which can be used to create space for data storage requirements. It can be configured to protect failure at each level by maintain multiple copies of data. Storages spaces can be used to provide shared storage capabilities by using multiple nodes connected to JBOD trays.</li></ul></div><div class="informalexample" title="Note"><h3 class="title2"><a id="tip16" class="calibre1"/>Tip</h3><p class="calibre8">A list of supported<a id="id346" class="calibre1"/> storage solutions for VMM integration can be found at <a class="calibre1" href="http://social.technet.microsoft.com/wiki/contents/articles/16100.system-center-2012-vmm-supported-storage-arrays.aspx">http://social.technet.microsoft.com/wiki/contents/articles/16100.system-center-2012-vmm-supported-storage-arrays.aspx</a></p></div></div></div>

<div class="book" title="Planning and configuring cloud storage fabric with SCVMM" id="SJGS1-b479cf466c26404ca54119871a9b2715">
<div class="book" title="Configuring storage fabric in VMM"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch02lvl2sec43" class="calibre1"/>Configuring storage fabric in VMM</h2></div></div></div><p class="calibre8">Let's have a look at the<a id="id347" class="calibre1"/> various configurable parameters <a id="id348" class="calibre1"/>available in VMM for storage fabric.</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre9">Storage classifications</strong></span>: Storage classification can be used to provide a friendly name or container to storage resources available such as gold storage, silver storage<a id="id349" class="calibre1"/> differentiating upon factors such as capacity, performance, resiliency and more. This can ease daily administrative tasks while assigning storage by representing complex architecture in a simplified way. You can associate storage pools with classification for mapping resources with a friendly name. To create a storage classification you need to perform the following steps:<div class="book"><ol class="orderedlist1"><li class="listitem" value="1">Login to VMM console and open <span class="strong"><strong class="calibre9">Fabric</strong></span> workspace.</li><li class="listitem" value="2">Right click on <span class="strong"><strong class="calibre9">Storage</strong></span> | <span class="strong"><strong class="calibre9">Classification and Pools</strong></span> to create classification.</li><li class="listitem" value="3">Provide a friendly name and description and click <span class="strong"><strong class="calibre9">Add</strong></span>.</li></ol><div class="calibre27"/></div><div class="mediaobject"><img src="../images/00029.jpeg" alt="Configuring storage fabric in VMM" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem"><span class="strong"><strong class="calibre9">Storage provider</strong></span>: Storage<a id="id350" class="calibre1"/> provider provides options to add storage devices in VMM for automated LUN provisioning and management. VMM 2012 R2 provides flexibility to<a id="id351" class="calibre1"/> add the following storage solutions:<div class="book"><ul class="itemizedlist1"><li class="listitem">Windows based file server</li><li class="listitem">SAN or NAS device discovered and managed by a SMI-S provider</li><li class="listitem">SAN device managed by native SMP providers</li><li class="listitem">Fibre channel fabric<a id="id352" class="calibre1"/> discovered and managed by SMI-S providers</li></ul></div></li></ul></div><p class="calibre8">By integrating storage devices in VMM, we can provision and assign LUNs to Hyper-V hosts using VMM console, provisioning and management of storage devices can be performed using VMM, which allows the flexibility of having completed automated storage deployment and management.</p><div class="book"><ul class="itemizedlist"><li class="listitem">Adding a storage device in VMM:<div class="book"><ol class="orderedlist1"><li class="listitem" value="1">Launch VMM console and connect to VMM server with admin permissions.</li><li class="listitem" value="2">Open fabric workspace, right click on <span class="strong"><strong class="calibre9">Providers</strong></span> under the <span class="strong"><strong class="calibre9">Storage</strong></span> section.</li><li class="listitem" value="3">Select <span class="strong"><strong class="calibre9">Add Storage Devices</strong></span>, and select the type of device from the given option.<div class="mediaobject"><img src="../images/00030.jpeg" alt="Configuring storage fabric in VMM" class="calibre10"/></div><p class="calibre11"> </p></li><li class="listitem" value="4">Provide discovery<a id="id353" class="calibre1"/> scope, credentials and more details depending upon the storage provider type.</li><li class="listitem" value="5">Select an available <a id="id354" class="calibre1"/>storage device and finish the wizard to add.</li><li class="listitem" value="6">Verify the array listed in the VMM storage fabric workspace.</li></ol><div class="calibre27"/></div></li><li class="listitem">Post storage device integration tasks:<div class="book"><ul class="itemizedlist1"><li class="listitem">Create<a id="id355" class="calibre1"/> storage pools and LUNs</li><li class="listitem">Map the storage pool with classification created earlier</li><li class="listitem">Assign LUNs and storage pools to the hosts</li><li class="listitem">Manage and monitor storage resources</li></ul></div></li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Planning and Deploying Service Provider Foundation"><div class="book" id="TI1E2-b479cf466c26404ca54119871a9b2715"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec24" class="calibre1"/>Planning and Deploying Service Provider Foundation</h1></div></div></div><p class="calibre8">System Center Service Provider Foundation 2012 R2 is part of the System Center suite, available in System Center 2012 R2 Orchestrator installation media. SPF add multi-tenancy capabilities to System Center products such as SCVMM, SMA and more. SPF exposes an extensible OData Web Service that interacts with Virtual Machine Manager.</p><p class="calibre8">Service providers and <a id="id356" class="calibre1"/>organization can design and develop their own cloud portals, and take<a id="id357" class="calibre1"/> advantage of SPF for utilizing IaaS capabilities of SCVMM. Windows Azure Pack uses SPF to integrate with SCVMM for provisioning and managing cloud IaaS resources such as virtual machines, virtual networks and so on.</p></div>

<div class="book" title="Planning and Deploying Service Provider Foundation">
<div class="book" title="SPF architecture and deployment options"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch02lvl2sec44" class="calibre1"/>SPF architecture and deployment options</h2></div></div></div><p class="calibre8">SPF is a collection of four<a id="id358" class="calibre1"/> web services as follows:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre9">SPF Admin Web Service</strong></span>: Admin <a id="id359" class="calibre1"/>Web Service is responsible for <a id="id360" class="calibre1"/>creating and managing tenants, roles, stamps (SCVMM) and more. It can be accessed on <code class="email">https://SPFSERVER:8090/SC2012R2/Admin/Microsoft.Management.Odata.svc</code>. User running SPF Admin Web Service application pool must be a member of local administrator and <code class="email">SPF_Admin</code> local group on SPF server.</li><li class="listitem"><span class="strong"><strong class="calibre9">SPF VMM Web Service</strong></span>: VMM Web Service is responsible for getting operations performed by<a id="id361" class="calibre1"/> Virtual Machine Manager such as creating virtual machines, networks, user roles and more. This service is also responsible to maintain and replicating change performed at components such as WAP and SCVMM. It can be accessed on</li><li class="listitem"><code class="email">https://SPFSERVER:8090/SC2012R2/VMM/Microsoft.Management.Odata.svc</code>. The user running SPF Admin Web Service application pool must be a member of the local administrator, <code class="email">SPF_VMM</code> local group and VMM administrators on SPF and VMM server respectively.</li><li class="listitem"><span class="strong"><strong class="calibre9">SPF Usage Service</strong></span>: Usage <a id="id362" class="calibre1"/>Web Service integrates with System Center Operations Manager Data warehouse and is used by WAP or third party billing providers for gathering resources usage data. A user account running Usage Service must be a part of the local administrator and <code class="email">SPF_Usage</code> group on the <a id="id363" class="calibre1"/>SPF server along with access on the SC Operations Manager data warehouse database.</li><li class="listitem"><span class="strong"><strong class="calibre9">SPF Provider Service</strong></span>: Provider Web Service is used by resource providers for delivering IaaS services. Provider services provide Microsoft ASP.NET Web API and not OData as in the <a id="id364" class="calibre1"/>case of other web services. Provider Service also uses the VMM and admin service. Users running the SPF Provider Web Service application pool must be a member of local administrator and SPF_Provider, SPF_VMM, and SPF_Admin local groups on the SPF Server.</li></ul></div><p class="calibre8">System Center Service Provider Foundation can be deployed in two ways:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre9">Standalone Single Server deployment</strong></span>: In case of standalone deployment, only one server will be deployed in a solution with no redundancy. This is not recommended for production <a id="id365" class="calibre1"/>and is used for test and evaluation purposes only. All web services are always installed on the same server.</li><li class="listitem"><span class="strong"><strong class="calibre9">Highly available scaled deployment</strong></span>: SPF support highly available deployment with the use <a id="id366" class="calibre1"/>of load balancers. Hardware LBs or Microsoft NLB can be used for providing load balancing between multiple SPF servers. Multiple SPF servers can be deployed behind a load balancer pointing to a highly available database for providing HA capabilities to SPF deployment at each layer. This is the recommended deployment model for a production scenario.</li></ul></div></div></div>

<div class="book" title="Planning and Deploying Service Provider Foundation">
<div class="book" title="Installing Service Provider Foundation 2012 R2"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch02lvl2sec45" class="calibre1"/>Installing Service Provider Foundation 2012 R2</h2></div></div></div><p class="calibre8">Like every other system <a id="id367" class="calibre1"/>center or Microsoft product, SPF also has a set of prerequisites which need to be met before starting installation. SPF installation binaries are<a id="id368" class="calibre1"/> included in System Center 2012 R2 Orchestrator media.</p><div class="book" title="Installation prerequisites"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec20" class="calibre1"/>Installation prerequisites</h3></div></div></div><p class="calibre8">The following are<a id="id369" class="calibre1"/> the installation prerequisites.</p><p class="calibre8">Create SPF service accounts as follows (Active Directory Accounts):</p><div class="informalexample"><table border="1" class="calibre16"><colgroup class="calibre17"><col class="calibre18"/><col class="calibre18"/><col class="calibre18"/></colgroup><thead class="calibre19"><tr class="calibre20"><th valign="bottom" class="calibre25">
<p class="calibre22">Account name</p>
</th><th valign="bottom" class="calibre25">
<p class="calibre22">Purpose</p>
</th><th valign="bottom" class="calibre25">
<p class="calibre22">Permissions</p>
</th></tr></thead><tbody class="calibre23"><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Spfsvc</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">SPF service account for running IIS application pool</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Member of local administrator + SPF local groups + SCVMM admin + SQLDB sysadmin</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Spflocal</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Local<a id="id370" class="indexterm"/> account for SPF integration</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Member of local administrator + SPF local groups + SCVMM admin</p>
</td></tr></tbody></table></div><p class="calibre8">Separate service accounts can also be created for admin, provider, usage and VMM application pool if required.</p></div><div class="book" title="Software prerequisites"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec21" class="calibre1"/>Software prerequisites</h3></div></div></div><p class="calibre8">The following software needs<a id="id371" class="calibre1"/> to be installed before starting Service Provider Foundation installation:</p><p class="calibre8">Windows features:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Management OData Internet Information Services (IIS) extension</li><li class="listitem">NET Framework 4.5 features, WCF Services, and HTTP activation</li><li class="listitem">For Web Server (IIS) server install the following components of IIS:<div class="book"><ul class="itemizedlist1"><li class="listitem">Basic authentication</li><li class="listitem">Windows authentication</li><li class="listitem">Application deployment ASP.NET 4.5</li><li class="listitem">Application development ISAPI extensions</li><li class="listitem">Application deployment ISAPI filters</li><li class="listitem">IIS Management scripts and Tools Role Service</li></ul></div></li><li class="listitem">Web Services:<div class="book"><ul class="itemizedlist1"><li class="listitem">WCF data services 5.0 for OData V3</li><li class="listitem">ASP.NET MVC 4</li></ul></div></li><li class="listitem">Virtual Machine Manager 2012 R2 Console</li><li class="listitem">Certificates SPF creates self-signed certificate, CA provided SSL certificates should be created for production deployments</li></ul></div><div class="informalexample" title="Note"><h3 class="title2"><a id="note18" class="calibre1"/>Note</h3><p class="calibre8">The local account is used by Windows Azure Pack for registering SPF.</p></div></div><div class="book" title="Installation procedure"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec22" class="calibre1"/>Installation procedure</h3></div></div></div><p class="calibre8">The following<a id="id372" class="calibre1"/> is the installation procedure:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Login to SPF server and mount System Center Orchestrator media.</li><li class="listitem" value="2">Run <code class="email">SetupOrchestrator.exe</code> from the mounted media.</li><li class="listitem" value="3">Click <span class="strong"><strong class="calibre9">Service Provider Foundation</strong></span> under the <span class="strong"><strong class="calibre9">Standalone installation</strong></span> section.</li><li class="listitem" value="4">This will launch the <span class="strong"><strong class="calibre9">SPF Installation wizard</strong></span>, click <span class="strong"><strong class="calibre9">Install</strong></span> to proceed further.</li><li class="listitem" value="5">Accept the agreement <a id="id373" class="calibre1"/>and proceed.</li><li class="listitem" value="6">Setup will check for prerequisite check, proceed if all checks are completed successfully. Review errors in case of any failure.</li><li class="listitem" value="7">Provide database <span class="strong"><strong class="calibre9">Server</strong></span> IP and <span class="strong"><strong class="calibre9">Port number</strong></span> along with <span class="strong"><strong class="calibre9">Database name</strong></span>.<div class="mediaobject"><img src="../images/00031.jpeg" alt="Installation procedure" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="8">Provide the installation folder for SPF files and a port number. (By default <code class="email">C:\intepub</code> and <code class="email">8090</code>). Select <span class="strong"><strong class="calibre9">Generate self signed certificate</strong></span> or provide pre-created SSL for SPF.</li><li class="listitem" value="9">SPF automatically creates local groups on the SPF server for administrative permissions, provide SPF Admin service account and admin account, SCVMM-Admins group <a id="id374" class="calibre1"/>and SPF local account.</li><li class="listitem" value="10">Provide service account details for each service that is, admin web, VMM, usage and provider.<div class="mediaobject"><img src="../images/00032.jpeg" alt="Installation procedure" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="11">Review the installation configuration and summary and proceed further for installation.</li><li class="listitem" value="12">Close the wizard on successful installation.</li></ol><div class="calibre27"/></div></div><div class="book" title="Post-installation tasks"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec23" class="calibre1"/>Post-installation tasks</h3></div></div></div><p class="calibre8">The following are the <a id="id375" class="calibre1"/>post installation tasks:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Verify successful installation and application pools status in IIS.<div class="mediaobject"><img src="../images/00033.jpeg" alt="Post-installation tasks" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="2">Verify local groups created in the SPF server, add <code class="email">spflocal user</code> in all groups.<div class="mediaobject"><img src="../images/00034.jpeg" alt="Post-installation tasks" class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="3">Enable <span class="strong"><strong class="calibre9">Basic Authentication</strong></span> for the SPF website, this is a requirement for WAP integration.</li></ol><div class="calibre27"/></div></div></div></div>
<div class="book" title="Summary" id="UGI01-b479cf466c26404ca54119871a9b2715"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec25" class="calibre1"/>Summary</h1></div></div></div><p class="calibre8">In this chapter we learned about planning for cloud fabric for private cloud needs and service providers. We covered infrastructure planning at each layer starting from hardware to hypervisors, network and storage. Hyper-V deployment best practices were also covered which will help in deploying a reliable and stable hypervisor layer.</p><p class="calibre8">We learned about SCVMM and SPF architecture and has installation walkthrough for both products. We learned about planning and configuration of compute, network and storage for cloud fabric in SCVMM.</p><p class="calibre8">In the next chapter we will be covering installation and configuration of Windows Azure Pack portals, API's and authentication sites.</p></div></body></html>