<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Chapter&#xA0;3.&#xA0;Creating and Managing Applications"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03" class="calibre1"/>Chapter 3. Creating and Managing Applications</h1></div></div></div><p class="calibre6">This chapter presents a number of recipes that show you how to get started with application development using the rhc command-line client. You will learn how to create your own OpenShift application using a single command, how to use application management operations such as start, stop, and delete, how to set up your own domain name for your application, and how to track and roll back deployments.</p><p class="calibre6">The specific recipes within this chapter are:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Creating an OpenShift application using the rhc command-line client</li><li class="listitem">Specifying your own template Git repository URL</li><li class="listitem">Starting/stopping/restarting an application</li><li class="listitem">Adding and managing add-on cartridges</li><li class="listitem">Adding a cron cartridge to an application</li><li class="listitem">Using downloadable cartridges with OpenShift applications</li><li class="listitem">Viewing application details</li><li class="listitem">Cloning the application Git repository using rhc</li><li class="listitem">SSH into the application gear using rhc</li><li class="listitem">Running a command in the application's SSH session using rhc</li><li class="listitem">Setting application-specific environment variables</li><li class="listitem">Taking and restoring application backups</li><li class="listitem">Tracking and rolling back application deployments</li><li class="listitem">Configuring the default Git branch for deployment</li><li class="listitem">Doing manual deployments</li><li class="listitem">Configuring and doing binary deployments</li><li class="listitem">Using your own custom domain name</li><li class="listitem">Cleaning up the application</li><li class="listitem">Deleting the application</li></ul></div></div>

<div class="book" title="Chapter&#xA0;3.&#xA0;Creating and Managing Applications">
<div class="book" title="Introduction"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch03lvl1sec35" class="calibre1"/>Introduction</h1></div></div></div><p class="calibre6">OpenShift (or any other <a id="id199" class="calibre1"/>
<span class="strong"><strong class="calibre7">Platform as a Service</strong></span> (<span class="strong"><strong class="calibre7">PaaS</strong></span>)) is<a id="id200" class="calibre1"/> based on one core principle, in that it should simplify the application life cycle management, including application scaling to help developers build their business applications faster. They all help developers achieve higher productivity by provisioning, managing, and scaling the infrastructure as well as application stack for them. It enables software developers to take their ideas, write code on the local machine, and then deploy the application to the cloud in minutes. PaaS can take you a long way without requiring much work by providing a good foundation to your next big business idea. PaaS can also help enforce best practices, such as continuous integration, in your application from inception. In addition, PaaS can also help you get quick feedback from the customer, and you can iterate faster.</p><p class="calibre6">OpenShift provides application developers all the services and tools required to develop and deploy their applications. Apps running on OpenShift can leverage their managed stack, and they do not require system admins to manage the underlying platform in order to keep their apps secure and reliable. OpenShift provides commands that can help application developers take backups of their applications periodically. To understand how application developers can take backups, refer to the <span class="strong"><em class="calibre10">Taking and restoring application backups</em></span> recipe.</p><p class="calibre6">The <code class="email">rhc</code> command-line tool provides all the commands required to work with your application. To view all the application-related commands, open a command-line terminal and run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc app -h</strong></span>
<span class="strong"><strong class="calibre7">Usage: rhc app &lt;action&gt;</strong></span>
<span class="strong"><strong class="calibre7">Creates and controls an OpenShift application. To see the list of all applications use the rhc domain show command. Note that</strong></span>
<span class="strong"><strong class="calibre7">delete is not reversible and will stop your application and then remove the application and repo from the remote server. No</strong></span>
<span class="strong"><strong class="calibre7">local changes are made.</strong></span>
</pre></div><p class="calibre6">We will cover all these commands in this chapter, so stay tuned!</p><p class="calibre6">Every OpenShift application runs inside a gear, which is a container built using SELinux, Control Groups, and pam_namespace Linux technologies. Let's look at all these technologies one by one:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre7">SELinux</strong></span>:<span class="strong"><strong class="calibre7">SELinux </strong></span>(<span class="strong"><strong class="calibre7">Security Enhanced Linux</strong></span>) is a Linux kernel security module originally<a id="id201" class="calibre1"/> developed by the United States National Security Agency. OpenShift uses SELinux to achieve gear isolation and a hardened security layer around gears. This limits application gears from accessing parts of the system they should not access, such as the lower-level system and other application gears running on the same node. In a multitenant environment, such as OpenShift, this behavior is very important to ensure security and reliability when running multiple applications on the same infrastructure.</li><li class="listitem"><span class="strong"><strong class="calibre7">Control Groups</strong></span>: OpenShift uses <a id="id202" class="calibre1"/><span class="strong"><strong class="calibre7">Control Groups</strong></span> (<span class="strong"><strong class="calibre7">cgroups</strong></span>), a Linux kernel feature, to allocate resources such as CPU time, memory, bandwidth, or a combination of these resources among process groups. The amount of RAM and disk space a gear is allocated depends on the gear size. In the free tier, you only have access to small gears, which have 512 MB RAM and 1 GB of disk space. We will look at gear size in the <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client </em></span>recipe.</li><li class="listitem"><span class="strong"><strong class="calibre7">pam_namespace</strong></span>: pam_namespace<a id="id203" class="calibre1"/> is used to allow each user or session to maintain its own namespace for directory structures, keeping them from being able to view or impede upon each other's namespace. By using this, OpenShift is able to provide the <code class="email">/tmp</code> directory to each gear.</li></ul></div><p class="calibre6">A gear runs different software components (or cartridges) for your application. A cartridge is what makes a gear useful, that is, it provides the software components that an application might need. Every OpenShift application requires one web cartridge and can have zero or more add-on and downloadable cartridges. There are three types of cartridges:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre7">Web cartridge</strong></span>: These are<a id="id204" class="calibre1"/> used to serve web requests. You can't create an<a id="id205" class="calibre1"/> OpenShift application without a web cartridge. You have to specify the web cartridge at application creation time. They are available for Java, PHP, Python, Ruby, Node.js, and Perl, where you can list all the web cartridges by running the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridges|grep web</strong></span>
<span class="strong"><strong class="calibre7">jbossas-7           JBoss Application Server 7              web</strong></span>
<span class="strong"><strong class="calibre7">jbosseap-6 (*)      JBoss Enterprise Application Platform 6 web</strong></span>
<span class="strong"><strong class="calibre7">jenkins-1           Jenkins Server                          web</strong></span>
<span class="strong"><strong class="calibre7">nodejs-0.10         Node.js 0.10                            web</strong></span>
<span class="strong"><strong class="calibre7">nodejs-0.6          Node.js 0.6                             web</strong></span>
<span class="strong"><strong class="calibre7">perl-5.10           Perl 5.10                               web</strong></span>
<span class="strong"><strong class="calibre7">php-5.3             PHP 5.3                                 web</strong></span>
<span class="strong"><strong class="calibre7">zend-5.6            PHP 5.3 with Zend Server 5.6            web</strong></span>
<span class="strong"><strong class="calibre7">php-5.4             PHP 5.4                                 web</strong></span>
<span class="strong"><strong class="calibre7">zend-6.1            PHP 5.4 with Zend Server 6.1            web</strong></span>
<span class="strong"><strong class="calibre7">python-2.6          Python 2.6                              web</strong></span>
<span class="strong"><strong class="calibre7">python-2.7          Python 2.7                              web</strong></span>
<span class="strong"><strong class="calibre7">python-3.3          Python 3.3                              web</strong></span>
<span class="strong"><strong class="calibre7">ruby-1.8            Ruby 1.8                                web</strong></span>
<span class="strong"><strong class="calibre7">ruby-1.9            Ruby 1.9                                web</strong></span>
<span class="strong"><strong class="calibre7">jbossews-1.0        Tomcat 6 (JBoss EWS 1.0)                web</strong></span>
<span class="strong"><strong class="calibre7">jbossews-2.0        Tomcat 7 (JBoss EWS 2.0)                web</strong></span>
<span class="strong"><strong class="calibre7">diy-0.1             Do-It-Yourself 0.1                      web</strong></span>
</pre></div></li><li class="listitem"><span class="strong"><strong class="calibre7">Add-on cartridge</strong></span>: These are additional <a id="id206" class="calibre1"/>cartridges provided by OpenShift. You<a id="id207" class="calibre1"/> can add them depending on your requirement, that is, if you need a database in your application, you will need to add the MySQL, PostgreSQL, or MongoDB add-on cartridge. You can list all the add-on cartridges by running the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridges|grep addon</strong></span>
<span class="strong"><strong class="calibre7">10gen-mms-agent-0.1 10gen Mongo Monitoring Service Agent    addon</strong></span>
<span class="strong"><strong class="calibre7">cron-1.4            Cron 1.4                                addon</strong></span>
<span class="strong"><strong class="calibre7">jenkins-client-1    Jenkins Client                          addon</strong></span>
<span class="strong"><strong class="calibre7">mongodb-2.2         MongoDB 2.2                             addon</strong></span>
<span class="strong"><strong class="calibre7">mysql-5.1           MySQL 5.1                               addon</strong></span>
<span class="strong"><strong class="calibre7">mysql-5.5           MySQL 5.5                               addon</strong></span>
<span class="strong"><strong class="calibre7">metrics-0.1         OpenShift Metrics 0.1                   addon</strong></span>
<span class="strong"><strong class="calibre7">phpmyadmin-4        phpMyAdmin 4.0                          addon</strong></span>
<span class="strong"><strong class="calibre7">postgresql-8.4      PostgreSQL 8.4                          addon</strong></span>
<span class="strong"><strong class="calibre7">postgresql-9.2      PostgreSQL 9.2                          addon</strong></span>
<span class="strong"><strong class="calibre7">rockmongo-1.1       RockMongo 1.1                           addon</strong></span>
<span class="strong"><strong class="calibre7">switchyard-0        SwitchYard 0.8.0                        addon</strong></span>
<span class="strong"><strong class="calibre7">haproxy-1.4         Web Load Balancer                       addon</strong></span>
</pre></div></li><li class="listitem"><span class="strong"><strong class="calibre7">Downloadable cartridge</strong></span>: This enables<a id="id208" class="calibre1"/> developers to <a id="id209" class="calibre1"/>write their own cartridges. They can write their own cartridges and make them available via a public Git repository. These can then be installed using the rhc add-cartridge command. We will cover these in the <span class="strong"><em class="calibre10">Using downloadable cartridges with OpenShift applications</em></span> recipe in this chapter.</li></ul></div><p class="calibre6">Every OpenShift application has at least a private Git repository and web cartridge. It may have zero or more add-on cartridges, with the possibility of zero or more downloadable cartridges. An OpenShift application has built-in support for the Git version control system, automated dependency management, persistent data directory for file upload or storing other files, and deployment rollback.</p><p class="calibre6">An application can be a scalable or nonscalable application. A <span class="strong"><strong class="calibre7">scalable</strong></span> application<a id="id210" class="calibre1"/> runs on multiple gears and scales horizontally depending on the number of concurrent users. We will look at scalable applications in <a class="calibre1" title="Chapter 11. Logging and Scaling Your OpenShift Applications" href="part0131_split_000.html#page">Chapter 11</a>, <span class="strong"><em class="calibre10">Logging and Scaling Your OpenShift Applications</em></span>. In the current chapter, we will cover nonscalable applications. A <span class="strong"><strong class="calibre7">nonscalable application</strong></span><a id="id211" class="calibre1"/> runs inside a single gear, and all the cartridges are added to that gear. These are good for development purposes, but for production, high-traffic applications, you should consider scalable applications.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Creating an OpenShift application using the rhc command-line client"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec36" class="calibre1"/>Creating an OpenShift application using the rhc command-line client</h1></div></div></div><p class="calibre6">In this recipe, you will learn<a id="id212" class="calibre1"/> how to create an OpenShift application <a id="id213" class="calibre1"/>using rhc. We will create a PHP 5.4 application just for demonstration. This chapter will be language-agnostic and will only cover concepts that apply to all the application types. Different programming languages supported by OpenShift will be covered later in the book.</p></div>

<div class="book" title="Creating an OpenShift application using the rhc command-line client">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec128" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To step through this recipe, you will need the rhc command-line client installed on your machine. Please refer to the <span class="strong"><em class="calibre10">Installing the OpenShift rhc command-line client</em></span> recipe in <a class="calibre1" title="Chapter 1. Getting Started with OpenShift" href="part0014_split_000.html#page">Chapter 1</a>, <span class="strong"><em class="calibre10">Getting Started with OpenShift</em></span>, for details. Also, you should set up your OpenShift account using rhc by following the <span class="strong"><em class="calibre10">Setting up an OpenShift account using rhc</em></span> recipe in <a class="calibre1" title="Chapter 1. Getting Started with OpenShift" href="part0014_split_000.html#page">Chapter 1</a>, <span class="strong"><em class="calibre10">Getting Started with OpenShift</em></span>.</p></div></div>

<div class="book" title="Creating an OpenShift application using the rhc command-line client">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec129" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">To create a PHP 5.4 OpenShift application named <code class="email">myapp</code>, open a new command-line terminal and run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc create-app --app myapp --type php-5.4</strong></span>
</pre></div><p class="calibre6">You can also avoid typing the <code class="email">--app</code> and <code class="email">--type</code> options where OpenShift will automatically figure them out, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc create-app myapp php-5.4</strong></span>
</pre></div><p class="calibre6">You can also write the command as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc app-create myapp php-5.4</strong></span>
</pre></div><p class="calibre6">All the rhc commands can take either the <code class="email">rhc &lt;noun&gt;-&lt;verb&gt;</code> or <code class="email">rhc &lt;verb&gt;-&lt;noun&gt;</code> form.</p></div></div>

<div class="book" title="Creating an OpenShift application using the rhc command-line client">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec130" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">Let's go through all the steps performed by the <code class="email">rhc create-app</code> command:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">The <code class="email">rhc create-app</code> command requires two mandatory options:<code class="email">--app</code> and <code class="email">--type</code>. You <a id="id214" class="calibre1"/>are not required to pass these options <a id="id215" class="calibre1"/>with the command, but you are required to provide their values as shown in the <code class="email">rhc create-app myapp php-5.4 </code>command. These two options specify the application name and the web cartridge the application will use. The OpenShift server checks whether the application name and web cartridge name are correct. A valid application name must contain only alphanumeric characters and can be, at the most, 32 characters in length. You can view all the available web cartridges using the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridges|grep web</strong></span>
</pre></div></li><li class="listitem" value="2">After making sure the application name and web cartridge name are correct, it will check whether sufficient gears are available in your domain to create an application. In the free tier, you only have access to three gears, so if you try to create an application after you have consumed all three, you will receive an error response. For example, if you have already created three applications and you try to create the fourth application, you will get the error response, <code class="email">user has already reached the gear limit of 3</code>.</li><li class="listitem" value="3">If you have <a id="id216" class="calibre1"/>sufficient resources to create an<a id="id217" class="calibre1"/> application, rhc will make a <code class="email">HTTP POST</code> request to create an application. The rhc command-line client is a wrapper around the OpenShift REST API. The OpenShift server will receive the POST request and allocate a gear for your application. The amount of RAM and disk space a gear is allocated depends on the gear size. In the free tier, you only have access to small gears, which have 512 MB of RAM and 1 GB of disk space. If you are in the paid tier, you can specify bigger gear sizes with the <code class="email">--gear</code> option. The valid values for <code class="email">--gear</code> at the time of writing are small, medium, and large.</li><li class="listitem" value="4">Next, OpenShift will install the web cartridge required by your application. In the application created previously, it will install the PHP 5.4 language runtime and Apache web server to serve your web requests and perform the required configuration.</li><li class="listitem" value="5">The OpenShift server will also create a private Git repository for your application. The Git repository will have a template application depending on the web cartridge type. You can specify your own template application using <code class="email">--from-code</code>. This is covered in the next recipe.</li><li class="listitem" value="6">Once the application is created with all the required cartridges, the OpenShift server will create a public URL for your application and register it with the DNS. The public URL is a combination of the application name and the domain name. For the application created previously, the URL will be <code class="email">http://myapp-osbook.rhcloud.com</code>. Here, <code class="email">myapp</code> is the application name, and <code class="email">osbook</code> is the domain name. You can also use your own custom domain name with OpenShift applications. This is covered in the <span class="strong"><em class="calibre10">Using your own custom domain name </em></span>recipe.</li><li class="listitem" value="7">After the application DNS name is available, rhc will use the Git command-line to clone the application Git repository on your local machine.</li><li class="listitem" value="8">Finally, you will be shown the details of your application. You can view the running application at <code class="email">http://myapp-{domain-name}.rhcloud.com/</code>. Please replace <code class="email">{domain-name}</code>with your account domain name. An example is shown as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">Your application 'myapp' is now available.</strong></span>

<span class="strong"><strong class="calibre7">  URL:        http://myapp-osbook.rhcloud.com/</strong></span>
<span class="strong"><strong class="calibre7">  SSH to:     52ef686d4382ec39f500001a@myapp-osbook.rhcloud.com</strong></span>
<span class="strong"><strong class="calibre7">  Git remote: ssh://52ef686d4382ec39f500001a@myapp-osbook.rhcloud.com/~/git/myapp.git/</strong></span>
<span class="strong"><strong class="calibre7">  Cloned to:  /home/vagrant/dev/apps/myapp</strong></span>
</pre></div></li></ol><div class="calibre13"/></div><p class="calibre6">Let's look at the <code class="email">myapp</code> application<a id="id218" class="calibre1"/> directory on your local machine. After <a id="id219" class="calibre1"/>the application is created, a directory with a name that is identical to the application name is created on your local machine. It houses the source code of the template application created by OpenShift, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ ls -a</strong></span>
<span class="strong"><strong class="calibre7">.git  .openshift index.php</strong></span>
</pre></div><p class="calibre6">Let's look at each of these components one by one as follows:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">The <code class="email">.git</code> directory<a id="id220" class="calibre1"/> stores the Git repository of the <code class="email">myapp</code> application. This directory contains the complete history of the repository. The <code class="email">.git/config</code> file contains the configuration for the repository. The rhc command-line tool also adds the application-specific metadata to the <code class="email">.git/config</code> file. The application-specific metadata is under the rhc section:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">[rhc]</strong></span>
<span class="strong"><strong class="calibre7">app-id = 52ef686d4382ec39f500001a</strong></span>
<span class="strong"><strong class="calibre7">app-name = myapp</strong></span>
<span class="strong"><strong class="calibre7">domain-name = osbook</strong></span>
</pre></div></li><li class="listitem" value="2">The <code class="email">.openshift</code> directory stores OpenShift-specific files. The <code class="email">.openshift</code> directory has three subdirectories—<code class="email">action_hooks</code>, <code class="email">cron</code>, and <code class="email">markers</code>:<div class="book"><ul class="itemizedlist1"><li class="listitem">The <code class="email">action_hooks</code> directory<a id="id221" class="calibre1"/> stores the<a id="id222" class="calibre1"/> executable scripts, which gives application developers an entry point into various applications and platform life cycle operations. An example of using an action hook would be to send an e-mail after the application is deployed.</li><li class="listitem">The <code class="email">cron</code> directory<a id="id223" class="calibre1"/> stores the executable<a id="id224" class="calibre1"/> scripts, which can be scheduled to run periodically. We will cover this in detail in the <span class="strong"><em class="calibre10">Adding a cron cartridge to an application</em></span> recipe later in this chapter.</li><li class="listitem">The <code class="email">markers</code> directory<a id="id225" class="calibre1"/> allows a user to<a id="id226" class="calibre1"/> specify settings such as hot deployment, debugging, and the version of Java to be used. As these settings are specific to web cartridges, we will cover them in detail in web-cartridge-specific chapters.</li></ul></div></li><li class="listitem" value="3">The <code class="email">index.php</code> file<a id="id227" class="calibre1"/> contains a simple PHP application that you see when you visit the application URL.<div class="note" title="Note"><h3 class="title2"><a id="note09" class="calibre1"/>Note</h3><p class="calibre6">At the time of writing this book, applications in the free tier will idle out after 24 hours of inactivity. Inactivity means no HTTP request has been made to your application URL from outside the gear. When idling, it takes a few seconds for the gear to wake up and start processing web requests.</p></div></li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Creating an OpenShift application using the rhc command-line client">
<div class="book" title="There's more"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch03lvl2sec131" class="calibre1"/>There's more</h2></div></div></div><p class="calibre6">The <code class="email">rhc</code> command-line tool <a id="id228" class="calibre1"/>will raise an exception if the application creation <a id="id229" class="calibre1"/>takes more than 120 seconds. To overcome errors related to timeout, you can specify the <code class="email">--timeout</code> option as shown in the following code. The timeout value is in seconds:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc app-create myapp php-5.4 --timeout 300</strong></span>
</pre></div><p class="calibre6">You can also configure the timeout in the <code class="email">~/.openshift/express.conf</code> file, as shown in the following code. This will apply to all the commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7"># The default timeout for network operations</strong></span>
<span class="strong"><strong class="calibre7">timeout=300</strong></span>
</pre></div></div></div>

<div class="book" title="Creating an OpenShift application using the rhc command-line client">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch03lvl2sec132" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Creating a WordPress application using the web console</em></span> recipe in <a class="calibre1" title="Chapter 1. Getting Started with OpenShift" href="part0014_split_000.html#page">Chapter 1</a>, <span class="strong"><em class="calibre10">Getting Started with OpenShift</em></span></li><li class="listitem">The <span class="strong"><em class="calibre10">Specifying your own template Git repository URL</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Adding a cron cartridge to an application</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Viewing application details</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Using your own custom domain name</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Specifying your own template Git repository URL"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec37" class="calibre1"/>Specifying your own template Git repository URL</h1></div></div></div><p class="calibre6">In the <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe, we created an application that used a template source code provided by OpenShift. Let's suppose you want OpenShift to use your Git repository to populate the initial contents of the application. This can be accomplished using the <code class="email">--from-code</code> option at application creation time.</p></div>

<div class="book" title="Specifying your own template Git repository URL">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec133" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To complete this recipe, you <a id="id230" class="calibre1"/>will need the rhc command-line client installed on your machine. Please refer to the <span class="strong"><em class="calibre10">Installing the OpenShift rhc command-line client</em></span> recipe in <a class="calibre1" title="Chapter 1. Getting Started with OpenShift" href="part0014_split_000.html#page">Chapter 1</a>, <span class="strong"><em class="calibre10">Getting Started with OpenShift</em></span>, for details. You should also complete the setup on your OpenShift account using rhc by following the <span class="strong"><em class="calibre10">Setting up an OpenShift account using rhc</em></span> recipe in <a class="calibre1" title="Chapter 1. Getting Started with OpenShift" href="part0014_split_000.html#page">Chapter 1</a>, <span class="strong"><em class="calibre10">Getting Started with OpenShift</em></span>.</p></div></div>

<div class="book" title="Specifying your own template Git repository URL">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec134" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">To create an application that uses initial content from your own Git repository, use the<code class="email">--from-code</code> option:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc create-app javaapp jbosseap-6 --from-code https://github.com/OpenShift-Cookbook/chapter3-recipe2.git</strong></span>
</pre></div><div class="informalexample" title="Note"><h3 class="title2"><a id="note10" class="calibre1"/>Note</h3><p class="calibre6">The Git repository URL should be a public Git repository; otherwise, application creation will fail as OpenShift cannot access the repository.</p></div></div></div>

<div class="book" title="Specifying your own template Git repository URL">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec135" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">When you create an OpenShift application using the <code class="email">--from-code</code> option, the OpenShift server will first clone the Git repository provided with the <code class="email">--from-code</code> option and then use that repository source code to populate the initial contents of the application. The Git repository URL should be a public Git repository; otherwise, OpenShift will not be able to clone the repository and will instead raise an exception. Following this, OpenShift will build the source code, create an artifact, and then deploy the artifact to the server. An artifact is a by-product produced during the development of software, for example, in the case of Java applications, it could be either a <a id="id231" class="calibre1"/>
<span class="strong"><strong class="calibre7">Java Archive</strong></span> (<span class="strong"><strong class="calibre7">JAR</strong></span>), <a id="id232" class="calibre1"/>
<span class="strong"><strong class="calibre7">Web Archive</strong></span> (<span class="strong"><strong class="calibre7">WAR</strong></span>), or <span class="strong"><strong class="calibre7">Enterprise Archive</strong></span> (<span class="strong"><strong class="calibre7">EAR</strong></span>)<a id="id233" class="calibre1"/> file.</p><p class="calibre6">In the previous command, we created a JBoss EAP application that used a public Git repository URL as its initial code. After the application is successfully created, you can view the application running at <code class="email">http://javaapp-{domain-name}.rhcloud.com/</code>. The application is a <a id="id234" class="calibre1"/>simple demonstration of the article extraction library called <a id="id235" class="calibre1"/>Boilerpipe (which you can access at <a class="calibre1" href="https://code.google.com/p/boilerpipe/">https://code.google.com/p/boilerpipe/</a>). It takes a URL and gives you the title and relevant text from the URL.</p></div></div>

<div class="book" title="Specifying your own template Git repository URL">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch03lvl2sec136" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Creating a WordPress application using the web console</em></span> recipe in <a class="calibre1" title="Chapter 1. Getting Started with OpenShift" href="part0014_split_000.html#page">Chapter 1</a>, <span class="strong"><em class="calibre10">Getting Started with OpenShift</em></span></li><li class="listitem">The <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Starting/stopping/restarting an application"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec38" class="calibre1"/>Starting/stopping/restarting an application</h1></div></div></div><p class="calibre6">The rhc command-line client provides commands to start, stop, and restart an application. In this recipe, you will learn how to perform these commands using rhc.</p></div>

<div class="book" title="Starting/stopping/restarting an application">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec137" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To step through this recipe, you will need rhc installed on your machine. Also, we will make use of the OpenShift application created in the <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe.</p></div></div>

<div class="book" title="Starting/stopping/restarting an application">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec138" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">To start an<a id="id236" class="calibre1"/> application, run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">rhc start-app --app myapp</strong></span>
</pre></div><p class="calibre6">To stop<a id="id237" class="calibre1"/> an application, run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">rhc stop-app --app myapp</strong></span>
</pre></div><p class="calibre6">To restart<a id="id238" class="calibre1"/> an application, run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">rhc restart-app –-app myapp</strong></span>
</pre></div><p class="calibre6">The <code class="email">--app</code> option is not required if you are running the command from within the application Git repository. When you run the command within the repository, rhc will find the domain name and the application name from the <code class="email">.git/config </code>Git repository configuration file. It uses the <code class="email">git config --get rhc.domain-name</code> command to find the domain name and <code class="email">git config –get rhc.app-name</code> to find the application name.</p></div></div>

<div class="book" title="Starting/stopping/restarting an application">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec139" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">The rhc start/stop/restart app commands allow you to manage the application using rhc. The rhc client makes a POST HTTP request to stop the application, which stops the web and add-on cartridges. Every OpenShift gear has an executable called the <code class="email">gear</code> available on it. When the server receives the POST request, it executes the <code class="email">gear stop</code> command to stop the PHP 5.4<a id="id239" class="calibre1"/> cartridge. After the <a id="id240" class="calibre1"/>application <a id="id241" class="calibre1"/>has successfully stopped, the <code class="email">curl</code> request to the application URL will return a 503 error:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ curl http://myapp-osbook.rhcloud.com</strong></span>
<span class="strong"><strong class="calibre7">&lt;!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN"&gt;</strong></span>
<span class="strong"><strong class="calibre7">&lt;html&gt;&lt;head&gt;</strong></span>
<span class="strong"><strong class="calibre7">&lt;title&gt;503 Service Temporarily Unavailable&lt;/title&gt;</strong></span>
<span class="strong"><strong class="calibre7">&lt;/head&gt;&lt;body&gt;</strong></span>
<span class="strong"><strong class="calibre7">&lt;h1&gt;Service Temporarily Unavailable&lt;/h1&gt;</strong></span>
<span class="strong"><strong class="calibre7">&lt;p&gt;The server is temporarily unable to service your</strong></span>
<span class="strong"><strong class="calibre7">request due to maintenance downtime or capacity</strong></span>
<span class="strong"><strong class="calibre7">problems. Please try again later.&lt;/p&gt;</strong></span>
<span class="strong"><strong class="calibre7">&lt;hr&gt;</strong></span>
<span class="strong"><strong class="calibre7">&lt;address&gt;Apache/2.2.22 (Red Hat Enterprise Web Server) Server at myapp-osbook.rhcloud.com Port 80&lt;/address&gt;</strong></span>
<span class="strong"><strong class="calibre7">&lt;/body&gt;&lt;/html&gt;</strong></span>
</pre></div><p class="calibre6">The <code class="email">rhc start-app</code> command<a id="id242" class="calibre1"/> makes a POST HTTP request to start the application. The OpenShift server will receive the POST request and invoke the <code class="email">gear start </code>command on the application gear. The <code class="email">gear start</code> command will first start all the add-on cartridges before starting the web cartridge.</p><p class="calibre6">The <code class="email">rhc restart-app</code> command<a id="id243" class="calibre1"/> first stops the application by invoking the <code class="email">gear stop </code>command on the application gear, and then starts the application by calling the <code class="email">gear start </code>command on the application gear.</p></div></div>

<div class="book" title="Starting/stopping/restarting an application">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch03lvl2sec140" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre6">The <code class="email">rhc stop-app</code> command<a id="id244" class="calibre1"/> only stops the web and add-on cartridge processes, but if you want to kill all the processes running in your application gear, you should use the <code class="email">rhc force-stop-app</code> command. This command will kill all the processes running inside the gear. This is very useful when people start running their own processes inside the application. In those cases, the rhc app-stop command will not help:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc force-stop-app --app myapp</strong></span>
</pre></div></div></div>

<div class="book" title="Starting/stopping/restarting an application">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch03lvl2sec141" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Viewing application details</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Adding and managing add-on cartridges"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec39" class="calibre1"/>Adding and managing add-on cartridges</h1></div></div></div><p class="calibre6">In the <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe, you learned how to <a id="id245" class="calibre1"/>create a new OpenShift application using a web <a id="id246" class="calibre1"/>cartridge. Apart from web cartridges, OpenShift also supports a number of add-on cartridges. These cartridges provide functionalities, such as databases, monitoring, cron jobs, database web clients, and others.</p><p class="calibre6">In this recipe, you will learn how to install the MySQL 5.5 cartridge to the PHP 5.4 application that you created in the <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe.</p></div>

<div class="book" title="Adding and managing add-on cartridges">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec142" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To complete this recipe, you will need rhc installed on your machine. Also, we will make use of the OpenShift application created in the <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe.</p></div></div>

<div class="book" title="Adding and managing add-on cartridges">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec143" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">To add the <a id="id247" class="calibre1"/>MySQL 5.5 cartridge<a id="id248" class="calibre1"/> to our application, run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridge-add --app myapp --cartridge mysql-5.5</strong></span>
</pre></div><p class="calibre6">If you want to start a cartridge, run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridge-start --app myapp --cartridge mysql-5.5</strong></span>
</pre></div><p class="calibre6">To stop a cartridge, run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridge-stop --app myapp --cartridge mysql-5.5</strong></span>
</pre></div><p class="calibre6">To restart a cartridge, run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridge-restart --app myapp --cartridge mysql-5.5</strong></span>
</pre></div><p class="calibre6">You can also view a cartridge status using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridge-status --app myapp --cartridge mysql-5.5</strong></span>
</pre></div><p class="calibre6">Finally, to remove a cartridge, run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridge-remove --app myapp --cartridge mysql-5.5 --confirm</strong></span>
</pre></div><p class="calibre6">The <code class="email">--confirm</code> option is used to confirm the cartridge removal. If you don't specify the<code class="email">--confirm</code> option, OpenShift will ask you to confirm your action.</p></div></div>

<div class="book" title="Adding and managing add-on cartridges">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec144" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">All the cartridge-specific commands are available under <code class="email">rhc cartridge</code>. To view all the actions you can perform<a id="id249" class="calibre1"/> on a cartridge, run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridge -h</strong></span>
<span class="strong"><strong class="calibre7">List of Actions</strong></span>
<span class="strong"><strong class="calibre7">  add           Add a cartridge to your application</strong></span>
<span class="strong"><strong class="calibre7">  list          List available cartridges</strong></span>
<span class="strong"><strong class="calibre7">  reload        Reload the cartridge's configuration</strong></span>
<span class="strong"><strong class="calibre7">  remove        Remove a cartridge from your application</strong></span>
<span class="strong"><strong class="calibre7">  restart       Restart a cartridge</strong></span>
<span class="strong"><strong class="calibre7">  scale         Set the scale range for a cartridge</strong></span>
<span class="strong"><strong class="calibre7">  show          Show useful information about a cartridge</strong></span>
<span class="strong"><strong class="calibre7">  start         Start a cartridge</strong></span>
<span class="strong"><strong class="calibre7">  status        Get current the status of a cartridge</strong></span>
<span class="strong"><strong class="calibre7">  stop          Stop a cartridge</strong></span>
<span class="strong"><strong class="calibre7">  storage       View/manipulate storage on a cartridge</strong></span>
</pre></div><p class="calibre6">The <code class="email">rhc </code><a id="id250" class="calibre1"/>
<code class="email">cartridge-add</code> command makes an HTTP <a id="id251" class="calibre1"/>POST request to add the MySQL 5.5 cartridge<a id="id252" class="calibre1"/> to the <code class="email">myapp</code> application. The command-line tool runs within the context of the current directory of your command line and interacts with OpenShift REST API. This helps you to get away with specifying the application name using the <code class="email">--app</code> option with every command. The server receives the POST request and installs the MySQL binary on the application gear. After successfully creating the application, you will receive the following result:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">mysql-5.5 (MySQL 5.5)</strong></span>
<span class="strong"><strong class="calibre7">---------------------</strong></span>
<span class="strong"><strong class="calibre7">  Gears:          Located with php-5.4</strong></span>
<span class="strong"><strong class="calibre7">  Connection URL: mysql://$OPENSHIFT_MYSQL_DB_HOST:$OPENSHIFT_MYSQL_DB_PORT/</strong></span>
<span class="strong"><strong class="calibre7">  Database Name:  myapp</strong></span>
<span class="strong"><strong class="calibre7">  Password:       2L5FIzuyZrXa</strong></span>
<span class="strong"><strong class="calibre7">  Username:       adminyEY1pty</strong></span>

<span class="strong"><strong class="calibre7">Added mysql-5.5 to application myapp</strong></span>
<span class="strong"><strong class="calibre7">MySQL 5.5 database added.  Please make note of these credentials:</strong></span>
<span class="strong"><strong class="calibre7">       Root User: adminyEY1pty</strong></span>
<span class="strong"><strong class="calibre7">   Root Password: 2L5FIzuyZrXa</strong></span>
<span class="strong"><strong class="calibre7">   Database Name: myapp</strong></span>

<span class="strong"><strong class="calibre7">Connection URL: mysql://$OPENSHIFT_MYSQL_DB_HOST:$OPENSHIFT_MYSQL_DB_PORT/</strong></span>

<span class="strong"><strong class="calibre7">You can manage your new MySQL database by also embedding phpmyadmin.</strong></span>
<span class="strong"><strong class="calibre7">The phpmyadmin username and password will be the same as the MySQL credentials above.</strong></span>
</pre></div><p class="calibre6">The rest of the<a id="id253" class="calibre1"/> commands are self-explanatory, so<a id="id254" class="calibre1"/> they <a id="id255" class="calibre1"/>require <a id="id256" class="calibre1"/>little discussion.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note11" class="calibre1"/>Note</h3><p class="calibre6">Please be aware that the <code class="email">rhc remove-cartridge</code> command<a id="id257" class="calibre1"/> is an irreversible action, and you <span class="strong"><em class="calibre10">cannot</em></span> recover data after removing the cartridge.</p></div></div></div>

<div class="book" title="Adding and managing add-on cartridges">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch03lvl2sec145" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre6">You can also view the details of a cartridge using the<a id="id258" class="calibre1"/> <code class="email">rhc cartridge</code> command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc show-cartridge mysql –-app myapp</strong></span>
<span class="strong"><strong class="calibre7">Using mysql-5.5 (MySQL 5.5) for 'mysql'</strong></span>
<span class="strong"><strong class="calibre7">mysql-5.5 (MySQL 5.5)</strong></span>
<span class="strong"><strong class="calibre7">---------------------</strong></span>
<span class="strong"><strong class="calibre7">  Gears:          Located with php-5.4</strong></span>
<span class="strong"><strong class="calibre7">  Connection URL: mysql://$OPENSHIFT_MYSQL_DB_HOST:$OPENSHIFT_MYSQL_DB_PORT/</strong></span>
<span class="strong"><strong class="calibre7">  Database Name:  myapp</strong></span>
<span class="strong"><strong class="calibre7">  Password:       2L5FIzuyZrXa</strong></span>
<span class="strong"><strong class="calibre7">  Username:       adminyEY1pty</strong></span>
</pre></div></div></div>

<div class="book" title="Adding and managing add-on cartridges">
<div class="book" title="See more"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch03lvl2sec146" class="calibre1"/>See more</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Viewing application details</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Adding a cron cartridge to an application</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Adding a cron cartridge to an application"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec40" class="calibre1"/>Adding a cron cartridge to an application</h1></div></div></div><p class="calibre6">In this recipe, you will learn how to add the cron add-on cartridge to your application. The cron cartridge will write the output of the <code class="email">quota</code> command to a file every hour. The database and other cartridges will be covered later in this book.</p></div>

<div class="book" title="Adding a cron cartridge to an application">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec147" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To prepare for this recipe, you will need rhc installed on your machine. Also, we will make use of the OpenShift application created in the <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe.</p></div></div>

<div class="book" title="Adding a cron cartridge to an application">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec148" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Perform the<a id="id259" class="calibre1"/> following <a id="id260" class="calibre1"/>steps to add a cron cartridge to your application:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open a new command-line terminal and run the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc add-cartridge --cartridge cron --app myapp</strong></span>
</pre></div></li><li class="listitem" value="2">Create a new file <code class="email">quota.txt</code> in the application root directory and populate it with the following code.  On a *nix machine, you can use the <code class="email">cat</code> command, as shown in the following command line:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ echo "# Quote File" &gt;&gt; quota.txt</strong></span>
</pre></div><p class="calibre14">On Windows machines, you can use filesystem explorer to create a new file. After creating the file, write <code class="email"># Quota File</code> to it.</p></li><li class="listitem" value="3">After adding the cron cartridge, create a new file named <code class="email">quota.sh</code> in the <code class="email">.openshift/cron/hourly</code> folder, and add the following content to it:<div class="informalexample"><pre class="programlisting">#!/bin/bash
date &gt;&gt; $OPENSHIFT_REPO_DIR/quota.txt
quota -s &gt;&gt; $OPENSHIFT_REPO_DIR/quota.txt
echo "**********************************************************************************************" &gt;&gt; $OPENSHIFT_REPO_DIR/quota.txt</pre></div></li><li class="listitem" value="4">Make the <code class="email">quota.sh</code> script executable by running the following command. On *nix machines, you can run the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ chmod +x .openshift/cron/hourly/quota.sh</strong></span>
</pre></div><p class="calibre14">On Windows machines, you have to use the following command as the chmod command is not available on them:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ git update-index --add --chmod=+x .openshift/cron/hourly/quota.sh</strong></span>
</pre></div></li><li class="listitem" value="5">Add the <code class="email">quota.sh</code> script to the Git repository, and then commit the changes to the local Git repository:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ git add .</strong></span>
<span class="strong"><strong class="calibre7">$ git commit -am "added hourly script to output quota limits"</strong></span>
</pre></div></li><li class="listitem" value="6">Push the changes to OpenShift service:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ git push</strong></span>
</pre></div></li><li class="listitem" value="7">After the changes are deployed, you will see the quota information at <code class="email">http://myapp-{domain-name}.rhcloud.com/quota.txt</code>.</li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Adding a cron cartridge to an application">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec149" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">Every OpenShift application has a cron directory under the <code class="email">.openshift</code> directory. This directory is used to define jobs that should run every minute, hourly, daily, weekly, or monthly. Cron jobs are not invoked until you add the cron cartridge to the application using <a id="id261" class="calibre1"/>the <code class="email">rhc add-cartridge</code> command. They are useful to automatically perform tasks in the background at regular intervals. You can use them to take database backups, clean up log files, send e-mails, and much more.</p><p class="calibre6">In step 1, you added <a id="id262" class="calibre1"/>the cron cartridge to the <code class="email">myapp</code> application. Next, in step 3, you defined a <code class="email">quota.sh</code> bash script that should run every hour. The <code class="email">quota.sh</code> script <a id="id263" class="calibre1"/>appends the date and quota information to the <code class="email">quota.txt</code> file in the <code class="email">php</code> directory under the OpenShift repository location. <code class="email">$OPENSHIFT_REPO_DIR</code> is an environment variable that points to the location of the application source code directory. In step 4, you made the <code class="email">quota.sh</code> script executable, without which the OpenShift service would not be able to execute the script. In the next three steps, you committed the change to the local Git repository and then pushed the changes to your application Git repository hosted on the OpenShift application gear. OpenShift will first stop the entire cartridge, build the application, deploy it to the Apache server, and then finally start all the cartridges. After the cron cartridge is started, it will write to the <code class="email">quota.txt</code> file every hour. You can view the quota details by going to <code class="email">http://myapp-{domain-name}.rhcloud.com/quota.txt</code>:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">Tue Feb  4 02:57:14 EST 2014 Disk quotas for user 52f08f184382ecb8e9000239 (uid 2675):       Filesystem  blocks   quota   limit   grace   files   quota   limit   grace /dev/mapper/EBSStore01-user_home01                    9760       0   1024M             359       0   80000         ********************************************************************************************** Tue Feb  4 03:57:14 EST 2014 Disk quotas for user 52f08f184382ecb8e9000239 (uid 2675):       Filesystem  blocks   quota   limit   grace   files   quota   limit   grace /dev/mapper/EBSStore01-user_home01                    9760       0   1024M             359       0   80000         **********************************************************************************************</strong></span>
</pre></div><div class="informalexample" title="Note"><h3 class="title2"><a id="note12" class="calibre1"/>Note</h3><p class="calibre6">The default timeout for a cron job is 5 minutes, which means that your job should be complete within 5 minutes, or else it will be terminated.</p><p class="calibre6">You can run longer jobs in the background using <code class="email">nohup</code>:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">nohup /path-to/script &gt; $OPENSHIFT_LOG_DIR/logfile 2&gt;&amp;1 &amp;</strong></span>
</pre></div></div></div></div>

<div class="book" title="Adding a cron cartridge to an application">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch03lvl2sec150" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre6">OpenShift currently only <a id="id264" class="calibre1"/>supports scheduling jobs every minute, or at hourly, daily, weekly, or monthly intervals. To run a job at a specific time or specific<a id="id265" class="calibre1"/> intervals, such as running a daily job at 8:30 PM, create a job that runs every minute, and then add the following code. This job will execute itself only when the time is 8:30 PM:</p><div class="informalexample"><pre class="programlisting">#!/bin/bash
if [ `date +%H:%M` == "20:30" ]
then
    date &gt;&gt; $OPENSHIFT_REPO_DIR/quota_20h_30m.txt
quota -s &gt;&gt; $OPENSHIFT_REPO_DIR/quota_20h_30m.txt
echo "********************************"&gt;&gt; $OPENSHIFT_REPO_DIR/quota_20h_30m.txt
fi</pre></div></div></div>

<div class="book" title="Adding a cron cartridge to an application">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch03lvl2sec151" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Using downloadable cartridges with OpenShift applications"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec41" class="calibre1"/>Using downloadable cartridges with OpenShift applications</h1></div></div></div><p class="calibre6">In this recipe, you will learn <a id="id266" class="calibre1"/>how to use a <a id="id267" class="calibre1"/>third-party downloadable cartridge with OpenShift applications. </p></div>

<div class="book" title="Using downloadable cartridges with OpenShift applications">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec152" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To step through this recipe, you will need rhc installed on your machine. Also, we will make use of the OpenShift application created in the <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe.</p></div></div>

<div class="book" title="Using downloadable cartridges with OpenShift applications">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec153" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">To add the Monit downloadable cartridge, use the <code class="email">rhc add-cartridge</code> command<a id="id268" class="calibre1"/> as shown in the following command. Please replace <code class="email">email@address.com</code> with your valid email address:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridge-add --app myapp https://raw.githubusercontent.com/openshift-cartridges/openshift-origin-cartridge-monit/master/metadata/manifest.yml --env MONIT_ALERT_EMAIL=email@address.com</strong></span>
</pre></div><p class="calibre6">The <code class="email">--env</code> option is used to set the environment variable required by this cartridge. The cartridge required the <code class="email">MONIT_ALERT_EMAIL</code> environment variable, which is used to configure e-mail that would be used to send alert notifications. Environment variables will be covered in detail in the <span class="strong"><em class="calibre10">Setting application-specific environment variables</em></span> recipe.</p></div></div>

<div class="book" title="Using downloadable cartridges with OpenShift applications">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec154" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">To install a<a id="id269" class="calibre1"/> third-party downloadable<a id="id270" class="calibre1"/> cartridge to your application, you need to provide the rhc command-line client with the URL to its manifest file called <code class="email">manifest.yml</code>. This file exists under the <code class="email">metadata</code> directory in the cartridge source repository, and contains a URL pointing to the actual contents of the cartridge. The list of actively maintained third-party cartridges can be found at <a class="calibre1" href="https://www.openshift.com/developers/download-cartridges">https://www.openshift.com/developers/download-cartridges</a>. Another good way to find downloadable cartridges is to search GitHub (<a class="calibre1" href="https://github.com/search?q=%22openshift+cartridge%22">https://github.com/search?q=%22openshift+cartridge%22</a>), as most cartridges are hosted on GitHub. </p><p class="calibre6">You can later remove the cartridge by running the <code class="email">rhc remove-cartridge</code> command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc remove-cartridge monit --confirm</strong></span>
</pre></div></div></div>

<div class="book" title="Using downloadable cartridges with OpenShift applications">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch03lvl2sec155" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Adding and managing add-on cartridges</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Adding a cron cartridge to an application</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Viewing application details"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec42" class="calibre1"/>Viewing application details</h1></div></div></div><p class="calibre6">In this recipe, you will learn how to<a id="id271" class="calibre1"/> view all the details related to an application.</p></div>

<div class="book" title="Viewing application details">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec156" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To step through this recipe, you will need rhc installed on your machine. Also, we will make use of the OpenShift application created in the <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe.</p></div></div>

<div class="book" title="Viewing application details">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec157" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">The <code class="email">rhc show-app</code> command<a id="id272" class="calibre1"/> can be<a id="id273" class="calibre1"/> used to view the information details about the application, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc show-app --app myapp</strong></span>
</pre></div><p class="calibre6">The <code class="email">--app</code> option is not required if you are running the command within the application Git repository.</p></div></div>

<div class="book" title="Viewing application details">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec158" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">The <code class="email">rhc show-app</code> command returns all the details about an application. The output of the command is shown as follows. The details include the application creation time, application name, public URL, Git repository URL, SSH URL, and details about all the cartridges:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">rhc show-app --app myapp</strong></span>
<span class="strong"><strong class="calibre7">myapp @ http://myapp-osbook.rhcloud.com/ (uuid: 52f08f184382ecb8e9000239)</strong></span>
<span class="strong"><strong class="calibre7">-------------------------------------------------------------------------</strong></span>
<span class="strong"><strong class="calibre7">  Domain:     osbook</strong></span>
<span class="strong"><strong class="calibre7">  Created:    1:56 AM</strong></span>
<span class="strong"><strong class="calibre7">  Gears:      1 (defaults to small)</strong></span>
<span class="strong"><strong class="calibre7">  Git URL:    ssh://52f08f184382ecb8e9000239@myapp-osbook.rhcloud.com/~/git/myapp.git/</strong></span>
<span class="strong"><strong class="calibre7">  SSH:        52f08f184382ecb8e9000239@myapp-osbook.rhcloud.com</strong></span>
<span class="strong"><strong class="calibre7">  Deployment: auto (on git push)</strong></span>

<span class="strong"><strong class="calibre7">  php-5.4 (PHP 5.4)</strong></span>
<span class="strong"><strong class="calibre7">  -----------------</strong></span>
<span class="strong"><strong class="calibre7">    Gears: Located with cron-1.4</strong></span>

<span class="strong"><strong class="calibre7">  cron-1.4 (Cron 1.4)</strong></span>
<span class="strong"><strong class="calibre7">  -------------------</strong></span>
<span class="strong"><strong class="calibre7">    Gears: Located with php-5.4</strong></span>
</pre></div><p class="calibre6">You can also view the state of the application by passing in the <code class="email">--state</code> option, as shown in the following command. The valid application states are <code class="email">started</code>, <code class="email">stopped</code>, and <code class="email">building</code>:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc show-app --app myapp --state</strong></span>
<span class="strong"><strong class="calibre7">Cartridge php-5.4, cron-1.4 is started</strong></span>
</pre></div><p class="calibre6">If you only want to view the SSH information and state of all the gears in the application, you can use the <code class="email">--gears</code> option with the <code class="email">rhc app-show</code> command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc show-app--app --gears</strong></span>
<span class="strong"><strong class="calibre7">ID                       State   Cartridges       Size  SSH URL</strong></span>
<span class="strong"><strong class="calibre7">------------------------ ------- ---------------- ----- -------------------------------------------------</strong></span>
<span class="strong"><strong class="calibre7">52f08f184382ecb8e9000239 started php-5.4 cron-1.4 small 52f08f184382ecb8e9000239@myapp-osbook.rhcloud.com</strong></span>
</pre></div><p class="calibre6">The previous command is <a id="id274" class="calibre1"/>very useful when you are working with scalable applications, as it provides you with information about all the application gears with a single command.</p></div></div>

<div class="book" title="Viewing application details">
<div class="book" title="See more"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch03lvl2sec159" class="calibre1"/>See more</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Cloning the application Git repository using rhc</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Cloning the application Git repository using rhc"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec43" class="calibre1"/>Cloning the application Git repository using rhc</h1></div></div></div><p class="calibre6">In the <span class="strong"><em class="calibre10">Cloning the application to the local machine</em></span> recipe in <a class="calibre1" title="Chapter 1. Getting Started with OpenShift" href="part0014_split_000.html#page">Chapter 1</a>, <span class="strong"><em class="calibre10">Getting Started with OpenShift</em></span>, you learned how to<a id="id275" class="calibre1"/> clone the Git repository using the <a id="id276" class="calibre1"/>Git command-line tool. This recipe had a couple of steps—first, to copy the Git repository URL from the web console and second, to use the <code class="email">git-clone</code> command to clone the Git repository. The rhc command-line tool can help you save some keystrokes. In this recipe, you will learn how to use rhc to clone the Git repository.</p></div>

<div class="book" title="Cloning the application Git repository using rhc">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec160" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To step through this recipe, you will need rhc installed on your machine. Also, we will use the OpenShift application created in The <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe.</p></div></div>

<div class="book" title="Cloning the application Git repository using rhc">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec161" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">To clone the <code class="email">myapp</code> application on your local machine using rhc, run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">rhc git-clone --app myapp</strong></span>
</pre></div></div></div>

<div class="book" title="Cloning the application Git repository using rhc">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec162" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">The <code class="email">rhc git-clone</code> command<a id="id277" class="calibre1"/> first makes a HTTP GET request to fetch the details about the <code class="email">myapp</code> application. The application details include the Git repository URL. The <code class="email">rhc git-clone</code> command then uses the <code class="email">git clone &lt;GIT_REPOSITORY_URL&gt;</code> command to<a id="id278" class="calibre1"/> clone the <a id="id279" class="calibre1"/>application.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note13" class="calibre1"/>Note</h3><p class="calibre6">The <code class="email">rhc git-clone</code> command requires Git to be installed on your machine to work.</p></div></div></div>

<div class="book" title="Cloning the application Git repository using rhc">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch03lvl2sec163" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre6">You can also tell the <code class="email">rhc git-clone</code> command<a id="id280" class="calibre1"/> to clone the repository to a specific directory using the <code class="email">--repo</code> option. The following command will clone the repository inside the <code class="email">tmp/myapp</code> folder:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc git-clone --app myapp --repo ../tmp/myapp</strong></span>
</pre></div></div></div>

<div class="book" title="Cloning the application Git repository using rhc">
<div class="book" title="See more"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch03lvl2sec164" class="calibre1"/>See more</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Cloning the application to the local machine</em></span> recipe in <a class="calibre1" title="Chapter 1. Getting Started with OpenShift" href="part0014_split_000.html#page">Chapter 1</a>, <span class="strong"><em class="calibre10">Getting Started with OpenShift</em></span></li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="SSH into the application gear using rhc"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec44" class="calibre1"/>SSH into the application gear using rhc</h1></div></div></div><p class="calibre6">In this recipe, you will learn how to<a id="id281" class="calibre1"/> use rhc to SSH into the application gear.</p></div>

<div class="book" title="SSH into the application gear using rhc">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec165" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">In order to complete this recipe, you will need rhc installed on your machine. Also, you will need to make use of the OpenShift application created in The <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe.</p></div></div>

<div class="book" title="SSH into the application gear using rhc">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec166" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">To SSH into the application gear, open a new command-line terminal and run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc ssh --app myapp</strong></span>
</pre></div><p class="calibre6">The <code class="email">--app</code> option is not required if you are running the command within the application Git repository.</p></div></div>

<div class="book" title="SSH into the application gear using rhc">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec167" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">Every OpenShift application gear acts and behaves like a virtual server that you can access using SSH. A gear is assigned a unique user ID and is associated with a SELinux context. When you run the <code class="email">rhc ssh</code> command, a secure communication channel is opened between the node hosting the gear and the local machine where you are presented with a limited shell within the environment, as shown in the following command. I have removed <a id="id282" class="calibre1"/>part of the output for brevity:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">Connecting to 52f08f184382ecb8e9000239@myapp-osbook.rhcloud.com ...</strong></span>

<span class="strong"><strong class="calibre7">    Welcome to OpenShift shell</strong></span>
<span class="strong"><strong class="calibre7">This shell will assist you in managing OpenShift applications.</strong></span>

<span class="strong"><strong class="calibre7">    !!! IMPORTANT !!! IMPORTANT !!! IMPORTANT !!!</strong></span>
<span class="strong"><strong class="calibre7">    Shell access is quite powerful and it is possible for you to</strong></span>
<span class="strong"><strong class="calibre7">    accidentally damage your application.  Proceed with care!</strong></span>
<span class="strong"><strong class="calibre7">    If worse comes to worst, destroy your application with "rhc app delete"</strong></span>
<span class="strong"><strong class="calibre7">    and recreate it</strong></span>
<span class="strong"><strong class="calibre7">    !!! IMPORTANT !!! IMPORTANT !!! IMPORTANT !!!</strong></span>

<span class="strong"><strong class="calibre7">    Type "help" for more info.</strong></span>
<span class="strong"><strong class="calibre7">[myapp-osbook.rhcloud.com 52f08f184382ecb8e9000239]\&gt;</strong></span>
</pre></div><p class="calibre6">If you run the <code class="email">ls</code> command, you will only see all the directories available under your application user home directory:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">[myapp-osbook.rhcloud.com 52f08f184382ecb8e9000239]\&gt; ls</strong></span>
<span class="strong"><strong class="calibre7">app-deployments  app-root  cron  git  php</strong></span>
</pre></div></div></div>

<div class="book" title="SSH into the application gear using rhc">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch03lvl2sec168" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre6">By default, the SSH connection will timeout after 5 minutes of inactivity, and you will be logged out of the SSH session. You can turn off connection timeout by unsetting the TMOUT environment variable:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">[myapp-osbook.rhcloud.com 52f08f184382ecb8e9000239]\&gt; unset TMOUT</strong></span>
</pre></div><div class="informalexample" title="Note"><h3 class="title2"><a id="note14" class="calibre1"/>Note</h3><p class="calibre6">If other people access your machine and you don't want them to access your OpenShift application by just typing the <code class="email">rhc ssh</code> command, I would recommend you use the SSH key passphrase to restrict access. We discussed SSH key passphrases in the <span class="strong"><em class="calibre10">Working with the SSH key passphrases</em></span> recipe in <a class="calibre1" title="Chapter 1. Getting Started with OpenShift" href="part0014_split_000.html#page">Chapter 1</a>, <span class="strong"><em class="calibre10">Getting Started with OpenShift</em></span>.</p></div></div></div>

<div class="book" title="SSH into the application gear using rhc">
<div class="book" title="See more"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch03lvl2sec169" class="calibre1"/>See more</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Uploading SSH keys using the web console</em></span> recipe in <a class="calibre1" title="Chapter 1. Getting Started with OpenShift" href="part0014_split_000.html#page">Chapter 1</a>, <span class="strong"><em class="calibre10">Getting Started with OpenShift</em></span></li><li class="listitem">The <span class="strong"><em class="calibre10">Working with the SSH key passphrases</em></span> recipe in <a class="calibre1" title="Chapter 1. Getting Started with OpenShift" href="part0014_split_000.html#page">Chapter 1</a>, <span class="strong"><em class="calibre10">Getting Started with OpenShift</em></span></li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Running a command in the application's SSH session using rhc"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec45" class="calibre1"/>Running a command in the application's SSH session using rhc</h1></div></div></div><p class="calibre6">In this recipe, you will<a id="id283" class="calibre1"/> learn how to view the gear directory<a id="id284" class="calibre1"/> listing without performing SSH into the server using rhc.</p></div>

<div class="book" title="Running a command in the application's SSH session using rhc">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec170" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To step through this recipe, you will need rhc installed on your machine. Also, we will use the OpenShift application created in the <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe.</p></div></div>

<div class="book" title="Running a command in the application's SSH session using rhc">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec171" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">To run the <code class="email">ls</code> command without performing SSH into the application server, you should run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc app-ssh --app myapp --command ls</strong></span>
</pre></div><p class="calibre6">The <code class="email">rhc ssh</code> command is a short hand for <code class="email">rhc app-ssh</code>. Both these commands allow you to SSH into an application gear.</p></div></div>

<div class="book" title="Running a command in the application's SSH session using rhc">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec172" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">The <code class="email">rhc app-ssh</code> command<a id="id285" class="calibre1"/> internally uses the SSH command-line client to connect with the application gear. With the SSH command-line client, you can specify the command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ ssh username@server.com command</strong></span>
</pre></div><p class="calibre6">The rhc command-line client provides a <code class="email">--command</code> option that allows you to specify a command you want to run on the server:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc app-ssh --app myapp --command ls</strong></span>
<span class="strong"><strong class="calibre7">app-deployments</strong></span>
<span class="strong"><strong class="calibre7">app-root</strong></span>
<span class="strong"><strong class="calibre7">cron</strong></span>
<span class="strong"><strong class="calibre7">git</strong></span>
<span class="strong"><strong class="calibre7">php</strong></span>
</pre></div></div></div>

<div class="book" title="Running a command in the application's SSH session using rhc">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch03lvl2sec173" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre6">If you want to run the <a id="id286" class="calibre1"/>command on all<a id="id287" class="calibre1"/> the gears in your application, you should use the<code class="email">--gears</code> option with the <code class="email">rhc app-ssh</code> command. This would be useful when working with scalable applications. Have a look at the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc app-ssh --app myapp --gears --command ls</strong></span>
</pre></div></div></div>

<div class="book" title="Running a command in the application's SSH session using rhc">
<div class="book" title="See more"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch03lvl2sec174" class="calibre1"/>See more</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">SSH into the application gear using rhc</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Setting application-specific environment variables"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec46" class="calibre1"/>Setting application-specific environment variables</h1></div></div></div><p class="calibre6">It is very common that<a id="id288" class="calibre1"/> people deploy their application in multiple environments, such as testing, staging, and production. Usually, the configuration differs between these environments to ensure that you are using the right service for the right environment. Consider an example where you want to send e-mails in your application. In the production environment, you would like to use the cloud e-mail service, such as <a id="id289" class="calibre1"/>Sendmail (accessible at <a class="calibre1" href="https://www.sendmail.com/">https://www.sendmail.com/</a>), but in the development environment, you would like to use an open source version of Sendmail. Environment variables provide a programming language and operating-system-agnostic solution to these kinds of problems. </p><p class="calibre6">Hard coding configuration values in the source code is never a good idea, as it leads to strong coupling between your code and the values, compromising the security of your app if your code falls into the wrong hands. The environment variables allow you to use the same application code in different environments leading to portable code.</p><p class="calibre6">OpenShift also exposes some environment variables you should use in your application, rather than hard coding their values. For example, if you want to write a file in your OpenShift application, you should use the <code class="email">OPENSHIFT_DATA_DIR</code> environment variable<a id="id290" class="calibre1"/> to access the location of the persistent directory. Every OpenShift cartridge also exposes its own set of environment variables. For example, the PostgreSQL cartridge exposes environment variables for the username, password, host, port, and so on. You should not hard code the database configuration properties in your source code but take advantage of environment variables. You can view all the OpenShift and cartridge-specific environment variables by running the following command. The <code class="email">rhc ssh</code> command is a shorthand for <code class="email">rhc app-ssh</code>. Both these<a id="id291" class="calibre1"/> commands allow you to SSH into an application gear:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc ssh --command env</strong></span>
<span class="strong"><strong class="calibre7">MANPATH=/opt/rh/php54/root/usr/share/man:</strong></span>
<span class="strong"><strong class="calibre7">OPENSHIFT_PHP_IDENT=redhat:php:5.4:0.0.10</strong></span>
<span class="strong"><strong class="calibre7">OPENSHIFT_GEAR_MEMORY_MB=512</strong></span>
<span class="strong"><strong class="calibre7">SELINUX_ROLE_REQUESTED=</strong></span>
<span class="strong"><strong class="calibre7">GEM_HOME=/var/lib/openshift/52f08f184382ecb8e9000239/.gem</strong></span>
<span class="strong"><strong class="calibre7">OPENSHIFT_DEPLOYMENT_TYPE=git</strong></span>
<span class="strong"><strong class="calibre7">SHELL=/usr/bin/oo-trap-user</strong></span>
<span class="strong"><strong class="calibre7">TMPDIR=/tmp/</strong></span>
<span class="strong"><strong class="calibre7">SSH_CLIENT=117.207.187.145 15958 22</strong></span>
<span class="strong"><strong class="calibre7">OPENSHIFT_DEPLOYMENTS_DIR=/var/lib/openshift/52f08f184382ecb8e9000239/app-deployments/</strong></span>
<span class="strong"><strong class="calibre7">OPENSHIFT_TMP_DIR=/tmp/</strong></span>
<span class="strong"><strong class="calibre7">SELINUX_USE_CURRENT_RANGE=</strong></span>
<span class="strong"><strong class="calibre7">OPENSHIFT_REPO_DIR=/var/lib/openshift/52f08f184382ecb8e9000239/app-root/runtime/repo/</strong></span>
<span class="strong"><strong class="calibre7">OPENSHIFT_HOMEDIR=/var/lib/openshift/52f08f184382ecb8e9000239/</strong></span>
<span class="strong"><strong class="calibre7">OPENSHIFT_GEAR_NAME=myapp</strong></span>
<span class="strong"><strong class="calibre7">PHPRC=/var/lib/openshift/52f08f184382ecb8e9000239/php//configuration/etc/php.ini</strong></span>
<span class="strong"><strong class="calibre7">OPENSHIFT_PYPI_MIRROR_URL=http://mirror1.ops.rhcloud.com/mirror/python/web/simple</strong></span>
<span class="strong"><strong class="calibre7">OPENSHIFT_CRON_DIR=/var/lib/openshift/52f08f184382ecb8e9000239/cron/</strong></span>
<span class="strong"><strong class="calibre7">OPENSHIFT_APP_SSH_PUBLIC_KEY=/var/lib/openshift/52f08f184382ecb8e9000239/.openshift_ssh/id_rsa.pub</strong></span>
<span class="strong"><strong class="calibre7">OPENSHIFT_CLOUD_DOMAIN=rhcloud.com</strong></span>
<span class="strong"><strong class="calibre7">USER=52f08f184382ecb8e9000239</strong></span>
<span class="strong"><strong class="calibre7">..// Removed for brevity</strong></span>
</pre></div><p class="calibre6">As you can see in the result of the previous command, the list also includes environment variables specific to the cron cartridge that we added in the previous recipe.</p><p class="calibre6">In this recipe, you will learn how you can create application-specific environment variables.</p></div>

<div class="book" title="Setting application-specific environment variables">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec175" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To complete this recipe, you will need rhc installed on your machine. Also, you will need to use the OpenShift application created in the <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe.</p></div></div>

<div class="book" title="Setting application-specific environment variables">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec176" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Perform the following steps to <a id="id292" class="calibre1"/>set application-specific environment variables:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">To create an application-specific environment variable, open a new command-line terminal and run the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">rhc env-set --app myapp --env MY_APP_ENV="Hello OpenShift Environment Variables"</strong></span>
</pre></div></li><li class="listitem" value="2">To test the environment variable, open the<code class="email">index.php</code> file in the <code class="email">myapp</code> folder, as follows:<div class="informalexample"><pre class="programlisting">&lt;hgroup&gt;
&lt;h1&gt;Welcome to your PHP application on OpenShift&lt;/h1&gt;
&lt;/hgroup&gt;</pre></div><p class="calibre14">Then, make the following changes in the file:</p><div class="informalexample"><pre class="programlisting">&lt;hgroup&gt;
&lt;h1&gt;
&lt;?php
echo($_ENV["MY_APP_ENV"]);
?&gt;</pre></div><div class="informalexample"><pre class="programlisting">&lt;/h1&gt;
&lt;/hgroup&gt;</pre></div></li><li class="listitem" value="3">Finally, commit the changes and push it into application gear:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">git commit –am "added environment variable in index.php"</strong></span>
<span class="strong"><strong class="calibre7">git push</strong></span>
</pre></div></li><li class="listitem" value="4">After a successful push, go to <code class="email">http://myapp-osbook.rhcloud.com/</code> to view the change.</li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Setting application-specific environment variables">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec177" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">The <code class="email">rhc env-set</code> command<a id="id293" class="calibre1"/> allows a developer to set their application-specific environment variables. This is what happens when you run the <code class="email">rhc env-set</code> command:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">The <code class="email">rhc</code> command-line client makes an HTTP POST request with the environment variable data in the body.</li><li class="listitem" value="2">The OpenShift broker receives the request and performs some validation. If the validation check fails, the user would be presented with an error message.</li><li class="listitem" value="3">After passing the validation checks, the broker will create tasks to update all the application gears with a new environment variable.</li><li class="listitem" value="4">Once done, the user will be shown the success message:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">Setting environment variable(s) ... done</strong></span>
</pre></div></li></ol><div class="calibre13"/></div><div class="informalexample" title="Note"><h3 class="title2"><a id="note15" class="calibre1"/>Note</h3><p class="calibre6">The environment variable will not be available until you restart the application. So, after setting the environment, restart the app using the <code class="email">rhc app-restart</code> command.</p></div><p class="calibre6">Not only can you set <a id="id294" class="calibre1"/>one environment variable at a time, but you can also set multiple environment variables in one go:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">rhc env-set –app myapp –env MY_APP_ENV1=test1 MY_APP_ENV2=test2</strong></span>
</pre></div><p class="calibre6">There is another alternative to setting up multiple environment variables that use a file to store environment variables and the passing of the file to the <code class="email">rhc env-set</code> command. You should create a new file named <code class="email">envs.txt</code> and enter one environment variable per line:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">MY_APP_ENV1=test</strong></span>
<span class="strong"><strong class="calibre7">MY_APP_ENV2=</strong></span>
</pre></div><p class="calibre6">Now, you can pass the <code class="email">envs.txt</code> file to the <code class="email">rhc env-set</code> command, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">rhc env-set –app myapp envs.txt</strong></span>
</pre></div><p class="calibre6">If you want to view all the application-specific environment variables, run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">rhc env-list –app myapp</strong></span>
</pre></div></div></div>

<div class="book" title="Setting application-specific environment variables">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch03lvl2sec178" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre6">To update the <a id="id295" class="calibre1"/>environment variable value, you should run the <code class="email">rhc env-set</code> command with a new value, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">rhc env-set --app myapp --env MY_APP_ENV="Hello World"</strong></span>
</pre></div><p class="calibre6">To remove an<a id="id296" class="calibre1"/> environment variable, run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc env-remove --env MY_APP_ENV –confirm</strong></span>
</pre></div></div></div>

<div class="book" title="Setting application-specific environment variables">
<div class="book" title="See more"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch03lvl2sec179" class="calibre1"/>See more</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Viewing application details</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Taking and restoring application backups"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec47" class="calibre1"/>Taking and restoring application backups</h1></div></div></div><p class="calibre6">In the real world, things <a id="id297" class="calibre1"/>can go wrong at any time, and you should always have <a id="id298" class="calibre1"/>a backup of your entire application that you can apply to restore the application to a happy state. An OpenShift application consists of a Git repository, one or more databases, environment variables, and a persistent data directory you should make a backup of. You can make database backups using command-line tools, such as <code class="email">mysqldump</code>, <code class="email">pg_dump</code>, and <code class="email">mongoexport</code>, but those only make backups of the respective databases. We will cover database backups in later chapters. In this recipe, you will learn how to use rhc to make and restore backups.</p></div>

<div class="book" title="Taking and restoring application backups">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec180" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">In order to prepare yourself for this recipe, you will need rhc installed on your machine. Also, you will need to make use of the application created in the <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe.</p></div></div>

<div class="book" title="Taking and restoring application backups">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec181" class="calibre1"/>How to do it…</h2></div></div></div><div class="book"><ol class="orderedlist"><li class="listitem" value="1">To make a backup of your application, open a command-line terminal and run the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc snapshot-save --app myapp --filepath myapp-backup.tar.gz</strong></span>
</pre></div></li><li class="listitem" value="2">Make a change to <code class="email">index.php</code> under the <code class="email">php</code> directory. Change the header to the following:<div class="informalexample"><pre class="programlisting">&lt;h1&gt;
   Welcome to your PHP application running on OpenShift
&lt;/h1&gt;</pre></div></li><li class="listitem" value="3">Commit the change to the local repository and push the changes to the application's remote Git repository to deploy the changes, as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ git commit -am "updated header in index.php"</strong></span>
<span class="strong"><strong class="calibre7">$ git push</strong></span>
</pre></div></li><li class="listitem" value="4">Go to <code class="email">http://myapp-{domain-name}.rhcloud.com/</code> to view your change.</li><li class="listitem" value="5">To restore your application from the backup, run the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc restore-snapshot --filepath myapp-backup.tar.gz</strong></span>
</pre></div></li><li class="listitem" value="6">Now, after applying the backup, if you visit the application URL at <code class="email">http://myapp-{domain-name}.rhcloud.com/</code>, you will notice that the change we made got reverted, as we applied the snapshot that was taken before making the change in step 2.</li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Taking and restoring application backups">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec182" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">Let's now<a id="id299" class="calibre1"/> understand what you did in the steps mentioned in the previous section. In step 1, you ran the <code class="email">rhc snapshot-save</code> command<a id="id300" class="calibre1"/> to make the application backup. The <code class="email">rhc</code> tool first retrieves the application details by<a id="id301" class="calibre1"/> making an HTTP GET request to the OpenShift broker. The application details include the SSH URL of the application. After getting the SSH URL, the <code class="email">rhc</code> command-line client executes a <code class="email">ssh &lt;application_ssh_url&gt;'snapshot'&gt;../backup/myapp-backup.tar.gz</code> command to back up the application. This uses the SSH command-line functionality of running a command on a remote server. The output of the snapshot command is written to the <code class="email">myapp-backup.tar.gz</code> file on your local machine. This <code class="email">rhc snapshot-save</code> command does not require the<code class="email">--filepath</code> option and will, by default, create a TAR file with a name as that of the application and write it to the current directory. This command first stops the application before creating a backup of all the directories under your application gear home directory. This includes the application Git repository, data directory, all the cartridges and their data, and environment variables. You can list the content of the <code class="email">tar.gz</code> file using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ tar -ztf myapp-backup.tar.gz</strong></span>
</pre></div><p class="calibre6">Through step 2 to step 4 of the previous list of steps to be performed, you made a small change in <code class="email">index.php</code>, pushed the change to your application gear, and then viewed the change by going to your application URL. This is done in order to test the restore functionality.</p><p class="calibre6">Step 5 restored the application backup you made in step 1 using the <code class="email">rhc snapshot-restore</code> command. The rhc command-line client first makes the HTTP GET request to get the SSH URL of the application. After getting the SSH URL, the rhc command-line client executes the <code class="email">cat '../backup/myapp-backup.tar.gz' | ssh &lt;application_ssh_url&gt;'restore INCLUDE_GIT'</code> command to restore the backup. The command pipes the standard output of the <code class="email">cat</code> command to the standard input of the SSH command. The restore commands will stop the application before replacing all the directories in the application gear home directory with the one in the backup archive.</p><p class="calibre6">Finally, in step 6, you verified that the change you made in step 2 was reverted, because you applied a backup that didn't reflect the change made in step 2.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note16" class="calibre1"/>Note</h3><p class="calibre6">The <code class="email">rhc snapshot</code> commands<a id="id302" class="calibre1"/> stop the application and then run the <code class="email">save</code> or <code class="email">restore</code> commands.</p></div></div></div>

<div class="book" title="Taking and restoring application backups">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch03lvl2sec183" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre6">The <code class="email">rhc snapshot</code> commands<a id="id303" class="calibre1"/> can also take another option, which is <code class="email">--ssh</code>. This can be used to specify a different SSH client and/or to pass SSH options. Suppose you want to print SSH debug information; you can use the SSH client <code class="email">-v</code> option:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">rhc snapshot-save --app myapp --filepath ../backup/myapp-backup.tar.gz --ssh 'ssh -v'</strong></span>
</pre></div><p class="calibre6">This will print all the SSH debug information. For brevity, I am only showing part of the output:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">Creating and sending tar.gz</strong></span>
<span class="strong"><strong class="calibre7">debug1: client_input_channel_req: channel 0 rtype exit-status reply 0</strong></span>
<span class="strong"><strong class="calibre7">debug1: client_input_channel_req: channel 0 rtype eow@openssh.com reply 0</strong></span>
<span class="strong"><strong class="calibre7">debug1: channel 0: free: client-session, nchannels 1</strong></span>
<span class="strong"><strong class="calibre7">debug1: fd 1 clearing O_NONBLOCK</strong></span>
<span class="strong"><strong class="calibre7">Transferred: sent 2688, received 207872 bytes, in 19.0 seconds</strong></span>
<span class="strong"><strong class="calibre7">Bytes per second: sent 141.2, received 10915.6</strong></span>
<span class="strong"><strong class="calibre7">debug1: Exit status 0</strong></span>
<span class="strong"><strong class="calibre7">RESULT:</strong></span>
<span class="strong"><strong class="calibre7">Success</strong></span>
</pre></div></div></div>

<div class="book" title="Taking and restoring application backups">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch03lvl2sec184" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Tracking and rolling back application deployments</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Tracking and rolling back application deployments"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec48" class="calibre1"/>Tracking and rolling back application deployments</h1></div></div></div><p class="calibre6">When you deploy the source<a id="id304" class="calibre1"/> code using <code class="email">git push</code>, OpenShift executes a <a id="id305" class="calibre1"/>new build, creates a deployment, deploys it to the respective server, and then starts your application container. By default, it will only track the last deployment of your application, which means you can't roll back to a previous deployment. In this recipe, you will learn how to configure your application to track multiple deployments and roll back to a particular deployment.</p></div>

<div class="book" title="Tracking and rolling back application deployments">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec185" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To step through this recipe, you will need to have rhc installed on your machine.</p></div></div>

<div class="book" title="Tracking and rolling back application deployments">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec186" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Perform the following <a id="id306" class="calibre1"/>steps to learn how to configure applications to track<a id="id307" class="calibre1"/> multiple deployments and roll back to a previous version:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Create a new PHP 5.4 application just like we created in the <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe, as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc create-app–-app myapp php-5.4</strong></span>
</pre></div></li><li class="listitem" value="2">To enable an OpenShift application to track 10 deployments (for instance), you should run the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc configure-app --app myapp --keep-deployments 10</strong></span>
</pre></div></li><li class="listitem" value="3">Make a change to <code class="email">index.php</code> in the application directory:<div class="informalexample"><pre class="programlisting">&lt;h1&gt;
   Configured the application to track 10 deployments
&lt;/h1&gt;</pre></div></li><li class="listitem" value="4">Commit the change and push the change to the application gear as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ git commit -am "enabled deployment tracking"</strong></span>
<span class="strong"><strong class="calibre7">$ git push</strong></span>
</pre></div></li><li class="listitem" value="5">View the change at <code class="email">http://myapp-{domai</code><code class="email">n-name}.rhcloud.com</code>.</li><li class="listitem" value="6">List all the deployments tracked by the application by running the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc deployment-list --app myapp</strong></span>

<span class="strong"><strong class="calibre7">7:42 PM, deployment fbaa7582</strong></span>
<span class="strong"><strong class="calibre7">7:47 PM, deployment ac5d6f39</strong></span>
</pre></div></li><li class="listitem" value="7">To roll back to the deployment with the ID <code class="email">fbaa7582</code>, run the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc deployment-activate --app myapp --id fbaa7582</strong></span>
</pre></div></li><li class="listitem" value="8">You can verify that rollback has happened by again running the <code class="email">rhc deployment-list</code> command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc deployment-list --app myapp</strong></span>
<span class="strong"><strong class="calibre7">7:42 PM, deployment fbaa7582</strong></span>
<span class="strong"><strong class="calibre7">7:47 PM, deployment ac5d6f39 (rolled back)</strong></span>
<span class="strong"><strong class="calibre7">7:50 PM, deployment fbaa7582 (rollback to 7:42 PM)</strong></span>
</pre></div></li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Tracking and rolling back application deployments">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec187" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">In step 1, you<a id="id308" class="calibre1"/> created a new PHP 5.4 application, and then in<a id="id309" class="calibre1"/> step 2, you configured the application to track 10 deployments using the <code class="email">rhc app-configure</code> command. Then, from step 2 through to step 5, you made a simple change in <code class="email">index.php</code> and deployed that change to the application gear. When you push the code to an application gear, a new deployment is created with the ID <code class="email">ac5d6f39</code> and is stored in the <code class="email">app-deployments</code> folder, under the application gear home directory. You can view the deployments stored under the <code class="email">app-deployments</code> directory, as shown in the following command. Every deployment is stored inside a directory with its name as the current timestamp. The current active deployment is stored under the current directory:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc ssh --command "ls  ~/app-deployments"</strong></span>
<span class="strong"><strong class="calibre7">2014-02-09_09-11-31.636</strong></span>
<span class="strong"><strong class="calibre7">2014-02-09_09-17-22.896</strong></span>
<span class="strong"><strong class="calibre7">by-id</strong></span>
<span class="strong"><strong class="calibre7">current</strong></span>
</pre></div><p class="calibre6">In step 6, you then listed all the deployments using the <code class="email">rhc deployment-list</code> command. The <code class="email">rhc deployment-list</code> command lists down all the deployments tracked. The first deployment with the ID <code class="email">fbaa7582</code> is the initial deployment that happened when you created the application. The second deployment with the ID <code class="email">ac5d6f39</code> is the deployment that happened after making a change in <code class="email">index.php</code>.</p><p class="calibre6">Step 7 involved rolling back the code to deployment with the ID <code class="email">fbaa7582</code> using the <code class="email">rhc deployment-activate</code> command. Under the hoods, the <code class="email">rhc deployment-activate</code> command runs the <code class="email">ssh &lt;application_ssh_url&gt; 'gear activate --all fbaa7582'</code> command on the application gear to activate the deployment.</p><p class="calibre6">Finally, in step 8, you ran the <code class="email">rhc deployment-list</code> command to view the information about the rollback that happened in step 7.</p></div></div>

<div class="book" title="Tracking and rolling back application deployments">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch03lvl2sec188" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre6">You can also enable deployment tracking during <a id="id310" class="calibre1"/>application creation, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc create-app myapp php-5.4 --keep-deployments 10</strong></span>
</pre></div><p class="calibre6">You can also view application configuration details using the <code class="email">rhc show-app</code> command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc show-app --app myapp --configuration</strong></span>
<span class="strong"><strong class="calibre7">myapp @ http://myapp-osbook.rhcloud.com/ (uuid: 52f78c895973ca4cbc000113)</strong></span>
<span class="strong"><strong class="calibre7">-------------------------------------------------------------------------</strong></span>
<span class="strong"><strong class="calibre7">  Deployment:        auto (on git push)</strong></span>
<span class="strong"><strong class="calibre7">  Keep Deployments:  10</strong></span>
<span class="strong"><strong class="calibre7">  Deployment Type:   git</strong></span>
<span class="strong"><strong class="calibre7">  Deployment Branch: master</strong></span>
</pre></div></div></div>

<div class="book" title="Tracking and rolling back application deployments">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch03lvl2sec189" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Taking and restoring application backups</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Configuring the default Git branch for deployment"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec49" class="calibre1"/>Configuring the default Git branch for deployment</h1></div></div></div><p class="calibre6">Every OpenShift application has an associated remote Git repository. When you push the source code to an application gear using <code class="email">git push</code>, you are pushing the source code to a Git remote named <code class="email">origin</code> and branch named <code class="email">master</code>. Every application is configured to autodeploy when code is pushed to the master branch on a remote origin. But it might so happen that you would like to use the master branch for development while using the production branch for deployment. In this recipe, you will learn how to configure an OpenShift application, where you will use a branch named <code class="email">production</code> for deployment and a master for development.</p></div>

<div class="book" title="Configuring the default Git branch for deployment">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec190" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">In order to complete this<a id="id311" class="calibre1"/> recipe, you will need rhc installed on your <a id="id312" class="calibre1"/>machine. Also, you will need to <a id="id313" class="calibre1"/>make use of the OpenShift application created in the <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe.</p></div></div>

<div class="book" title="Configuring the default Git branch for deployment">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec191" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Perform the following steps to configure a different branch for deployment:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open a command-line terminal and change the directory to the location where <code class="email">myapp</code> application exists.</li><li class="listitem" value="2">Create a new branch with the name <code class="email">production</code> using the Git command-line client:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ git branch production</strong></span>
</pre></div></li><li class="listitem" value="3">Configure the <code class="email">myapp</code> OpenShift application to use the <code class="email">production</code> branch for deployment:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc configure-app --deployment-branch production</strong></span>
</pre></div></li><li class="listitem" value="4">Open the <code class="email">index.php</code> file in the application directory and change the header to the following:<div class="informalexample"><pre class="programlisting">&lt;h1&gt;
Configured the 'production' branch for auto-deployment
&lt;/h1&gt;</pre></div></li><li class="listitem" value="5">Commit the change to the local repository, and then push the changes to the master branch. As we have configured the application to deploy the production branch, only the code will be pushed, so autodeployment will not happen:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ git commit -am "updated index.php"</strong></span>
<span class="strong"><strong class="calibre7">$ git push</strong></span>
</pre></div></li><li class="listitem" value="6">Next, check out the production branch, and merge the master branch changes:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ git checkout production</strong></span>
<span class="strong"><strong class="calibre7">$ git merge master</strong></span>
</pre></div></li><li class="listitem" value="7">Now, push the changes to application gear, and the changes will get deployed:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ git push origin production</strong></span>
</pre></div></li><li class="listitem" value="8">Now, if you go to <code class="email">http://myapp-{domain-name}.rhcloud.com</code>, you will view the changes made in step 4.</li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Configuring the default Git branch for deployment">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec192" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">OpenShift leverages the<a id="id314" class="calibre1"/> Git action hooks for<a id="id315" class="calibre1"/> application deployment. By default, deployment <a id="id316" class="calibre1"/>occurs every time you push the source code to the master branch. In step 1, you changed the directory to the <code class="email">myapp</code> application location on your command-line tool. Step 2 helped you to create a new branch named <code class="email">production</code> for future deployments. You can list all the branches in your Git repository using the <code class="email">git branch</code> command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ git branch</strong></span>
<span class="strong"><strong class="calibre7">* master</strong></span>
<span class="strong"><strong class="calibre7">  production</strong></span>
</pre></div><p class="calibre6">In step 3, you configured the application to use the production branch for application deployment. You will get the following output upon successful completion of the command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">Configuring application 'myapp' ... done</strong></span>
<span class="strong"><strong class="calibre7">myapp @ http://myapp-osbook.rhcloud.com/ (uuid: 52f78c895973ca4cbc000113)</strong></span>
<span class="strong"><strong class="calibre7">-------------------------------------------------------------------------</strong></span>
<span class="strong"><strong class="calibre7">  Deployment:        auto (on git push)</strong></span>
<span class="strong"><strong class="calibre7">  Keep Deployments:  10</strong></span>
<span class="strong"><strong class="calibre7">  Deployment Type:   git</strong></span>
<span class="strong"><strong class="calibre7">  Deployment Branch: production</strong></span>

<span class="strong"><strong class="calibre7">Your application 'myapp' is now configured as listed above.</strong></span>
</pre></div><p class="calibre6">The output shows that the deployment branch is changed to <code class="email">production</code>.</p><p class="calibre6">In step 4, you made a change to <code class="email">index.php</code> in which you committed and pushed the changes to the master branch in step 5. One thing you will notice is that the <code class="email">git push</code> command only pushes the <a id="id317" class="calibre1"/>bits to the application gear, but it <a id="id318" class="calibre1"/>does not invoke the deployment. The <a id="id319" class="calibre1"/>application deployment does not happen, because in step 3, you configured the deployment of the application when to changes are pushed to the production branch. The output of the <code class="email">git push</code> command is as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">Counting objects: 7, done.</strong></span>
<span class="strong"><strong class="calibre7">Delta compression using up to 8 threads.</strong></span>
<span class="strong"><strong class="calibre7">Compressing objects: 100% (4/4), done.</strong></span>
<span class="strong"><strong class="calibre7">Writing objects: 100% (4/4), 427 bytes, done.</strong></span>
<span class="strong"><strong class="calibre7">Total 4 (delta 2), reused 0 (delta 0)</strong></span>
<span class="strong"><strong class="calibre7">To ssh://52f78c895973ca4cbc000113@myapp-osbook.rhcloud.com/~/git/myapp.git/</strong></span>
<span class="strong"><strong class="calibre7">   8252402..9e4ac48  master -&gt; master</strong></span>
</pre></div><p class="calibre6">In step 6, you checked out the production branch and merged the changes that you made in the master branch. You pushed the changes to the production branch in step 7, which will invoke the autodeployment, and the changes will be deployed to the application. The <code class="email">git push origin production</code> command is shown as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ git push origin production</strong></span>
<span class="strong"><strong class="calibre7">Total 0 (delta 0), reused 0 (delta 0)</strong></span>
<span class="strong"><strong class="calibre7">remote: Stopping PHP 5.4 cartridge (Apache+mod_php)</strong></span>
<span class="strong"><strong class="calibre7">remote: Waiting for stop to finish</strong></span>
<span class="strong"><strong class="calibre7">remote: Building git ref 'production', commit 9e4ac48</strong></span>
<span class="strong"><strong class="calibre7">remote: Checking deplist.txt for PEAR dependency..</strong></span>
<span class="strong"><strong class="calibre7">remote: Preparing build for deployment</strong></span>
<span class="strong"><strong class="calibre7">remote: Deployment id is 8c2a41a8</strong></span>
<span class="strong"><strong class="calibre7">remote: Activating deployment</strong></span>
<span class="strong"><strong class="calibre7">remote: Starting PHP 5.4 cartridge (Apache+mod_php)</strong></span>
<span class="strong"><strong class="calibre7">remote: -------------------------</strong></span>
<span class="strong"><strong class="calibre7">remote: Git Post-Receive Result: success</strong></span>
<span class="strong"><strong class="calibre7">remote: Activation status: success</strong></span>
<span class="strong"><strong class="calibre7">remote: Deployment completed with status: success</strong></span>
<span class="strong"><strong class="calibre7">To ssh://52f78c895973ca4cbc000113@myapp-osbook.rhcloud.com/~/git/myapp.git/</strong></span>
<span class="strong"><strong class="calibre7"> * [new branch]      production -&gt; production</strong></span>
</pre></div><p class="calibre6">Finally, you viewed that changes were actually deployed by visiting the application.</p></div></div>

<div class="book" title="Configuring the default Git branch for deployment">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch03lvl2sec193" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre6">What if you want to<a id="id320" class="calibre1"/> turn off automatic deployment <a id="id321" class="calibre1"/>altogether, that is, if you do not want to <a id="id322" class="calibre1"/>deploy even on the production branch, this can be achieved using the <code class="email">--no-auto-deploy</code> option:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc configure-app --app myapp --no-auto-deploy</strong></span>
</pre></div><p class="calibre6">This will turn off autodeployment, and only code will be pushed to the Git repository hosted on the application gear. If you want to deploy code, you have to do manual deployment, as explained in the <span class="strong"><em class="calibre10">Doing manual deployments</em></span> recipe.</p></div></div>

<div class="book" title="Configuring the default Git branch for deployment">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch03lvl2sec194" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Tracking and rolling back application deployments</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Doing manual deployments </em></span>recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Doing manual deployments"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec50" class="calibre1"/>Doing manual deployments</h1></div></div></div><p class="calibre6">In the <span class="strong"><em class="calibre10">Configuring the default Git branch for deployment</em></span> recipe, under the <span class="strong"><em class="calibre10">There's more...</em></span> section, we looked at how to turn off autodeployment using the <code class="email">--no-auto-deploy</code> option with the <code class="email">rhc app-configure</code> command. What do you do if you want to deploy the application after<a id="id323" class="calibre1"/> switching off autodeployment? One solution would be to reconfigure the application to autodeploy by running the <code class="email">rhc app-configure –auto-deploy</code> command. This solution is good if you want to perform autodeployment from now on, but if you want to manage deployment yourself, the <code class="email">--auto-deploy</code> option is not a solution. In this recipe, you will learn how to manually deploy the application to OpenShift.</p></div>

<div class="book" title="Doing manual deployments">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec195" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To complete this recipe, you will need rhc installed on your machine. Also, you will need the application you created in the <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe.</p></div></div>

<div class="book" title="Doing manual deployments">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec196" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Perform the following steps to <a id="id324" class="calibre1"/>perform manual deployments:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open a command-line terminal and change the directory to the <code class="email">myapp</code> application.</li><li class="listitem" value="2">Disable autodeployment of the application using the <code class="email">--no-auto-deploy</code> option with the rhc <code class="email">configure-app</code> command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc configure-app --app myapp --no-auto-deploy</strong></span>
</pre></div></li><li class="listitem" value="3">Make a change to the application's <code class="email">index.php</code>:<div class="informalexample"><pre class="programlisting">&lt;h1&gt;
Application configured with no-auto-deploy
&lt;/h1&gt;</pre></div></li><li class="listitem" value="4">Commit the change, and push it to the application gear. As autodeployment is turned off, the code will not be deployed:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ git commit –am "updated index.php"</strong></span>
<span class="strong"><strong class="calibre7">$ git push</strong></span>
</pre></div></li><li class="listitem" value="5">To manually deploy the change, use the <code class="email">rhc deploy</code> command to deploy the master branch:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc deploy --app --ref master</strong></span>
</pre></div></li><li class="listitem" value="6">View the change by visiting <code class="email">http://myapp-{domain-name}.rhcloud.com</code>.</li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Doing manual deployments">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec197" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">In step 1, you changed the directory to the <code class="email">myapp</code> application location. To disable autodeployment, you used the <code class="email">rhc configure-app</code> command with the <code class="email">--no-auto-deploy</code> option. You can view the application details by running the <code class="email">rhc show-app</code> command with the <code class="email">--configuration</code> option:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc show-app --configuration </strong></span>
<span class="strong"><strong class="calibre7">myapp @ http://myapp-osbook.rhcloud.com/ (uuid: 52f78c895973ca4cbc000113)</strong></span>
<span class="strong"><strong class="calibre7">-------------------------------------------------------------------------</strong></span>
<span class="strong"><strong class="calibre7">  Deployment:        manual (use 'rhc deploy')</strong></span>
<span class="strong"><strong class="calibre7">  Keep Deployments:  10</strong></span>
<span class="strong"><strong class="calibre7">  Deployment Type:   git</strong></span>
<span class="strong"><strong class="calibre7">  Deployment Branch: master</strong></span>
</pre></div><p class="calibre6">As you can see in the previous command, the deployment has been set to manual. In steps 3 and 4, you made a change in <code class="email">index.php</code> and then committed and pushed the change to the application gear. The autodeployment will not kick in, as we disabled it in step 2. The output of the <code class="email">git push</code> command is shown as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ git push</strong></span>
<span class="strong"><strong class="calibre7">Counting objects: 7, done.</strong></span>
<span class="strong"><strong class="calibre7">Delta compression using up to 8 threads.</strong></span>
<span class="strong"><strong class="calibre7">Compressing objects: 100% (4/4), done.</strong></span>
<span class="strong"><strong class="calibre7">Writing objects: 100% (4/4), 421 bytes, done.</strong></span>
<span class="strong"><strong class="calibre7">Total 4 (delta 2), reused 0 (delta 0)</strong></span>
<span class="strong"><strong class="calibre7">To ssh://52f78c895973ca4cbc000113@myapp-osbook.rhcloud.com/~/git/myapp.git/</strong></span>
<span class="strong"><strong class="calibre7">   9e4ac48..75ea3dc  master -&gt; master</strong></span>
</pre></div><p class="calibre6">In step 5, you manually deployed the change using the <code class="email">rhc deploy</code> command. The <code class="email">rhc</code> <code class="email">deploy</code> command needs a reference that can be either a Git tag, Git commit ID, or Git branch name. This step made use of the master branch for deployment. The <code class="email">rhc deploy</code> command under the hood executed the <code class="email">gear deploy master</code> command on the application gear. The output of step 5 is shown as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc deploy --ref master</strong></span>
<span class="strong"><strong class="calibre7">Deployment of git ref 'master' in progress for application myapp ...</strong></span>
<span class="strong"><strong class="calibre7">Stopping PHP 5.4 cartridge (Apache+mod_php)</strong></span>
<span class="strong"><strong class="calibre7">Waiting for stop to finish</strong></span>
<span class="strong"><strong class="calibre7">Building git ref 'master', commit 75ea3dc</strong></span>
<span class="strong"><strong class="calibre7">Checking deplist.txt for PEAR dependency..</strong></span>
<span class="strong"><strong class="calibre7">Preparing build for deployment</strong></span>
<span class="strong"><strong class="calibre7">Deployment id is c36cde4a</strong></span>
<span class="strong"><strong class="calibre7">Activating deployment</strong></span>
<span class="strong"><strong class="calibre7">Starting PHP 5.4 cartridge (Apache+mod_php)</strong></span>
<span class="strong"><strong class="calibre7">Success</strong></span>
</pre></div><p class="calibre6">As you can see in the <a id="id325" class="calibre1"/>previous command, first cartridges are stopped, and then the application is built using the latest commit ID of the Git master branch before finally deploying the changes.</p><p class="calibre6">Finally, you can view the deployed application and verify that changes are deployed.</p></div></div>

<div class="book" title="Doing manual deployments">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch03lvl2sec198" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre6">Instead of using the<a id="id326" class="calibre1"/> branch name, you can also use the<a id="id327" class="calibre1"/> Git commit ID or Git tag with the <code class="email">rhc deploy</code> command. You can see how to use a commit ID with the <code class="email">rhc deploy</code> command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc deploy --ref 9e4ac482d87fdbcf82546afb5a58910be0b9ef19</strong></span>
</pre></div></div></div>

<div class="book" title="Doing manual deployments">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch03lvl2sec199" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Viewing application details</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Configuring and doing binary deployments"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec51" class="calibre1"/>Configuring and doing binary deployments</h1></div></div></div><p class="calibre6">So far, we have looked at<a id="id328" class="calibre1"/> how easy it is to perform Git-based deployments <a id="id329" class="calibre1"/>with OpenShift, where you perform a <code class="email">git push</code> command, and OpenShift builds and deploys the application. This is ideal if you want to perform source-based deployments. It may be that you want OpenShift to also manage your source code using Git. But there are cases when developers do not want to push their source code to OpenShift servers. In those cases, you can use binary deployments to deploy your binary artifact. This is ideal when you want to deploy binary artifacts, such as a <code class="email">.war</code> file, as Git is not an efficient means for storing binaries.</p></div>

<div class="book" title="Configuring and doing binary deployments">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec200" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To step through this recipe, you will need rhc installed on your machine.</p></div></div>

<div class="book" title="Configuring and doing binary deployments">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec201" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Perform the following steps to perform binary deployment:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open a command-line terminal and change the directory to an appropriate location. Then, create a new JBoss EAP 6 application using rhc, as shown in the following command. Note that we are using the <code class="email">--no-git</code> option, as we do not want to use Git:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc create-app javaapp jbosseap --no-git</strong></span>
</pre></div></li><li class="listitem" value="2">Configure the application to use binary deployment. Also, switch off autodeploy, and configure the application to store two deployments. This will help if we want to roll back to a previous version later. Have a look at the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc configure-app --app javaapp --no-auto-deploy --keep-deployments 2 --deployment-type binary</strong></span>
</pre></div></li><li class="listitem" value="3">Create a directory structure, as shown in the following commands:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ mkdir javaapp-binary-deployment</strong></span>
<span class="strong"><strong class="calibre7">$ cd javaapp-binary-deployment/</strong></span>
<span class="strong"><strong class="calibre7">$ mkdir -p build-dependencies/.m2 repo/deployments dependencies/jbosseap/deployments</strong></span>
</pre></div></li><li class="listitem" value="4">Download or copy the WAR file to the <code class="email">repo/deployments</code> folder:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ cd repo/deployments</strong></span>
<span class="strong"><strong class="calibre7">$ wget https://github.com/OpenShift-Cookbook/chapter3-recipe15/raw/master/ROOT.war --no check-certificate</strong></span>
</pre></div></li><li class="listitem" value="5">Package the folder structure to an archive. You can use the ZIP, TAR, tar.gz, or tar.bz formats:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ cd ../../</strong></span>
<span class="strong"><strong class="calibre7">$ tar -czvf ../javaapp-archive.tar.gz ./</strong></span>
</pre></div></li><li class="listitem" value="6">Deploy the new binary artifact using the <code class="email">rhc deploy</code> command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">rhc deploy --app javaapp --ref ../javaapp-archive.tar.gz</strong></span>
</pre></div></li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Configuring and doing binary deployments">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec202" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">In step 1, you created a<a id="id330" class="calibre1"/> JBoss EAP 6 application named <code class="email">javaapp</code>. You also <a id="id331" class="calibre1"/>specified the <code class="email">--no-git</code> option with the <code class="email">rhc app-create</code> command, as we do not want to clone the Git repository to the local machine. Next, in step 2, you configured the application to use binary deployment. OpenShift supports two types of deployment—Git and binary. The Git deployment type is the default deployment type and is invoked via a <code class="email">git push</code> command. When you use this, the gear will build a deployment artifact and then deploy the artifact to the server. </p><p class="calibre6">With the binary deployment type, you have to provide the deployment archive, as the OpenShift gear will not be responsible for building the deployment. The binary deployment requires an archive that follows a specified directory format. In step 3, you created a directory structure specific to the JBoss EAP 6 application type. Have a look at the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ tree -a</strong></span>
<span class="strong"><strong class="calibre7">.</strong></span>
<span class="strong"><strong class="calibre7">├── build-dependencies</strong></span>
<span class="strong"><strong class="calibre7">│   └── .m2</strong></span>
<span class="strong"><strong class="calibre7">├── dependencies</strong></span>
<span class="strong"><strong class="calibre7">│   └── jbosseap</strong></span>
<span class="strong"><strong class="calibre7">│       └── deployments</strong></span>
<span class="strong"><strong class="calibre7">└── repo</strong></span>
<span class="strong"><strong class="calibre7">    └── deployments</strong></span>

<span class="strong"><strong class="calibre7">7 directories, 0 files</strong></span>
</pre></div><p class="calibre6">As we are performing binary deployment, you just downloaded the WAR file to the <code class="email">repo/deployments</code> folder. Next, in step 5, you created a <code class="email">tar.gz</code> archive with the repository structure. Finally, in step 6, you deployed the binary artifact using the <code class="email">rhc deploy</code> command. You can also use the HTTP URL instead of the local file path, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc deploy --app javaapp --ref https://github.com/OpenShift-Cookbook/chapter3-recipe15/raw/master/javaapp-archive.tar.gz</strong></span>
</pre></div></div></div>

<div class="book" title="Configuring and doing binary deployments">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch03lvl2sec203" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre6">You can save a <a id="id332" class="calibre1"/>deployment <a id="id333" class="calibre1"/>snapshot anytime using the <code class="email">rhc snapshot-save</code> command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc snapshot-save --app javaapp --deployment</strong></span>
</pre></div><p class="calibre6">This will save a <code class="email">javaapp.tar.gz</code> archive on your local machine. Then, you can deploy this artifact at any point in time using the <code class="email">rhc deploy</code> command.</p></div></div>

<div class="book" title="Configuring and doing binary deployments">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch03lvl2sec204" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Viewing application details</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Using your own custom domain name"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec52" class="calibre1"/>Using your own custom domain name</h1></div></div></div><p class="calibre6">By default, all the applications created by OpenShift are subdomains of <a class="calibre1" href="http://rhcloud.com">rhcloud.com</a>. In this recipe, you will learn how to use your own domain name with the <code class="email">myapp</code> application you created in the <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe.</p></div>

<div class="book" title="Using your own custom domain name">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec205" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To complete this recipe, you will need<a id="id334" class="calibre1"/> rhc installed on your machine. Also, we will make use of the OpenShift application created in the <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe.</p></div></div>

<div class="book" title="Using your own custom domain name">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec206" class="calibre1"/>How to do it…</h2></div></div></div><div class="book"><ol class="orderedlist"><li class="listitem" value="1">The first step is to buy a domain name from a domain registration provider. I will use GoDaddy, as I have few domains registered there, but you can just as easily choose a different domain provider. I have bought the <code class="email">openshift-cookbook.in</code> domain name for this demonstration.</li><li class="listitem" value="2">Open your domain registration provider's DNS manager console, and add a <code class="email">CNAME</code> record. The <code class="email">CNAME</code> record lets you point one domain name to another. You can create a new <code class="email">CNAME</code> record that will point to <code class="email">www.subdomain to myapp-osbook.rhcloud.com</code>, as shown in the following screenshot:<div class="mediaobject"><img src="../images/00021.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="3">After creating the <code class="email">CNAME</code> record, you have to map your OpenShift application with the custom name. This is done using the <code class="email">rhc alias</code> command. To create an alias for <code class="email">www.openshift-cookbook.in</code>, run the following command. Please use your own domain name with the <code class="email">rhc alias</code> command. Have a look at the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc alias-add --app myapp www.openshift-cookbook.in</strong></span>
</pre></div></li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Using your own custom domain name">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec207" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">In step 2, you created a <a id="id335" class="calibre1"/>new <code class="email">CNAME</code> entry for the <code class="email">www</code> subdomain. OpenShift allows you to do this by pointing the <a id="id336" class="calibre1"/>
<span class="strong"><strong class="calibre7">Canonical Name</strong></span> (<span class="strong"><strong class="calibre7">CNAME</strong></span>) entry to your DNS provider's settings to provide an alias for your domain name. <code class="email">CNAME</code> specifies that the domain name is an alias of another domain name. In the previous example, <code class="email">www.openshift-cookbook.com</code> becomes an alias for <code class="email">http://myapp-osbook.rhcloud.com</code>. In step 3, you ran the <code class="email">rhc alias</code> command, which allows you to use your own domain names to run your apps. Technically, what OpenShift has done under the hood is to set up a Vhost in Apache to handle the URL.</p><p class="calibre6">Now, if you go to your custom domain name, such as <code class="email">http://www.openshift-cookbook.in</code>, you will see your OpenShift application home page.</p><p class="calibre6">This configuration works fine if you use the <code class="email">www</code> subdomain, but it will not work if we remove <code class="email">www</code> from the <code class="email">openshift-cookbook.in</code> URL. It is very common that developers would require both root and www URLs to work. To make it work, you have to use domain forwarding so that when a request comes to <code class="email">openshift-cookbook.in</code>, it will be forwarded to <code class="email">www.openshift-cookbook.in</code>. Open the DNS provider web console and go to the <span class="strong"><strong class="calibre7">Forward</strong></span> tab. Forward the requests coming to <code class="email">openshift-cookbook.in</code> to <code class="email">http://www.openshift-cookbook.in</code>, as follows:</p><div class="mediaobject"><img src="../images/00022.jpeg" alt="How it works…" class="calibre8"/></div><p class="calibre9"> </p><p class="calibre6">It will take 30 minutes or<a id="id337" class="calibre1"/> so to reflect the forwarding change. After changes are propagated, go to <code class="email">openshift-cookbook.in</code>, and you will be redirected to <code class="email">http://www.openshift-cookbook.in</code>.</p></div></div>

<div class="book" title="Using your own custom domain name">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch03lvl2sec208" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre6">You can also set an alias using the OpenShift web console. Please refer to the OpenShift blog at <a class="calibre1" href="https://www.openshift.com/blogs/how-to-configure-custom-domain-names-and-ssl-in-the-openshift-web-console">https://www.openshift.com/blogs/how-to-configure-custom-domain-names-and-ssl-in-the-openshift-web-console</a> for more information.</p></div></div>

<div class="book" title="Using your own custom domain name">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch03lvl2sec209" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Viewing application details</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Cleaning up the application"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec53" class="calibre1"/>Cleaning up the application</h1></div></div></div><p class="calibre6">As you start using <a id="id338" class="calibre1"/>OpenShift for application development, the different components, such as Git and cartridge log directories, which constitute an application, will start consuming disk space. In the OpenShift Online free tier, applications are allocated only 1 GB of disk space so that it becomes critical to use the disk space effectively to avoid disk quota errors. In this recipe, you will learn how to clean up your application periodically to avoid disk quota errors. </p></div>

<div class="book" title="Cleaning up the application">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec210" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To step through this recipe, you will need rhc installed on your machine. Also, we will use the OpenShift application created in the <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe.</p></div></div>

<div class="book" title="Cleaning up the application">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec211" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">To clean up the application, open a command-line terminal and run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc tidy-app --app myapp</strong></span>
</pre></div></div></div>

<div class="book" title="Cleaning up the application">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec212" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">The <code class="email">rhc tidy-app</code> command<a id="id339" class="calibre1"/> helps to manage the application disk space. Under the hood, it performs three operations:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">To start off, the <code class="email">rhc tidy-app</code> command stops the application.</li><li class="listitem" value="2">Next, it clears out the application <code class="email">tmp</code> directory. The location of the <code class="email">tmp</code> directory can be found by fetching the <code class="email">OPENSHIFT_TMP_DIR</code> environment variable.</li><li class="listitem" value="3">Next, it clears the log directory for each cartridge.</li><li class="listitem" value="4">Then, it clears up the application Git repository on the server. The Git repository cleanup is done using two Git commands—<code class="email">git prune</code> and <code class="email">git gc --aggressive</code>. The <code class="email">git prune</code> command removes all the unreachable objects from the Git repository object database. The <code class="email">git gc --aggressive</code> command deletes any loose objects and compresses objects to use the disk space more efficiently.</li><li class="listitem" value="5">Finally, it starts the application. The application is started even if the <code class="email">rhc tidy</code> command has any exceptions.</li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Cleaning up the application">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch03lvl2sec213" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre6">You can also create a daily<a id="id340" class="calibre1"/> or weekly cron job that would run <code class="email">git gc</code> periodically on the application gear. To do that, add the cron cartridge to the application. Refer to the <span class="strong"><em class="calibre10">Adding a cron cartridge to an application</em></span> recipe. After adding the cartridge, create a new shell script named <code class="email">gc_cleanup.sh</code> under the <code class="email">.openshift/cron/daily</code> directory, and add the following contents to it:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">#!/bin/bash</strong></span>
<span class="strong"><strong class="calibre7">cd ~/git/$OPENSHIFT_APP_NAME.git</strong></span>
<span class="strong"><strong class="calibre7">git prune</strong></span>
<span class="strong"><strong class="calibre7">git gc --aggressive</strong></span>
<span class="strong"><strong class="calibre7">echo "Ran Git cleanup at $(date)"&gt;&gt; $OPENSHIFT_REPO_DIR/php/git-gc.txt</strong></span>
</pre></div><p class="calibre6">Commit the files and push them to the application gear. The daily cron job will perform Git cleanup every day.</p></div></div>

<div class="book" title="Cleaning up the application">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch03lvl2sec214" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Viewing application details</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Deleting the application"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec54" class="calibre1"/>Deleting the application</h1></div></div></div><p class="calibre6">In this recipe, you will learn how to delete an OpenShift application.</p></div>

<div class="book" title="Deleting the application">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec215" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To step through this recipe, you <a id="id341" class="calibre1"/>will need rhc installed on your machine. Also, you will use the application created in the <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe.</p></div></div>

<div class="book" title="Deleting the application">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec216" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">To delete an application, open a <a id="id342" class="calibre1"/>command-line terminal and run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc delete-app --app myapp --confirm</strong></span>
</pre></div></div></div>

<div class="book" title="Deleting the application">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec217" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">The rhc <code class="email">-delete</code> command<a id="id343" class="calibre1"/> deletes the application and all its data on the OpenShift server. You cannot roll back this command, so use it with caution. Under the hood, the <code class="email">rhc -delete</code> command makes an HTTP DELETE request to delete the application.</p></div></div>

<div class="book" title="Deleting the application">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch03lvl2sec218" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Viewing application details</em></span> recipe</li></ul></div></div></div></body></html>