- en: Serving Static Content Using Azure CDN
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Hosting many static files, especially when we're developing a highly popular
    application, is a serious task, which impacts both the performance of our web
    service, and overall user experience. If we load images, files, or document too
    slowly, our customers may choose one of our competitors that provides similar
    features, but performs better. Thanks to cloud services such as Azure **Content
    Delivery Network** (**CDN**), we're able to handle high-bandwidth content quickly,
    due to integration with Azure Storage and using components native to Azure.
  prefs: []
  type: TYPE_NORMAL
- en: 'The following topics will be covered in this chapter:'
  prefs: []
  type: TYPE_NORMAL
- en: CDNs
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using and configuring Azure CDN
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Optimizing serving static content using Azure CDN
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Developing applications using Azure CDN
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Technical requirements
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'To perform exercises from this chapter, you will need the following:'
  prefs: []
  type: TYPE_NORMAL
- en: An Azure subscription
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Visual Studio 2017
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure CDN fundamentals
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: If you are hosting a popular website that contains many static files, you may
    wonder what is the best way to optimize serving them to your users. When searching
    for a solution, you have to take into consideration many different factors; HTTP
    protocol specification, browser capabilities, your server performance, network
    latencies, and so on. The whole problem is far from being trivial and requires
    significant resources to be implemented in the right way. To overcome the listed
    difficulties, the idea of CDNs was developed. CDN stands for content delivery
    network, and encapsulates the concept of a complex service that takes care of
    delivering the content to everyone who browses your website. In this chapter,
    you will learn about Azure CDN, which is an Azure component that is designed to
    be a fast and reliable solution for all the listed problems.
  prefs: []
  type: TYPE_NORMAL
- en: Working with CDNs
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'When a user accesses your website, it has to fetch all the static content that
    is provided for a specific page. This implies the following actions:'
  prefs: []
  type: TYPE_NORMAL
- en: A browser has to request all images, files, and scripts that are required by
    a web page
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The requests have to be queued, as there is a limit on how many requests to
    a single domain a browser can perform
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In most cases, a page has to be rendered gradually, as the content is fetched
    from the server
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A server can throttle requests if it is currently overloaded
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A browser has to respect all implemented caching mechanisms,of course, if your
    website tells it how to do it
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'We can describe the whole process as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/ea04f592-be54-481d-b7ec-dadf5a58c75e.png)'
  prefs: []
  type: TYPE_IMG
- en: 'In the preceding scenario, each request from a **user** is routed directly
    to the **website**. It then connects with the **server** to fetch the data. Of
    course, we can imagine the situation where files are hosted by separate servers,
    as demonstrated in the following diagram:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/107d6d8c-e4fc-4d3a-9494-ab40b7f947e4.png)'
  prefs: []
  type: TYPE_IMG
- en: Such an alternative can improve performance a little bit (as servers will be
    identified using different domain names), but it complicates maintenance and configuration.
    What is more, such a setup is not the right solution if you struggle with network
    latencies (as an additional server will not make a difference). While we are discussing
    different architectures, you are probably starting to imagine one more setup that
    may make a difference.
  prefs: []
  type: TYPE_NORMAL
- en: 'A proxy between a **website** and the **servers** that is responsible for proper
    caching can be easily scaled up and is highly available, as can be seen in the
    following diagram:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/009e149c-a9d5-44b1-b5c6-92ef819a5154.png)'
  prefs: []
  type: TYPE_IMG
- en: 'CDNs are exactly the proxy that we are talking about. They provide the following
    functionalities:'
  prefs: []
  type: TYPE_NORMAL
- en: They can be easily scaled up/out if the load exceeds our expectations
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: They can cache requests, so the end servers are not utilized too much
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: They respect the cache-control header, so it is easy to provide the **Time-To-Live**
    (**TTL**) of a resource
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: They improve the responsiveness of your website by serving content to multiple
    users simultaneously
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Later in this chapter, you will learn how to leverage such services by using Azure
    CDN.
  prefs: []
  type: TYPE_NORMAL
- en: Creating an Azure CDN in the portal
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The process of creating an Azure CDNis similar to all the other services that
    you are working with when reading this book. To get started, you have to click
    on the + Create a resourcebutton and search for `Azure CDN`. From the search results,
    you have to choose CDN. This will lead you to a form, where you can enter all
    required information regarding a new service:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/49c92fc7-949e-4c47-b845-b4f6313ed7cb.png)'
  prefs: []
  type: TYPE_IMG
- en: 'There are two things worth mentioning here:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Pricing tier: Pricing tiers look a little bit different compared with other
    Azure services, as you no longer have the Basic, Standard, and Premium options
    to choose from. Here you have to decide which product you will be using—you can
    select one from the list containing providers such as Verizon, Akamai, and Microsoft.
    They offer different features, such as dynamic site acceleration, video streaming
    optimization, and asset pre-loading. The full list can be found in the *Further
    reading*section for this chapter.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Create a new CDN endpoint now: If you know what your origin (an endpoint that
    will cache the resources) will be, you can create it right now for the whole service.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'To quickly check what is available in the particular pricing tier, you can
    click on the View full pricing detailslink:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/6503fb1b-0ee6-43c1-96a2-646a36a592e3.png)'
  prefs: []
  type: TYPE_IMG
- en: 'As you can see, you are paying for each GB of outbound data transfer, and depending
    on the selected provider, the price can differ almost five-fold. When you click
    on the Createbutton, the service creation process will start. Once it finishes,
    you can access your very own instance of Azure CDN:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/865bb801-e9bd-4252-aa50-4a97c45c8ef6.png)'
  prefs: []
  type: TYPE_IMG
- en: 'If you decided not to create an endpoint along with the service, you will see
    a similar screen to mine, with the Endpointssection empty. Let us click on the **+
    Endpoint **button to actually create one. As mentioned before, an endpoint is
    the element of a CDN that caches the data and serves it for a particular purpose.
    In the following, you can find an example setup for my first endpoint:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/38aa33f9-6cb8-43d7-8684-4c540570e91e.png)'
  prefs: []
  type: TYPE_IMG
- en: As you can see, I selected Storageas the Origin type. To be able to do so, you
    have to actually have an instance of Azure Storagein the same resource group as
    your CDN. You can also select other available types, such as Cloud Service, Web
    App, or a custom origin. Once you add an endpoint, you will be able to manage
    it by clicking on it on the Overviewtab.
  prefs: []
  type: TYPE_NORMAL
- en: Optimization and caching
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: CDNs are all about optimizing the content and caching it. In that way, they
    improve the performance of your website and user experience. In the previous section,
    you learned a little bit about the concept of Content Delivery Networks and configured
    your instance of Azure CDN*. *Now we will try to learn some more advanced features,
    such as compression, caching rules, and optimization.
  prefs: []
  type: TYPE_NORMAL
- en: Configuring the endpoint
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'To access the endpoint configuration, you have to click on it on the Overviewblade:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/6f8e6885-1639-4785-83b5-3341f66ff858.png)'
  prefs: []
  type: TYPE_IMG
- en: 'This will display a new screen, where you can find all information regarding
    that particular CDN endpoint, such as its hostname, available protocols, and configured
    rules for content optimization. In fact, the screen looks very similar to the
    previous one—it just offers some additional options:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/fd9e98d6-d3ca-4cf2-a385-f6e3746a2ab0.png)'
  prefs: []
  type: TYPE_IMG
- en: Now we will discuss different features available for an endpoint.
  prefs: []
  type: TYPE_NORMAL
- en: Compression
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'One of the basic features of CDNs is compression—they allow you to compress
    different file types on-the-fly, such as lowering their size and reducing network
    latency:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/aedfd0f7-a62e-4db5-b879-805416afbc45.png)'
  prefs: []
  type: TYPE_IMG
- en: When you enable it, you can select the MIME types you are interested in. You
    can also add new ones, if you plan to support any.
  prefs: []
  type: TYPE_NORMAL
- en: Remember that a file has to be cached by a CDN to be actually compressed on-the-fly.
  prefs: []
  type: TYPE_NORMAL
- en: Caching rules
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'By default, CDN caches content based on the Cache-Control header you provide.
    However, you can explicitly define how it should behave if:'
  prefs: []
  type: TYPE_NORMAL
- en: A header is missing
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A query string is introduced
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A particular match condition matches
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Here you can find a basic setup for this feature:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/fd3f71bf-5ce2-48ee-b47e-ff57a87a9203.png)'
  prefs: []
  type: TYPE_IMG
- en: As you can see, it gives you a lot of control over the behavior of the service,
    especially with the Custom caching rules.
  prefs: []
  type: TYPE_NORMAL
- en: Geo-filtering
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Sometimes you need to block specific content for specific countries. Such a
    feature might be problematic without CDN—you have to control programmatically
    who can access a given image or a file based on the geo-location. With Azure CDNyou
    can enable it within seconds:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/efd35d78-aa07-46ed-9a1a-66e32a2ebdfd.png)'
  prefs: []
  type: TYPE_IMG
- en: On the Geo-filteringblade, you can Configure different rules blocking or allowing
    access to a folder or a particular file inside CDN for a particular country.
  prefs: []
  type: TYPE_NORMAL
- en: Developing applications with Azure CDN
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Azure CDNitself does not give you anything special—it just caches content and
    takes responsibility for serving it without delays. The important thing, however,
    is to know how you can use it in your applications. In Azure, integrating Azure
    CDNwith, for example, Azure App Services,is a piece of cake. It only takes a few
    mouse clicks to get your CDN working with your existing web applications. In the
    last section of this chapter, you will see what is required to get the integration
    set up and ready to improve your website's performance.
  prefs: []
  type: TYPE_NORMAL
- en: Configuring Azure App Service with Azure CDN
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'To configure Azure App Serviceto work with your instance of Azure CDN, you
    will have to find the Networkingblade. This gives you the ability to enable different web
    app features, including CDN:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/082f68be-3451-4506-8b72-a93bbeebe3ae.png)'
  prefs: []
  type: TYPE_IMG
- en: When you click on Configure Azure CDN for your app, you will see another screen
    where you can configure the link between Azure App Serviceand Azure CDN*.*
  prefs: []
  type: TYPE_NORMAL
- en: Azure CDNwill automatically start caching static files, which can be found in
    your site. It is a good idea to publish your application at this moment, so you
    will not have to wait for the process to end later.
  prefs: []
  type: TYPE_NORMAL
- en: 'In fact, you have two options to proceed now:'
  prefs: []
  type: TYPE_NORMAL
- en: Use the existing CDN profile (if you performed exercises from the previous section
    of this chapter, you should have your CDN already created and ready to work)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Create a brand new profile
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'In the following, you can find my configuration (I chose an existing endpoint
    to speed things up):'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/5f5c8afa-194f-4586-84be-7a4843dc205c.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Once your endpoint is created, you can check whether it works. To do so, you
    can check, for example, the sources for your application as I did:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/ce920b0e-96ee-482f-a639-0a84a06b9e0b.png)'
  prefs: []
  type: TYPE_IMG
- en: For the purpose of this exercise, I used an example application from the template.
    As you can see, with the CDN configured, the source of my application is automatically
    altered—all static content is served using my Azure CDNendpoint instead of my
    server.
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, you learned what CDNs are and how they may help you in achieving
    better performance and user experience for your web applications. We have configured
    an Azure CDNinstance, and saw how to optimize serving content by compressing it.
    After reading this chapter, you should be able to filter particular content for
    particular countries, and be able to develop proper caching rules, so that you
    can define how your instance will behave.
  prefs: []
  type: TYPE_NORMAL
- en: In the next chapter, which is the last chapter in this book describing Azure
    services, we will cover one more advanced scenario—distributing load and securing
    data from outages with Azure Traffic Manager.
  prefs: []
  type: TYPE_NORMAL
- en: Questions
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: What problems does using Azure CDNsolve?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: What are the available CDN providers for Azure CDN*?*
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: What is the origin of the CDN?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How does compression work in Azure CDN*?*
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: What is the default TTL of content stored within Azure CDN?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Further reading
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: CDN features: [https://docs.microsoft.com/en-us/azure/cdn/cdn-features](https://docs.microsoft.com/en-us/azure/cdn/cdn-features)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
