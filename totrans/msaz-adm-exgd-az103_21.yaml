- en: Implementing Multi-Factor Authentication
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In the previous chapter, we covered the second part of the *Managing Identities* objective.
    You've learned how to install Azure AD Connect and how to manage it.
  prefs: []
  type: TYPE_NORMAL
- en: This chapter covers the last part of thisobjective and is the last chapter of
    this book. In this chapter, we are going to focus on **Multi-Factor Authentication
    (MFA)** in Azure, so you can add a second layer of security to sign-up and sign-in
    experiences for your Azure resources. We are going to look at the different verification
    methods and how you can configure this. We are also going to configure fraud alerts,
    so users can report fraudulent attempts to access their resources. And to finish
    this chapter, we are going to configure trusted IPs to bypass MFA.
  prefs: []
  type: TYPE_NORMAL
- en: 'The following topics will be covered in this chapter:'
  prefs: []
  type: TYPE_NORMAL
- en: Azure MFA
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Configuring user accounts for MFA
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Configuring verification methods
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Configuring fraud alerts
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Configuring bypass options
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Configuring trusted IPs
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure MFA
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: MFA is a security feature that requires more than one method of authentication.
    You can use it to add an additional layer of security to the sign in of users.
    It enables two-step verification, where the user first signs in using something
    they know (such as a password), and then signs in with something they have (such
    as a smart phone), or some human characteristic (such as biometrics).
  prefs: []
  type: TYPE_NORMAL
- en: Azure MFA maintains the simplicity for the users, but also helps to keep data
    and applications safe by providing additional security by requiring a second form
    of authentication. It offers a variety of configuration methods made by an administrator
    that determines whether users are challenged for MFA or not.
  prefs: []
  type: TYPE_NORMAL
- en: 'Azure MFA is part of the following offerings:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Azure Active Directory Premium license**: With this license, you can use Azure
    MFA Service (cloud) and Azure MFA Server (on-premises). The latter is most suitable
    in scenarios where an organization has **Active Directory Federation Services**
    (**ADFS**) installed and needs to manage infrastructure components.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Azure Active Directory Global Administrators**:A subset of the MFA features
    is available for administrator accounts in Azure.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**MFA for Office 365**:A subset of the MFA features is available for Office
    365 users.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'With Azure MFA, you can use the following verification methods:'
  prefs: []
  type: TYPE_NORMAL
- en: '| **Verification method** | **Description** |'
  prefs: []
  type: TYPE_TB
- en: '| Voice call | A call is made to the registered phone of the user. The user
    needs to enter a PIN for verification. |'
  prefs: []
  type: TYPE_TB
- en: '| Text message | A text message is sent to the user''s mobile phone containing
    a six digit code. The user needs to fill in this code on the sign-in page. |'
  prefs: []
  type: TYPE_TB
- en: '| Mobile app notification | A request for verification is sent to the user''s
    smart phone. When necessary, the user will enter a PIN and then select **Verify**.
    |'
  prefs: []
  type: TYPE_TB
- en: '| Mobile app verification code | The mobile app on the user''s smart phone
    will display a verification code, which will refresh every 30 seconds. The user
    will select the most recent code and will enter it in the sign-in page. |'
  prefs: []
  type: TYPE_TB
- en: '| Third-party tokens | Azure MFA Server can be configured to accept third-party
    security tokens. |'
  prefs: []
  type: TYPE_TB
- en: In the upcoming sections, we will enable MFA for the Azure AD tenant, configure
    user accounts, configure fraud alerts, and configure bypass options.
  prefs: []
  type: TYPE_NORMAL
- en: For the demos in this chapter, I will use an Azure Active Directory Premium
    P2 license.
  prefs: []
  type: TYPE_NORMAL
- en: Enabling MFA for an Azure AD tenant
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The following are the three different options for enabling MFA for your users,
    data, and applications:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Using a conditional access policy**:You can use conditional access policies
    to enable MFA. This can be enabled at the user or application level. You can also
    enable MFA for security groups or for all external users using a conditional access
    policy. This is available for premium Azure AD licenses.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**At**** the user level**: This option is covered in more detail in the next
    section of this chapter. This is the traditional method for enabling MFA. With
    this method, the user needs to perform MFA every time they sign in. This will
    override conditional access policies when these are set.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Using Azure AD Identity Protection**:With this option, you will create an Azure
    AD Identity Protection risk policy based on sign-in risk for all of your cloud
    applications. This will also override conditional access policies, if created.
    This option requires an Azure Active Directory P2 license.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Configuring user accounts for MFA
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Azure MFA is enabled in Azure AD at the user level. To enable MFA for a user
    account in Azure AD, take the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to the Azure portal by opening [https://portal.azure.com/](https://portal.azure.com/).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Go to All services, then type `Azure Active Directory` and open the Azure AD
    resource.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'In the Azure AD blade, under Manage, select Users as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/aca40d2e-dd26-4c76-a88a-d54ec5ba295a.png)'
  prefs: []
  type: TYPE_IMG
- en: Azure AD user settings
  prefs: []
  type: TYPE_NORMAL
- en: 'In the All users blade, select Multi-Factor Authentication in the top menu
    as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/7d9b219f-c31d-448e-a8ba-72e82496e187.png)'
  prefs: []
  type: TYPE_IMG
- en: Selecting Multi-Factor Authentication
  prefs: []
  type: TYPE_NORMAL
- en: 'You then will be redirected to the multi-factor authentication portal. In there,
    select a user and click Enable at the right side of the screen as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/07218d30-4cd5-4126-803c-af1a89eca6ef.png)'
  prefs: []
  type: TYPE_IMG
- en: Enabling MFA for a user
  prefs: []
  type: TYPE_NORMAL
- en: 'After clicking the link, you will receive the following warning:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/64944165-4fea-4794-b0ac-7214941fc38b.png)'
  prefs: []
  type: TYPE_IMG
- en: Warning window
  prefs: []
  type: TYPE_NORMAL
- en: Click enable multi-factor auth to activate MFA for this user.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now that we have enabled MFA for the user, we can look at how to configure the
    verification methods.
  prefs: []
  type: TYPE_NORMAL
- en: Configuring the verification methods
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Verification methods are also configured in the Azure MFA portal, just as you
    enabled MFA for the user account in the previous step. Take the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: 'With the MFA portal still open, select service settings in the top menu as
    follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/746619c7-71f3-46db-87c3-fc80412bae6a.png)'
  prefs: []
  type: TYPE_IMG
- en: MFA portal service settings
  prefs: []
  type: TYPE_NORMAL
- en: 'Under verification options, you can select the methods that you want to enable
    for your users. By default, all verification options are enabled, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/de2f7f15-a19b-4218-ab02-38ce15905015.png)'
  prefs: []
  type: TYPE_IMG
- en: MFA verification options
  prefs: []
  type: TYPE_NORMAL
- en: If you want to disable options, uncheck the checkbox and click the Save button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: We have seen how to configure the verification methods that users are allowed
    to use for using MFA in Azure. In the next section, we are going to look at how
    to configure trusted IPs.
  prefs: []
  type: TYPE_NORMAL
- en: Configuring trusted IPs
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Trusted IPs are used by administrators of an Azure AD tenant. This option will
    bypass the MFA for users that sign in from a trusted IP, such as the company intranet.
  prefs: []
  type: TYPE_NORMAL
- en: 'Trusted IPs can be configured from the service settingspage from the MFA portal.
    Take the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: 'With the server settings page still open from the previous demonstration, under trusted
    ips, check the checkbox that says Skip multi-factor authentication for requests
    from federated users on my intranet. Then, add an IP address or a range of IP
    addresses in the list as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/639a2dc4-f937-4318-8cb6-d9878f327d2b.png)'
  prefs: []
  type: TYPE_IMG
- en: Trusted IP settings
  prefs: []
  type: TYPE_NORMAL
- en: Click the Save button to save your settings.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the next section, we are going to cover how to configure fraud alerts in
    the Azure portal.
  prefs: []
  type: TYPE_NORMAL
- en: Configuring fraud alerts
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: With the fraud alert feature, users can report fraudulent attempts to access
    their resources using their phone or the mobile app. This is an MFA Server (on-premises)
    feature.
  prefs: []
  type: TYPE_NORMAL
- en: 'Fraud alerts are configured from the Azure portal, in the Azure Active Directory
    settings. Take the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to the Azure portal by opening [https://portal.azure.com](https://portal.azure.com).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select All services,then type `Azure Active Directory` in the search bar and
    open the settings.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Under Security, select MFA as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/72ad9500-1783-4a28-9e7b-f95b0d8597f6.png)'
  prefs: []
  type: TYPE_IMG
- en: MFA in Azure AD
  prefs: []
  type: TYPE_NORMAL
- en: The Getting started blade is automatically opened. Under Settings, select the Fraud
    alert.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'The Fraud alert settings page is opened. In here, you can enable users to submit
    fraud alerts as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/02b38c8f-8310-456c-a4c9-9d6d240ce60b.png)'
  prefs: []
  type: TYPE_IMG
- en: Enable submitting fraud alerts
  prefs: []
  type: TYPE_NORMAL
- en: Click the Save button to save the settings.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: We've now seen how we can allow users to submit fraud alerts. In the next section,
    we are covering how to configure bypass options.
  prefs: []
  type: TYPE_NORMAL
- en: Configuring bypass options
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: With the one-time bypass feature, users can authenticate once and bypass the
    MFA. This setting is temporary, and after a specified number of seconds, it will
    expire automatically. This can be a solution in cases when a phone or mobile app
    doesn't receive a phone call or a notification.
  prefs: []
  type: TYPE_NORMAL
- en: 'This setting is also configured from the Azure Active Directory settings in
    the Azure portal as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to the Azure portal by opening [https://portal.azure.com](https://portal.azure.com).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select All services,then type `Azure Active Directory` in the search bar and
    open the settings.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Under Manage MFA Server, select One-time bypass as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/5849987c-ef9d-49e4-8abe-d29d2b6929a3.png)'
  prefs: []
  type: TYPE_IMG
- en: One-time bypass
  prefs: []
  type: TYPE_NORMAL
- en: In the settings page, enter the username, including the full domain name, such
    as `username@domain.com`. Specify the number of seconds that the bypass should
    last and the reason for the bypass.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the Add button. The time limit will go in immediately.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: We've now covered how to authenticate once and bypass the MFA using the one-time bypass
    feature.
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we covered the last part the *Managing Identities*objective
    by looking at how to configure user accounts for MFAin Azure. We covered different
    authentication methods and enabled it for our users. Lastly, we looked at the
    various ways to bypass MFA, such as trusted IP addresses.
  prefs: []
  type: TYPE_NORMAL
- en: With the knowledge gained throughout the chapters, you should be able to pass
    the AZ-103 exam. Don't forget to look at the *Further reading* sections at the
    end of each chapter, because there is a lot of extra information there that could
    be covered in the exam as well.
  prefs: []
  type: TYPE_NORMAL
- en: Questions
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Answer the following questions to test your knowledge of the information in
    this chapter. You can find the answers in the *Assessments* section at the end
    of this book:'
  prefs: []
  type: TYPE_NORMAL
- en: Can you add trusted IP addresses for bypassing MFA for certain IPs?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Yes'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'No'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: MFA cannot be enabled using conditional access policies.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Yes'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'No'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Are fraud alerts part of the MFA Server (on-premises) offering?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Yes'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'No'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Further reading
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'You can check the following links for more information about the topics that
    are covered in this chapter:'
  prefs: []
  type: TYPE_NORMAL
- en: '*How it works: Azure Multi-Factor Authentication****:* **[https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-mfa-howitworks](https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-mfa-howitworks)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Planning a cloud-based Azure Multi-Factor Authentication deployment:* [https://docs.microsoft.com/en-us/azure/active-directory/authentication/howto-mfa-getstarted](https://docs.microsoft.com/en-us/azure/active-directory/authentication/howto-mfa-getstarted)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Configure Azure Multi-Factor Authentication settings*: [https://docs.microsoft.com/en-us/azure/active-directory/authentication/howto-mfa-mfasettings](https://docs.microsoft.com/en-us/azure/active-directory/authentication/howto-mfa-mfasettings)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*What is conditional access in Azure Active Directory?*: [https://docs.microsoft.com/en-us/azu](https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/overview)[re/active-directory/conditional-access/overview](https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/overview)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Quickstart: Require MFA for specific apps with Azure Active Directory conditional
    access*: [https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/app-based-mfa](https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/app-based-mfa)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
