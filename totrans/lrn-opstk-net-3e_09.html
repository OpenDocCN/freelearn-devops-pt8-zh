<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Role-Based Access Control</h1>
                </header>
            
            <article>
                
<p>The <strong>Role-Based Access Control</strong> (<strong>RBAC</strong>) policy framework enables both operators and users to grant access to resources for specific projects or tenants. Prior to RBAC, Neutron applied an all-or-nothing approach to the sharing of networks across projects. If a network was marked as <span class="CodeInTextPACKT">shared</span><span>, it was shared with <span class="ItalicsPACKT">all</span> projects. Access control policies built using the Neutron RBAC API allow operators and users to share certain network resources with one or more projects using a more granular approach.</span></p>
<p>As of the Pike release of OpenStack, access that can be granted using access control policies includes the following:</p>
<ul>
<li>Regular port creation permissions on networks</li>
<li>Attaching router gateways to networks</li>
<li>Binding <strong>Quality of Service</strong> (<strong>QoS</strong>) policy permissions to networks or ports</li>
</ul>
<p>In this chapter, we will focus on the concept and implementation of role-based access control in Neutron, including the following:</p>
<ul>
<li>A brief introduction to role-based access control for networking resources</li>
<li>Creating and managing access control policies</li>
<li>Demonstrating the use of access control policies</li>
</ul>
<p>QoS is an advanced networking topic that's not covered in this book.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Working with access control policies</h1>
                </header>
            
            <article>
                
<p>The workflow for managing RBAC policies follows the standard Create, Read, Update, and Delete (CRUD) model that is used throughout the Neutron API. The OpenStack command-line interface can be used to manage access control policies. As of the Pike release of OpenStack, Horizon support for RBAC has not been implemented. However, resources shared via a policy can be utilized within the dashboard.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Managing access control policies in the CLI</h1>
                </header>
            
            <article>
                
<p>From within the <span class="CodeInTextPACKT">openstack</span> command-line client, a number of commands can be used to manage access control policies. The primary commands associated with access control policy management that will be discussed in this chapter are listed in the following table:</p>
<table border="1" style="border-collapse: collapse;width: 100%">
<tbody>
<tr>
<td class="CDPAlignCenter CDPAlign" style="width: 41.8018%">
<p><strong>Role-Based Access Control Commands</strong></p>
</td>
<td class="CDPAlignCenter CDPAlign" style="width: 56.928%">
<p><strong>Description</strong></p>
</td>
</tr>
<tr>
<td style="width: 41.8018%">
<p><kbd><span>network rbac create</span></kbd></p>
</td>
<td style="width: 56.928%">
<p><span>Creates the network RBAC policy</span></p>
</td>
</tr>
<tr>
<td style="width: 41.8018%">
<p><kbd><span>network rbac delete</span></kbd></p>
</td>
<td style="width: 56.928%">
<p><span>Deletes the network RBAC policy</span></p>
</td>
</tr>
<tr>
<td style="width: 41.8018%">
<p><kbd><span>network rbac list</span></kbd></p>
</td>
<td style="width: 56.928%">
<p><span>Lists network RBAC policies</span></p>
</td>
</tr>
<tr>
<td style="width: 41.8018%">
<p><kbd><span>network rbac set</span></kbd></p>
</td>
<td style="width: 56.928%">
<p><span>Sets network RBAC policy properties</span></p>
</td>
</tr>
<tr>
<td style="width: 41.8018%">
<p><kbd><span>network rbac show</span></kbd></p>
</td>
<td style="width: 56.928%">
<p><span>Displays network RBAC policy details</span></p>
</td>
</tr>
</tbody>
</table>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating access control policies in the CLI</h1>
                </header>
            
            <article>
                
<p>To create an access control policy, use the <span class="CodeInTextPACKT"><kbd>openstack network rbac create</kbd></span> command as follows:</p>
<pre>openstack network rbac create<br/>--type &lt;type&gt; --action &lt;action&gt;<br/>--target-project &lt;target-project&gt;<br/>[--target-project-domain &lt;target-project-domain&gt;]<br/>[--project &lt;project&gt;]<br/>[--project-domain &lt;project-domain&gt;]<br/>&lt;rbac-object&gt; </pre>
<p>The <kbd><span class="CodeInTextPACKT">--type</span></kbd> argument allows you to specify the type of object the policy affects. Possible options include <kbd><span class="CodeInTextPACKT">network</span></kbd> or <kbd><span class="CodeInTextPACKT">qos_policy</span></kbd>. Only network policies are described in this chapter.</p>
<p>The <kbd><span class="CodeInTextPACKT">--action</span></kbd> argument allows you to specify the action for the access policy. Possible options include <kbd><span class="CodeInTextPACKT">access_as_external</span></kbd> or <kbd><span class="CodeInTextPACKT">access_as_shared</span></kbd>. The former allows a network to be used as an external network for routers for a subset of projects, while the latter allows a network to be used as a shared network for a subset of projects.</p>
<p>The <kbd><span class="CodeInTextPACKT">--target-project</span></kbd> argument specifies the project to which the access policy will be enforced.</p>
<p>The <kbd><span class="CodeInTextPACKT">--target-project-domain</span></kbd> argument is optional and allows you to specify the domain the target project belongs to.</p>
<p>The <kbd><span class="CodeInTextPACKT">--project</span></kbd> argument is optional and allows you to specify the owner of the access policy.</p>
<p>The <kbd><span class="CodeInTextPACKT">--project-domain</span></kbd> argument is optional and allows you to specify the domain the owner project belongs to.</p>
<p>The <kbd><span class="CodeInTextPACKT">rbac-object</span></kbd> argument specifies the name of the object that the policy applies to. This may be a network name or ID if the type is <span class="CodeInTextPACKT">network</span>, or a QOS policy ID if the type is <span class="CodeInTextPACKT">qos_policy</span>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Deleting access control policies in the CLI</h1>
                </header>
            
            <article>
                
<p>To delete an access control policy, use the <kbd><span class="CodeInTextPACKT">openstack network rbac delete</span></kbd> command and specify the ID of the RBAC object, as follows:</p>
<pre>openstack network rbac delete &lt;RBAC Policy&gt; [&lt;RBAC Policy&gt; ...] </pre>
<p>Multiple access policies can also be deleted simultaneously, as follows:</p>
<pre>openstack network rbac delete &lt;RBAC Policy ID1&gt; &lt;RBAC Policy ID2&gt; </pre>
<p>Neutron will successfully delete the access policy as long as another project is not utilizing a shared resource.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Listing access control policies in the CLI</h1>
                </header>
            
            <article>
                
<p>To obtain a listing of access control policies, use the <kbd><span class="CodeInTextPACKT">openstack network rbac list</span></kbd> command as follows:</p>
<pre>openstack network rbac list 
[--type &lt;type&gt;] [--action &lt;action&gt;]</pre>
<p class="mce-root"/>
<p>The results can be filtered by <span class="CodeInTextPACKT">type</span> and <span class="CodeInTextPACKT">action</span>. The output returned includes the action, ID, shared object ID, and shared object type.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Showing the details of an access control policy in the CLI</h1>
                </header>
            
            <article>
                
<p>To display the details of an access policy, use the <kbd><span class="CodeInTextPACKT">openstack network rbac show</span></kbd> command that's shown here:</p>
<pre>openstack network rbac show &lt;RBAC Policy&gt; </pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Updating access control policies in the CLI</h1>
                </header>
            
            <article>
                
<p>To update the attributes of an access policy, use the <span class="CodeInTextPACKT"><kbd>openstack network rbac set</kbd> </span>command, as follows:</p>
<pre>openstack network rbac set<br/>[--target-project &lt;target-project&gt;]<br/>[--target-project-domain &lt;target-project-domain&gt;]<br/>&lt;RBAC Policy&gt; </pre>
<p>This command allows you to change the target project and domain of an existing access control policy.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Applying RBAC policies to projects</h1>
                </header>
            
            <article>
                
<p>Before an RBAC policy can be created, you need to have a network or QoS policy that you wish to share among a subset of projects. In the following sections, we will create projects, roles, users, and networks, and I will demonstrate how an access control policy limits the visibility and use of shared resources between the projects versus the default behavior of the <span class="CodeInTextPACKT">shared</span> attribute.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating projects and users</h1>
                </header>
            
            <article>
                
<p>Using the <span class="CodeInTextPACKT">openstack</span> client, let's create three projects named <span class="CodeInTextPACKT">ProjectA</span>, <span class="CodeInTextPACKT">ProjectB</span>, and <span class="CodeInTextPACKT">ProjectC</span>, as shown here:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/49a501fd-4116-4367-9984-0132db638d88.png" style="width:55.83em;height:48.50em;"/></div>
<p>Using the <span class="CodeInTextPACKT">openstack</span> client, create a role named <kbd><span class="CodeInTextPACKT">rbacdemo</span></kbd>. Then, create a user in each project and apply the <kbd><span class="CodeInTextPACKT">rbacdemo</span></kbd> role to each user:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/eb924879-4a76-4a30-994e-7124bc616e16.png" style="width:35.17em;height:42.08em;"/></div>
<div class="packt_figure"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a network to share</h1>
                </header>
            
            <article>
                
<p>Using the <span class="CodeInTextPACKT">openstack</span> client, create a network named <kbd><span class="CodeInTextPACKT">MySemiSharedNetwork</span></kbd> and a subnet named <kbd><span class="CodeInTextPACKT">MySemiSharedSubnet</span></kbd> as the <span class="CodeInTextPACKT">admin</span> user. This network will be shared among some of the newly created projects:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/0d732d3d-a08d-491a-9a69-bb8458d2a92e.png" style="width:48.67em;height:48.75em;"/></div>
<p>In the network details, observe that the <span class="CodeInTextPACKT">shared</span> attribute of the network is set to <kbd><span class="CodeInTextPACKT">False</span></kbd>. In this state, the network can only be used by users associated with the owning project. In this case, this is the <span class="CodeInTextPACKT">admin</span> project. Setting it to <kbd><span class="CodeInTextPACKT">True</span></kbd> <span>would make the network usable by <span class="ItalicsPACKT">all</span> projects, which is something we'd like to avoid.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a policy</h1>
                </header>
            
            <article>
                
<p>Creating an RBAC policy requires the following four details:</p>
<ul>
<li>Policy type</li>
<li>Target project</li>
<li>Action to perform</li>
<li>Resource</li>
</ul>
<p>By default, the <kbd><span class="CodeInTextPACKT">MySemiSharedNetwork</span></kbd> network created in the last section is limited to the <span class="CodeInTextPACKT">admin</span> project that created it. Using the <span class="CodeInTextPACKT">openstack</span> client, create a new RBAC policy that shares the network with the <kbd><span class="CodeInTextPACKT">ProjectA</span></kbd> project by using the <kbd><span class="CodeInTextPACKT">access_as_shared</span></kbd> action, as shown here:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/68d58048-9bf8-4179-8459-45221fae4912.png" style="width:36.58em;height:21.58em;"/></div>
<p>The access control policy can be viewed with the <kbd><span class="CodeInTextPACKT">openstack network rbac list</span></kbd> and/or <kbd><span class="CodeInTextPACKT">show</span></kbd> commands that can be seen here:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/1978fd28-b54a-49aa-903a-c5afbec5ff3d.png" style="width:60.58em;height:26.25em;"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Viewing the policy in action</h1>
                </header>
            
            <article>
                
<p>As <span class="CodeInTextPACKT">UserA</span> in the <span class="CodeInTextPACKT">ProjectA</span> project, the <kbd><span class="CodeInTextPACKT">openstack network list</span></kbd> command can be used to confirm that the network is available for use, like so:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/14584662-3ca6-4e5a-9f9e-92898f304595.png" style="width:69.42em;height:8.83em;"/></div>
<p>Users in the <kbd><span class="CodeInTextPACKT">ProjectB</span></kbd> and <kbd><span class="CodeInTextPACKT">ProjectC</span></kbd> projects, however, cannot see the network:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/cba89e36-8444-4492-bf7d-ca329111afcc.png" style="width:72.42em;height:5.33em;"/></div>
<p>Running the query as a user in the <kbd><span class="CodeInTextPACKT">ProjectB</span></kbd> and <kbd><span class="CodeInTextPACKT">ProjectC</span></kbd> projects returns no results, and the network will not be usable by those projects. For every project that a network object must be shared with, a separate policy must be created. The <kbd><span class="CodeInTextPACKT">openstack network rbac create</span></kbd> command can be used to create additional policies by specifying different projects but sharing the same network resource.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating policies for external networks</h1>
                </header>
            
            <article>
                
<p>External networks are used to attach Neutron routers to the physical network and help provide routing in and out of a project via routes and floating IPs. When a network's <span class="CodeInTextPACKT">external</span> attribute is set to <kbd><span class="CodeInTextPACKT">True</span></kbd>, the network is shared among <span class="ItalicsPACKT">all</span> projects. Access policies can be used to limit external networks to a subset of projects. The syntax for creating a policy for external networks is very similar to the policy demonstrated in the last section. The action, however, will change from <kbd><span class="CodeInTextPACKT">access_as_shared</span></kbd> to <kbd><span class="CodeInTextPACKT">access_as_external</span></kbd>.</p>
<p>In this example, an external network named <kbd><span class="CodeInTextPACKT">MySemiSharedExternalNetwork</span></kbd> using VLAN 31 has been created with the goal of sharing it with a subset of projects. Notice that the <span class="CodeInTextPACKT">shared</span> attribute is <kbd><span class="CodeInTextPACKT">False</span></kbd> and that the <span class="CodeInTextPACKT">external</span> attribute is <span class="CodeInTextPACKT">internal</span>, meaning that it can only be used for internal networks:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/97059d3c-4255-4141-84c8-7c46ff8eead3.png" style="width:30.83em;height:35.58em;"/></div>
<p>As a result, the network will <span class="ItalicsPACKT">not</span> be listed when running <kbd><span class="CodeInTextPACKT">openstack network list --external</span></kbd>, and is ineligible for use as an external network:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/3389bb57-e50e-4a44-a1ef-91bf3918a0e1.png" style="width:43.83em;height:7.42em;"/></div>
<p>In this example, the <span class="CodeInTextPACKT">admin</span> user has created an access policy that shares the network as an external network with the <span class="CodeInTextPACKT">ProjectB</span> project:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/38a998e9-74f1-45a9-9f6d-1bb8b78b134b.png" style="width:33.42em;height:19.92em;"/></div>
<p>As <kbd><span class="CodeInTextPACKT">UserB</span></kbd> in the <kbd><span class="CodeInTextPACKT">ProjectB</span></kbd> project, we can see the external network using the <kbd><span class="CodeInTextPACKT">openstack network list --external</span></kbd> command. The network will reflect its external status:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/8cd2535a-9a62-44ea-a04d-3f28ec2375eb.png" style="width:65.17em;height:39.08em;"/></div>
<p>Without a <kbd><span class="CodeInTextPACKT">shared_as_external</span></kbd> access policy in place, no other project will be able to see or use the network as an external network.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>Access control policies created and managed by the role-based access control framework allow operators and users to provide access to certain network resources to individual projects rather than all projects. This ability opens up network design options that were not available in the past and provides a more secure approach to network resource sharing.</p>
<p>In the next chapter, we will explore standalone Neutron routers and their involvement in providing self-service networking to projects. In addition, we'll take a look at the configuration and use of floating IPs to provide external connectivity to instances. The configuration of highly available and distributed virtual routers will be covered in later chapters.</p>


            </article>

            
        </section>
    </body></html>