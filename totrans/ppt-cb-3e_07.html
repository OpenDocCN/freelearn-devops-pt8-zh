<html><head></head><body><div class="chapter" title="Chapter&#xA0;7.&#xA0;Managing Applications"><div class="titlepage"><div><div><h1 class="title"><a id="ch07"/>Chapter 7. Managing Applications</h1></div></div></div><div class="blockquote"><table border="0" width="100%" cellspacing="0" cellpadding="0" class="blockquote" summary="Block quote"><tr><td valign="top"> </td><td valign="top"><p><span class="emphasis"><em>Everyone knows that debugging is twice as hard as writing a program in the first place. So if you're as clever as you can be when you write it, how will you ever debug it?</em></span></p></td><td valign="top"> </td></tr><tr><td valign="top"> </td><td colspan="2" align="right" valign="top" style="text-align: center">--<span class="attribution"><span class="emphasis"><em>Brian W. Kernighan.</em></span></span></td></tr></table></div><p>In this chapter, we will cover the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Using public modules</li><li class="listitem" style="list-style-type: disc">Managing Apache servers</li><li class="listitem" style="list-style-type: disc">Creating Apache virtual hosts</li><li class="listitem" style="list-style-type: disc">Creating nginx virtual hosts</li><li class="listitem" style="list-style-type: disc">Managing MySQL</li><li class="listitem" style="list-style-type: disc">Creating databases and users</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec85"/>Introduction</h1></div></div></div><p>Without applications, a server is just a very expensive space heater. In this chapter, I'll present some recipes to manage some specific software with Puppet: MySQL, Apache, <a id="id448" class="indexterm"/>
<span class="strong"><strong>nginx</strong></span>, and Ruby. I hope the recipes will be useful to you in themselves. However, the patterns and techniques they use are applicable to almost any software, so you can adapt them to your own purposes without much difficulty. One thing that is common about these applications, they are common. Most Puppet installations will have to deal with a web server, Apache or nginx. Most, if not all, will have databases and some of those will have MySQL. When everyone has to deal with a problem, community solutions are generally better tested and more thorough than homegrown solutions. We'll use modules from the Puppet Forge in this chapter to manage these applications.</p><p>When you are writing your own Apache or nginx modules from scratch, you'll have to pay attention to the nuances of the distributions you support. Some distributions call the apache package <code class="literal">httpd</code>, while others use <code class="literal">apache2</code>; the same can be said for MySQL. In addition, Debian-based distributions use an enabled folder method to enable custom sites in Apache, which are virtual sites, whereas RPM based distributions do not. For more information on<a id="id449" class="indexterm"/> virtual sites, visit <a class="ulink" href="http://httpd.apache.org/docs/2.2/vhosts/">http://httpd.apache.org/docs/2.2/vhosts/</a>.</p></div></div>
<div class="section" title="Using public modules"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec86"/>Using public modules</h1></div></div></div><p>When you write a Puppet <a id="id450" class="indexterm"/>module to manage some software or service, you don't have to start from scratch. Community-contributed modules are available at the Puppet Forge site for many popular applications. Sometimes, a community module will be exactly what you need and you can download and start using it straight away. In most cases, you will need to make some modifications to suit your particular needs and environment.</p><p>Like all community efforts, there are some excellent and some less than excellent modules on the Forge. You should read the README section of the module and decide whether the module is going to work in your installation. At the least, ensure that your distribution is supported. Puppetlabs has introduced a set of modules that are supported, that is, if you are an enterprise customer, they will support your use of the module in your installation. Additionally, most Forge modules deal with multiple operating systems, distributions, and a great number of use cases. In many cases, not using a forge module is like reinventing the wheel. One caveat though is that Forge modules may be more complex than your local modules. You should read the code and get a sense of what the module is doing. Knowing how the module works will help you debug it later.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec241"/>How to do it...</h2></div></div></div><p>In this example, we'll use the <code class="literal">puppet module</code> command<a id="id451" class="indexterm"/> to find and install the <a id="id452" class="indexterm"/>useful <code class="literal">stdlib</code> module, which contains many utility functions to help you develop Puppet code. It is one of the aforementioned supported modules by puppetlabs. I'll download the module into my user's home directory and manually install it in the Git repository. To install puppetlabs stdlib module, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>t@mylaptop ~ $ puppet module search puppetlabs-stdlib</strong></span>
<span class="strong"><strong>Notice: Searching https://forgeapi.puppetlabs.com ...</strong></span>
<span class="strong"><strong>NAME               DESCRIPTION                         AUTHOR        KEYWORDS        </strong></span>
<span class="strong"><strong>puppetlabs-stdlib  Puppet Module Standard Library      @puppetlabs   stdlib stages  </strong></span>
</pre></div></li><li class="listitem">We verified that we have the right module, so we'll install it with <code class="literal">module install</code> now:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>t@mylaptop ~ $ puppet module install puppetlabs-stdlib</strong></span>
<span class="strong"><strong>Notice: Preparing to install into /home/thomas/.puppet/modules ...</strong></span>
<span class="strong"><strong>Notice: Downloading from https://forgeapi.puppetlabs.com ...</strong></span>
<span class="strong"><strong>Notice: Installing -- do not interrupt ...</strong></span>
<span class="strong"><strong>/home/thomas/.puppet/modules</strong></span>
<span class="strong"><strong>└── puppetlabs-stdlib (v4.3.2)</strong></span>
</pre></div></li><li class="listitem">The module is now ready to use in your manifests; most good modules come with a <code class="literal">README</code> file to show you how to do this.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec242"/>How it works...</h2></div></div></div><p>You can search for<a id="id453" class="indexterm"/> modules that match the package or software you're interested in with the <code class="literal">puppet module search</code> command. To install a specific module, use <code class="literal">puppet module install</code>. You can add the <code class="literal">-i</code> option to tell Puppet where to find your module directory.</p><p>You can browse the<a id="id454" class="indexterm"/> forge to see what's available at <a class="ulink" href="http://forge.puppetlabs.com/">http://forge.puppetlabs.com/</a>.</p><p>More information on supported modules<a id="id455" class="indexterm"/> is available at <a class="ulink" href="https://forge.puppetlabs.com/supported">https://forge.puppetlabs.com/supported</a>.</p><p>The current list of supported modules is available at <a class="ulink" href="https://forge.puppetlabs.com/modules?endorsements=supported">https://forge.puppetlabs.com/modules?endorsements=supported</a>.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec243"/>There's more...</h2></div></div></div><p>Modules on the Forge include a <code class="literal">metadata.json</code> file, which<a id="id456" class="indexterm"/> describes the module and which operating systems the module supports. This file also includes a list of modules that are required by the module.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note14"/>Note</h3><p>This file was previously named Modulefile and not in JSON format; the old Modulefile format was deprecated in Version 3.6.</p></div></div><p>As we will see in our next section, when installing a module from the Forge, the required dependencies will automatically be installed as well.</p><p>Not all publically available modules are on Puppet Forge. Some other great places to look at on GitHub<a id="id457" class="indexterm"/> are:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="https://github.com/camptocamp">https://github.com/camptocamp</a></li><li class="listitem" style="list-style-type: disc"><a class="ulink" href="https://github.com/example42">https://github.com/example42</a></li></ul></div><p>Though not a collection of modules as such, the Puppet Cookbook<a id="id458" class="indexterm"/> website has many useful and illuminating code examples, patterns, and tips, maintained by the admirable Dean Wilson:</p><p>
<a class="ulink" href="http://www.puppetcookbook.com/">http://www.puppetcookbook.com/</a>
</p></div></div>
<div class="section" title="Managing Apache servers"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec87"/>Managing Apache servers</h1></div></div></div><p>Apache is the world's favorite <a id="id459" class="indexterm"/>web server, so it's highly likely that part of your Puppetly duties will include installing and managing Apache.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec244"/>How to do it...</h2></div></div></div><p>We'll install and use the <code class="literal">puppetlabs-apache</code> module to install and start Apache. This time, when we run <code class="literal">puppet module install</code>, we'll use the <code class="literal">-i</code> option to tell Puppet to install the module in our Git repository's module's directory.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Install the module using <code class="literal">puppet modules install</code>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>t@mylaptop ~/puppet $ puppet module install -i modules puppetlabs-apache</strong></span>
<span class="strong"><strong>Notice: Preparing to install into /home/thomas/puppet/modules ...</strong></span>
<span class="strong"><strong>Notice: Downloading from https://forgeapi.puppetlabs.com ...</strong></span>
<span class="strong"><strong>Notice: Installing -- do not interrupt ...</strong></span>
<span class="strong"><strong>/home/thomas/puppet/modules</strong></span>
<span class="strong"><strong>└─┬ puppetlabs-apache (v1.1.1)</strong></span>
<span class="strong"><strong>  ├── puppetlabs-concat (v1.1.1)</strong></span>
<span class="strong"><strong>  └── puppetlabs-stdlib (v4.3.2)</strong></span>
</pre></div></li><li class="listitem">Add the modules to your Git repository and push them out:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>t@mylaptop ~/puppet $ git add modules/apache modules/concat modules/stdlib</strong></span>
<span class="strong"><strong>t@mylaptop ~/puppet $ git commit -m "adding puppetlabs-apache module"</strong></span>
<span class="strong"><strong>[production 395b079] adding puppetlabs-apache module</strong></span>
<span class="strong"><strong> 647 files changed, 35017 insertions(+), 13 deletions(-)</strong></span>
<span class="strong"><strong> rename modules/{apache =&gt; apache.cookbook}/manifests/init.pp (100%)</strong></span>
<span class="strong"><strong> create mode 100644 modules/apache/CHANGELOG.md</strong></span>
<span class="strong"><strong> create mode 100644 modules/apache/CONTRIBUTING.md</strong></span>
<span class="strong"><strong>...</strong></span>
<span class="strong"><strong>t@mylaptop ~/puppet $ git push origin production</strong></span>
<span class="strong"><strong>Counting objects: 277, done.</strong></span>
<span class="strong"><strong>Delta compression using up to 4 threads.</strong></span>
<span class="strong"><strong>Compressing objects: 100% (248/248), done.</strong></span>
<span class="strong"><strong>Writing objects: 100% (266/266), 136.25 KiB | 0 bytes/s, done.</strong></span>
<span class="strong"><strong>Total 266 (delta 48), reused 0 (delta 0)</strong></span>
<span class="strong"><strong>remote: To puppet@puppet.example.com:/etc/puppet/environments/puppet.git</strong></span>
<span class="strong"><strong>remote:    9faaa16..395b079  production -&gt; production</strong></span>
</pre></div></li><li class="listitem">Create a web server node definition in <code class="literal">site.pp</code>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>node webserver {</strong></span>
<span class="strong"><strong>  class {'apache': }</strong></span>
<span class="strong"><strong>}</strong></span>
</pre></div></li><li class="listitem">Run Puppet to apply <a id="id460" class="indexterm"/>the default Apache module configuration:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[root@webserver ~]# puppet agent -t</strong></span>
<span class="strong"><strong>Info: Caching certificate for webserver.example.com</strong></span>
<span class="strong"><strong>Notice: /File[/var/lib/puppet/lib/puppet/provider/a2mod]/ensure: created</strong></span>
<span class="strong"><strong>...</strong></span>
<span class="strong"><strong>Info: Caching catalog for webserver.example.com</strong></span>
<span class="strong"><strong>...</strong></span>
<span class="strong"><strong>Info: Class[Apache::Service]: Scheduling refresh of Service[httpd]</strong></span>
<span class="strong"><strong>Notice: /Stage[main]/Apache::Service/Service[httpd]: Triggered 'refresh' from 51 events</strong></span>
<span class="strong"><strong>Notice: Finished catalog run in 11.73 seconds</strong></span>
</pre></div></li><li class="listitem">Verify that you can reach <code class="literal">webserver.example.com</code>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[root@webserver ~]# curl http://webserver.example.com</strong></span>
<span class="strong"><strong>&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN"&gt;</strong></span>
<span class="strong"><strong>&lt;html&gt;</strong></span>
<span class="strong"><strong> &lt;head&gt;</strong></span>
<span class="strong"><strong>  &lt;title&gt;Index of /&lt;/title&gt;</strong></span>
<span class="strong"><strong> &lt;/head&gt;</strong></span>
<span class="strong"><strong> &lt;body&gt;</strong></span>
<span class="strong"><strong>&lt;h1&gt;Index of /&lt;/h1&gt;</strong></span>
<span class="strong"><strong>&lt;table&gt;&lt;tr&gt;&lt;th&gt;&lt;img src="/icons/blank.gif" alt="[ICO]"&gt;&lt;/th&gt;&lt;th&gt;&lt;a href="?C=N;O=D"&gt;Name&lt;/a&gt;&lt;/th&gt;&lt;th&gt;&lt;a href="?C=M;O=A"&gt;Last modified&lt;/a&gt;&lt;/th&gt;&lt;th&gt;&lt;a href="?C=S;O=A"&gt;Size&lt;/a&gt;&lt;/th&gt;&lt;th&gt;&lt;a href="?C=D;O=A"&gt;Description&lt;/a&gt;&lt;/th&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th colspan="5"&gt;&lt;hr&gt;&lt;/th&gt;&lt;/tr&gt;</strong></span>
<span class="strong"><strong>&lt;tr&gt;&lt;th colspan="5"&gt;&lt;hr&gt;&lt;/th&gt;&lt;/tr&gt;</strong></span>
<span class="strong"><strong>&lt;/table&gt;</strong></span>
<span class="strong"><strong>&lt;/body&gt;&lt;/html&gt;</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec245"/>How it works...</h2></div></div></div><p>Installing the <a id="id461" class="indexterm"/>puppetlabs-Apache module from the Forge causes both puppetlabs-concat and puppetlabs-stdlib to be installed into our modules directory. The concat module is used to stitch snippets of files together in a specific order. It is used by the Apache module to create the main Apache configuration files.</p><p>We then defined a web server node and applied the Apache class to that node. We used all the default values and let the Apache module configure our server to be an Apache web server.</p><p>The Apache module then went and rewrote all our Apache configurations. By default, the module purges all the configuration files from the Apache directory (<code class="literal">/etc/apache2</code> or <code class="literal">/etc/httpd</code> depending on the distribution). The module can configure many different distributions and handle the nuances of each distribution. As a user of the module, you don't need to know how your distribution deals with the Apache module configuration.</p><p>After purging and rewriting the configuration files, the module ensures that the apache2 service is running (<code class="literal">httpd</code> on Enterprise Linux (EL)).</p><p>We then tested the webserver using curl. There was nothing returned but an empty index page. This is the expected behavior. Normally, when we install Apache on a server, there are some files that display a default page (<code class="literal">welcome.conf</code> on EL-based systems), since the module purged those configurations, we only see an empty page.</p><p>In a production environment, you would modify the defaults applied by the Apache module; the suggested configuration from the README is as follows:</p><div class="informalexample"><pre class="programlisting">class { 'apache':
  default_mods        =&gt; false,
  default_confd_files =&gt; false,
}</pre></div></div></div>
<div class="section" title="Creating Apache virtual hosts"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec88"/>Creating Apache virtual hosts</h1></div></div></div><p>Apache virtual hosts are created <a id="id462" class="indexterm"/>with the <code class="literal">apache</code> module with the defined type <code class="literal">apache::vhost</code>. We will create a new vhost on our Apache webserver called <a id="id463" class="indexterm"/>
<span class="strong"><strong>navajo</strong></span>, one of the apache tribes.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec246"/>How to do it...</h2></div></div></div><p>Follow these steps to create Apache virtual hosts:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a navajo <code class="literal">apache::vhost</code> definition as follows:<div class="informalexample"><pre class="programlisting">apache::vhost { 'navajo.example.com':
    port          =&gt; '80',
    docroot =&gt; '/var/www/navajo',
  }</pre></div></li><li class="listitem">Create an index file for the new vhost:<div class="informalexample"><pre class="programlisting">file {'/var/www/navajo/index.html':
    content =&gt; "&lt;html&gt;\nnavajo.example.com\nhttp://en.wikipedia.org/wiki/Navajo_people\n&lt;/html&gt;\n",
    mode    =&gt; '0644',
    require =&gt; Apache::Vhost['navajo.example.com']
  }</pre></div></li><li class="listitem">Run Puppet to create the new vhost:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[root@webserver ~]# puppet agent -t</strong></span>
<span class="strong"><strong>Info: Caching catalog for webserver.example.com</strong></span>
<span class="strong"><strong>Info: Applying configuration version '1414475598'</strong></span>
<span class="strong"><strong>Notice: /Stage[main]/Main/Node[webserver]/Apache::Vhost[navajo.example.com]/File[/var/www/navajo]/ensure: created</strong></span>
<span class="strong"><strong>Notice: /Stage[main]/Main/Node[webserver]/Apache::Vhost[navajo.example.com]/File[25-navajo.example.com.conf]/ensure: created</strong></span>
<span class="strong"><strong>Info: /Stage[main]/Main/Node[webserver]/Apache::Vhost[navajo.example.com]/File[25-navajo.example.com.conf]: Scheduling refresh of Service[httpd]</strong></span>
<span class="strong"><strong>Notice: /Stage[main]/Main/Node[webserver]/File[/var/www/navajo/index.html]/ensure: defined content as '{md5}5212fe215f4c0223fb86102a34319cc6'</strong></span>
<span class="strong"><strong>Notice: /Stage[main]/Apache::Service/Service[httpd]: Triggered 'refresh' from 1 events</strong></span>
<span class="strong"><strong>Notice: Finished catalog run in 2.73 seconds</strong></span>
</pre></div></li><li class="listitem">Verify that you can reach the new virtual host:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[root@webserver ~]# curl http://navajo.example.com</strong></span>
<span class="strong"><strong>&lt;html&gt;</strong></span>
<span class="strong"><strong>navajo.example.com</strong></span>
<span class="strong"><strong>http://en.wikipedia.org/wiki/Navajo_people</strong></span>
<span class="strong"><strong>&lt;/html&gt;</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec247"/>How it works...</h2></div></div></div><p>The <code class="literal">apache::vhost</code> defined type<a id="id464" class="indexterm"/> creates a virtual host configuration file for <a id="id465" class="indexterm"/>Apache, <code class="literal">25-navajo.example.com.conf</code>. The file is created with a template; <code class="literal">25</code> at the beginning of the filename is the "priority level" of this virtual host. When Apache first starts, it reads through its configuration directory and starts executing files in an alphabetical order. Files that begin with numbers are read before files that start with letters. In this way, the Apache module ensures that the virtual hosts are read in a specific order, which can be specified when you define the virtual host. The contents of this file are as follows:</p><div class="informalexample"><pre class="programlisting"># ************************************
# Vhost template in module puppetlabs-apache
# Managed by Puppet
# ************************************

&lt;VirtualHost *:80&gt;
  ServerName navajo.example.com

  ## Vhost docroot
  DocumentRoot "/var/www/navajo"



  ## Directories, there should at least be a declaration for /var/www/navajo


  &lt;Directory "/var/www/navajo"&gt;
    Options Indexes FollowSymLinks MultiViews
    AllowOverride None
    Order allow,deny
    Allow from all
  &lt;/Directory&gt;

  ## Load additional static includes


  ## Logging
  ErrorLog "/var/log/httpd/navajo.example.com_error.log"
  ServerSignature Off
  CustomLog "/var/log/httpd/navajo.example.com_access.log" combined


&lt;/VirtualHost&gt;</pre></div><p>As you can see, the default file <a id="id466" class="indexterm"/>has created log files, set up directory access permissions and options, in addition to specifying the listen port and <code class="literal">DocumentRoot</code>.</p><p>The vhost definition creates the <code class="literal">DocumentRoot</code> directory, specified as 'root' to the <code class="literal">apache::virtual</code> definition. The directory is created before the virtual host configuration file; after that file has been created, a notify trigger is sent to the Apache process to restart.</p><p>Our manifest included a file that required the <code class="literal">Apache::Vhost['navajo.example.com']</code> resource; our file was then created after the directory and the virtual host configuration file.</p><p>When we run curl on the new website (if you haven't created a hostname alias in DNS, you will have to create one in your local <code class="literal">/etc/hosts</code> file for <code class="literal">navajo.example.com</code>, or specify the host as <code class="literal">curl -H 'Host: navajo.example.com' &lt;ipaddress</code> of <code class="literal">navajo.example.com&gt;</code>), we see the contents of the index file we created:</p><div class="informalexample"><pre class="programlisting">file {'/var/www/navajo/index.html':
    content =&gt; "&lt;html&gt;\nnavajo.example.com\nhttp://en.wikipedia.org/wiki/Navajo_people\n&lt;/html&gt;\n",
    mode    =&gt; '0644',
    require =&gt; Apache::Vhost['navajo.example.com']
  }	
[root@webserver ~]# curl http://navajo.example.com
&lt;html&gt;
navajo.example.com
http://en.wikipedia.org/wiki/Navajo_people
&lt;\html&gt;</pre></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec248"/>There's more...</h2></div></div></div><p>Both the defined type and the template take into account a multitude of possible configuration scenarios for virtual hosts. It is highly unlikely that you will find a setting that is not covered by this module. You should look at the definition for <code class="literal">apache::virtual</code> and the sheer number of possible arguments.</p><p>The module<a id="id467" class="indexterm"/> also takes care of several settings for you. For instance, if we change the listen port on our <code class="literal">navajo</code> virtual host from <code class="literal">80</code> to <code class="literal">8080</code>, the module will make the following changes in <code class="literal">/etc/httpd/conf.d/ports.conf</code>:</p><div class="informalexample"><pre class="programlisting">Listen 80
+Listen 8080
 NameVirtualHost *:80
+NameVirtualHost *:8080</pre></div><p>And in our virtual host file:</p><div class="informalexample"><pre class="programlisting">-&lt;VirtualHost *:80&gt;
+&lt;VirtualHost *:8080&gt;</pre></div><p>So that we can now curl on port <code class="literal">8080</code> and see the same results:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[root@webserver ~]# curl http://navajo.example.com:8080</strong></span>
<span class="strong"><strong>&lt;html&gt;</strong></span>
<span class="strong"><strong>navajo.example.com</strong></span>
<span class="strong"><strong>http://en.wikipedia.org/wiki/Navajo_people</strong></span>
<span class="strong"><strong>&lt;/html&gt;</strong></span>
</pre></div><p>And when we try on port <code class="literal">80</code>:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[root@webserver ~]# curl http://navajo.example.com	</strong></span>
<span class="strong"><strong>&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN"&gt;</strong></span>
<span class="strong"><strong>&lt;html&gt;</strong></span>
<span class="strong"><strong> &lt;head&gt;</strong></span>
<span class="strong"><strong>  &lt;title&gt;Index of /&lt;/title&gt;</strong></span>
<span class="strong"><strong> &lt;/head&gt;</strong></span>
<span class="strong"><strong> &lt;body&gt;</strong></span>
<span class="strong"><strong>&lt;h1&gt;Index of /&lt;/h1&gt;</strong></span>
<span class="strong"><strong>&lt;table&gt;&lt;tr&gt;&lt;th&gt;&lt;img src="/icons/blank.gif" alt="[ICO]"&gt;&lt;/th&gt;&lt;th&gt;&lt;a href="?C=N;O=D"&gt;Name&lt;/a&gt;&lt;/th&gt;&lt;th&gt;&lt;a href="?C=M;O=A"&gt;Last modified&lt;/a&gt;&lt;/th&gt;&lt;th&gt;&lt;a href="?C=S;O=A"&gt;Size&lt;/a&gt;&lt;/th&gt;&lt;th&gt;&lt;a href="?C=D;O=A"&gt;Description&lt;/a&gt;&lt;/th&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th colspan="5"&gt;&lt;hr&gt;&lt;/th&gt;&lt;/tr&gt;</strong></span>
<span class="strong"><strong>&lt;tr&gt;&lt;th colspan="5"&gt;&lt;hr&gt;&lt;/th&gt;&lt;/tr&gt;</strong></span>
<span class="strong"><strong>&lt;/table&gt;</strong></span>
<span class="strong"><strong>&lt;/body&gt;</strong></span>
<span class="strong"><strong>&lt;/html&gt;</strong></span>
</pre></div><p>As we can see, the virtual host is no longer listening on port <code class="literal">80</code> and we receive the default empty directory listing we saw in our earlier example.</p></div></div>
<div class="section" title="Creating nginx virtual hosts"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec89"/>Creating nginx virtual hosts</h1></div></div></div><p>Nginx is a fast, lightweight web server that is preferred over Apache in many contexts, especially where high performance is important. Nginx is configured slightly differently than Apache; like Apache though, there is a Forge module that can be used to configure nginx for us. Unlike Apache, however, the module that is suggested for use is not supplied by puppetlabs <a id="id468" class="indexterm"/>but by James Fryman. This module uses some interesting tricks to configure itself. Previous versions of this module used R.I. Pienaar's <code class="literal">module_data</code> package. This <a id="id469" class="indexterm"/>package is used to configure hieradata within a module. It's used to supply default values to the nginx module. I wouldn't recommend starting out with this module at this point, but it is a good example of where module configuration may be headed in the future. Giving modules the ability to modify hieradata may prove useful.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec249"/>How to do it...</h2></div></div></div><p>In this example, we'll use a Forge module to configure nginx. We'll download the module and use it to configure virtualhosts.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Download the <code class="literal">jfryman-nginx</code> module from the Forge:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>t@mylaptop ~ $ cd ~/puppet</strong></span>
<span class="strong"><strong>t@mylaptop ~/puppet $ puppet module install -i modules jfryman-nginx</strong></span>
<span class="strong"><strong>Notice: Preparing to install into /home/thomas/puppet/modules ...</strong></span>
<span class="strong"><strong>Notice: Downloading from https://forgeapi.puppetlabs.com ...</strong></span>
<span class="strong"><strong>Notice: Installing -- do not interrupt ...</strong></span>
<span class="strong"><strong>/home/thomas/puppet/modules</strong></span>
<span class="strong"><strong>└─┬ jfryman-nginx (v0.2.1)</strong></span>
<span class="strong"><strong>  ├── puppetlabs-apt (v1.7.0)</strong></span>
<span class="strong"><strong>  ├── puppetlabs-concat (v1.1.1)</strong></span>
<span class="strong"><strong>  └── puppetlabs-stdlib (v4.3.2)</strong></span>
</pre></div></li><li class="listitem">Replace the definition for webserver with an nginx configuration:<div class="informalexample"><pre class="programlisting">node webserver {
  class {'nginx':}
  nginx::resource::vhost { 'mescalero.example.com':
      www_root =&gt; '/var/www/mescalero',
  }
  file {'/var/www/mescalero':
    ensure  =&gt; 'directory''directory',
    mode    =&gt; '0755',
    require =&gt; Nginx::Resource::Vhost['mescalero.example.com'],
  }
  file {'/var/www/mescalero/index.html':
    content =&gt; "&lt;html&gt;\nmescalero.example.com\nhttp://en.wikipedia.org/wiki/Mescalero\n&lt;/html&gt;\n",
    mode    =&gt; 0644,
    require =&gt; File['/var/www/mescalero'],
  }
}</pre></div></li><li class="listitem">If apache is still <a id="id470" class="indexterm"/>running on your webserver, stop it:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[root@webserver ~]# puppet resource service httpd ensure=false</strong></span>
<span class="strong"><strong>Notice: /Service[httpd]/ensure: ensure changed 'running' to 'stopped'</strong></span>
<span class="strong"><strong>service { 'httpd':</strong></span>
<span class="strong"><strong>  ensure =&gt; 'stopped',</strong></span>
<span class="strong"><strong>}</strong></span>
<span class="strong"><strong>Run puppet agent on your webserver node:</strong></span>
<span class="strong"><strong>[root@webserver ~]# puppet agent -t</strong></span>
<span class="strong"><strong>Info: Caching catalog for webserver.example.com</strong></span>
<span class="strong"><strong>Info: Applying configuration version '1414561483'</strong></span>
<span class="strong"><strong>Notice: /Stage[main]/Main/Node[webserver]/Nginx::Resource::Vhost[mescalero.example.com]/Concat[/etc/nginx/sites-available/mescalero.example.com.conf]/File[/etc/nginx/sites-available/mescalero.example.com.conf]/ensure: defined content as '{md5}35bb59bfcd0cf5a549d152aaec284357'</strong></span>
<span class="strong"><strong>Info: /Stage[main]/Main/Node[webserver]/Nginx::Resource::Vhost[mescalero.example.com]/Concat[/etc/nginx/sites-available/mescalero.example.com.conf]/File[/etc/nginx/sites-available/mescalero.example.com.conf]: Scheduling refresh of Class[Nginx::Service]</strong></span>
<span class="strong"><strong>Info: Concat[/etc/nginx/sites-available/mescalero.example.com.conf]: Scheduling refresh of Class[Nginx::Service]</strong></span>
<span class="strong"><strong>Notice: /Stage[main]/Main/Node[webserver]/Nginx::Resource::Vhost[mescalero.example.com]/File[mescalero.example.com.conf symlink]/ensure: created</strong></span>
<span class="strong"><strong>Info: /Stage[main]/Main/Node[webserver]/Nginx::Resource::Vhost[mescalero.example.com]/File[mescalero.example.com.conf symlink]: Scheduling refresh of Service[nginx]</strong></span>
<span class="strong"><strong>Notice: /Stage[main]/Main/Node[webserver]/File[/var/www/mescalero]/ensure: created</strong></span>
<span class="strong"><strong>Notice: /Stage[main]/Main/Node[webserver]/File[/var/www/mescalero/index.html]/ensure: defined content as '{md5}2bd618c7dc3a3addc9e27c2f3cfde294'</strong></span>
<span class="strong"><strong>Notice: /Stage[main]/Nginx::Config/File[/etc/nginx/conf.d/proxy.conf]/ensure: defined content as '{md5}1919fd65635d49653273e14028888617'</strong></span>
<span class="strong"><strong>Info: Computing checksum on file /etc/nginx/conf.d/example_ssl.conf</strong></span>
<span class="strong"><strong>Info: /Stage[main]/Nginx::Config/File[/etc/nginx/conf.d/example_ssl.conf]: Filebucketed /etc/nginx/conf.d/example_ssl.conf to puppet with sum 84724f296c7056157d531d6b1215b507</strong></span>
<span class="strong"><strong>Notice: /Stage[main]/Nginx::Config/File[/etc/nginx/conf.d/example_ssl.conf]/ensure: removed</strong></span>
<span class="strong"><strong>Info: Computing checksum on file /etc/nginx/conf.d/default.conf</strong></span>
<span class="strong"><strong>Info: /Stage[main]/Nginx::Config/File[/etc/nginx/conf.d/default.conf]: Filebucketed /etc/nginx/conf.d/default.conf to puppet with sum 4dce452bf8dbb01f278ec0ea9ba6cf40</strong></span>
<span class="strong"><strong>Notice: /Stage[main]/Nginx::Config/File[/etc/nginx/conf.d/default.conf]/ensure: removed</strong></span>
<span class="strong"><strong>Info: Class[Nginx::Config]: Scheduling refresh of Class[Nginx::Service]</strong></span>
<span class="strong"><strong>Info: Class[Nginx::Service]: Scheduling refresh of Service[nginx]</strong></span>
<span class="strong"><strong>Notice: /Stage[main]/Nginx::Service/Service[nginx]: Triggered 'refresh' from 2 events</strong></span>
<span class="strong"><strong>Notice: Finished catalog run in 28.98 seconds</strong></span>
</pre></div></li><li class="listitem">Verify that you <a id="id471" class="indexterm"/>can reach the new virtualhost:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[root@webserver ~]# curl mescalero.example.com</strong></span>
<span class="strong"><strong>&lt;html&gt;</strong></span>
<span class="strong"><strong>mescalero.example.com</strong></span>
<span class="strong"><strong>http://en.wikipedia.org/wiki/Mescalero</strong></span>
<span class="strong"><strong>&lt;/html&gt;</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec250"/>How it works...</h2></div></div></div><p>Installing<a id="id472" class="indexterm"/> the <code class="literal">jfryman-nginx</code> module<a id="id473" class="indexterm"/> causes the concat, stdlib, and APT modules to be installed. We run Puppet on our master to have the plugins created by these modules added to our running master. The stdlib and concat have facter and Puppet plugins that need to be installed for the nginx module to work properly.</p><p>With the plugins synchronized, we can then run puppet agent on our web server. As a precaution, we stop Apache if it was previously started (we can't have nginx and Apache both listening on port <code class="literal">80</code>). After puppet agent runs, we verified that nginx was running and the virtual host was configured.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec251"/>There's more...</h2></div></div></div><p>This nginx module is under active development. There are several interesting solutions employed with the module. Previous releases used the <code class="literal">ripienaar-module_data</code> module, which allows a <a id="id474" class="indexterm"/>module to include default values for its various attributes, via a hiera plugin. Although still in an early stage of development, this system is already usable and represents one of the cutting-edge modules on the Forge.</p><p>In the next section, we'll use a supported module to configure and manage MySQL installations.</p></div></div>
<div class="section" title="Managing MySQL"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec90"/>Managing MySQL</h1></div></div></div><p>MySQL<a id="id475" class="indexterm"/> is a very widely used database server, and it's fairly certain you'll need to install and configure a MySQL server at some point. The <code class="literal">puppetlabs-mysql</code> module<a id="id476" class="indexterm"/> can simplify your MySQL deployments.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec252"/>How to do it...</h2></div></div></div><p>Follow these steps  <a id="id477" class="indexterm"/>to create the example:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Install the <code class="literal">puppetlabs-mysql</code> module:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>t@mylaptop ~/puppet $ puppet module install -i modules puppetlabs-mysql</strong></span>
<span class="strong"><strong>Notice: Preparing to install into /home/thomas/puppet/modules ...</strong></span>
<span class="strong"><strong>Notice: Downloading from https://forgeapi.puppetlabs.com ...</strong></span>
<span class="strong"><strong>Notice: Installing -- do not interrupt ...</strong></span>
<span class="strong"><strong>/home/thomas/puppet/modules</strong></span>
<span class="strong"><strong>└─┬ puppetlabs-mysql (v2.3.1)</strong></span>
<span class="strong"><strong>  └── puppetlabs-stdlib (v4.3.2)</strong></span>
</pre></div></li><li class="listitem">Create a new node definition for your MySQL server:<div class="informalexample"><pre class="programlisting">node dbserver {
  class { '::mysql::server':
    root_password    =&gt; 'PacktPub',
    override_options =&gt; { 
      'mysqld' =&gt; { 'max_connections' =&gt; '1024' } 
    }
  }
}</pre></div></li><li class="listitem">Run Puppet to <a id="id478" class="indexterm"/>install the database server and apply the new root password:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[root@dbserver ~]# puppet agent -t</strong></span>
<span class="strong"><strong>Info: Caching catalog for dbserver.example.com</strong></span>
<span class="strong"><strong>Info: Applying configuration version '1414566216'</strong></span>
<span class="strong"><strong>Notice: /Stage[main]/Mysql::Server::Install/Package[mysql-server]/ensure: created</strong></span>
<span class="strong"><strong>Notice: /Stage[main]/Mysql::Server::Service/Service[mysqld]/ensure: ensure changed 'stopped' to 'running'</strong></span>
<span class="strong"><strong>Info: /Stage[main]/Mysql::Server::Service/Service[mysqld]: Unscheduling refresh on Service[mysqld]</strong></span>
<span class="strong"><strong>Notice: /Stage[main]/Mysql::Server::Root_password/Mysql_user[root@localhost]/password_hash: defined 'password_hash' as '*6ABB0D4A7D1381BAEE4D078354557D495ACFC059'</strong></span>
<span class="strong"><strong>Notice: /Stage[main]/Mysql::Server::Root_password/File[/root/.my.cnf]/ensure: defined content as '{md5}87bc129b137c9d613e9f31c80ea5426c'</strong></span>
<span class="strong"><strong>Notice: Finished catalog run in 35.50 seconds</strong></span>
</pre></div></li><li class="listitem">Verify that you can connect to the database:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[root@dbserver ~]# mysql</strong></span>
<span class="strong"><strong>Welcome to the MySQL monitor.  Commands end with ; or \g.</strong></span>
<span class="strong"><strong>Your MySQL connection id is 11</strong></span>
<span class="strong"><strong>Server version: 5.1.73 Source distribution</strong></span>

<span class="strong"><strong>Copyright (c) 2000, 2013, Oracle and/or its affiliates. All rights reserved.</strong></span>

<span class="strong"><strong>Oracle is a registered trademark of Oracle Corporation and/or its</strong></span>
<span class="strong"><strong>affiliates. Other names may be trademarks of their respective</strong></span>
<span class="strong"><strong>owners.</strong></span>

<span class="strong"><strong>Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</strong></span>

<span class="strong"><strong>mysql&gt;</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec253"/>How it works...</h2></div></div></div><p>The MySQL <a id="id479" class="indexterm"/>module installs the MySQL server and ensures that the server is running. It then configures the root password for MySQL. The module does a lot of other things for you as well. It creates a <code class="literal">.my.cnf</code> file with the root user password. When we run the <code class="literal">mysql</code> client, the <code class="literal">.my.cnf</code> file sets all the defaults, so we do not need to supply any arguments.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec254"/>There's more...</h2></div></div></div><p>In the next section, we'll show how to create databases and users.</p></div></div>
<div class="section" title="Creating databases and users"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec91"/>Creating databases and users</h1></div></div></div><p>Managing a database <a id="id480" class="indexterm"/>means more than ensuring that the service is running; a database<a id="id481" class="indexterm"/> server is nothing without databases. Databases need users and privileges. Privileges are handled with <code class="literal">GRANT</code> statements. We will use the <code class="literal">puppetlabs-mysql</code> package<a id="id482" class="indexterm"/> to create a database and a user with access to that database. We'll create a MySQL user Drupal and a database called Drupal. We'll create a table named nodes and place data into that table.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec255"/>How to do it...</h2></div></div></div><p>Follow these steps to create databases and users:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a database definition within your <code class="literal">dbserver</code> class:<div class="informalexample"><pre class="programlisting">mysql::db { 'drupal':
    host    =&gt; 'localhost',
    user    =&gt; 'drupal',
    password    =&gt; 'Cookbook',
    sql     =&gt; '/root/drupal.sql',
    require =&gt; File['/root/drupal.sql']
  }

  file { '/root/drupal.sql':
    ensure =&gt; present,
    source =&gt; 'puppet:///modules/mysql/drupal.sql',
  }</pre></div></li><li class="listitem">Allow the Drupal user to modify the nodes table:<div class="informalexample"><pre class="programlisting">mysql_grant { 'drupal@localhost/drupal.nodes':
    ensure     =&gt; 'present',
    options    =&gt; ['GRANT'],
    privileges =&gt; ['ALL'],
    table      =&gt; 'drupal.nodes'nodes',
    user       =&gt; 'drupal@localhost',
  }</pre></div></li><li class="listitem">Create <a id="id483" class="indexterm"/>the <code class="literal">drupal.sql</code> file <a id="id484" class="indexterm"/>with the following contents:<div class="informalexample"><pre class="programlisting">CREATE TABLE users (id INT PRIMARY KEY AUTO_INCREMENT, title VARCHAR(255), body TEXT);
INSERT INTO users (id, title, body) VALUES (1,'First Node','Contents of first Node');
INSERT INTO users (id, title, body) VALUES (2,'Second Node','Contents of second Node');</pre></div></li><li class="listitem">Run Puppet to have user, database, and <code class="literal">GRANT</code> created:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[root@dbserver ~]# puppet agent -t</strong></span>
<span class="strong"><strong>Info: Caching catalog for dbserver.example.com</strong></span>
<span class="strong"><strong>Info: Applying configuration version '1414648818'</strong></span>
<span class="strong"><strong>Notice: /Stage[main]/Main/Node[dbserver]/File[/root/drupal.sql]/ensure: defined content as '{md5}780f3946cfc0f373c6d4146394650f6b'</strong></span>
<span class="strong"><strong>Notice: /Stage[main]/Main/Node[dbserver]/Mysql_grant[drupal@localhost/drupal.nodes]/ensure: created</strong></span>
<span class="strong"><strong>Notice: /Stage[main]/Main/Node[dbserver]/Mysql::Db[drupal]/Mysql_user[drupal@localhost]/ensure: created</strong></span>
<span class="strong"><strong>Notice: /Stage[main]/Main/Node[dbserver]/Mysql::Db[drupal]/Mysql_database[drupal]/ensure: created</strong></span>
<span class="strong"><strong>Info: /Stage[main]/Main/Node[dbserver]/Mysql::Db[drupal]/Mysql_database[drupal]: Scheduling refresh of Exec[drupal-import]</strong></span>
<span class="strong"><strong>Notice: /Stage[main]/Main/Node[dbserver]/Mysql::Db[drupal]/Mysql_grant[drupal@localhost/drupal.*]/ensure: created</strong></span>
<span class="strong"><strong>Notice: /Stage[main]/Main/Node[dbserver]/Mysql::Db[drupal]/Exec[drupal-import]: Triggered 'refresh' from 1 events</strong></span>
<span class="strong"><strong>Notice: Finished catalog run in 10.06 seconds</strong></span>
</pre></div></li><li class="listitem">Verify that the<a id="id485" class="indexterm"/> database and <a id="id486" class="indexterm"/>table have been created:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[root@dbserver ~]# mysql drupal</strong></span>
<span class="strong"><strong>Reading table information for completion of table and column names</strong></span>
<span class="strong"><strong>You can turn off this feature to get a quicker startup with -A</strong></span>

<span class="strong"><strong>Welcome to the MySQL monitor.  Commands end with ; or \g.</strong></span>
<span class="strong"><strong>Your MySQL connection id is 34</strong></span>
<span class="strong"><strong>Server version: 5.1.73 Source distribution</strong></span>

<span class="strong"><strong>Copyright (c) 2000, 2013, Oracle and/or its affiliates. All rights reserved.</strong></span>

<span class="strong"><strong>Oracle is a registered trademark of Oracle Corporation and/or its</strong></span>
<span class="strong"><strong>affiliates. Other names may be trademarks of their respective</strong></span>
<span class="strong"><strong>owners.</strong></span>

<span class="strong"><strong>Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</strong></span>

<span class="strong"><strong>mysql&gt; show tables;</strong></span>
<span class="strong"><strong>+------------------+</strong></span>
<span class="strong"><strong>| Tables_in_drupal |</strong></span>
<span class="strong"><strong>+------------------+</strong></span>
<span class="strong"><strong>| users            |</strong></span>
<span class="strong"><strong>+------------------+</strong></span>
<span class="strong"><strong>1 row in set (0.00 sec)</strong></span>
</pre></div></li><li class="listitem">Now, verify that our default data has been loaded into the table:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>mysql&gt; select * from users;</strong></span>
<span class="strong"><strong>+----+-------------+-------------------------+</strong></span>
<span class="strong"><strong>| id | title       | body                    |</strong></span>
<span class="strong"><strong>+----+-------------+-------------------------+</strong></span>
<span class="strong"><strong>|  1 | First Node  | Contents of first Node  |</strong></span>
<span class="strong"><strong>|  2 | Second Node | Contents of second Node |</strong></span>
<span class="strong"><strong>+----+-------------+-------------------------+</strong></span>
<span class="strong"><strong>2 rows in set (0.00 sec)</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec256"/>How it works...</h2></div></div></div><p>We start with the<a id="id487" class="indexterm"/> definition <a id="id488" class="indexterm"/>of the new drupal database:</p><div class="informalexample"><pre class="programlisting">  mysql::db { 'drupal':
    host    =&gt; 'localhost',
    user    =&gt; 'drupal',
    password    =&gt; 'Cookbook',
    sql     =&gt; '/root/drupal.sql',
    require =&gt; File['/root/drupal.sql']
  }</pre></div><p>We specify that we'll connect from localhost (we could connect to the database from another server) using the drupal user. We give the password for the user and specify a SQL file that will be applied to the database after the database has been created. We require that this file already exist and define the file next:</p><div class="informalexample"><pre class="programlisting">file { '/root/drupal.sql':
    ensure =&gt; present,
    source =&gt; 'puppet:///modules/mysql/drupal.sql',
  }</pre></div><p>We then ensure that the user has the appropriate privileges with a <code class="literal">mysql_grant</code> statement:</p><div class="informalexample"><pre class="programlisting">  mysql_grant { 'drupal@localhost/drupal.nodes':
    ensure     =&gt; 'present',
    options    =&gt; ['GRANT'],
    privileges =&gt; ['ALL'],
    table      =&gt; 'drupal.nodes',
    user       =&gt; 'drupal@localhost',
  }</pre></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec257"/>There's more...</h2></div></div></div><p>Using the puppetlabs-MySQL<a id="id489" class="indexterm"/> and puppetlabs-Apache module, we can create an entire functioning web server. The puppetlabs-Apache module<a id="id490" class="indexterm"/> will install Apache, and we can include the PHP module and MySQL module as well. We can then use the puppetlabs-Mysql module to install the MySQL server, and then create the required drupal databases and seed the database with the data.</p><p>Deploying a new drupal installation would be as simple as including a class on a node.</p></div></div></body></html>