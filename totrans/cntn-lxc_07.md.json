["```\n     root@ubuntu:~# apt-get update && apt-get -y upgrade && reboot \n     root@ubuntu:~# lsb_release -cd \n     Description: Ubuntu 16.04.1 LTS \n     Codename: xenial \n     root@ubuntu:~# \n     root@ubuntu:~# apt-get install -y lxc\n\n    ```", "```\n     root@ubuntu:~# lxc-create --name dir_container --template ubuntu \n     root@ubuntu:~# lxc-start --name dir_container\n\n    ```", "```\n     root@ubuntu:~# lxc-attach --name dir_container \n     root@dir_container:~# apt-get install -y nginx \n     root@dir_container:~# echo \"Original container\" > \n          /var/www/html/index.nginx-debian.html \n     root@dir_container:~# exit \n     exit \n     root@ubuntu:~#\n\n    ```", "```\n     root@ubuntu:~# lxc-ls -f \n     NAME STATE AUTOSTART GROUPS IPV4 IPV6 \n     dir_container RUNNING 0 - 10.0.3.107 - \n     root@ubuntu:~# curl 10.0.3.107 \n     Original container \n     root@ubuntu:~#\n\n    ```", "```\n     root@ubuntu:~# cd /var/lib/lxc \n     root@ubuntu:/var/lib/lxc# ls -lah \n     total 12K \n     drwx------ 3 root root 4.0K Nov 15 16:28 . \n     drwxr-xr-x 42 root root 4.0K Nov 15 16:17 .. \n     drwxrwx--- 3 root root 4.0K Nov 15 16:33 dir_container \n     root@ubuntu:/var/lib/lxc# ls -la dir_container/ \n     total 16 \n     drwxrwx--- 3 root root 4096 Nov 15 16:33 . \n     drwx------ 3 root root 4096 Nov 15 16:28 .. \n     -rw-r--r-- 1 root root 712 Nov 15 16:33 config \n     drwxr-xr-x 21 root root 4096 Nov 15 16:38 rootfs \n     root@ubuntu:/var/lib/lxc#\n\n    ```", "```\n     root@ubuntu:/var/lib/lxc# lxc-stop --name dir_container \n     root@ubuntu:/var/lib/lxc# lxc-ls -f \n     NAME STATE AUTOSTART GROUPS IPV4 IPV6 \n     dir_container STOPPED 0 - - - \n     root@ubuntu:/var/lib/lxc#\n\n    ```", "```\n     root@ubuntu:/var/lib/lxc# tar --numeric-owner -jcvf \n          dir_container.tar.bz2 dir_container/ \n     ... \n     root@ubuntu:/var/lib/lxc# file dir_container.tar.bz2 \n     dir_container.tar.bz2: bzip2 compressed data, block size = 900k \n     root@ubuntu:/var/lib/lxc#\n\n    ```", "```\n     root@ubuntu:/var/lib/lxc# rsync -vaz dir_container.tar.bz2 \n          ubuntu-backup:/tmp \n     sending incremental file list \n     dir_container.tar.bz2 \n     sent 148,846,592 bytes received 35 bytes 9,603,008.19 bytes/sec \n     total size is 149,719,493 speedup is 1.01 \n     root@ubuntu:/var/lib/lxc# rm -f dir_container.tar.bz2\n\n    ```", "```\nroot@ubuntu-backup:~# cd /var/lib/lxc \nroot@ubuntu-backup:/var/lib/lxc# ls -la \ntotal 8 \ndrwx------ 2 root root 4096 Oct 21 16:56 . \ndrwxr-xr-x 42 root root 4096 Nov 15 16:48 .. \nroot@ubuntu-backup:/var/lib/lxc# \nroot@ubuntu-backup:/var/lib/lxc# tar jxfv /tmp/dir_container.tar.bz2 \n... \nroot@ubuntu-backup:/var/lib/lxc# ls -la \ntotal 12 \ndrwx------ 3 root root 4096 Nov 15 16:59 . \ndrwxr-xr-x 42 root root 4096 Nov 15 16:48 .. \ndrwxrwx--- 3 root root 4096 Nov 15 16:33 dir_container \nroot@ubuntu-backup:/var/lib/lxc#\n\n```", "```\nroot@ubuntu-backup:/var/lib/lxc# lxc-ls -f \nNAME STATE AUTOSTART GROUPS IPV4 IPV6 \ndir_container STOPPED 0 - - - \nroot@ubuntu-backup:/var/lib/lxc#\n\n```", "```\nroot@ubuntu-backup:/var/lib/lxc# lxc-start --name dir_container \nroot@ubuntu-backup:/var/lib/lxc# lxc-ls -f \nNAME STATE AUTOSTART GROUPS IPV4 IPV6 \ndir_container RUNNING 0 - 10.0.3.107 - \nroot@ubuntu-backup:/var/lib/lxc# curl 10.0.3.107 \nOriginal container \nroot@ubuntu-backup:/var/lib/lxc#\n\n```", "```\nroot@ubuntu-backup:/var/lib/lxc# lxc-stop --name dir_container \nroot@ubuntu-backup:/var/lib/lxc# lxc-destroy --name dir_container \nDestroyed container dir_container \nroot@ubuntu-backup:/var/lib/lxc# ls -la \ntotal 8 \ndrwx------ 2 root root 4096 Nov 15 17:01 . \ndrwxr-xr-x 42 root root 4096 Nov 15 16:48 .. \nroot@ubuntu-backup:/var/lib/lxc#\n\n```", "```\n     root@ubuntu:/var/lib/lxc# lxc-copy --name dir_container --newname \n          dir_container_backup \n     root@ubuntu:/var/lib/lxc#\n\n    ```", "```\n     root@ubuntu:/var/lib/lxc# ls -la \n     total 16 \n     drwx------ 4 root root 4096 Nov 15 17:07 . \n     drwxr-xr-x 42 root root 4096 Nov 15 16:17 .. \n     drwxrwx--- 3 root root 4096 Nov 15 16:33 dir_container \n     drwxrwx--- 3 root root 4096 Nov 15 17:07 dir_container_backup \n     root@ubuntu:/var/lib/lxc# lxc-ls -f \n     NAME STATE AUTOSTART GROUPS IPV4 IPV6 \n     dir_container STOPPED 0 - - - \n     dir_container_backup STOPPED 0 - - - \n     root@ubuntu:/var/lib/lxc#\n\n    ```", "```\n     root@ubuntu:/var/lib/lxc# cat dir_container_backup/config | egrep \n          \"rootfs|utsname\" \n     lxc.rootfs = /var/lib/lxc/dir_container_backup/rootfs \n     lxc.rootfs.backend = dir \n     lxc.utsname = dir_container_backup \n     root@ubuntu:/var/lib/lxc#\n\n    ```", "```\n     root@ubuntu:/var/lib/lxc# lxc-destroy --name dir_container_backup \n     Destroyed container dir_container_backup \n     root@ubuntu:/var/lib/lxc# lxc-destroy --name dir_container \n     Destroyed container dir_container \n     root@ubuntu:/var/lib/lxc#\n\n    ```", "```\n     root@ubuntu-backup:~# apt-get install -y iscsitarget \n     root@ubuntu-backup:~#\n\n    ```", "```\n     root@ubuntu-backup:~# sed -i   \n          's/ISCSITARGET_ENABLE=false/ISCSITARGET_ENABLE=true/g' \n          /etc/default/iscsitarget \n     root@ubuntu-backup:~#\n\n    ```", "```\n          iqn.yyyy-mm.naming-authority:unique name\n    ```", "```\n     root@ubuntu-backup:~# cat /etc/iet/ietd.conf \n     Target iqn.2001-04.com.example:lxc \n     IncomingUser lxc secret \n     OutgoingUser \n     Lun 0 Path=/dev/xvdb,Type=fileio \n     Alias lxc_lun \n     root@ubuntu-backup:~#\n\n    ```", "```\n     root@ubuntu-backup:~# cat /etc/iet/initiators.allow \n     iqn.2001-04.com.example:lxc 10.208.129.253 \n     root@ubuntu-backup:~#\n\n    ```", "```\n     root@ubuntu-backup:~# /etc/init.d/iscsitarget start \n     [ ok ] Starting iscsitarget (via systemctl): iscsitarget.service. \n     root@ubuntu-backup:~#\n\n    ```", "```\n     [root@centos ~]# yum install scsi-target-utils \n     [root@centos ~]#\n\n    ```", "```\n     [root@centos ~]# cat /etc/tgt/targets.conf \n     default-driver iscsi \n     <target iqn.2001-04.com.example:lxc> \n     backing-store /dev/xvdb \n     initiator-address 10.208.5.176 \n     incominguser lxc secret \n     </target> \n     [root@centos ~]#\n\n    ```", "```\n     [root@centos ~]# service tgtd restart\n\n    ```", "```\n     [root@centos ~]# tgt-admin --show \n     Target 1: iqn.2001-04.com.example:lxc \n     System information: \n     Driver: iscsi \n     State: ready \n     I_T nexus information: \n     LUN information: \n     ... \n     LUN: 1 \n     Type: disk \n     SCSI ID: IET 00010001 \n     SCSI SN: beaf11 \n     Size: 80531 MB, Block size: 512 \n     Online: Yes \n     Removable media: No \n     Prevent removal: No \n     Readonly: No \n     SWP: No \n     Thin-provisioning: No \n     Backing store type: rdwr \n     Backing store path: /dev/xvdb \n     Backing store flags: \n     Account information: \n     ACL information: \n     10.208.5.176 \n     [root@centos ~]#\n\n    ```", "```\n     root@ubuntu:~# apt-get install -y open-iscsi\n\n    ```", "```\n     [root@centos ~]# yum install iscsi-initiator-utils\n\n    ```", "```\n     root@ubuntu:~# sed -i 's/node.startup = manual/node.startup = \n          automatic/g'   /etc/iscsi/iscsid.conf \n     root@ubuntu:~# /etc/init.d/open-iscsi restart \n     [ ok ] Restarting open-iscsi (via systemctl): open-iscsi.service. \n     root@ubuntu:~#\n\n    ```", "```\n     root@ubuntu:~# iscsiadm -m discovery -t sendtargets -p 10.208.129.201 \n     10.208.129.201:3260,1 iqn.2001-04.com.example:lxc \n     192.237.179.19:3260,1 iqn.2001-04.com.example:lxc \n     10.0.3.1:3260,1 iqn.2001-04.com.example:lxc \n     root@ubuntu:~#\n\n    ```", "```\n     root@ubuntu:~# iscsiadm -m node -T iqn.2001-04.com.example:lxc -p \n          10.208.129.201:3260 --op=update --name node.session.auth.authmethod \n          --value=CHAP \n     root@ubuntu:~# iscsiadm -m node -T iqn.2001-04.com.example:lxc -p   \n          10.208.129.201:3260 --op=update --name node.session.auth.username \n          --value=lxc \n     root@ubuntu:~# iscsiadm -m node -T iqn.2001-04.com.example:lxc -p\n          10.208.129.201:3260 --op=update --name node.session.auth.password \n          --value=secret \n     root@ubuntu:~#\n\n    ```", "```\n     root@ubuntu:~# cat \n          /etc/iscsi/nodes/iqn.2001-04.com.example\\:lxc/10.208.129.201\\,3260\\,1\n          /default | grep auth \n     node.session.auth.authmethod = CHAP \n     node.session.auth.username = lxc \n     node.session.auth.password = secret \n     node.conn[0].timeo.auth_timeout = 45 \n     root@ubuntu:~#\n\n    ```", "```\n     root@ubuntu:~# iscsiadm -m node -T iqn.2001-04.com.example:lxc -p  \n          10.208.129.201:3260 --login \n     Logging in to [iface: default, target: iqn.2001-04.com.example:lxc, \n          portal:10.208.129.201,3260] (multiple) \n     Login to [iface: default, target: iqn.2001-04.com.example:lxc, \n          portal:10.208.129.201,3260] successful. \n     root@ubuntu:~#\n\n    ```", "```\n     root@ubuntu:~# iscsiadm -m session \n     tcp: [2] 10.208.129.201:3260,1 iqn.2001-04.com.example:lxc \n          (non-flash) \n     root@ubuntu:~#\n\n    ```", "```\n     root@ubuntu:~# ls -la /dev/disk/by-path/ \n     total 0 \n     drwxr-xr-x 2 root root 60 Nov 15 20:23 . \n     drwxr-xr-x 6 root root 120 Nov 15 20:23 .. \n     lrwxrwxrwx 1 root root 9 Nov 15 20:23 \n          ip-10.208.129.201:3260-iscsi-iqn.2001-04.com.example:lxc-lun-0 \n          -> ../../sda \n     root@ubuntu:~#\n\n    ```", "```\n     root@ubuntu:~# mkfs.ext4 /dev/disk/by-path/ip-10.208.129.201\\\n          :3260-iscsi-iqn.2001-04.com.example\\:lxc-lun-0 \n     root@ubuntu:~#\n\n    ```", "```\n     root@ubuntu:~# mount /dev/disk/by-path/ip-10.208.129.201\\\n          :3260-iscsi-iqn.2001-04.com.example\\:lxc-lun-0 /var/lib/lxc \n     root@ubuntu:~# df -h | grep lxc \n     /dev/sda 74G 52M 70G 1% /var/lib/lxc \n     root@ubuntu:~#\n\n    ```", "```\nroot@ubuntu:~# lxc-create --name iscsi_container --template ubuntu \nroot@ubuntu:~# lxc-start --name iscsi_container \nroot@ubuntu:~# lxc-ls -f \nNAME STATE AUTOSTART GROUPS IPV4 IPV6 \niscsi_container RUNNING 0 - 10.0.3.162 - \nroot@ubuntu:~#\n\n```", "```\nroot@ubuntu:~# ls -la /var/lib/lxc/iscsi_container/ \ntotal 16 \ndrwxrwx--- 3 root root 4096 Nov 15 21:01 . \ndrwxr-xr-x 4 root root 4096 Nov 15 21:01 .. \n-rw-r--r-- 1 root root 716 Nov 15 21:01 config \ndrwxr-xr-x 21 root root 4096 Nov 15 21:01 rootfs \nroot@ubuntu:~#\n\n```", "```\nroot@ubuntu:~# lxc-stop --name iscsi_container \nroot@ubuntu:~# umount /var/lib/lxc \nroot@ubuntu:~# iscsiadm -m node -T iqn.2001-04.com.example:lxc -p 10.208.129.201:3260 --logout \nLogging out of session [sid: 6, target: iqn.2001-04.com.example:lxc, portal: 10.208.129.201,3260] \nLogout of [sid: 6, target: iqn.2001-04.com.example:lxc, portal: 10.208.129.201,3260] successful. \nroot@ubuntu:~#\n\n```", "```\n     root@ubuntu-backup:~# iscsiadm -m node -T iqn.2001-04.com.example:lxc\n          -p 10.208.129.201:3260 --login \n     Logging in to [iface: default, target: iqn.2001-04.com.example:lxc, \n          portal: 10.208.129.201,3260] (multiple) \n     Login to [iface: default, target: iqn.2001-04.com.example:lxc, \n          portal: 10.208.129.201,3260] successful. \n     root@ubuntu-backup:~#\n\n    ```", "```\n     root@ubuntu-backup:~# ls -la /dev/disk/by-path/ \n     total 0 \n     drwxr-xr-x 2 root root 60 Nov 15 21:31 . \n     drwxr-xr-x 6 root root 120 Nov 15 21:31 .. \n     lrwxrwxrwx 1 root root 9 Nov 15 21:31 ip-10.208.129.201:\n          3260-iscsi-iqn.2001-04.com.example:lxc-lun-0 -> ../../sda \n     root@ubuntu-backup:~#\n\n    ```", "```\n     root@ubuntu-backup:~# mount /dev/disk/by-path/ip-10.208.129.201\\\n          :3260-iscsi-iqn.2001-04.com.example\\:lxc-lun-0 /var/lib/lxc \n     root@ubuntu-backup:~#\n\n    ```", "```\n     root@ubuntu-backup:~# lxc-ls -f \n     NAME STATE AUTOSTART GROUPS IPV4 IPV6 \n     iscsi_container STOPPED 0 - - - \n     root@ubuntu-backup:~#\n\n    ```", "```\n     root@ubuntu-backup:~# lxc-start --name iscsi_container \n     root@ubuntu-backup:~# lxc-ls -f \n     NAME STATE AUTOSTART GROUPS IPV4 IPV6 \n     iscsi_container RUNNING 0 - 10.0.3.162 - \n     root@ubuntu-backup:~#\n\n    ```", "```\n     root@node1:~# pvcreate /dev/xvdb \n     Physical volume \"/dev/xvdb\" successfully created \n     root@node1:~# vgcreate vg_node /dev/xvdb \n     Volume group \"vg_node\" successfully created \n     root@node1:~# lvcreate -n node1 -L 10g vg_node \n     Logical volume \"node1\" created. \n     root@node1:~#\n\n    ```", "```\n     root@node1:~# mkfs.xfs -i size=512 /dev/vg_node/node1 \n     meta-data=/dev/vg_node/node1   isize=512       agcount=4,  \n          agsize=655360 blks \n     =                       sectsz=512      attr=2, \n          projid32bit=1 \n     =                       crc=1           finobt=1, \n          sparse=0 \n     data =                       bsize=4096      blocks=2621440, \n          imaxpct=25 \n     =                       sunit=0         swidth=0 \n          blks \n     naming =version 2              bsize=4096      ascii-ci=0 \n          ftype=1 \n     log    =internal log           bsize=4096      blocks=2560, \n          version=2 \n     =                       sectsz=512      sunit=0 blks, \n          lazy-count=1 \n     realtime =none                 extsz=4096      blocks=0, \n          rtextents=0 \n     root@node1:~# mount /dev/vg_node/node1 /mnt/ \n     root@node1:~# mkdir /mnt/bricks\n\n    ```", "```\n     root@node1:~# apt-get install -y glusterfs-server\n\n    ```", "```\n     root@node1:~# gluster peer status \n     Number of Peers: 0 \n     root@node1:~# gluster peer probe node2 \n     peer probe: success. \n     root@node1:~# gluster peer status \n     Number of Peers: 1 \n     Hostname: node2 \n     Uuid: 65a480ba-e841-41a2-8f28-9d8f58f344ce \n     State: Peer in Cluster (Connected) \n     root@node1:~#\n\n    ```", "```\n     root@node1:~# gluster volume create lxc_glusterfs replica 2 transport \n          tcp node1:/mnt/bricks/node1 node2:/mnt/bricks/node2 \n     volume create: lxc_glusterfs: success: please start the volume to \n          access data \n     root@node1:~# gluster volume list \n     lxc_glusterfs \n     root@node1:~#\n\n    ```", "```\n     root@node1:~# gluster volume start lxc_glusterfs \n     volume start: lxc_glusterfs: success\n\n    ```", "```\n     root@node1:~# gluster volume info\n     Volume Name: lxc_glusterfs\n     Type: Replicate\n     Volume ID: 9f11dc99-19d6-4644-87d2-fa6e983bcb83\n     Status: Started\n     Number of Bricks: 1 x 2 = 2\n     Transport-type: tcp\n     Bricks:\n     Brick1: node1:/mnt/bricks/node1\n     Brick2: node2:/mnt/bricks/node2\n     Options Reconfigured:\n     performance.readdir-ahead: on\n     root@node1:~#\n\n    ```", "```\n     root@node1:~# ls -la /mnt/bricks/node1/ \n     total 0 \n     drwxr-xr-x 4 root root 41 Nov 16 21:33 . \n     drwxr-xr-x 3 root root 19 Nov 16 21:33 .. \n     drw------- 6 root root 141 Nov 16 21:34 .glusterfs \n     drwxr-xr-x 3 root root 25 Nov 16 21:33 .trashcan \n     root@node1:~#\n\n    ```", "```\n     root@node2:~# ls -la /mnt/bricks/node1/ \n     total 0 \n     drwxr-xr-x 4 root root 41 Nov 16 21:33 . \n     drwxr-xr-x 3 root root 19 Nov 16 21:33 .. \n     drw------- 6 root root 141 Nov 16 21:34 .glusterfs \n     drwxr-xr-x 3 root root 25 Nov 16 21:33 .trashcan \n     root@node2:~#\n\n    ```", "```\n     root@lxc1:~# apt-get install -y glusterfs-client attr\n\n    ```", "```\n     root@lxc1:~# mount -t glusterfs node2:/lxc_glusterfs /var/lib/lxc\n\n    ```", "```\n     root@lxc1:~# lxc-create --name glusterfs_lxc --template ubuntu \n     root@lxc1:~# lxc-start --name glusterfs_lxc\n\n    ```", "```\n     root@lxc1:~# lxc-attach --name glusterfs_lxc \n     root@glusterfs_lxc:~# apt-get -y install nginx \n     ... \n     root@glusterfs_lxc:~# echo \"Nginx on GlusterFS LXC\" > \n          /var/www/html/index.nginx-debian.html \n     root@glusterfs_lxc:~# exit \n     exit \n     root@lxc1:~#\n\n    ```", "```\n     root@lxc1:~# lxc-ls -f \n     NAME STATE AUTOSTART GROUPS IPV4 IPV6 \n     glusterfs_lxc RUNNING 0 - 10.0.3.184 - \n     root@lxc1:~# curl 10.0.3.184 \n     Nginx on GlusterFS LXC \n     root@lxc1:~#\n\n    ```", "```\n     root@node1:~# ls -la /mnt/bricks/node1/ \n     total 12 \n     drwxr-xr-x 5 root root 62 Nov 16 21:53 . \n     drwxr-xr-x 3 root root 19 Nov 16 21:33 .. \n     drw------- 261 root root 8192 Nov 16 21:54 .glusterfs \n     drwxrwx--- 3 root root 34 Nov 16 21:53 glusterfs_lxc \n     drwxr-xr-x 3 root root 25 Nov 16 21:33 .trashcan \n     root@node1:~#\n\n    ```", "```\n     root@node2:~# ls -la /mnt/bricks/node2/ \n     total 12 \n     drwxr-xr-x 5 root root 62 Nov 16 21:44 . \n     drwxr-xr-x 3 root root 19 Nov 16 21:33 .. \n     drw------- 261 root root 8192 Nov 16 21:44 .glusterfs \n     drwxrwx--- 3 root root 34 Nov 16 21:47 glusterfs_lxc \n     drwxr-xr-x 3 root root 25 Nov 16 21:33 .trashcan \n     root@node2:~#\n\n    ```", "```\nroot@lxc2:~# apt-get install -y glusterfs-client attr \nroot@lxc2:~# mount -t glusterfs node1:/lxc_glusterfs /var/lib/lxc \nroot@lxc2:~# lxc-ls -f \nNAME STATE AUTOSTART GROUPS IPV4 IPV6 \nglusterfs_lxc STOPPED 0 - - - \nroot@lxc2:~#\n\n```", "```\nroot@lxc2:~# lxc-start --name glusterfs_lxc \nroot@lxc2:~# lxc-ls -f \nNAME STATE AUTOSTART GROUPS IPV4 IPV6 \nglusterfs_lxc RUNNING 0 - 10.0.3.184 - \nroot@lxc2:~#\n\n```", "```\nroot@lxc2:~# curl 10.0.3.184 \nNginx on GlusterFS LXC \nroot@lxc2:~#\n\n```", "```\nroot@ubuntu:~# lxc-create --name monitor_lxc --template ubuntu \nroot@ubuntu:~# lxc-start --name monitor_lxc \nroot@ubuntu:~# lxc-monitor --name monitor_lxc \n'monitor_lxc' changed state to [STARTING] \n'monitor_lxc' changed state to [RUNNING] \n\n```", "```\nroot@ubuntu:~# lxc-stop --name monitor_lxc \nroot@ubuntu:~# \n'monitor_lxc' changed state to [STARTING] \n'monitor_lxc' changed state to [RUNNING] \n'monitor_lxc' exited with status [0] \n'monitor_lxc' changed state to [STOPPING] \n'monitor_lxc' changed state to [STOPPED] \nroot@ubuntu:~# lxc-start --name monitor_lxc\n\n```", "```\nroot@ubuntu:~# lxc-top --name monitor_lxc \nContainer  CPU    CPU     CPU    BlkIO    Mem \nName               Used     Sys    User   \nTotal    Used \nmonitor_lxc        0.52   0.26    0.16    0.00 \n12.71 MB \nTOTAL 1 of 1       0.52   0.26    0.16    0.00 \n12.71 MB\n\n```", "```\nroot@ubuntu:~# lxc-info --name monitor_lxc \nName:        monitor_lxc \nState:       RUNNING \nPID:         19967 \nIP:          10.0.3.88 \nCPU use:     0.53 seconds \nBlkIO use:   0 bytes \nMemory use:  12.74 MiB \nKMem use:    0 bytes \nLink:        veth8OX0PW \nTX bytes:    1.34 KiB \nRX bytes:    1.35 KiB \nTotal bytes: 2.69 KiB \nroot@ubuntu:~#\n\n```", "```\nroot@ubuntu:~# find /sys/fs/ -type d -name monitor_lxc \n/sys/fs/cgroup/freezer/lxc/monitor_lxc \n/sys/fs/cgroup/cpuset/lxc/monitor_lxc \n/sys/fs/cgroup/net_cls,net_prio/lxc/monitor_lxc \n/sys/fs/cgroup/devices/lxc/monitor_lxc \n/sys/fs/cgroup/perf_event/lxc/monitor_lxc \n/sys/fs/cgroup/hugetlb/lxc/monitor_lxc \n/sys/fs/cgroup/blkio/lxc/monitor_lxc \n/sys/fs/cgroup/pids/lxc/monitor_lxc \n/sys/fs/cgroup/memory/lxc/monitor_lxc \n/sys/fs/cgroup/cpu,cpuacct/lxc/monitor_lxc \n/sys/fs/cgroup/systemd/lxc/monitor_lxc \nroot@ubuntu:~#\n\n```", "```\nroot@ubuntu:~# lxc-cgroup --name monitor_lxc memory.limit_in_bytes 536870912 \nroot@ubuntu:~# \n\n```", "```\nroot@ubuntu:~# cat /sys/fs/cgroup/memory/lxc/monitor_lxc/memory.usage_in_bytes \n13361152 \nroot@ubuntu:~#\n\n```", "```\nroot@ubuntu:~# cat /sys/fs/cgroup/memory/lxc/monitor_lxc/memory.stat \ncache 8794112 \nrss 4833280 \nrss_huge 0 \nmapped_file 520192 \ndirty 0 \n... \nroot@ubuntu:~#\n\n```", "```\nroot@ubuntu:~# cat /sys/fs/cgroup/cpu,cpuacct/lxc/monitor_lxc/cpuacct.usage \n627936278 \nroot@ubuntu:~#\n\n```", "```\nroot@ubuntu:~# ifconfig veth8OX0PW \nveth8OX0PW Link encap:Ethernet HWaddr fe:4d:bf:3f:17:8f \n inet6 addr: fe80::fc4d:bfff:fe3f:178f/64 Scope:Link \n UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 \n RX packets:125645 errors:0 dropped:0 overruns:0 frame:0 \n TX packets:129909 errors:0 dropped:0 overruns:0 carrier:0 \n collisions:0 txqueuelen:1000 \n RX bytes:20548005 (20.5 MB) TX bytes:116477293 (116.4 MB) \nroot@ubuntu:~#\n\n```", "```\nroot@ubuntu:~# mkdir -p /var/run/netns \nroot@ubuntu:~# ln -sf /proc/19967/ns/net /var/run/netns/monitor_lxc \nroot@ubuntu:~# ip netns exec monitor_lxc ip a s \n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1 \n link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 \n inet 127.0.0.1/8 scope host lo \n valid_lft forever preferred_lft forever \n inet6 ::1/128 scope host \n valid_lft forever preferred_lft forever \n17: eth0@if18: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000 \n link/ether 00:16:3e:01:b7:8b brd ff:ff:ff:ff:ff:ff link-netnsid 0 \n inet 10.0.3.88/24 brd 10.0.3.255 scope global eth0 \n valid_lft forever preferred_lft forever \n inet6 fe80::216:3eff:fe01:b78b/64 scope link \n valid_lft forever preferred_lft forever \nroot@ubuntu:~#\n\n```", "```\n     root@ubuntu:~# apt-get install -y monit mailutils\n\n    ```", "```\n     root@ubuntu:~# cd /etc/monit/ \n     root@ubuntu:/etc/monit# cat monitrc | grep -vi \"#\" \n     set daemon 120 \n     set logfile /var/log/monit.log \n     set idfile /var/lib/monit/id \n     set statefile /var/lib/monit/state \n     set eventqueue \n     basedir /var/lib/monit/events \n     slots 100 \n     set httpd port 2812 and \n     allow admin:monit \n     include /etc/monit/conf.d/* \n     include /etc/monit/conf-enabled/* \n     root@ubuntu:/etc/monit#\n\n    ```", "```\n     root@ubuntu:/etc/monit# cat conf.d/container_state.cfg \n     check program container_status with path \n          \"/etc/monit/container_running.sh \n          monitor_lxc\" \n     if status == 1 \n     then exec \"/bin/bash -c '/etc/monit/alert.sh'\" \n     group lxc \n     root@ubuntu:/etc/monit#\n\n    ```", "```\n     root@ubuntu:/etc/monit# cat container_running.sh \n     #!/bin/bash \n     CONTAINER_NAME=$1 \n     CONTAINER_STATE=$(lxc-info --state --name $CONTAINER_NAME \n          | awk '{print $2}') \n     if [ \"$CONTAINER_STATE\" != \"RUNNING\" ] \n     then \n     exit 1 \n     else \n     exit 0 \n     fi \n     root@ubuntu:/etc/monit#\n\n    ```", "```\n     root@ubuntu:/etc/monit# cat alert.sh \n     #!/bin/bash \n     echo \"LXC container down\" | mail -s \"LXC container Alert\" \n          youremail@example.com \n     root@ubuntu:/etc/monit#\n\n    ```", "```\n     root@ubuntu:/etc/monit# monit reload \n     Reinitializing monit daemon \n     The Monit daemon 5.16 uptime: 15h 43m \n     root@ubuntu:/etc/monit# monit status container_status \n     The Monit daemon 5.16 uptime: 15h 47m \n     Program 'container_status' \n     status Status ok \n     monitoring status Monitored \n     last started Fri, 18 Nov 2016 15:03:24 \n     last exit value 0 \n     data collected Fri, 18 Nov 2016 15:03:24 \n     root@ubuntu:/etc/monit#\n\n    ```", "```\n     root@ubuntu:/etc/monit# lxc-stop --name monitor_lxc \n     root@ubuntu:/etc/monit# monit status container_status \n     The Monit daemon 5.16 uptime: 15h 53m \n     Program 'container_status' \n     status Status failed \n     monitoring status Monitored \n     last started Fri, 18 Nov 2016 15:09:24 \n     last exit value 1 \n     data collected Fri, 18 Nov 2016 15:09:24 \n     root@ubuntu:/etc/monit#\n\n    ```", "```\nroot@ubuntu:/etc/monit# tail -5 /var/log/mail.log \nNov 18 15:13:51 ubuntu postfix/pickup[26069]: 8AB30177CB3: uid=0 from=<root@ubuntu> \nNov 18 15:13:51 ubuntu postfix/cleanup[31295]: 8AB30177CB3: message-id=<20161118151351.8AB30177CB3@ubuntu> \nNov 18 15:13:51 ubuntu postfix/qmgr[5392]: 8AB30177CB3: from=<root@ubuntu>, size=340, nrcpt=1 (queue active) \nNov 18 15:13:51 ubuntu postfix/smtp[31297]: 8AB30177CB3: to=< youremail@example.com >, relay=gmail-smtp-in.l.google.com[74.125.70.26]:25, delay=0.22, delays=0.01/0.01/0.08/0.13, dsn=2.0.0, status=sent (250 2.0.0 OK 1479482031 u74si2324555itu.40 - gsmtp) \nNov 18 15:13:51 ubuntu postfix/qmgr[5392]: 8AB30177CB3: removed \nroot@ubuntu:/etc/monit#\n\n```", "```\n     root@ubuntu:~# apt-get -y install redis-server \n     root@ubuntu:~# redis-cli ping \n     PONG \n     root@ubuntu:~#\n\n    ```", "```\n     root@ubuntu:~# apt-get install -y rabbitmq-server\n\n    ```", "```\n     root@ubuntu:~# rabbitmqctl add_vhost /sensu \n     Creating vhost \"/sensu\" ... \n     root@ubuntu:~#\n\n    ```", "```\n     root@ubuntu:~# rabbitmqctl add_user sensu secret \n     Creating user \"sensu\" ... \n     root@ubuntu:~# rabbitmqctl set_permissions -p \n          /sensu sensu \".*\" \".*\" \".*\" \n     Setting permissions for user \"sensu\" in vhost \"/sensu\" ... \n     root@ubuntu:~#\n\n    ```", "```\n     root@ubuntu:~# wget -q \n          https://sensu.global.ssl.fastly.net/apt/pubkey.gpg -O- \n          | sudo apt-key add - \n     OK \n     root@ubuntu:~# echo \n          \"deb https://sensu.global.ssl.fastly.net/apt sensu main\" \n          | sudo tee /etc/apt/sources.list.d/sensu.list \n     deb https://sensu.global.ssl.fastly.net/apt sensu main \n     root@ubuntu:~# apt-get update \n     root@ubuntu:~# apt-get install -y sensu \n     root@ubuntu:~# cd /etc/sensu/conf.d/\n\n    ```", "```\nroot@ubuntu:/etc/sensu/conf.d# cat api.json \n{ \n \"api\": { \n \"host\": \"localhost\", \n \"bind\": \"0.0.0.0\", \n \"port\": 4567 \n } \n} \nroot@ubuntu:/etc/sensu/conf.d# \nroot@ubuntu:/etc/sensu/conf.d# cat transport.json \n{ \n \"transport\": { \n \"name\": \"rabbitmq\", \n \"reconnect_on_error\": true \n } \n} \nroot@ubuntu:/etc/sensu/conf.d# \nroot@ubuntu:/etc/sensu/conf.d# cat rabbitmq.json \n{ \n \"rabbitmq\": { \n \"host\": \"10.208.129.253\", \n \"port\": 5672, \n \"vhost\": \"/sensu\", \n \"user\": \"sensu\", \n \"password\": \"secret\" \n } \n} \nroot@ubuntu:/etc/sensu/conf.d# \nroot@ubuntu:/etc/sensu/conf.d# cat redis.json \n{ \n \"redis\": { \n \"host\": \"localhost\", \n \"port\": 6379 \n } \n} \nroot@ubuntu:/etc/sensu/conf.d# cat client.json \n{ \n \"client\": { \n \"name\": \"ubuntu\", \n \"address\": \"127.0.0.1\", \n \"subscriptions\": [ \n \"base\" \n ], \n \"socket\": { \n \"bind\": \"127.0.0.1\", \n \"port\": 3030 \n } \n } \n} \nroot@ubuntu:/etc/sensu/conf.d#\n\n```", "```\nroot@ubuntu:~# apt-get install -y uchiwa\n\n```", "```\nroot@ubuntu:/etc/sensu/conf.d# cat /etc/sensu/uchiwa.json \n{ \n \"sensu\": [ \n { \n \"name\": \"LXC Containers\", \n \"host\": \"localhost\", \n \"ssl\": false, \n \"port\": 4567, \n \"path\": \"\", \n \"timeout\": 5000 \n } \n ], \n \"uchiwa\": { \n \"port\": 3000, \n \"stats\": 10, \n \"refresh\": 10000 \n } \n} \nroot@ubuntu:/etc/sensu/conf.d#\n\n```", "```\nroot@ubuntu:~# /etc/init.d/sensu-server start \n* Starting sensu-server [ OK ] \nroot@ubuntu:~# /etc/init.d/sensu-api start \n* Starting sensu-api [ OK ] \nroot@ubuntu:/etc/sensu/conf.d# /etc/init.d/sensu-client start \n* Starting sensu-client [ OK ] \nroot@ubuntu:/etc/sensu/conf.d# \nroot@ubuntu:~# /etc/init.d/uchiwa restart \nuchiwa stopped. \nuchiwa started. \nroot@ubuntu:~#\n\n```", "```\nroot@ubuntu:~# lxc-attach --name monitor_lxc \nroot@monitor_lxc:~# apt-get install -y wget \nroot@monitor_lxc:~# wget -q https://sensu.global.ssl.fastly.net/apt/pubkey.gpg -O- | sudo apt-key add - \nOK \nroot@monitor_lxc:~# echo \"deb https://sensu.global.ssl.fastly.net/apt sensu main\" | sudo tee /etc/apt/sources.list.d/sensu.list \ndeb https://sensu.global.ssl.fastly.net/apt sensu main \nroot@monitor_lxc:~# apt-get update \nroot@monitor_lxc:~# apt-get install -y sensu \nroot@monitor_lxc:/# cd /etc/sensu/conf.d/\n\n```", "```\nroot@monitor_lxc:/etc/sensu/conf.d# cat client.json \n{ \n \"client\": { \n \"name\": \"monitor_lxc\", \n \"address\": \"10.0.3.2\", \n \"subscriptions\": [\"base\"] \n } \n} \nroot@monitor_lxc:/etc/sensu/conf.d#\n\n```", "```\nroot@monitor_lxc:/etc/sensu/conf.d# cat rabbitmq.json \n{ \n \"rabbitmq\": { \n \"host\": \"10.0.3.1\", \n \"port\": 5672, \n \"vhost\": \"/sensu\", \n \"user\": \"sensu\", \n \"password\": \"secret\" \n } \n} \nroot@monitor_lxc:/etc/sensu/conf.d#\n\n```", "```\nroot@monitor_lxc:/etc/sensu/conf.d# cat transport.json \n{ \n \"transport\": { \n \"name\": \"rabbitmq\", \n \"reconnect_on_error\": true \n } \n} \nroot@monitor_lxc:/etc/sensu/conf.d#\n\n```", "```\nroot@monitor_lxc:/etc/sensu/conf.d# /etc/init.d/sensu-client start \n* Starting sensu-client [ OK ] \nroot@monitor_lxc:/etc/sensu/conf.d#\n\n```", "```\nroot@monitor_lxc:/etc/sensu/conf.d# apt-get install -y rubygems \nroot@monitor_lxc:/etc/sensu/conf.d# gem search sensu | grep plugins | grep memory \nsensu-plugins-memory (0.0.2) \nsensu-plugins-memory-checks (1.0.2) \nroot@monitor_lxc:/etc/sensu/conf.d#\n\n```", "```\nroot@monitor_lxc:/etc/sensu/conf.d# gem install sensu-plugins-memory-checks \nroot@monitor_lxc:/etc/sensu/conf.d# /etc/init.d/sensu-client restart \nconfiguration is valid \n* Stopping sensu-client [ OK ] \n* Starting sensu-client [ OK ] \nroot@monitor_lxc:/etc/sensu/conf.d#\n\n```", "```\nroot@ubuntu:/etc/sensu/conf.d# cat check_memory.json\n{\n  \"checks\": {\n    \"memory_check\": {\n    \"command\": \"/usr/local/bin/check-memory-percent.rb -w 80 -c 90\",\n    \"subscribers\": [\"base\"],\n    \"handlers\": [\"default\"],\n    \"interval\": 300\n   }\n  }\n}\nroot@ubuntu:/etc/sensu/conf.d#\n\n```", "```\nroot@ubuntu:/etc/sensu/conf.d# /etc/init.d/sensu-server restart \nconfiguration is valid \n* Stopping sensu-server [ OK ] \n* Starting sensu-server [ OK ] \nroot@ubuntu:/etc/sensu/conf.d# /etc/init.d/sensu-api restart \nconfiguration is valid \n* Stopping sensu-api [ OK ] \n* Starting sensu-api [ OK ] \nroot@ubuntu:/etc/sensu/conf.d# /etc/init.d/uchiwa restart \nKilling uchiwa (pid 15299) with SIGTERM \nWaiting uchiwa (pid 15299) to die... \nWaiting uchiwa (pid 15299) to die... \nuchiwa stopped. \nuchiwa started. \nroot@ubuntu:/etc/sensu/conf.d#\n\n```", "```\nroot@ubuntu:/etc/sensu/conf.d# cat check_memory_no_agent.json \n{ \n \"checks\": { \n \"check_memory_no_agent\": { \n \"command\": \"check_memory_no_agent.sh -n monitor_lxc -w 943718400 \n      -e 1048576000\", \n \"standalone\": true, \n \"subscribers\": [ \n \"base\" \n ], \n \"interval\": 300 \n } \n } \n} \nroot@ubuntu:/etc/sensu/conf.d#\n\n```", "```\nroot@ubuntu:/etc/sensu/conf.d# cd ../plugins/ \nroot@ubuntu:/etc/sensu/plugins# cat check_memory_no_agent.sh \n#!/bin/bash \n# Checks memory usage for an LXC container from cgroups \n usage() \n{ \n echo \"Usage: `basename $0` -n|--name monitor_lxc -w|--warning \n  5000 -e|--error 10000\" \n exit 2 \n} \nsanity_check() \n{ \n if [ \"$CONTAINER_NAME\" == \"\" ] || [ \"$WARNING\" == \"\" ] || [ \"$ERROR\" \n  == \"\" ] \n then \n usage \n fi \n} \nreport_result() \n{ \n if [ \"$MEMORY_USAGE\" -ge \"$ERROR\" ] \n then \n echo \"CRITICAL - Memory usage too high at $MEMORY_USAGE\" \n exit 2 \n elif [ \"$MEMORY_USAGE\" -ge \"$WARNING\" ] \n then \n echo \"WARNING - Memory usage at $MEMORY_USAGE\" \n exit 1 \n else \n echo \"Memory Usage OK at $MEMROY_USAGE\" \n exit 0 \n fi \n} \nget_memory_usage() \n{ \n declare -g -i MEMORY_USAGE=0 \n MEMORY_USAGE=$(cat \n  /sys/fs/cgroup/memory/lxc/$CONTAINER_NAME/memory.usage_in_bytes) \n} \nmain() \n{ \n sanity_check \n get_memory_usage \n report_result \n} \nwhile [[ $# > 1 ]] \ndo \n key=$1 \n case $key in \n -n|--name) \n CONTAINER_NAME=$2 \n shift \n ;; \n -w|--warning) \n WARNING=$2 \n shift \n ;; \n -e|--error) \n ERROR=$2 \n shift \n ;; \n *) \n usage \n ;; \n esac \n shift \ndone \nmain \nroot@ubuntu:/etc/sensu/plugins#\n\n```", "```\nroot@ubuntu:/etc/sensu/plugins# chown sensu:sensu check_memory_no_agent.sh \nroot@ubuntu:/etc/sensu/plugins# chmod u+x check_memory_no_agent.sh \nroot@ubuntu:/etc/sensu/plugins# echo \"sensu ALL=(ALL) NOPASSWD:ALL\" > /etc/sudoers.d/sensu \nroot@ubuntu:/etc/sensu/plugins# /etc/init.d/sensu-client restart\n\n```", "```\nroot@ubuntu: ~# wget -q -O - https://pkg.jenkins.io/debian/jenkins-ci.org.key | sudo apt-key add - \nroot@ubuntu:~# sh -c 'echo deb http://pkg.jenkins.io/debian-stable binary/ > /etc/apt/sources.list.d/jenkins.list' \nroot@ubuntu:~# apt-get update \nroot@ubuntu:~# apt-get install jenkins\n\n```", "```\nroot@ubuntu:~# iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-ports 8080 \nroot@ubuntu:~# iptables -t nat -I OUTPUT -p tcp -d 127.0.0.1 --dport 80 -j REDIRECT --to-ports 8080\n\n```", "```\nroot@ubuntu:~# cat /etc/sudoers | grep jenkins \njenkins ALL=(ALL) NOPASSWD:ALL \nroot@ubuntu:~#\n\n```", "```\nroot@ubuntu:~# cat /var/lib/jenkins/secrets/initialAdminPassword \n32702ecf076e439c8d58c51f1247776d \nroot@ubuntu:~#\n\n```", "```\n          set +x\n          echo \"Building new LXC container\"\n          sudo lxc-create --template ubuntu --name $(cat /dev/urandom | \n          tr -cd 'a-z' | head -c 10)\n    ```", "```\nroot@ubuntu:~# curl http://user:password@192.237.167.103:8080/job/LXC%20Provision/build?token=somesupersecrettoken \nroot@ubuntu:~#\n\n```", "```\nroot@ubuntu:~# lxc-ls -f \nNAME STATE AUTOSTART GROUPS IPV4 IPV6 \nifjvdlpvnv STOPPED 0 - - - \nroot@ubuntu:~#\n\n```"]