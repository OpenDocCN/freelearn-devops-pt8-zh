- en: Configuring and Managing Identity Protection
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: After reading about and learning how to configure the monitoring of your identity
    management infrastructure in the previous chapter, we will now dive into identity
    protection. Protecting your identity is one of the main focuses of security today,
    so you should be able to put the right capabilities in place that protect your
    organization against any attack.
  prefs: []
  type: TYPE_NORMAL
- en: 'At the beginning of our identity protection journey, we will start with an
    overview of the Microsoft Cloud services that can help you in this field. We will
    also dive into a number of different services, starting with the theory before
    moving on and applying that theory in an example configuration. After working
    through this chapter, you should be able to identify the correct solution component
    for your existing or future requirements. To summarize, this chapter covers the
    following topics:'
  prefs: []
  type: TYPE_NORMAL
- en: Microsoft Identity Protection solutions
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure ATP and how to use it
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure AD Identity Protection
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using Azure AD **Privileged Identity Management** (**PIM**) to protect administrative
    privileges
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Let's start with an introduction to Microsoft Identity Protection solutions
    so we can maximize problem detection during different attack stages.
  prefs: []
  type: TYPE_NORMAL
- en: Microsoft Identity Protection solutions
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Microsoft has developed and established a huge portfolio of identity protection
    features on both Azure and on-premises to help organizations secure their identities
    and protect themselves against sensitive data leakage. There are many single services
    available, but a unified identity protection solution is expected in the near
    future. We already see many integrations between identity protection services
    that detect, investigate, and prevent advanced attacks, compromised identities,
    and insider threats—including data leakage—to form a broad and deep identity investigation
    solution that works on-premises and in the cloud. Some of the more common attacks
    that are faced by organizations include password spray attacks, leaked or reused
    credentials, spoofed domains, malicious links or attachments, and much more. The
    following figure illustrates the different services often used to maximize the
    detection of attacks in their various stages:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/d2fc75ba-032b-4e2d-a53f-a65f450f40ea.png)'
  prefs: []
  type: TYPE_IMG
- en: Attack vectors and protection products overview
  prefs: []
  type: TYPE_NORMAL
- en: As you can see in the above figure, an attacker first successfully targets patient
    zero with backdoor malware designed to establish command and control. The attacker
    then moves laterally through the network and obtains privileged credentials and
    accesses sensitive systems. During this stage, the Office 365 **Advanced Email
    Threat Protection**, **Windows Defender ATP**, the **Azure ATP**, and **Azure
    AD Identity Protection** should all be in place to protect the identities at stake.
    An attacker will then try to use remote code execution from a local machine to
    a Domain Controller in order to gain access to domain administrator accounts.
  prefs: []
  type: TYPE_NORMAL
- en: It's important at this stage that **Azure ATP** and **Azure AD Privileged Identity
    Management** are used to establish the right controls. After this step, if successful,
    the attacker is free to access sensitive data and open it exfiltrate such information.
    To protect your sensitive data, the **Microsoft Cloud App Security Broker** (**MSCASB**)
    and the **Cloud App Security** service can help you to extend the protection of
    your sensitive data.
  prefs: []
  type: TYPE_NORMAL
- en: 'Now that we''ve had a look at a potential attack scenario and the related technology
    involved, we can dive deeper into each of the related services. We''ll use the **crawl**-**walk**-**run**
    strategy to start, as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Crawl**: First, protect your privileged users and primary environments by:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Enabling Azure MFA for your administrative accounts, or better, using Azure
    AD PIM
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Monitoring your risk reports and using the identity secure store functionality
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Enabling and configuring Azure ATP to protect your primary user domains
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Walk**: Then, protect all users and Domain Controllers by:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Blocking legacy authentication and using conditional access (for more information,
    visit: [https://bit.ly/2M3NXzw](https://bit.ly/2M3NXzw))'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Turning on password hash synchronization in Azure AD Connect and banned password
    checking (for more information, visit: [https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-password-ban-bad](https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-password-ban-bad))
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Protecting all domains and forests using Azure ATP
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Monitoring all Azure ATP alerts and investigating any lateral movements or domain
    dominance alerts
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Run**: Finally, protect all users and integrate the alerts into your security
    operations flow by:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Enabling Azure MFA for your end users using sign-in and the user risk policy
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: In this chapter, we will focus on identity protection technologies that are
    mentioned in the preceding strategy. Other processes will be looked at in [Chapter
    13](bf7343f1-51f5-4e33-a9a6-e6e682e58071.xhtml), *Identifying and Detecting Sensitive
    Data* and [Chapter 8](efbe1917-c755-4449-b29e-fa4a21e819fd.xhtml), *Using the
    Azure AD App Proxy and the Web Application Proxy*. However, now, let's start with
    the Azure ATP service.
  prefs: []
  type: TYPE_NORMAL
- en: Azure ATP and how to use it
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Azure ATP is used to detect and investigate advanced attacks, compromised identities,
    and insider threats. Thanks to behavioral analytics in the backend, it provides
    very fast threat detection and also reduces the fatigue of false positives. Furthermore,
    it provides focused essential information using the Azure ATP attack timeline.
    Azure ATP is simple to work with, and the architecture is quite easy to understand
    because there are only two components per service and a downloadable sensor, which
    monitors local traffic, that is installed directly on your Domain Controllers.
    The sensors use dynamic resource limitation based on the domain controller's load.
  prefs: []
  type: TYPE_NORMAL
- en: There is another, more complex deployment method available, however, which uses
    a standalone sensor on a dedicated server and requires the configuration of port-mirroring
    from the Domain Controllers in order to receive network traffic. The service integrates
    directly with the Microsoft Intelligent Security Graph. You can find more information
    about this functionality at [https://www.microsoft.com/en-us/security/operations/intelligence](https://www.microsoft.com/en-us/security/operations/intelligence).
  prefs: []
  type: TYPE_NORMAL
- en: 'Azure ATP helps you to detect the following advanced attacks:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Reconnaissance attacks, such as:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Account enumeration
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: User group membership enumeration
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: User and IP enumeration
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Host and server name enumeration (DNS)
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Compromised credentials, such as:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Brute force attempts
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Suspicious VPN connections
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Suspicious group membership modifications
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Honey Token account suspicious activity
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Lateral movements, such as:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Pass-the-Ticket
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Pass-the-Hash
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Overpass-the-Hash
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Domain dominance, such as:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Golden Ticket attacks
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: DC shadowing
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Skeleton Key attacks
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Remote code execution on Domain Controllers
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Service creation on Domain Controllers
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: The on-premises product with the most basic features available is Microsoft
    **Advanced Threat Analytics** (**ATA**), which is still supported and in development.
    The cloud service, on the other hand, provides the functionality to protect your
    environment, so we recommend Azure ATP over ATA.
  prefs: []
  type: TYPE_NORMAL
- en: We will now see how to configure Azure ATP in your environment.
  prefs: []
  type: TYPE_NORMAL
- en: You need to have finished [Chapter 1](54c375d9-b7d0-4478-8777-33935239254b.xhtml),
    B*uilding and Managing Azure Active Directory* and [Chapter 2](c0918163-6616-4bdb-aa82-4a65f578d268.xhtml),
    *Understanding Identity Synchronization* to complete the configuration which follows.
  prefs: []
  type: TYPE_NORMAL
- en: 'So, let us get started! To configure Azure ATP, you need to follow the below
    steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Open the link, [https://portal.atp.azure.com/](https://portal.atp.azure.com/),
    in a browser and log on as a global administrator.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Next, create your instance of Azure Advanced Threat Protection, as shown in
    the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/154dfa14-043a-452b-9743-0a8eb750b590.png)'
  prefs: []
  type: TYPE_IMG
- en: Azure ATP creation dialog
  prefs: []
  type: TYPE_NORMAL
- en: 'Before configuring Azure ATP, you need to create a service account in your
    local active directory. Log on to your Domain Controller and open an elevated
    PowerShell and execute the following cmdlet:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: Jump back to the Azure AD portal and follow the configuration instructions.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Now, use the newly-created service account, as shown in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/9742df0a-8f2d-4dab-8f70-29428e7a7c1c.png)'
  prefs: []
  type: TYPE_IMG
- en: Connecting the directory services
  prefs: []
  type: TYPE_NORMAL
- en: 'Afterward, directly deploy your first Azure ATP sensor on your Domain Controller, as
    shown in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/063574e5-a7b8-424e-8529-ab28169f3cce.png)'
  prefs: []
  type: TYPE_IMG
- en: Deploying the Azure ATP agents
  prefs: []
  type: TYPE_NORMAL
- en: Download the setup executable to your Domain Controller and start the installation.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Choose your preferred language and choose the Sensor-only deployment method, as
    shown in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/24f14719-1189-435d-9f98-fc1b99fd5c0d.png)'
  prefs: []
  type: TYPE_IMG
- en: Choosing the sensor type
  prefs: []
  type: TYPE_NORMAL
- en: 'Click Next and Configure the Sensor with the Access key of the portal, as shown
    in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/408899ba-04af-4942-ac9a-2487bad718ef.png)'
  prefs: []
  type: TYPE_IMG
- en: Getting the sensor agent shared key and installation path
  prefs: []
  type: TYPE_NORMAL
- en: 'Finish the installation and open the `services.msc` management console to view
    the newly-installed services, which should include the following two services:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/313a833a-c0de-475e-bd55-e566f45051d2.png)'
  prefs: []
  type: TYPE_IMG
- en: Newly installed services for Azure ATP
  prefs: []
  type: TYPE_NORMAL
- en: 'Next, enable the sensor as a Domain synchronizer to gather the related information
    for Active Directory, as shown in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/838f58b7-8be9-4208-9338-e4cd0711a319.png)'
  prefs: []
  type: TYPE_IMG
- en: Enabling the synchronizer role
  prefs: []
  type: TYPE_NORMAL
- en: 'The next configuration task is the activation of the Suspected Golden Ticket
    usage detection, which can be found under the Preview section, as shown in the
    following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/f0bf5c97-ea95-453e-8bee-265e8509ac31.png)'
  prefs: []
  type: TYPE_IMG
- en: Activation of the golden ticket protection
  prefs: []
  type: TYPE_NORMAL
- en: 'Configure all of the relevant Scheduled reports and notification settings for
    testing its capability, as shown in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/25502508-db0f-4f40-8668-9f0592b3ead8.png)'
  prefs: []
  type: TYPE_IMG
- en: Reporting section overview
  prefs: []
  type: TYPE_NORMAL
- en: 'The Notifications settings page looks like the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/80a930b9-4982-4739-98af-0ba26cdc3444.png)'
  prefs: []
  type: TYPE_IMG
- en: Configuring notifications
  prefs: []
  type: TYPE_NORMAL
- en: Now that you have configured your Azure ATP service, you can use the guidance
    available at [https://gallery.technet.microsoft.com/ATA-Playbook-ef0a8e38](https://gallery.technet.microsoft.com/ATA-Playbook-ef0a8e38)
    to create attacks and test your environment in realistic scenarios. The document
    is written for Microsoft ATA, but you can still use it for testing purposes. You
    can also use the following Azure ATP security alert guide to validate your results: [https://docs.microsoft.com/en-us/azure-advanced-threat-protection/suspicious-activity-guide](https://docs.microsoft.com/en-us/azure-advanced-threat-protection/suspicious-activity-guide).
    In the next section, we will dive into the features of Azure AD Identity Protection.
  prefs: []
  type: TYPE_NORMAL
- en: Azure AD Identity Protection
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Azure AD Identity Protection introduces automatic, risk-based, conditional access
    to help protect users against suspicious logins and compromised credentials. Azure
    AD Identity Protections also offers insight into, and a consolidated view of,
    threat detection based on machine-learning. Furthermore, the service delivers
    an important level of remediation recommendations, as well as performing compromise
    risk calculations about a user and their session. The service requires an Azure
    AD Premium P2 or equivalent licensing.
  prefs: []
  type: TYPE_NORMAL
- en: 'You will get the following capabilities from this service:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Detection**: Vulnerabilities and risky accounts are detected by:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Highlighting vulnerabilities and providing custom recommendations
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Calculating sign-in and user risk levels
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Investigation**: Risk events are investigated and solved by:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Notifications
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: The provision of relevant and contextual information
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Basic workflows used in tracking
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Easy access to remediation actions (for example, a password reset)
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Risk-based conditional access**: It includes:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Risk mitigation, such as blocking sign-ins or requesting multi-factor authentication
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Blocking or securing risky user accounts
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Asking users to register for Azure MFA
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'To get a greater understanding of this service, we need to start configuring
    it. So, login as a global administrator to [https://portal.azure.com](https://portal.azure.com)
    and complete the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Go the Azure AD Identity Protection tab or use the Search option to search the
    service
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Start the on-boarding process by visiting the onboard menu under Settings and
    clicking Create at the bottom of the page, as shown in the following screenshot.
    Follow the process and finish on-boarding:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/829842c8-390b-4eb2-aa7c-18b2cd927aed.png)'
  prefs: []
  type: TYPE_IMG
- en: Azure AD Identity Protection wizard
  prefs: []
  type: TYPE_NORMAL
- en: 'Now jump directly into the Overview section, as shown in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/6e03c8ff-d653-41df-8631-3bd8bae4709e.png)'
  prefs: []
  type: TYPE_IMG
- en: Azure AD Identity Protection portal overview
  prefs: []
  type: TYPE_NORMAL
- en: 'The portal will present you with the relevant risks facing your environment,
    such as:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Users who are not enrolled with Azure MFA
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure AD or Azure resource roles that don't require Azure MFA
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: The assignment of too many global administrator roles
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Now, configure your first scenario by using the following source [https://docs.microsoft.com/en-us/azure/active-directory/identity-protection/quickstart-sign-in-risk-policy](https://docs.microsoft.com/en-us/azure/active-directory/identity-protection/quickstart-sign-in-risk-policy),
    with one of your users
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Next, configure the alerts and weekly digest settings for information about
    the activities in and against your environment
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: After the service is enabled, you can test the functionality of Azure AD Identity
    Protection with the existing playbook, which is available at: [https://docs.microsoft.com/en-us/azure/active-directory/identity-protection/playbook](https://docs.microsoft.com/en-us/azure/active-directory/identity-protection/playbook).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'As you can see, running Azure AD Identity Protection doesn''t require some
    long configuration task. However, we do recommend that you run your tests based
    on the provided playbook and get as much experience as possible:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/13433a3b-161f-4ad5-8312-24e4e3e6977d.png)'
  prefs: []
  type: TYPE_IMG
- en: Identity Secure Score information
  prefs: []
  type: TYPE_NORMAL
- en: 'As shown in the preceding screenshot, the Identity Secure Score provides you
    with information on your identity security position and how it can be improved.
    The service will recommend activating certain security features and following
    specific recommendations, for example:'
  prefs: []
  type: TYPE_NORMAL
- en: Enabling Azure MFA for Azure AD privileged roles
  prefs:
  - PREF_UL
  - PREF_UL
  type: TYPE_NORMAL
- en: Enabling self-service password reset
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Enabling sign-in and user risk policies
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Not allowing the expiration of passwords, or turning on password hash sync if
    you are in a hybrid configuration
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Ensuring all users are enrolled to Azure MFA
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Not using more than five global administrators
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Disabling accounts that have not been used in the last 30 days
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Blocking legacy authentication
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Not allowing users to grant consent to unmanaged applications
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'We will discuss some areas of identity protection in more detail in [Chapter
    6](1f239a9c-c62a-4e40-ab58-ce78cd87e8be.xhtml), *M**anaging Authentication Protocols*
    and [Chapter 13](bf7343f1-51f5-4e33-a9a6-e6e682e58071.xhtml), *Identifying and
    Detecting Sensitive Data*. We will also offer a deep-dive into the Cloud App Security
    service, which provides you with capabilities to protect against the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Malicious insiders**: Protection against disgruntled employees'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Malware**: Detection of malware in cloud storage as soon as they are uploaded'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Rogue applications**: Identification of rogue applications that can access
    your sensitive data'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Compromised accounts**: Combating advanced attackers that leverage compromised
    user credentials'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Data exfiltration**: Detection of unusual flows of data either within or
    outside of your organization'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Ransomware**: Identification of ransomware that uses sophisticated behavioral
    analytics technology'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Now that we have looked at Azure AD Identity Protection, it's time to move on
    to the Azure AD PIM service.
  prefs: []
  type: TYPE_NORMAL
- en: Using Azure AD PIM to protect administrative privileges
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Azure Active Directory **Privileged Identity Management** (**PIM**) provides
    similar functionality to the Microsoft Identity Manager, including **Privileged
    Access Management** (**PAM**) in the on-premises infrastructure.
  prefs: []
  type: TYPE_NORMAL
- en: If you need more information about the on-premises PAM solution, visit [https://docs.microsoft.com/en-us/microsoft-identity-manager/pam/privileged-identity-management-for-active-directory-domain-services](https://docs.microsoft.com/en-us/microsoft-identity-manager/pam/privileged-identity-management-for-active-directory-domain-services).
  prefs: []
  type: TYPE_NORMAL
- en: With Azure AD PIM, you can manage, control, and monitor your privileged identities
    and access to your directory information and resources in an Azure environment. The
    main reason for using Azure AD PIM is to reduce the attack surface and to enable
    administrative access just-in-time. Privileged access is often configured as permanent
    and unmonitored, but with Azure AD PIM you can avoid security breaches and risks.
  prefs: []
  type: TYPE_NORMAL
- en: The service allows you to assign time-bound access to resources using a start
    and end date and that requires approval to activate privileged roles. To protect
    the activation of a role, the service uses Azure Multi-Factor Authentication.
    For example, during the activation process, a user can be forced to justify why
    they need to activate their role. Furthermore, you can also enable notifications
    that alert you when a privileged role is activated. For auditing and compliance
    requirements, you are also able to configure and enable access reviews that ensure
    a user needs a specific role. You can also download an audit history for both
    internal and external audits.
  prefs: []
  type: TYPE_NORMAL
- en: To use Azure AD Privileged Identity Management, you need to own an Azure AD
    Premium P2 license, which is also part of the EMS E5 or Microsoft 365 E5 plan,
    for every privileged account you want to protect. If you don't have access to
    an Azure AD Premium P2 license, protect your permanent privileged accounts with
    Multi-Factor Authentication. To do so, you will need to meet the licensing requirements,
    which are explained in full at [https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-mfa-licensing](https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-mfa-licensing).
  prefs: []
  type: TYPE_NORMAL
- en: Now that we know the basic functionally of Azure AD PIM, let's start with an
    example configuration.
  prefs: []
  type: TYPE_NORMAL
- en: To work through this lab, you must have completed the lab tasks in the first
    chapters, or have your own users already created.
  prefs: []
  type: TYPE_NORMAL
- en: 'The following table illustrates a common example configuration used by many
    companies when they first begin using the cloud:'
  prefs: []
  type: TYPE_NORMAL
- en: '| **Directory role** | **User** |'
  prefs: []
  type: TYPE_TB
- en: '| Global Administrator | `Don.Hall@inovitdemos.ch` |'
  prefs: []
  type: TYPE_TB
- en: '| Global Administrator | `Dan.Jump@inovitdemos.ch` |'
  prefs: []
  type: TYPE_TB
- en: '| Global Administrator | `Chris.Gray@inovitdemos.ch` |'
  prefs: []
  type: TYPE_TB
- en: Keep in mind that unmanaged privileged accounts create a vulnerability that
    can be exploited to access critical systems with sensitive data. Continuously
    randomizing credentials for each account—whether scheduled or in direct response
    to an attack—is the first step to take.
  prefs: []
  type: TYPE_NORMAL
- en: First, let's enable Azure AD PIM on our test tenant and use the default role
    configurations. We need to ensure that it works and to remember to implement a
    breaking-glass account. Afterward, we will be able to gather feedback and adjust
    our configuration as necessary.
  prefs: []
  type: TYPE_NORMAL
- en: Now we will start the configuration by enabling PIM with the Quick Start wizard.
  prefs: []
  type: TYPE_NORMAL
- en: First, log in with your global administrator account at [https://portal.azure.com](https://portal.azure.com)
    and navigate to Azure AD PIM.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/363c3284-32a4-440c-8b0a-92b50aec4138.png)'
  prefs: []
  type: TYPE_IMG
- en: Azure AD PIM - Quick Start options
  prefs: []
  type: TYPE_NORMAL
- en: 'In our case, we use the account `admin@inovitdemos.onmicrosoft.com`, which
    will act as our breaking-glass account:'
  prefs: []
  type: TYPE_NORMAL
- en: A breaking-glass account allows you to modify your configuration even if Azure
    AD PIM, the Multi-Factor Authentication service, or the federation service, is
    not available. Make sure to protect this account and use your Azure AD PIM controlled
    account to administer your environment.
  prefs: []
  type: TYPE_NORMAL
- en: Now enable the service by using Consent to PIM, as shown in the preceding screenshot.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Now verify your identity, as shown in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/d88ee301-8f5c-4096-81e9-8cd63927d9f8.png)'
  prefs: []
  type: TYPE_IMG
- en: Identity verification process
  prefs: []
  type: TYPE_NORMAL
- en: The more information required dialog box appears if Azure MFA hasn't been previously
    enabled.
  prefs: []
  type: TYPE_NORMAL
- en: Fill in and finish the additional security verification dialog.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Click Consent to proceed, as shown in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/e9f1f4f1-552d-4f50-80c0-228f433e3b95.png)'
  prefs: []
  type: TYPE_IMG
- en: Consent to activate the feature
  prefs: []
  type: TYPE_NORMAL
- en: 'Next, select Sign up PIM for Azure AD Roles under the Manage | Azure AD roles
    section, as shown in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/e8df9d6d-16e8-4344-aae7-94390575ccf5.png)'
  prefs: []
  type: TYPE_IMG
- en: Sign up process to PIM
  prefs: []
  type: TYPE_NORMAL
- en: Click Sign up to start the discovery process for administrative roles.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'View your own Active roles in the portal, as shown in the following screenshot,
    including their status:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/84f3bb99-0f76-4497-98b2-d2e1e1c1446b.png)'
  prefs: []
  type: TYPE_IMG
- en: Insides about the active roles
  prefs: []
  type: TYPE_NORMAL
- en: In the next tasks we will add users to roles and test the configuration.
  prefs: []
  type: TYPE_NORMAL
- en: 'Now, return to Azure AD roles page and manually assign the three global administrators
    as eligible admins for the specific Azure AD, as shown in the following screenshot.
    Note that you can also use the Manage | Wizard option to modify your role assignments:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/42120412-8cc8-4bdf-bb8c-5f1d1b0a0580.png)'
  prefs: []
  type: TYPE_IMG
- en: Modification of role assignments
  prefs: []
  type: TYPE_NORMAL
- en: 'Click on Manage | Roles and choose the Global Administrator role, as shown
    in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/8feb8b92-c819-4e23-9481-8d8f0098354b.png)'
  prefs: []
  type: TYPE_IMG
- en: Configuring the Global Administrator role
  prefs: []
  type: TYPE_NORMAL
- en: 'You should see all of the members present, including their assignment type,
    as shown in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/06c2ebd2-ad5b-40e7-a3e4-83a1e5c8d806.png)'
  prefs: []
  type: TYPE_IMG
- en: Assigned roles overview
  prefs: []
  type: TYPE_NORMAL
- en: 'Now edit your three test users so they are eligible by clicking the three dots
    at the end of the user line, as shown in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/9b3bb7ee-a7c7-448c-b10c-6634b68b180b.png)'
  prefs: []
  type: TYPE_IMG
- en: Choosing the assignment type to make him eligible
  prefs: []
  type: TYPE_NORMAL
- en: 'You should end up with the following result:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/c8530b11-838c-42ef-a6f2-2654b9edf757.png)'
  prefs: []
  type: TYPE_IMG
- en: Result of changes
  prefs: []
  type: TYPE_NORMAL
- en: Practical note: Check the description of the role and see what you can do with
    it.
  prefs: []
  type: TYPE_NORMAL
- en: Click on Access reviews to create an access review for a role.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click New.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Choose and fill in the following values because it''s a best practice to start
    with a monthly review:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Review name**: Global Administrator role monthly review'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Description**: Global Administrator role monthly review'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Frequency**: Monthly'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Review role membership**: Global Administrator'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Reviewers**: Selected users'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Select reviewers**: Use your `admin@tenantname.onmicrosoft.com` (PIM role
    administrator)'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Upon completion settings**:'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Auto apply**: Enable'
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Reviewer not responding**: Remove access'
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Leave the remaining default settings and then click Start. You should end up
    with the following result:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/8cd58b0c-9a30-4355-a2b5-5a9e5da5b644.png)'
  prefs: []
  type: TYPE_IMG
- en: Access review overview
  prefs: []
  type: TYPE_NORMAL
- en: Now that we have converted the accounts from permanent to eligible and have
    created our first access review for the Global Administrator role, we will test
    our configuration with Don Hall.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open a new private browser session and navigate to [https://portal.azure.com](https://portal.azure.com).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Log in with `don.hall@yourdomain.com`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Navigate to Azure AD PIM or use the Search option to find it.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Click on My roles. You should find that you are eligible for the Global Administrator
    role, as shown in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/4877f617-d161-4d43-b381-70c51208e0e2.png)'
  prefs: []
  type: TYPE_IMG
- en: View your own roles
  prefs: []
  type: TYPE_NORMAL
- en: Click Activate to use your role. You will need to verify your account before
    proceeding.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click Verify my identity to complete Azure MFA enrollment.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Respond to the verification process and click Activate, as shown in the following
    screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/6dc8cce2-e306-436b-8884-6c851714dce8.png)'
  prefs: []
  type: TYPE_IMG
- en: Activate the global administrator role
  prefs: []
  type: TYPE_NORMAL
- en: 'Note that you can customize activation time; the role is active for 1 hour
    by default. Now, provide an activation reason and click Activate. Then, sign out
    and try your first login as Global Administrator:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/aa4680c3-f9b1-41f9-9798-237fe953183b.png)'
  prefs: []
  type: TYPE_IMG
- en: Proofing the activation
  prefs: []
  type: TYPE_NORMAL
- en: That's it! You've just successfully gained privileged access with Azure AD PIM.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now, sign Don Hall out and log back in with your permanent administrator that
    also has the privileged administrator role assigned.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Click on Activity | Directory roles audit history to find the role activation
    from Don Hall, as shown in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/ccd1aebd-e431-4304-8f1a-5c81f751d4e6.png)'
  prefs: []
  type: TYPE_IMG
- en: Roles audit history
  prefs: []
  type: TYPE_NORMAL
- en: 'Check the following features on the Azure AD roles section to get more experience
    on how to configure Azure AD PIM:'
  prefs: []
  type: TYPE_NORMAL
- en: Go to Tasks | Application Access to verify your role assignment.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Go to Review access to complete a review.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Go to Approve requests if you have configured a role approval; you can do this
    under Manage | Settings | Roles:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](img/554b0540-068f-44de-9195-29614cb85a62.png)'
  prefs: []
  type: TYPE_IMG
- en: Guest Inviter role assignment
  prefs: []
  type: TYPE_NORMAL
- en: Now that we have successfully enabled Azure AD PIM for Azure AD roles, assigned
    and tested our first role, created an access review for the role, and viewed the
    audit history, we're closer to understanding Azure AD Privileged Identity Management.
    (Note that there is an additional lab for Azure resources and other features in
    the code section of the book for this chapter.)
  prefs: []
  type: TYPE_NORMAL
- en: 'To summarize, you should complete the following Azure AD PIM tasks for your
    Azure resources:'
  prefs: []
  type: TYPE_NORMAL
- en: Enable Just in Time access to Azure
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Expire access automatically
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Assign temporary access for quick tasks or on-call schedules
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Get alerts when new users or groups are assigned resource access, or when eligible
    assignments are activated
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Use Azure AD sign in for Azure VMs
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Before we close our section on PIM, we should tell you that Azure AD PIM, and
    Office 365 E5, offer Privileged Access Management functionality for privileged
    tasks and workload roles:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/70300e55-88dd-4e8f-a4b6-7c7d044ee987.png)'
  prefs: []
  type: TYPE_IMG
- en: Office 365 Privileged Identity Management portal
  prefs: []
  type: TYPE_NORMAL
- en: Now that we have configured the Privileged Identity Management and the protection,
    we provide a good state of security to our organization.
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: After completing this chapter, you should be able to explain the main requirements
    when protecting identities and why they're a part of your security solution. In
    this chapter, we looked at the key issues of core identity protection components,
    and how to enable and configure the relevant services for your needs. If you would
    like more information on the Windows Defender ATPservice, check out the [Chapters
    13](bf7343f1-51f5-4e33-a9a6-e6e682e58071.xhtml), *Identifying and Detecting Sensitive
    Data*.
  prefs: []
  type: TYPE_NORMAL
- en: In the next [Chapter 6](1f239a9c-c62a-4e40-ab58-ce78cd87e8be.xhtml), *Managing
    Authentication Protocols*, we will discuss the all-important modern protocols,
    including OAuth 2.0, OpenID Connect, and SAML 2.0, which help you to establish
    a suitable authentication design for your organization and customers.
  prefs: []
  type: TYPE_NORMAL
