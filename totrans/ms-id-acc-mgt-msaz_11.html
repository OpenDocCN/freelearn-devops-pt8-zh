<html><head></head><body><div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Deploying Additional Applications on Azure AD</h1>
                </header>
            
            <article>
                
<p class="mce-root"><span>Providing the correct authentication to your application is essential, particularly if you want to allow authentication only to users from your <strong>Azure Active Directory</strong> (<strong>Azure AD</strong>), or from any other Azure AD. Azure AD provides two concepts to give your users the required authentication.</span></p>
<p class="mce-root"><span>In this chapter, we'll introduce you to the idea of single-tenant and multi-tenant applications and what's different between them. Furthermore, we'll discuss roles and claims in a single-tenant app that we move to a multi-tenant app, and you can test the transition between the two models. We'll also deploy a multi-tenant app that uses OpenID Connect. In all the different labs, you'll learn what you need from an application vendor to integrate the application into your environment. You'll be able to ask the right questions and take your deployment in the right direction.</span></p>
<p>We'll divide the chapter into the following sections:</p>
<ul>
<li>Preparing your lab environment</li>
<li>What defines a single- and <span>multi-tenant</span> application</li>
<li>Deploying a <span>single-tenant</span> application, including roles and claims</li>
<li>Moving the <span>single-tenant</span> app to a <span>multi-tenant</span> scenario</li>
<li>Deploying a <span>multi-tenant</span> app with OpenID Connect</li>
</ul>
<p>As usual, we'll do a lot of practical tasks. Let's organize the prerequisites to handle the labs in your demo environment.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Preparing your lab environment</h1>
                </header>
            
            <article>
                
<p>In this chapter, you can use any machine that has Visual Studio installed. In our case, we installed it on the <strong>YD1APP01</strong> server. This should be your perfect development environment. You will use <strong>Azure AD1: yourdomain1.onmicrosoft.com</strong> during this lab, and one test guest user from another tenant and a test user from any other Azure AD to test <span>multi-tenant</span> applications. Furthermore, you will need to use the code examples from the code package to use it in your Visual Studio to configure and run the applications:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/321ae050-3c23-482d-b159-b3ec9dee23a6.png" width="1104" height="779"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Lab environment overview</div>
<p>After preparing our lab environment, we can directly jump into the first section of the chapter, which describes single- and <span>multi-tenant</span> applications.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">What defines single- and multi-tenant applications</h1>
                </header>
            
            <article>
                
<p>On the face of it, there's a simple explanation of what a <span>single-tenant</span> or a <span>multi-tenant</span> application is. We can say that s<span>ingle-tenant apps are only available in the tenant they were registered</span>. <span>On the other hand, m</span><span>ulti-tenant apps are available to users in both your home tenant and in other tenants:</span></p>
<ul>
<li><span>Single-tenant</span> applications are primarily used if you want to isolate your application from everyone and provide access only to your internal users</li>
<li><span>Multi-tenant</span> applications are used when you want to provide the app to your internal staff, guest users, and Microsoft personal account users in a collaboration scenario, for example</li>
</ul>
<p>We highly recommend reviewing <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-convert-app-to-be-multi-tenant">https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-convert-app-to-be-multi-tenant</a> to find the differences between the endpoints that are used in both scenarios.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Deploying a single-tenant application including roles and claims</h1>
                </header>
            
            <article>
                
<p>In this section, we'll deploy Microsoft's sample, <kbd>WebApp-RoleClaims-DotNet.sln</kbd>, as a <span>single-tenant</span> configuration. We start with this setting and move the application to a <span>multi-tenant</span> application in the next part. The tracker app provides the following application roles, which we can use to test the role/claims topic. First, we can use the admin role to perform all actions. With the writer role, you're empowered to create tasks in the application. To change the status of a task, you can assign the approver role. To view the tasks and their associated states, we can map the observer role.</p>
<p>With the following steps, we'll configure Azure AD for our application:</p>
<ol>
<li>Open the Azure portal: <a href="https://portal.azure.com">https://portal.azure.com</a>.</li>
<li>Navigate to the Azure AD blade.</li>
<li>Click <span class="packt_screen">App registrations</span>.</li>
<li>Create <span class="packt_screen">+New application registration</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/3f10a3df-0769-4df3-8350-4503999fe439.png" style="width:49.00em;height:13.25em;" width="898" height="242"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">New app registration</div>
<ol start="5">
<li>Provide a name.</li>
<li>Add the <span class="packt_screen">Sign-on URL</span>, <kbd>https://localhost:44322/</kbd>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/274b99c5-148c-4a79-aebe-5f5710fd5145.png" style="width:20.92em;height:15.17em;" width="386" height="280"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">App settings dialog</div>
<ol start="7">
<li>Provide the <span class="packt_screen">App ID URI</span> in the format <kbd>https://181031inovitdemos.onmicrosoft.com/trackerapp</kbd>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/4fca9888-4de1-4769-9ede-1d97fe7cd514.png" style="width:18.33em;height:15.50em;" width="338" height="286"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Additional app settings dialog</div>
<ol start="8">
<li>Provide the <span class="packt_screen">Logout URL</span>, <kbd>https://localhost:44322/Account/EndSession</kbd>.</li>
<li>Leave the other settings as the defaults:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/9f925c98-ff94-432a-8f05-d1db1cce812c.png" style="width:19.17em;height:23.50em;" width="354" height="434"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Logout URL configuration</div>
<ol start="10">
<li class="mce-root">Check the <span class="packt_screen">Reply URLs</span>; they need to look like the following figure:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/3470ac25-8ff0-4f14-afaa-2d5e0062f70b.png" style="width:33.17em;height:12.83em;" width="634" height="246"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Reply URL configuration</div>
<ol start="11">
<li>Under <span class="packt_screen">Required permissions, </span>click <span class="packt_screen">Add</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/b9e65e6f-fee7-4614-98d0-45f2154ced9f.png" style="width:48.50em;height:18.17em;" width="882" height="331"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Permission configuration</div>
<ol start="12">
<li>Select the <span class="packt_screen">Microsoft Graph</span> API:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/f3e3880a-5283-43fc-95e3-337cfdc0ab49.png" style="width:35.58em;height:13.50em;" width="563" height="215"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Choosing the Microsoft Graph API</div>
<ol start="13">
<li>Select the following permissions:
<ul>
<li>Sign in and read user profile</li>
<li>Read directory data</li>
</ul>
</li>
</ol>
<div class="packt_tip">You can use the Microsoft Graph permission reference <a href="https://docs.microsoft.com/en-us/graph/permissions-reference">https://docs.microsoft.com/en-us/graph/permissions-reference</a> to learn more about this topic.</div>
<ol start="14">
<li>The selected permissions should look like the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/993ae024-549e-4cc1-96ab-63068e0f2a5a.png" style="width:45.58em;height:19.17em;" width="996" height="419"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Assigning the two needed scopes</div>
<ol start="15">
<li>Save and click <span class="packt_screen">Grant Permissions</span>.</li>
<li><span>Open the</span> <span class="packt_screen">Manifest</span> <span>of the application:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/5e3e52c9-7fef-4ced-92ce-b553ce48eabb.png" style="width:34.33em;height:14.17em;" width="514" height="211"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Configuring the Manifest</div>
<ol start="17">
<li>Configure the roles of the following figure in the <kbd>appRoles</kbd> section with the configuration code of the code package.</li>
</ol>
<ol start="18">
<li>The result in your manifest should look like this:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/a5da5ced-2d13-41f7-8c48-8bcb825ee0c6.png" style="width:39.25em;height:45.08em;" width="628" height="720"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Adding the app roles</div>
<ol start="19">
<li>Save the manifest.</li>
<li>Copy the app ID to Notepad.</li>
</ol>
<ol start="21">
<li>Navigate to your Azure AD tenant's <span class="packt_screen">Properties</span>.</li>
<li>Copy the <span class="packt_screen">Directory ID</span> to Notepad:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/48e45e78-417a-4e42-a631-614b3af06e1e.png" style="width:52.08em;height:40.25em;" width="810" height="626"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Getting the Directory ID</div>
<ol start="23">
<li>Open your Visual Studio and the solution file from the code package named <kbd>WebApp-RoleClaims-DotNet.sln</kbd>.</li>
<li>Open the <kbd>web.config</kbd> file of the solution and do the following:
<ul>
<li>Enter the app ID on the <kbd>ida:ClientId</kbd> value</li>
<li>Enter the <span class="packt_screen">Directory ID</span> on the <kbd>ida:TenantId</kbd> value</li>
</ul>
</li>
</ol>
<ol start="25">
<li>The following result is expected:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/22631920-bbad-4e8e-a429-c1e6d02731e6.png" style="width:32.75em;height:9.17em;" width="683" height="190"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Modifying the web.config file</div>
<ol start="26">
<li>Press <em>F5</em> in Visual Studio to build and run the application.</li>
<li>Sign in as Don Hall:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/ea70e42f-22a3-452c-bb09-33b32b7a9642.png" style="width:72.75em;height:45.58em;" width="1206" height="756"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Testing sign-in functionality</div>
<ol start="28">
<li>Consent to application.</li>
</ol>
<ol start="29">
<li>Click <span class="packt_screen">Accept</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/fd545083-2507-40fa-87c6-defb7d36b5f8.png" style="width:16.08em;height:18.50em;" width="381" height="437"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">OAuth consent</div>
<ol start="30">
<li>Go back to Visual Studio and review the role implementation in the <kbd>TaskController.cs</kbd> file:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/96278c91-08e9-48c6-8492-8eee967bd5d0.png" style="width:42.67em;height:23.75em;" width="1200" height="668"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Reviewing the role implementation in the code</div>
<ol start="31">
<li>Don Hall will be signed in.</li>
<li>Click <span class="packt_screen">About</span> to view the actual roles; no roles are assigned:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/e180636a-415d-425a-aa9b-67aae44f8cfa.png" style="width:19.67em;height:10.83em;" width="396" height="219"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Viewing the actual app roles</div>
<ol start="33">
<li>Go back to your application and assign roles to several test users.</li>
<li>Click <span class="packt_screen">Add user</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/7dfc7226-0619-4db6-93dc-ef84baa60037.png" style="width:62.67em;height:17.25em;" width="903" height="249"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Assigning users and groups</div>
<ol start="35">
<li>Assign the role you want to test:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/e53bbc8f-8210-437b-b448-91fe5d9c0749.png" style="width:35.00em;height:13.92em;" width="554" height="219"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Select the appropriate role</div>
<ol start="36">
<li>In my case, I used two accounts, as you can see in the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/a4efd321-9742-47ec-8d31-59255d8ffe86.png" style="width:53.75em;height:19.42em;" width="898" height="326"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Role assignment result</div>
<ol start="37">
<li>Try to sign in with your users; I started with Ye Xu (Admin role assigned):</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/48f7c0ec-df67-4d9a-9a97-1a58b63c7b22.png" style="width:21.33em;height:15.75em;" width="383" height="284"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Testing sign-in functionality</div>
<ol start="38">
<li>Accept the user consent:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/1cd1d7a4-48e3-4315-a1e8-7ed31bf35625.png" style="width:22.08em;height:25.33em;" width="393" height="449"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Checking and approving the OAuth consent</div>
<ol start="39">
<li>Click <span class="packt_screen">About</span> to view the assigned role. We can see Ye Xu has the <span class="packt_screen">Admin</span> role assigned:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/3c09d085-339c-4df8-9b2b-38919f191073.png" style="width:20.33em;height:12.92em;" width="416" height="265"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Check your current role</div>
<ol start="40">
<li>Try the user with a different role, in my case Dan Jump (<span class="packt_screen">Writer</span> role assigned):</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/cda0ddcf-0ce4-4939-8fe6-1a0473409cd4.png" style="width:21.08em;height:9.83em;" width="373" height="173"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Testing with the second test user</div>
<ol start="41">
<li><span class="packt_screen">Accept</span> the consent:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/7b1e8a0f-9c0f-47d7-8dce-66d39b134d7f.png" style="width:21.67em;height:24.42em;" width="438" height="494"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Checking and approving the OAuth consent</div>
<ol start="42">
<li>You will see the <kbd>Writer</kbd> role is correctly assigned:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/958dec4a-c3b9-48de-ac19-618d0a8c7426.png" style="width:45.83em;height:10.75em;" width="1080" height="254"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">View your current role</div>
<ol start="43">
<li>Try to sign in with a user that's not part of the organization (one from another Azure AD):</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/6dd9e320-8a99-4995-9fdc-7c0812330afc.png" style="width:18.67em;height:13.33em;" width="379" height="272"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Test with a guest user account</div>
<ol start="44">
<li>Remember, we're using a <span>single-tenant</span> configuration at the moment. The user gets an error message and can't sign in:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/9c3f2d69-af11-455e-9910-adc0e578cd81.png" style="width:54.17em;height:26.50em;" width="1255" height="614"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Review the error messages</div>
<p>Our demo app is running and working with role assignments for users of our own Azure AD tenant. Other users from other Azure AD tenants can't access the application right now.</p>
<p>We highly recommend working through the following guidance to customize claims in Azure AD for other protocols, such as SAML:</p>
<ul>
<li>Enterprise role app management: <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-enterprise-app-role-management">https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-enterprise-app-role-management</a></li>
<li>SAML claims customization: <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-saml-claims-customization">https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-saml-claims-customization</a><a href="https://bit.ly/2RaLioz"/></li>
<li>Claims mapping: <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-claims-mapping">https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-claims-mapping</a></li>
<li>Configuring optional claims: <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-optional-claims">https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-optional-claims</a></li>
</ul>
<p>Next, we'll move the app to a <span>multi-tenant</span> configuration.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Moving the single-tenant app to a multi-tenant scenario</h1>
                </header>
            
            <article>
                
<p>In this section, we'll reconfigure the application to work as a <span>multi-tenant</span> application that you can use from other Azure AD tenants or a Microsoft personal account. With the following configuration we migrate the application:</p>
<ol>
<li>Open the <kbd>Startup.cs</kbd> file in your solution:
<ul>
<li>Comment the <kbd>ConfigureAuth(app)</kbd> line</li>
<li>Uncomment the <kbd>ConfigureMultitenantAuth(app)</kbd> line:</li>
</ul>
</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/78eb8bf8-85e9-4657-867f-3ab6b683b34d.png" style="width:46.25em;height:29.42em;" width="847" height="539"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Modifying the code for multi-tenant usage</div>
<ol start="2">
<li>Change the <kbd>ida:TenantId</kbd> value to our Azure AD domain name:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/3e5c9f7d-fdf8-455c-8eb5-d51a164c3c3d.png" style="width:33.83em;height:11.08em;" width="653" height="214"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Changing the tenant ID</div>
<ol start="3">
<li>Press <em>F5</em> in Visual Studio to build and run the app.</li>
<li>A new app will be available in Azure AD, but the users don't have roles assigned:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/23b9da50-8496-4a1e-8c41-22ddcf322104.png" style="width:39.42em;height:16.00em;" width="732" height="297"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Check the role assignment for the newly created app</div>
<ol start="5">
<li>Reassign the roles to the users:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/d5ff0940-45f2-4223-91e5-d84593f6c204.png" style="width:62.83em;height:18.75em;" width="911" height="272"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Reassign roles</div>
<ol start="6">
<li>Test logging in with your users and check the application.</li>
<li>Test logging in with a user from another Azure AD or a Microsoft personal account.</li>
<li>You should be able to log in:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/3278717c-6c88-48d1-a3cc-3651651a50dc.png" width="1171" height="46"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Check the login with the guest user account</div>
<div class="packt_tip packt_infobox">You can find more information about this process at <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-convert-app-to-be-multi-tenant">https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-convert-app-to-be-multi-tenant</a><a href="https://bit.ly/2zuyOT6">.</a></div>
<p>In this section, we reconfigured the application to work as a <span>multi-tenant </span>app and we were victorious! Just note that you need to invite the Microsoft personal account as a guest user to work with your app. Next, we'll deploy another <span>multi-tenant</span> app with OpenID Connect to show you another implementation.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Deploying another multi-tenant app with OpenID Connect</h1>
                </header>
            
            <article>
                
<p>In this section, we'll install a <span>multi-tenant</span> app that works with OpenID Connect as an authentication protocol. Working through this sample will help you to deploy the correct app registration inside your Azure AD, and you'll learn what exactly needs to be configured in the application to use your Azure AD as an authentication provider:</p>
<ol>
<li>Open the Azure portal: <a href="https://portal.azure.com">https://portal.azure.com</a>.</li>
<li>Navigate to the Azure AD blade.</li>
<li>Click <span class="packt_screen">App registrations</span>.</li>
<li>Click <span class="packt_screen">+New application registration</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/cc84b054-5081-49b1-a4bc-13e383d82979.png" style="width:42.50em;height:24.17em;" width="748" height="425"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Create a new app registration</div>
<ol start="5">
<li>Provide an application name and the sign-on URL, <kbd>https://localhost:44302/</kbd>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/9d14d671-95ca-4446-9798-344b6c7a5444.png" style="width:19.25em;height:15.00em;" width="303" height="237"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Provide the app properties</div>
<ol start="6">
<li>Copy the <span class="packt_screen">Application ID</span> to Notepad.</li>
</ol>
<ol start="7">
<li>Click <span class="packt_screen">Settings</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/a4b7750e-f5df-4ecd-baa3-dc4a11bbe0a7.png" style="width:32.42em;height:14.17em;" width="566" height="247"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Get the app configuration data</div>
<ol start="8">
<li>Provide the <span class="packt_screen">App ID URI</span> in the format <kbd>https://181031inovitdemos.onmicrosoft.com/MTTodoWebApp</kbd>:<a href="https://181031inovitdemos.onmicrosoft.com/MTTodoWebApp"/></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/e0488640-7171-4023-9e4a-ec7a77022380.png" style="width:19.17em;height:20.00em;" width="311" height="325"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Adding the App ID URI</div>
<ol start="9">
<li>Provide the <span class="packt_screen">Logout URL</span>. The <span class="packt_screen">Home page URL</span> should already be filled in.</li>
<li>Provide the URL in the format <kbd>https://localhost:44302/Account/EndSession</kbd>.</li>
</ol>
<ol start="11">
<li>Click <span><span class="packt_screen">Multi-tenant</span></span><span class="packt_screen">ed</span>: <span class="packt_screen">Yes</span> to use the app as a <span>multi-tenant</span> application:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/039b1796-2bf5-4fba-b2e5-49858854508d.png" style="width:19.00em;height:22.92em;" width="301" height="364"/></p>
<div class="CDPAlignCenter CDPAlign packt_figref">Using the multi-tenant option</div>
<ol start="12">
<li>Configure the correct permissions for the application. Click <span class="packt_screen">Add</span> in the <span class="packt_screen">Required permissions</span> section:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/6a2a2b32-4b82-43cd-95c2-a89b49dbb9b6.png" style="width:54.00em;height:20.25em;" width="882" height="331"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Grant the required permissions</div>
<ol start="13">
<li>Choose the <span class="packt_screen">Microsoft Graph</span> API:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/66168d5c-2f69-4fcb-8748-cf3a22fa0328.png" style="width:35.25em;height:13.58em;" width="563" height="215"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Use the Microsoft Graph API</div>
<ol start="14">
<li>Assign the <span class="packt_screen">Sign in and read user profile</span> permission:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/708cf974-ccc1-4f78-af66-f9b83c8eda46.png" style="width:52.92em;height:14.92em;" width="848" height="238"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Scope assignment</div>
<ol start="15">
<li>Click <span class="packt_screen">Grant permissions</span> that you grant the permissions:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/6f804de4-4aac-46d8-a2ba-b0d95baf60b7.png" style="width:33.75em;height:12.50em;" width="573" height="212"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Grant permission dialog</div>
<ol start="16">
<li>Generate a key and call it <kbd>Key1</kbd>, with a duration of 2 years.</li>
<li>Click <span class="packt_screen">Save</span> and copy the generated key value to Notepad:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/32a43412-6dab-4ead-a7f2-df0d441e1e7b.png" style="width:79.83em;height:26.33em;" width="1120" height="369"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Secret key generation</div>
<ol start="18">
<li>Provide the <span class="packt_screen">Reply URLs</span>.</li>
<li>The following values need to be configured:
<ul>
<li><kbd>https://localhost:44302/</kbd></li>
<li><kbd>https://localhost:44302/Onboarding/ProcessCode</kbd></li>
</ul>
</li>
</ol>
<ol start="20">
<li>Here's the configuration:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/6b3267b2-57c4-4640-84c7-79a5d8757dad.png" style="width:52.33em;height:12.08em;" width="883" height="204"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Reply URLs configuration</div>
<ol start="21">
<li>Open Visual Studio and the <kbd>WebApp-MultiTenant-OpenIDConnect-DotNet.sln</kbd> solution file.</li>
<li>Open the <kbd>web.config</kbd> file of the solution.</li>
<li>Copy the <kbd>Key1</kbd> value to the <kbd>ida:Password</kbd> section.</li>
<li>Copy the application ID to the <kbd>ida:ClientID</kbd> section.</li>
<li>The modified code should look like this:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/f2b73cf2-c6de-4531-a8a2-e024fddd7c4f.png" style="width:35.50em;height:7.92em;" width="740" height="165"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Code modification result</div>
<ol start="26">
<li>Test the <span>multi-tenant</span> functionality. Press <em>F5</em> in Visual Studio to build the solution.</li>
<li>The application should start.</li>
<li>Click <span class="packt_screen">Sign Up</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/5961567e-117c-415a-9a62-9b8fa84b7396.png" style="width:79.58em;height:23.08em;" width="1543" height="448"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">App Sign up process</div>
<ol start="29">
<li><span class="packt_screen">Sign Up</span> with the user Don Hall to see the expected behavior.</li>
<li>You are logged in, as you can see:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/e9a4b70e-8372-4786-a6a0-2e6f87bd4bd0.png" style="width:62.92em;height:16.75em;" width="1176" height="312"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Successfully logging in to the application</div>
<ol start="31">
<li>Create a test item to test the app's functionality. This isn't the critical part; we focus on the authentication:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/bd78752e-7abe-43c0-b810-f436937115cf.png" style="width:41.33em;height:17.00em;" width="687" height="282"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Task creation dialog</div>
<ol start="32">
<li>Try to sign up with your an Azure B2B guest user; you'll need to consent as a user to the app.</li>
</ol>
<ol start="33">
<li class="CDPAlignLeft CDPAlign">Use the admin consent in the sign-up process:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/3de6857a-a23e-4b0b-b62a-481696cbd27a.png" style="width:23.83em;height:25.33em;" width="402" height="427"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Checking and accepting the OAuth consent</div>
<ol start="34">
<li><span class="packt_screen">Accept</span> the consent, and you should be logged in:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/96ea2bcc-b340-4e27-b113-80739779c5c2.png" style="width:46.92em;height:12.67em;" width="1155" height="312"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Successfully logging in to the application</div>
<ol start="35">
<li>Test the application with another user from any Azure AD tenant and you'll get the same experience.</li>
</ol>
<p>Well done! We also see with this <span>multi-tenant</span> application and OpenID Connect implementation.</p>
<p>A final tip: configure the <span class="packt_screen">Graph Explorer</span> for your tenant to work with the Microsoft Graph API, and gather more information about this topic. Visit <a href="https://developer.microsoft.com/en-us/graph/graph-explorer">https://developer.microsoft.com/en-us/graph/graph-explorer</a><a href="https://developer.microsoft.com/en-us/graph/graph-explorer"> and log in as a global admin to your Azure AD:</a></p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/01411cae-6f9c-4539-af6d-8c2477cbc9fa.png" style="width:65.17em;height:50.92em;" width="976" height="763"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Microsoft Graph Explorer application</div>
<p>With all this experience, you can now start analyzing and extending the solutions.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, you learned about single- and <span>multi-tenant</span> applications and the differences between them. You handled both application types in your environment. Furthermore, you discovered roles and claims in both application types, so now you can provide a <strong>role-based access control</strong> (<strong>RBAC</strong>) scenario. With all the other applications you've deployed, you now understand the differences between the different protocols, such as SAML2.0, OAuth2 with the different flow types, and OpenID Connect. You also learned how the <strong>System for Cross-domain Identity Management</strong> (<strong>SCIM</strong>) helps you to provision users (synchronizing) from Azure AD to the application.</p>
<p>In the next chapter, you'll learn how to provide a cloud-based identity management life cycle. We'll focus on how to provide secure and usable authentication and identity management to your users.</p>


            </article>

            
        </section>
    </div>



  </body></html>