<html><head></head><body><div class="preface" title="Preface"><div class="titlepage"><div><div><h1 class="title"><a id="pref06"/>Preface</h1></div></div></div><p>In continuously evolving environments, operations and development teams are increasingly working together, using tools and techniques and sharing a common culture popularized as part of the DevOps movement. From development to production, a common tooling and approach emerged—often borrowed from developers and the agile techniques.</p><p>Now that APIs are everywhere in the datacenter, automation took over every aspect and every step of what used to be a sysadmin or IT job—infrastructure is now basically code, and should be considered as such while working alone in development or in production within a distributed team.</p><p>Learning the most important tools, techniques, and workflows that fit in an infrastructure-as-code description can be a daunting task, and many teams can either be misled or discouraged by the amount of information, change, and knowledge required to switch to infrastructure-as-code.</p><p>This book has been written keeping in mind all those teams that we have met in the past few years through our respective jobs—teams interested in DevOps, automation, and code, sometimes already doing part of it quite well, but willing to discover other tools and techniques, discovering how they could do better by improving the quality of their code, the stability of their infrastructure, the scalability of their services, the speed of their deployments, the efficiency of team work, and the feedback loop.</p><p>This book is a humble attempt to cover everything related to infrastructure-as-code, based on our real-life experience, from development workflows with Vagrant to complex production infrastructure deployments with Terraform or Ansible, from configuration management essentials using Chef and Puppet to advanced Test-Driven Development (TDD) techniques, and thorough infrastructure code coverage testing. It will also give insights and advanced Docker techniques, and much more. Whenever it was possible or relevant, we tried to show alternative ways of doing the same thing with another tool or approach, so that everyone with any prior knowledge of the subject can still find something to learn in any section of the book.</p><p>We hope you'll get much out of this book, and that automating and testing using infrastructure-as-code will be as fun for you as it's been for us to write about.</p><div class="section" title="What this book covers"><div class="titlepage"><div><div><h1 class="title"><a id="ch00lvl1sec02"/>
<span class="strong"><strong>What this book covers</strong></span>
</h1></div></div></div><p>
<a class="link" href="ch01.html" title="Chapter 1. Vagrant Development Environments">Chapter 1</a>, <span class="emphasis"><em>Vagrant Development Environments</em></span>, is all about automated development environments using Vagrant. Launch simple or complex environments, simulate various virtual networking configurations, combine Vagrant and Docker or the Amazon cloud, and hand over the provisioning of virtual machines to Chef and Ansible. All examples are self-contained real-life little projects.</p><p>
<a class="link" href="ch02.html" title="Chapter 2. Provisioning IaaS with Terraform">Chapter 2</a>, <span class="emphasis"><em>Provisioning IaaS with Terraform</em></span>, is everything needed to get started with Terraform on Amazon Web Services, from managed database servers to log handling, storage, credentials, Docker registries, and EC2 instances.</p><p>
<a class="link" href="ch03.html" title="Chapter 3. Going Further with Terraform">Chapter 3</a>, <span class="emphasis"><em>Going Further with Terraform</em></span>, sheds light on some more advanced techniques of using Terraform code, such as dynamic data sources, separate environments, Docker, GitHub or StatusCake integration, team work, and how the code linter works.</p><p>
<a class="link" href="ch04.html" title="Chapter 4. Automating Complete Infrastructures with Terraform">Chapter 4</a>, <span class="emphasis"><em>Automating Complete Infrastructures with Terraform</em></span>, will show and describe complete, real-life Terraform code for infrastructures on Amazon Web Services, Digital Ocean, OpenStack, Heroku, Packet, and Google Cloud. We'll deploy a Docker Swarm cluster on a bare metal CoreOS cluster for containers, an n-tier web infrastructure, or a GitLab + CI combo.</p><p>
<a class="link" href="ch05.html" title="Chapter 5. Provisioning the Last Mile with Cloud-Init">Chapter 5</a>, <span class="emphasis"><em>Provisioning the Last Mile with Cloud-Init</em></span>, explores everything we can do with cloud-init code—file management, server configuration, adding users and keys, repositories and packages, or examples of extensions such as Chef, CoreOS, and Docker.</p><p>
<a class="link" href="ch06.html" title="Chapter 6. Fundamentals of Managing Servers with Chef and Puppet">Chapter 6</a>, <span class="emphasis"><em>Fundamentals of Managing Servers with Chef and Puppet</em></span>, shows the essentials of using Chef code to automate an infrastructure. From the workstation setup to writing our own recipes to managing external cookbooks, this chapter contains it all—we'll manage packages, services, files, dynamic templates, dependencies, relationships, shared data, and more, all using code. Alternative ways of doing similar actions using Puppet code are also shown for you to have a better view of the ecosystem.</p><p>
<a class="link" href="ch07.html" title="Chapter 7. Testing and Writing Better Infrastructure Code with Chef and Puppet">Chapter 7</a>, <span class="emphasis"><em>Testing and Writing Better Infrastructure Code with Chef and Puppet</em></span>, is all about advanced techniques of testing code for quality and sustainability. It also covers unit and integration testing, linters, and tools for Chef and Puppet, so that you'll produce the best infrastructure code possible.</p><p>
<a class="link" href="ch08.html" title="Chapter 8. Maintaining Systems Using Chef and Puppet">Chapter 8</a>, <span class="emphasis"><em>Maintaining Systems Using Chef and Puppet</em></span>, shows advanced features made possible by Chef or Puppet code, such as scheduled convergence, encrypted secrets, environments, live system information retrieval, application deployments, and workflows or practices to be safe.</p><p>
<a class="link" href="ch09.html" title="Chapter 9. Working with Docker">Chapter 9</a>, <span class="emphasis"><em>Working with Docker</em></span>, is about using Docker containers from a developer point of view—choosing a base image, optimizations, tags, versioning, deploying Ruby-on-Rails or Go applications, networking, security, linting, and using our own durable private registry—all using simple Docker instructions—as code.</p><p>
<a class="link" href="ch10.html" title="Chapter 10. Maintaining Docker Containers">Chapter 10</a>, <span class="emphasis"><em>Maintaining Docker Containers</em></span>, is showing more advanced Docker usage for developers and engineers, such as code testing, automated build pipelines and Continuous Integration, automated vulnerability scanning, monitoring, and debugging.</p></div></div>
<div class="section" title="What you need for this book"><div class="titlepage"><div><div><h1 class="title"><a id="ch00lvl1sec03"/>What you need for this book</h1></div></div></div><p>The essential requirement is a computer capable of running a Linux virtual machine and an Internet connection. The author's computers are laptops running Mac OS 10.11 and Fedora 25, with VirtualBox 5, but any other Linux distribution will work as well. Vagrant, Terraform, the Chef Development Kit, and Docker also work on the Windows platform, although this is untested by the authors.</p><p>As we're dealing with Infrastructure-as-a-Service (IaaS) here, also required are valid accounts with Amazon Web Services (AWS), Google Cloud, Digital Ocean, Packet, Heroku, or an OpenStack deployment.</p><p>Through the various chapters of this book, we'll also use free Software-as-a-Service (SaaS) accounts such as GitHub, Travis CI, Docker Hub, Quay.io, Hosted Chef, and StatusCake.</p></div>
<div class="section" title="Who this book is for"><div class="titlepage"><div><div><h1 class="title"><a id="ch00lvl1sec04"/>Who this book is for</h1></div></div></div><p>This book is for DevOps engineers and developers working in cross-functional teams or operations and would like to switch to IAC to manage complex infrastructures.</p></div>
<div class="section" title="Sections"><div class="titlepage"><div><div><h1 class="title"><a id="ch00lvl1sec05"/>Sections</h1></div></div></div><p>In this book, you will find several headings that appear frequently (Getting ready, How to do it…, How it works…, There's more…, and See also).</p><p>To give clear instructions on how to complete a recipe, we use these sections as follows:</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch00lvl2sec02"/>Getting ready</h2></div></div></div><p>This section tells you what to expect in the recipe, and describes how to set up any software or any preliminary settings required for the recipe.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch00lvl2sec03"/>How to do it…</h2></div></div></div><p>This section contains the steps required to follow the recipe.</p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch00lvl2sec04"/>How it works…</h2></div></div></div><p>This section usually consists of a detailed explanation of what happened in the previous section.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch00lvl2sec05"/>There's more…</h2></div></div></div><p>This section consists of additional information about the recipe in order to make the reader more knowledgeable about the recipe.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch00lvl2sec06"/>See also</h2></div></div></div><p>This section provides helpful links to other useful information for the recipe.</p></div></div>
<div class="section" title="Conventions"><div class="titlepage"><div><div><h1 class="title"><a id="ch00lvl1sec06"/>Conventions</h1></div></div></div><p>In this book, you will find a number of text styles that distinguish between different kinds of information. Here are some examples of these styles and an explanation of their meaning.</p><p>Code words in text, database table names, folder names, filenames, file extensions, pathnames, dummy URLs, user input, and Twitter handles are shown as follows: "Include both the NGINX configuration and <code class="literal">docker-compose.yml</code> files from the previous recipe and you're good to go."</p><p>A block of code is set as follows:</p><div class="informalexample"><pre class="programlisting">Vagrant.configure("2") do |config|
  # all your Vagrant configuration here
end</pre></div><p>When we wish to draw your attention to a particular part of a code block, the relevant lines or items are set in bold:</p><div class="informalexample"><pre class="programlisting">    config.vm.provision <span class="strong"><strong>"ansible_local"</strong></span> do |ansible|
<span class="strong"><strong>      ansible.version = "1.9.6"</strong></span>
<span class="strong"><strong>      ansible.install_mode = :pip</strong></span>
      ansible.playbook = "playbook.yml"
    end</pre></div><p>Any command-line input or output is written as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ vagrant plugin list</strong></span>
<span class="strong"><strong>vagrant-vbguest (0.13.0)</strong></span>
</pre></div><p>
<span class="strong"><strong>New terms</strong></span> and <span class="strong"><strong>important words</strong></span> are shown in bold. Words that you see on the screen, for example, in menus or dialog boxes, appear in the text like this: "You can see your newly created security group by logging into the AWS Console and navigating to <span class="strong"><strong>EC2 Dashboard</strong></span> | <span class="strong"><strong>Network &amp; Security</strong></span> | <span class="strong"><strong>Security Groups</strong></span>."</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note01"/>Note</h3><p>Warnings or important notes appear in a box like this.</p></div></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip01"/>Tip</h3><p>Tips and tricks appear like this.</p></div></div></div>
<div class="section" title="Reader feedback"><div class="titlepage"><div><div><h1 class="title"><a id="ch00lvl1sec07"/>Reader feedback</h1></div></div></div><p>Feedback from our readers is always welcome. Let us know what you think about this book—what you liked or disliked. Reader feedback is important for us as it helps us develop titles that you will really get the most out of.</p><p>To send us general feedback, simply e-mail <code class="email">&lt;<a class="email" href="mailto:feedback@packtpub.com">feedback@packtpub.com</a>&gt;</code>, and mention the book's title in the subject of your message.</p><p>If there is a topic that you have expertise in and you are interested in either writing or contributing to a book, see our author guide at <a class="ulink" href="http://www.packtpub.com/authors">www.packtpub.com/authors</a>.</p></div>
<div class="section" title="Customer support"><div class="titlepage"><div><div><h1 class="title"><a id="ch00lvl1sec08"/>Customer support</h1></div></div></div><p>Now that you are the proud owner of a Packt book, we have a number of things to help you to get the most from your purchase.</p><div class="section" title="Downloading the example code"><div class="titlepage"><div><div><h2 class="title"><a id="ch00lvl2sec07"/>Downloading the example code</h2></div></div></div><p>You can download the example code files for this book from your account at <a class="ulink" href="http://www.packtpub.com">http://www.packtpub.com</a>. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p><p>You can download the code files by following these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in or register to our website using your e-mail address and password.</li><li class="listitem">Hover the mouse pointer on the <span class="strong"><strong>SUPPORT</strong></span> tab at the top.</li><li class="listitem">Click on <span class="strong"><strong>Code Downloads &amp; Errata</strong></span>.</li><li class="listitem">Enter the name of the book in the <span class="strong"><strong>Search</strong></span> box.</li><li class="listitem">Select the book for which you're looking to download the code files.</li><li class="listitem">Choose from the drop-down menu where you purchased this book from.</li><li class="listitem">Click on <span class="strong"><strong>Code Download</strong></span>.</li></ol></div><p>Once the file is downloaded, please make sure that you unzip or extract the folder using the latest version of:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">WinRAR / 7-Zip for Windows</li><li class="listitem" style="list-style-type: disc">Zipeg / iZip / UnRarX for Mac</li><li class="listitem" style="list-style-type: disc">7-Zip / PeaZip for Linux</li></ul></div><p>The code bundle for the book is also hosted on GitHub at <a class="ulink" href="https://github.com/PacktPublishing/Infrastructure-as-Code-IAC-Cookbook">https://github.com/PacktPublishing/Infrastructure-as-Code-IAC-Cookbook</a>. We also have other code bundles from our rich catalog of books and videos available at <a class="ulink" href="https://github.com/PacktPublishing/">https://github.com/PacktPublishing/</a>. Check them out!</p></div><div class="section" title="Downloading the color images of this book"><div class="titlepage"><div><div><h2 class="title"><a id="ch00lvl2sec08"/>Downloading the color images of this book</h2></div></div></div><p>We also provide you with a PDF file that has color images of the screenshots/diagrams used in this book. The color images will help you better understand the changes in the output. You can download this file from <a class="ulink" href="https://www.packtpub.com/sites/default/files/downloads/InfrastructureasCode_IAC_Cookbook_ColorImages.pdf">https://www.packtpub.com/sites/default/files/downloads/InfrastructureasCode_IAC_Cookbook_ColorImages.pdf</a>
</p></div><div class="section" title="Errata"><div class="titlepage"><div><div><h2 class="title"><a id="ch00lvl2sec09"/>Errata</h2></div></div></div><p>Although we have taken every care to ensure the accuracy of our content, mistakes do happen. If you find a mistake in one of our books—maybe a mistake in the text or the code—we would be grateful if you could report this to us. By doing so, you can save other readers from frustration and help us improve subsequent versions of this book. If you find any errata, please report them by visiting <a class="ulink" href="http://www.packtpub.com/submit-errata">http://www.packtpub.com/submit-errata</a>, selecting your book, clicking on the <span class="strong"><strong>Errata Submission Form</strong></span> link, and entering the details of your errata. Once your errata are verified, your submission will be accepted and the errata will be uploaded to our website or added to any list of existing errata under the Errata section of that title.</p><p>To view the previously submitted errata, go to <a class="ulink" href="https://www.packtpub.com/books/content/support">https://www.packtpub.com/books/content/support</a> and enter the name of the book in the search field. The required information will appear under the <span class="strong"><strong>Errata</strong></span> section.</p></div><div class="section" title="Piracy"><div class="titlepage"><div><div><h2 class="title"><a id="ch00lvl2sec10"/>Piracy</h2></div></div></div><p>Piracy of copyrighted material on the Internet is an ongoing problem across all media. At Packt, we take the protection of our copyright and licenses very seriously. If you come across any illegal copies of our works in any form on the Internet, please provide us with the location address or website name immediately so that we can pursue a remedy.</p><p>Please contact us at <code class="email">&lt;<a class="email" href="mailto:copyright@packtpub.com">copyright@packtpub.com</a>&gt;</code> with a link to the suspected pirated material.</p><p>We appreciate your help in protecting our authors and our ability to bring you valuable content.</p></div><div class="section" title="Questions"><div class="titlepage"><div><div><h2 class="title"><a id="ch00lvl2sec11"/>Questions</h2></div></div></div><p>If you have a problem with any aspect of this book, you can contact us at <code class="email">&lt;<a class="email" href="mailto:questions@packtpub.com">questions@packtpub.com</a>&gt;</code>, and we will do our best to address the problem.</p></div></div></body></html>