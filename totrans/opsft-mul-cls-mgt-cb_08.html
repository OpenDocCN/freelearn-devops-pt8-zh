<html><head></head><body>
		<div id="_idContainer134">
			<h1 id="_idParaDest-145" class="chapter-number"><a id="_idTextAnchor153"/>8</h1>
			<h1 id="_idParaDest-146"><a id="_idTextAnchor154"/>OpenShift Security</h1>
			<p>Throughout this book, you have been able to follow some important aspects that involve processes, people, and all the technology involved to maintain a powerful, resilient, and fault-tolerant platform. A product of this magnitude with a vast structure, from its creation to customizations that will keep it fully functional, also requires a great division of responsibilities and skills for each step taken.</p>
			<p>Security has always been and will always be a top concern in any enterprise, even more so now with the advent of things such as ransomware, malicious crypto-mining, malware, and other types of attacks. According to a <em class="italic">Gartner</em> study, by 2025, 90% of organizations that don’t control public cloud usage properly will inadvertently share sensitive data. When it comes to Kubernetes security, we also have seen a number of vulnerabilities and attacks recently. In the <em class="italic">Further reading</em> section of this chapter, you can check out some vulnerabilities and security incidents related to Kubernetes that happened in the last few years.</p>
			<p>For this reason, we decided to dedicate an entire chapter to security-related aspects involving OpenShift. The main focus of this chapter is not to be a complete security guide, though, but rather a minimal collection of topics you should consider and review to have a secure container strategy.</p>
			<p>In this chapter, you will find the following topics:</p>
			<ul>
				<li>Container security</li>
				<li>AuthN and AuthZ</li>
				<li>Certificates in OpenShift</li>
				<li>etcd encryption</li>
				<li>Container isolation</li>
				<li>Network isolation</li>
				<li>Red Hat Container Catalog</li>
			</ul>
			<p>Let’s get started!</p>
			<h1 id="_idParaDest-147"><a id="_idTextAnchor155"/>Container security</h1>
			<p>Container adoption grows exponentially, and with<a id="_idIndexMarker519"/> that also the number of vulnerabilities and potential attacks against all the container ecosystem. That being said, security is an important aspect you need to consider in your container strategy. Red Hat is well known for the high level of security of its products, which is one of the characteristics<a id="_idIndexMarker520"/> that has always been a differentiator for them in the industry, since the robust <strong class="bold">Red Hat Enterprise Linux</strong> (<strong class="bold">RHEL</strong>), which was (and still is!) the foundation of the company up to emerging technologies, such as Red Hat OpenShift. They have been named leaders in the container security space due to a number of security features that Red Hat defined as default (and required) with OpenShift that are optional in many other Kubernetes-based platforms, which also makes OpenShift more <a id="_idIndexMarker521"/>secure than other options. One example of it is <strong class="bold">Security-Enhanced Linux</strong> (<strong class="bold">SELinux</strong>), which is always enabled in any OpenShift worker nodes and prevents a number of vulnerabilities and exploits.</p>
			<p class="callout-heading">Did you know?</p>
			<p class="callout">Did you know that there are now probably somewhere about 380,000 Kubernetes <strong class="bold">application programming interfaces</strong> (<strong class="bold">APIs</strong>) open <a id="_idIndexMarker522"/>on the internet for some form of access that are probably exposed to some sort of attack or data leak? That is what <em class="italic">The Shadowserver Foundation</em> found in this research: <a href="https://www.shadowserver.org/news/over-380-000-open-kubernetes-api-servers/">https://www.shadowserver.org/news/over-380-000-open-kubernetes-api-servers/</a>.</p>
			<p class="callout">Interested in seeing more? In this <em class="italic">Container Security</em> report, you will find some great research related to security on Kubernetes: <a href="https://www.kuppingercole.com/reprints/b1e948f62d5394353f996e43a89cde4a#heading8.1">https://www.kuppingercole.com/reprints/b1e948f62d5394353f996e43a89cde4a#heading8.1</a>.</p>
			<p class="callout">Here, you can view the <em class="italic">State of Kubernetes security report</em>: <a href="https://www.redhat.com/en/resources/kubernetes-adoption-security-market-trends-overview">https://www.redhat.com/en/resources/kubernetes-adoption-security-market-trends-overview</a>.</p>
			<p class="callout">You can also consult the <em class="italic">Is the Cloud Secure?</em> <em class="italic">Gartner</em> study at the following link: <a href="https://www.gartner.com/smarterwithgartner/is-the-cloud-secure">https://www.gartner.com/smarterwithgartner/is-the-cloud-secure</a>.</p>
			<p>The key to having a secure environment and applications resides in the ability that a company has to do the following:</p>
			<ul>
				<li><strong class="bold">Control</strong>: Secure the <strong class="bold">application life cycle management</strong> (<strong class="bold">ALM</strong>) to detect and fix <a id="_idIndexMarker523"/>vulnerabilities <a id="_idIndexMarker524"/>before it goes live</li>
				<li><strong class="bold">Protect</strong>: Ability to <a id="_idIndexMarker525"/>assess and protect the platform and infrastructure to avoid vulnerabilities being exploited</li>
				<li><strong class="bold">Detect and respond</strong>: Detect and <a id="_idIndexMarker526"/>mitigate vulnerabilities by limiting their impact on systems and environments</li>
			</ul>
			<p>In the following diagram, you will see some aspects of these three factors we mentioned:</p>
			<div>
				<div id="_idContainer127" class="IMG---Figure">
					<img src="image/B18015_08_01.jpg" alt="Figure 8.1 – Container security strategy "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.1 – Container security strategy</p>
			<p>In this chapter, we will walk through some important things to consider about each of these factors.</p>
			<h2 id="_idParaDest-148"><a id="_idTextAnchor156"/>Control</h2>
			<p>To secure the container software supply <a id="_idIndexMarker527"/>chain, a few common steps can be performed, as follows:</p>
			<ul>
				<li><strong class="bold">Vulnerability analysis</strong>: Scan the container images to find known vulnerabilities. This topic will be covered in detail in <a href="B18015_12.xhtml#_idTextAnchor251"><em class="italic">Chapter 12</em></a>, <em class="italic">OpenShift Multi-Cluster Security</em>.</li>
				<li><strong class="bold">Trusted images and contents</strong>: Do you know everything that is running inside your containers and applications? Every application these days uses many dependencies from different projects, many of them open source. It is crucial to use trusted sources to avoid running compromised base packages and images. Red Hat provides the Red <a id="_idIndexMarker528"/>Hat <strong class="bold">Universal Base Image</strong> (<strong class="bold">UBI</strong>), which is the robust, secure, and stable version of RHEL that you can use as a base for your container images. Red Hat also provides a comprehensive list of certified container images through its Red Hat Container Catalog that are safe to use and maintains a Container Health Index that helps to assess the security risk of a container image.</li>
				<li><strong class="bold">ALM and continuous integration/continuous deployment (CI/CD) pipeline</strong>: Security should be an integral part of your development workflow. A modern development life cycle requires that security be a shared responsibility among all teams, from end to end. <strong class="bold">Development-security-operations</strong> (<strong class="bold">DevSecOps</strong>) is the new<a id="_idIndexMarker529"/> norm, and that means automating security gates to integrate security into the <strong class="bold">development-operations</strong> (<strong class="bold">DevOps</strong>) processes. Things <a id="_idIndexMarker530"/>such as <strong class="bold">integrated development environment</strong> (<strong class="bold">IDE</strong>) plugins and CI/CD pipeline security tasks are must-haves to achieve this.</li>
			</ul>
			<p>Of course, these are only a few items among a much bigger set. It is not the main focus of this book to cover a comprehensive list of security-related aspects, but we will highlight what we consider are some important factors you should take care of with your container strategy.</p>
			<h2 id="_idParaDest-149"><a id="_idTextAnchor157"/>Protect</h2>
			<p>To protect your <a id="_idIndexMarker531"/>platform and infrastructure, it is important to have policies in place for authentication and authorization, deployment, certificate management, compliance assessment, and policy enforcement. Later in this chapter, we will cover in depth the authentication and authorization aspects of an OpenShift cluster.</p>
			<h2 id="_idParaDest-150"><a id="_idTextAnchor158"/>Detect and respond</h2>
			<p>Even with all actions taken to control <a id="_idIndexMarker532"/>and protect the infrastructure, you need to be able to detect and mitigate security risks. It is important, then, to have monitoring practices in place, but also other policies that may limit the impact of any vulnerabilities or breaches such as container and network isolation. In this chapter, you will also see some more information about container and network isolation.</p>
			<p>Let’s start by looking at authentication and authorization in more detail. Continue reading to learn more about them.</p>
			<h1 id="_idParaDest-151"><a id="_idTextAnchor159"/>AuthN and AuthZ</h1>
			<p><strong class="bold">AuthN</strong> and <strong class="bold">AuthZ</strong> are related concepts but with different goals. <strong class="bold">AuthN</strong> is an abbreviation of <strong class="bold">a</strong>uthe<strong class="bold">n</strong>tication and is related to the process to confirm who a user is and validate their credentials to grant access to the <a id="_idIndexMarker533"/>platform. In this process, we deal with <strong class="bold">identity providers</strong> (<strong class="bold">IdPs</strong>) on OpenShift to configure the authentication provider that will check the user credentials, which we will cover shortly.</p>
			<p>In turn, <strong class="bold">AuthZ</strong> stands for <strong class="bold">a</strong>uthori<strong class="bold">z</strong>ation and is directly linked to giving the user only what they really should have access to, after the <a id="_idIndexMarker534"/>authentication process.</p>
			<p>These two concepts are seen as confusing or similar from the point of view of just logging in to OpenShift. To clarify the concepts, we will now discuss the different objects and processes related to authentication and authorization.</p>
			<h2 id="_idParaDest-152"><a id="_idTextAnchor160"/>Authentication</h2>
			<p>OpenShift works with the<a id="_idIndexMarker535"/> following set of objects as part of the authentication process:</p>
			<div>
				<div id="_idContainer128" class="IMG---Figure">
					<img src="image/B18015_08_Table_01.jpg" alt=""/>
				</div>
			</div>
			<p>These are the objects used in OpenShift that, combined, authenticate a user in the platform. In order to understand how authentication works, you need to define IdPs on OpenShift—see more information about them next.</p>
			<h2 id="_idParaDest-153"><a id="_idTextAnchor161"/>IdPs</h2>
			<p>IdPs are entities that integrate OpenShift with authentication providers, with the purpose of creating a chain of<a id="_idIndexMarker536"/> custody over who can log on to the platform. To avoid the privilege of one product over another when it comes to managing users, OpenShift creates a very flexible option that allows multiple IdPs to integrate with OpenShift at the same time.</p>
			<p>The following table contains a list of <a id="_idIndexMarker537"/>supported IdPs allowed for OpenShift integration:</p>
			<div>
				<div id="_idContainer129" class="IMG---Figure">
					<img src="image/B18015_08_Table_02.jpg" alt=""/>
				</div>
			</div>
			<p>In the OpenShift documentation, you will find detailed information about how to configure each of these providers: <a href="https://docs.openshift.com/container-platform/latest/authentication/index.html">https://docs.openshift.com/container-platform/latest/authentication/index.html</a>.</p>
			<p>OpenShift uses a <strong class="bold">role-based access control</strong> (<strong class="bold">RBAC</strong>) model to perform the authorization process and give a user<a id="_idIndexMarker538"/> the appropriate set of permissions they should have, as you will see now.</p>
			<h2 id="_idParaDest-154"><a id="_idTextAnchor162"/>Authorization – RBAC</h2>
			<p>In an RBAC system, you will have a set of permissions represented as a <em class="italic">role</em> that users and groups will use to have those permissions granted. On OpenShift, we have the following objects to <a id="_idIndexMarker539"/>configure RBAC permissions:</p>
			<div>
				<div id="_idContainer130" class="IMG---Figure">
					<img src="image/B18015_08_Table_03.jpg" alt=""/>
				</div>
			</div>
			<p>A role can be either cluster- or local-scoped, which means that it can be applied for all projects or only for a specific project. In the following example, you can see a command to create a <em class="italic">local</em> role that will allow a user to get and update a pod in the namespace test:</p>
			<pre class="source-code">$ oc create role podmgmt --verb=get,update --resource=pod -n test</pre>
			<p>You can check the role created by running the following command:</p>
			<pre class="source-code">$ oc describe role.rbac.authorization.k8s.io/podmgmt -n test
Name:         podmgmt
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
PolicyRule:
  Resources  Non-Resource URLs  Resource Names  Verbs
  ---------  -----------------  --------------  -----
  pods       []                 []              [get update]</pre>
			<p>Similarly, to create<a id="_idIndexMarker540"/> a <em class="italic">cluster</em> role, you need to use the <strong class="source-inline">oc create role</strong> command, like so:</p>
			<pre class="source-code">$ oc create role clusterpodmgmt --verb=get,update --resource=pod</pre>
			<p>To create a role binding to add this role to a user or group, the following commands can be used:</p>
			<pre class="source-code"># For local role bindings
$ oc adm policy add-role-to-user &lt;role&gt; &lt;username&gt; -n &lt;project&gt;
$ oc adm policy add-role-to-group &lt;role&gt; &lt;group&gt; -n &lt;project&gt;
# For cluster role bindings
$ oc adm policy add-cluster-role-to-user &lt;role&gt; &lt;username&gt;
$ oc adm policy add-cluster-role-to-group &lt;role&gt; &lt;group&gt;</pre>
			<p>You can also remove a role from a user or group using the following commands:</p>
			<pre class="source-code"># For local role bindings
$ oc adm policy remove-role-to-user &lt;role&gt; &lt;username&gt; -n &lt;project&gt;
$ oc adm policy remove-role-to-group &lt;role&gt; &lt;group&gt; -n &lt;project&gt;
# For cluster role bindings
$ oc adm policy remove-cluster-role-to-user &lt;role&gt; &lt;username&gt;
$ oc adm policy remove-cluster-role-to-group &lt;role&gt; &lt;group&gt;</pre>
			<p>Continue reading for hints to<a id="_idIndexMarker541"/> troubleshoot issues you may have related to the access-control feature.</p>
			<h2 id="_idParaDest-155"><a id="_idTextAnchor163"/>Access-control troubleshooting</h2>
			<p>It is important you notice that after you change the <a id="_idIndexMarker542"/>cluster OAuth custom resource, the authentication operator will apply the change; due to that, you may observe temporary unavailability of the OpenShift authentication. Allow some minutes for the operator to finish applying the changes.</p>
			<p>Even if you face issues with OpenShift <a id="_idIndexMarker543"/>authentication, we recommend you check out this helpful article: <a href="https://access.redhat.com/articles/5900841">https://access.redhat.com/articles/5900841</a>.</p>
			<h1 id="_idParaDest-156"><a id="_idTextAnchor164"/>Certificates in OpenShift</h1>
			<p>OpenShift uses several different<a id="_idIndexMarker544"/> certificates to make the platform secure. In this section, we will walk through the main certificate chains OpenShift uses. These are presented here:</p>
			<ul>
				<li><strong class="bold">API server</strong>: Certificate used with the <a id="_idIndexMarker545"/>OpenShift API, usually accessible at <strong class="source-inline">https://api. &lt;cluster-name&gt;.&lt;domain&gt;:6443/</strong>.</li>
				<li><strong class="bold">Ingress</strong>: Certificate valid for application’s domain. It is<a id="_idIndexMarker546"/> usually a wildcard certificate for <strong class="source-inline">*.apps.&lt;cluster-name&gt;.&lt;domain&gt;</strong>.</li>
				<li><strong class="bold">Node certificates</strong>: Managed automatically <a id="_idIndexMarker547"/>by the cluster and don’t require any user intervention. Automatically rotated.</li>
				<li><strong class="bold">etcd certificates</strong>: Used to encrypt <a id="_idIndexMarker548"/>communication between etcd cluster members. Automatically managed and rotated by the cluster itself.</li>
			</ul>
			<p>OpenShift creates<a id="_idIndexMarker549"/> self-signed certificates with the platform installation. Most enterprises require those certificates to be replaced by custom certificates. To do so, refer to the OpenShift documentation, as follows:</p>
			<ul>
				<li>To replace the ingress <a id="_idIndexMarker550"/>certificate: <a href="https://docs.openshift.com/container-platform/latest/security/certificates/replacing-default-ingress-certificate.html">https://docs.openshift.com/container-platform/latest/security/certificates/replacing-default-ingress-certificate.html</a></li>
				<li>To replace the API<a id="_idIndexMarker551"/> server: <a href="https://docs.openshift.com/container-platform/4.10/security/certificates/api-server.html">https://docs.openshift.com/container-platform/4.10/security/certificates/api-server.html</a></li>
			</ul>
			<p>If you replace the certificates, you may also need to<a id="_idIndexMarker552"/> add a trusted <strong class="bold">certificate authority</strong> (<strong class="bold">CA</strong>), if you use a private CA. The next section describes how to do this.</p>
			<h2 id="_idParaDest-157"><a id="_idTextAnchor165"/>Trusted CA</h2>
			<p>You may need to add a custom <a id="_idIndexMarker553"/>CA that you use within your organization, to make API calls possible between OpenShift components and other external systems. To do so, you need to create a config map with the certificate chain on the <strong class="source-inline">openshift-config</strong> namespace, like so:</p>
			<pre class="source-code">$ oc create configmap custom-ca \
     --from-file=ca-bundle.crt=&lt;/path/to/example-ca.crt&gt; \
     -n openshift-config</pre>
			<p>Then, update the cluster-wide <a id="_idIndexMarker554"/>proxy to use the config map just created, as follows:</p>
			<pre class="source-code">$ oc patch proxy/cluster \
     --type=merge \
     --patch='{"spec":{"trustedCA":{"name":"custom-ca"}}}'</pre>
			<p>One important piece of any Kubernetes cluster is the etcd database. You may decide to encrypt it to keep secrets and other objects encrypted in the database. Check out next how to do this.</p>
			<h1 id="_idParaDest-158"><a id="_idTextAnchor166"/>etcd encryption</h1>
			<p>The etcd database, by default, is not encrypted. However, you can easily enable etcd encryption to have an extra layer of <a id="_idIndexMarker555"/>data security in your cluster. When etcd encryption is enabled, things such as secrets and config maps are stored encrypted, which makes your cluster even more secure.</p>
			<p>To enable etcd encryption, proceed as follows:</p>
			<ol>
				<li>Edit the <strong class="source-inline">apiserver</strong> object, like so:<p class="source-code">$ oc edit apiserver</p></li>
				<li>Set the <strong class="source-inline">encryption</strong> field, as follows:<p class="source-code">spec:</p><p class="source-code"><strong class="bold">  encryption:</strong></p><p class="source-code"><strong class="bold">    type: aescbc</strong></p></li>
				<li>Save the file to apply the changes.</li>
			</ol>
			<p>Note that it may take up to 15 minutes or so to enable the encryption after you have applied the changes.</p>
			<h1 id="_idParaDest-159"><a id="_idTextAnchor167"/>Container isolation</h1>
			<p>We already discussed aspects such as user authentication and permissions, as well as certificates, but how do you make sure <a id="_idIndexMarker556"/>your containers can only do what they are supposed to do and nothing more, and as such, cannot escalate privileges on the host?</p>
			<p>We are going to discuss in this section some of the concepts implemented as part of the <strong class="bold">operating system</strong> (<strong class="bold">OS</strong>) to securely run <a id="_idIndexMarker557"/>containers and also some aspects implemented on OpenShift related to this.</p>
			<p>In the following table, you<a id="_idIndexMarker558"/> see some concepts related<a id="_idIndexMarker559"/> to containers:</p>
			<div>
				<div id="_idContainer131" class="IMG---Figure">
					<img src="image/B18015_08_Table_04.jpg" alt=""/>
				</div>
			</div>
			<p>In the following diagram, you can see a graphical representation of these concepts:</p>
			<div>
				<div id="_idContainer132" class="IMG---Figure">
					<img src="image/B18015_08_02.jpg" alt="Figure 8.2 – Container isolation"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.2 – Container isolation</p>
			<p>While it is important to<a id="_idIndexMarker560"/> understand these concepts, you don’t really need to work directly with any of them, as OpenShift abstracts those configurations for you. Instead, you need to understand what <strong class="bold">security context constraints</strong> (<strong class="bold">SCCs</strong>) are—these are the objects you will need to use to give broader permissions to containers when needed. Read on to find out what SCCs are and how to configure them.</p>
			<h2 id="_idParaDest-160"><a id="_idTextAnchor168"/>SCCs</h2>
			<p>SCCs are OpenShift objects that <a id="_idIndexMarker561"/>control the actions that a pod or container can do with <a id="_idIndexMarker562"/>the host resources. By default, any pod uses the <strong class="bold">restricted</strong> SCC, which is the most restricted permission that prevents it from running as root and escalating privileges on the host. Besides the restricted SCC, the most usual ones are noted here:</p>
			<ul>
				<li><strong class="source-inline">anyuid</strong>: This has the <a id="_idIndexMarker563"/>same permissions as the restricted SCC, allowing a container to run as any <strong class="bold">unique identifier</strong> (<strong class="bold">UID</strong>) and <strong class="bold">group ID</strong> (<strong class="bold">GID</strong>), though that <a id="_idIndexMarker564"/>means the container can also use the <strong class="source-inline">0</strong> UID—the root user.</li>
				<li><strong class="source-inline">hostaccess</strong>: Gives permissions for a container to access all host namespaces. It should be used only with trusted sources as it gives very broad permissions within a worker node—use only if really necessary.</li>
				<li><strong class="source-inline">hostnetwork</strong>: Allows a container to access the worker node underlying the network directly. Use with caution to decrease the risk of a network breach.</li>
				<li><strong class="source-inline">privileged</strong>: Most relaxed SCC and gives all privileges to the host. Should be avoided at all costs and used only if really necessary.</li>
			</ul>
			<p>Besides all the security-related features we already covered so far, we cannot miss a very important topic: network policies. A network policy is a great feature to make sure your pods and projects can only communicate with what they are supposed to. In the following section, you will see what you can do with network policies and why they are so important when it comes to network security.</p>
			<h1 id="_idParaDest-161"><a id="_idTextAnchor169"/>Network isolation</h1>
			<p>Firewalls are well known and have <a id="_idIndexMarker565"/>been used for a long time in any kind of infrastructure. When it comes to OpenShift, we need to have in mind that we are now working with a software-defined platform and, as such, we have software features to implement some of the same concepts we have had for a long time in a data center—it is no different with a firewall. As we have seen in the previous chapter, Network Policies are nothing more than rules you define to allow or block network communication between pods and projects on OpenShift, similar to what a firewall provides in a physical network.</p>
			<p>By default, all pods in a project are accessible from other pods and network endpoints from any project. To isolate pods <a id="_idIndexMarker566"/>and projects, you need to create network policies, such as the following:</p>
			<pre class="source-code">kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  name: deny-by-default
spec:
<strong class="bold">  podSelector: {}</strong>
<strong class="bold">  ingress: []</strong></pre>
			<p>The previous network policy denies all traffic for pods in a project. In order for a project to be accessed from outside the cluster using the OpenShift ingress, you will need to allow connections from the ingress project, as you can see in the following snippet:</p>
			<pre class="source-code">apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-from-openshift-ingress
spec:
  ingress:
  - from:
<strong class="bold">    - namespaceSelector:</strong>
<strong class="bold">        matchLabels:</strong>
<strong class="bold">          network.openshift.io/policy-group: ingress</strong>
  podSelector: {}
  policyTypes:
  - Ingress</pre>
			<p>You may also create custom network policies using labels for specific pods. For instance, the following YAML Ain’t Markup Language (YAML) could be <a id="_idIndexMarker567"/>used to limit pods with an <strong class="source-inline">app=web</strong> label to be accessed on the accessed on the HTTPS port (<strong class="source-inline">443</strong>) only<strong class="bold"> </strong>port <a id="_idIndexMarker568"/>only:</p>
			<pre class="source-code">kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  name: allow-https
spec:
  podSelector:
    matchLabels:
      <strong class="bold">app: web</strong>
  ingress:
<strong class="bold">  - ports:</strong>
<strong class="bold">    - protocol: TCP</strong>
<strong class="bold">      port: 443</strong></pre>
			<p>There is a world of possibilities for using network policies to set your projects and pods with proper network access. A <a id="_idIndexMarker569"/>common and recommended practice is to create a set of standard network policies and configure the OpenShift template so that those network policies will be automatically applied to any new projects created. You can find out how to customize the OpenShift template to add those network policies in the OpenShift documentation: <a href="https://docs.openshift.com/container-platform/latest/networking/network_policy/default-network-policy.html">https://docs.openshift.com/container-platform/latest/networking/network_policy/default-network-policy.html</a>.</p>
			<p>Another important thing you may consider in your security strategy is about using safe container base images. The following section covers what the Red Hat Container Catalog is and how it can help you with this important topic.</p>
			<h1 id="_idParaDest-162"><a id="_idTextAnchor170"/>Red Hat Container Catalog</h1>
			<p>Most enterprises, at some point, need to use containers from different sources, either as off-the-shelf products or only as dependencies for workloads. Red Hat has an interesting tool that aims to <a id="_idIndexMarker570"/>help you to make sure you use secure containers. The Red Hat Container Catalog is a repository of container images that have been tested and certified by Red Hat and partners, and therefore are trusted images.</p>
			<p>As part of the Container Catalog, Red Hat provides the Container Health Index. The Container Health Index is a rating system for container images available in the Red Hat Container Catalog, which goes from Grade A to F, in which Grade A is the most up-to-date image in terms of critical errata. You can find all the grades available and how they are defined at this link: <a href="https://access.redhat.com/articles/2803031">https://access.redhat.com/articles/2803031</a>. This feature helps a lot to assess the security risk you are associated with when using a certain image version.</p>
			<p>In the Red Hat Container Catalog, you can find the Red Hat UBI, which may comprise an important aspect of your container strategy. You'll find out more about this next.</p>
			<h2 id="_idParaDest-163"><a id="_idTextAnchor171"/>Red Hat UBI</h2>
			<p>Defining a base image for your<a id="_idIndexMarker571"/> containers is an important step that you need to consider to have a portable and secure container delivery process. Depending on<a id="_idIndexMarker572"/> the decision you make, you may see yourself locked in some specific Linux versions and distributions that the container base image supports. The base image is also critical to keep your workloads secure—many vulnerabilities are found every week on Linux, but they are usually fixed really fast, using a mature and robust base image such as RHEL which is fundamental in keeping your workloads more secure.</p>
			<p>Red Hat UBI is based on RHEL, available at no additional cost, and has a minimal footprint (something between 10 <strong class="bold">megabytes</strong> (<strong class="bold">MB</strong>) and 100 MB, depending on the image type). There are four image types you can choose from, depending on your needs, as outlined here:</p>
			<div>
				<div id="_idContainer133" class="IMG---Figure">
					<img src="image/B18015_08_Table_05.jpg" alt=""/>
				</div>
			</div>
			<p>Besides the options mentioned, Red Hat also provides some UBIs with language runtimes included, such as <a id="_idIndexMarker573"/>Node.js, .NET, and Java. All the base images are available for download from the Red Hat Container Catalog.</p>
			<p>Once you have a list of<a id="_idIndexMarker574"/> trusted sources that contain secure container images, we recommend you limit OpenShift to only running images from these trusted sources. You'll see next how to do this.</p>
			<h2 id="_idParaDest-164"><a id="_idTextAnchor172"/>Limiting image registry sources</h2>
			<p>You can easily block or allow<a id="_idIndexMarker575"/> image registries that OpenShift can use with the following procedure:</p>
			<ol>
				<li value="1">Run the following command to edit the <strong class="source-inline">image.config.openshift.io/cluster</strong> object:<p class="source-code">$ oc edit image.config.openshift.io/cluster</p></li>
				<li>In the object’s YAML, set the <strong class="source-inline">allowedRegistriesForImport</strong> and <strong class="source-inline">registrySources</strong> fields with the desired image registries. <strong class="source-inline">AllowedRegistriesForImport</strong> defines the image registries to which a user can import images using image streams (the <strong class="source-inline">oc import-image</strong> command). In the <strong class="source-inline">registrySources</strong> block, you can define allowed registries (<strong class="source-inline">allowedRegistries</strong>) or blocked registries (<strong class="source-inline">blockedRegistries</strong>), but not both. Have a look at <a id="_idIndexMarker576"/>the following example:<p class="source-code">spec:</p><p class="source-code"><strong class="bold">  allowedRegistriesForImport:</strong></p><p class="source-code"><strong class="bold">    - domainName: quay.io</strong></p><p class="source-code"><strong class="bold">      insecure: false</strong></p><p class="source-code">  additionalTrustedCA:</p><p class="source-code">    name: myconfigmap</p><p class="source-code">  registrySources:</p><p class="source-code"><strong class="bold">    allowedRegistries:</strong></p><p class="source-code"><strong class="bold">    - quay.io</strong></p><p class="source-code"><strong class="bold">    - registry.redhat.io</strong></p><p class="source-code"><strong class="bold">    - image-registry.openshift-image-registry.svc:5000</strong></p><p class="source-code">    insecureRegistries:</p><p class="source-code">    - insecure-reg.com</p></li>
			</ol>
			<p>This concludes the main security aspects that we believe any company needs to think about. We encourage you to carefully review the topics we covered in this chapter and define/implement policies to keep all your clusters secure.</p>
			<h1 id="_idParaDest-165"><a id="_idTextAnchor173"/>Summary</h1>
			<p>We have seen in this chapter some of the things you may consider to have secure OpenShift clusters. While OpenShift is considered a secure platform based on Kubernetes, how you manage it, of course, matters a lot. Consider establishing policies for access control, certificates, container and network isolation, development, and CI/CD pipelines.</p>
			<p>A secure platform starts with proper planning to define and implement efficient policies to control what is being developed and deployed into the platform, protect it against unnecessary risks, and—finally—isolate workloads and networks as much as possible to mitigate the impacts that a breach could have on the environment. In <a href="B18015_11.xhtml#_idTextAnchor229"><em class="italic">Chapter 11</em></a>, <em class="italic">OpenShift Multi-Cluster GitOps and Management</em>, you will see how to use Advanced Cluster Management to apply policies at scale to several clusters and make sure that all of them are compliant and safe, no matter where they are running.</p>
			<p>In the next chapter, we will explore how to work with Kubernetes native pipelines on OpenShift using the Tekton project, which you can use to not only have a cloud-native CI/CD process to build and deploy your application but also add an extra layer of security in your application supply chain.</p>
			<h1 id="_idParaDest-166"><a id="_idTextAnchor174"/>Further reading</h1>
			<p>If you want more information related to the concepts we covered in this chapter, check out the following references:</p>
			<ul>
				<li><em class="italic">Is the Cloud Secure?</em>—<em class="italic">Gartner</em> study: <a href="https://www.gartner.com/smarterwithgartner/is-the-cloud-secure">https://www.gartner.com/smarterwithgartner/is-the-cloud-secure</a></li>
				<li><em class="italic">Kubernetes vulnerabilities and attacks reported</em>:<ul><li><a href="https://thenewstack.io/unfixable-kubernetes-security-hole-means-potential-man-in-the-middle-attacks/">https://thenewstack.io/unfixable-kubernetes-security-hole-means-potential-man-in-the-middle-attacks/</a></li>
<li><a href="https://threatpost.com/kubernetes-cyberattacks-argo-workflows/167997/">https://threatpost.com/kubernetes-cyberattacks-argo-workflows/167997/</a></li>
</ul></li>
				<li><em class="italic">Most Common Kubernetes Security Issues and Concerns to Address </em>(blog post): <a href="https://cloud.redhat.com/blog/most-common-kubernetes-security-issues-and-concerns-to-address">https://cloud.redhat.com/blog/most-common-kubernetes-security-issues-and-concerns-to-address</a></li>
				<li><em class="italic">Container Security</em> report: <a href="https://www.kuppingercole.com/reprints/b1e948f62d5394353f996e43a89cde4a#heading8.1">https://www.kuppingercole.com/reprints/b1e948f62d5394353f996e43a89cde4a#heading8.1</a></li>
				<li><em class="italic">State of Kubernetes security report</em>: <a href="https://www.redhat.com/en/resources/kubernetes-adoption-security-market-trends-overview">https://www.redhat.com/en/resources/kubernetes-adoption-security-market-trends-overview</a></li>
				<li><em class="italic">OpenShift authentication guide</em>: <a href="https://docs.openshift.com/container-platform/latest/authentication/index.html">https://docs.openshift.com/container-platform/latest/authentication/index.html</a></li>
				<li><em class="italic">Troubleshooting OpenShift authentication</em>:<em class="italic"> </em><a href="https://access.redhat.com/articles/5900841">https://access.redhat.com/articles/5900841</a></li>
				<li><em class="italic">Defining default network policies</em>: <a href="https://docs.openshift.com/container-platform/4.10/networking/network_policy/default-network-policy.html">https://docs.openshift.com/container-platform/4.10/networking/network_policy/default-network-policy.html</a></li>
				<li><em class="italic">Red Hat Universal Base Images</em>: <a href="https://developers.redhat.com/products/rhel/ubi">https://developers.redhat.com/products/rhel/ubi</a></li>
				<li><em class="italic">Container Health Index grades</em>: <a href="https://access.redhat.com/articles/2803031 ">https://access.redhat.com/articles/2803031</a></li>
				<li><em class="italic">Detailed information about</em> <strong class="source-inline">htpasswd</strong> (Apache project): <a href="https://httpd.apache.org/docs/2.4/programs/htpasswd.html">https://httpd.apache.org/docs/2.4/programs/htpasswd.html</a></li>
				<li><em class="italic">OpenID Connect</em>:<em class="italic"> </em><a href="https://developers.google.com/identity/protocols/oauth2/openid-connect">https://developers.google.com/identity/protocols/oauth2/openid-connect</a></li>
				<li><em class="italic">Container isolation</em>: <a href="https://www.nginx.com/blog/what-are-namespaces-cgroups-how-do-they-work/">https://www.nginx.com/blog/what-are-namespaces-cgroups-how-do-they-work/</a></li>
			</ul>
		</div>
		<div>
			<div id="_idContainer135">
			</div>
		</div>


		<div>
			<div id="_idContainer136" class="Basic-Graphics-Frame">
			</div>
		</div>
		<div>
			<div id="_idContainer137">
			</div>
		</div>
		<div id="_idContainer138" class="Content">
			<h1 id="_idParaDest-167"><a id="_idTextAnchor175"/>Part 3 – Multi-Cluster CI/CD on OpenShift Using GitOps</h1>
			<p>In this part, you will be introduced to new concepts and technologies related to CI/CD and GitOps. You will learn how to build CI/CD pipelines that are resilient to your enterprise strategy and designed to easily be maintained using Tekton and ArgoCD. You will also see how to deploy an application into multiple clusters at the same time as using Argo CD and Advanced Cluster Management.</p>
			<p>This part of the book comprises the following chapters:</p>
			<ul>
				<li><a href="B18015_09.xhtml#_idTextAnchor176"><em class="italic">Chapter 9</em></a>, <em class="italic">OpenShift Pipelines – Tekton</em></li>
				<li><a href="B18015_10.xhtml#_idTextAnchor204"><em class="italic">Chapter 10</em></a>, <em class="italic">OpenShift GitOps – Argo CD</em></li>
				<li><a href="B18015_11.xhtml#_idTextAnchor229"><em class="italic">Chapter 11</em></a>, <em class="italic">OpenShift Multi-Cluster GitOps and Management</em></li>
			</ul>
		</div>
</body></html>