<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Networking</h1>
                </header>
            
            <article>
                
<p>Amazon ECS is a managed service for containerized applications based on Docker containers. Managed service implies that ECS manages all container orchestration aspects including launching a cluster of virtual machines (EC2 instances), creating and scheduling containers on the virtual machines, and scaling the cluster of VMs.</p>
<p><strong>Problem: </strong>Amazon ECS runs Docker containers on virtual machines (EC2 instances). The EC2 launch type incurs an overhead of launching and managing a cluster of virtual machines (EC2 instances). As a primer on ECS, a task definition defines a group of containers (container definitions). A container definition defines a name, Docker image, port mappings, entry point, and command. Resources (CPU and memory) are defined at both the task and container level. A service definition defines a service and consists of a task definition, launch type, load balancers, network configuration, deployment configuration, and deployments. <span>The ECS cluster with the EC2 launch type is as follows:</span></p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/03493ca7-76e6-497e-bb3a-1b2121bc3cc7.png" style="width:31.58em;height:21.50em;"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref"><span>The ECS cluster with the EC2 launch type</span></div>
<p><strong>Solution: </strong>Amazon Fargate has introduced serverless ECS and does not run VMs. The fundamental infrastructure with Fargate is the Fargate platform . A user does not manage the underlying instances, which makes Fargate an <strong>Infrastructure as a Service</strong> (<strong>IaaS</strong>). The main benefit of Fargate is that a user does not have to manage any servers. A user does not provision, configure, and scale clusters of VMs. With Fargate, a user does not create or manage any EC2 instances and does not manage cluster capacity and scheduling. A user only has to define the application resource requirements in terms of the CPU and memory of a container and a task, and Fargate manages the scaling as the requirements fluctuate. With the Fargate launch type, ECS is still integrable with all the same AWS services, which include IAM, VPC, and CloudWatch, as it is with the EC2 launch type. The EC2 launch type option is still available. The ECS cluster with the Fargate launch type is illustrated in the following diagram. The only supported networking mode with the Fargate launch type is <kbd>awsvpc</kbd>, and an elastic network interface for a task is created in a VPC to provide access to the task. An ECS cluster may consist of Fargate-managed tasks in multiple availability zones for high availability:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/11872c88-fbf8-4faf-bd0d-a3005c2201d1.png" style="width:33.50em;height:30.08em;"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign"><span>ECS cluster with the Fargate launch type </span></div>
<p class="mce-root">With the introduction of the Fargate launch type, some of the settings in a task definition, container definition, and service definition are different to the EC2 launch type. The Fargate-related configuration parameters are discussed in subsequent sections. </p>
<p><span>In this chapter, we will learn about the following:</span></p>
<ul>
<li>Creating an ECS cluster</li>
<li>Configuring a container definition</li>
<li>Configuring a task definition</li>
<li>Configuring a service</li>
<li>Configuring and creating a cluster</li>
<li>Running an additional task</li>
<li>Accessing the service</li>
<li>Deleting a cluster</li>
</ul>
<p>The only prerequisite is an AWS account, which may be created at <a href="https://aws.amazon.com/resources/create-account/">https://aws.amazon.com/resources/create-account/</a>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating an ECS cluster and service</h1>
                </header>
            
            <article>
                
<p>Select Amazon ECS and click on <span class="packt_screen">Get Started</span> to start creating an ECS cluster and service. First, a container definition and a task definition are configured, and subsequently the service and cluster are configured to create the ECS objects cluster, service, task definition, and container definition. We shall discuss configuring each of the these in the following sub-sections. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring a Container definition</h1>
                </header>
            
            <article>
                
<p>The Amazon ECS wizard gets started. A diagram of ECS objects gets displayed, as shown in <a href="c1c9718a-58b6-41b1-a9f3-0c3e5cb9d5c4.xhtml" target="_blank">Chapter 1</a>, <em>Getting Started with Amazon ECS and Amazon Fargate</em>. By default, the Fargate launch type is used. First, the container definition is to be defined, followed by the task definition. </p>
<p>A Task definition consists of one or more container definitions. Most of the attributes are defined in the container definition, but a few are defined at the task level. To start with, select a container definition template, including the image, from one of those listed, which include <span class="packt_screen">sample-app</span> and <span class="packt_screen">nginx</span>, or create a custom container definition.</p>
<ul>
<li>Click on <span class="packt_screen">Configure</span> for the <span class="packt_screen">custom</span> container definition, as shown in the following screenshot, to create a new custom container definition:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/f66ab87b-ec9b-4155-8a3e-6547e22c9357.png"/></div>
<ul>
<li>The <span class="packt_screen">Edit container</span> dialog gets displayed. The standard configuration for a container includes the fields discussed in the following table:</li>
</ul>
<table border="1" style="border-collapse: collapse;width: 100%">
<tbody>
<tr>
<td><strong>Field</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr>
<td>Container name</td>
<td>The name of the Docker container to be created.</td>
</tr>
<tr>
<td>Image</td>
<td>The Docker image.</td>
</tr>
<tr>
<td>Port mappings</td>
<td>Container port mappings. Host port mappings are not supported with Fargate and default to the same value as the container port mappings.</td>
</tr>
</tbody>
</table>
<ul>
<li>Specify a <span class="packt_screen">Container name</span> (<kbd>hello-world</kbd>). Click on the <span class="packt_screen">i</span> icon to display a callout for the container name. The container name must be up to 255 characters (uppercase and lowercase, numbers, hyphens, and underscores).</li>
<li>Next, specify a Docker <span class="packt_screen">Image</span> (<kbd>tutum/hello-world</kbd>). The image name must be up to 255 characters (uppercase and lowercase, numbers, hyphens, underscores, colons, periods, <kbd>/</kbd>, and number signs). The Fargate launch type only supports images in the Amazon ECR or public repositories in Docker Hub.</li>
<li>Next, specify the Memory Limits in MiB. Two memory limits may be specified: <span class="packt_screen">Soft limit</span> and <span class="packt_screen">Hard limit</span>. Either or both may be specified. The effect of specifying one or both is discussed in this table:</li>
</ul>
<table border="1" style="border-collapse: collapse;width: 100%">
<tbody>
<tr>
<td><strong>Memory types configured</strong></td>
<td>
<div class="CDPAlignLeft CDPAlign"><strong>Description</strong></div>
</td>
</tr>
<tr>
<td>
<div class="CDPAlignCenter CDPAlign">Soft limit only</div>
</td>
<td>
<p class="CDPAlignLeft CDPAlign">ECS reserves the specified amount of memory (<kbd>memoryReservation</kbd>) for the container. The container may request more memory in excess of the soft limit up to all of the memory that is available on the container instance.</p>
</td>
</tr>
<tr>
<td>Hard limit only</td>
<td>The memory requested by the container cannot exceed the hard limit.</td>
</tr>
<tr>
<td>Both Soft limit and Hard limit</td>
<td>
<p>ECS reserves a specified amount of memory (<kbd>memoryReservation</kbd>) for the container. The container may request more memory in excess of the soft limit up to the hard limit if specified, or all of the memory that is available on the container instance, whichever it reaches first. If both are specified, the Hard limit must be greater or the same as the Soft limit.</p>
</td>
</tr>
</tbody>
</table>
<ul>
<li>The dropdown for the <span class="packt_screen">Memory Limits</span> lists both the <span class="packt_screen">Hard Limit</span> and the <span class="packt_screen">Soft limit</span>. The <span class="packt_screen">Soft limit</span> default value, is <span class="packt_screen">128 MiB</span>. To add a hard limit on memory in addition to a soft limit, click on the <span class="packt_screen">Add Hard Limit</span> link. A Hard limit gets added. <span class="packt_screen">Memory Limits</span> are shown as follows. The <span class="packt_screen">Soft limit</span> (<kbd>128</kbd> MiB) is less than the <span class="packt_screen">Hard limit</span> (<kbd>256</kbd> MiB):</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/ca80a7d7-5ffc-4703-91da-c247bc2d1ac4.png" style="width:55.08em;height:41.08em;"/></div>
<ul>
<li>Next, specify the <span class="packt_screen">Port mappings</span>. With the Fargate launch type, exposed ports must be specified as container ports. Container port <kbd>80</kbd> is specified as follows. The host port is the same as the <span class="packt_screen">Container port</span> by default, and cannot be set to a different value with the <kbd>awsvpc</kbd> network mode that the Fargate launch type uses:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/480304dd-69e8-4590-b90c-a296627c2bb5.png"/></div>
<ul>
<li>Optionally, specify <span class="packt_screen">Advanced container configuration</span>, which consists of configuration for Environment, Network settings, Storage &amp; Logging, Resource Limits, and Docker Labels. While the memory and CPU configuration is required at the task definition level, it is optional at the container level. The only requirement is that the total amount of memory for all containers within a task must not exceed the memory configured for the task, and the total amount of CPU for all containers within a task must not exceed the CPU configured for the task. A container instance has 1,024 CPU units for every CPU core. If the <span class="packt_screen">Essential</span> checkbox for a container is checked, the failure of the container returns in the entire task failing. At least one container in a task must be set as the essential container, which implies that if a task has only one container, it must be essential, as shown here:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/a911c74b-ca0f-4a58-bf12-4b17beaca24b.png"/></div>
<ul>
<li>The only network mode supported by the Fargate launch type is <kbd>awsvpc</kbd>. The only supported log configuration and log driver for the Fargate launch type is awslogs. Click on <span class="packt_screen">Update</span> after configuring the custom container, shown as follows:</li>
</ul>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/6255986d-5aed-425e-83c0-d70f5dd8b281.png" style="font-size: 1em;"/></div>
<ul>
<li>A <span class="packt_screen">Container definition</span> for the <span class="packt_screen">hello-world</span> custom container gets added as follows:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/591a9f03-0bbd-4a68-8069-2e1bcd3ab2cc.png" style="width:52.92em;height:25.83em;"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring a Task definition</h1>
                </header>
            
            <article>
                
<p>The task definition has a default name, which may be modified. The <span class="packt_screen">Network mode</span> is <span class="packt_screen">awsvpc</span> and cannot be modified. The <span class="packt_screen">Task execution role</span> is <span class="packt_screen">Create new</span>. The <span class="packt_screen">Task execution role</span> is the IAM role assumed by the ECS to access the resources needed by a task and includes permissions to pull private Docker images and publish logs for a task. <span class="packt_screen">Compatibilities</span> (launch type) is <span class="packt_screen">FARGATE</span>. <span class="packt_screen">Task memory</span> is <span class="packt_screen">0.5 GB</span> by default, and <span class="packt_screen">Task CPU</span> is <span class="packt_screen">0.25 vCPU</span> by default. The default <span class="packt_screen">Task definition</span> is shown as follows:</p>
<ul>
<li>Click on <span class="packt_screen">Edit</span> to modify any of the task settings if required:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/6cf32b6b-a54a-4171-94f5-44a906823e05.png" style="width:38.17em;height:19.17em;"/></div>
<ul>
<li>The <span class="packt_screen">Configure task definition</span> window gets displayed, as shown in the following screenshot. Specify <span class="packt_screen">Task definition name</span> (<kbd>hello-world-task-definition</kbd>) and select a <span class="packt_screen">Task execution role</span> (or keep the default role):</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/f8a79b47-53db-4e37-8a3e-11f97fa871eb.png" style="width:37.75em;height:27.75em;"/></div>
<ul>
<li>The <span class="packt_screen">Task size</span> is the total CPU and memory used by the task. The <span class="packt_screen">Task memory</span> and <span class="packt_screen">Task CPU</span> values constitute a bucket and only supported memory values for a selected CPU may be specified. The range of memory values supported for a given CPU may be obtained from the section <span class="packt_screen">Task Size</span> table at <a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task_definition_parameters.html">https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task_definition_parameters.html</a>. If the Task memory is not within the supported range for the selected Task CPU, an error gets generated. Set <span class="packt_screen">Task memory</span> to <span class="packt_screen">1 GB</span> and <span class="packt_screen">Task CPU</span> to <span class="packt_screen">0.5 vCPU</span>. Click on <span class="packt_screen">Save</span> to save the task configuration as follows:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/468447d8-f5d2-42cb-9897-3f4a9347d9cd.png" style="width:42.17em;height:30.92em;"/></div>
<ul>
<li><span>After configuring the container definition and task definition, the</span> task definition summary is shown in the following screenshot. C<span>lick on </span><span class="packt_screen">Next</span><span> to complete the container and task definitions:</span></li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/27f2a4e3-63e7-40de-bcba-83a95eb0a9d2.png" style="width:48.67em;height:25.00em;"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring a service</h1>
                </header>
            
            <article>
                
<p>Next, configure the service. The default settings for the service create one task as indicated by the <span class="packt_screen">Number of desired tasks</span>. Additional tasks may be added after a service has been created, as discussed in a later section. A new security group is created automatically as indicated by the <span class="packt_screen">Security group</span> field/label, and the option to create a custom security group is not provided. A security group is created to allow all public traffic to a service on the container port(s) configured. Network access and security groups may be further configured outside the wizard. The <span class="packt_screen">Load balancer type</span> is <span class="packt_screen">None</span> by default, with the option to select <span class="packt_screen">Application Load Balancer</span>.  Using an Application Load Balancer is discussed in <a href="7a007ed0-a02c-44fa-a5ca-f4e5b542525d.xhtml" target="_blank">Chapter 6</a>, <em>Using an Application Load Balancer</em>.</p>
<p>If an application load balancer is to be added, it must be created before creating the ECS cluster.</p>
<ul>
<li>Click on <span class="packt_screen">Next</span> to complete the service configuration:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/79e09c3f-afd5-465c-98b3-1cc79e615546.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring and creating a cluster</h1>
                </header>
            
            <article>
                
<p>Next, configure the cluster:</p>
<ul>
<li>Specify a <span class="packt_screen">Cluster name</span> (<kbd>hello-world</kbd>) with the default cluster name being <span class="packt_screen">default</span>. </li>
<li>The <span class="packt_screen">VPC ID</span> setting specifies the ID of the VPC to be used by the container. By default, a new VPC is created automatically. The <span class="packt_screen">Subnets</span> setting specifies the ID of the subnet to be used by the container. A subnet is a range of IP addresses in a VPC. By default, new subnets are created automatically. Click on <span class="packt_screen">Next</span> to complete the cluster configuration:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/7902788f-feb0-42bc-8c55-599b8e167626.png"/></div>
<ul>
<li>Review the ECS to be created. To modify <span class="packt_screen">Task definition</span>, <span class="packt_screen">Service</span>, or <span class="packt_screen">Cluster</span>, click on the associated <span class="packt_screen">Edit</span>. To create the Amazon ECS with the launch type as Fargate, click on <span class="packt_screen">Create</span>:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/1bf20e31-a3d0-4a65-8e3e-874da6f6f3be.png"/></div>
<ul>
<li class="mce-root">The Amazon Elastic Service with the Fargate launch type begins to get created. The <span class="packt_screen">Launch Status</span> displayed indicates the resource status as complete or pending. The complete status is for resources that have been created and the pending status is for resources that are in the process of being created. When all of the service resources have been created, click on <span class="packt_screen">View service</span>:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/40cf3b35-f545-494c-b8a6-4a9da4684304.png"/></div>
<p>The service summary gets displayed. In addition to the service name, the service summary includes <span class="packt_screen">Cluster</span>, <span class="packt_screen">Status</span>, <span class="packt_screen">Task definition</span>, <span class="packt_screen">Launch type</span>, <span class="packt_screen">Platform version</span>, <span class="packt_screen">Service role</span>, <span class="packt_screen">Desired count</span>, <span class="packt_screen">Pending count</span>, and <span class="packt_screen">Running count</span>. The <span class="packt_screen">Details</span> tab is selected by default. As we did not add load balancing, the <span class="packt_screen">Load Balancing</span> header indicates <span class="packt_screen">No load balancers</span>. The <span class="packt_screen">Network Access</span> header lists the <span class="packt_screen">Auto-Assign Public IP</span> as <span class="packt_screen">Enabled</span>, and these  are all shown as follows:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/de2971ae-c88f-4869-a8c4-3f707bad0c81.png"/></div>
<p>To list the tasks in the service, select the <span class="packt_screen">Tasks</span> tab. One task is listed, as we configured only one task. The <span class="packt_screen">Task status</span> is <span class="packt_screen">Running</span> or <span class="packt_screen">Stopped</span>. The tasks table columns are <span class="packt_screen">Task</span> (name), <span class="packt_screen">Task definition</span>, <span class="packt_screen">Last status</span>, <span class="packt_screen">Desired status</span>, <span class="packt_screen">Group</span>, <span class="packt_screen">Launch type</span>, and <span class="packt_screen">Platform version</span>:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/da390a11-0feb-4b8c-b025-ed3251ccf7ad.png" style="width:41.75em;height:22.33em;"/></div>
<p>The <span class="packt_screen">Events</span> tab lists the events. Each event is associated with an <span class="packt_screen">Event Id</span>, <span class="packt_screen">Event Time</span>, and <span class="packt_screen">Message</span>:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/f654371a-e33f-4a99-8a4d-3cd93a5a3240.png" style="width:41.83em;height:22.67em;"/></div>
<p>The <span class="packt_screen">Deployment</span>s tab lists the <span class="packt_screen">Task Placement Strategy</span> and <span class="packt_screen">Constraint</span>. Task placement constraints are not supported with the Fargate launch type:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/c30499ce-29d6-4df0-9f9b-bad37c46c4d7.png" style="width:36.58em;height:16.67em;"/></div>
<p>To display the metrics, which include <span class="packt_screen">CPUUtilization</span> and <span class="packt_screen">MemoryUtilization</span>, select the <span class="packt_screen">Metrics</span> tab. <span class="packt_screen">Minimum</span>, <span class="packt_screen">Maximum</span>, and <span class="packt_screen">Average</span> values are color coded, as indicated in the screenshot legend:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/9d303fc3-eee2-44c8-b7b6-14b2171a1aae.png" style="width:49.42em;height:23.67em;"/></div>
<p>To display the logs, select the <span class="packt_screen">Logs</span> tab:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/6b96b176-1ea2-4b6c-8f02-a117524d99f2.png" style="width:41.67em;height:15.42em;"/></div>
<p>The <span class="packt_screen">Clusters</span> list a <span class="packt_screen">hello-world</span> cluster of the Fargate launch type and no EC2 clusters are shown:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/0e4df81b-1c80-429e-a08a-cda3a8f631a2.png" style="width:41.75em;height:20.58em;"/></div>
<p>A <span class="packt_screen">CloudFormation</span> stack gets created for the ECS cluster, shown in the following <span class="packt_screen">CloudFormation</span> dashboard. The AWS <span class="packt_screen">CloudFormation</span> dashboard can be accessed at <a href="https://us-east-2.console.aws.amazon.com/cloudformation">https://us-east-2.console.aws.amazon.com/cloudformation</a>. The table lists the stacks with columns for <span class="packt_screen">Stack Name</span>, <span class="packt_screen">Created Time</span>, <span class="packt_screen">Status</span>, and <span class="packt_screen">Description</span>. Tabs for <span class="packt_screen">Overview</span>, <span class="packt_screen">Outputs</span>, <span class="packt_screen">Resources</span>, <span class="packt_screen">Events</span>, <span class="packt_screen">Template</span>, <span class="packt_screen">Parameters</span>, <span class="packt_screen">Tags</span>, <span class="packt_screen">Stack Policy</span>, and <span class="packt_screen">Change Sets</span> are provided. The <span class="packt_screen">Events</span> tab indicates the <span class="packt_screen">CREATE_COMPLETE</span> status for resources that have been created:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/f6704a67-3455-479c-b086-6dd3fa80b894.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Running additional tasks</h1>
                </header>
            
            <article>
                
<p>By default, one task is created. In this section, we shall discuss the procedure to add an additional task. The <span class="packt_screen">Tasks</span> tab in the cluster displays the tasks associated with a cluster:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/b6ad7cbd-0880-41d0-a5ba-e8ff2332763f.png" style="width:43.50em;height:25.08em;"/></p>
<p>Tasks associated with a service are listed on the service page. To display a task definition's details, click on the link for the task definition in the Service page or the cluster page. A task definition is shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/857564e8-4eb3-4742-8325-6993b318eb10.png" style="width:42.00em;height:21.25em;"/></div>
<ul>
<li>To run a new task, select <span class="packt_screen">Actions</span> | <span class="packt_screen">Run Task</span>. A new task gets created with <span class="packt_screen">Run Task:</span></li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/6023915b-e090-4f26-ba5c-f01d2bb1d07e.png" style="width:41.50em;height:23.50em;"/></div>
<ul>
<li>Two options are provided for the launch type to run a new task: <span class="packt_screen">Fargate</span> and <span class="packt_screen">EC2</span>. Select the <span class="packt_screen">Fargate</span> launch type, as shown in the following screenshot.</li>
<li>The <span class="packt_screen">Task Definition nam</span><span class="packt_screen"><strong>e</strong></span> is pre-specified. The <span class="packt_screen">Platform version</span> is <span class="packt_screen">LATEST</span> by default.</li>
<li>The <span class="packt_screen">Cluster</span> is also selected and, if more than one cluster is available, the cluster may be selected from a drop-down list.</li>
<li>Specify the <span class="packt_screen">Number of tasks</span> to create.</li>
<li>Optionally, specify a <span class="packt_screen">Task Group</span>. A task group is a set of related tasks, and all tasks in the same task group are considered as a set when performing spread placement. Required fields are marked with an asterisk (<span class="packt_screen">*</span>):</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/d1dfbfec-7345-4e92-8e7b-05a59181feb8.png"/></div>
<ul>
<li>Select a <span class="packt_screen">Cluster VPC</span> from the dropdown, as shown in the following screenshot.</li>
<li>In the <span class="packt_screen">Subnets</span> dropdown, select the subnets. Choose the subnets in the selected VPC that the task scheduler should consider for placement. Only private subnets are currently supported.</li>
<li>Select <span class="packt_screen">Auto-assign Public IP</span> as <kbd>ENABLED</kbd>. A security group is created by default with port <kbd>80</kbd> open to the internet:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/fc88e515-6846-498e-9736-c774c7f26c96.png" style="width:41.50em;height:34.67em;"/></div>
<ul>
<li>Advanced options include <span class="packt_screen">Task overrides</span> and <span class="packt_screen">Container overrides</span>, as shown in the following screenshot. We have not set any advanced options:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/36f7c572-64ad-4375-a15a-6218860462f9.png" style="width:42.92em;height:25.83em;"/></div>
<ul>
<li>Click on <span class="packt_screen">Run Task</span> to run a new task, as shown in the following screenshot:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/bc5804e9-c9ce-4c12-9d8a-676e3066f27a.png" style="width:42.00em;height:24.67em;"/></div>
<p>A task gets created. The message <span class="packt_screen">Created tasks successfully</span> gets displayed. The message includes <span class="packt_screen">tasks</span>, even though one new task has been created, because the message is a standard message for creating one or more new tasks. A new task gets listed in the <span class="packt_screen">Tasks</span> tab, as shown in the following screenshot. The <span class="packt_screen">Last status</span> column indicates that the task status is <span class="packt_screen">RUNNING</span>. Initially, the <span class="packt_screen">Last status</span> is <span class="packt_screen">PROVISIONING:</span></p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/4f7e6a64-75f2-4d8e-974d-e65946e01e5a.png"/></div>
<p>The <span class="packt_screen">hello-world</span> <span>cluster </span><span>lists two </span><span class="packt_screen">Running tasks</span><span>, as shown in the following screenshot. The number of</span> <span class="packt_screen">Pending tasks</span> <span>is listed as</span> <span class="packt_screen">0:</span></p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/d68fc660-0251-479b-970a-0cd8d6e2b00e.png" style="width:43.33em;height:19.25em;"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Accessing the service</h1>
                </header>
            
            <article>
                
<p>To be able to access a service, the <span class="packt_screen">Network Access</span> should be configured with <span class="packt_screen">Auto-assign public IP</span> as <span class="packt_screen">ENABLED</span>, as shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/93cefa12-c179-49d6-b5e7-3bc549c55433.png" style="width:42.50em;height:24.83em;"/></div>
<p>To provide network access, an ENI gets created for each task. The ENI is associated with a public IP that may be used to access an application running in a task container:</p>
<ul>
<li>Click on the link for a task in <span class="packt_screen">Service</span> | <span class="packt_screen">Tasks</span>, as shown in the following screenshot:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/91b6aa08-e1e7-4629-84b4-293b89fe8e97.png" style="width:43.92em;height:11.92em;"/></div>
<ul>
<li>On the task detail page, click on the link for the <span class="packt_screen">ENI Id</span>, as shown <span>in the following screenshot:</span></li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/03a84940-4bd9-4844-93bd-1d1d9f07e69d.png" style="width:43.25em;height:25.08em;"/></div>
<ul>
<li>Copy the <span class="packt_screen">IPv4 Public IP</span> from the ENI console, <span class="packt_screen">18.219.111.138</span> in the following screenshot, which would be different for different users:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/328fb163-74f9-4b1c-95d7-61a2c0f6879e.png"/></div>
<ul>
<li>Specify the <span class="packt_screen">IPv4 Public IP</span> in a browser to invoke the <span class="packt_screen">Hello World</span> application, <span>as shown </span><span>in the following screenshot:</span></li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/ad3f7fbc-d613-43a4-974d-4f52ab47c621.png" style="width:40.83em;height:26.42em;"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Deleting a cluster</h1>
                </header>
            
            <article>
                
<p>To delete a cluster, the cluster must not be running any tasks:</p>
<ul>
<li>Select all running tasks and click on <span class="packt_screen">Stop</span>, <span>as shown </span><span>in the following screenshot</span>. Alternatively, select <span class="packt_screen">Stop All</span>, without selecting any tasks:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/47a32a2e-fd4c-40f8-baa9-b82ac137510a.png"/></div>
<ul>
<li>In the <span class="packt_screen">Stop tasks</span> confirmation dialog, click on <span class="packt_screen">Stop</span>. The tasks get stopped, as indicated by the message <span class="packt_screen">Stopped tasks successfully</span>.</li>
<li>Click on <span class="packt_screen">Delete Cluster</span> to delete the cluster:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/d73df405-48f6-4dc8-92d3-3a99a4b9bf4e.png"/></div>
<ul>
<li>In the <span class="packt_screen">Delete Cluster</span> confirmation dialog, click on <span class="packt_screen">Delete</span>. The hello-world cluster gets deleted. If the <span class="packt_screen">CoudFormation</span> stack associated with the cluster times out before the cluster gets deleted, an error message gets displayed, as shown <span>in the following screenshot,</span> and the cluster does not get deleted. If the <span class="packt_screen">CloudFormation</span> stack does not get deleted automatically when the ECS cluster is chosen to be deleted, click on the <span class="packt_screen">View CloudFormation Stack</span> link in the error message:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/77b5964d-a95c-437a-95fc-d2ff314f2c24.png"/></div>
<ul>
<li>In the <span class="packt_screen">CloudFormation</span> | <span class="packt_screen">Stacks</span> dashboard, select <span class="packt_screen">CloudFormation</span>, and click on <span class="packt_screen">Actions</span> | <span class="packt_screen">Delete Stack</span>, as shown <span>in the following screenshot</span>. <span class="packt_screen">Delete Stack</span> may need to be initiated after the stack Status becomes <span class="packt_screen">DELETE FAILED</span>:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/5f264ac5-8de1-4576-adc9-06d10f6ee0fc.png"/></div>
<ul>
<li>In the <span class="packt_screen">Delete Stack</span> confirmation dialog, select all the resources that are to be deleted, along with the <span class="packt_screen">CloudFormation</span> stack and click on <span class="packt_screen"><span class="packt_screen">Yes</span>, Delete</span>. <span class="packt_screen">CloudFormation</span> gets deleted. After the <span class="packt_screen">CloudFormation</span> stack has been deleted, delete the ECS cluster and the ECS cluster should also get deleted.</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we introduced the Fargate launch type as used with an ECS cluster. We created a cluster, including container, task, and service definitions, using a Hello World Docker image. Subsequently, we invoked the Hello World application using the IPv4 public IP of the Elastic Network Interface associated with a task. Some of the container definition and task definition parameters are different for the Fargate launch type in comparison to the EC2 launch type, which is still available as an alternative with ECS. In the next chapter, we shall discuss integrating the CloudWatch Logs service with Fargate.</p>


            </article>

            
        </section>
    </body></html>