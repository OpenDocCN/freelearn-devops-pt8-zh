<html><head></head><body>
		<div id="_idContainer243">
			<h1 id="_idParaDest-221" class="chapter-number"><a id="_idTextAnchor229"/>11</h1>
			<h1 id="_idParaDest-222"><a id="_idTextAnchor230"/>OpenShift Multi-Cluster GitOps and Management</h1>
			<p>In the first chapter of this book, we discussed the main challenges most organizations face in scaling their Kubernetes infrastructure in a multi- or hybrid-cloud world. New challenges arise when you deploy multiple clusters on different providers, such as the following:</p>
			<ul>
				<li><strong class="bold">Inconsistent security policies</strong>: Clusters with different configurations regarding access rules and user profiles, allowed/blocked network flows, certificates, and other security aspects make an organization more vulnerable to data breaches and other security events.</li>
				<li><strong class="bold">High operational effort to manage all clusters</strong>: Managing configurations, components, compliance, and policies for several clusters is overwhelming.</li>
				<li><strong class="bold">Deploying and managing applications</strong>: The deployment process becomes much more complicated when you need to do it over several clusters. Monitoring and managing them are also really complex and require a lot of human effort.</li>
			</ul>
			<p>In this chapter, we will introduce a great tool to help you address these challenges and alleviate the amount of work you and/or your team may need to deal with when managing several clusters: Red Hat <strong class="bold">Advanced Cluster Management</strong> (<strong class="bold">ACM</strong>).</p>
			<p>Therefore, you will find the following topics covered in this chapter:</p>
			<ul>
				<li>What is Red Hat ACM?</li>
				<li>Red Hat ACM installation</li>
				<li>Managing clusters using Red Hat ACM</li>
				<li>Managing applications using Red Hat ACM</li>
				<li>Governance using Red Hat ACM</li>
				<li>Multi-cluster observability with Red Hat ACM</li>
			</ul>
			<p class="callout-heading">Note</p>
			<p class="callout">The source code used in this chapter is available at <a href="https://github.com/PacktPublishing/OpenShift-Multi-Cluster-Management-Handbook/tree/main/chapter11">https://github.com/PacktPublishing/OpenShift-Multi-Cluster-Management-Handbook/tree/main/chapter11</a>.</p>
			<h1 id="_idParaDest-223"><a id="_idTextAnchor231"/>What is Red Hat ACM?</h1>
			<p>Red Hat ACM is a complete <a id="_idIndexMarker766"/>solution for Kubernetes multi-cluster management from a single pane that includes some other great features, making complex and time-consuming tasks a lot easier. Red Hat ACM provides <a id="_idIndexMarker767"/>a few main features, listed here:</p>
			<ul>
				<li><strong class="bold">Kubernetes multi-cluster management</strong>: Create, update, and delete Kubernetes clusters on-premises and in the cloud.</li>
				<li><strong class="bold">Multi-cluster observability</strong>: ACM can also provide observability for all clusters from a single point of view, enabling administrators to read, aggregate, and receive alerts on the clusters.</li>
				<li><strong class="bold">Governance using policies</strong>: Through Red Hat ACM, you can audit and enforce policies to apply anything you want in the clusters, from security to infrastructure and <a id="_idIndexMarker768"/>application-related stuff. This includes roles and access control, operators that must be installed, and security compliance rules.</li>
				<li><strong class="bold">Application management</strong>: Deploy applications from Git repositories or Helm into multiple clusters simultaneously and also view them from a single pane.</li>
			</ul>
			<p>One of the great aspects of ACM is its multi-cluster architecture – it is designed to manage several clusters from a single standpoint, as you can see in the following figure. </p>
			<div>
				<div id="_idContainer195" class="IMG---Figure">
					<img src="image/B18015_11_01.jpg" alt="Figure 11.1 – ACM hub and managed clusters "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.1 – ACM hub and managed clusters</p>
			<p>To do so, it uses the concept of hub and managed clusters, as follows:</p>
			<ul>
				<li><strong class="bold">Hub cluster</strong>: An OpenShift cluster that runs the central controller of ACM, which contains the <a id="_idIndexMarker769"/>web console, APIs, and other components that make up the product’s features. In this chapter, we will use the term hub cluster several times to refer to the OpenShift cluster that hosts ACM. OpenShift is the only supported option for the hub cluster.</li>
				<li><strong class="bold">Managed cluster</strong>: A cluster that is managed by ACM. ACM can manage OpenShift as well <a id="_idIndexMarker770"/>as other Kubernetes-based distributions. Check the <em class="italic">Further reading</em> section at the end of this chapter to find a complete list of Kubernetes distributions supported by ACM (Supportability Matrix).</li>
			</ul>
			<p>We will dig into all these features in the following sections of this chapter.</p>
			<h1 id="_idParaDest-224"><a id="_idTextAnchor232"/>Red Hat ACM installation</h1>
			<p>In this section, we will guide you through the installation and configuration of ACM.</p>
			<p class="callout-heading">Important Note</p>
			<p class="callout">It is important to consider that ACM uses the compute, memory, and storage resources of the hub cluster, thus it is recommended to have a dedicated cluster to be the hub for ACM, avoiding concurrent workloads and resource usage. This is recommended but not required; you can run ACM in any OpenShift cluster with enough capacity.</p>
			<p>The installation process is simple, similar to what we followed in the last chapters with OpenShift Pipelines and GitOps, as you can see in this section.</p>
			<h2 id="_idParaDest-225"><a id="_idTextAnchor233"/>Prerequisites</h2>
			<ol>
				<li>Access to an <a id="_idIndexMarker771"/>OpenShift cluster with cluster-admin permissions.</li>
			</ol>
			<h2 id="_idParaDest-226"><a id="_idTextAnchor234"/>Installation</h2>
			<p>Follow this <a id="_idIndexMarker772"/>process to install Red Hat Advanced Cluster Management:</p>
			<ol>
				<li value="1">Access the OpenShift web console using a cluster-admin user.</li>
				<li>Navigate to the <strong class="bold">Operators</strong> | <strong class="bold">OperatorHub</strong> menu item.</li>
			</ol>
			<div>
				<div id="_idContainer196" class="IMG---Figure">
					<img src="image/B18015_11_02.jpg" alt="Figure 11.2 – OperatorHub "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.2 – OperatorHub</p>
			<ol>
				<li value="3">Search <a id="_idIndexMarker773"/>for <strong class="source-inline">Advanced Cluster Management for Kubernetes</strong> using the <strong class="bold">Filter by keyword…</strong> box.</li>
			</ol>
			<div>
				<div id="_idContainer197" class="IMG---Figure">
					<img src="image/B18015_11_03.jpg" alt="Figure 11.3 – Advanced Cluster Management for Kubernetes on OperatorHub "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.3 – Advanced Cluster Management for Kubernetes on OperatorHub</p>
			<ol>
				<li value="4">Click on the <strong class="bold">Advanced Cluster Management for Kubernetes</strong> tile and then on the <strong class="bold">Install</strong> button to see the <strong class="bold">Install Operator</strong> screen.</li>
			</ol>
			<div>
				<div id="_idContainer198" class="IMG---Figure">
					<img src="image/B18015_11_04.jpg" alt="Figure 11.4 – Installing Advanced Cluster Management for Kubernetes "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.4 – Installing Advanced Cluster Management for Kubernetes</p>
			<ol>
				<li value="5">Don’t <a id="_idIndexMarker774"/>change the default namespace (<strong class="source-inline">open-cluster-management</strong>).</li>
				<li>Select <strong class="bold">Automatic</strong> or <strong class="bold">Manual</strong> for <strong class="bold">Update approval</strong>. If you select <strong class="bold">Automatic</strong>, upgrades will <a id="_idIndexMarker775"/>be performed automatically by <strong class="bold">Operator Lifecycle Manager </strong>(<strong class="bold">OLM</strong>) as soon as they are released by Red Hat, while with <strong class="bold">Manual</strong>, you need to approve it before being applied.</li>
				<li>Select the correct update channel. The stable channel is recommended as it contains the latest stable and <em class="italic">supported</em> version of the operator.</li>
				<li>Click <a id="_idIndexMarker776"/>the <strong class="bold">Install</strong> button.</li>
			</ol>
			<div>
				<div id="_idContainer199" class="IMG---Figure">
					<img src="image/B18015_11_05.jpg" alt="Figure 11.5 – Installing the operator "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.5 – Installing the operator</p>
			<ol>
				<li value="9">Wait up to 5 minutes until you see the following message:</li>
			</ol>
			<div>
				<div id="_idContainer200" class="IMG---Figure">
					<img src="image/B18015_11_06.jpg" alt="Figure 11.6 – Operator installed "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.6 – Operator installed</p>
			<p>Now that we <a id="_idIndexMarker777"/>have the operator installed, we can go ahead and deploy a new <strong class="bold">MultiClusterHub</strong> instance:</p>
			<ol>
				<li value="1">Click on the <strong class="bold">Create MultiClusterHub</strong> button.</li>
				<li>Usually, no changes are needed; leave the default values and click on the <strong class="bold">Create</strong> button. Check out the link in the <em class="italic">Further reading</em> section of this chapter for product documentation for more information if you need to configure some advanced settings.</li>
			</ol>
			<div>
				<div id="_idContainer201" class="IMG---Figure">
					<img src="image/B18015_11_07.jpg" alt="Figure 11.7 – Create MultiClusterHub "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.7 – Create MultiClusterHub</p>
			<ol>
				<li value="3">You will see the status <strong class="screen-inline">Phase:Installing</strong> during the installation process.</li>
			</ol>
			<div>
				<div id="_idContainer202" class="IMG---Figure">
					<img src="image/B18015_11_08.jpg" alt="Figure 11.8 – Installing MultiClusterHub "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.8 – Installing MultiClusterHub</p>
			<ol>
				<li value="4">Wait a bit <a id="_idIndexMarker778"/>until you see the <strong class="screen-inline">Phase:Running</strong> status.</li>
			</ol>
			<div>
				<div id="_idContainer203" class="IMG---Figure">
					<img src="image/B18015_11_09.jpg" alt="Figure 11.9 – MultiClusterHub running "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.9 – MultiClusterHub running</p>
			<ol>
				<li value="5">Click on the <em class="italic">combo box</em> at the top left of the screen and then click on <strong class="bold">Advanced Cluster Management</strong>.</li>
			</ol>
			<div>
				<div id="_idContainer204" class="IMG---Figure">
					<img src="image/B18015_11_10.jpg" alt="Figure 11.10 – Advanced Cluster Management option "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.10 – Advanced Cluster Management option</p>
			<ol>
				<li value="6">You should see the ACM login screen. Use the same admin credentials you use to log in to OpenShift.</li>
			</ol>
			<div>
				<div id="_idContainer205" class="IMG---Figure">
					<img src="image/B18015_11_11.jpg" alt="Figure 11.11 – Red Hat ACM login "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.11 – Red Hat ACM login</p>
			<p>You have <a id="_idIndexMarker779"/>now Red Hat ACM installed and ready to be used.</p>
			<div>
				<div id="_idContainer206" class="IMG---Figure">
					<img src="image/B18015_11_12.jpg" alt="Figure 11.12 – Red Hat ACM initial page "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.12 – Red Hat ACM initial page</p>
			<p>Continue to <a id="_idIndexMarker780"/>the next section to learn more about the ACM cluster management feature.</p>
			<h1 id="_idParaDest-227"><a id="_idTextAnchor235"/>Managing clusters using Red Hat ACM</h1>
			<p>As we mentioned <a id="_idIndexMarker781"/>previously, one of the features ACM provides is cluster management. The <a id="_idIndexMarker782"/>following is a list of some of the operations you can perform with ACM:</p>
			<ul>
				<li>Cluster provisioning</li>
				<li>Import of existing clusters</li>
				<li>Destroying a cluster</li>
				<li>Upgrading a cluster</li>
				<li>Scaling cluster nodes in or out</li>
			</ul>
			<p>Check the <em class="italic">Further reading</em> section of this chapter to see a link to a complete list of supported operations.</p>
			<p>We will not cover how to do all the operations you can perform with ACM in this book, but we will guide you through the process of provisioning a new OpenShift cluster on AWS using ACM, to give you an idea of how easy it is to use the tool.</p>
			<h2 id="_idParaDest-228"><a id="_idTextAnchor236"/>Cluster provisioning</h2>
			<p>Currently, in version 2.5, ACM can deploy clusters on AWS, Azure, Google Cloud, VMware vSphere, bare <a id="_idIndexMarker783"/>metal, Red Hat OpenStack, and Red Hat Virtualization. To do so, you need to first input the provider credentials to be used by ACM during the provisioning process. The following steps show how to add AWS credentials that will be used with our sample:</p>
			<ol>
				<li value="1">Access the <strong class="bold">Credentials</strong> menu and click on the <strong class="bold">Add credential</strong> button.</li>
			</ol>
			<div>
				<div id="_idContainer207" class="IMG---Figure">
					<img src="image/B18015_11_13.jpg" alt="Figure 11.13 – Adding provider credentials "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.13 – Adding provider credentials</p>
			<ol>
				<li value="2">Click <a id="_idIndexMarker784"/>on the AWS credential.</li>
			</ol>
			<div>
				<div id="_idContainer208" class="IMG---Figure">
					<img src="image/B18015_11_14.jpg" alt="Figure 11.14 – Selecting the credential type "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.14 – Selecting the credential type</p>
			<ol>
				<li value="3">On the next page, input a name and select a namespace where the credentials will be stored and the base DNS domain that will be used to deploy clusters. Click on the <strong class="bold">Next</strong> button.</li>
			</ol>
			<div>
				<div id="_idContainer209" class="IMG---Figure">
					<img src="image/B18015_11_15.jpg" alt="Figure 11.15 – Basic credentials information "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.15 – Basic credentials information</p>
			<p class="callout-heading">Recommended Practice</p>
			<p class="callout">The provider credentials are stored in secrets in the namespace provided. As such, it is highly recommended you create a specific namespace for that and keep the access for it restricted.</p>
			<ol>
				<li value="4">Enter the <a id="_idIndexMarker785"/>AWS access and secret keys. Click <strong class="bold">Next</strong>.</li>
			</ol>
			<div>
				<div id="_idContainer210" class="IMG---Figure">
					<img src="image/B18015_11_16.jpg" alt="Figure 11.16 – AWS access and secret keys "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.16 – AWS access and secret keys</p>
			<ol>
				<li value="5">If you use a <a id="_idIndexMarker786"/>proxy, input the proxy configuration and click <strong class="bold">Next</strong>.</li>
			</ol>
			<div>
				<div id="_idContainer211" class="IMG---Figure">
					<img src="image/B18015_11_17.jpg" alt="Figure 11.17 – Proxy configuration "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.17 – Proxy configuration</p>
			<ol>
				<li value="6">Log in to the <a href="http://console.redhat.com">console.redhat.com</a> portal using your Red Hat credentials and go to the <strong class="bold">OpenShift</strong> | <strong class="bold">Downloads</strong> menu option. Scroll down in the <strong class="bold">Tokens</strong> section and click on the <strong class="bold">Copy</strong> button next to <strong class="bold">Pull Secret</strong>.</li>
			</ol>
			<div>
				<div id="_idContainer212" class="IMG---Figure">
					<img src="image/B18015_11_18.jpg" alt="Figure 11.18 – Getting a pull secret "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.18 – Getting a pull secret</p>
			<ol>
				<li value="7">Go back to <a id="_idIndexMarker787"/>ACM and paste the pull secret in the required field. Use an existing or create a new SSH key and paste it into the <strong class="bold">SSH private key</strong> and <strong class="bold">SSH public key</strong> fields.</li>
			</ol>
			<div>
				<div id="_idContainer213" class="IMG---Figure">
					<img src="image/B18015_11_19.jpg" alt="Figure 11.19 – Inputting the pull secret and SSH keys "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.19 – Inputting the pull secret and SSH keys</p>
			<p class="callout-heading">Note</p>
			<p class="callout">You can use the following command in a Linux workstation to generate a new SSH key if needed:</p>
			<p class="callout"><strong class="source-inline">ssh-keygen -t ed25519 -N '' -f new-ssh-key</strong></p>
			<ol>
				<li value="8">Finally, click <a id="_idIndexMarker788"/>on the <strong class="bold">Add</strong> button and see your new credential.</li>
			</ol>
			<div>
				<div id="_idContainer214" class="IMG---Figure">
					<img src="image/B18015_11_20.jpg" alt="Figure 11.20 – Credential added "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.20 – Credential added</p>
			<p>Now, let’s go ahead and deploy a new cluster using this credential. Follow this process to deploy the cluster using ACM:</p>
			<ol>
				<li value="1">Access the <strong class="bold">Infrastructure</strong> | <strong class="bold">Clusters</strong> menu and click on the <strong class="bold">Create cluster</strong> button.</li>
			</ol>
			<div>
				<div id="_idContainer215" class="IMG---Figure">
					<img src="image/B18015_11_21.jpg" alt="Figure 11.21 – Creating a cluster "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.21 – Creating a cluster</p>
			<ol>
				<li value="2">Select AWS, choose <a id="_idIndexMarker789"/>the credential that we just created, and click <strong class="bold">Next</strong>.</li>
			</ol>
			<div>
				<div id="_idContainer216" class="IMG---Figure">
					<img src="image/B18015_11_22.jpg" alt="Figure 11.22 – Selecting the installation type "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.22 – Selecting the installation type</p>
			<ol>
				<li value="3">Fill out the <a id="_idIndexMarker790"/>form with the requested fields and click on the <strong class="bold">Next</strong> button.</li>
			</ol>
			<div>
				<div id="_idContainer217" class="IMG---Figure">
					<img src="image/B18015_11_23.jpg" alt="Figure 11.23 – Filling out the cluster details "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.23 – Filling out the cluster details</p>
			<ol>
				<li value="4">Input the AWS region and the machine number and size.</li>
			</ol>
			<div>
				<div id="_idContainer218" class="IMG---Figure">
					<img src="image/B18015_11_24.jpg" alt="Figure 11.24 – Node pools "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.24 – Node pools</p>
			<ol>
				<li value="5">If you want to <a id="_idIndexMarker791"/>customize the cluster network configurations, you can do so on this screen.</li>
			</ol>
			<div>
				<div id="_idContainer219" class="IMG---Figure">
					<img src="image/B18015_11_25.jpg" alt="Figure 11.25 – Network configurations "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.25 – Network configurations</p>
			<ol>
				<li value="6">Input the proxy configurations, if needed.</li>
			</ol>
			<div>
				<div id="_idContainer220" class="IMG---Figure">
					<img src="image/B18015_11_26.jpg" alt="Figure 11.26 – Proxy configuration "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.26 – Proxy configuration</p>
			<ol>
				<li value="7">You can also use Ansible to run playbooks and automate infrastructure requirements you may have as part of your deployment process. We will not dig into the Ansible <a id="_idIndexMarker792"/>integration in this book, but you can find good references to it in the <em class="italic">Further reading</em> of this chapter.</li>
			</ol>
			<div>
				<div id="_idContainer221" class="IMG---Figure">
					<img src="image/B18015_11_27.jpg" alt="Figure 11.27 – Ansible automation hooks "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.27 – Ansible automation hooks</p>
			<ol>
				<li value="8">Review the information provided and click on the <strong class="bold">Create</strong> button if everything is correct.</li>
			</ol>
			<div>
				<div id="_idContainer222" class="IMG---Figure">
					<img src="image/B18015_11_28.jpg" alt="Figure 11.28 – Reviewing a cluster "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.28 – Reviewing a cluster</p>
			<ol>
				<li value="9">You will be redirected to the overview page, where you can inspect the installation <a id="_idIndexMarker793"/>process. The deployment process usually takes between 30 and 60 minutes depending on the provider and region.</li>
			</ol>
			<div>
				<div id="_idContainer223" class="IMG---Figure">
					<img src="image/B18015_11_29.jpg" alt="Figure 11.29 – Cluster overview "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.29 – Cluster overview</p>
			<ol>
				<li value="10">It is recommended that you add labels in your clusters according to some organizational <a id="_idIndexMarker794"/>structure to be used later with <strong class="bold">PlacementRules</strong>. We are going to add the <strong class="source-inline">env=dev</strong> label in this cluster and use it in the next section when we deploy an application into a remote cluster using ACM. To do so, click on the pencil icon next to the <strong class="bold">Labels</strong> section.</li>
			</ol>
			<div>
				<div id="_idContainer224" class="IMG---Figure">
					<img src="image/B18015_11_30.jpg" alt="Figure 11.30 – Adding new labels "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.30 – Adding new labels</p>
			<ol>
				<li value="11">Then, add <a id="_idIndexMarker795"/>the new label, <strong class="source-inline">env=dev.</strong></li>
			</ol>
			<div>
				<div id="_idContainer225" class="IMG---Figure">
					<img src="image/B18015_11_31.jpg" alt="Figure 11.31 – Adding a label in a cluster "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.31 – Adding a label in a cluster</p>
			<p>As you can see, the <a id="_idIndexMarker796"/>OpenShift cluster deployment process is straightforward! In the next section, you will see how ACM can also help you to deploy an application into multiple clusters using its embedded deployment mechanism or also using it integrated with OpenShift GitOps (Argo CD).</p>
			<h1 id="_idParaDest-229"><a id="_idTextAnchor237"/>Managing applications using Red Hat ACM</h1>
			<p>One of the <a id="_idIndexMarker797"/>greatest benefits of ACM is providing a <a id="_idIndexMarker798"/>single and simple way to view applications that are deployed among different clusters. You can also deploy an application into multiple clusters using two different approaches:</p>
			<ul>
				<li>Using the embedded Application Subscription deployment model</li>
				<li>Using OpenShift GitOps (Argo CD) and <strong class="bold">ApplicationSets</strong></li>
			</ul>
			<p>We will <a id="_idIndexMarker799"/>walk through the process of each <a id="_idIndexMarker800"/>approach in this section.</p>
			<h2 id="_idParaDest-230"><a id="_idTextAnchor238"/>Application Subscription model</h2>
			<p>This model is <a id="_idIndexMarker801"/>embedded in <a id="_idIndexMarker802"/>ACM and doesn’t depend on anything other than ACM itself. In the Application Subscription model, you will defi<a id="_idTextAnchor239"/>ne an <strong class="bold">Application</strong> object that subscribes (<strong class="bold">Subscription</strong>) to one or more Kubernetes resources (<strong class="bold">Channel</strong>) that contain the manifests that describe how the application is deployed. The application will be deployed in the clusters defined in the placement rules.</p>
			<p>The following is a diagram that explains how this model works:</p>
			<div>
				<div id="_idContainer226" class="IMG---Figure">
					<img src="image/B18015_11_32.jpg" alt="Figure 11.32 – ACM Application Subscription model "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.32 – ACM Application Subscription model</p>
			<p>Let’s get back <a id="_idIndexMarker803"/>to the sample <a id="_idIndexMarker804"/>application we used in the previous chapter and create the ACM objects to check what the application deployment model looks like.</p>
			<h3>Channels (what to deploy)</h3>
			<p>Define the source <a id="_idIndexMarker805"/>repositories used to deploy an application. It can be a Git repository, Helm release, or object storage repository. We are going to use the following YAML manifest to point out to our Git repository:</p>
			<pre class="source-code">apiVersion: apps.open-cluster-management.io/v1
kind: Channel
metadata:
  name: cloud-api-github
  namespace: clouds-api-dev
spec:
  pathname: https://github.com/PacktPublishing/OpenShift-Multi-Cluster-Management-Handbook.git <strong class="bold">#[1]</strong>
  type: Git</pre>
			<p><strong class="bold">#[1]</strong> highlights the URL to the Git repository that contains the application deployment manifests.</p>
			<p>After the <strong class="source-inline">Channel</strong> object, we need to create the <strong class="source-inline">PlacementRule</strong> object, which will be used with the application deployment.</p>
			<h3>Placement rules (where to deploy)</h3>
			<p>Placement rules define <a id="_idIndexMarker806"/>the target clusters where the application will be deployed. They are also used with policies. Remember that we added the <strong class="source-inline">env=dev</strong> label to the cluster we provisioned earlier. We are going to use it now to define our <strong class="source-inline">PlacementRule</strong> object:</p>
			<pre class="source-code">apiVersion: apps.open-cluster-management.io/v1
kind: PlacementRule
metadata:
  name: cloud-api-placement
  namespace: clouds-api-dev
  labels:
    app: cloud-api
spec:
  clusterSelector:
    matchLabels:
      env: dev <strong class="bold">#[1]</strong></pre>
			<p><strong class="bold">#[1]</strong> highlights <a id="_idIndexMarker807"/>the cluster selector based on labels. It will instruct ACM to deploy the application in all clusters that have the <strong class="source-inline">env=dev</strong> label.</p>
			<p>We are now ready to create the <strong class="source-inline">Subscription</strong> object.</p>
			<h3>Subscriptions</h3>
			<p>Subscriptions are <a id="_idIndexMarker808"/>used to subscribe clusters to a source repository and also define where the application will be deployed. They work like a glue between the deployment manifests (<strong class="source-inline">Channel</strong>) and the target clusters (<strong class="source-inline">PlacementRule</strong>). The following shows what our <strong class="source-inline">Subscription</strong> object looks like:</p>
			<pre class="source-code">apiVersion: apps.open-cluster-management.io/v1
kind: Subscription
metadata:
  name: cloud-api-subscription
  namespace: clouds-api-dev
  annotations:
    apps.open-cluster-management.io/git-path: sample-go-app/clouds-api/k8s/ <strong class="bold">#[1]</strong>
  labels:
    app: cloud-api <strong class="bold">#[2]</strong>
spec:
  channel: clouds-api-dev/cloud-api-github <strong class="bold">#[3]</strong>
  placement:
    placementRef: <strong class="bold">#[4]</strong>
      name: cloud-api-placement
      kind: PlacementRule</pre>
			<p>In the preceding code, we <a id="_idIndexMarker809"/>have highlighted some parts with numbers. Let’s take a look:</p>
			<ul>
				<li><strong class="bold">#[1]</strong>: Path for deployment manifests on Git.</li>
				<li><strong class="bold">#[2]</strong>: Subscription labels. Used later with the <strong class="source-inline">Application</strong> object.</li>
				<li><strong class="bold">#[3]</strong>: Channel that contains the Git repository, Helm, or object storage.</li>
				<li><strong class="bold">#[4]</strong>: <strong class="source-inline">PlacementRule</strong>, which describes where the application will be deployed.</li>
			</ul>
			<p>Finally, we can now create the ACM <strong class="source-inline">Application</strong> object.</p>
			<h3>Applications</h3>
			<p>Applications are <a id="_idIndexMarker810"/>objects used to describe a group of ACM resources that are needed to deploy an application. The following is the <strong class="source-inline">Application</strong> object of our sample:</p>
			<pre class="source-code">apiVersion: app.k8s.io/v1beta1
kind: Application
metadata:
  name: cloud-api
  namespace: clouds-api-dev
spec:
  componentKinds:
    - group: apps.open-cluster-management.io
      kind: Subscription
  descriptor: {}
  selector:
    matchExpressions: <strong class="bold">#[1]</strong>
      - key: app
        operator: In
        values:
          - cloud-api</pre>
			<p><strong class="bold">#[1]</strong> highlights <a id="_idIndexMarker811"/>subscriptions used by this application. In this case, subscriptions that have the <strong class="source-inline">app=cloud-api</strong> label will be used.</p>
			<p>Now that we understand the objects involved in application deployment, let’s create them on ACM.</p>
			<h3>Deploying the application</h3>
			<p>Deploying the <a id="_idIndexMarker812"/>objects is as simple as running an <strong class="source-inline">oc apply</strong> command from the hub cluster. Run the following commands from the hub cluster to deploy the application:</p>
			<pre class="source-code">$ git clone https://github.com/PacktPublishing/OpenShift-Multi-Cluster-Management-Handbook.git
$ cd OpenShift-Multi-Cluster-Management-Handbook/
$ oc apply -k chapter11/acm-model
namespace/clouds-api-dev created
application.app.k8s.io/cloud-api created
channel.apps.open-cluster-management.io/cloud-api-github created
placementrule.apps.open-cluster-management.io/cloud-api-placement created
subscription.apps.open-cluster-management.io/cloud-api-subscription created</pre>
			<p>You can check <a id="_idIndexMarker813"/>the application status by running the following command:</p>
			<pre class="source-code">$ oc get application -n clouds-api-dev
NAME        TYPE   VERSION   OWNER   READY   AGE
cloud-api                                    5m48s</pre>
			<p>You can alternatively deploy the application using the ACM web console. To do so, perform the following process:</p>
			<ol>
				<li value="1">Access the <strong class="bold">Applications</strong> | <strong class="bold">Create application</strong> | <strong class="bold">Subscription</strong> menu option.</li>
			</ol>
			<div>
				<div id="_idContainer227" class="IMG---Figure">
					<img src="image/B18015_11_33.jpg" alt="Figure 11.33 – Deploying an application using ACM "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.33 – Deploying an application using ACM</p>
			<ol>
				<li value="2">Fill out the form <a id="_idIndexMarker814"/>with the application data, including <strong class="bold">Name</strong> and <strong class="bold">Namespace</strong>, choose the <strong class="bold">Git</strong> repository, and then click on the <strong class="bold">Create</strong> button.</li>
			</ol>
			<div>
				<div id="_idContainer228" class="IMG---Figure">
					<img src="image/B18015_11_34.jpg" alt="Figure 11.34 – Filling out the application data "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.34 – Filling out the application data</p>
			<ol>
				<li value="3">Input the <a id="_idIndexMarker815"/> placement configuration as follows and click on the Create button.</li>
			</ol>
			<div>
				<div id="_idContainer229" class="IMG---Figure">
					<img src="image/B18015_11_35.jpg" alt="Figure 11.35 – Placement configuration details "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.35 – Placement configuration details</p>
			<ol>
				<li value="4">Click on <a id="_idIndexMarker816"/>the <strong class="bold">Topology</strong> tab to see an overview of the application deployed.</li>
			</ol>
			<div>
				<div id="_idContainer230" class="IMG---Figure">
					<img src="image/B18015_11_36.jpg" alt="Figure 11.36 – Application topology "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.36 – Application topology</p>
			<p>Now that you <a id="_idIndexMarker817"/>know how to deploy an application using the embedded ACM subscription, let’s see how we would do the same using OpenShift GitOps (Argo CD).</p>
			<h2 id="_idParaDest-231"><a id="_idTextAnchor240"/>OpenShift GitOps (Argo CD) and ApplicationSets</h2>
			<p>As already mentioned, you <a id="_idIndexMarker818"/>can alternatively deploy applications using ACM <a id="_idIndexMarker819"/>integrated with OpenShift GitOps (Argo CD) through an object called an <strong class="bold">ApplicationSet</strong>. In the <em class="italic">Configuring Argo CD for multi-cluster</em> section of <a href="B18015_10.xhtml#_idTextAnchor204"><em class="italic">Chapter 10</em></a>, <em class="italic">OpenShift GitOps – Argo CD</em>, we saw how to use the <strong class="source-inline">argocd</strong> command-line option to add managed clusters to Argo CD. You don’t need to do that when you use ACM, as ACM manages the external clusters and can add them to Argo CD for you. Instead, with ACM you will need to define the following objects in the hub cluster, in order to instruct ACM to configure Argo CD and add the managed clusters for you:</p>
			<ul>
				<li><strong class="source-inline">ManagedClusterSet</strong>: Group of clusters that share some common configurations, such as user access control and multi-cluster networking.</li>
				<li><strong class="source-inline">ManagedClusterSetBinding</strong>: Binds <strong class="source-inline">ManagedClusterSet</strong> to a namespace. In this particular case, we need to bind <strong class="source-inline">ManagedClusterSet</strong> to the <strong class="source-inline">openshift-gitops</strong> namespace.</li>
				<li><strong class="source-inline">Placement</strong>: Resource that defines predicates to select <strong class="source-inline">ManagedCluster</strong> from <strong class="source-inline">ManagedClusterSets</strong> to bind to <strong class="source-inline">GitOpsCluster</strong>.</li>
				<li><strong class="source-inline">GitOpsCluster</strong>: Register to OpenShift GitOps a group of managed clusters.</li>
			</ul>
			<p>We have sample <a id="_idIndexMarker820"/>YAML for all the previously listed objects in the <strong class="source-inline">chapter11/argocd</strong> folder <a id="_idIndexMarker821"/>of our GitHub repository. Go ahead and use the following commands to apply those objects in your hub cluster:</p>
			<pre class="source-code">$ git clone https://github.com/PacktPublishing/OpenShift-Multi-Cluster-Management-Handbook.git
$ cd OpenShift-Multi-Cluster-Management-Handbook/
$ oc apply -k chapter11/argocd
gitopscluster.apps.open-cluster-management.io/argo-acm-clusters created
managedclusterset.cluster.open-cluster-management.io/all-clusters created
managedclustersetbinding.cluster.open-cluster-management.io/all-clusters created
placement.cluster.open-cluster-management.io/all-clusters created</pre>
			<p>Now, access your ACM and go to <strong class="bold">Clusters</strong> | <strong class="bold">Cluster sets</strong> (tab) | <strong class="bold">all-clusters</strong> | <strong class="bold">Managed clusters</strong> (tab), and then click on the <strong class="bold">Manage resource assignments</strong> button. On this page, select all your clusters and click on the <strong class="bold">Review</strong> button and then <strong class="bold">Save</strong>.</p>
			<div>
				<div id="_idContainer231" class="IMG---Figure">
					<img src="image/B18015_11_37.jpg" alt="Figure 11.37 – Adding clusters to a cluster set "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.37 – Adding clusters to a cluster set</p>
			<p>Finally, we can go <a id="_idIndexMarker822"/>ahead and create an ApplicationSet that uses a <strong class="source-inline">Placement</strong> object <a id="_idIndexMarker823"/>to deploy the application in all clusters that have the <strong class="source-inline">env=dev</strong> label:</p>
			<pre class="source-code">$ oc apply -f chapter11/argocd/applicationset.yaml
applicationset.argoproj.io/cloud-api created
placement.cluster.open-cluster-management.io/cloud-api-placement created</pre>
			<p>After a couple of minutes, you should see the application deployed from the application <strong class="bold">Overview</strong>/<strong class="bold">Topology</strong> view.</p>
			<div>
				<div id="_idContainer232" class="IMG---Figure">
					<img src="image/B18015_11_38.jpg" alt="Figure 11.38 – ApplicationSet topology "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.38 – ApplicationSet topology</p>
			<p>The <strong class="bold">Topology</strong> view allows you <a id="_idIndexMarker824"/>to see your application deployed into multiple clusters from a single pane. This feature is really helpful for applications that are deployed over several clusters, as you can easily see how the application is behaving in all the clusters from a single and simple view.</p>
			<p>This concludes <a id="_idIndexMarker825"/>our overview of the application life cycle management feature <a id="_idIndexMarker826"/>of Red Hat ACM. In this section, you have seen how ACM can help you deploy applications into multiple managed clusters by using either the Application Subscription model or OpenShift GitOps (Argo CD). Next, you are going to see how to use policies on ACM to keep your clusters compliant according to your organization’s business and security needs.</p>
			<h1 id="_idParaDest-232"><a id="_idTextAnchor241"/>Governance using Red Hat ACM</h1>
			<p>We have been <a id="_idIndexMarker827"/>discussing the challenges that large enterprises face in keeping different environments consistent a lot in this book. The ACM governance feature can play a crucial role in your strategy to maintain secure and consistent environments, no matter where they are running. The ACM governance feature allows you to define policies for a set of clusters and inform or enforce when clusters become non-compliant.</p>
			<p>To define policies in ACM, you need to create three objects:</p>
			<ul>
				<li><strong class="bold">Policy</strong>: Define the policy and remediation action that will be performed (inform or enforce).</li>
				<li><strong class="bold">PlacementBinding</strong>: Bind a policy into a PlacementRule.</li>
				<li><strong class="bold">PlacementRule</strong>: Rules that define which clusters the policy will be applied to.</li>
			</ul>
			<p>You can see an example of a policy to check etcd encryption in all managed clusters on our GitHub. The following diagram shows what the interaction between the ACM policy objects looks like:</p>
			<div>
				<div id="_idContainer233" class="IMG---Figure">
					<img src="image/B18015_11_39.jpg" alt="Figure 11.39 – ACM policy model "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.39 – ACM policy model</p>
			<p>Run the following command to create the policy:</p>
			<pre class="source-code">$ git clone https://github.com/PacktPublishing/OpenShift-Multi-Cluster-Management-Handbook.git
$ cd OpenShift-Multi-Cluster-Management-Handbook/
$ oc apply -k chapter11/governance
namespace/acm-policies-sample created
placementrule.apps.open-cluster-management.io/placement-policy-etcdencryption created
placementbinding.policy.open-cluster-management.io/binding-policy-etcdencryption created
policy.policy.open-cluster-management.io/policy-etcdencryption created</pre>
			<p>Now, access <a id="_idIndexMarker828"/>the <strong class="bold">Governance</strong> feature on the ACM web console to check the policy we just put in place.</p>
			<div>
				<div id="_idContainer234" class="IMG---Figure">
					<img src="image/B18015_11_40.jpg" alt="Figure 11.40 – ACM governance console "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.40 – ACM governance console</p>
			<p>Click on <strong class="bold">Policies</strong> and access <strong class="bold">policy-etcdencryption</strong> to see the details.</p>
			<div>
				<div id="_idContainer235" class="IMG---Figure">
					<img src="image/B18015_11_41.jpg" alt="Figure 11.41 – ACM governance – violation details "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.41 – ACM governance – violation details</p>
			<p>In the <em class="italic">Further reading</em> section of this chapter, you will find a link to a repository that contains several reusable policies that you can use as is or as samples to create your own policies.</p>
			<p>As you have <a id="_idIndexMarker829"/>seen, the ACM governance feature is simple to understand and use. Now think about the policies that you would like to have monitored or enforced in your clusters and start deploying your own policies!</p>
			<h1 id="_idParaDest-233"><a id="_idTextAnchor242"/>Multi-cluster observability with Red Hat ACM</h1>
			<p><strong class="bold">Multicluster observability</strong> is an ACM <a id="_idIndexMarker830"/>feature that is intended to be a central hub for metrics, alerting, and <a id="_idIndexMarker831"/>monitoring systems <a id="_idIndexMarker832"/>for all clusters, whether hub clusters or managed clusters.</p>
			<p>As this tool handles a large amount of data, it is recommended to provide fast disks as its storage backend. Red Hat has tested and fully supports the solution if adopted in conjunction with Red Hat OpenShift Data Foundation.</p>
			<p>Although Red Hat recommends doing so, the prerequisite is a storage solution that provides <strong class="bold">object</strong>/<strong class="bold">S3-type storage</strong>, such as those commonly found in most cloud providers (such as Amazon S3).</p>
			<h2 id="_idParaDest-234"><a id="_idTextAnchor243"/>Prerequisites</h2>
			<p>Since observability is a <a id="_idIndexMarker833"/>feature of an ACM operator, there aren’t many prerequisites. The following are the requirements:</p>
			<ul>
				<li>Enable the observability feature on a connected Red Hat OpenShift cluster.</li>
				<li>Configure an object store from a storage provider. Some of the supported object storage types are as follows:<ul><li>Red Hat Container Storage</li>
<li>AWS S3</li>
<li>Red Hat Ceph (S3-compatible API)</li>
<li>Google Cloud Storage</li>
<li>Azure Storage</li>
<li>Red Hat on IBM Cloud</li>
</ul></li>
			</ul>
			<p class="callout-heading">Important Note</p>
			<p class="callout">It is important to configure encryption when you have sensitive data persisted. The Thanos documentation has a definition of supported object stores. Check the link in the <em class="italic">Further reading</em> section at the end of this chapter.</p>
			<h2 id="_idParaDest-235"><a id="_idTextAnchor244"/>Enabling the observability service</h2>
			<p>Since observability <a id="_idIndexMarker834"/>runs on top of ACM, its creation <a id="_idIndexMarker835"/>depends on a <strong class="bold">Custom Resource</strong> (<strong class="bold">CR</strong>) that will trigger the creation of the <strong class="bold">Multicluster Observability</strong> instance.</p>
			<p>The following diagram demonstrates a high-level architecture of the objects involved in the observability solution. It serves as a reference for which objects are created when enabling the observability service:</p>
			<div>
				<div id="_idContainer236" class="IMG---Figure">
					<img src="image/B18015_11_42.jpg" alt="Figure 11.42 – Creating MultiClusterHub "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.42 – Creating MultiClusterHub</p>
			<p>Follow these instructions to enable multicluster observability:</p>
			<ol>
				<li value="1">For this example, we <a id="_idIndexMarker836"/>used an OpenShift hub cluster deployed on top of Microsoft Azure, so you must to set some variables in a terminal that will help you configure Azure dynamic storage to be used as the storage solution:<p class="source-code">$ LOCATION=eastus <strong class="bold">#[1]</strong></p><p class="source-code">$ RESOURCEGROUP=aro-rg <strong class="bold">#[2]</strong></p><p class="source-code">$ CLUSTER=MyHubCluster <strong class="bold">#[3]</strong></p><p class="source-code">$ STORAGEBLOB=observsto <strong class="bold">#[4]</strong></p><p class="source-code">$ az storage account create --name $STORAGEBLOB --resource-group $RESOURCEGROUP --location $LOCATION --sku Standard_ZRS --kind StorageV2 <strong class="bold">#[5]</strong></p><p class="source-code">$ az ad signed-in-user show --query objectID –o tsv | az role assignment create --role "Storage Blob Data Contributor" --assignee @- --scope "subscriptions/11111111-2222-a1a1-d3d3-12mn12mn12mn/resourceGroups/$RESOURCEGROUP/providers/Microsoft.Storage/storageAccountes/$STORAGEBLOB" <strong class="bold">#[6]</strong></p><p class="source-code">$ az storage container create --account-name $STORAGEBLOB --name container-observ --auth-mode login <strong class="bold">#[7]</strong></p><p class="source-code">     "created": true</p><p class="source-code">$ az storage account show-connection-string –name $STORAGEBLOB</p><p class="source-code">"connectionString": "DefaultEndpointsProtocol=https;EndpointSuffix=conre.windows.net;AccountName=observsto;AccountKey=sfsfoefoosdfojevntoaa/dsafojosjfsodfsafdsaf==" <strong class="bold">#[8]</strong></p></li>
			</ol>
			<p>Let’s take a look at <a id="_idIndexMarker837"/>what the highlighted numbers mean:</p>
			<ul>
				<li><strong class="bold">#[1]</strong>: Hub cluster zone for Microsoft Azure</li>
				<li><strong class="bold">#[2]</strong>: Resource group name for Microsoft Azure</li>
				<li><strong class="bold">#[3]</strong>: Cluster name for the hub cluster</li>
				<li><strong class="bold">#[4]</strong>: Storage account name</li>
				<li><strong class="bold">#[5]</strong>: Command to create the storage on Microsoft Azure</li>
				<li><strong class="bold">#[6]</strong>: Attribute storage role for OpenShift to handle storage operations for observability</li>
				<li><strong class="bold">#[7]</strong>: This command creates a container inside the storage blob account, that will be used to store the data for ACM observability</li>
				<li><strong class="bold">#[8]</strong>: Azure CLI instruction to get the connection string for storage</li>
			</ul>
			<ol>
				<li value="2">Create a namespace in the hub cluster for observability. We will create the namespace in the terminal; otherwise, you can also create it in the OpenShift web console UI:<p class="source-code">$ oc create namespace open-cluster-management-observability</p></li>
				<li>Now, it is time to <a id="_idIndexMarker838"/>create a secret with the connection string we got in the previous step (instruction <strong class="bold">#[8]</strong>). The complete YAML files are available in our GitHub repository for your reference and use:<p class="source-code">$DOCKER_CONFIG_JSON='oc extract secret/pull-secret –n openshift-config --to=.' <strong class="bold">#[1]</strong></p><p class="source-code">.dockerconfigjson</p><p class="source-code">$ oc create secret generic multiclusterhub-operator-pull-secret –n open-cluster-management-observability --from-literal=.dockerconfigjson="DOCKER_CONFIG_JSON" --type= kubernetes.io/dockerconfigjson <strong class="bold">#[2]</strong></p><p class="source-code">(.. omitted ..)</p><p class="source-code">  thanos.yaml: |</p><p class="source-code">    type: AZURE</p><p class="source-code">    config:</p><p class="source-code"><strong class="bold">      storage_account: observsto  #[3]</strong></p><p class="source-code"><strong class="bold">      storage_account_key: sfsfoefoosdfojevntoaa/dsafojosjfsodfsafdsaf== #[3]</strong></p><p class="source-code"><strong class="bold">      container: container-observ #[3]</strong></p><p class="source-code">      endpoint: blob.core.windows.net</p><p class="source-code">      max_retries: 0</p><p class="source-code">(.. omitted ..)</p></li>
			</ol>
			<p>Let’s take a look at what the highlighted numbers mean:</p>
			<ul>
				<li><strong class="bold">#[1]</strong>: Environment variable for current Docker pull secret.</li>
				<li><strong class="bold">#[2]</strong>: Inject the <strong class="source-inline">dockerconfigjson</strong> file into the secret for <strong class="source-inline">multiclusterhub</strong>.</li>
				<li><strong class="bold">#[3]</strong>: Data from previous commands</li>
			</ul>
			<p>Configuration file available at <a href="https://github.com/PacktPublishing/OpenShift-Multi-Cluster-Management-Handbook/blob/main/chapter11/acm-observability/thanos-object-storage.yaml">https://github.com/PacktPublishing/OpenShift-Multi-Cluster-Management-Handbook/blob/main/chapter11/acm-observability/thanos-object-storage.yaml</a>.</p>
			<ol>
				<li value="4">Now you have the <a id="_idIndexMarker839"/>required storage to be used with observability, so it’s time to create a <strong class="source-inline">MulticlusterObservability</strong> object. Go back to the <strong class="bold">Advanced Cluster Management for Kubernetes</strong> operator, which we installed at the beginning of this chapter, access the <strong class="bold">MultiClusterObservability</strong> tab, and click on the <strong class="bold">Create MultiClusterObservability</strong> button.</li>
			</ol>
			<div>
				<div id="_idContainer237" class="IMG---Figure">
					<img src="image/B18015_11_43.jpg" alt="Figure 11.43 – MultiClusterObservability creation "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.43 – MultiClusterObservability creation</p>
			<ol>
				<li value="5">Keep the CR as default and then click on <strong class="bold">Create</strong>.</li>
			</ol>
			<div>
				<div id="_idContainer238" class="IMG---Figure">
					<img src="image/B18015_11_44.jpg" alt="Figure 11.44 – MultiClusterObservability "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.44 – MultiClusterObservability</p>
			<ol>
				<li value="6">Wait until the <a id="_idIndexMarker840"/>observability instance status is <strong class="bold">Ready</strong>.</li>
			</ol>
			<div>
				<div id="_idContainer239" class="IMG---Figure">
					<img src="image/B18015_11_45.jpg" alt="Figure 11.45 – Configuring an instance for MultiClusterObservability "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.45 – Configuring an instance for MultiClusterObservability</p>
			<ol>
				<li value="7">Now you can see, upon <a id="_idIndexMarker841"/>navigating to <strong class="bold">Main Menu</strong> | <strong class="bold">Overview</strong>, a route for Grafana’s observability dashboard.</li>
			</ol>
			<div>
				<div id="_idContainer240" class="IMG---Figure">
					<img src="image/B18015_11_46.jpg" alt="Figure 11.46 – Configuring an instance for MultiClusterObservability "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.46 – Configuring an instance for MultiClusterObservability</p>
			<p><strong class="bold">#[1]</strong>: Notice that Observability option is now available in Grafana link.</p>
			<ol>
				<li value="8">Click on <strong class="bold">Grafana</strong> to see <a id="_idIndexMarker842"/>some great dashboards that aggregate metrics that come from multiple clusters.</li>
			</ol>
			<div>
				<div id="_idContainer241" class="IMG---Figure">
					<img src="image/B18015_11_47.jpg" alt="Figure 11.47 – MultiClusterObservability dashboard view sample "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.47 – MultiClusterObservability dashboard view sample</p>
			<p>Now, you can count on <a id="_idIndexMarker843"/>this amazing ACM feature to help you and your organization monitor all your Kubernetes managed clusters from a central pane, independent of the infrastructure or cloud provider they are running over. In the next subsection, we will show you an option that gives you even more control over your cluster.</p>
			<h3>Configuring AlertManager to send alerts</h3>
			<p>As we have <a id="_idIndexMarker844"/>seen so far, observability <a id="_idIndexMarker845"/>can be a great ally for monitoring all your clusters from a central view, but now we will go even further and show you the <em class="italic">icing on the cake</em>, that will be one thing more to help you to manage your clusters.</p>
			<p>As shown in <em class="italic">Figure 11.42</em>, <strong class="bold">AlertManager</strong> is a resource that is part of the observability architecture. We will show a <a id="_idIndexMarker846"/>sample now that you can use to enable this feature and get alerts from all managed clusters.</p>
			<p>AlertManager is a tool that can <a id="_idIndexMarker847"/>send alerts to a set of other systems, such as email, PagerDuty, Opsgenie, WeChat, Telegram, Slack, and <a id="_idIndexMarker848"/>also your custom webhooks. For this example, we will use Slack, a short-messaging tool, as a receiver for all of our alerts.</p>
			<h3>Prerequisites</h3>
			<p>First, you will <a id="_idIndexMarker849"/>need the Slack app to set up alerts, and then point to <a href="https://api.slack.com/messaging/webhooks">https://api.slack.com/messaging/webhooks</a> and follow the instructions to create and configure a channel. When you finish configuring the Slack app, you will get a webhook endpoint similar to the following: <strong class="source-inline">https://hooks.slack.com/services/T03ECLDORAS04/B03DVP1Q91D/R4Oabcioek</strong>. Save the webhook address in a safe place as it will be used in the next steps.</p>
			<h3>Configuring AlertManager</h3>
			<p>To configure AlertManager, you will need to create a new file named <strong class="source-inline">alertmanager.yaml</strong>. This <a id="_idIndexMarker850"/>file will have the <a id="_idIndexMarker851"/>webhook that you saved previously. The complete YAML files are available in our GitHub repository for your reference and use (github repository at <a href="https://github.com/PacktPublishing/OpenShift-Multi-Cluster-Management-Handbook/blob/main/chapter11/acm-observability/alertmanager.yaml">https://github.com/PacktPublishing/OpenShift-Multi-Cluster-Management-Handbook/blob/main/chapter11/acm-observability/alertmanager.yaml</a>):</p>
			<pre class="source-code">global:
  slack_api_url: 'https://hooks.slack.com/services/T03ECLDORAS04/B03DVP1Q91D/R4Oabcioek' <strong class="bold">#[1]</strong>
  resolve_timeout: 1m
route:
  rec<a id="_idTextAnchor245"/>eiver: 'slack-notifications'
(.. omitted ..)
  routes:
    - receiver: slack-notifications <strong class="bold">#[2]</strong>
      match:
        severity: critical|warning <strong class="bold">#[3]</strong>
receivers:
- name: 'slack-notifications'
  slack_configs:
  - channel: '#alertmanager-service' <strong class="bold">#[4]</strong>
    send_resolved: true
    icon_url: https://avatars3.githubuserco<a id="_idTextAnchor246"/>ntent.com/u/3380462
    title: |-
     [{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ end }}] {{ .CommonLabels.alertname }}<a id="_idTextAnchor247"/> for {{ .CommonLabels.job }}
(.. omitted ..)</pre>
			<p>In the preceding <a id="_idIndexMarker852"/>code, we have highlighted some <a id="_idIndexMarker853"/>parts with numbers. Let’s take a look:</p>
			<ul>
				<li><strong class="bold">#[1]</strong>: Webhook Slack API URL</li>
				<li><strong class="bold">#[2]</strong>: Name of the receiver for alerts</li>
				<li><strong class="bold">#[3]</strong>: Filter critical or warning alerts</li>
				<li><strong class="bold">#[4]</strong>: Slack channel inside the workspace</li>
			</ul>
			<p>The next step is to apply the new <strong class="source-inline">alertmanager.yaml</strong> file to the ACM observability namespace:</p>
			<pre class="source-code">$ oc -n open-cluster-management-observability create secret generic alertmanager-config --from-file=alertmanager.yaml --dry-run=client -o=yaml |  oc -n open-cluster-management-observability replace secret --filename=-</pre>
			<p>The <strong class="source-inline">alertmanager.yaml</strong> file must be in the same execution directory. Wait until the new AlertManager pods are created and you will receive new <strong class="source-inline">[Firing]</strong> or <strong class="source-inline">[Resolved]</strong> alerts on the configured channel. See an example in the following screenshot:</p>
			<div>
				<div id="_idContainer242" class="IMG---Figure">
					<img src="image/Image91965.jpg" alt="Figure 11.48 – AlertManager multicluster alerts"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.48 – AlertManager multicluster alerts</p>
			<p>Here we go; we <a id="_idIndexMarker854"/>have our AlertManager set and <a id="_idIndexMarker855"/>sending alerts to a Slack channel! Therefore, in this section, you have seen the observability feature, from the installation to configuration and use. This should help you in your multi-cluster journey to monitor all your clusters, no matter which provider they are running in.</p>
			<h1 id="_idParaDest-236"><a id="_idTextAnchor248"/>Summary</h1>
			<p>In this chapter, you have been introduced to Red Hat ACM and have seen an overview of its features and how it can help you manage several clusters. Now you understand that Red Hat ACM provides features to manage multiple clusters, keep them compliant with the policies you define for them, deploy workloads into many of them at once, and also monitor all of them from a central pane.</p>
			<p>We also walked through the ACM installation process, provisioned a new cluster on AWS using ACM, saw how to deploy an application by using either the embedded ACM Application Subscription model or integrated with Argo CD, had a brief overview of the ACM governance feature, and, finally, enabled the observability feature to monitor multiple clusters and aggregate metrics on ACM.</p>
			<p>In today’s world, handling multiple clusters over multiple providers, either on-premises or in the cloud, is a reality in most companies; therefore, a multi-cluster management tool is a must-have. Red Hat ACM can provide you with the features you need to manage all clusters from a centralized place. We encourage you to explore and start using ACM now to reap all the benefits of this great tool.</p>
			<p>Continue to the next chapter to learn how Red Hat Advanced Cluster Security can help you to keep your Kubernetes and OpenShift clusters secure.</p>
			<h1 id="_idParaDest-237"><a id="_idTextAnchor249"/>Further reading</h1>
			<p>Looking for more information? Check out the following references to get more information about Red Hat ACM:</p>
			<ul>
				<li><em class="italic">Red Hat Advanced Cluster Management documentation</em>: <a href="https://access.redhat.com/documentation/en-us/red_hat_advanced_cluster_management_for_kubernetes/2.5">https://access.redhat.com/documentation/en-us/red_hat_advanced_cluster_management_for_kubernetes/2.5</a></li>
				<li><em class="italic">Red Hat ACM supportability matrix</em>: <a href="https://access.redhat.com/articles/6663461">https://access.redhat.com/articles/6663461</a></li>
				<li><em class="italic">Red Hat Advanced Cluster Management observability prerequisites:</em> <a href="https://access.redhat.com/documentation/en-us/red_hat_advanced_cluster_management_for_kubernetes/2.3/html-single/observability/index#prerequisites-observability">https://access.redhat.com/documentation/en-us/red_hat_advanced_cluster_management_for_kubernetes/2.3/html-single/observability/index#prerequisites-observability</a></li>
				<li><em class="italic">Supported object stores for Thanos</em>: <a href="https://thanos.io/tip/thanos/storage.md/#supported-clients">https://thanos.io/tip/thanos/storage.md/#supported-clients</a></li>
				<li><em class="italic">Red Hat ACM policy collection:</em> <a href="https://github.com/open-cluster-management/policy-collection">https://github.com/open-cluster-management/policy-collection</a></li>
				<li><em class="italic">Integrating Red Hat ACM with Ansible for cluster deployment and upgrade:</em> <a href="https://access.redhat.com/documentation/en-us/red_hat_advanced_cluster_management_for_kubernetes/2.5/html/clusters/managing-your-clusters#ansible-config-cluster">https://access.redhat.com/documentation/en-us/red_hat_advanced_cluster_management_for_kubernetes/2.5/html/clusters/managing-your-clusters#ansible-config-cluster</a></li>
				<li><em class="italic">Integrating Red Hat ACM with Ansible for application management:</em> <a href="https://access.redhat.com/documentation/en-us/red_hat_advanced_cluster_management_for_kubernetes/2.5/html/applications/managing-applications#setting-up-ansible">https://access.redhat.com/documentation/en-us/red_hat_advanced_cluster_management_for_kubernetes/2.5/html/applications/managing-applications#setting-up-ansible</a></li>
				<li><em class="italic">Creating policy violation automation using Ansible:</em> <a href="https://access.redhat.com/documentation/en-us/red_hat_advanced_cluster_management_for_kubernetes/2.5/html/governance/governance#configuring-governance-ansible">https://access.redhat.com/documentation/en-us/red_hat_advanced_cluster_management_for_kubernetes/2.5/html/governance/governance#configuring-governance-ansible</a></li>
			</ul>
		</div>
		<div>
			<div id="_idContainer244">
			</div>
		</div>


		<div>
			<div id="_idContainer245" class="Basic-Graphics-Frame">
			</div>
		</div>
		<div>
			<div id="_idContainer246">
			</div>
		</div>
		<div id="_idContainer247" class="Content">
			<h1 id="_idParaDest-238"><a id="_idTextAnchor250"/>Part 4 – A Taste of Multi-Cluster Implementation and Security Compliance</h1>
			<p>In this part, you will take a dive into some great tools used to manage multiple clusters and to enable an organization to scale its implementation into the hybrid cloud world.</p>
			<p>This part of the book comprises the following chapters:</p>
			<ul>
				<li><a href="B18015_12.xhtml#_idTextAnchor251"><em class="italic">Chapter 12</em></a>, <em class="italic">OpenShift Multi-Cluster Security</em></li>
				<li><a href="B18015_13.xhtml#_idTextAnchor275"><em class="italic">Chapter 13</em></a>, <em class="italic">OpenShift Plus – a Multi-Cluster Enterprise-Ready Solution</em></li>
				<li><a href="B18015_14.xhtml#_idTextAnchor290"><em class="italic">Chapter 14</em></a>, <em class="italic">Building a Cloud-Native Use Case on a Hybrid Cloud Environment</em></li>
			</ul>
		</div>
</body></html>