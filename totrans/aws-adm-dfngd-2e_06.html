<html><head></head><body><div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Access Control Using AWS IAM and AWS Organizations</h1>
                </header>
            
            <article>
                
<p>In the previous chapter, we learnt and explored about how you can leverage two AWS services, namely AWS Config and AWS CloudTrail, to govern your Cloud environments. In this chapter, we will be continuing on the security journey by revisiting AWS IAM along with a few useful features as well as learning a bit about yet another service in the form of AWS Organizations!</p>
<p>Keeping this in mind, let us have a quick look at the various topics that we will be covering in this chapter:</p>
<ul>
<li><span>What's new with AWS IAM</span></li>
<li>Creating policies using the IAM visual editor</li>
<li>Testing your IAM policies using the IAM <span>Policy Simulator</span></li>
<li>Introducing AWS Organizations with a few essential concepts and terminologies</li>
<li>Creating your own organizations using the AWS Management Console as well as the AWS CLI</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">What's new with AWS IAM</h1>
                </header>
            
            <article>
                
<p>Before we look at some of the recent enhancements made to IAM, here is a quick crash course on IAM for the uninitiated. AWS Identity and Access Management or IAM is a web service that provides secured access control mechanisms for all AWS services. You can use IAM to create users and groups, assigning users specific permissions and policies, and a lot more. The best part of all this is that IAM is completely FREE. Yup! Not a penny is required to use it.</p>
<p>Let's quickly look at some interesting features provided by AWS IAM:</p>
<ul>
<li><strong>Multi-factor authentication</strong>: IAM allows you to provide two-factor authentications to users for added security. This means that now, along with your password, you will also have to provide a secret key/pin from a special hardware device, such as a hard token, or even from software apps such as Google Authenticator.</li>
<li><strong>Integration with other AWS products</strong>: IAM integrates with almost all AWS products and services and can be used to provide granular access rights and permissions to each service as required.</li>
<li><strong>Identity federation</strong>: Do you have an on-premise Active Directory already that has users and groups created? Not a problem, as IAM can be integrated with an on-premise AD to provide access to your AWS account using a few simple steps.</li>
<li><strong>Access mechanisms</strong>: IAM can be accessed using a variety of different tools, the most common and frequently used being the AWS Management Console. Apart from this, IAM can also be accessed via the AWS CLI, via SDKs that support different platforms and programming languages such as Java, .NET, Python, Ruby, and so on, and programmatically via a secured HTTPS API as well.</li>
</ul>
<p>With the basics in mind, let us now look at some interesting and useful enhancements made to IAM in recent years.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Using the visual editor to create IAM policies</h1>
                </header>
            
            <article>
                
<p>IAM policies are used to define permissions for your IAM entities such as users, groups, and roles. Each policy that you create consists of one or more statements that include the following elements:</p>
<ul>
<li><strong>Effect</strong>: This element determines whether a policy statement allows or explicitly denies access to a particular IAM resource.</li>
<li><strong>Action</strong>: Actions are used to define AWS service actions within a policy, for example; you can specify Amazon S3 related actions such as list buckets, read or write to buckets, and so on.</li>
<li><strong>Resource</strong>: Resources are the AWS services or individual entities to which the actions apply.</li>
<li><strong>Condition</strong>: Conditions are used to define when a particular permission is allowed or denied on a resource. You can leverage one or more conditions to provide additional granular security to your AWS resources.</li>
</ul>
<p>Once a policy is created, you essentially attach it to your resource which can be an IAM user, group or even a role. However, creating custom and granular IAM policies can prove to be a challenge at times especially if you are just getting started with AWS. To address this, AWS has provided a new and improved visual editor using which you can easily create customized policies on your own:</p>
<ol>
<li>To get started with the visual editor, first log in to the IAM Management Console by selecting this URL <a href="https://console.aws.amazon.com/iam/home">https://console.aws.amazon.com/iam/home</a>.</li>
<li>Once logged in, select the <span class="packt_screen">Policies</span> option from the navigation pane. This will display a page that lists both the <span class="packt_screen">AWS Managed</span> as well as the <span class="packt_screen">Customer Managed</span> policies. To create a policy, simply select the <span class="packt_screen">Create policy</span> option. For this scenario, let us create a simple S3 policy that grants full access to only a single folder present within an S3 bucket.</li>
<li>On the <span class="packt_screen">Create policy</span> page, ensure that the <span class="packt_screen">Visual editor</span> tab is selected and click on the <span class="packt_screen">Choose a service</span> option to filter and pick out Amazon S3.</li>
</ol>
<ol start="4">
<li>With the <span class="packt_screen">Service</span> selected, next click on the <span class="packt_screen">Select actions</span> options to add the appropriate actions for our policy. Here, you can select the appropriate <span class="packt_screen">Access levels</span> for your resource by either opting to add the actions <em>manually</em> or even provide individual permissions by selecting the correct access rights from each individual <span class="packt_screen">Access levels</span>. In this case, I have opted to select the entire <span class="packt_screen">List</span> level for permissions and the <kbd>s3:GetObject</kbd> from the <span class="packt_screen">Read</span> access level followed by the <kbd>s3:PutObject</kbd>, and the <kbd>s3:DeleteObject</kbd> permissions from the <span class="packt_screen">Write</span> access level. Following is screenshot of the <span class="packt_screen">Actions</span> selected for your reference:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="394" width="794" src="Images/dee5eded-e465-466d-9aef-fe4f83254c4e.png"/></div>
<div class="packt_infobox">By default, all actions selected here will be allowed. To deny actions explicitly, select the <span class="packt_screen">Switch to deny permissions</span> option provided in the <span class="packt_screen">Actions</span> section.</div>
<ol start="5">
<li>Once completed, you can now select the <span class="packt_screen">Resources</span> section to add either all or specific resources to your new set of permissions. In this case, we will add the set of permissions to a specific bucket called <strong>useast-prod-stuff-01</strong>. To do so, select the <span class="packt_screen">Add ARN</span> option adjoining to the bucket field.</li>
<li>In the <span class="packt_screen">Add ARN(s)</span> dialog box, type in the name of the selected bucket in the <span class="packt_screen">Bucket name</span> field as depicted in the following screenshot. Once done, select <span class="packt_screen">Add</span> to complete the process:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="265" width="609" src="Images/cccd14f2-0fee-4adb-9fb2-a3ce51fd4445.png"/></div>
<ol start="7">
<li>Once done, you can optionally choose to add permissions to an object level as well. Click on the <span class="packt_screen">Add ARN</span> option adjoining the <span class="packt_screen">object</span> field and fill in the required information as we performed in the previous steps. The only addition here is that you can provide an additional <em>folder name</em> in the <span class="packt_screen">Object name</span> field for a more granular permission control. Once done, click on <span class="packt_screen">Add</span> to complete the process. Here is a screenshot of the completed resource allocation for our policy:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="Images/28a65ad5-7662-44fc-ab42-d1c9a533ef62.png" width="792" height="216"/></div>
<ol start="8">
<li>With the permissions and the resources set, you can optionally choose to add <span class="packt_screen">Conditions</span> as well to your policy. To do so, select the <span class="packt_screen">Specify request conditions</span> option. Here you can opt to select and edit conditions that match your requirements. For example, for this particular policy, we want the user to access the particular S3 bucket only from within an organization's internal network. To do so, select the <span class="packt_screen">Source IP</span> option and type in suitable IP range or a single IP address based on your organization's IP range.</li>
</ol>
<ol start="9">
<li>You can also add additional conditions to your policy by selecting the <span class="packt_screen">Add request condition</span> option. Here, you can customize and specify a granular condition using a combination of <span class="packt_screen">Condition key</span>, <span class="packt_screen">Qualifier</span>, and <span class="packt_screen">Operator</span> as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="301" width="611" src="Images/5b5d61fc-38f7-4135-9ed9-b3b1359a7915.png"/></div>
<p style="padding-left: 90px">Here, the condition will check and allow only a particular AWS IAM user with the username <span class="packt_screen">joe</span> access to the S3 bucket. You can create your own custom conditions using the same approach and once done, click on <span class="packt_screen">Add</span> to complete the process.</p>
<ol start="10">
<li>With the permissions, resources, and conditions in place, select the <span class="packt_screen">Review policy</span> option to complete the policy creation process. Provide a suitable <span class="packt_screen">Name</span> and an optional <span class="packt_screen">Description</span> for your policy before selecting the <span class="packt_screen">Create policy</span> option.</li>
</ol>
<p>There you have it! Simple, wasn't it! You can use the same process to create highly customized and granular policies with relative ease. However, there is still one question that remains unanswered; how do we test and troubleshoot the policies without making any actual requests? That's exactly what the IAM <span>Policy Simulator</span> is all about!</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Testing IAM policies using the IAM Policy Simulator</h1>
                </header>
            
            <article>
                
<p>With your new policy created, the next steps would be to attach it to either an IAM user or group and test it out. But how do you effectively test your new policy without having to make any actual calls or requests? That's where the new IAM <span>Policy Simulator</span> comes into play!</p>
<p>The IAM <span>Policy Simulator</span> is used to evaluate IAM policies in order to determine the most effective set of permissions and actions that you can specify without making any actual resource calls whatsoever. The policy simulator internally leverages the same policy evaluation engine that processes real requests to AWS resources; however, it does not make any actual service request itself. Because of this nature, the policy simulator is unable to report any responses from the generated requests. All you get as a result is whether the policy would allow or deny a particular action. Here are a few ways using which you can leverage the IAM <span>Policy Simulator</span>:</p>
<ul>
<li><span>You can use the IAM <span>Policy Simulator</span> to test policies that are attached to existing users, groups and roles.</span></li>
<li>You can also use the simulator to test policies that are not attached yet to your resources by simply copying and executing them against the simulator</li>
<li>The simulator can also be used to test policies attached to various AWS resources such as Amazon S3 buckets, Amazon EC2 instances, and so on.</li>
<li>You can even use the simulator to test out real world scenarios by passing various context keys such as <em>IP addresses</em> or <em>usernames</em> that are passed alongside the conditions of a policy, and much more!</li>
</ul>
<p>To get started with the IAM <span>Policy Simulator</span>, simply select this URL <a href="https://policysim.aws.amazon.com/">https://policysim.aws.amazon.com/</a>. The policy simulator is a separate entity that runs outside your standard AWS Console. Use your standard AWS IAM credentials to log in to the policy simulator if asked:</p>
<ol>
<li>Once logged in, you can use the simulator to test and validate your existing user, group and even role-based policies. To start with, let us test the policy we created in our earlier section of this chapter! To do so, from the <span class="packt_screen">Users</span>, <span class="packt_screen">Groups</span>, and <span class="packt_screen">Roles</span> section, select the <span class="packt_screen">Users</span> from the drop-down list. You should see a list of users present in your AWS account.</li>
</ol>
<ol start="2">
<li>Select the appropriate <span class="packt_screen">User</span> that was used to attach the policy. In my case, the username was <kbd>joe</kbd>. Once selected, you will be shown all the policies that the user is currently associated with, in this case, we should see the custom S3 access policy that we created in the earlier section as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="219" width="321" src="Images/9770311d-142a-479b-8b98-a3165d016824.png"/></div>
<ol start="3">
<li>Select the policy to view its details. You can even choose to modify and test the policy here using the inbuilt <em>policy editor</em>, however do note that changes made to the policy here are not reflected in the actual policy.</li>
<li>With the policy selected, we are now ready to test it using the <span class="packt_screen">IAM Policy Simulator</span> section. Here's a snippet of the policy that we are going to test:</li>
</ol>
<pre>        { 
            "Sid": "VisualEditor0", 
            "Effect": "Allow", 
            "Action": [ 
                "s3:PutObject", 
                "s3:GetObject", 
                "s3:ListBucket", 
                "s3:DeleteObject" 
            ], 
            "Resource": [ 
                "arn:aws:s3:::useast-prod-stuff-01", 
                "arn:aws:s3:::useast-prod-stuff-01/Dummy" 
            ], 
            "Condition": { 
                "IpAddress": { 
                    "aws:SourceIp": "10.0.0.0/24" 
                }, 
                "ForAllValues:StringEqualsIfExists": { 
                    "aws:username": "joe" 
                } 
            } 
        } 
          . . . . . .  
 
            "Resource": "*", 
            "Condition": { 
                "IpAddress": { 
                    "aws:SourceIp": "10.0.0.0/24" 
                }, 
                "ForAllValues:StringEqualsIfExists": { 
                    "aws:username": "joe" 
                } 
            } 
        } </pre>
<p style="padding-left: 90px">As per our policy, only the user <kbd>joe</kbd> has the <kbd>s3:PutObject</kbd>, <kbd>s3:GetObject</kbd>, <kbd>s3:ListBucket</kbd>, <kbd>s3:DeleteObject</kbd> rights to the <kbd>useast-prod-stuff-01</kbd> bucket and that too if Joe is accessing the bucket from his organization's internal network (<kbd>10.0.0.0/24</kbd>).</p>
<ol start="5">
<li>To test the same, from the <span class="packt_screen">Select service</span> drop-down list, select <span class="packt_screen">Amazon S3</span> option. Next, match either of the actions using the <span class="packt_screen">Select actions</span> drop-down list. In this case, I've only selected the <kbd>s3:PutObject</kbd> action.</li>
<li>Once completed, from the <span class="packt_screen">Global Settings</span> section, type in the adjacent values against the <em>condition keys</em> that appear in the policy. In this case, type in the <span class="packt_screen">username</span> and the <span class="packt_screen">sourceip</span> as depicted in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="434" width="977" src="Images/ff4a14dc-1396-4be1-9e6e-11b7482e6c47.png"/></div>
<ol start="7">
<li>Next, from the <span class="packt_screen">Action Settings and Results</span> section, expand on the <span class="packt_screen">Resource</span> and type in the ARN of the resource against which the policy needs to be tested. In this case, this has to be the ARN of the S3 bucket <span class="packt_screen">arn:aws:s3:::useast-prod-stuff-01</span>. Once done, select the <span class="packt_screen">Run Simulation</span> option.</li>
</ol>
<p>With the simulation running, you should get either <em>allowed</em> or <em>denied</em> results based on the values you provide during the simulation. Feel free to change the <em>actions</em> as well as the <em>condition keys</em> and re-run the simulation. With each attempt, you can fine tune and troubleshoot your policy without having to actually pass any real requests to your resources.</p>
<p>You can also use the same policy simulator to test out new policies that are not yet attached to resources. To do so, you will first need to toggle from the current (default) mode of <span class="packt_screen">Existing policies</span> to <span class="packt_screen">New Policy</span> using the <span class="packt_screen">Mode</span> option provided at the very top of the simulator.</p>
<p>Once the <span class="packt_screen">New Policy</span> option is selected, you can use the <span class="packt_screen">Policy Sandbox</span> to create new policies and test them out the same way we did a while back. Remember, however, that policies created or edited here are not reflected back in AWS IAM.</p>
<p>With this, we come towards the end of this section. In the next section, we will be looking at how you can leverage AWS Organizations to effectively manage multiple AWS accounts with relative ease.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Introducing AWS Organizations</h1>
                </header>
            
            <article>
                
<p>So far we have been working out of a single AWS account that we use for development, testing as well as for production purposes, but this isn't the case with many organizations who end up with multiple AWS accounts for a variety of purposes such as multiple environments, compliance issues, and so on. Each account gets governed and managed in its own way with no centralized ownership or control.</p>
<p>AWS Organizations is a simple service that allows you to consolidate and manage multiple such AWS accounts all under one roof. It enables you to group AWS accounts into one or more collective <em>organizations</em> that you can create and manage as a whole.</p>
<p>Here's a quick look at some of AWS Organizations key concepts and terminologies:</p>
<ul>
<li><strong>Organizations</strong>: Organizations are consolidated views of all your AWS accounts in one place. Using organizations, you can centrally view and manage each of your AWS accounts under one roof. Organizations provide an additional functionality using which you can determine the type of organization you wish to create. There are two such feature sets, namely:</li>
<li><strong>Consolidated billing</strong>: A key feature provided by AWS Organizations is the ability to view and consolidate each AWS accounts billing under one organization. This feature is selected by default when you first create an organization and only provides you with the consolidated billing views. For leveraging all of the AWS Organizations advanced features, you will have to select the <span class="packt_screen">All features</span> option.</li>
<li><strong>All features</strong>: This feature set provides the full functionality of AWS Organizations, including consolidated billing and many other features that provide you with better control over your individual accounts. Using this feature set, you can restrict certain AWS services from accounts; modify access roles, and much more.</li>
<li><strong>Root</strong>: The root is the primary container for all your individual accounts used within AWS. AWS Organizations automatically creates a default root element for you when you first create an organization. Any changes or policies applied at the root level propagate to its subsequent child elements as well.</li>
<li><strong>Organizational Unit</strong> (<strong>OU</strong>): OUs are containers for one or more AWS accounts. You can branch multiple OUs from a single OU as well, however the end of an OU is always an account. Here is a representational diagram depicting the interactions between an organization, the root element, OUs, and various AWS accounts:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><strong><img height="738" width="1223" src="Images/25cd1cdc-8bb6-46bc-adbe-16f3d5c34953.png"/></strong></div>
<ul>
<li><strong>Accounts</strong>: Accounts are standard AWS accounts that contain your AWS resources. When creating an organization, AWS marks the account from where the organization gets created as the <em>master account</em>. Any additional accounts added later to this organization are termed as <em>member accounts</em>. The master account is also responsible for overseeing the consolidated billing and payments for the rest member accounts as well as useful for inviting other AWS accounts into the organization, creating OUs, managing policies, and so on.</li>
<li><strong>Service Control Policy</strong> (<strong>SCP</strong>): SCPs are essentially policies that are attached to roots, accounts or OUs for specifying services and actions that the particular account's or OU's user can use. For example, you can use an SCP on an account that is created with HIPAA compliance in mind and you want to restrict all users of this account to use only HIPAA compliant AWS services, and so on.</li>
</ul>
<div class="packt_infobox">To know more about the HIPAA compliance and how it works along with AWS visit this URL to know more <a href="https://aws.amazon.com/compliance/hipaa-compliance/">https://aws.amazon.com/compliance/hipaa-compliance/</a>.</div>
<p>An important point to remember here is that SCPs only work when you have enabled the <span class="packt_screen">All features</span> feature set while creating your organization.</p>
<p>With this basic information in hand, let us look at how you can get started with AWS Organizations using a few simple steps.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Getting started with AWS Organizations</h1>
                </header>
            
            <article>
                
<p>AWS Organizations can be set up using both the AWS Management Console as well as the AWS CLI. In this section, we will be exploring simple steps using which you can get started with your own organization in a matter of minutes:</p>
<ol>
<li>From the AWS Management Console, filter out <span class="packt_screen">AWS Organizations</span> using the <span class="packt_screen">Filter</span> option or alternatively navigating to this URL <a href="https://console.aws.amazon.com/organizations/">https://console.aws.amazon.com/organizations/</a>.</li>
<li>Since this is the first time we are setting up an AWS Organization here, this particular account will now be transformed into the master account. Any other AWS accounts added or created to this master account will be termed as member accounts. Click on <span class="packt_screen">Create organization</span> to get started.</li>
</ol>
<ol start="3">
<li>At the time of creating an organization, you can opt to select either to <span class="packt_screen">Enable all features</span> or <span class="packt_screen">Enable only Consolidated Billing</span> based on your requirements. For this scenario, select <span class="packt_screen">Enable all features</span> and click on <span class="packt_screen">Create organization</span> once completed.</li>
<li>With the organization created, you should see your existing account listed on the accounts page as shown in the following screenshot. Select the <span class="packt_screen">Add account</span> option to add a new AWS account to our organization:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="Images/8bbd5dbe-17b7-4137-bd17-4c3bfa38f132.png" width="828" height="147"/></div>
<ol start="5">
<li>As mentioned before, AWS Organizations allows you to add existing AWS accounts into a new organization as well as create new accounts as a part of your master account itself. For this particular scenario, let us go ahead and create a new account called <strong>sandbox</strong>. Select the <span class="packt_screen">Create account</span> option on the <span class="packt_screen">Add account</span> page.</li>
<li>Provide a suitable name and email address for your new account in the <span class="packt_screen">Full name</span> and <span class="packt_screen">Email</span> fields respectively. The email that you provide has to be globally unique so provide an email address that has not been used so far with AWS here.</li>
<li>Next, in the <span class="packt_screen">IAM role name</span> filed, provide a suitable role name for your account. This role will enable you to access the new member account when signed in as an IAM user in the master account. Once completed, click on <span class="packt_screen">Create</span> to complete the process.</li>
</ol>
<p>Here is a snippet of the IAM Role that is created by AWS. The role grants full access to all AWS services and resources present in the new account:</p>
<pre>{ 
    "Version": "2012-10-17", 
    "Statement": [ 
        { 
            "Effect": "Allow", 
            "Action": "*", 
            "Resource": "*" 
        } 
    ] 
}</pre>
<p>The account creation process takes a few minutes to complete. Once done, you should see a new account created with the name <span class="packt_screen">Sandbox</span> and a new <span class="packt_screen">Account ID</span> as well in the <span class="packt_screen">Accounts</span> page of AWS Organizations. Select the sandbox account to view its associated ARN and ID in the adjoining pane.</p>
<p>With your account created, the next step involves creation of one or more OUs and moving the newly created account into an OU. For this particular scenario, let us go ahead and create an OU called <span class="packt_screen">Sandbox</span>:</p>
<ol>
<li>Select the <span class="packt_screen">Organize accounts</span> tab from the AWS Organizations dashboard to view the current hierarchical setup of the organization. From the <span class="packt_screen">Organizational Units</span> section, select the <span class="packt_screen">+ New Organization Unit</span> option to get started.</li>
<li>In the <span class="packt_screen">Create organizational unit</span> dialog box, provide a suitable name for the new OU in the <span class="packt_screen">Name of organization unit</span> field as shown in the following screenshot. Click on <span class="packt_screen">Create organizational unit</span> once done:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="213" width="520" src="Images/5fdd02cc-f82f-4790-af05-58ba53f63a2f.png"/></div>
<ol start="3">
<li>With the OU created, the final step in the process is to move the account into the newly created OU. To do so, from the same <span class="packt_screen">Organize accounts</span> page, select the <span class="packt_screen">Sandbox</span> account and click on <span class="packt_screen">Move</span>.</li>
<li>This will bring up a simple interface using which you will need to select the new OU to which you want to move the <span class="packt_screen">Sandbox</span> account. Select the <span class="packt_screen">Sandbox</span> OU and click on <span class="packt_screen">Move</span> to compete the process.</li>
</ol>
<p>With this step, you should have a new OU and a new account listed within it. You can use the same steps to create multiple OUs and accounts based on your requirements and needs. You can additionally provide restricted access to the services present in your new account by creating and assigning a new SCP to it as well:</p>
<ol>
<li>To create a new SCP, select the <span class="packt_screen">Policies</span> tab on the AWS Organization dashboard. You should see a default policy with the name <kbd>FullAWSAccess</kbd> already present there. This is a default policy that is created by AWS the first time you create an AWS Organization. The sandbox environment too is currently referenced to the same policy.</li>
<li>To create a new SCP, select the <span class="packt_screen">Create policy</span> option. AWS Organization provides you with two options when it comes to creating new SCPs. You can choose to leverage the <span class="packt_screen">Policy generator</span> to select specific services and actions from a list and build your custom policy or alternatively, choose to <span class="packt_screen">Copy an existing SCP</span> and edit the same manually. For this case, select the <span class="packt_screen">Policy generator</span> option.</li>
<li>Next, provide a <span class="packt_screen">Policy name</span> and <span class="packt_screen">Description</span> followed by selecting the <span class="packt_screen">Effect</span> the policy should have on the applied AWS account.</li>
</ol>
<p style="padding-left: 90px">AWS Organizations allows you to either whitelist (allow) or blacklist (deny) services <span>based on your requirements. Blacklisting services will cause all services listed in the policy to be blocked by default, whereas whitelisting services will block all service APIs that are not listed in the policy. Let us go ahead and create a simple policy for our sandbox OU that allows EC2, S3,</span> and <span>RDS services while explicitly blocking AWS</span> CloudTrail<span>.</span></p>
<ol start="4">
<li>In the <span class="packt_screen">Choose Overall Effect</span> section, select <span class="packt_screen">Allow</span> to first create the whitelist of services. Use the <span class="packt_screen">Statement builder</span> to select the correct service and its appropriate action as well. Once done, click on <span class="packt_screen">Add statement</span> to add further services and actions as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="315" width="724" src="Images/9032107d-2367-4c09-9e20-511aa6ae4279.png"/></div>
<ol start="5">
<li>Once you are done with adding the required statements, simply select the <span class="packt_screen">Create policy</span> option to complete the process.</li>
<li>With the policy created, you can attach the same to an existing account, OU, or even root by simply selecting the policy from the <span class="packt_screen">Policies</span> page and selecting either of the root, accounts, or organization units options as required. However, before you proceed further, you will first need to enable SCP policy types for your root account. To do so, select the <span class="packt_screen">Root</span> option from the <span class="packt_screen">Organize accounts</span> tab. In the adjoining details pane, select enable next to the <span class="packt_screen">Service control policies</span> section.</li>
<li>With this completed, you can now proceed with attaching the newly created policy to an entity within your organization. Remember, by attaching the policy to the root domain, you effectively propagate the policy down to its members as well. This includes the sub OUs and accounts that you may have created. For this particular case however, select the <span class="packt_screen">Accounts</span> option and click the <span class="packt_screen">Attach</span> option below the listed <span class="packt_screen">Sandbox</span> environment.</li>
</ol>
<p>There you have it! A simple way using which you can create and manage your AWS accounts with utmost ease. Next, we will look at how you can achieve the same results by leveraging the AWS CLI as well.</p>
<p>Creating and managing AWS accounts, OUs and SCPs using the CLI has its own bit of advantages. For example, you can easily automate the entire account creation process and make it faster and easier to on-board new teams within your organization, and so on:</p>
<ol>
<li>The first step involved in this exercise is to create the organization and set it to use all features, just as we performed with the AWS Management Console. To do so, type in the following command as shown:</li>
</ol>
<pre style="padding-left: 60px"><strong># aws organizations create-organization --feature-set ALL</strong></pre>
<div style="padding-left: 60px" class="packt_infobox">However this command may result in an error message for those of you who already have associated your AWS account with an organization.<br/>
<br/>
You can alternatively pass the <kbd>CONSOLIDATED_BILLING</kbd> value for the <kbd>--feature-set</kbd> parameter depending on your organization's requirements.</div>
<ol start="2">
<li>With the organization in place, let us go ahead and create an AWS account for our organization, but before we do that, we need to execute just one command that will provide us with the organization's root's ID. The ID will be in the form of <kbd>r-&lt;XY00&gt;</kbd>. Make a note of the same for later steps:</li>
</ol>
<pre style="padding-left: 60px"><strong># aws organizations list-roots</strong></pre>
<ol start="3">
<li>With the root ID noted type in the following command to create a new account. In this case, we are going to create a new account with the name of <kbd>prod</kbd>. Remember to substitute the <kbd>&lt;EMAIL_ID&gt;</kbd> field with a globally unique value:</li>
</ol>
<pre style="padding-left: 60px"><strong># aws organizations create-account</strong><br/><strong>--email &lt;EMAIL_ID&gt;<br/>--account-name prod</strong></pre>
<p style="padding-left: 90px">Here is a snapshot of the command's output. Make a note of the new account's status ID in the format <kbd>car-&lt;UNIQUE_ID&gt;</kbd> as shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img height="252" width="705" src="Images/628de4ef-8741-47dd-a67e-0794ce84a780.png"/></div>
<ol start="4">
<li>You can use this status ID to check whether the account creation has completed successfully or not by typing in the following command. Replace the <kbd>car-&lt;UNIQUE_ID&gt;</kbd> with the value copied from the earlier step:</li>
</ol>
<pre style="padding-left: 60px"><strong># aws organizations describe-create-account-status</strong><br/><strong>--create-account-request-id car-&lt;UNIQUE_ID&gt;</strong></pre>
<div style="padding-left: 60px" class="packt_infobox">You can view the newly created accounts ID by using the following command:<br/>
<kbd><strong>aws organizations list-accounts</strong></kbd></div>
<ol start="5">
<li>Once the new account is created, we can proceed to create a new OU and move the account over to the new OU. In this case, we are naming the new OU as <kbd>production</kbd>. Substitute the value of <kbd>r-&lt;XY00&gt;</kbd> with the root ID that we made a note of from our earlier steps:</li>
</ol>
<pre style="padding-left: 60px"><strong># aws organizations create-organizational-unit</strong><br/><strong>--parent-id r-&lt;XY00&gt;<br/>--name production</strong></pre>
<p style="padding-left: 90px">The output of this command yields two important values, first is the ARN of the new OU and the second is the OU's ID which is in the form of <kbd>ou-&lt;XY00&gt;-&lt;UNIQUE_ID&gt;</kbd>. Make a note of the same for the next steps.</p>
<ol start="6">
<li>Now that the account and OU are created, we simply have to move the account into the new OU. To do so, type in the following command while substituting the correct values for the <kbd>account-id</kbd>, <kbd>parent-id</kbd>, and the <kbd>OU-id</kbd>:</li>
</ol>
<pre style="padding-left: 60px"><strong># aws organizations move-account</strong><br/><strong>--account-id &lt;NEW_ACCOUNT_ID&gt;<br/>--source-parent-id r-&lt;XY00&gt;<br/>--destination-parent-id ou-&lt;XY00&gt;-&lt;UNIQUE_ID&gt;</strong></pre>
<div class="CDPAlignCenter CDPAlign"><img height="155" width="548" src="Images/b52e917d-bae0-4464-9ccf-e4867d65cfb2.png"/></div>
<p>That's it! You have just created a brand new AWS account and moved it into a new OU as well with a few simple commands! It's that easy! However, you can take things a bit further by creating a new SCP and attaching the same to our newly created OU. Let us assume for a moment that the particular OU that we have created can only allow certain AWS services to run as a part of the production environment. To do so, we first need to create a new SCP as shown in the following code block:</p>
<pre>{ 
  "Version": "2012-10-17", 
  "Statement": [{ 
    "Effect": "Allow", 
    "Action": [ 
      "ec2:*", 
      "rds:*", 
      "dynamodb:*" 
    ], 
    "Resource": "*" 
  }] 
} </pre>
<p>In this case, the SCP is whitelisting EC2, RDS, and DynamoDB however feel free to modify to suit your own requirements:</p>
<ol>
<li>Paste the SQP into a new file named as <kbd>policy.json</kbd> and save it. Next, type in the following command to create it:</li>
</ol>
<pre style="padding-left: 60px"><strong># aws organizations create-policy</strong><br/><strong>--content file://policy.json</strong><br/><strong>--name AllowProductionServices</strong><br/><strong>--type SERVICE_CONTROL_POLICY</strong><br/><strong>--description "This policy allows only certain production services"</strong></pre>
<ol start="2">
<li>With the policy created, you should receive a policy ID in the form of <kbd>p-&lt;UNIQUE_ID&gt;</kbd>. Make a note of the same. Next, use the following command to attach the newly created policy to our OU:</li>
</ol>
<pre style="padding-left: 60px"><strong>aws organizations attach-policy</strong><br/><strong>--policy-id p-&lt;UNIQUE_ID&gt;<br/>--target-id ou-&lt;XY00&gt;-&lt;UNIQUE_ID&gt;</strong></pre>
<p>That's it! You have just successfully attached a new policy to your OU. You can use the same syntax to attach the policy directly to each individual account as well.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Planning your next steps</h1>
                </header>
            
            <article>
                
<p>There are still plenty of things worth trying out when working with AWS Organizations. Here are a few recommendations for the same:</p>
<p>First up, as a best practice, you should always monitor your individual organizations and make sure that each change is tracked and reported. You can leverage both AWS CloudTrail as well as AWS CloudWatch events to accomplish the same. Monitoring the organizations is essential as it helps you to ensure that no unwanted changes affect the compliance of your accounts and environments. You can read up more on how you can leverage AWS CloudTrail and AWS CloudWatch events for monitoring organizations at <a href="https://docs.aws.amazon.com/organizations/latest/userguide/orgs_monitoring.html">https://docs.aws.amazon.com/organizations/latest/userguide/orgs_monitoring.html</a>.<a href="https://docs.aws.amazon.com/organizations/latest/userguide/orgs_monitoring.html"/></p>
<p>Next up, I would also recommend that you try out the AWS provided end-to-end account creation process here:</p>
<p><a href="https://aws.amazon.com/blogs/security/how-to-use-aws-organizations-to-automate-end-to-end-account-creation/">https://aws.amazon.com/blogs/security/how-to-use-aws-organizations-to-automate-end-to-end-account-creation/</a></p>
<p>The overall process for automating the account creation is very similar to the CLI commands that we executed a while back. The script accepts a few variables that are required to be defined first along with a few customizations of role names. Once done, you simply execute the shell script, which in turn calls a CloudFormation template to create and configure the new member account.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>With this, we come toward the end of yet another chapter but before we move on to the next, let us quickly summarize all that we have learnt so far!</p>
<p>We first started with a brief recap of AWS IAM and its core building blocks followed by learning a bit about two really useful enhancements made to IAM in recent times. The first was a visual editor using which you can create customized and granular IAM policies with relative ease, followed by an IAM Policy Simulator tool that helps you to create and test your policies without affecting any running workloads on the cloud. Post this we also learnt about AWS Organizations and how you can leverage it for creating and managing multiple AWS accounts under one roof. We also saw how easily you can create and work with root, organizations, and accounts using both the AWS Organizations dashboard as well as the CLI.</p>
<p>In the next chapter, we will be learning and exploring how you can leverage the AWS Code Suite of services to build an entire end-to-end CICD pipeline with the utmost of ease.</p>


            </article>

            
        </section>
    </div>



  </body></html>