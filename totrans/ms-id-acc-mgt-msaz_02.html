<html><head></head><body><div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Building and Managing Azure Active Directory</h1>
                </header>
            
            <article>
                
<p class="mce-root">Working with the several <strong>Software-as-a-Service</strong> (<strong>SaaS</strong>) offerings such as Office 365, Dynamics CRM or Visual Studio Online requires well-managed identities and an excellent basic structure in the Azure <strong>Active Directory</strong> (<strong>AD</strong>) that builds the heart of these solutions. You, as an administrator, need to provide a stable identity and access management platform to manage these services. </p>
<p class="mce-root">This chapter explains how to configure a suitable Azure AD tenant, which we use throughout the whole book to explore, understand, and configure the different features and functions in the field of identity and access management with Microsoft Azure. We start with the cloud-only components, followed in the next chapters by the hybrid identity and access management approach.</p>
<p class="mce-root">In this chapter, we go directly to the configuration and learn how to configure and manage users, groups, roles, and administrative units to provide a user and group-based application and self-service access, including the audit functionality. The chapter focuses on the following :</p>
<ul>
<li>Implementation scenario overview</li>
<li>Implementing a solid Azure Active Directory</li>
<li>Creating and managing users and groups</li>
<li>Assigning roles and administrative units</li>
<li>Protecting your administrative accounts</li>
<li>Providing user and group-based application access</li>
<li>Activating password reset</li>
</ul>
<ul>
<li>Using standard security monitoring</li>
<li>Integrating the Azure AD Join for Windows 10 clients</li>
<li>Configuring a custom domain</li>
<li>Configure Azure AD Domain Services</li>
</ul>
<p>Now, we can introduce the implementation scenario.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Implementation scenario overview</h1>
                </header>
            
            <article>
                
<p>After completing the next configuration tasks, you will see the rich functionality of Microsoft Azure in the field of identity and access management, starting with cloud identities. You can demonstrate the different capabilities in your own Microsoft Azure environment. The guidance will focus on the most essential feature sets to give you an idea about their capabilities. We will start to use the default directory, which we call <kbd>domain.onmicrosoft.com</kbd> for now, and will change it later to a custom domain name. Domain stands for your desired name like <kbd>example.com</kbd> , this is also used for the userPrincipalName of the users in this chapter, e.g. don.hall@doamin.onmicrosoft.com is represented in the chapter by my example domain called inovitcloudlabs. Be aware that this name will be visible in different applications, such as SharePoint Online and Skype for Business, to the end user. We recommend the company name without the company form, for instance, inovit GmbH would be <kbd>inovit.onmicrosoft.com</kbd>. Use a different name for your tests, so that the domain for a productive environment stays free. This configuration will be the base for all further scenarios in the book. For this reason, we use an <strong>Azure</strong>, <strong>Enterprise Mobility Suite</strong>, and <strong>Office 365</strong> subscription to use all the available features.</p>
<p>The following figure shows the different main areas we will focus on in this chapter:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/0b8b2f65-af26-4802-a14d-10cea740c9e5.png" width="1062" height="671"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Chapter scenario overview</div>
<p>In the next section, we will start the configuration of the scenarios.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Implementing a solid Azure Active Directory</h1>
                </header>
            
            <article>
                
<p>The first step we need to take is to get an Azure AD tenant. There are many ways to do this. You can start with an Azure subscription or use any other service from the Microsoft SaaS portfolio. The easiest way to get your solution to a working state is to start with an Office 365 trial subscription.</p>
<p><span>Open your browser and navigate to </span><a href="http://bit.ly/1RVpFXe">http://bit.ly/1RVpFXe</a><a href="http://bit.ly/1aZa9Xk">.</a><span> </span><span>Subscribe to a free <span class="packt_screen">Office 365 Enterprise E5</span> plan:</span><a href="http://bit.ly/1RVpFXe"/></p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/8c32e97f-eee1-4518-8540-a4a2e3646b47.png" style="width:42.58em;height:19.83em;" width="830" height="387"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Office 365 E5 trial request</div>
<p class="mce-root"><span>Follow the registration process and define your user ID, such as <kbd>admin@domain.onmicrosoft.com</kbd>. We recommend using a nonpersonal ID, as shown in the next screenshot. E<span>nter your new user ID and password. Your default directory will get the name you define behind the <kbd>@</kbd>:</span></span></p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/78c60ffd-201d-4819-b980-0b00c9ba82bd.png" style="width:28.75em;height:16.67em;" width="636" height="367"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">First Global Administrator creation</div>
<p>Afterward, you need to prove your identity with a text message or a phone call and enter the received code. Next, you need to click <span class="packt_screen">Create my account</span>. Keep in mind that the provisioning process takes a few minutes and should end with a success message.</p>
<p>After the successful creation of your brand new Azure AD with an associated Office 365 E5 plan, you should be able to log on with your administrative credentials and see the following screen:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/4e2a85d2-32cd-4671-a5a7-cf11b8c8aa9a.png" style="width:55.83em;height:20.33em;" width="1197" height="436"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Office 365 management portal</div>
<p>In the next step, we will assign an <strong>Enterprise Mobility Suite</strong> (<strong>EMS</strong>) E5 plan to the freshly created Azure AD tenant.</p>
<p>Click on the <span class="packt_screen">Admin</span> icon on the right, and you should see your current assigned <span class="packt_screen">Subscriptions</span> under the <span class="packt_screen">Billing</span> tab:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/50bc2cb8-4f66-4c88-8d17-cfb5d1a9307b.png" width="1228" height="654"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Office 365 subscription management</div>
<p>Click <span class="packt_screen">Add subscriptions</span> to add the EMS E5 trial plan to your Azure AD tenant:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/9c9ba7e2-78c5-4290-ba29-ed16dfdfbe14.png" width="1102" height="457"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">EM+S E5 trial request</div>
<p>Choose the EMS E5 plan and click <span class="packt_screen">Start free trial</span> and follow the subscription process. After a successful subscription process, you can see the assigned Office 365 E5 and the EMS E5 plan in your Azure AD tenant.</p>
<p>Now that we have created our Azure AD tenant, we need to subscribe for an Azure free trial subscription. This step is necessary to use Azure resources such as the Azure AD Domain Services or other functionality we will discuss in the next chapters. </p>
<p>You can also use the following ways to get an Azure subscription:</p>
<ul>
<li>Use an Azure subscription from scratch (<a href="https://account.azure.com/organization">https://account.azure.com/organization</a>)</li>
<li>Use an agreement-based Azure subscription</li>
<li>Use an MSDN Azure subscription, as shown in the following figure:</li>
</ul>
<p class="CDPAlignCenter CDPAlign"><img src="Images/988e0fde-6054-44c1-a214-58f5036251ec.png" style="width:29.42em;height:22.75em;" width="595" height="459"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Visual Studio subscription benefits</div>
<div class="packt_infobox"><span>Remember you can only sign up for one Azure AD free trial subscription. </span></div>
<p>Let's go to configure your administrative workstation and your personal Azure AD tenant.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Configuring your administrative workstation</h1>
                </header>
            
            <article>
                
<p>First of all, we need to set a functional administrative workstation to work through this guide. You need to have a Windows 10 Enterprise client machine in a work group configuration. We recommend using a freshly installed Windows 10 Enterprise virtual machine. We need a Windows 10 device to use the Azure AD Join later in the book. If you are not able to access the Volume Licensed or MSDN version, you can use the Enterprise Evaluation version at <a href="https://www.microsoft.com/en-gb/evalcenter/evaluate-windows-10-enterprise">https://www.microsoft.com/en-gb/evalcenter/evaluate-windows-10-enterprise</a><a href="http://bit.ly/1P6o8Yc">.</a></p>
<p>In the code section of this chapter, you will find the following cmdlets to install the needed administrative tools on your client machine, basically, the Azure AD, MSOnline and the Azure Resource Manager <span>PowerShell modules:</span></p>
<ol>
<li>Install the Azure Active Directory PowerShell module:</li>
</ol>
<pre style="padding-left: 60px"><strong>Install-Module -Name AzureADPreview</strong></pre>
<ol start="2">
<li>Install the <kbd>MSOnline</kbd> PowerShell module:</li>
</ol>
<pre style="padding-left: 60px"><strong>Install-Module -Name MSOnline</strong></pre>
<ol start="3">
<li>Install the Azure Resource Manager PowerShell module:</li>
</ol>
<pre style="padding-left: 60px"><strong>Install-Module AzureRM</strong></pre>
<ol start="4">
<li>Connect to the <kbd>MSOnline</kbd> interface with PowerShell:</li>
</ol>
<pre style="padding-left: 60px"><strong>Connect-MsolService</strong><br/><strong># Provide your global administrator credentials</strong><br/><strong># View your assigned subscriptions</strong><br/><strong>Get-MsolAccountSku</strong><br/><strong># View all actual users</strong><br/><strong>Get-MsolUser</strong></pre>
<ol start="5">
<li>Create your first test user to prove the Azure AD administrative connection:</li>
</ol>
<pre style="padding-left: 60px"><strong>New-MsolUser -UserPrincipalName "jochen.nickel@inovitcloudlabs.onmicrosoft.com" -DisplayName "Jochen Nickel" -FirstName "Jochen" -LastName "Nickel" -UsageLocation "CH" -LicenseAssignment "inovitlabs:ENTERPRISEPREMIUM","inovitcloudlabs:EMSPREMIUM"<br/><br/>Get-MsolUser -UserPrincipalName jochen.nickel@inovitcloudlabs.onmicrosoft.com | fl</strong></pre>
<ol start="6">
<li>Connect directly to the Azure AD interface to compare the output and capabilities with the <kbd>MSOnline</kbd> PowerShell module:</li>
</ol>
<pre style="padding-left: 60px"><strong>Connect-AzureAD</strong><br/><strong>Get-AzureADUser -all $true | where userprincipalname -eq jochen.nickel@inovitcloudlabs.onmicrosoft.com | fl</strong></pre>
<ol start="7">
<li>Unpack the deployment package from the code package. The <kbd>C:\Configuration\HRExports</kbd> directory contains the needed HR import and group creation scripts to configure your Azure AD tenant with some test data:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/f0df30fb-d7e4-4381-8d74-60206f4b9f13.png" style="width:46.25em;height:8.67em;" width="593" height="110"/></p>
<div class="CDPAlignCenter CDPAlign packt_figref">Example script set</div>
<p>In the <kbd>HRImportToAAD.ps1</kbd> script, the following important variables will be used:</p>
<pre><strong>$domain = Get-MsolDomain | where {$_.Name -notlike "*mail*"}</strong><br/><strong>$dir = "C:\Configuration\HRExports"</strong><br/><br/><strong># Also configure your PowerShell Execution Policy to RemoteSigned with the following cmdlet</strong><br/><strong># More information about this topic can be found under http://bit.ly/1EWLG03</strong><br/><strong>Set-ExecutionPolicy -ExecutionPolicy RemoteSigned</strong></pre>
<p>The domain variable will contain the <kbd>domain.onmicrosoft.com</kbd> name of your Azure AD default directory. We use this directory and not a registered domain name for different steps. At the end of the chapter, we will change to a custom domain so that you can explore the needed tasks. As you can see, the <kbd>dir</kbd> variable contains the path to the scripts and the simple HR export file called <kbd>NewHire.csv</kbd>. The <kbd>contoso.com</kbd> domain in the file will be replaced with your domain name, stored in the domain variable.</p>
<p>The <kbd>NewHire.csv</kbd> file contains the following demo user set, which will be used in future configurations to demonstrate the different functionalities:</p>
<pre>userPrincipalName,DisplayName,FirstName,LastName,password<br/>Don.Hall@contoso.com,Don Hall,Don,Hall,Pass@word1<br/>Ellen.Adams@contoso.com,Ellen Adams,Ellen,Adams,Pass@word1<br/>Jeff.Simpson@contoso.com,Jeff Simpson,Jeff,Simpson,Pass@word1<br/>Brian.Cox@contoso.com,Brian Cox,Brian,Cox,Pass@word1<br/>Doris.Sutton@contoso.com,Doris Sutton,Doris,Sutton,Pass@word1<br/>Petro.Mitchell@contoso.com,Petro Mitchell,Petro,Mitchell,Pass@word1</pre>
<p><span>With the next step, we will assign an EMS E5 plan license to our global administrator, <kbd>admin@domain.onmicrosoft.com</kbd>. The Office 365 E5 was already assigned through the creation process. Later in the chapter, we will assign licenses through dynamic group membership, which is an Azure AD Premium P2 license feature:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/f5794e63-fefa-4de8-bda6-d0d5e9dac851.png" style="width:41.33em;height:18.08em;" width="731" height="321"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">License assignment operation</div>
<p>Click <span class="packt_screen">Assign</span> and add the EMS E5 plan license to your global administrator. The expected result will be as follows:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/d39afdb9-0bcd-4ad7-bbee-67b64266c995.png" style="width:59.00em;height:6.92em;" width="964" height="113"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Assigned license overview</div>
<p class="CDPAlignLeft CDPAlign">We will get the correct message that we have no active subscription assigned to this user ID. Next, sign up for a Microsoft Azure subscription.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Custom company branding</h1>
                </header>
            
            <article>
                
<p>Most companies like to see how they can apply their corporate identity to Azure services. With a few easy steps, you can show the most important capabilities. To add custom branding, you need to use an Azure Active Directory Premium 1, Premium 2, Basic, or Office 365 license. With the following simple example, you can see what you can customize. You can provide the customizing in different languages to address your own or your customers' needs. These configuration tasks are always a good starting point in a demo or a proof of concept. You are free to use your pictures and designs for this setup:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/38cfa9f7-2341-4463-ae85-e03985c7548f.png" style="width:66.08em;height:37.50em;" width="1914" height="1086"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Customized portal example</div>
<p><span>The first thing we are going to change is the <span class="packt_screen">Name</span> of the directory in the properties section. Just enter your desired name. We used <kbd>INOVITCLOUDLABS by inovit GmbH</kbd>. You can also provide your own technical and privacy contacts and links on the login page:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/cd9474b3-4ce3-45b0-912c-377478ae0181.png" style="width:42.08em;height:41.75em;" width="820" height="813"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Azure AD tenant properties</div>
<p>Click <span class="packt_screen">Customize Branding,</span> and you will see the following options. So that you can prepare your pictures and brands, we summarized the help information provided in Microsoft TechNet:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/23f666b3-df36-424d-bda2-99179cdac2d8.png" style="width:30.58em;height:50.08em;" width="580" height="953"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Azure AD portal-customizing options</div>
<p>Next, you will see a configuration summary.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Summary and recommendations of the help information </h1>
                </header>
            
            <article>
                
<p>The following section provides you with several capabilities and summarizes the most important corporate identity features to customize your environment:</p>
<ul>
<li><strong>Banner logo</strong>: Choose between the following options:
<ul>
<li>Displayed on the Azure AD sign-in page and <kbd>myapps.microsoft.com</kbd></li>
<li>PNG or JPEG</li>
<li>Can't be taller than 36 pixels or more extensive than 245 pixels</li>
<li>Recommendation—no padding around the image    </li>
</ul>
</li>
<li><strong>Sign-in page text body</strong>:<strong> </strong>Choose between the following options:
<ul>
<li>Appears at the bottom of the Azure AD sign-in page</li>
<li>Unicode text only with a maximum length of 256 characters</li>
<li>Use to communicate the phone number to your help desk or include a legal statement</li>
<li>Recommendation—don't add links or HTML tags</li>
</ul>
</li>
<li><strong>Sign-in page background image</strong>:<strong> </strong>Choose from the following options:
<ul>
<li>Displayed on the side of the Azure AD sign-in page</li>
<li>PNG or JPEG</li>
<li>Recommended 1420 x 1200 with a supported file size of 300 KB (max. 500 KB)</li>
<li>Keep the exciting part in the top-left corner (image gets resized and cropped)</li>
</ul>
</li>
<li><strong>Username hint</strong>:<strong> </strong>Hint text that appears to users if they forget their username:
<ul>
<li>Unicode, without links or code</li>
<li>Maximum 64 characters</li>
</ul>
</li>
</ul>
<ul>
<li><strong>Show option to remain signed in</strong>: Let your users remain signed in to Azure AD until explicitly signing out:</li>
</ul>
<p class="CDPAlignCenter CDPAlign"><img src="Images/c31c7dd1-1d42-47d5-8aa9-66a8d6fe0543.png" style="width:21.08em;height:23.50em;" width="421" height="469"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Login experience</div>
<div class="packt_infobox"><span>You are also able to do some extensive customization with the help of the following article <a href="https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/customize-branding">https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/customize-branding</a>.</span></div>
<p>Your expected result should be this:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/dd64f5f3-d08f-4669-8ebd-bed35ac9959a.png" width="1401" height="100"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Portal-customizing effect</div>
<p>Now that we have provided an essential company branding, we can start to create and manage users and groups.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Creating and managing users and groups</h1>
                </header>
            
            <article>
                
<p>In the next steps, we connect to our Azure AD and generate the test users and groups.</p>
<p>Start the Azure AD PowerShell console and connect to Azure AD by executing the following cmdlets and scripts:</p>
<pre><strong>$msolcred = get-credential</strong><br/><strong># Enter your global administrator credentials</strong><br/><strong>connect-msolservice -credential $msolcred</strong><br/><strong>C:\Configuration\HRExports\HRImportToAAD.ps1</strong></pre>
<div class="packt_quote packt_infobox">Alternatively, you can also use <kbd>connect-msolservice</kbd> directly to connect without the use of a variable.</div>
<p class="mce-root">After starting the script, go directly to <a href="https://portal.azure.com">https://portal.azure.com</a> with your <kbd>admin@domain.onmicrosoft.com</kbd> credentials. Select the users' section under your Azure AD. You should find the users from the <kbd>HireUsers.csv</kbd> file under the <span class="packt_screen">All users</span> tab:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/e3f218da-1506-4b96-b0d6-284bc8247ed2.png" width="1271" height="488"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Azure AD portal user management</div>
<p><span>Open <a href="https://portal.office.com">https://portal.office.com</a> | <span class="packt_screen">Admin</span> | <span class="packt_screen">Active Users,</span> and you can see your users with active licenses in Office 365:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/d215a69a-1195-4cd6-aa59-79edd28d1403.png" style="width:53.92em;height:16.08em;" width="994" height="297"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Office 365 user management</div>
<p class="CDPAlignLeft CDPAlign">Let's create three exam<span>ple groups to represent the company organization with the following script:</span></p>
<pre class="CDPAlignLeft CDPAlign"><strong>C:\Configuration\HRExports\AddOrgGroups.ps1</strong></pre>
<p>Now, you will see the created groups:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/1f30f127-d4b3-4edc-9e6d-1bf035502184.png" width="1128" height="108"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Azure AD group management</div>
<p>Test your configuration, open <a href="https://myapps.microsoft.com">https://myapps.microsoft.com</a>, and log in with the user <kbd>Don.Hall@domain.onmicrosoft.com</kbd>, and you should see Office 365 SharePoint, Outlook, and many applications in the access panel UI. Click <span class="packt_screen">Outlook,</span> and you should be able to open the app without additional login information to access your mailbox:</p>
<p class="mce-root CDPAlignCenter CDPAlign"><img src="Images/3450e95d-3784-4d5b-844c-1a8cedc8dd75.png" style="width:40.33em;height:21.08em;" width="653" height="341"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">User Inbox dialog</div>
<p>In the next steps, we provide an owner to our organizational groups.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Set group owners for organizational groups</h1>
                </header>
            
            <article>
                
<p>To provide group management by the manager of a department, we will assign the following users as owners of their department groups:</p>
<ul>
<li><span class="packt_screen">Accounting</span>: <kbd>Brian.Cox@domain.onmicrosoft.com</kbd></li>
</ul>
<p class="CDPAlignCenter CDPAlign"><img src="Images/6d12d6e3-01f5-4efe-b04d-804ae098e2a0.png" style="width:30.25em;height:22.50em;" width="514" height="383"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Group - user assignment</div>
<p style="padding-left: 30px">Do the same for:</p>
<ul>
<li><span class="packt_screen">HR</span>: <kbd>Don.Hall@domain.onmicrosoft.com</kbd></li>
<li><span class="packt_screen">Sales</span>: <kbd>Doris.Sutton@domain.onmicrosoft.com</kbd></li>
</ul>
<p>Now that we have configured the owners, we will start to delegate management.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Delegated group management for organizational groups</h1>
                </header>
            
            <article>
                
<p>The default configuration of Azure AD allows an owner of a security or Office 365 group to manage the group members based on the data owner concept in the Azure AD Access Panel and the Azure portal.</p>
<p>Furthermore, you can limit this functionality, based on your needs:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/95bb2542-206f-4f99-8166-b660ca4a378f.png" style="width:57.42em;height:26.17em;" width="880" height="401"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Group options in Azure AD</div>
<p>Log in as <kbd>Don.Hall@domain.onmicrosoft.com</kbd> to <a href="https://myapps.microsoft.com">https://myapps.microsoft.com</a>. Click on the <span class="packt_screen">HR</span> group and add <kbd>Ellen.Adams@domain.onmicrosoft.com</kbd> to the <span class="packt_screen">HR</span> group:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/ad8cd3cd-ba45-465b-b4fd-9ae5da010c2e.png" style="width:63.17em;height:20.83em;" width="1472" height="486"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Group view in Azure AD access panel UI</div>
<p>Review the <span class="packt_screen">Join policy</span> under <span class="packt_screen">Edit details</span>.</p>
<p>In the next section, we will configure the group self-service options.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Configure self-service group management</h1>
                </header>
            
            <article>
                
<p>Another request may be that users need to be able to create request-based security or Office 365 groups, for instance for projects or distribution groups. For this, they need the capability of an approval process. You can provide this functionality by activating the option under the group management general section. The feature set requires Azure Active Directory Premium:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/0f17658c-e412-4a9b-89e6-fa2257ca59ce.png" style="width:33.75em;height:8.08em;" width="546" height="131"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Self-Service Group Management options</div>
<div>
<p>An Office 365 group includes a distribution list but also consists of these shared tools:</p>
</div>
<ul>
<li>Inbox for group email communication</li>
<li>Calendar for scheduling group meetings and events</li>
<li>Library for storing and working on group files and folders</li>
<li>OneNote notebook for taking project and meeting notes</li>
<li>Planning tool for organizing and assigning tasks and getting updates on project progress</li>
<li>Guest access (set up by the administrator)</li>
</ul>
<div class="packt_tip">
<p><span class="packt_screen">Practical note:</span> Use a different browser or the <span class="packt_screen">Private Browsing</span> option for handling the different user sessions: one session on <a href="https://portal.azure.com">https://portal.azure.com</a> as <kbd>admin@domain.onmicrosoft.com</kbd> (Admin) and another session as the explicit user (User) under <a href="https://myapps.microsoft.com">https://myapps.microsoft.com</a>.</p>
</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Create the sales internal news group as an Office 365 (distribution group)</h1>
                </header>
            
            <article>
                
<p><span>Log in as <kbd>Doris.Sutton@domain.onmicrosoft.com</kbd> to <a href="https://myapps.microsoft.com">https://myapps.microsoft.com</a> and create the <kbd>Sales Internal News</kbd> </span><span>group</span><span> </span><span>as an Office 365 group. Check that the </span><span class="packt_screen">Group policy</span> <span>shows <span class="packt_screen">This group is open to join for all users</span>:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/61b195ff-f796-4176-81a1-b48e058cd356.png" style="width:32.58em;height:29.25em;" width="698" height="625"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Azure AD access panel UI - group creation</div>
<p>Review the <span class="packt_screen">Join policy</span> of your newly created group:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/1762e025-81fc-40b3-9b8e-1a1b5a2f475a.png" style="width:68.25em;height:22.58em;" width="1467" height="485"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Group dialog - Azure AD access panel UI</div>
<p>In your Azure AD, under <span class="packt_screen">Groups</span>, you will also find the newly created group:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/d826ab8f-8306-4a6b-805e-9735db6ea7d0.png" style="width:50.25em;height:22.33em;" width="986" height="439"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Group overview - Azure AD access panel UI</div>
<p>Now, as the group owner, we change the group to request a managers' approval with the group policy setting:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/7d8134ac-00a8-4c61-a0c2-ce9268312fb4.png" style="width:29.00em;height:26.00em;" width="696" height="623"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Group editing dialog</div>
<p>Test the new configuration and log in as <kbd>Don.Hall@domain.onmicrosoft.com</kbd> to <a href="https://myapps.microsoft.com">https://myapps.microsoft.com</a>. Navigate to groups. Choose <span class="packt_screen">Sales Internal News</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/5fbf00b9-cd83-4b37-855b-c48f568d86d8.png" style="width:69.50em;height:23.00em;" width="1391" height="460"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Join group dialog</div>
<p>Join the <span class="packt_screen">Sales Internal News</span> group and type a <kbd>Business justification</kbd>, click <span class="packt_screen">Request</span>, and the process should be started.</p>
<p>Log in as <kbd>Doris.Sutton@domain.onmicrosoft.com</kbd> to <a href="https://myapps.microsoft.com">https://myapps.microsoft.com</a>.</p>
<p>Check your inbox. You should have received the join request mail and a notification, shown in the Access Panel UI.</p>
<p><span>Click on this request and approve it:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/c00bfa0d-daa6-4736-8f1a-e4532cedab53.png" style="width:36.92em;height:16.33em;" width="767" height="339"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Group join - Notifications</div>
<div class="mce-root packt_infobox"><strong>Note</strong>: Next, you will see the group members of the <span class="packt_screen">Sales Internal News</span> group.</div>
<p>Log in as <kbd>Don.Hall@domain.onmicrosoft.com</kbd> on <a href="https://myapps.microsoft.com">https://myapps.microsoft.com</a>.</p>
<p>Check your inbox, and you should have received a successful approval message:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/0784e51d-3031-415b-b7cd-1e460b03824f.png" style="width:40.42em;height:19.00em;" width="712" height="335"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Approval message - group membership</div>
<p>Check your group membership, and you should be a member of the <span class="packt_screen">Sales Internal News</span> group:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/87f8894f-57dd-4762-be3c-a14fe74f68e7.png" style="width:56.00em;height:14.75em;" width="1394" height="367"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Group management in Azure AD access panel UI</div>
<p>Next, we will configure dynamic group memberships.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Configure dynamic group memberships</h1>
                </header>
            
            <article>
                
<p>In the next section, we will configure straightforward dynamic group memberships to use the department attribute to<span> </span><span>add users to their department group and build up a dynamic licensing assignment. </span><span>Group-based licensing currently does not support groups that contain other groups (nested groups).</span></p>
<div class="packt_infobox">An Azure AD Premium P1 license is needed for every user in a dynamic group.<br/>
When enabling dynamic groups, current memberships will be lost.<br/>
The usage location of a user needs to be set to assign a license. </div>
<p>As the <kbd>admin@domain.onmicrosoft.com</kbd>, choose the <span class="packt_screen">Accounting</span> group, navigate to properties, and change the membership type to <span class="packt_screen">Dynamic User</span>.</p>
<p>Create a simple rule, department <span class="packt_screen">Equals </span>(-eq) <kbd>Accounting:</kbd></p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/b4e98202-681e-4998-9b18-a171ae9dabff.png" style="width:36.42em;height:14.50em;" width="560" height="222"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Dynamic group membership rule configuration</div>
<p>Set the department attribute (profile section) on the accounting users <kbd>Brian Cox</kbd> and <kbd>Jeff Simpson</kbd> to <span class="packt_screen">Accounting</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/bb725e0d-f542-4984-8e69-4b552a9e2d0e.png" style="width:68.92em;height:6.25em;" width="1033" height="93"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Filling user attributes for dynamic group usage</div>
<p>The member should be added automatically. Check the group membership and v<span>erify the two new members:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/22c71e10-5bd3-4b5c-8ad3-c0b720b3a30a.png" style="width:54.50em;height:14.50em;" width="1233" height="328"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Freshly calculated dynamic group membership</div>
<p>Next, we will provide an automatic licensing solution.</p>
<p>Create the following security group:</p>
<ul>
<li>Office 365 full feature licensing</li>
<li><span class="packt_screen">Group description</span>: <span class="packt_screen">Automatic Office 365 Full Feature Licensing</span></li>
<li><span class="packt_screen">Membership type</span>: <span class="packt_screen">Dynamic User</span></li>
<li><span class="packt_screen">Dynamic query</span>: <kbd>userType -eq Member</kbd>:</li>
</ul>
<p class="CDPAlignCenter CDPAlign"><img src="Images/c4c4cd37-530e-409e-8cb5-47e34850a679.png" style="width:19.50em;height:21.00em;" width="286" height="307"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Group properties dialog</div>
<p>Under <span class="packt_screen">Licenses</span> | <span class="packt_screen">Products</span>, assign the Office 365 E5 plan. Don't choose any assignment options at the moment:</p>
<div class="CDPAlignCenter packt_figref CDPAlign"><img src="Images/562b5fba-363c-4973-ab41-77e714912df3.png" style="width:20.08em;height:9.58em;" width="291" height="139"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Group assignment options</div>
<div class="mce-root packt_tip"><strong>Note</strong>: With the assignment options, you can enable/disable features as needed.</div>
<p>Wait until the membership has updated and check the license assignment for <kbd>Don.Hall@domain.onmicrosoft.com</kbd>.</p>
<p>You will see that the user gets the license through a direct and group-based assignment:</p>
<p class="CDPAlignCenter CDPAlign"><img style="font-size: 1em;width:66.33em;height:6.08em;" src="Images/ee6dd666-83d0-46e9-919b-1406451e37a4.png" width="1119" height="102"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">License assignment overview</div>
<div class="packt_tip">This lice<span><span>nse solution is to give you a starter. You </span>shoul</span><span>d remove the directly assigned licenses from all users that get licenses from group membership.</span></div>
<p class="mce-root">In the next section, we will configure role assignments to administrative units.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Assign roles to administrative units</h1>
                </header>
            
            <article>
                
<p>To delegate tasks, we use the creation of <strong>administrative units</strong> (<strong>AUs</strong>) and assign roles for specific tasks. In this configuration, we generate an <kbd><span>HR [AU]</span></kbd> , and we assign the manager of the HR department with the role to manage user accounts in this scope.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Creating an administrative unit</h1>
                </header>
            
            <article>
                
<p><span>First of all, we need to connect to our Azure AD with the PowerShell cmdlet Connect-AzureAD for the <kbd>admin@domain.onmicrosoft.com</kbd> user.</span></p>
<p>Use the following cmdlets <span>to create the <kbd>HR [AU]</kbd>:</span></p>
<pre><strong>New-AzureADAdministrativeUnit -Description "<span>Human Resources Users"</span> -DisplayName "HR"</strong></pre>
<p>View the expected output:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/2edc5d3b-a4f5-411a-8ae9-979c64d555ee.png" style="width:36.50em;height:3.50em;" width="563" height="54"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Newly created administrative unit</div>
<p>Next, we will add the related users.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Adding users to an administrative unit</h1>
                </header>
            
            <article>
                
<p>Next, we add the users of the HR department to the <kbd>HR [AU]</kbd>. Use the following cmdlets to do this:</p>
<pre><strong>$HRAU = Get-AzureADAdministrativeUnit -Filter "displayname eq 'HR'"</strong><br/><strong>$</strong><strong>initialDomain = (Get-AzureADDomain)[0].Name</strong><br/><strong>$HRUser1 = Get-AzureADUser -Filter "UserPrincipalName eq 'don.hall@$InitialDomain'"</strong><br/><strong>$HRUser2 = Get-AzureADUser -Filter "UserPrincipalName eq 'ellen.adams@$InitialDomain'"</strong><br/><strong>Add-AzureADAdministrativeUnitMember -ObjectId $HRAU.ObjectId -RefObjectId $HRUser1.ObjectId</strong><br/><strong>Add-AzureADAdministrativeUnitMember -ObjectId $HRAU.ObjectId -RefObjectId $HRUser2.ObjectId</strong><br/><strong>Get-AzureADAdministrativeUnitMember -ObjectId $HRAU.ObjectId | Get-AzureADUser<br/></strong></pre>
<p>The output of the preceding command is as follows:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/52b56e88-dcd2-4670-ac9b-16ed3be345de.png" style="width:54.00em;height:4.25em;" width="1220" height="95"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Newly added users overview</div>
<p>Next, we will use the scoping options.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Scoping administrative roles</h1>
                </header>
            
            <article>
                
<p>In the next step, we assign the user account administrator role. Verify available roles with the following cmdlet:</p>
<pre><strong>Get-AzureADDirectoryRoleTemplate</strong></pre>
<p>Now, we enable the user account administrator role with the following cmdlet:</p>
<pre><strong>Enable-AzureADDirectoryRole -RoleTemplateId fe930be7-5e62-47db-91af-98c3a49a38b1</strong></pre>
<p>Set variables and assign the user to the role:</p>
<pre><strong>$admins = Get-AzureADDirectoryRole</strong><br/><strong>foreach($i in $admins) {</strong><br/><strong>    if($i.DisplayName -eq "User Account Administrator") {</strong><br/><strong>        $uaAdmin = $i</strong><br/><strong>       }</strong><br/><strong>    }</strong><br/><br/><strong>$HRUA = Get-AzureADUser -Filter "UserPrincipalName eq 'Don.Hall@$InitialDomain'"</strong><br/><strong>$uaRoleMemberInfo = New-Object -TypeName Microsoft.Open.AzureAD.Model.RoleMemberInfo -Property @{ ObjectId = $HRUA.ObjectId }</strong><br/><strong>Add-AzureADScopedRoleMembership -RoleObjectId $uaAdmin.ObjectId -ObjectId $HRAU.ObjectId -RoleMemberInfo $uaRoleMemberInfo</strong></pre>
<p class="CDPAlignLeft CDPAlign">The output of the preceding command is as follows:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/f7d834ec-285d-4e3f-aec8-1fa42f3cccad.png" style="width:61.08em;height:3.17em;" width="1428" height="75"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">User Account Administrator assignment</div>
<p>Next, we will test our configuration.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Test your configuration</h1>
                </header>
            
            <article>
                
<p>Open a new PowerShell and connect with the <kbd>Connect-MsolService</kbd> <span>command</span><span> </span><span>to the Azure AD, and log in with <kbd>Don.Hall@domain.onmicrosoft.com</kbd> credentials.</span></p>
<p>Modify a user account assigned to the HR administrative unit:</p>
<pre><strong>Set-MsolUser -UserPrincipalName ellen.adams@domain.onmicrosoft.com -Department HR</strong></pre>
<p>Verify your modification:</p>
<pre><strong>Get-MsolUser -UserPrincipalName ellen.adams@domain.onmicrosoft.com | select Department</strong></pre>
<p>Next, we will protect an administrative account with the <strong>Privileged Identity Management</strong> (<strong>PIM</strong>) features of Azure AD Premium P2. We recommend using Azure MFA to protect your administrative accounts, if you don't want to invest in Azure AD Premium P2.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Protect your administrative accounts</h1>
                </header>
            
            <article>
                
<p>In this section, we will use Azure AD Premium P2 PIM to protect an administrative account in a quick intro.</p>
<p>Open <a href="https://portal.azure.com">https://portal.azure.com</a> as <kbd>admin@domain.onmicrosoft.com</kbd> to start the configuration.</p>
<p>Click <span class="packt_screen">All Services</span> and choose the Azure AD Privileged Identity Management.</p>
<p>Now, we need to <span class="packt_screen">Consent to PIM</span> to use the service:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/c9f0e4b5-f6c1-4d83-875a-f61c3dcd8dad.png" style="width:42.67em;height:9.50em;" width="804" height="178"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Privileged Identity Management - enablement</div>
<p>You will need to verify your identity and provide your preferred security verification option, as you can see in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/dfe17d9b-67b4-4136-9c49-d8258c935cf2.png" style="width:39.67em;height:20.25em;" width="768" height="392"/><br/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Azure MFA onboarding</div>
<div class="packt_tip">If you already use the Microsoft Authenticator App on your mobile device, you can also register the mobile app.</div>
<p>Finish the verification process and click <span class="packt_screen">Consent</span>—proceed:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/bd2748e8-84d2-4391-ab5e-972133da85ed.png" style="width:43.17em;height:8.00em;" width="729" height="135"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Consent to finish the initialization</div>
<p>Next, we sign up under Azure AD Roles, so that users can enable Azure AD roles. Click <span class="packt_screen">Sign up PIM for Azure AD Roles</span> to activate the functionality:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/b5bab472-bb2f-4a28-9111-ba9682b91439.png" style="width:57.83em;height:9.92em;" width="1018" height="175"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Azure AD roles - PIM sign-up</div>
<p>Now that the feature is enabled, we can assign the roles to our users.</p>
<p>Click <span class="packt_screen">Assign eligibility</span> to start the task:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/174a70aa-bb70-4d6c-87a9-7cd5736241df.png" width="1397" height="432"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Role assignment procedure</div>
<p>Click the <span class="packt_screen">Global Administrator Role</span>, view the actual members, and add your test account to the role:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/9a590e41-8c0b-418f-972c-81049ad16c7b.png" style="width:21.33em;height:11.58em;" width="307" height="167"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">User assignment to a role</div>
<p>View the expected result:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/d5493368-3207-439f-bf6c-bed610195b87.png" style="width:65.08em;height:14.33em;" width="1114" height="246"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">New eligible user assigned to the role</div>
<p>Let's test our configuration by opening an <kbd>InPrivate</kbd> browser session; open <a href="https://portal.azure.com">https://portal.azure.com</a> and log in with your own test account. <span>Click <span class="packt_screen">All Services</span> and choose <span class="packt_screen">Azure AD Privileged Identity Management</span>. </span>Choose <span class="packt_screen">My roles</span> and activate the <span class="packt_screen">Global Administrator</span> role for your account:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/4196a791-e576-4bfa-9c81-79a5330ddda4.png" style="width:60.67em;height:11.67em;" width="1498" height="289"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Role activation procedure</div>
<p>Next, you need to verify your identity. Follow the process, register, and verify your account. You need to complete the registration process just once:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/e6b1e12e-424b-41fb-910c-281a32abaa08.png" style="width:22.58em;height:21.92em;" width="309" height="299"/> </p>
<div class="packt_figref CDPAlignCenter CDPAlign">Starting the verification process</div>
<p>After the registration and verification processes are finished, you can <span class="packt_screen">Activate</span> your role:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/48150c5b-c2f7-43c5-918c-83166b67bb56.png" style="width:21.83em;height:18.42em;" width="304" height="256"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Role activation</div>
<p>Provide a reason for your role activation. You will note that the role is limited for <kbd>1</kbd> hour and that you can define a custom activation time. Later in the book, we will configure different roles and features:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/0715fc6f-715b-4967-974a-8a515e8f00b7.png" style="width:20.92em;height:14.67em;" width="305" height="213"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Activation options, such as Custom activation start time and Activation reason</div>
<p>Verify that your role is activated. <span><span>Y</span></span>ou have successfully requested your <span class="packt_screen">Global Administrator</span> role for the first time over <span class="packt_screen">Azure AD</span> PIM. This is very useful so that high privileges are not permanently assigned to your account:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/ae5aefa5-1669-400b-b764-f3c23fb19cb1.png" width="1654" height="288"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Active roles overview</div>
<p>We always recommend that you leave one <span class="packt_screen">Global Administrator</span> permanently assigned, and that no Azure MFA is required to use the account. Use this account as a <span class="packt_screen">Breaking Glass</span> account if the Azure AD PIM or MFA service is not available.</p>
<p>Next, we will configure user and group-based application access in Azure AD.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Provide user and group-based application access</h1>
                </header>
            
            <article>
                
<p>In this section, we configure a typical workplace, which a user can access under the Access Panel UI (<a href="https://myapps.microsoft.com">https://myapps.microsoft.com</a>). We assign applications to users and groups to see the different capabilities. The steps don't contain all single sign-on or provisioning options. We will discuss these feature sets later in specific chapters.</p>
<div>
<p><span>Log in to <a href="https://portal.azure.com">https://portal.azure.com</a> with your <span class="packt_screen">Global Administrator</span> credentials and add several applications from the application gallery under the <span class="packt_screen">Enterprise applications</span> section. After adding the applications, we assign the accounts, which are to be provided access.</span></p>
<p><span>Build a list of applications like the following, and assign all groups to access the applications, except the one with user provisioning:</span></p>
</div>
<p class="CDPAlignCenter CDPAlign"><img src="Images/069e6d8d-610a-4a3c-8891-cb00f484a33e.png" style="width:65.42em;height:28.50em;" width="1246" height="544"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Azure AD application management</div>
<div class="packt_tip">You will note the differences in the format with and without user provisioning.</div>
<p>Test your newly configured workplace and log in as <kbd>don.hall@domain.onmicrosoft.com</kbd> to <a href="https://myapps.microsoft.com">https://myapps.microsoft.com</a>:<a href="https://myapps.microsoft.com"/></p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/ee83c137-357e-45f2-8b51-a27fc44dd801.png" style="width:52.50em;height:19.25em;" width="1133" height="416"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Azure AD access panel UI - application access</div>
<p>Also, test the user experience on Office 365 and log in as <kbd>don.hall@domain.onmicrosoft.com</kbd> to <a href="https://portal.office.com">https://portal.office.com</a>.</p>
<p>Next, we will assign applications to users.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Assign applications to users and define login information</h1>
                </header>
            
            <article>
                
<p>In the next step, we will assign the LinkedIn application to Don Hall, with the company credentials. Don Hall will not be able to see the credentials. So, if he leaves the company, the credentials are still protected.</p>
<p>Add the LinkedIn application from the application gallery and assign Don Hall to access this application:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/7b66c8b1-aa54-494b-98db-b488b1dc004b.png" width="1121" height="303"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Application - Users and Groups assignment</div>
<p>Next, we provide valid LinkedIn credentials. If you don't have a LinkedIn account, register a demo one:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/c19c6bfa-faa4-4d0c-b319-ad05d671f35e.png" style="width:21.33em;height:17.58em;" width="308" height="255"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Azure AD Credentials store</div>
<div class="packt_infobox">
<p>If you assign an application to a group, you can decide whether the credentials will be shared:</p>
</div>
<p>The following options for working with credential sets are available:</p>
<ul>
<li><strong>View with shared credentials</strong>: Users can view this just a few seconds after clicking the application. Test it with the Twitter app.</li>
<li><strong>View with no shared credentials</strong>: Users need to add the preferred credentials once. Test it with the Twitter app.</li>
</ul>
<div class="packt_tip">
<p>You get the same behavior if you, as the administrator, don't provide the credentials.</p>
</div>
<p><span>Test this behavior with the user account, a</span><span>ssign applications to groups, and define login information.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Assign applications to groups and define login information</h1>
                </header>
            
            <article>
                
<p>In the next steps, we do the same for groups, such as an HR group that uses these groups to get news from an individual Twitter channel:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/9285b4e9-2641-4fb4-ada3-37a299f8073c.png" style="width:63.33em;height:19.00em;" width="882" height="265"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Filling the Azure AD Credentials store for application access</div>
<p><span>Add the Twitter app from the application gallery. Assign the HR group and configure the credentials. Check the application at <a href="https://myapps.microsoft.com">https://myapps.microsoft.com</a> with a user of the HR group.</span></p>
<p>Now, we can configure the self-service application management.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Self-service application management</h1>
                </header>
            
            <article>
                
<p>In this section, we allow users to add their applications to their workplace under <a href="https://myapps.microsoft.com">https://myapps.microsoft.com</a> to enjoy the <span class="packt_screen">Single Sign-On</span> feature. Under your Azure AD in the <span class="packt_screen">Configure</span> section, navigate to <span class="packt_screen">Enterprise applications</span>. Activate the function<span> </span><span>shown here:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/01e4a482-7c92-49ff-a6d9-83b2b201f85c.png" style="width:48.92em;height:19.42em;" width="785" height="310"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Enterprise applications management options</div>
<p>Log in as <kbd>Ellen.Adams@domain.onmicrosoft.com</kbd> to <a href="https://myapps.microsoft.com">https://myapps.microsoft.com</a>. Click <span class="packt_screen">Get more applications</span> and add MailChimp. After you add MailChimp, click <span class="packt_screen">Manage applications</span> and choose MailChimp.</p>
<p>As <kbd>admin@domain.onmicrosoft.com</kbd> on <a href="https://manage.windowsazure.com">https://manage.windowsazure.com</a>, you can see the newly added application under the <span class="packt_screen">Enterprise applications</span> section of your Azure AD.</p>
<p>Configure the application, add some users, and test it!</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Password reset self-service capabilities</h1>
                </header>
            
            <article>
                
<p>In this section, we configure the password reset capabilities of Azure AD to reduce support costs and <span>24/7</span><span> availability. We use no restrictions on the service and we require just one verification option to reset the password:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/b544f817-7ef2-4eba-8fda-f234fbb6e944.png" style="width:32.00em;height:18.42em;" width="544" height="313"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Password reset - Properties dialog to select the activation options</div>
<p><span>To verify the reset, we use several methods:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/d08719a8-667b-48dd-a6aa-82e3420ed80d.png" style="width:52.58em;height:30.25em;" width="943" height="542"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Password reset - authentication options</div>
<p>The next option we activate forces the user to register:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/48184f13-684d-4c4a-b7d7-8b9985287653.png" style="width:53.92em;height:13.75em;" width="942" height="240"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Password reset - Registration requirement and confirming choices</div>
<p>Next, we configure the related notifications.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Configure notifications</h1>
                </header>
            
            <article>
                
<p>In this section, we configure the notifications options so that the administrator will be notified if anomalous sign-ins or administrator password resets happen:</p>
<ol>
<li>Configure the <span class="packt_screen">Notifications</span> as shown here:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/a68537a8-66ce-44a2-b1e0-974e16e18dd2.png" style="width:41.25em;height:15.50em;" width="668" height="251"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Password reset - NotificationS options</div>
<ol start="2">
<li>Users will be forced to register for a password reset, as shown in the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/0f422386-f61f-4ffc-b4b1-0d331b477f74.png" style="width:29.33em;height:10.08em;" width="654" height="225"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Registration enforcement</div>
<p>Now, we will test our newly configured feature and will see the registration scenario <span>required</span><span> </span><span>for your verification options. Next, we will check the password reset.</span></p>
<p>Test the newly configured settings and log in as <kbd>Don.Hall@domain.onmicrosoft.com</kbd> to <a href="https://myapps.microsoft.com">https://myapps.microsoft.com</a>.</p>
<p>You will receive a message that you need to register for a password reset:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/641bcf1d-e047-46e0-9a72-335b4b2c02e7.png" style="width:41.08em;height:20.67em;" width="936" height="470"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Authenticator app - setup procedure</div>
<p>Add your preferred method for Don Hall. You will receive an SMS text message, an email to your mailbox, or another of your defined<span> </span><span>response</span><span> methods.</span></p>
<div class="packt_infobox"><span>Administrative users need two verification options by default.</span></div>
<p>Log in as <kbd>admin@domain.onmicrosoft.com</kbd> to <a href="https://myapps.microsoft.com">https://myapps.microsoft.com</a> , and you will see the request for two verification options.</p>
<p>In the next steps, we will verify the functionality.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Test the password reset process</h1>
                </header>
            
            <article>
                
<p>Open <kbd>https://myapps.microsoft.com</kbd> in your preferred browser and enter <kbd>Don.Hall@domain.onmicrosoft.com</kbd>. Click the <span class="packt_screen">Can't access your account</span>? <span>option</span><span> </span><span>or use the following link, <a href="https://passwordreset.microsoftonline.com">https://passwordreset.microsoftonline.com</a>, to start the password reset process. </span>You will come into the verification process, and you need to follow the tasks. Finish the process and log in with the new password.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Using standard security monitoring</h1>
                </header>
            
            <article>
                
<p>In this section, we will configure and simulate some typical events that get reported in the Azure AD Monitoring section.</p>
<p>First, we configure a <span class="packt_screen">Password protection</span> feature, <span class="packt_screen">Custom smart lockout</span>. We set <span>the value to <kbd>10</kbd> incorrect logins:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/59936ce8-6a98-47e5-ad66-d4dc4295bd17.png" style="width:55.42em;height:32.92em;" width="970" height="577"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Azure AD password protection features</div>
<p>You should receive the following message if you provide<span> </span><span>a wrong password</span><span> 10 times:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/2195dd87-018b-498e-b26e-cb7b1f1990ed.png" style="width:20.58em;height:15.33em;" width="514" height="381"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Locked message dialog</div>
<p>You can see the activity under <span class="packt_screen">Monitoring</span> | <span class="packt_screen">Sign-In</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/6590a08a-0d8a-4591-b98d-95b87db3152f.png" style="width:72.00em;height:16.08em;" width="1352" height="302"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Azure AD monitoring capabilities</div>
<p>You can also test <span class="packt_screen">Sign-ins from multiple geographies</span> <span>with simulation software such as <strong>CyberGhost</strong> (<a href="http://www.cyberghostvpn.com/en_us">http://www.cyberghostvpn.com/en_us</a>). Another option would be to use an Azure Virtual Machine.<br/></span></p>
<p>Log in with an account between geographic regions that are far apart, such as Europe and Asia. This requires a remote machine from your location and in a different time zone, with logons as close together as possible:</p>
<ul>
<li>Log in to <a href="https://myapps.microsoft.com">https://myapps.microsoft.com</a> as <kbd>Don.Hall@domain.onmicrosoft.com</kbd> from your local PC</li>
<li>Log in to <a href="https://myapps.microsoft.com">https://myapps.microsoft.com</a> as <kbd>Don.Hall@domain.onmicrosoft.com</kbd> on a machine in a different time zone than your original PC</li>
</ul>
<div>
<p><span>To configure users with an anomalous sign-in activity, you can use the Tor browser:</span></p>
</div>
<ul>
<li>Utilize an anonymous browsing tool such as Tor</li>
<li>Download the secure Tor browser from <a href="https://www.torproject.org/download/download-easy.html.en">https://www.torproject.org/download/download-easy.html.en</a></li>
</ul>
<p>Open the Tor browser, go to <a href="https://myapps.microsoft.com">https://myapps.microsoft.com</a>, and log in as <kbd>Don.Hall@domain.onmicrosoft.com</kbd>. Your user account will be locked.</p>
<p>The following result is expected in security monitoring:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/50041110-ac0f-4e34-b18b-a4e6cbd65ef7.png" style="width:33.42em;height:44.08em;" width="594" height="785"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Security monitoring overview - Azure AD</div>
<p>Now that we have had a short journey through the security-monitoring options, we will integrate our Windows 10 client into Azure AD.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Integrating Azure AD Join for Windows 10 clients</h1>
                </header>
            
            <article>
                
<p>In this section, we will configure the Azure AD Join functionality and join our first Windows 10 client to Azure AD.</p>
<p>We configure a maximum of five devices per user and leave the other default values:</p>
<p class="mce-root CDPAlignCenter CDPAlign"><img src="Images/236f791d-ef39-4bd4-9d4f-4f87197c6ca6.png" width="1239" height="673"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Azure AD - Device settings</div>
<p>In the next section, we will join our client to Azure AD.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Join your Windows 10 client to Azure AD</h1>
                </header>
            
            <article>
                
<p>Log in to your freshly installed Windows 10 client machine and go to <span class="packt_screen">Settings</span>. Choose <span class="packt_screen">Connect</span> in the <span class="packt_screen">Access work or school</span> section:</p>
<p class="mce-root CDPAlignCenter CDPAlign"><img src="Images/d043ca16-c8d9-48ad-979d-c2a24a1e5139.png" style="width:34.25em;height:20.00em;" width="813" height="475"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Azure AD Join process dialog</div>
<p>We sign in with <kbd>don.hall@domain.onmicrosoft.com</kbd> and join the Windows 10 client to Azure AD:</p>
<div class="CDPAlignCenter CDPAlign"><img src="Images/61c50821-945d-4bb0-8665-510745984f14.png" style="width:28.25em;height:26.50em;" width="648" height="609"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Join actions overview</div>
<p>Click through the <span class="packt_screen">Next</span> sections and finish joining the client. Afterwards, we will check the new status. The expected result will be the connection to your Azure AD name:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/7182198d-0a64-4cf7-a521-3637c4e479c8.png" style="width:25.33em;height:7.67em;" width="485" height="148"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Azure AD joined client message</div>
<p>Afterward, we will verify the Azure AD Join process.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Verify the newly joined Windows 10 client</h1>
                </header>
            
            <article>
                
<p>Log in to the Windows 10 client with the credentials of <kbd>don.hall@domain.onmicrosoft.com</kbd> and click through the security policy configuration. Click <span class="packt_screen">Enforce these policies</span>. Click through the PIN setup and finish the process, then test the user experience:</p>
<ul>
<li>Open the mail application, and you will see that the system recognizes your user ID and <span class="packt_screen">Single Sign-On</span> is provided.</li>
<li>Also, if you open <a href="https://myapps.microsoft.com">https://myapps.microsoft.com</a>, you will be directly logged in to the access panel UI:</li>
</ul>
<p class="mce-root CDPAlignCenter CDPAlign"><img src="Images/48fdb9c9-f5b9-4350-8193-a1b2bbdf8073.png" style="width:21.08em;height:13.75em;" width="441" height="287"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Different mail account options</div>
<p>After verifying the Azure AD Join, we will configure a custom domain. Be aware that you need to register a domain if you want to test the associated functionality.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Configuring a custom domain</h1>
                </header>
            
            <article>
                
<p>Under the <span class="packt_screen">Azure Active Directory</span> | <span class="packt_screen">Custom domain</span> section, click <span class="packt_screen">Add custom domain</span> and complete the verification process to prove that you are the owner of the domain:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/905e2a04-c21e-4430-804d-0e12897e9a3f.png" width="1551" height="287"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Actual configured domains</div>
<p>Add the <span class="packt_screen">TXT</span> entry <span>shown</span><span> </span><span>to your DNS zone to verify the domain:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/908703a0-f6d5-432d-82e9-c7bbb0959a58.png" style="width:32.00em;height:25.42em;" width="614" height="486"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Domain verification options</div>
<p>Click the <span class="packt_screen">Verify</span> button on your Azure portal, and after successful verification, the new <kbd>DOMAIN NAME</kbd> will appear under <span class="packt_screen">DOMAINS</span>. Choose the <span class="packt_screen">Make primary</span> option:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/8d7858b2-3efe-484e-9590-5796a1e6a59b.png" style="width:33.83em;height:23.92em;" width="615" height="435"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Custom domain overview and configuration options (Make primary or Download the Azure AD Connect tool)</div>
<p>Open <a href="https://portal.office.com">https://portal.office.com</a> to complete the domain setup process under the admin section:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/27f4b243-77d5-4fda-b894-abe32104a5df.png" style="width:49.50em;height:10.50em;" width="1037" height="220"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Office 365 setup wizard</div>
<p>Choose the custom domain to be used for email addresses:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/c68834d4-fa43-4034-a5b6-cf6398b047a4.png" width="1197" height="286"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Sign-in and mail options</div>
<p>The last step we need to take is to set the new <kbd>UserPrincipalNames</kbd> to the existing users. We do this with a small example scripting solution:</p>
<ol>
<li>Connect to your Azure AD with your global administrator credentials:</li>
</ol>
<pre style="padding-left: 60px"><strong>Connect-AzureAD</strong></pre>
<ol start="2">
<li>Export the existing users to a CSV file with the following cmdlet:</li>
</ol>
<pre style="padding-left: 60px"><strong>Get-AzureADUser -All $True | Where { $_.UserPrincipalName.ToLower().EndsWith("onmicrosoft.com")} | Export-Csv C:\Office365Users.csv</strong></pre>
<ol start="3">
<li>Remove all accounts you don't want to modify and make the change with the following cmdlets:</li>
</ol>
<pre style="padding-left: 60px"><strong>$domain = "inovitlabs.ch"</strong><br/><strong>Import-Csv 'C:\Office365Users.csv' | ForEach-Object {</strong><br/><strong>$newupn = $_.UserPrincipalName.Split("@")[0] + "@" + $domain</strong><br/><strong> Write-Host "Changing UPN value from: "$_.UserPrincipalName" to: " $newupn -ForegroundColor Green</strong><br/><strong> Set-AzureADUser -ObjectId $_.UserPrincipalName -UserPrincipalName $newupn</strong><br/><strong>}</strong></pre>
<ol start="4">
<li>You should get a result similar to this:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/3279dc33-05cc-4006-b039-56615013fb6f.png" style="width:47.42em;height:19.58em;" width="1037" height="430"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Active users overview</div>
<p>The primary email will also be changed to the custom domain.</p>
<p>Next, we will configure the Azure AD Domain services to provide a transition scenario for a Kerberos-based application that i<span>s</span><span> </span><span>normally provided in on-premises infrastructure.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Configure Azure AD Domain Services</h1>
                </header>
            
            <article>
                
<p>To integrate a legacy application based on Kerberos authentication in an Azure <strong>infrastructure as a service</strong> (<strong>IaaS</strong>) scenario, we configure Azure AD Domain Services. In this section, we configure the basic service and integrate an active example application:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/36d8ebde-f46e-4a3e-8b6b-208256dfa6b8.png" style="width:20.42em;height:15.25em;" width="566" height="424"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Azure AD Domain Services creation</div>
<p>To start the configuration, we need to specify the <span class="packt_screen">DNS domain name</span>, the Azure <span class="packt_screen">Subscription</span> we want to use, and the name of the <span class="packt_screen">Resource group</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/ef745788-6bed-4d25-bfae-dcb9566aa98d.png" style="width:36.75em;height:25.33em;" width="624" height="430"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Azure AD Domain Services configuration</div>
<p>When enabling Azure AD Domain Services, you will need to specify which Azure virtual network to use. We use a range <kbd>192.168.x.x/20</kbd> to configure the network:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/ef3a1a09-635f-41ac-9fb9-6342d9d19b15.png" width="1240" height="481"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Virtual network configuration</div>
<p><span>Add the admin account and your test user as a member of the <span class="packt_screen">Azure AD Domain Services</span> <span class="packt_screen">Administrator group</span>:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/64d43463-2317-4156-b42b-cb0d47a4e1a7.png" style="width:63.75em;height:17.50em;" width="934" height="256"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Azure AD Domain Services Administrator group members</div>
<p>The summary should look like the following:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/51ed8343-3fde-487d-ac50-35f5d0813012.png" style="width:27.25em;height:25.50em;" width="447" height="419"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Configuration summary</div>
<p>Next, you will be asked to update the DNS configuration to the addresses of your DNS servers provided by Azure AD Domain Services. In my case, these addresses were <kbd>192.168.0.4</kbd> and <kbd>192.168.0.5</kbd>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/7c4b8809-8be4-4ffc-a62a-2423c961693b.png" style="width:29.75em;height:15.83em;" width="479" height="256"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">DNS configuration</div>
<p><span>The last important step that you need to complete to use the domain you have just created is to enable password synchronization:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/e1789118-bd27-4eb7-af8e-fe036d4aba65.png" style="width:24.25em;height:14.83em;" width="460" height="280"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Instructions to synchronize users</div>
<p>By default, Azure AD does not store the credential hashes required for Kerberos authentication. You need to populate these credential hashes in Azure AD so that users can use them to authenticate against the domain. The process can be completed by changing the password of the user. You can use the accounts after 20 minutes in Azure AD Domain Services.</p>
<div class="packt_tip">You have two options: let passwords expire for all users or instruct these end users to change their passwords.</div>
<p>Users can use Azure AD's self-service password change mechanism from the Azure AD Access Panel page to change their passwords.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Test and verify your new Azure AD Domain Services</h1>
                </header>
            
            <article>
                
<p>To test the Domain Services, we complete the following tasks:</p>
<ol>
<li>Install a virtual Windows Server in your Azure IaaS environment by using a deployment template (<a href="https://docs.microsoft.com/en-us/azure/active-directory-domain-services/active-directory-ds-join-windows-vm-template">https://docs.microsoft.com/en-us/azure/active-directory-domain-services/active-directory-ds-join-windows-vm-template</a>):</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/176c3e40-bf42-4893-85e7-eefd9a880006.png" style="width:39.17em;height:52.75em;" width="760" height="1023"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">VM deployment configuration</div>
<ol start="2">
<li>Install the administrative tools for Active Directory and DNS on the newly joined server:</li>
</ol>
<pre style="padding-left: 60px"><strong>Install-WindowsFeature RSAT-ADDS,DNS-Server-Tools</strong></pre>
<ol start="3">
<li>Connect to <span class="packt_screen">Active Directory Users and Computers</span> (<kbd>dsa.msc</kbd>) and the <span class="packt_screen">Group Policy Management</span> console to verify your configuration:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/8d20500e-2be9-40c1-b09e-920b53d549c6.png" style="width:51.50em;height:31.92em;" width="850" height="527"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Azure AD Domain Services structure including synchronized objects</div>
<ol start="4">
<li>Next, we need to create a <span class="packt_screen">DNS HOST (A)</span> record for our test application:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/29296039-78c7-4c59-a042-2e6bd17da1fd.png" style="width:21.33em;height:21.92em;" width="340" height="349"/></p>
<ol start="5">
<li>Now, we can install a basic IIS configuration, used to handle the Kerberos part. For this, you need to install the IIS components, choose the Kerberos authentication feature, and activate it on the default website. Only <span class="packt_screen">Windows Authentication</span> needs to be activated:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/565bf2f3-06b5-4f22-b906-41ae8c7bba19.png" style="width:39.08em;height:14.67em;" width="669" height="250"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">IIS Authentication configuration for Kerberos example application</div>
<ol start="6">
<li>Next, we will install and configure the Azure AD App Proxy connector to provide the application to your users. We use the following cmdlets to configure the needed, resource-based KCD feature:</li>
</ol>
<pre style="padding-left: 60px"><strong># inovitcloudlabs represents the computer name</strong><br/><strong>$ConnectorComputerAccount = Get-ADComputer -Identity inovitcloudlabs</strong><br/><strong>Set-ADComputer inovitcloudlabs -PrincipalsAllowedToDelegateToAccount $ConnectorComputerAccount</strong><br/><strong>setspn -S HTTP/kerb.inovitlabs.ch inovitlabs\inovitcloudlabs</strong></pre>
<ol start="7">
<li>Next, we will activate and configure the Azure AD App Proxy. To make it simple, we disable the <span class="packt_screen">IE Enhanced Security Configuration</span> so that we don't need to provide any IE Security Zone configurations, just for the lab:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/1611faf6-5ef3-4907-b230-a09b366bf6fd.png" style="width:53.00em;height:21.50em;" width="909" height="369"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Server Manager IE Enhanced Security Configuration</div>
<ol start="8">
<li>Next, we need to download the connector and install it on the server:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/0412bbc0-2f6a-417e-8f56-ee803bfe7c75.png" style="width:37.08em;height:20.67em;" width="874" height="488"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Application Proxy agent download and configuration</div>
<p style="padding-left: 60px">To configure the connector on the server, you need to provide a user with global administrator rights.</p>
<ol start="9">
<li>After installing and configuring the connector, we will add our example app:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/bf19fc3b-a969-4281-a9bd-e52a4ad22bb9.png" style="width:28.50em;height:16.92em;" width="615" height="365"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Azure AD App Proxy Connector group configuration options</div>
<ol start="10">
<li>Next, we configure our example app as shown:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/fc06c4d9-eaa9-4640-bee0-c7a0f5dcf1a1.png" style="width:36.08em;height:44.08em;" width="578" height="707"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Kerberos example configuration</div>
<ol start="11">
<li>Next, we configure the <strong>Integrated Windows Authentication</strong><span class="packt_screen"> </span>(<strong>IWA</strong>) option:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/c190a5e3-f352-42c7-8a9a-b456703b65f9.png" style="width:55.42em;height:26.92em;" width="964" height="468"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Application IWA configuration</div>
<p>Finally, we assign some users or groups and test the application at <a href="https://myapps.microsoft.com">https://myapps.microsoft.com</a>. As a result, you should see the IIS test page. We provided a sample Kerberos-based application to Azure AD Domain Services and used the Azure AD App Proxy functionality.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>After working through this implementation scenario, you will be able to configure and manage a suitable Azure AD tenant for the most important tasks. You will also be able to integrate Windows 10 and Office 365 to build a productive workforce for your users without an on-premises infrastructure. Don't worry if you missed some functionality. This was just a warm-up.</p>
<p>In the next chapter, we will discuss the identity synchronization needed to start with your hybrid integration and to provide the correct identity synchronization scenario for your requirements.</p>


            </article>

            
        </section>
    </div>



  </body></html>