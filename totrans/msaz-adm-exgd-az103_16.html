<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Azure Security Groups and Azure DNS</h1>
                </header>
            
            <article>
                
<p>In the previous chapter, we covered the third <span>part of the <em>Deploying and Managing Virtual Networks</em><em> </em>objective by covering how to monitor and troubleshoot your network traffic in Azure Network Watcher. We've covered how to use Azure Network Watcher for network traffic inside Azure, as well as for on-premises and external networks.</span></p>
<p>In this chapter, we are first going to focus on <strong>Network Security Groups</strong> (<strong>NSGs)</strong> in Azure. We will cover the basics of NSGs, and how you can use them to filter network traffic, and you will also learn how to create and configure them. We are also going to associate an NSG with a <span>subnet or <strong>Network Interfaces</strong> (<strong>NICs</strong>), and we are going to create and evaluate security rules for NSGs. In the second part of this chapter, we are going to cover Azure DNS. You will learn how to set up Azure DNS and how to add DNS zones and DNS records.</span></p>
<p>The following topics will be covered in this chapter:</p>
<ul>
<li><span>NSGs</span></li>
<li>Creating and configuring an NSG</li>
<li>Associating an NSG with a subnet or NIC</li>
<li>Creating and evaluating security rules</li>
<li>Azure DNS</li>
<li>Configuring private and public DNS zones</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Technical requirements</h1>
                </header>
            
            <article>
                
<p><span>The source code for our sample application can be downloaded from <a href="https://github.com/PacktPublishing/Microsoft-Azure-Administrator-Exam-Guide-AZ-103/tree/master/Chapter12">https://github.com/PacktPublishing/Microsoft-Azure-Administrator-Exam-Guide-AZ-103/tree/master/Chapter12</a><a href="https://github.com/PacktPublishing/Microsoft-Azure-Administrator-Exam-Guide-AZ-103/tree/master/Chapter12">.</a></span></p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">NSGs</h1>
                </header>
            
            <article>
                
<p>You can use an NSG to filter network traffic to and from Azure resources that reside in an Azure virtual network. An NSG is an access control list inside Azure where you can add inbound and outbound security rules that allow or deny traffic from several types of resources.</p>
<p>When a connection is established between VMS, VNets, or other cloud services, this list is checked to see whether the connection is allowed or denied. NSGs can be applied to one or more subnets or individual NICs. This means that all resources that are associated with this subnet or NIC will automatically have all the rules applied. <span>NSG rules are processed in priority order using the five-tuple information (source, source port, destination, destination port, and protocol) to allow or deny traffic. They are evaluated by priority, with lower numbers before higher numbers, and they can be applied to inbound or outbound traffic.</span></p>
<div class="packt_infobox"><span>There is a limit to how many rules per NSG can create per Azure location and subscription. For details, see the documentation on </span>Azure limits at : <a href="https://docs.microsoft.com/en-us/azure/azure-subscription-service-limits?toc=%2fazure%2fvirtual-network%2ftoc.json#azure-resource-manager-virtual-networking-limits">https://docs.microsoft.com/en-us/azure/azure-subscription-service-limits?toc=%2fazure%2fvirtual-network%2ftoc.json#azure-resource-manager-virtual-networking-limits</a><span>.</span></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Service tags</h1>
                </header>
            
            <article>
                
<p>To help minimize the complexity of <span>security rule creation, Azure offers service tags. They represent a group of IP address prefixes and you can use service tags in place of specific IP addresses when creating security rules. These service tags can't be created manually; they are created and managed by Azure. </span></p>
<p>Azure offers an exhaustive list of service tags, such as the following:</p>
<ul>
<li><strong>VirtualNetwork</strong>: This tag includes the virtual network address space, all connected on-premises address spaces, peered virtual networks, and all virtual networks connected to a virtual network gateway. </li>
<li><strong>AzureLoadBalancer</strong>:<strong> </strong>This tag covers the Azure Load Balancer. It translates to the virtual IP address of the host from where the health probes originate. </li>
<li><strong>Internet</strong>: This tag is for the IP address space that is outside the virtual network and reachable from the public internet. </li>
<li><strong>AzureKeyVault</strong>: This tag is for the address prefixes of the Azure Key Vault service. If you specify<span> </span><kbd>AzureKeyVault</kbd><span> </span>for the value, traffic is allowed or denied to Azure Key Vault. You can also only access Azure Key Vault in a <span>specific</span> <span><span>region.</span></span></li>
</ul>
<div class="packt_infobox">For a complete overview of all the service tags that Azure has to offer, you can refer to the documentation at: <a href="https://docs.microsoft.com/en-us/azure/virtual-network/security-overview">https://docs.microsoft.com/en-us/azure/virtual-network/security-overview</a>.</div>
<p>In the next demonstration, we are going to create and configure an NSG in the Azure portal.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating and configuring an NSG</h1>
                </header>
            
            <article>
                
<p>NSGs can be created from the Azure portal, PowerShell, and CLI. In this demonstration, we are going to create an NSG from the Azure portal and configure it. We are going to associate the NSG with a subnet and create and evaluate security rules.</p>
<p>To create an NSG from the Azure portal, take the following steps:</p>
<ol>
<li><span>Navigate to the Azure portal by opening </span><a href="https://portal.azure.com">https://portal.azure.com</a>.</li>
<li>Click <strong>Create a resource</strong> in the left menu and type <kbd>Network Security Group</kbd> into the search bar.</li>
<li>Create a new NSG.</li>
<li class="CDPAlignLeft CDPAlign">Add the following settings:
<ul>
<li><strong>Name</strong>: <kbd>PacktNSG</kbd>.</li>
<li><strong>Subscription</strong>: Select the subscription that we used for creating the VNet in <a href="9477b805-9d4d-4908-9cbf-577c2e973203.xhtml">Chapter 9</a>, <em>Implementing and Managing Virtual Networking</em>.</li>
<li><strong>Resource group</strong>: <span>Select the subscription that we used for creating the VNet in <a href="9477b805-9d4d-4908-9cbf-577c2e973203.xhtml"/><a href="9477b805-9d4d-4908-9cbf-577c2e973203.xhtml">Chapter 9</a>, <em>Implementing and Managing Virtual Networking. </em></span><span>In my case, this is </span><kbd>PacktVNetResourceGroup</kbd>.</li>
<li><strong>Location</strong>: <span class="packt_screen">(US)</span> <span class="packt_screen">East US</span>:</li>
</ul>
</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/ce5942ea-c709-46e5-99c1-f464aa6f9cbd.png" style="width:22.33em;height:28.42em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Creating a new NSG</div>
<ol start="5">
<li>Click <strong>Create</strong>.</li>
</ol>
<p>We have now created a new NSG and added it to the <kbd>PacktVNetResourceGroup</kbd>. This is the same resource group as where the virtual networks reside. In the next part of this demonstration, we are going to associate the NSG with a subnet and NIC.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Associating an NSG with a subnet or NIC</h1>
                </header>
            
            <article>
                
<p>To associate the NSG with a subnet, you have to take the following steps:</p>
<ol>
<li>After creating the NSG, navigate to its overview page.</li>
<li>Under <strong>Settings</strong><span>, select </span><strong>Subnets</strong> <span>to associate the NSG with a subnet. Click</span> <strong>Associate</strong> <span>in the top menu:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/7f035d88-70bb-437f-bf1f-701f8b31fe25.png"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Associating an NSG with a subnet</div>
<ol start="3">
<li>First, we need to select a virtual network. Select <kbd>PacktVNet</kbd>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/1e9e7a93-3ede-4c71-bbd7-1623506c0383.png"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref"><span>Selecting a virtual network</span><strong><br/></strong></div>
<ol start="4">
<li>Next, we need to select <strong>Subnet</strong>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/684dd592-5921-4c34-80bd-10d8436c7963.png"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Selecting the subnet</div>
<ol start="5">
<li>Click <strong>OK</strong>. The NSG will now be associated with the subnet.</li>
<li>To associate the NSG with an NIC, under <strong>Settings</strong><span>, select </span><span class="packt_screen">Network <span>interfaces</span></span><span>. Select </span><strong>Associate</strong> <span><span>in the top menu:</span></span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/27b8fe7c-dd35-4edd-bbd4-62c68d4b803c.png"/></p>
<div class="CDPAlignCenter CDPAlign packt_figref"><span>Associating NSG with a NIC<br/>
<br/></span></div>
<ol start="7">
<li>There, you can select an NIC that resides in the same region as where the NSG was created:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/708715ee-aa23-442d-92a5-c31ece432045.png" style="width:18.42em;height:25.58em;"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Selecting an NIC</div>
<ol start="8">
<li>After selecting the NIC, the NSG is associated with it.</li>
</ol>
<p>In this demonstration, we've covered how to associate an NSG with a subnet and a NIC. In the next demonstration, we are going to cover how to create and evaluate security rules.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating and evaluating security rules</h1>
                </header>
            
            <article>
                
<p>When you create an NSG, there are some <span>default inbound and outbound security rules created for you automatically. The default rules are low-priority rules. You can also add custom rules to them. You can create </span>inbound and outbound security rules. In <span>this demonstration, we are going to create an inbound security rule that denies RDP traffic to the associated subnet. Therefore, you have to take the following steps:</span></p>
<ol>
<li>First, go the overview page of the NSG. In there, you can see the default inbound and outbound security rules:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/f6a98a5d-2272-4376-95a4-76d1176bd6e2.png"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Default security rules</div>
<ol start="2">
<li>Then, under <strong>Settings</strong>, select <span><strong>Inbound security rules</strong> to add a custom rule. Then click <strong>Add</strong> in the top menu:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/3c400c35-9f54-4b29-8734-29383f085a22.png"/></p>
<ol start="3">
<li>We are going to deny all traffic over port <kbd>3389</kbd>, which is the RDP port. Therefore, we select the <strong>Service Tag for Source</strong> field and the <strong>Internet for Source</strong> service tag,<strong> </strong>set the destination to <span class="packt_screen">VirtualNetwork</span> and the destination port ranges to <kbd>3389</kbd> over any protocol. The action will be set to <strong>Deny</strong>. We are going to set the priority to <strong>100</strong>, which is the highest priority:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/af5cc6ab-d809-4b8c-a10e-c470cdf999bc.png" style="width:22.33em;height:44.00em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Creating a security rule</div>
<ol start="4">
<li>Click <strong>Add</strong>.</li>
<li>We have<span> now</span> created an inbound security rule that denies all RDP traffic. This rule is bound to the subnet, because we associated this NSG with a subnet.</li>
<li>To evaluate this security rule, deploy a VM inside this resource group, virtual network, and subnet. Also, enable RDP for it. After deployment, try connecting to it. If the security rule got applied correctly, you should receive the following error message:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/5d3d8c17-dbaf-40da-a521-906d0c53af5f.png" style="width:39.25em;height:16.00em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Error message</div>
<p>This concludes the Azure NSG section. In the last part of this chapter, we are going to cover <strong>Azure DNS</strong>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Azure DNS</h1>
                </header>
            
            <article>
                
<p>Azure DNS is a hosting service for DNS domains that can be used for name resolution. <span>The process of name resolution involves converting a hostname (such as <kbd>www.packt.com</kbd>) into an IP address (such as <kbd>192.168.1.1</kbd>). DNS servers eliminate the need for humans to memorize difficult IP addresses. In Azure, </span>you can manage your DNS records using the Microsoft Azure infrastructure and the same tools and billing as you use for your other Azure resources.</p>
<p>Azure DNS can't be used as a <span>domain registrar,</span> <span>However, </span>you can host your DNS names that are registered somewhere else, such as a<span> third-party domain name registrar, for instance, in Azure DNS for record management. You then have to delegate the domain to Azure DNS in order for the DNS queries for a certain domain to reach Azure DNS. </span></p>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Domain names</h1>
                </header>
            
            <article>
                
<p>The DNS consists of a hierarchy of different domains. They are globally distributed over DNS servers around the world. The root<strong> </strong>domain is simply named <kbd>.</kbd>. Below the root domain comes the top-level domains, such as <kbd>.</kbd><kbd>com</kbd>, <kbd>.</kbd><kbd>net.</kbd>, <kbd>.org</kbd>, and more. Below that comes the second-level domains, such as <kbd>.</kbd><kbd>org.uk</kbd>.</p>
<p>You can buy your domain name from a domain registrar. This will give the right to control the DNS hierarchy under that name allowing you to do things, such as redirecting the domain to your own website. You can let the registrar host the domain at its nameservers on your behalf, or you can specify alternative nameservers for your domain. Azure DNS can be used as such an alternative name server where you can control the DNS hierarchy.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Public DNS zones</h1>
                </header>
            
            <article>
                
<p>To start hosing your domain in Azure DNS, you first need to create a DNS zone for your domain. This is used to host all the different DNS records. For instance, the <kbd>www.packt.com</kbd> <span>domain</span> can contain multiple DNS records, such as <kbd>mail.packt.com</kbd> for a mail server and <kbd>www.packt.com</kbd> for the company website.</p>
<p>When you create a DNS zone in Azure DNS, you have to keep the following things in mind:</p>
<ul>
<li>The name of the zone must be unique within the resource group. The zone must<span> also</span> not already exist in the resource group.</li>
<li>You can reuse the same zone across different resource groups or different subscriptions.</li>
<li>When you have multiple zones with the same name across different resource groups or subscriptions, each instance must contain a different nameserver address. <span>Only one set of addresses can be configured with the domain name registrar.</span></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Private DNS zones</h1>
                </header>
            
            <article>
                
<p>With <strong>private DNS zones</strong>, you can manage and resolve domain names in a virtual network without the need to add a custom DNS solution. You can use your own custom DNS names, rather than the Azure-provided names that are available. You can use these custom domain names to tailor your virtual network architecture to suit your organization's needs. </p>
<p>Private DNS zones provide name resolution for VMs within a VNet and between different VNets. You can also configure zone names that share private and public DNS zones to share the same name.</p>
<p>To publish a private DNS zone to a VNet, you first need to specify a list of virtual networks that are allowed to resolve records within the private DNS zone. These virtual networks are then called <strong>resolution virtual networks</strong>. You can also specify a registration virtual network, which is then used by Azure DNS for maintaining the hostname records when a VM is created. It is also used for IP changes of the VM, and when a VM is deleted.</p>
<div class="packt_infobox">At the time of writing this book, the <span>Azure DNS private zone feature is in public preview.</span></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Record types</h1>
                </header>
            
            <article>
                
<p>Each DNS record that you create inside the DNS zone has a name and a type. The different records are organized into various types according to the type of data that they contain. For instance, an A record maps the domain name to an IPv4 address. Another example is an <span>MX record, which maps a name to a mail server.</span></p>
<div class="packt_infobox">For more information about the different record types, you can go to <a href="https://docs.microsoft.com/en-in/azure/dns/dns-zones-records">https://docs.microsoft.com/en-in/azure/dns/dns-zones-records</a>. SPF records are represented using TXT records in Azure DNS: <a href="https://docs.microsoft.com/en-in/azure/dns/dns-zones-records#spf-records">https://docs.microsoft.com/en-in/azure/dns/dns-zones-records#spf-records</a>.</div>
<p>You can also create record sets in Azure DNS. They can be used to map different records<span> in a zone together that have the same name and are of the same type—f</span><span>or instance, when you have a company website that is hosted on two different IP addresses:</span></p>
<pre>www.packt.com. 3600 IN A 134.170.185.46<br/>www.packt.com. 3600 IN A 134.170.188.221</pre>
<p>When you've created the A record in the <kbd>packt.com</kbd> zone pointing to the first IP address,  you can <span>then</span> add the second record to the existing records set, instead of creating a new <span>an additional record set.</span></p>
<p>In the upcoming section, we are going to configure private and public DNS zones in Azure DNS.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring a public DNS zone</h1>
                </header>
            
            <article>
                
<p>To configure private and public DNS zones from the Azure portal, you have to take the following steps:</p>
<ol>
<li><span>Navigate to the Azure portal by opening </span><a href="https://portal.azure.com">https://portal.azure.com</a>.</li>
<li>Click <strong>Create a resource</strong><span> </span>in the left menu and type<span> </span><kbd>DNS Zone</kbd> in the search bar. Create a new DNS zone.</li>
<li>Add the following values to create a new DNS zone:<br/>
<ul>
<li><strong>Subscription</strong>: Select a subscription.</li>
<li><strong>Resource group</strong>: Create a new one, and call it <kbd>PacktDNSResourceGroup</kbd>.</li>
<li><strong>Name</strong>: <kbd>packtdns.com</kbd>.</li>
<li><strong>Resource group location:</strong> <span class="packt_screen">(US) <span>East US</span></span>:</li>
</ul>
</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/d4bc0192-5e14-4739-8de1-998d57f63264.png" style="width:42.67em;height:29.92em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Creating a new DNS zone</div>
<ol start="4">
<li>Click <strong>Review + create</strong>.</li>
<li class="mce-root"><span>When the resource is deployed, you can add DNS records to it. From the overview page, in the top menu, select </span><span><span class="packt_screen">+ Record set</span>:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/bc5a8c2a-027c-463e-b585-69ac6c0caa4a.png"/></div>
<p class="mce-root CDPAlignCenter CDPAlign"><sub><span>Adding a new record</span></sub></p>
<ol start="6">
<li>To create an A record, add the following values:
<ul>
<li><strong>Name</strong>: <kbd>www</kbd>.</li>
<li><strong>Type</strong>: Select<span> </span><strong>A</strong>.</li>
<li><strong>TTL</strong>: Type<span> </span><kbd>1</kbd>. The<span> </span><strong>Time-to-live</strong><span> (<strong>TTL</strong>) parameter </span>of the DNS request specifies for how long DNS servers and clients can cache a response.</li>
<li><strong>TTL unit</strong>: Select<span> </span><strong>Hours</strong>. This is the time unit for the<span> </span><strong>TTL</strong><span> </span>value.</li>
<li><strong>IP address</strong><span>:</span> <kbd>10.10.10.10</kbd>: </li>
</ul>
</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/82c0a6ee-7abc-4aaa-8cc2-a1ecb6418505.png" style="width:26.00em;height:31.42em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Adding a new record</div>
<ol start="7">
<li>Click <strong>OK</strong>.</li>
</ol>
<ol start="8">
<li>When the record is added, we can test it using the <kbd>nslookup</kbd> command.<strong> </strong><span>First, we need to copy one of the nameservers:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/f69755e1-a563-4f6a-bcc0-e686125a68c3.png"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Copying the name server value</div>
<ol start="9">
<li>Then, open a command prompt and enter the following command:</li>
</ol>
<pre style="padding-left: 60px" class="mce-root"><strong>nslookup www.packtdns.com ns1-08.azure-dns.com.</strong></pre>
<ol start="10">
<li>You will see something such as the following, which means that name resolution is working correctly:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/ec332e26-ece9-4e78-a273-48da51138cf3.png" style="width:38.92em;height:15.58em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">DNS name resolution</div>
<p>In this demonstration, we configured a public DNS zone. In the next demonstration, we are going to cover how you can configure a private DNS zone using the CLI and Azure Cloud Shell.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring a private DNS zone</h1>
                </header>
            
            <article>
                
<p>In this demonstration, we are going to create a private DNS zone in a new resource group. </p>
<p>To configure a private DNS zone using the CLI from Azure Cloud Shell, you have to take the following steps:</p>
<ol>
<li><span>Navigate to the Azure portal by opening </span><a href="https://portal.azure.com">https://portal.azure.com</a>.</li>
<li>In the top-right menu, select the Azure Cloud Shell icon. Make sure that <strong>Bash</strong> is selected.</li>
<li class="mce-root"><span>First, we need to create a new resource group. Add the following command for this:</span></li>
</ol>
<pre style="color: black;padding-left: 60px"><strong>az group create --name PacktPrivateDNSResourceGroup --location "East US"</strong></pre>
<ol start="4">
<li class="mce-root">Then, we are goin<span>g to create a new VNet:</span></li>
</ol>
<pre style="color: black;padding-left: 60px"><strong>az network vnet create \</strong><br/><strong>  --name PacktPrivateDNSVNet \</strong><br/><strong>  --resource-group PacktPrivateDNSResourceGroup \</strong><br/><strong>  --location eastus \</strong><br/><strong>  --address-prefix 10.2.0.0/16 \</strong><br/><strong>  --subnet-name backendSubnet \</strong><br/><strong>  --subnet-prefixes 10.2.0.0/24</strong></pre>
<ol start="5">
<li class="mce-root">Next, we need to create the private DNS z<span>one:</span></li>
</ol>
<pre style="color: black;padding-left: 60px"><strong>az network dns zone create -g PacktPrivateDNSResourceGroup \</strong><br/><strong>   -n private.packtdns.com \</strong><br/><strong>  --zone-type Private \</strong><br/><strong>  --registration-vnets PacktPrivateDNSVNet</strong></pre>
<ol start="6">
<li class="mce-root">Now, create two virtual machines to test the private DNS zone. You need to provide an admin password when you run this command<span>:</span></li>
</ol>
<pre style="color: black;padding-left: 60px"><strong>az vm create \</strong><br/><strong> -n packtVM01 \</strong><br/><strong> --admin-username test-user \</strong><br/><strong> -g PacktPrivateDNSResourceGroup \</strong><br/><strong> -l eastus \</strong><br/><strong> --subnet backendSubnet \</strong><br/><strong> --vnet-name PacktPrivateDNSVNet \</strong><br/><strong> --image win2016datacenter</strong><br/><br/><strong>az vm create \</strong><br/><strong> -n packtVM02 \</strong><br/><strong> --admin-username test-user \</strong><br/><strong> -g PacktPrivateDNSResourceGroup \</strong><br/><strong> -l eastus \</strong><br/><strong> --subnet backendSubnet \</strong><br/><strong> --vnet-name PacktPrivateDNSVNet \</strong><br/><strong> --image win2016datacenter</strong></pre>
<ol start="7">
<li class="mce-root">We are going to <span>create an additional DNS in the </span><kbd>private.packtdns.com</kbd> <span>DNS zone. </span><span>We are going to create</span><span> a record with the relative name of </span><kbd>db</kbd><span> in the </span><kbd>private.packt.com</kbd><span> DNS zone. The fully qualified name of the record set is </span><kbd>db.private.packtdns.com</kbd><span>. The record type is A, with an IP address of <kbd>10.2.0.4</kbd>: </span></li>
</ol>
<pre style="color: black;padding-left: 60px"><strong>az network dns record-set a add-record \</strong><br/><strong>  -g PacktPrivateDNSResourceGroup \</strong><br/><strong>  -z private.packtdns.com \</strong><br/><strong>  -n db \</strong><br/><strong>  -a 10.2.0.4</strong></pre>
<ol start="8">
<li class="mce-root">We can now test the name res<span>olution for the private zone. We are going to ping both the VMs, and therefore we need to configure the firewall for </span><span>both VMs to allow inbound ICMP packets. Connect to both VMs using RDP, and open a Windows PowerShell window with administrator privileges. Enter the following command:</span></li>
</ol>
<pre style="color: black;padding-left: 60px"><strong>New-NetFirewallRule –DisplayName “Allow ICMPv4-In” –Protocol ICMPv4</strong></pre>
<ol start="9">
<li class="mce-root">After configuring both the VMs, fr<span>om <kbd>PacktVM02</kbd>, enter the following command in PowerShell</span> <span>to ping </span><span><kbd><span>PacktVM01</span></kbd></span><span>:</span></li>
</ol>
<pre style="color: black;padding-left: 60px"><strong>ping PacktVM01.private.packtdns.com</strong></pre>
<p style="padding-left: 60px" class="CDPAlignLeft CDPAlign">You will see an output similar to the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/6dea188d-7c70-4b71-b2f9-8d2adbc3c9d5.png" style="width:34.33em;height:15.17em;"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Private DNS output</div>
<p>In this demonstration, we configured a private DNS zone using the CLI. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we covered how to configure and manage NSGs and Azure DNS. We covered the basics for both NSGs and Azure DNS. You have also learned how to create and configure NSGs. We have also covered how to create public and private zones using Azure DNS, and how to add DNS records to it.</p>
<p>In the next chapter, we will cover the last part of the <em>Deploying and Managing Virtual Networks</em><em> </em>objective, by covering how to implement <strong>Azure Load Balancer</strong>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Questions</h1>
                </header>
            
            <article>
                
<p>Answer the following questions to test your knowledge of the information in this chapter. You can find the answers in the <em>Assessments</em><span> section at the end of this book:</span></p>
<ol>
<li>Can you assign an NSG to a subnet and a NIC?<br/>
<ul>
<li>Yes</li>
<li>No</li>
</ul>
</li>
<li>Can you buy a domain name using Azure DNS and host it on there?<br/>
<ul>
<li>Yes</li>
<li>No</li>
</ul>
</li>
</ol>
<ol start="3">
<li>Private DNS zones cannot be configured from the Azure portal.
<ul>
<li>True</li>
<li>False</li>
</ul>
</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Further reading</h1>
                </header>
            
            <article>
                
<p><span>You can check out the following links for more information about the topics that were covered in this chapter:</span></p>
<ul>
<li><em>Security groups</em>: <a href="https://docs.microsoft.com/en-us/azure/virtual-network/security-overview">https://docs.microsoft.com/en-us/azure/virtual-network/security-overview</a></li>
<li><em>Create, change, or delete an NSG</em>: <a href="https://docs.microsoft.com/en-us/azure/virtual-network/manage-network-security-group">https://docs.microsoft.com/en-us/azure/virtual-network/manage-network-security-group</a></li>
<li><em>What is Azure DNS?</em>: <a href="https://docs.microsoft.com/en-in/azure/dns/dns-overview">https://docs.microsoft.com/en-in/azure/dns/dns-overview</a></li>
<li><em>Overview of DNS zones and records</em>: <a href="https://docs.microsoft.com/en-in/azure/dns/dns-zones-records">https://docs.microsoft.com/en-in/azure/dns/dns-zones-records</a></li>
<li><em>Quickstart: Create an Azure DNS zone and record using the Azure portal</em>: <a href="https://docs.microsoft.com/en-us/azure/dns/dns-getstarted-portal">https://docs.microsoft.com/en-us/azure/dns/dns-getstarted-portal</a></li>
<li><em>Use Azure DNS for private domains</em>: <a href="https://docs.microsoft.com/en-us/azure/dns/private-dns-overview">https://docs.microsoft.com/en-us/azure/dns/private-dns-overview</a></li>
</ul>


            </article>

            
        </section>
    </body></html>