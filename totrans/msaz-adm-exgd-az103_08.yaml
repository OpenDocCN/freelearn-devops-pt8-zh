- en: Configuring Azure Files and Implementing Azure Backup
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In the previous chapter, we covered the different ways of migrating large amounts
    of data to Azure using disks and Azure Data Box. We also covered how to configure
    an Azure **Content Delivery Network** (**CDN**) to cache static and dynamic content
    and deliver it more quickly to your users.
  prefs: []
  type: TYPE_NORMAL
- en: This chapter proceeds with the last part of the *Implementing and Managing Storage*
    objective. In this chapter, we are going to cover how you can create Azure file
    share  and how to troubleshoot them. We are also going to look at the backup and
    restore capabilities in Azure. You will learn about Azure Backup and Azure Site
    Recovery, and we are going to perform a backup and restore operation for our Azure
    file share.
  prefs: []
  type: TYPE_NORMAL
- en: 'The following topics will be covered in this chapter:'
  prefs: []
  type: TYPE_NORMAL
- en: Creating an Azure file share and Azure file share sync service
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure Backup
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure Site Recovery
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Performing a backup and restore operation
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Creating a Recovery Services vault
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Creating and configuring a backup policy
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Technical requirements
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This chapter uses Azure PowerShell ([https://docs.microsoft.com/en-us/powershell/azure/install-az-ps?view=azps-1.8.0](https://docs.microsoft.com/en-us/powershell/azure/install-az-ps?view=azps-1.8.0)) for
    our examples.
  prefs: []
  type: TYPE_NORMAL
- en: The source code for this chapter can be downloaded from [https://github.com/PacktPublishing/Microsoft-Azure-Administrator-Exam-Guide-AZ-103/tree/master/Chapter06](https://github.com/PacktPublishing/Microsoft-Azure-Administrator-Exam-Guide-AZ-103/tree/master/Chapter06)[.](https://github.com/PacktPublishing/Microsoft-Azure-Administrator-Exam-Guide-AZ-103/tree/master/Chapter06)
  prefs: []
  type: TYPE_NORMAL
- en: Azure file share and Azure file share sync service
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Azure Files was briefly covered in [Chapter 4](82d030ea-5235-4278-9517-47cdefaabe22.xhtml),
    *Creating and Configuring Storage Accounts. *In this chapter, we are going to
    create and configure an Azure file share.
  prefs: []
  type: TYPE_NORMAL
- en: With Azure Files, you can create file shares in the cloud. You can access your
    files using the **Server Message Block** (**SMB**) protocol, which is an industry
    standard that can be used on Linux, Windows, and macOS devices. Azure Files can
    also be mounted as if it is a local drive on these same devices, and they can
    be cached for fast access on Windows Server using Azure File Sync.
  prefs: []
  type: TYPE_NORMAL
- en: In the following section, we are going to create an Azure file share from the
    Azure portal.
  prefs: []
  type: TYPE_NORMAL
- en: Creating an Azure file share
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'To create an Azure file share, we first need to create a new storage account
    from the Azure portal. We created a storage account in [Chapter 4](82d030ea-5235-4278-9517-47cdefaabe22.xhtml), *Creating
    and Configuring Storage Accounts.* In this demonstration, we are going to create
    one from the Azure portal as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to the Azure portal by opening [https://portal.azure.com](https://portal.azure.com).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the left menu, click + Create a resource | Storage | Storage Account.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Add the following values:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Subscription**:Select the subscription where you want to create the storage
    account.'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Resource group**: Create a new one, and call it `PacktFileShareResourceGroup`.'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Storage account name**: `packtfileshare`.'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Location**: East US.'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Performance**: Standard.'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Account type**: StorageV2.'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Replication**: Select Read-access geo-redundant Storage (RA-GRS). This will
    make six copies of the data distributed over different Azure regions.'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Access tier**: Hot, because this data is going to be accessed frequently.'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'These values are shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/daa4eb05-94e1-4b49-8f78-45c2540c20be.png)'
  prefs: []
  type: TYPE_IMG
- en: Creating a new storage account
  prefs: []
  type: TYPE_NORMAL
- en: Click **Review + create**. After the review, click the **Create **button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'After creation, open the resource and you will be redirected to the overview
    blade of the storage account. In there, we can create our file share. In the left
    menu, under **File service**, select **Files**. And in the Files blade, click **+
    File share **in the top menu as shown in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/b7cde747-8ec8-4707-be0f-8726500f6c1f.png)'
  prefs: []
  type: TYPE_IMG
- en: Creating a new file share
  prefs: []
  type: TYPE_NORMAL
- en: 'Add the following values as shown in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Name**: `packtfileshare`'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Quota**: `` `10` ``'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](img/e3178fa0-ff49-44df-b3ae-a12788049651.png)'
  prefs: []
  type: TYPE_IMG
- en: Setting the file share properties
  prefs: []
  type: TYPE_NORMAL
- en: Click **Create**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'After creation, in the overview blade, click the context menu button. After
    that, select Connect as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/cf5ff279-5075-428f-99d6-292b43670697.png)'
  prefs: []
  type: TYPE_IMG
- en: Connect to the file share
  prefs: []
  type: TYPE_NORMAL
- en: 'A new blade will be opened with the details to connect to this file share from
    a Windows, Linux, and MacOS machine as shown in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/b8c9288a-2cbb-4a5b-956b-860c53773672.png)'
  prefs: []
  type: TYPE_IMG
- en: Connection information
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s now connect this file share to our local computer using the command
    line prompt. Copy and paste the command highlighted in the preceding screenshot
    in a command line prompt window. When you run that command, the following output
    will be generated:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/b6df1601-dd71-4e40-b7f5-54848fff2cd2.png)'
  prefs: []
  type: TYPE_IMG
- en: Adding the drive to the local filesystem
  prefs: []
  type: TYPE_NORMAL
- en: The drive is now added to your local filesystem.
  prefs: []
  type: TYPE_NORMAL
- en: Now that we have created a file share and added it to our local machine, we
    can proceed with the Azure file share sync service.
  prefs: []
  type: TYPE_NORMAL
- en: Azure file share sync service
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The Azure file share sync service is a service that can synchronize the data
    from on-premises file shares with Azure Files. This way, you can keep the flexibility,
    compatibility, and performance of an on-premises file server, but also store a
    copy of all the data on the file share in Azure. You can use any protocol that's
    available on Windows Server to access your data locally, including **Server Message
    Block** (**SMB**), **Network File System** (**NFS**), and **File Transfer Protocol
    over TLS** (**FTPS**).
  prefs: []
  type: TYPE_NORMAL
- en: 'In the next demonstration, we are going to configure Azure File Sync. For this,
    the following couple of things need to be in place:'
  prefs: []
  type: TYPE_NORMAL
- en: Windows Server. For this, I created a Windows Server 2016 VM in Azure. Make
    sure that you enable **Remote Desktop** (**RDP**) on the server.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Opening the RDP port for a virtual machine during creation is covered in *chapter 7: Creating
    and Configuring VMs for Windows and Linux*, in the "Deploying a Windows VM from
    the Azure portal" section.
  prefs: []
  type: TYPE_NORMAL
- en: A storage account (this storage account needs to be created in one of the supported
    regions for Azure File Sync). You can refer to the following website for the available
    regions: [https://docs.microsoft.com/en-us/azure/storage/files/storage-sync-files-planning#region-availability](https://docs.microsoft.com/en-us/azure/storage/files/storage-sync-files-planning#region-availability).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: An Azure file share created in the same region as the storage account.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Once the preceding resources are created, we can start with the creation of
    the Azure File Sync service in Azure and the installation of Azure File Sync on
    the Windows Server.
  prefs: []
  type: TYPE_NORMAL
- en: 'First, we will create the Azure File Sync service in Azure. Therefore, take
    the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to the Azure portal by opening [https://portal.azure.com](https://portal.azure.com).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the left menu, click **+ Create a resource**, and in the search box, type `Azure File
    Sync`. Create a new service.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Add the following values:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Name:** `PacktFileSync`.'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Subscription:** Pick the same subscription as where the storage account and
    file share are created.'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Resource group:** Pick the same subscription as where the storage account
    and file share are created.'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Location:** Pick the same location as where the storage account and file
    share are created.'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'These values are shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/5d91487d-045d-4268-83a7-5f89545d9a0f.png)'
  prefs: []
  type: TYPE_IMG
- en: Creating a file sync service
  prefs: []
  type: TYPE_NORMAL
- en: Click **Create**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'After deployment, open the Storage Sync Service and click **+ Sync group**
    in the top menu. We are going to create this group to connect the sync service
    to the file share as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/26c448d4-bd8b-49ab-a606-5b5e343d1666.png)'
  prefs: []
  type: TYPE_IMG
- en: Creating a sync group
  prefs: []
  type: TYPE_NORMAL
- en: 'Add the following values:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Name**: `packtsyncgroup`.'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Subscription**: Select the subscription where the storage account and file
    share are created.'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Storage account**: Select the storage account where the file share is created.'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'These values are shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/a7e5e3c2-3ec2-4fdc-81c8-9e63f8f32939.png)'
  prefs: []
  type: TYPE_IMG
- en: Configuring the sync group
  prefs: []
  type: TYPE_NORMAL
- en: RDP to the Windows Server and log in. We first need to disable **IE Enhanced
    Security Configuration**. Open **Server Manager** | **Local Server** and disable
    it for both administrators and users.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Download the Azure File Sync agent from the following website: [https://www.microsoft.com/en-us/download/details.aspx?id=57159](https://www.microsoft.com/en-us/download/details.aspx?id=57159)[.](https://www.microsoft.com/en-us/download/details.aspx?id=57159)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Install the agent on the server. Keep the default path to install the agent.
    In the next screen, enable **Use the existing proxy settings configured on the
    server** as shown in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/589812d7-cbdf-49e0-b67f-e483b88eb7e7.png)'
  prefs: []
  type: TYPE_IMG
- en: Proxy Settings
  prefs: []
  type: TYPE_NORMAL
- en: Click Next.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Enable Windows updates and install the tool.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Once the tool is installed, open the installation folder, which will be `C:\Program
    Files\Azure\StorageSyncAgent`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Run the `ServerRegistration` tool from the installation folder.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Now, we can register the server. First, we need to sign in. Click the Sign
    In button as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/d4d44f7d-8d8f-4c48-afab-7c867ef4c57c.png)'
  prefs: []
  type: TYPE_IMG
- en: Selecting a Azure Environment
  prefs: []
  type: TYPE_NORMAL
- en: Log in using your Azure administrator credentials.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'We can now select the Storage Sync Service that we created in the Azure portal
    earlier. Therefore, you need to select the subscription, resource group, and the
    actual Storage Sync Service as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/1edb35c0-790e-4583-abd6-d03f77c10590.png)'
  prefs: []
  type: TYPE_IMG
- en: Selecting a Storage Sync Service
  prefs: []
  type: TYPE_NORMAL
- en: Click **Register**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: After the registration is successful, there is a trust relationship established
    between the on-premises server and the Storage Sync Service in Azure. Click **OK**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Now, we need to go back to the sync service in the Azure portal to create an
    endpoint. Go to the Storage Sync Service again and select the sync group that
    we created earlier. In the sync group settings blade, select **Add server endpoint**
    in the top menu as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/e4506c7d-56f7-4e7c-a205-5d366a4a7cce.png)'
  prefs: []
  type: TYPE_IMG
- en: Adding a server endpoint
  prefs: []
  type: TYPE_NORMAL
- en: 'Select the registered server and provide the following path: `D:\Data`. Keep
    Cloud Tiering and Offline Data Transfer disabled and click Create as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/221a9110-c142-4476-ab9c-27365f7aadb3.png)'
  prefs: []
  type: TYPE_IMG
- en: Endpoint values
  prefs: []
  type: TYPE_NORMAL
- en: The server endpoint is now created.
  prefs: []
  type: TYPE_NORMAL
- en: 'If you now go back to the VM where we installed the sync agent and open the
    `D` drive, you will see that there is a folder added called `Data`. You can copy
    files to it as shown in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/0bf5bf92-ccc3-4423-8fe8-13b3f1c849a3.png)'
  prefs: []
  type: TYPE_IMG
- en: Images stored in the Data folder
  prefs: []
  type: TYPE_NORMAL
- en: 'When you switch back to the file share in Azure, you will see that all the
    files are synced to the storage account in Azure as shown in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/a6e7a62e-411c-4902-81b8-50d829223139.png)'
  prefs: []
  type: TYPE_IMG
- en: Synced files to Azure file storage
  prefs: []
  type: TYPE_NORMAL
- en: This concludes the section about Azure file storage and the Azure file share
    sync service. In the next section, we are going to look at Azure Backup and recovery.
  prefs: []
  type: TYPE_NORMAL
- en: Azure Backup
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The Azure Backup service is used to back up resources and data in Azure. This
    can be used for cloud only or hybrid scenarios where you want to back up your
    on-premises VMs to Azure. Your on-premises backup solution can also be extended
    to the cloud in conjunction with Azure Backup. Azure Backup is capable of creating
    backups for VMs, files, folders, applications, workloads, system states, and volumes.
  prefs: []
  type: TYPE_NORMAL
- en: 'Azure Backup consists of the following features and capabilities:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Back up on-premises resources to Azure**: Azure Backup offers short and long-term
    backup. This can be a replacement for tape and off-site backup.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Back up Azure VMs**: Azure Backup offers independent and isolated backups.
    These backups are stored in a Recovery Services vault. This vault has built-in
    management for recovery points.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Automatic scaling**: You can get unlimited scale without maintenance overheads.
    Alerts can be set for delivering information about events.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Unlimited data transfer**:There is no limit to the amount of inbound and
    outbound traffic that can be transferred during the backup process. However, if
    you use the Azure import/export service for importing large amounts of data, then
    there is a cost associated with inbound data.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Data encryption**: Data can be encrypted using an encryption passphrase.
    This is stored locally and is then needed to restore the data.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Short and long-term retention**: Recovery Services is where the backups are
    stored and provides short and long-term backups. Azure doesn''t limit the time
    or length that data can be stored in a Recovery Services vault.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Multiple storage options**: Azure Backup offers two types of replication—**Locally
    redundant storage** (**LRS**), where your data is replicated three times by creating
    three copies of the data within the same region, and **G****eo****-redundant storage**
    (**GRS**), which is the default option, where the data is replicated to a secondary region.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'You can use Azure Backup to back up data that is protected by the following
    products:'
  prefs: []
  type: TYPE_NORMAL
- en: '**System Center Data Protection Manager (DPM)**:DPM can run on-premises or
    in Azure on physical servers or virtual servers. The DPM server can be backed
    up to Recovery Services as well. The DPM server and its machines need to be in
    the same network. On-premises machines can only be protected by an on-premises
    DPM server, while Azure machines can only be protected by a DPM server that is
    running in Azure.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Microsoft Azure Backup Server (MABS)**: MABS can run on-premises or in Azure
    on physical servers or virtual servers. It offers similar capabilities to DPM,
    except that MABS can be backed up to tape and you don''t need to have a system
    center license for it. Just like DPM, on-premises machines can only be protected
    by an on-premises MABS server, while Azure machines can only be protected by an
    MABS server that is running in Azure.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure Site Recovery
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Azure Site Recovery can be replicated from Azure VMs and other workloads, such
    as Azure file storage between different Azure regions, as well as on-premises VMs,
    physical (file) servers, and Azure Stack VMs.
  prefs: []
  type: TYPE_NORMAL
- en: 'Azure Recovery Services offers the following features:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Site Recovery service**: Site Recovery makes sure that your VMs, apps, and
    workloads are still running during outages. It replicates the workloads running
    on the machines, both virtual and physical, from a primary to a secondary location.
    You can fail over to a secondary location when an outage occurs at the primary
    site. When the primary location is up again, you can fail back to it.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Backup service**: This service keeps your data safe by backing it up to Azure.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'You can also use Azure Site Recovery for migration from on-premises machines
    to Azure VMs. This differs from disaster recovery in the following ways:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Disaster recovery**: With disaster recovery, machines are replicated regularly.
    In the case of an outage, the machines are failed over from the primary to the
    secondary site in Azure. The machines can then be accessed from the secondary
    site. When the primary site is available again, you fail back from the secondary
    site to the primary again.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Migration**: On-premises machines are replicated to Azure, or Azure VMs to
    a secondary region. After that, the VM is failed over from the primary site to
    the secondary site, which completes the migration process without a failback process.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In the next section, we are going to perform a backup and restore operation
    for an Azure file share.
  prefs: []
  type: TYPE_NORMAL
- en: Performing a backup and restore operation
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this demonstration, we will be performing a backup and restore operation
    for an Azure file share. We are going to back up the file share that we created
    in this chapter and restore it from a Recovery Services vault.
  prefs: []
  type: TYPE_NORMAL
- en: In [Chapter 8](a3544485-da13-4b33-932f-68a4709ba43e.xhtml), *Managing Azure
    VMs and VM Backups*, we are going to set up backup and restore for a virtual machine
    in Azure from the Azure portal. You can refer to this chapter for more information
    about backup and restore.
  prefs: []
  type: TYPE_NORMAL
- en: Creating a Recovery Services vault
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'We are going to create the Recovery Services vault in Azure. You can create
    this using the Azure portal, PowerShell, and CLI. We are going the create the
    vault using PowerShell. To create this, perform the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: 'First, we need to log in to the Azure account as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'If necessary, select the right subscription as follows (make sure that you
    use the same subscription here as that you''ve used to create the file share in):'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'Create a resource group for the Recovery Services Vault as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'Create a new Recovery Services vault as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'You can now set the type of redundancy to use for the vault storage as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: We have now created the Recovery Services vault. In the next part, we are going
    to create a backup policy for the Azure file share.
  prefs: []
  type: TYPE_NORMAL
- en: Configuring a backup policy
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: A backup policy specifies the schedule for backups, and how long backup recovery
    points should be kept. It is associated with at least one retention policy, which defines
    how long a recovery point will be kept before it is deleted.
  prefs: []
  type: TYPE_NORMAL
- en: 'In the following example, we are going to create a backup policy in PowerShell,
    which will take a daily backup and will retain for 30 days:'
  prefs: []
  type: TYPE_NORMAL
- en: 'First, we need to store the vault ID in a variable to pass it on creating the
    policy later as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: 'Next, we are going to set two variables for storing the schedule and retention
    policies. Then we will create a new backup policy using these values:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: 'And lastly, we can enable this policy for the Azure files storage account as
    follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: We have now created a backup policy to back up our file share that we created
    at the beginning of this chapter. This backup policy will create a daily backup.
    You can also trigger an on-demand backup. For this, leave PowerShell open, because
    we need the Vault ID in to trigger an on-demand job. We will cover this in the
    next section.
  prefs: []
  type: TYPE_NORMAL
- en: Trigger an on-demand backup
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this demonstration, we are going to trigger an on-demand backup using PowerShell.
    With your PowerShell session still open,  take the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: 'First, we need to retrieve the backup container:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: 'Then we need to retrieve the backup item from the container:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: 'At last, we can schedule the job:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: Now that we have created a backup, we can restore it using PowerShell. We will
    do this in the next section.
  prefs: []
  type: TYPE_NORMAL
- en: Restore the backup
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'To restore the backup that we created in the previous demonstration from PowerShell,
    we have to take the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Generate a list of available recovery points:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: 'Restore the backup. In this example we are going to restore the backup in the
    original destination. You can also use an alternative destination, like another
    storage account for instance. We first need to set the vault context again before
    we can restore the backup:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we covered the third and last part of the *Implementing and
    Managing Storage*objective. We covered the Azure file shares and we covered how
    to install and configure the Azure file share sync service. We also looked at
    backup and restore of our files shared in Azure.
  prefs: []
  type: TYPE_NORMAL
- en: In the next chapter, we will introduce the *Deploying and Managing Virtual Machines* objective
    by covering how to create and configure VMs for Windows and Linux.
  prefs: []
  type: TYPE_NORMAL
- en: Questions
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Answer the following questions to test your knowledge of the information in
    this chapter. You can find the answers in the *Assessments* section at the end
    of this book:'
  prefs: []
  type: TYPE_NORMAL
- en: Can you use Azure Backup to back up Azure file shares?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Yes'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'No'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Can you use Azure Backup in conjunction with MABS?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Yes'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'No'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Can you use the Azure file share sync service to mount an Azure file share to
    your local computer?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Yes'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'No'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Further reading
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'You can check out the following links for more information about the topics
    that were covered in this chapter:'
  prefs: []
  type: TYPE_NORMAL
- en: '*What is Azure Files?*: [https://docs.microsoft.com/en-us/azure/storage/files/storage-files-introduction](https://docs.microsoft.com/en-us/azure/storage/files/storage-files-introduction)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Planning for an Azure File Sync deployment*: [https://docs.microsoft.com/en-us/azure/storage/files/storage-sync-files-planning](https://docs.microsoft.com/en-us/azure/storage/files/storage-sync-files-planning)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Deploy Azure File Sync*: [https://docs.microsoft.com/en-us/azure/storage/files/storage-sync-files-deployment-guide?tabs=azure-portal](https://docs.microsoft.com/en-us/azure/storage/files/storage-sync-files-deployment-guide?tabs=azure-portal)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*What is Azure Backup?*: [https://docs.microsoft.com/en-us/azure/backup/backup-overview](https://docs.microsoft.com/en-us/azure/backup/backup-overview)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Overview of the features in Azure Backup*: [https://docs.microsoft.com/en-us/azure/backup/backup-introduction-to-azure-backup#which-azure-backup-components-should-i-use](https://docs.microsoft.com/en-us/azure/backup/backup-introduction-to-azure-backup#which-azure-backup-components-should-i-use)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*About Site Recovery*: [https://docs.microsoft.com/en-us/azure/site-recovery/site-recovery-overview](https://docs.microsoft.com/en-us/azure/site-recovery/site-recovery-overview)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
