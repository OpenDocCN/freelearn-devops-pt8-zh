<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Monitoring and Troubleshooting Virtual Networking</h1>
                </header>
            
            <article>
                
<p><span>In the previous chapter, we</span> <span>covered</span> <span>th</span><span>e</span> <span>second part of the</span> <em><span>Deploying and Managing Virtual Networks</span></em><span> </span><span>objective</span><span>. We've covered how to integrate your on-premises network with an Azure virtual network.</span></p>
<p>This chapter covers the third part of the <em>Deploying and Managing Virtual Networks</em> objective by covering how to monitor and troubleshoot virtual networking<span>. In this chapter, we are going to focus on how you can monitor your virtual networks using <strong>Network Watcher</strong>. You will learn how to manage your virtual network connectivity and how you can monitor and troubleshoot on-premises connectivity as well use Network Watcher. We will end this chapter by covering how to manage external networking.</span></p>
<p class="mce-root">We will look at the following topics in this chapter:</p>
<ul>
<li>Network Watcher</li>
<li>Network resource monitoring</li>
<li>Managing virtual network connectivity</li>
<li>Monitoring and troubleshooting on-premises<span> </span>connectivity</li>
<li>Managing external networking</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Network Watcher</h1>
                </header>
            
            <article>
                
<p>Azure Network Watcher is a network monitoring solution that provides tools to diagnose, monitor, and view metrics and logging for resources in an Azure Virtual Network. This includes application gateway traffic, Load Balancers,<span> </span>ExpressRoute<span> </span>circuits, and more.</p>
<p class="mce-root"/>
<p><span>Azure Network Watcher</span> offers the following capabilities:</p>
<ul>
<li><strong>Monitoring</strong>: Connection monitor is a<span> cloud-based hybrid network monitoring</span><span> </span><span>solution that </span>can monitor the communication between virtual machines and endpoints. An endpoint can be another <strong>Virtual Machine</strong> (<strong>VM</strong>), a URL, an IPv4 address, or a<span> </span><strong>Fully<span> </span><span>Qualified Domain Name</span></strong><span> </span><span>(<strong>FQDN</strong>)</span><span>. The network communication is monitored at regular intervals and information about latency, network topology changes, and the reachability between a VM and the endpoint is collected. If an endpoint becomes unreachable, Network Watcher will inform the user about the error. The reason for this can be a problem with the memory or CPU of a VM, a security rule for the VM, or the hop type of a custom route. Latency problems are also monitored. The connection monitor will provide the average, minimum, and maximum latency observed over time. The monitoring solution is capable of monitoring network performance between various points in the network infrastructure and it can generate alerts and notifications.</span></li>
<li><strong>Diagnostics</strong>: You can diagnose network traffic filtering for VMs. The VM can, for instance, become unable to communicate with other resources because of a security rule.</li>
</ul>
<p>An IP flow can verify and test the communication and informs you as to whether the connection has succeeded or failed. An IP flow can tell you which security rule allowed or denied the connection and communication. Network Watcher can also diagnose network routing problems from a VM. When a virtual network is created, there are several default outbound routes created for that VNet as well. Outbound traffic from all resources that are deployed in a virtual network are routed based on Azure's default routes.</p>
<p>In cases where you want to override the default routing rules, or create additional rules,<span> </span><strong>next hop</strong><span> </span>can be used to test the communication between the different routes. When the communication fails, you can then change, add, or remove a route to resolve the problem.</p>
<p>Using Azure Network Watcher, <span>yo</span>u c<span>an diagnose outbound connection from a VM. You can also diagnose problems with an Azure Virtual Network gateway and connections, capture packets to and from a VM, view security rules for a network interface, and determine relative latencies between Azure regions and internet service providers:<br/></span></p>
<ul>
<li><strong>Metrics</strong>:<strong><span> </span></strong><span><span>The network subscription limit feature can provide a summary of how many network resources there are deployed in a subscription or region. If the limitations of the maximum amount of network resources are met, a summary is provided.</span></span></li>
<li><strong>Logs</strong>: <strong><span>N</span></strong><span><strong>etwork Security Groups</strong> (<strong>NSGs</strong>) are responsible for allowing or denying the inbound and outbound traffic to a network interface in the virtual machine. </span><span>The</span> NSG flow log feature can log the port, protocol, whether traffic is allowed or denied, and can log the source and IP address. These logs can be analyzed using several tools, such as the traffic analytics feature and Power BI. Traffic analytics can provide rich visualization of the data that is written to the NSG flow logs.</li>
<li><strong>Automatic enablement</strong>: Network Watcher will be automatically enabled when a new virtual network is created or updated. There is no extra charge for enabling Network Watcher inside a subscription. </li>
</ul>
<p>In the following sections, we are going to see Network Watcher in action. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Network resource monitoring</h1>
                </header>
            
            <article>
                
<p>In this demonstration, we are going to monitor the network on VMs. For this demonstration, create three Windows Server 2016 datacenter VMs inside one virtual network. We can use these VMs for monitoring.<span> </span></p>
<p>Before we are able to monitor the network using network resource monitoring, we need to install the <span>Network Watcher agent on the three VMs. After that, we are going to inspect the network traffic.</span></p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing the Network Watcher agent</h1>
                </header>
            
            <article>
                
<p>To install the Network Watcher agent on a VM in Azure, take the following steps:</p>
<ol>
<li>Navigate to the Azure portal by opening <a href="https://portal.azure.com/">https://portal.azure.com/</a>.<a href="https://portal.azure.com/"/></li>
<li>Open the VM settings, and under <strong>Settings</strong>,<span> </span><span>select </span><strong>Extensions</strong>,<span> </span><span>and then click the</span><span> </span><strong>Add </strong><span>button:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/58cea88a-047f-4a8f-9a63-84e2ee099e7d.png"/></p>
<div class="mce-root packt_figref CDPAlignCenter CDPAlign"><span>Adding a VM extension</span></div>
<ol start="3">
<li>Add the <strong>Network Watcher Agent for Windows </strong>extension to the VM (extensions can be installed on the VM during creation as well), and click<span> </span><strong>Create</strong>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/a6e6c7fd-705c-4457-bcd9-6c473275ccd9.png"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Adding the Network Watcher Agent for Windows extension</div>
<ol start="4">
<li>Repeat these steps for the other two VMs as well, and install the agent on it.</li>
</ol>
<p>Now that the<span> </span><strong><span>Network Watcher Agent</span><span> </span><span>for</span></strong><span> </span><span><strong>Windows</strong> </span>is installed on all the VMs, we can enable it for a specific region.  </p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Enabling Network Watcher</h1>
                </header>
            
            <article>
                
<p>To enable Network Watcher in a specific region, take the following steps:</p>
<ol>
<li>Navigate to the Azure portal by opening <a href="https://portal.azure.com/">https://portal.azure.com/</a>.<a href="https://portal.azure.com/"/></li>
<li class="mce-root">Select <strong>All services</strong>, and in the top menu, type<span> </span><kbd>network watcher</kbd>:<strong><br/></strong></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/22b497c0-2d94-4133-ad8c-c14a0409d56b.png"/></p>
<div class="mce-root CDPAlignCenter CDPAlign packt_figref"><span>Opening Network Watcher</span></div>
<ol start="3">
<li>In the<span> </span><strong>Network Watcher</strong><span> </span>overview page, select the subscription and the region where the VMs are created. In my case, this is<span> </span><strong>East US</strong>. Then click the three dots and enable Network Watcher for that region, as follows:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/69133476-2cbc-46c7-bba3-0bed6c717e52.png"/></p>
<div class="CDPAlignCenter CDPAlign packt_figref"><span>Enabling Network Watcher</span></div>
<p>Now that Network Watcher is enabled, we can actually start monitoring the network resources<span>.</span> </p>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Monitoring the network connectivity</h1>
                </header>
            
            <article>
                
<p><span>Network monitoring can be used for monitoring connection reachability, latency, and network topology changes. To do this you need to set up a connection monitor instance. Take the following steps to set this up:</span></p>
<ol>
<li class="mce-root">With the Network Watcher resource still open, under <strong>Monitoring</strong>, select <strong>Connection monitor</strong>:<strong><br/></strong></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/f0a9c865-e6c0-4dc4-a754-9d56f194ed21.png"/></p>
<div class="mce-root CDPAlignCenter CDPAlign packt_figref"><span>Connection monitor</span><strong><br/></strong></div>
<ol start="2">
<li>We are going to use the monitor resource for testing the connectivity between <kbd>VM1</kbd> and <kbd>VM2</kbd>. Therefore, add the following values:
<ul>
<li><strong>Name</strong>: <kbd>VM1-VM2-Test</kbd>.</li>
<li><strong>Subscription</strong>: Select the subscription where the VMs are deployed.</li>
<li><strong>Source virtual machine</strong>:<span> </span><kbd>VM1</kbd>.</li>
<li><strong>Destination </strong><span><span><strong>virtual machine</strong>: <kbd>VM2</kbd>.</span></span></li>
<li><strong>Port:</strong><span> </span><kbd>22</kbd>:</li>
</ul>
</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/7f93bb5d-cdf8-43a5-9514-0c0f0f9d5e70.png" style="width:26.92em;height:33.25em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Connection monitor settings</div>
<ol start="3">
<li>Click <strong>Add</strong>.</li>
</ol>
<p><span>We are now able to monitor the network connectivity. In the next section, we are going to look at how to manage the connectivity.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Managing virtual network connectivity</h1>
                </header>
            
            <article>
                
<p>You can manage your virtual network connectivity from the Azure portal. In the upcoming section, we are going to look at the possibilities that the Azure portal has to offer to manage the virtual network connectivity. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Network topology</h1>
                </header>
            
            <article>
                
<p>The network topology section in the Azure portal displays an overview of the virtual networks inside an Azure subscription and a resource group. To go to the network topology section, you have to take the following steps:</p>
<ol>
<li>Navigate to the Azure portal by opening <a href="https://portal.azure.com/">https://portal.azure.com/</a>.<a href="https://portal.azure.com/"/></li>
<li><span>Select </span><strong>All</strong><span> </span><strong>services</strong><span>, and, in the top menu, type </span><kbd>network watcher</kbd><span> </span>again.</li>
<li class="mce-root">Under<span> </span><strong>Monitoring</strong>, select<span> </span><strong>Topology</strong>. In there, you need to select the subscription, resource group, and, if relevant, the virtual network, as shown in the following screenshot:<strong><br/></strong></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/42812342-75cb-492c-8291-4fc36cae5afb.png"/></p>
<div class="mce-root CDPAlignCenter CDPAlign packt_figref"><span>Network topology</span><strong><br/></strong></div>
<ol start="4">
<li>You can now drill down into all the components of the network, such as the VNet, NIC, VMs, IP address, and more, by clicking on the items in the topology. This will take you to the settings of the different resources.</li>
</ol>
<ol start="5">
<li>You can download the topology as well, by clicking the<span> </span><strong>Download topology </strong>button in the top menu, as follows:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/ab8ac0ee-9308-4af0-9b3c-f879bffabea8.png"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Downloading the network topology</div>
<p>Besides monitoring the networks in Azure, you can also monitor the on-premises connectivity. We are going to look at this in the next section.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Monitoring and troubleshooting on-premises connectivity</h1>
                </header>
            
            <article>
                
<p>You can monitor your on-premises connectivity using Network Watcher as well. It offers two different features for this, <strong>Network Performance Monitor</strong> and <strong>VPN Troubleshoot</strong>, which, just like the other features, are accessible from the Azure portal.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Network Performance Monitor</h1>
                </header>
            
            <article>
                
<p><strong>Network Performance Monitor</strong> is a hybrid network monitoring solution. It can monitor network connectivity for on-premises and cloud networks, and between various points in your network infrastructure. It can detect issues such as routing errors and <strong>blackholing</strong>. The monitoring solution is stored inside Azure Log Analytics.</p>
<p>Network Performance Monitor can create alerts and notifications when network performance errors appear and it can localize the source of the problem to a specific network device or segment.</p>
<p>It offers the following capabilities:</p>
<ul>
<li><strong>Performance monitor</strong>: A performance monitor can monitor the network connectivity across cloud deployments and on-premises locations. It can also monitor connectivity between multiple data centers, branch offices, multi-tier applications, and microservices.</li>
<li><strong>Service connectivity monitor</strong>: You can identify the network bottlenecks inside the network infrastructure and detect the exact locations of the issues in the network. You can also monitor connectivity between users and services. </li>
<li><strong>ExpressRoute monitor</strong>: You can monitor the ExpressRoute connection between the on-premises locations and Azure.</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Next hop</h1>
                </header>
            
            <article>
                
<p>You can use the <strong>next hop</strong> feature to specify a source and destination IPv4 address. The communication between these addresses is then tested, and you will get informed about what type of next hop is used to route the traffic.<span> </span>When you experience a routing error or problem, you can add, change, or remove a route to resolve this.</p>
<p>To see this in action, you need to take the following steps:</p>
<ol>
<li>Navigate to the Azure portal by opening <a href="https://portal.azure.com/">https://portal.azure.com/</a>.<a href="https://portal.azure.com/"/></li>
<li><span>Select </span><strong>All</strong><span> </span><strong>services</strong><span>, and in the top menu, type </span><kbd>network watcher</kbd>. </li>
<li>Under <span><strong>Network diagnostic tools</strong></span>,<span> </span><span>select <strong>Next hop</strong></span>.</li>
<li>In the<span> s</span>ettings<span> </span>blade, add the following values:
<ul>
<li><strong>Resource group</strong>: <kbd>PacktNetworkWatcher</kbd>.</li>
<li><strong>Virtual machine</strong>: <kbd>VM2</kbd>.</li>
<li><strong>Network interface</strong>: This is selected automatically.</li>
<li><strong>Source IP address</strong>: <span>This is selected automatically as well.</span></li>
<li><span><strong>Destination IP address</strong>: <kbd>13.107.21.200</kbd> (the Bing server again).</span></li>
</ul>
</li>
<li>Select <strong>Next hop</strong>.</li>
</ol>
<ol start="6">
<li>You will see the following result. In this case, there is no next hop, because the connection is going straight to the internet:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/2b5dad95-1998-430a-aa5d-ed1aa419e240.png"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Next hop to internet</div>
<ol start="7">
<li>If you change the <span>destination IP address to one of the IP addresses of the other VMs, which in my case is <kbd>172.18.0.6</kbd>, you will see the following result:<br/></span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/b3421443-cf74-46ac-97f3-7912401fc898.png"/></p>
<div class="CDPAlignCenter CDPAlign packt_figref"><span>Next hop to another VM<br/></span></div>
<p>In the next section, we are going to look at how to troubleshoot a VPN connection.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">VPN troubleshoot</h1>
                </header>
            
            <article>
                
<p>For the VPN troubleshoot demonstration, we are going to use the VPN connection that we created in the previous chapter.</p>
<p>You can diagnose the VPN connection by taking the following steps:</p>
<ol>
<li>From the<span> </span><strong>Network Watcher</strong><span> </span>blade, select <strong><span>VPN troubleshoot</span></strong>.</li>
<li>In the <strong>Network Watcher -</strong><span> </span><strong>VPN troubleshoot</strong><span> </span>blade, you can diagnose the gateway by selecting the subscription, resource group, location, and the following checkbox. You also need to select or create a storage account for storing the <span>diagnostic information.</span> After selecting the checkbox, you can start the troubleshooting process by clicking<span> </span><strong>Start troubleshooting </strong>in the top menu, as shown in the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/95450815-68a0-465d-9b6d-2a55803bbd98.png"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">VPN troubleshooting</div>
<ol start="3">
<li>This will start the troubleshooting process, and, in my case, the VPN connections seem unhealthy. You can click on the <strong>Action </strong>tab to see the recommendations:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/80580be2-df9f-44f3-bbed-67759e19c8d0.png"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Unhealthy VPN connection</div>
<p>You can manage external networking using Azure Network Watcher as well. We will cover this in the upcoming section.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Managing external networking</h1>
                </header>
            
            <article>
                
<p>Azure Network Watcher offers three features to monitor and troubleshoot external networking. Their features are <strong>IP flow verify</strong>, <span><strong>Effective security rules</strong></span>, and <strong>Connection troubleshoot</strong>, which are going to be covered in the next sections.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">IP flow verify</h1>
                </header>
            
            <article>
                
<p>With <strong>IP flow verify</strong>, you can detect whether a package is allowed or denied to or from a network interface of a virtual machine. Included in the information are the protocol, the local and remote IP addresses, the direction, and the local and remote ports. When a packet is denied, the name of the routing rule that denies the packet is returned. You can use this to diagnose connectivity issues from or in the on-premises environment and to and from the internet. You can basically choose any source or IP address to verify the connectivity.</p>
<p>To run IP flow verify, you need to enable an instance of Network Watcher in the region where you plan to run the tool. This is similar to the demonstration covered in the <em>Enabling Network Watcher</em> <span>section that appeared</span><span> </span>earlier in this chapter, where we enabled Network Watcher for a particular region.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using IP flow verify</h1>
                </header>
            
            <article>
                
<p>In this demonstration, we are going to use IP flow verify to test the connection between two of the VMs that we created in the first demonstration. To use <span>IP flow verify, take the following steps:</span></p>
<ol>
<li>Inside the Network Watcher resource blade, under <span><strong>Network diagnostic tools</strong>, select <strong>IP flow verify</strong></span>.</li>
<li>In the settings page, add the following settings:
<ul>
<li><strong>Resource group</strong>:<strong> </strong><kbd>PacktNetworkWatcher</kbd>.</li>
<li><strong>Virtual machine</strong>:<span> </span><kbd>VM1</kbd>.</li>
<li><strong>Network interface</strong>: This will be filled in automatically after selecting the VM.</li>
<li><strong>Protocol</strong>:<span> </span><span class="packt_screen">TCP</span>.</li>
<li><strong>Direction</strong>:<span> </span><span class="packt_screen">Outbound</span>.</li>
<li><span><strong>Local IP address</strong>: This is filled in automatically as well.</span></li>
<li><span><strong>Local port</strong>: <kbd>60000</kbd>.</span></li>
<li><span><strong>Remote IP address</strong>: <kbd>13.107.21.200</kbd> (address of Bing).</span></li>
<li><span><strong>Remote port</strong>: <kbd>80</kbd>.</span></li>
</ul>
</li>
</ol>
<ol start="3">
<li>Click the <strong>Check</strong><span> </span>button:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/e7dbadcb-4096-4784-ac82-627fd86da20d.png"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">IP flow verify</div>
<ol start="4">
<li>The request is executed and the result it will return will be that access is allowed, because of the <span><span><kbd>AllowInternetOutBound</kbd> security rule, as shown in the following screenshot:</span></span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/edd61df8-5850-4d01-8156-2f304757dcbf.png" style="width:41.08em;height:40.50em;"/></p>
<div class="CDPAlignCenter CDPAlign packt_figref"><span>IP flow verify access allowed<br/></span></div>
<ol start="5">
<li>Repeat the previous steps, but change the <strong>Remote IP address</strong><span> </span>to <kbd>172.31.0.100</kbd>. This will result in access being denied because of the <kbd>DefaultOutboundDenyAll</kbd><span> </span>security rule:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/4f30ce8f-4567-4516-bb04-6d82a616e909.png" style="width:10.17em;height:5.08em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign"><span>IP flow verify access denied<br/></span></div>
<ol start="6">
<li>Lastly, repeat the step again, and this time make the following changes:
<ul>
<li><strong>Direction</strong>: <span class="packt_screen">Inbound</span></li>
<li><strong>Local port</strong>:<strong> </strong><kbd>80</kbd></li>
<li><strong>Remote port</strong>:<strong> </strong><kbd>60000</kbd></li>
</ul>
</li>
<li>This will result in the following:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/2188a8e7-f0e8-4652-98fd-6e8b8d2a0e6f.png" style="width:42.42em;height:41.42em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Access denied</div>
<p>We've looked at how to <span>use IP flow verify to test the connection between two of the VMs. In the next part, we are going to look at effective security rules.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Effective security rules</h1>
                </header>
            
            <article>
                
<p>The <strong>Effective security rules</strong> feature displays all the security rules that are applied to the network interface and the subnet where the network interface is. It then aggregates both. This will give you a complete overview of all the rules that are applied to a network interface, and it will give you the ability to change, add, or remove rules.</p>
<p>You need to select the right subscription, the resource group, and the VM to get the overview of the applied security rules, as shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign packt_figref"><img src="assets/62fbfa4b-ef0f-467b-b38e-2b9a1099ea2a.png"/><br/>
<br/>
Effective security rules</div>
<p>We've now seen an overview of the security rules that are applied to the network interface. In the next section, we are going to cover connection troubleshoot.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Connection troubleshoot</h1>
                </header>
            
            <article>
                
<p><span>Azure Network Watcher Connection troubleshoot </span>enables you to troubleshoot network performance and connectivity issues in Azure. It provides <span>visualization of the hop-by-hop path from source to destination, identifying issues that can potentially impact your network performance and connectivity. </span></p>
<p><span>Azure Network Watcher connection troubleshoot provides the following features and insights:</span></p>
<ul>
<li>A<span> </span><span>graphical </span>topology view from your source to destination.</li>
<li>It checks the connectivity between the source (VM) and the destination (VM, URI, FQDN, IP) address.</li>
<li>It offers hop-by-hop latency.</li>
<li>It can identify configuration issues that are impacting reachability.</li>
<li>It provides all possible hop-by-hop paths from the source to the destination.</li>
<li>It checks latency, such as minimum, maximum, and average latency, between the source and destination.</li>
<li>The number of packets dropped during the connection troubleshoot check.</li>
</ul>
<div class="packt_infobox">Connection troubleshoot requires that the source VM has the <strong>AzureNetworkWatcherExtension</strong> VM extension installed. For installing the extension on a Windows VM, you can refer to <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/network-watcher-windows?toc=%2Fazure%2Fnetwork-watcher%2Ftoc.json">https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/network-watcher-windows?toc=%2Fazure%2Fnetwork-watcher%2Ftoc.json</a>, and for a Linux VM, you can refer to <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/network-watcher-linux?toc=%2Fazure%2Fnetwork-watcher%2Ftoc.json">https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/network-watcher-linux?toc=%2Fazure%2Fnetwork-watcher%2Ftoc.json</a>.</div>
<p>To check network connectivity using <strong>Connection troubleshoot</strong>, you have to take the following steps:</p>
<ol>
<li>From the Network Watcher overview blade in the Azure portal, under <span class="packt_screen">Network diagnostic tools</span>, select <strong>Connection troubleshoot</strong>.</li>
<li>Select a virtual machine and provide an outbound connection, such as the following:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/f1a21e0b-0fa6-4c2d-8942-87b79b1b5035.png"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Selecting source and destination</div>
<ol start="3">
<li>Click <strong>Check</strong>.</li>
<li>The agent will automatically be installed on the source machine when you click the check button.</li>
</ol>
<ol start="5">
<li>After checking, the results will be displayed:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/1ce986ca-37b3-4384-91ae-3ab5f787cb52.png"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Unreachable endpoint</div>
<p>We have now checked an outbound connection from a VM using <strong>Connection troubleshoot</strong>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p><span>In this chapter, we covered the third part of the <em>Deploying and Managing Virtual Networks</em><em> </em>objective, by covering how to monitor and troubleshoot your network traffic in Azure Network Watcher. We also covered how to monitor and troubleshoot on-premises and external network connectivity using Network Watcher.</span></p>
<p>In the next chapter, we are going to continue with the fourth part of this objective<span>, by </span>covering how to create and configure Azure security groups and Azure DNS.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Questions</h1>
                </header>
            
            <article>
                
<p><span>Answer the following questions to test your knowledge of the information in this chapter. You can find the answers in the <em>Assessments</em> section at the end of this book:</span></p>
<ol>
<li>Azure Network Watcher is only for monitoring and diagnosing network connectivity <span>in Azure:</span>
<ul>
<li>True</li>
<li>False</li>
</ul>
</li>
</ol>
<ol start="2">
<li>Can you use IP flow veri<span>fy to verify outbound connections from a VNet in Azure?</span>
<ul>
<li>Yes</li>
<li>No</li>
</ul>
</li>
<li><span>Can you use IP flow verify </span>to verify connections between two different VMs inside a VNet?<br/>
<ul>
<li>Yes</li>
<li>No</li>
</ul>
</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Further reading</h1>
                </header>
            
            <article>
                
<p><span>You can check the following links for more information about the topics that are covered in this chapter:</span></p>
<ul>
<li><em>What is Azure Network Watcher?</em>: <a href="https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-monitoring-overview">https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-monitoring-overview</a></li>
<li><em>Quickstart: Diagnose a virtual machine network traffic filter problem using the Azure portal</em>: <a href="https://docs.microsoft.com/en-us/azure/network-watcher/diagnose-vm-network-traffic-filtering-problem">https://docs.microsoft.com/en-us/azure/network-watcher/diagnose-vm-network-traffic-filtering-problem</a></li>
<li><em>Network Performance Monitor solution in Azure</em>: <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/insights/network-performance-monitor?toc=%2Fazure%2Fnetwork-watcher%2Ftoc.json">https://docs.microsoft.com/en-us/azure/azure-monitor/insights/network-performance-monitor?toc=%2Fazure%2Fnetwork-watcher%2Ftoc.json</a></li>
<li><em>Introduction to IP flow verify in Azure Network Watcher</em>: <a href="https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-ip-flow-verify-overview">https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-ip-flow-verify-overview</a></li>
<li><em>Tutorial: Diagnose a communication problem between networks using the Azure portal</em>: <a href="https://docs.microsoft.com/en-us/azure/network-watcher/diagnose-communication-problem-between-networks">https://docs.microsoft.com/en-us/azure/network-watcher/diagnose-communication-problem-between-networks</a></li>
</ul>


            </article>

            
        </section>
    </body></html>