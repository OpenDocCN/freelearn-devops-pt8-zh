<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Getting Started with Amazon ECS and Amazon Fargate</h1>
                </header>
            
            <article>
                
<p class="mce-root">Docker can be installed on the most commonly used OS platforms. CoreOS has Docker pre-installed, and is designed specifically for running Docker containers. Docker for AWS provides an out-of-the-box Docker swarm mode in which a cluster of nodes, called a swarm, provides a distributed platform for running Docker container applications.</p>
<p class="mce-root"><strong>Problem:</strong> All the aforementioned Docker platforms are only different types of Docker installations, and require Docker containers to run and be managed on the command line.</p>
<p class="mce-root"><strong>Solution:</strong> Amazon <strong>ECS</strong> (<strong>Elastic Container Service</strong>) is a managed service for Docker containers with built-in support for scaling, load balancing, networking, storage, logging, and other Docker container management tasks. Amazon ECS supports two launch types: EC2 and Fargate.</p>
<p>With the EC2 launch type, EC2 instances <span><span>are started to run</span></span> Docker containers. The Fargate launch type, which was introduced recently (November 2017), hosts tasks that encapsulate Docker containers. The tasks are directly made accessible to the user via an <strong>Elastic Network Interface</strong> (<strong>ENI</strong>). The EC2 instances on which Fargate is provisioned are not exposed to the user and are not directly accessible. </p>
<p>In this chapter, we will learn about the following:</p>
<ul>
<li>What Amazon Fargate is</li>
<li>Benefits of Fargate</li>
<li>Amazon ECS objects</li>
<li>Compute resources in Amazon ECS Fargate</li>
<li>What's new in the Amazon Fargate launch type mode?</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">What Amazon Fargate is</h1>
                </header>
            
            <article>
                
<p><strong>Amazon Fargate</strong> is a new launch type for Amazon ECS and Amazon <strong>EKS</strong> (<strong>Elastic Kubernetes Service</strong>)-managed orchestration services for Docker containers on AWS. With the Fargate launch type, the infrastructure is fully provisioned by Fargate. It is serverless, and no EC2 instances are exposed to the user. Docker containers are defined as container definitions within a task definition. A service implements the task definition to run one or more tasks. Each task is associated with an ENI. If the auto-assignment of the public IP at the task level is enabled, a public IP on which an external client may access a task <span><span>is</span></span> automatically assigned to a task. Tasks communicate with each other over a private IP.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Benefits of Fargate</h1>
                </header>
            
            <article>
                
<p>The benefits in ECS are as follows:</p>
<ul>
<li>A managed service for containerized applications that does not require much user input to run Docker applications</li>
<li> Microservices consisting of multiple applications run in isolated containers</li>
<li> Auto scales tasks based on application load</li>
<li> Integrates with other AWS services including IAM, CloudWatch Logs, Elastic Load Balancing, CloudFormation templates, EBS Volumes, Batch, ECR, and CloudTrail logs</li>
<li> A <strong>virtual private cloud</strong> (<strong>VPC</strong>) with no resources shared with other users</li>
<li> Provides support for running a CodePipeline with ECS as the deployment platform</li>
<li>Supports the latest Docker version 17.0</li>
</ul>
<p>Fargate provides the following additional benefits:</p>
<ul>
<li>With a Fargate launch type, a user does not create or manage any EC2 instances, as none are exposed on the cluster.</li>
<li>Tasks are directly exposed to the user via an ENI.</li>
<li>The underlying infrastructure is provisioned by Fargate. EC2 instances are not to be managed with the Fargate launch type.</li>
<li>CodePipeline supports Fargate as a deployment platform.</li>
<li>Microservices based on Container definitions encapsulated in a task definition are explicitly linked, and are not to be linked with any additional options, such as links.</li>
<li>CloudWatch Logs may be auto configured.</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title"> Amazon ECS objects</h1>
                </header>
            
            <article>
                
<p class="mce-root CDPAlignCenter CDPAlign CDPAlignLeft">Amazon ECS objects with Fargate are the same as for the EC2 launch type. An ECS cluster is the outermost encapsulation, and it consists of one or more services. A cluster could be distributed over multiple availability zones. A service is an implementation of a task definition, and runs one or more tasks. A task definition could have one or more task revisions. A task revision is a distinct task definition with a set of tasks and a service associated with it. One Fargate instance is associated with a set of tasks in a service. A task definition consists of zero or more container definitions. Typically, a task definition would be associated with one or more container definitions, and a task definition that does not consist of any container definition would not run any task containers. A diagram of ECS objects is shown as follows:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/d19da398-819a-4a30-8926-7b851be6f251.jpg" style="width:54.42em;height:22.17em;"/></div>
<p>A <span class="packt_screen">Task definition</span> is an application template and describes one or more containers. While some attributes or settings are configured at the task level, most of them are configured at the container level. Multiple revisions may be associated with a task definition.</p>
<p>A <span class="packt_screen">Service</span> implements a task definition, and defines a desired count for tasks to run for a task definition. Optional features such as auto scaling and load balancing are configured in the service.</p>
<p>A <span class="packt_screen">Cluster</span> in an ECS service is a grouping of one or more container services. A cluster name must be unique within an account. A cluster called default is provisioned by default.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Compute resources in Amazon ECS Fargate</h1>
                </header>
            
            <article>
                
<p class="mce-root"><span class="packt_screen">Task size</span> consists of <span class="packt_screen">Task memory (GB)</span> and <span class="packt_screen">Task CPU (vCPU)</span>. While optional in the EC2 launch type, task size is required with the Fargate launch type. Docker container level memory and CPU settings may optionally be defined, but are overridden by task definition level settings. Only specific combinations of task memory and task CPU are supported, and the ECS wizard indicates with a message the supported value (or range of values) for a selected value. As an example, the valid CPU range for 1 GB memory is 0.25 vCPU to 0.5 vCPU. The total resources (memory or CPU) configured at the container level must not exceed the task level resource settings. As an example, if a task definition consists of two containers (MySQL and WordPress) with a memory limit of 128 MB for each container, the task level memory must be at least 256 MB. Also, the total of container level memory must not exceed 256 MB. Similarly for the CPU. Two memory limits may be defined at the container level: <span class="packt_screen">Soft limit</span> and <span class="packt_screen">Hard limit</span>. The Soft limit corresponds to the <kbd>memoryReservation</kbd> attribute at the task level, and the Hard limit corresponds to the <kbd>memory</kbd> attribute at the task level. The sum of container memory reservations (Soft limits) must not exceed the task memory. The Hard limit for each container must not exceed the memory configured at the task level. A minimum of 4 GB must be specified by default for a container.</p>
<p class="mce-root CDPAlignLeft CDPAlign">An example task size is shown in the following screenshot, in which the <span class="packt_screen">Task memory</span> (<kbd>memory</kbd> attribute) is set to <span class="packt_screen">0.5 GB</span> (512 GB), and the <span class="packt_screen">Task CPU</span> is set to <span class="packt_screen">0.25 vCPU</span>. At the container level, as configured in the two container definitions, the memory reservation is 128 MB for each container, which makes the total memory reservation of <span class="packt_screen">256 MB</span> well within the <span class="packt_screen">512 GB</span> allocated at the task level. The task size is allocated to a task, whether used or not. Similarly, the number of <span class="packt_screen">CPU Units</span> configured for each container is <span class="packt_screen">10</span>, which makes the total CPU units 20 for containers within the CPU units, 25 are allocated at the task level. Refer to the following screenshot:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/090df530-6159-4804-8bd6-b851d8cc3084.jpg" style="width:49.25em;height:34.58em;"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Task size configuration and allocation for containers</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">What is new in the Amazon Fargate launch type mode?</h1>
                </header>
            
            <article>
                
<p>In addition to and concomitant with the Fargate benefits discussed earlier, Fargate supports the following new features:</p>
<ul>
<li> Networking mode, <kbd>awsvpc</kbd>, is the only supported mode</li>
<li> Host port mappings are not valid with the Fargate launch type networking mode (<kbd>awsvpc</kbd>), and host ports on which an application is exposed are the same as the container ports</li>
<li><kbd>ecsTaskExecutionRole</kbd> is added for the Fargate launch type to allow for pulling Docker images and sending logs to CloudWatch Logs</li>
<li>Only the <kbd>awslogs</kbd> log configuration and <kbd>awslogs</kbd> log driver are supported with CloudWatch Logs</li>
<li>Task placement is not supported, as no ECS instances are provisioned to define placement constraints for</li>
<li>Only Docker images on Docker Hub and Amazon ECR are supported</li>
<li>Privileged Windows containers are not supported for the Fargate launch type</li>
<li>Host devices cannot be exposed to a container</li>
<li> The <kbd>host</kbd> and <kbd>sourcePath</kbd> parameters for volumes are not supported with the Fargate launch type</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<div>
<p>In this introductory chapter, we discussed the benefits of using the Fargate launch type, how compute resources are distributed and configured with the Fargate launch type, how the ECS objects with Fargate are the same as for the EC2 launch type, and the new features in Fargate. In the next chapter, we shall discuss networking as used with Fargate.</p>
</div>


            </article>

            
        </section>
    </body></html>