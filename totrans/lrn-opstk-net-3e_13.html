<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Load Balancing Traffic to Instances</h1>
                </header>
            
            <article>
                
<p><span> The Neutron <span class="KeyWordPACKT">load-balancing-as-a-service</span> plugin, known as LBaaS v2, provides users with the ability to load balance traffic to applications running on virtual instances in the cloud. Neutron provides an API to manage load balancers, listeners, pools, members, and health monitors.</span></p>
<p>In this chapter, we will cover some fundamental load balancing concepts, including the following:</p>
<ul>
<li>Listeners, pools, and pool members</li>
<li>Load balancing algorithms</li>
<li>Health Monitors</li>
<li>Session Persistence</li>
</ul>
<p><span>Neutron uses drivers to interact with hardware or software load balancers. In Pike, the reference driver deploys HAProxy within network namespaces. HAProxy is a free, open source load balancer that is available for most Linux-based operating systems. Octavia is another open source load balancing solution that is compatible with the LBaaS v2 API. Rather than use network namespaces, however, Octavia spins up and manages a fleet of virtual machines, containers, or bare-metal servers known as</span> amphorae <span>that act as load balancers. This allows Octavia to scale horizontally and on-demand. Deploying Octavia and other third-party drivers from vendors such as F5, Citrix, Radware, and more is possible, but outside the scope of this book.</span></p>
<p>In this chapter, we will work through the following:</p>
<ul>
<li>Integrating load balancers into the network</li>
<li>Installing and configuring the LBaaS v2 agent</li>
<li>Creating a load balancer</li>
<li>Demonstrating load balanced traffic to instances</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Fundamentals of load balancing</h1>
                </header>
            
            <article>
                
<p>A load balancer is an object that represents a virtual IP and is associated with a Neutron port. A virtual IP is often exposed to the internet and mapped to a domain name to provide access to an internet-facing load balanced service. Virtual IPs can also be created for services limited to internal clients. Traffic to the virtual IP is distributed among pool members and provides scaling and resiliency to the application.</p>
<p>There are four major components to a load balancer in Neutron:</p>
<ul>
<li>Pool Member(s)</li>
<li>Pool</li>
<li>Health Monitor</li>
<li>Listener(s)</li>
</ul>
<p><span>A <span class="KeyWordPACKT">pool member</span> is a Layer 4 object that represents the IP address and listening port of a service or application. For example, a pool member might be a web server with a configured IP address of 192.168.0.2 listening on TCP port 80.</span></p>
<p><span>A <span class="KeyWordPACKT">pool</span> is a group of pool members that typically serve identical content. A pool composed of web servers may resemble the following membership:</span></p>
<ul>
<li><span class="KeyWordPACKT">Server A</span>:192.168.0.2:80</li>
<li><span class="KeyWordPACKT">Server B</span>:192.168.0.4:80</li>
<li><span class="KeyWordPACKT">Server C</span>:192.168.0.6:80</li>
</ul>
<p><span>A <span class="BoldPACKT">health monitor</span> is an object that represents a health check operation against pool member(s) that run(s) at a defined interval. When the health monitor fails, the pool member is marked</span> <span class="CodeInTextPACKT">DOWN</span> and is removed from the pool until it passes a subsequent check. In the meantime, traffic is directed to healthy members.</p>
<p><span>A <span class="KeyWordPACKT">listener</span> is an object that represents a Layer 4 port associated with the Virtual IP that listens for incoming connections to the VIP. Load balancers can listen for connections on multiple ports, and each port is defined by a listener.</span></p>
<p>The following diagram demonstrates the relationship between these objects:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/dab08903-e6b5-4d98-85bb-467db8178f19.png" style="width:40.58em;height:30.50em;"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Load balancing algorithms</h1>
                </header>
            
            <article>
                
<p>In version 2 of the LBaaS API, the following load balancing algorithms can be applied to a pool:</p>
<ul>
<li>Round robin</li>
<li>Least connections</li>
<li>Source IP</li>
</ul>
<p><span>With the <span class="KeyWordPACKT">round robin</span> algorithm, the load balancer passes each new connection to the next server in line. Over time, all connections will be distributed evenly across all machines being load balanced. Round robin is the least resource-intensive algorithm and has no mechanism to determine when a machine is being overwhelmed by connections. To avoid overwhelming a pool member, all members should be equal in terms of processing speed, connection speed, and memory.</span></p>
<p class="mce-root"/>
<p class="mce-root"/>
<p><span>With the <span class="KeyWordPACKT">least connections</span> algorithm, the load balancer passes a new connection to a server that has the least number of current connections. It is considered a dynamic algorithm, as the system keeps track of the number of connections attached to each server and balances traffic accordingly. Pool members of higher capabilities will likely receive more traffic, as they are able to process connections quicker.</span></p>
<p><span>With the <span class="KeyWordPACKT">source IP</span> algorithm, all connections originating from the same source IP address are sent to the same pool member. Connections are initially balanced using the round robin algorithm and are then tracked in a table for future lookup with subsequent connections from the same IP address. This algorithm is useful in cases where the application requires clients to persist to a particular server for all requests, such as an online shopping cart that stores session information on the local web server.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Monitoring</h1>
                </header>
            
            <article>
                
<p>The LBaaS v2 API supports multiple monitor types, including TCP, HTTP, and HTTPS. The TCP monitor tests connectivity to pool members at Layer 4, while HTTP and HTTPS monitors tests the health of pool members based on Layer 7 HTTP status codes.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Session persistence</h1>
                </header>
            
            <article>
                
<p>LBaaS v2 supports session persistence on virtual IPs. Session persistence is a method of load balancing that forces multiple client requests of the same protocol to be directed to the same node. This feature is commonly used with many web applications that do not share application states between pool members.</p>
<p>The types of session persistence supported with the HAProxy driver include the following:</p>
<ul>
<li><kbd>SOURCE_IP</kbd></li>
<li><kbd>HTTP_COOKIE</kbd></li>
<li><kbd>APP_COOKIE</kbd></li>
</ul>
<p>Using the <kbd><span class="CodeInTextPACKT">SOURCE_IP</span></kbd> persistence type configures HAProxy with the following settings within the backend pool configuration:</p>
<pre>stick-table type ip size 10k 
stick on src</pre>
<p class="mce-root"/>
<p class="mce-root"/>
<p>The first time a client connects to the virtual IP, HAProxy creates an entry in a sticky table based on the client's IP address and sends subsequent connections from the same IP address to the same backend pool member. Based on the configuration, up to 10,000 sticky entries can exist in the sticky table. This persistence method can cause load imbalance between pool members if users connect from behind a proxy server that misidentifies multiple clients as a single address.</p>
<p>Using the <kbd><span class="CodeInTextPACKT">HTTP_COOKIE</span></kbd> persistence type configures HAProxy with the following settings within the backend pool configuration:</p>
<pre>cookie SRV insert indirect nocache </pre>
<p>The first time a client connects to the virtual IP, HAProxy balances the connection to the next pool member in line. When the pool member sends its response, HAProxy injects a cookie named SRV into the response before sending it to the client. The value of the SRV cookie is a unique server identifier. When the client sends subsequent requests to the virtual IP, HAProxy strips the cookie from the request header and sends the traffic directly to the pool member identified in the cookie. This persistence method is recommended over source IP persistence, as it is not reliant on the IP address of the client. However, it may not be compatible with all clients.</p>
<p>Using the <kbd><span class="CodeInTextPACKT">APP_COOKIE</span></kbd> persistence type configures HAProxy with the following settings within the backend pool configuration:</p>
<pre>appsession &lt;CookieName&gt; len 56 timeout 3h </pre>
<p>When an application cookie is defined in a backend configuration, HAProxy will check server responses for the cookie, stores its value in a table, and associates it with the server's identifier. Up to 56 characters from the value will be retained. On subsequent client connections, HAProxy will look for the cookie in the client's request. If a known value is found, the client is directed to the pool member associated with the value. Otherwise, the round-robin load balancing algorithm is applied. Cookies are automatically removed from memory when they have gone unused for a duration longer than three hours.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Integrating load balancers into the network</h1>
                </header>
            
            <article>
                
<p><span>When using the HAProxy driver, load balancers are implemented in <span class="KeyWordPACKT">one-arm</span> mode. In one-arm mode, the load balancer is not in the path of normal traffic to the pool members. The load balancer has a single interface for ingress and egress traffic to and from clients and pool members.</span></p>
<p class="mce-root"/>
<p>A logical diagram of a load balancer in one-arm mode can be seen here:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/60cfdec5-8b3c-4f89-9c46-e38e1941d9e3.png" style="width:39.50em;height:42.67em;"/></div>
<p>In the preceding diagram a load balancer is configured in one-arm mode and resides in the same subnet as the servers it is balancing traffic to.</p>
<p>Because a load balancer in one-arm mode is not the gateway for pool members it is sending traffic to, it must rely on the use of source NAT to ensure return traffic from the members to the client is sent back through the load balancer. An example of the traffic flow can be seen in the following diagram:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/5c860b6a-cf64-436a-a20a-62af77724aeb.png" style="width:56.17em;height:34.92em;"/></div>
<p>In the preceding diagram, the load balancer receives a request from the client and forwards it to <span class="CodeInTextPACKT"><span class="packt_screen">web1</span></span>. The load balancer will modify the source IP of the request to its own address, <span class="packt_screen">192.168.200.12</span>, before forwarding the request to the pool member. This ensures that the member sends the response back to the load balancer, which will then rewrite the destination IP as the client address. If the server were to send the response directly to the client, the client would reject the packet.</p>
<p>Neutron configures HAProxy to send an <kbd>HTTP </kbd><span class="CodeInTextPACKT"><kbd>X-Forwarded-For</kbd> </span>header to the pool member, which allows the member to see the original client address. Without this header, all traffic will be identified as coming from the load balancer, which may skew application reporting data and persistence efforts.</p>
<p class="mce-root"/>
<p><span>Alternatives to one-arm mode include routed mode and transparent mode. In <span class="KeyWordPACKT">routed mode</span>, the load balancer acts as a gateway between the client and pool member. The source addresses of packets do not need to be manipulated in most cases, as the load balancer servers as the gateway for pool members.</span></p>
<p><span>In <span class="KeyWordPACKT">transparent mode</span>, the load balancer acts as a network bridge between two VLANs configured with the same subnet(s). Using this mode allows users to introduce a load balancer to the network with minimal disruption, as pool members do not need to change their gateway.</span></p>
<div class="packt_infobox">There is currently no way to change the way an HAProxy-based load balancer is integrated into the network. Some third-party drivers, however, may not be limited to one-arm mode and may function in any mode.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Network namespaces</h1>
                </header>
            
            <article>
                
<p>Neutron relies on network namespaces to provide individual load balancers when using the HAProxy driver. Every load balancer has a corresponding network namespace. Load balancers are scheduled to LBaaS v2 agents in the environment that are responsible for creating a corresponding network namespace and appropriate configuration. Namespaces used for load balancers are prefaced with <span class="CodeInTextPACKT"><kbd>qlbaas</kbd> </span>in the <span class="CodeInTextPACKT"><kbd>ip netns list</kbd> </span>output.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing LBaaS v2</h1>
                </header>
            
            <article>
                
<p>The <span class="CodeInTextPACKT"><kbd>neutron-lbaasv2-agent</kbd> </span>service typically runs on one or more network nodes. In this environment, the service will be installed on <kbd>controller01</kbd>.</p>
<p>Issue the following command on the controller node to install the LBaaS v2 agent and its dependencies, including HAProxy:</p>
<pre><strong># apt install neutron-lbaasv2-agent</strong> </pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring the Neutron LBaaS agent service</h1>
                </header>
            
            <article>
                
<p>Neutron stores the LBaaS v2 agent configuration in the <span class="CodeInTextPACKT"><kbd>/etc/neutron/lbaas_agent.ini</kbd> </span>file. The most common configuration options will be covered in the upcoming sections.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Defining an interface driver</h1>
                </header>
            
            <article>
                
<p>Just like the previously installed agents, the Neutron LBaaS v2 agent must be configured to use an interface driver that corresponds to the chosen networking driver. In this configuration, there are two options:</p>
<ul>
<li>Linux bridge</li>
<li>Open vSwitch</li>
</ul>
<p>Update the Neutron LBaaS agent configuration file node at <span class="CodeInTextPACKT"><kbd>/etc/neutron/lbaas_agent.ini</kbd> </span>on the controller to use one of the following drivers.</p>
<p>For Linux bridge:</p>
<pre>[DEFAULT]<br/>...<br/>interface_driver = linuxbridge </pre>
<p>For Open vSwitch:</p>
<pre>[DEFAULT]<br/>...<br/>interface_driver = openvswitch </pre>
<div class="packt_tip">In this book, we specified that the controller node runs the Linux bridge agent. Therefore, the LBaaS v2 agent should be configured to use the Linux bridge interface driver.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Defining a device driver</h1>
                </header>
            
            <article>
                
<p>To manage a load balancer, the Neutron LBaaS v2 agent must be configured to use a device driver that provides the interface between the Neutron API and the programming of the load balancer itself.</p>
<p>Update the Neutron LBaaS v2 agent configuration file node at <span class="CodeInTextPACKT"><kbd>/etc/neutron/lbaas_agent.ini</kbd> </span>on the controller to use the HAProxy device driver:</p>
<pre>[DEFAULT]<br/>...<br/>device_driver = neutron_lbaas.drivers.haproxy.namespace_driver.HaproxyNSDriver </pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Defining a user group</h1>
                </header>
            
            <article>
                
<p>Depending on the operating system in use, including Ubuntu 16.04 LTS, which is used throughout this book, the LBaaS v2 agent may need to be configured to operate HAProxy with a certain user group name. On the <kbd>controller01</kbd> node, update the LBaaS v2 configuration file with the following configuration:</p>
<pre>[haproxy]<br/>...<br/>user_group = haproxy </pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring Neutron</h1>
                </header>
            
            <article>
                
<p>In addition to configuring the LBaaS agent, Neutron must be configured to use an LBaaS service plugin and driver before the API can be utilized to create LBaaS objects.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Defining a service plugin</h1>
                </header>
            
            <article>
                
<p>On the <kbd>controller01</kbd> node, add the LBaaS v2 service plugin to the existing <span class="CodeInTextPACKT"><kbd>service_plugins</kbd> </span>list found in the Neutron configuration file at <kbd><span class="CodeInTextPACKT">/etc/neutron/neutron.conf</span></kbd>:</p>
<pre>[DEFAULT]<br/>...<br/>service_plugins = router,neutron_lbaas.services.loadbalancer.plugin.LoadBalancerPluginv2 </pre>
<div class="packt_tip">Be sure to append to the existing list of plugins, rather than replacing the list content, to avoid issues with the API and existing network objects.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Defining a service provider</h1>
                </header>
            
            <article>
                
<p>Since the Kilo release of OpenStack, many advanced service configuration options have moved out of the main Neutron configuration file into their own files. On the controller01 node, create or update the Neutron LBaaS configuration file at <kbd><span class="CodeInTextPACKT">/etc/neutron/neutron_lbaas.conf</span></kbd> and define the HAProxy service provider driver for LBaaS:</p>
<pre>[service_providers] <br/>... <br/>service_provider = LOADBALANCERV2:Haproxy:neutron_lbaas.drivers.haproxy.plugin_driver.HaproxyOnHostPluginDriver:default </pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Updating the database schema</h1>
                </header>
            
            <article>
                
<p>Before restarting the Neutron API server to provide the LBaaS API, the database schema must be updated to support load balancing objects.</p>
<p>On the <kbd>controller01</kbd> node, run the following command to run database migrations:</p>
<pre># neutron-db-manage --subproject neutron-lbaas upgrade head </pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Restarting the Neutron LBaaS agent and API service</h1>
                </header>
            
            <article>
                
<p>Once the database migration is complete, the <span class="CodeInTextPACKT">neutron-lbaasv2-agent </span>and <span class="CodeInTextPACKT">neutron-server </span>services must be restarted for the changes to take effect. Issue the following commands on the controller node to restart the services:</p>
<pre># systemctl restart neutron-server neutron-lbaasv2-agent </pre>
<p>Use the <kbd><span class="CodeInTextPACKT">openstack network agent list</span></kbd> command to verify that the agent is running and has checked in:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/8bf33b2d-d86a-4ae1-8a58-19d45d29593f.png"/></p>
<p>If you encounter any issues, be sure to check the LBaaS v2 agent log found at <kbd><span class="CodeInTextPACKT">/var/log/neutron/neutron-lbaasv2-agent.log</span></kbd> before proceeding.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Load balancer management in the CLI</h1>
                </header>
            
            <article>
                
<p>Neutron offers a number of commands that can be used to create and manage listeners, virtual IPs, pools, members, and health monitors for load balancing purposes. As of the Pike release of OpenStack, however, load balancer-related commands are not available in the <span class="CodeInTextPACKT">openstack</span> client. Instead, the <span class="CodeInTextPACKT">neutron</span> client or API should be used.</p>
<p>The workflow to create a basic load balancer is as follows:</p>
<ul>
<li>Create a load balancer object</li>
<li>Create and associate a pool</li>
<li>Create and associate pool member(s)</li>
<li>Create and associate health monitor(s) (optional)</li>
<li>Create and associate a listener</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Managing load balancers in the CLI</h1>
                </header>
            
            <article>
                
<p>A load balancer is an object that occupies a Neutron port and has an IP assigned from a subnet that acts as a Virtual IP. The following commands are used to manage load balancer objects in the CLI:</p>
<table border="1" style="border-collapse: collapse;width: 100%">
<tbody>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p class="TableColumnHeadingPACKT"><strong>Load Balancer Management Commands</strong></p>
</td>
<td>
<p class="TableColumnHeadingPACKT CDPAlignCenter CDPAlign"><strong>Description</strong></p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT"><kbd>lbaas-loadbalancer-create</kbd></p>
</td>
<td>
<p class="TableColumnContentPACKT">Creates a load balancer</p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT"><kbd>lbaas-loadbalancer-delete</kbd></p>
</td>
<td>
<p class="TableColumnContentPACKT">Deletes a given load balancer</p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT"><kbd>lbaas-loadbalancer-list</kbd></p>
</td>
<td>
<p class="TableColumnContentPACKT">Lists load balancers that belong to a given tenant</p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT"><kbd>lbaas-loadbalancer-list-on-agent</kbd></p>
</td>
<td>
<p class="TableColumnContentPACKT">Lists the load balancers on a load balancer v2 agent</p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT"><kbd>lbaas-loadbalancer-show</kbd></p>
</td>
<td>
<p class="TableColumnContentPACKT">Shows information of a given load balancer</p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT"><kbd>lbaas-loadbalancer-stats</kbd></p>
</td>
<td>
<p class="TableColumnContentPACKT">Retrieves stats for a given load balancer</p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT"><kbd>lbaas-loadbalancer-status</kbd></p>
</td>
<td>
<p class="TableColumnContentPACKT">Retrieves the status for a given load balancer</p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT"><kbd>lbaas-loadbalancer-update</kbd></p>
</td>
<td>
<p class="TableColumnContentPACKT">Updates a given load balancer</p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT"><kbd>lbaas-agent-hosting-loadbalancer</kbd></p>
</td>
<td>
<p class="TableColumnContentPACKT">Gets the lbaas v2 agent hosting a load balancer</p>
</td>
</tr>
</tbody>
</table>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating load balancers in the CLI</h1>
                </header>
            
            <article>
                
<p>To create a load balancer, use the <kbd><span class="CodeInTextPACKT">neutron lbaas-loadbalancer-create</span></kbd> command shown here:</p>
<pre>neutron lbaas-loadbalancer-create<br/>[--tenant-id TENANT_ID]<br/>[--description DESCRIPTION]<br/>[--name NAME]<br/>[--admin-state-down]<br/>[--provider PROVIDER]<br/>[--flavor FLAVOR]<br/>[--vip-address VIP_ADDRESS]<br/>VIP_SUBNET </pre>
<p>The <kbd><span class="CodeInTextPACKT">--tenant-id</span></kbd> argument is optional and can be used to associate the load balancer with a project other than the creator.</p>
<p>The <kbd><span class="CodeInTextPACKT">--description</span></kbd> argument is optional and can be used to provide a description for the load balancer.</p>
<p>The <kbd><span class="CodeInTextPACKT">--name</span></kbd> argument is optional and can be used to specify a name for the load balancer.</p>
<p>The <kbd><span class="CodeInTextPACKT">--admin-state-down</span></kbd> argument is optional and can be used to set the load balancer in a <span class="CodeInTextPACKT">DOWN</span> state at creation.</p>
<p>The <kbd><span class="CodeInTextPACKT">--provider</span></kbd> argument is optional and can be used to specify the load balancer provider driver in lieu of the default. The default provider in this environment is HAProxy.</p>
<p>The <kbd><span class="CodeInTextPACKT">--vip-address</span></kbd> argument is optional and can be used to specify a particular IP address for the VIP.</p>
<p>The <kbd><span class="CodeInTextPACKT">VIP_SUBNET</span></kbd> argument is used to specify the subnet from which the load balancer VIP will be procured.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Deleting load balancers in the CLI</h1>
                </header>
            
            <article>
                
<p>To delete a load balancer, use the <kbd><span class="CodeInTextPACKT">neutron lbaas-loadbalancer-delete</span></kbd> command shown here:</p>
<pre>neutron lbaas-loadbalancer-delete LOADBALANCER [LOADBALANCER...]</pre>
<p>The <kbd><span class="CodeInTextPACKT">LOADBALANCER</span></kbd> argument specifies the name or ID or the load balancer to delete. Multiple load balancers can be deleted simultaneously using a space-separated list.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Listing load balancers in the CLI</h1>
                </header>
            
            <article>
                
<p>To list all load balancers, use the <kbd><span class="CodeInTextPACKT">neutron lbaas-loadbalancer-list</span></kbd> command shown here:</p>
<pre>neutron lbaas-loadbalancer-list </pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Showing load balancer details in the CLI</h1>
                </header>
            
            <article>
                
<p>To show the details of a load balancer, use the <kbd><span class="CodeInTextPACKT">neutron lbaas-loadbalancer-show</span></kbd> command shown here:</p>
<pre>neutron lbaas-loadbalancer-show LOADBALANCER </pre>
<p>The <kbd><span class="CodeInTextPACKT">LOADBALANCER</span></kbd> argument specifies the name or ID or the load balancer to show.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Showing load balancer statistics in the CLI</h1>
                </header>
            
            <article>
                
<p>To show the statistics of a load balancer, use the <kbd><span class="CodeInTextPACKT">neutron lbaas-loadbalancer-stats</span></kbd> command shown here:</p>
<pre>neutron lbaas-loadbalancer-stats LOADBALANCER  </pre>
<p>The <kbd><span class="CodeInTextPACKT">LOADBALANCER</span></kbd> argument specifies the name or ID or the load balancer to show.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Showing the load balancer's status in the CLI</h1>
                </header>
            
            <article>
                
<p>To show the status of a load balancer, use the <kbd><span class="CodeInTextPACKT">neutron lbaas-loadbalancer-status</span></kbd> command shown here:</p>
<pre>neutron lbaas-loadbalancer-status LOADBALANCER  </pre>
<p>The <kbd><span class="CodeInTextPACKT">LOADBALANCER</span></kbd> argument specifies the name or ID or the load balancer to show.</p>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Updating a load balancer in the CLI</h1>
                </header>
            
            <article>
                
<p>To update the attributes of a load balancer, use the <span class="CodeInTextPACKT"><kbd>neutron lbaas-loadbalancer-update</kbd> </span>command shown here:</p>
<pre>neutron lbaas-loadbalancer-update<br/>[--description DESCRIPTION]<br/>[--name NAME]<br/>LOADBALANCER  </pre>
<p>The <kbd><span class="CodeInTextPACKT">--description</span></kbd> argument is optional and can be used to update the description of the load balancer.</p>
<p>The <kbd><span class="CodeInTextPACKT">--name</span></kbd> argument is optional and can be used to update the name of a load balancer.</p>
<p>The <kbd><span class="CodeInTextPACKT">LOADBALANCER</span></kbd> argument specifies the name or ID or the load balancer to update.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Managing pools in the CLI</h1>
                </header>
            
            <article>
                
<p>A pool is a set of devices, such as web servers, that are grouped together to receive and process traffic. When traffic is sent to a virtual IP, the load balancer sends the request to any of the servers that are members of that pool.</p>
<p>The following commands are used to manage load balancer pools in the CLI:</p>
<table border="1" style="border-collapse: collapse;width: 100%">
<tbody>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p class="TableColumnHeadingPACKT"><strong>Pool Commands</strong></p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p class="TableColumnHeadingPACKT"><strong>Description</strong></p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT"><kbd>lbaas-pool-create</kbd></p>
</td>
<td>
<p class="TableColumnContentPACKT">Creates a pool</p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT"><kbd>lbaas-pool-delete</kbd></p>
</td>
<td>
<p class="TableColumnContentPACKT">Deletes a given pool</p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT"><kbd>lbaas-pool-list</kbd></p>
</td>
<td>
<p class="TableColumnContentPACKT">Lists pools that belong to a given tenant</p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT"><kbd>lbaas-pool-show</kbd></p>
</td>
<td>
<p class="TableColumnContentPACKT">Shows the information of a given pool</p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT"><kbd>lbaas-pool-update</kbd></p>
</td>
<td>
<p class="TableColumnContentPACKT">Updates a given pool</p>
</td>
</tr>
</tbody>
</table>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a pool in the CLI</h1>
                </header>
            
            <article>
                
<p>To create a pool, use the <kbd><span class="CodeInTextPACKT">neutron lbaas-pool-create</span></kbd> command shown here:</p>
<pre>neutron lbaas-pool-create<br/>[--tenant-id TENANT_ID]<br/>[--description DESCRIPTION]<br/>[--name NAME] --lb-algorithm<br/>{ROUND_ROBIN,LEAST_CONNECTIONS,SOURCE_IP}</pre>
<p class="mce-root"/>
<p class="mce-root"/>
<pre>[--admin-state-down]<br/>[--listener LISTENER]<br/>[--loadbalancer LOADBALANCER] --protocol {HTTP,HTTPS,TCP}<br/>[--session-persistence type=TYPE[,cookie_name=COOKIE_NAME]] </pre>
<p>The <span class="CodeInTextPACKT"><kbd>--tenant-id</kbd> </span>argument is optional and can be used to associate the pool with a project other than the creator. The tenant or project ID specified should match the respective load balancer.</p>
<p>The <kbd><span class="CodeInTextPACKT">--description</span></kbd> argument is optional and can be used to provide a description for the pool.</p>
<p>The <kbd><span class="CodeInTextPACKT">--name</span></kbd> argument is optional and can be used to set a name for the pool.</p>
<p>The <span class="CodeInTextPACKT"><kbd>--lb-algorithm</kbd> </span>argument is required and is used to specify the load balancing algorithm used to distribute traffic among the pool members. Possible options include <kbd><span class="CodeInTextPACKT">ROUND_ROBIN</span></kbd>, <kbd><span class="CodeInTextPACKT">LEAST_CONNECTIONS</span></kbd>, and <kbd><span class="CodeInTextPACKT">SOURCE_IP</span></kbd>.</p>
<p>The <kbd><span class="CodeInTextPACKT">--admin-state-down</span></kbd> argument is optional and can be used to set the pool in a <span class="CodeInTextPACKT">DOWN</span> state upon creation.</p>
<p>The <kbd><span class="CodeInTextPACKT">--listener</span></kbd> argument is optional and is used to associate the pool with a listener.</p>
<p>The <kbd><span class="CodeInTextPACKT">--loadbalancer</span></kbd> argument is optional and can be used to specify the associated load balancer.</p>
<p>The <kbd><span class="CodeInTextPACKT">--protocol</span></kbd> argument is required and is used to specify the protocol for balancing. Possible options include <span class="CodeInTextPACKT">HTTP</span>, <span class="CodeInTextPACKT">HTTPS</span>, and <span class="CodeInTextPACKT">TCP</span>.</p>
<p>The <kbd><span class="CodeInTextPACKT">--session-persistence</span></kbd> argument is optional and is used to specify the session persistence method and/or cookie type.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Deleting a pool in the CLI</h1>
                </header>
            
            <article>
                
<p>To delete a pool, use the <span class="CodeInTextPACKT"><kbd>neutron lbaas-pool-delete</kbd> </span>command shown here:</p>
<pre>neutron lbaas-pool-delete POOL [POOL ...] </pre>
<p>The <kbd><span class="CodeInTextPACKT">POOL</span></kbd> argument specifies the name or ID or the pool to delete. Multiple pools can be deleted simultaneously using a space-separated list.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Listing pools in the CLI</h1>
                </header>
            
            <article>
                
<p>To list all pools, use the <kbd><span class="CodeInTextPACKT">neutron lbaas-pool-list</span></kbd> command shown here:</p>
<pre>neutron lbaas-pool-list  </pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Showing pool details in the CLI</h1>
                </header>
            
            <article>
                
<p>To show the details of a pool, use the <kbd><span class="CodeInTextPACKT">neutron lbaas-pool-show</span></kbd> command shown here:</p>
<pre>neutron lbaas-pool-show POOL </pre>
<p>The <kbd><span class="CodeInTextPACKT">POOL</span></kbd> argument specifies the name or ID or the pool to show.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Updating a pool in the CLI</h1>
                </header>
            
            <article>
                
<p>To update a pool, use the <kbd><span class="CodeInTextPACKT">neutron lbaas-pool-update</span></kbd> command shown here:</p>
<pre>neutron lbaas-pool-update<br/>[--admin-state-up {True,False}]<br/>[--session-persistence type=TYPE [,cookie_name=COOKIE_NAME]<br/>| --no-session-persistence]<br/>[--description DESCRIPTION]<br/>[--name NAME]<br/>[--lb-algorithm {ROUND_ROBIN,LEAST_CONNECTIONS,SOURCE_IP}]<br/>POOL </pre>
<p>The <kbd><span class="CodeInTextPACKT">--admin-state-up</span></kbd> argument is optional and can be used to change the state of a pool.</p>
<p>The <kbd><span class="CodeInTextPACKT">--session-persistence</span></kbd> argument is optional and is used to modify the session persistence method and/or cookie type.</p>
<p>The <kbd><span class="CodeInTextPACKT">--no-session-persistence</span></kbd> argument is optional and is used to remove session persistence from the pool.</p>
<p>The <kbd><span class="CodeInTextPACKT">--description</span></kbd> argument is optional and can be used to update the description of the pool.</p>
<p>The <kbd><span class="CodeInTextPACKT">--name</span></kbd> argument is optional and can be used to update the name of the pool.</p>
<p>The <kbd><span class="CodeInTextPACKT">--lb-algorithm</span></kbd> argument is optional and is used to modify the load balancing algorithm used to distribute traffic among the pool members.</p>
<p class="mce-root"/>
<p>The <kbd><span class="CodeInTextPACKT">POOL</span></kbd> argument specifies the name or ID or the pool to update.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Managing pool members in the CLI</h1>
                </header>
            
            <article>
                
<p>The following commands are used to manage pool members in the CLI:</p>
<table border="1" style="border-collapse: collapse;width: 100%">
<tbody>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p class="TableColumnHeadingPACKT"><strong>Pool Member Command</strong></p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p class="TableColumnHeadingPACKT"><strong>Description</strong></p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT"><kbd>lbaas-member-create</kbd></p>
</td>
<td>
<p class="TableColumnContentPACKT">Creates a member</p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT"><kbd>lbaas-member-delete</kbd></p>
</td>
<td>
<p class="TableColumnContentPACKT">Deletes a given member</p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT"><kbd>lbaas-member-list</kbd></p>
</td>
<td>
<p class="TableColumnContentPACKT">Lists members that belong to a given pool</p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT"><kbd>lbaas-member-show</kbd></p>
</td>
<td>
<p class="TableColumnContentPACKT">Shows information of a given member</p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT"><kbd>lbaas-member-update</kbd></p>
</td>
<td>
<p class="TableColumnContentPACKT">Updates a given member</p>
</td>
</tr>
</tbody>
</table>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating pool members in the CLI</h1>
                </header>
            
            <article>
                
<p>To create a pool member, use the <kbd><span class="CodeInTextPACKT">neutron lbaas-member-create</span></kbd> command as follows:</p>
<pre>neutron lbaas-member-create<br/>[--tenant-id TENANT_ID]<br/>[--name NAME]<br/>[--weight WEIGHT]<br/>[--admin-state-down]<br/>--subnet SUBNET<br/>--address ADDRESS<br/>--protocol-port<br/>PROTOCOL_PORT<br/>POOL </pre>
<p>The <span class="CodeInTextPACKT"><kbd>--tenant-id</kbd> </span>argument is optional and can be used to associate the pool member with a project other than the creator. The tenant or project ID specified should match the respective load balancer.</p>
<p>The <kbd><span class="CodeInTextPACKT">--name</span></kbd> argument is optional and can be used to set the name of the pool member.</p>
<p>The <span class="CodeInTextPACKT"><kbd>--weight</kbd> </span>argument allows you to associate a weight with the pool member. When set, a pool member may receive more or less traffic than other members in the same pool. For example, a pool member with a weight of 2 will receive twice the amount of traffic as a pool member with a weight of 1. A pool member with a weight of 3 will receive three times the traffic as a pool member with a weight of 1, and so on.</p>
<p>The <kbd><span class="CodeInTextPACKT">--admin-state-down</span></kbd> argument is optional and can be used to set the pool member <span class="CodeInTextPACKT">DOWN</span> on creation.</p>
<p class="mce-root"/>
<p>The <kbd><span class="CodeInTextPACKT">--subnet</span></kbd> argument is required and is used to specify the subnet of the pool member.</p>
<p>The <span class="CodeInTextPACKT"><kbd>--address</kbd> </span>argument is required and is used to specify the IP address of the pool member. The IP address must fall within the specified subnet CIDR.</p>
<p>The <span class="CodeInTextPACKT"><kbd>--protocol-port</kbd> </span>argument is required and is used to specify the listening port of the application being balanced. For example, if you are balancing HTTP traffic, the listening port specified would be 80. For SSL traffic, the port specified would be 443. In most cases, the VIP associated with the pool will utilize the same application port number.</p>
<p>The <kbd><span class="CodeInTextPACKT">POOL</span></kbd> argument is required and associates the pool member with the specified pool.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Deleting pool members</h1>
                </header>
            
            <article>
                
<p>To delete a pool member, use the <span class="CodeInTextPACKT"><kbd>neutron lbaas-member-delete</kbd> </span>command shown here:</p>
<pre>neutron lbaas-member-delete MEMBER [MEMBER ...] POOL </pre>
<p>The <kbd><span class="CodeInTextPACKT">MEMBER</span></kbd> argument specifies the name or ID of the pool member to delete from the specified pool. Multiple pool members can be deleted simultaneously using a space-separated list.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Listing pool members</h1>
                </header>
            
            <article>
                
<p>To obtain a list of pool members for a particular pool, use the <span class="CodeInTextPACKT"><kbd>neutron lbaas-member-list</kbd> </span>command shown here:</p>
<pre>neutron lbaas-member-list POOL </pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Showing pool member details</h1>
                </header>
            
            <article>
                
<p>To show the details of a pool member, use the <span class="CodeInTextPACKT"><kbd>neutron lbaas-member-show</kbd> </span>command shown here:</p>
<pre>neutron lbaas-member-showMEMBERPOOL </pre>
<p>The <span class="CodeInTextPACKT"><kbd>MEMBER</kbd> </span>argument represents the ID or name of the member of the specified pool.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Updating a pool member</h1>
                </header>
            
            <article>
                
<p>To update the attributes of a pool member, use the <kbd><span class="CodeInTextPACKT">neutron lbaas-member-update</span></kbd> command as follows:</p>
<pre>neutron lbaas-member-update<br/>[--admin-state-up {True,False}]<br/>[--name NAME] [--weight WEIGHT]<br/>MEMBER POOL </pre>
<p>The <kbd><span class="CodeInTextPACKT">--admin-state-up</span></kbd> argument is optional and can be used to change the state of a pool member.</p>
<p>The <kbd><span class="CodeInTextPACKT">--name</span></kbd> argument is optional and can be used to update the name of the pool member.</p>
<p>The <span class="CodeInTextPACKT"><kbd>--weight</kbd> </span>argument is optional and can be used to update the weight of the pool member.</p>
<p>The <span class="CodeInTextPACKT"><kbd>MEMBER</kbd> </span>argument is required and represents the ID or name of the member of the specified pool.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Managing health monitors in the CLI</h1>
                </header>
            
            <article>
                
<p>LBaaS in Neutron provides the ability to monitor the health of pool members as a method of ensuring the availability of an application. If a pool member is not in a healthy state, Neutron can pull a member out of rotation, limiting the impact of issues between the client and the application.</p>
<p>The following commands are used to manage health monitors in the CLI:</p>
<table border="1" style="border-collapse: collapse;width: 100%">
<tbody>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p class="TableColumnHeadingPACKT"><strong>Health Monitor Commands</strong></p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p class="TableColumnHeadingPACKT"><strong>Description</strong></p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT"><kbd>lbaas-healthmonitor-create</kbd></p>
</td>
<td>
<p class="TableColumnContentPACKT">Creates a health monitor</p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT"><kbd>lbaas-healthmonitor-delete</kbd></p>
</td>
<td>
<p class="TableColumnContentPACKT">Deletes a given health monitor</p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT"><kbd>lbaas-healthmonitor-list</kbd></p>
</td>
<td>
<p class="TableColumnContentPACKT">Lists health monitors that belong to a given tenant</p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT"><kbd>lbaas-healthmonitor-show</kbd></p>
</td>
<td>
<p class="TableColumnContentPACKT">Shows the information of a given health monitor</p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT"><kbd>lbaas-healthmonitor-update</kbd></p>
</td>
<td>
<p class="TableColumnContentPACKT">Updates a given health monitor</p>
</td>
</tr>
</tbody>
</table>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a health monitor in the CLI</h1>
                </header>
            
            <article>
                
<p>To create a health monitor, use the <span class="CodeInTextPACKT"><kbd>neutron lbaas-healthmonitor-create</kbd> </span>command shown here:</p>
<pre>neutron lbaas-healthmonitor-create<br/>[--tenant-id TENANT_ID] --delay DELAY<br/>[--name NAME] --timeout TIMEOUT<br/>[--http-method HTTP_METHOD]<br/>[--url-path URL_PATH] --max-retries MAX_RETRIES<br/>[--expected-codes EXPECTED_CODES]<br/>[--admin-state-down] <br/>--type {PING,TCP,HTTP,HTTPS} --pool<br/>POOL                        </pre>
<p>The <span class="CodeInTextPACKT"><kbd>--tenant-id</kbd> </span>argument is optional and can be used to associate the health monitor with a project other than the creator. The tenant or project ID specified should match the respective load balancer.</p>
<p>The <kbd><span class="CodeInTextPACKT">--delay</span></kbd> argument is required and is used to specify the period between each health check sent to members (in seconds). A common starting value is 5 seconds.</p>
<p>The <kbd><span class="CodeInTextPACKT">--name</span></kbd> argument is optional and can be used to set the name of the health monitor.</p>
<p>The <span class="CodeInTextPACKT"><kbd>--timeout</kbd> </span>argument is required and is used to specify the number of seconds for a monitor to wait for a connection to be established. The value must be less than the delay value.</p>
<p>The <kbd><span class="CodeInTextPACKT">--http-method</span></kbd> argument is optional and is used in conjunction with <span class="CodeInTextPACKT"><kbd>--expected-codes</kbd> </span>and <kbd><span class="CodeInTextPACKT">--url-path</span></kbd>. It is used to specify the type of HTTP request being made. Common types include <kbd><span class="CodeInTextPACKT">GET</span></kbd> and <kbd><span class="CodeInTextPACKT">POST</span></kbd>. The default value is <kbd><span class="CodeInTextPACKT">GET</span></kbd>.</p>
<p>The <span class="CodeInTextPACKT"><kbd>--url-path</kbd> </span>argument is optional and is used in conjunction with <kbd><span class="CodeInTextPACKT">--expected-codes</span></kbd> and <kbd><span class="CodeInTextPACKT">--http-method</span></kbd>. When specified, the system will perform an HTTP request defined by <kbd><span class="CodeInTextPACKT">--http-method</span></kbd> for the URL against the pool member. The default value is root or <span class="CodeInTextPACKT">/</span>.</p>
<p>The <kbd><span class="CodeInTextPACKT">--max-retries</span></kbd> argument is required and is used to specify the maximum number of consecutive failures before a pool member is marked as <span class="CodeInTextPACKT">DOWN</span>. A common starting value is 3 retries.</p>
<p class="mce-root"/>
<p class="mce-root"/>
<p>The <span class="CodeInTextPACKT"><kbd>--expected-codes</kbd> </span>argument is optional and allows you to specify the HTTP status code(s) that indicate that a pool member is working as expected when the monitor sends an HTTP request to the pool member for the specified URL. For example, if a <kbd><span class="CodeInTextPACKT">GET</span></kbd> request for a URL is sent to a pool member, the server is expected to return a <span class="CodeInTextPACKT">200 OK</span> status upon successful retrieval of the page. If <span class="CodeInTextPACKT">200</span> is listed as an expected code, the monitor would mark the pool member as <span class="CodeInTextPACKT">UP</span>. As a result, the pool member would be eligible to receive connections. If a <span class="CodeInTextPACKT">500</span> status code were returned, it could indicate that the server is not properly processing connections. The health monitor would mark the pool member as <span class="CodeInTextPACKT">DOWN</span> and temporarily remove it from the pool. The default value is <span class="CodeInTextPACKT">200</span>.</p>
<p>The <kbd><span class="CodeInTextPACKT">--type</span></kbd> arguments is required and is used to specify the type of monitor being configured. The four types include the following:</p>
<ul>
<li><span class="KeyWordPACKT">PING</span>: The simplest of all monitor types, PING uses ICMP to confirm connectivity to pool members.</li>
</ul>
<div class="packt_infobox"><span>The PING type is not supported by the HAProxy driver and results in the same behaviour as the TCP monitor type.</span></div>
<ul>
<li><span class="KeyWordPACKT">TCP</span>: This instructs the load balancer to send a TCP SYN packet to the pool member. Upon receiving a SYN ACK back, the load balancer resets the connection. This type of monitor is commonly referred to as a half-open TCP monitor.</li>
<li><span class="KeyWordPACKT">HTTP</span>: This instructs the monitor to initiate an HTTP request to a pool member based on the <kbd><span class="CodeInTextPACKT">expected_codes</span></kbd>, <kbd><span class="CodeInTextPACKT">url_path</span></kbd>, and <kbd><span class="CodeInTextPACKT">http_method</span></kbd> attributes described here.</li>
<li><span class="KeyWordPACKT">HTTPS</span>: This instructs the monitor to initiate an HTTPS request to a pool member based on the <kbd><span class="CodeInTextPACKT">expected_codes</span></kbd>, <kbd><span class="CodeInTextPACKT">url_path</span></kbd>, and <kbd><span class="CodeInTextPACKT">http_method</span></kbd> attributes described here.</li>
</ul>
<p>The <kbd><span class="CodeInTextPACKT">--pool</span></kbd> argument is required and is used to associate the health monitor with the given pool. Only one health monitor per pool is allowed.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Deleting a health monitor in the CLI</h1>
                </header>
            
            <article>
                
<p>To delete a health monitor, use the <kbd><span class="CodeInTextPACKT">neutron lbaas-healthmonitor-delete</span></kbd> command shown here:</p>
<pre>neutron lbaas-healthmonitor-delete HEALTHMONITOR</pre>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mceNonEditable"/>
<p>The <kbd><span class="CodeInTextPACKT">HEALTHMONITOR</span></kbd> argument specifies the name or ID of the health monitor to delete. Multiple health monitors can be deleted simultaneously using a space-separated list.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Listing health monitors in the CLI</h1>
                </header>
            
            <article>
                
<p>To obtain a list of health monitors, use the <span class="CodeInTextPACKT"><kbd>neutron lbaas-healthmonitor-list</kbd> </span>command shown here:</p>
<pre>neutron lbaas-healthmonitor-list </pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Showing health monitor details</h1>
                </header>
            
            <article>
                
<p>To show the details of a health monitor, use the <kbd><span class="CodeInTextPACKT">neutron lbaas-healthmonitor-show</span></kbd> command shown here:</p>
<pre>neutron lbaas-healthmonitor-show HEALTHMONITOR </pre>
<p>The details returned include delay, expected codes, HTTP method, max retries, pools, timeout, type, and URL path.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Updating a health monitor</h1>
                </header>
            
            <article>
                
<p>To update the attributes of a health monitor, use the <kbd><span class="CodeInTextPACKT">neutron lbaas-healthmonitor-update</span></kbd> command as follows:</p>
<pre>neutron lbaas-healthmonitor-update<br/>[--delay DELAY] [--name NAME]<br/>[--timeout TIMEOUT]<br/>[--http-method HTTP_METHOD]<br/>[--url-path URL_PATH]<br/>[--max-retries MAX_RETRIES]<br/>[--expected-codes EXPECTED_CODES]<br/>[--admin-state-up {True,False}]<br/>HEALTHMONITOR </pre>
<p>Updateable attributes include delay, expected codes, HTTP method, max retries, timeout, and URL path.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Managing listeners in the CLI</h1>
                </header>
            
            <article>
                
<p>The following commands are used to manage listeners in the CLI:</p>
<table border="1" style="border-collapse: collapse;width: 100%">
<tbody>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p class="TableColumnHeadingPACKT"><strong>Listener Commands</strong></p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p class="TableColumnHeadingPACKT"><strong>Description</strong></p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT"><kbd>lbaas-listener-create</kbd></p>
</td>
<td>
<p class="TableColumnContentPACKT">Creates a listener</p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT"><kbd>lbaas-listener-delete</kbd></p>
</td>
<td>
<p class="TableColumnContentPACKT">Deletes a given listener</p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT"><kbd>lbaas-listener-list</kbd></p>
</td>
<td>
<p class="TableColumnContentPACKT">Lists listeners that belong to a given tenant</p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT"><kbd>lbaas-listener-show</kbd></p>
</td>
<td>
<p class="TableColumnContentPACKT">Shows the information of a given listener</p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT"><kbd>lbaas-listener-update</kbd></p>
</td>
<td>
<p class="TableColumnContentPACKT">Updates a given listener</p>
</td>
</tr>
</tbody>
</table>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating listeners in the CLI</h1>
                </header>
            
            <article>
                
<p>To create a listener, use the <kbd><span class="CodeInTextPACKT">neutron lbaas-listener-create</span></kbd> command shown here:</p>
<pre>neutron lbaas-listener-create<br/>[--tenant-id TENANT_ID]<br/>[--description DESCRIPTION]<br/>[--connection-limit CONNECTION_LIMIT]<br/>[--default-pool DEFAULT_POOL]<br/>[--admin-state-down]<br/>[--name NAME]<br/>[--default-tls-container-ref DEFAULT_TLS_CONTAINER_REF]<br/>[--sni-container-refs SNI_CONTAINER_REFS [SNI_CONTAINER_REFS ...]]<br/>[--loadbalancer LOADBALANCER] --protocol<br/>{TCP,HTTP,HTTPS,TERMINATED_HTTPS}<br/>--protocol-port PORT </pre>
<p>The <kbd><span class="CodeInTextPACKT">--tenant-id</span></kbd> argument is optional and can be used to associate the listener with a project other than the creator. The tenant or project ID specified should match the respective load balancer.</p>
<p>The <kbd><span class="CodeInTextPACKT">--description</span></kbd> argument is optional and can be used to provide a description for the listener.</p>
<p>The <kbd><span class="CodeInTextPACKT">--connection-limit</span></kbd> argument is optional and can be used to limit connections per second to the listener. The default is unlimited (-1).</p>
<p>The <kbd><span class="CodeInTextPACKT">--default-pool</span></kbd> argument is optional and sets the default pool for the listener.</p>
<p>The <kbd><span class="CodeInTextPACKT">--admin-state-down</span></kbd> argument is optional and can be used to set the listener in a <span class="CodeInTextPACKT">DOWN</span> state at creation.</p>
<p>The <kbd><span class="CodeInTextPACKT">--name</span></kbd> argument is optional and can be used to set a name for the listener.</p>
<p class="mce-root"/>
<p>The <kbd><span class="CodeInTextPACKT">--loadbalancer</span></kbd> argument is optional and can be used to specify the associated load balancer.</p>
<p>The <kbd><span class="CodeInTextPACKT">--protocol</span></kbd> argument is required and is used to specify the protocol for the listener. Options include <span class="CodeInTextPACKT"><kbd>TCP</kbd>, <kbd>HTTP</kbd>, <kbd>HTTPS</kbd>, and <kbd>TERMINATED_HTTPS</kbd></span>.</p>
<p>The <kbd><span class="CodeInTextPACKT">--protocol-port</span></kbd> argument is required and is used to specify the port for the listener.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Deleting listeners in the CLI</h1>
                </header>
            
            <article>
                
<p>To delete a load balancer, use the <kbd><span class="CodeInTextPACKT">neutron lbaas-loadbalancer-delete</span></kbd> command shown here:</p>
<pre>neutron lbaas-listener-delete LISTENER [LISTENER ...] </pre>
<p>The <kbd><span class="CodeInTextPACKT">LISTENER</span></kbd> argument specifies the name or ID or the listener to delete. Multiple listeners can be deleted simultaneously by using a space-separated list.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Listing listeners in the CLI</h1>
                </header>
            
            <article>
                
<p>To list all listeners, use the <kbd><span class="CodeInTextPACKT">neutron lbaas-listener-list</span></kbd> command shown here:</p>
<pre>neutron lbaas-listener-list  </pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Showing listener details in the CLI</h1>
                </header>
            
            <article>
                
<p>To show the details of a listener, use the <kbd><span class="CodeInTextPACKT">neutron lbaas-listener-show</span></kbd> command shown here:</p>
<pre>neutron lbaas-listener-show LISTENER  </pre>
<p>The <kbd><span class="CodeInTextPACKT">LISTENER</span></kbd> argument specifies the name or ID or the listener to show.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Updating a listener in the CLI</h1>
                </header>
            
            <article>
                
<p>To update the attributes of a listener, use the <span class="CodeInTextPACKT"><kbd>neutron lbaas-listener-update</kbd> </span>command shown here:</p>
<pre>neutron lbaas-listener-update<br/>[--description DESCRIPTION]<br/>[--connection-limit CONNECTION_LIMIT]<br/>[--default-pool DEFAULT_POOL]<br/>[--name NAME]<br/>[--admin-state-up {True,False}]<br/>LISTENER </pre>
<p>The <kbd><span class="CodeInTextPACKT">--description</span></kbd> argument is optional and can be used to update the description of the listener.</p>
<p>The <span class="CodeInTextPACKT"><kbd>--connection-limit</kbd> </span>argument is optional and can be used to update the connection limit.</p>
<p>The <kbd><span class="CodeInTextPACKT">--default-pool</span></kbd> argument is optional and can be used to update the default pool of the listener.</p>
<p>The <kbd><span class="CodeInTextPACKT">--name</span></kbd> argument is option and can be used to set a name for the listener.</p>
<p>The <kbd><span class="CodeInTextPACKT">--admin-state-up</span></kbd> argument is optional and can be used to set the listener's state.</p>
<p>The <span class="CodeInTextPACKT"><kbd>LISTENER</kbd> </span>argument specifies the name or ID or the listener to update.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Building a load balancer</h1>
                </header>
            
            <article>
                
<p>To demonstrate the creation and use of load balancers in Neutron, this section is dedicated to building a functional load balancer based on the following scenario:</p>
<div class="packt_quote">"A project has a simple Neutron network architecture composed of a router attached to both an external provider network and internal tenant network. The user would like to load balance HTTP traffic between two instances, each running a web server on port 80. Each instance has been configured with an <span class="CodeInTextPACKT">index.html </span>page containing a unique server identifier."</div>
<p>A diagram of the requested topology can be seen here:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/8aa9cedf-40b5-493b-90c6-04f97553c8ba.png" style="width:16.00em;height:23.25em;"/></div>
<p>This demonstration assumes that two instances named <span class="CodeInTextPACKT"><span class="packt_screen">web1</span></span> and <span class="CodeInTextPACKT"><span class="packt_screen">web2</span> </span>have been deployed in the environment and are connected to a project network. The network is connected to a Neutron router that provides outbound access and inbound access via floating IPs. Concepts explained in earlier chapters can be used to build this topology.</p>
<p>To eliminate the installation and configuration of a web server, you can mimic the behavior of one by using the <kbd><span class="CodeInTextPACKT">SimpleHTTPServer</span></kbd><span class="CodeInTextPACKT"> </span>Python module on the instances, as shown here:</p>
<pre>ubuntu@web1:~$ echo "This is web1" &gt; ~/index.html<br/>ubuntu@web1:~$ sudo python -m SimpleHTTPServer 80<br/>Serving HTTP on 0.0.0.0 port 80 ... </pre>
<p>Repeat the mentioned commands for the second instance, substituting <span class="CodeInTextPACKT">web2</span> for <span class="CodeInTextPACKT">web1</span> in the <span class="CodeInTextPACKT"><kbd>index.html</kbd> </span>file.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a load balancer</h1>
                </header>
            
            <article>
                
<p>The first step to building a functional load balancer is to first create the load balancer object. With the <span class="CodeInTextPACKT">neutron</span> client, create a load balancer object with the following attributes:</p>
<ul>
<li>Name: <kbd>LB_WEB</kbd></li>
<li>Subnet ID: &lt;Subnet ID of the pool members&gt;</li>
</ul>
<p>The following command can be used:</p>
<pre><strong>neutron lbaas-loadbalancer-create PROJECT_SUBNET --name LB_WEB</strong> </pre>
<p>The output will resemble the following:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/3d4d2c64-d28d-4b8f-8ba0-f259384caab8.png" style="width:55.00em;height:28.00em;"/></div>
<p>When a load balancer is created, OpenStack assigns an IP address known as a virtual IP, or VIP. The VIP will be used by clients to access the load-balanced application. Creating a load balancer object is only the first step in load balancing traffic to instances.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a pool</h1>
                </header>
            
            <article>
                
<p>Pools are associated with load balancers and are objects that represent a collection of instances that receive traffic sent to the VIP. With the <span class="CodeInTextPACKT">neutron</span> client, create a pool with the following attributes:</p>
<ul>
<li>Name: <kbd><span class="CodeInTextPACKT">WEB_POOL</span></kbd></li>
<li>Load balancing method: <kbd><span class="CodeInTextPACKT">ROUND_ROBIN</span></kbd></li>
<li>Protocol: <span class="CodeInTextPACKT">HTTP</span></li>
<li>Subnet ID: &lt;Subnet ID where pool members reside&gt;</li>
</ul>
<p class="mce-root"/>
<p class="mce-root"/>
<p>The following command can be used:</p>
<pre><strong>neutron lbaas-pool-create \<br/></strong><strong>--lb-algorithm ROUND_ROBIN \<br/></strong><strong>--protocol HTTP \<br/></strong><strong>--loadbalancer LB_WEB \<br/></strong><strong>--name POOL_WEB</strong> </pre>
<p>The output will resemble the following:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/049eaf3f-adae-4d27-9606-6d77c7bccd9a.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating pool members</h1>
                </header>
            
            <article>
                
<p>The next step to building a functional load balancer is to create and associate pool members with the pool. Pool members are objects that represent a backend application listening on a particular IP and port.</p>
<p class="mce-root"/>
<p>In this environment, there are two instances eligible for use in the pool:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/dd9ee459-1bf2-4b0e-a02e-be71c659f30c.png"/></div>
<p>With the <span class="CodeInTextPACKT">neutron</span> client, create pool members with the following attributes:</p>
<table border="1" style="border-collapse: collapse;width: 100%">
<tbody>
<tr>
<td>
<p class="TableColumnHeadingPACKT CDPAlignCenter CDPAlign"><strong>Name</strong></p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p class="TableColumnHeadingPACKT"><strong>Address</strong></p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p class="TableColumnHeadingPACKT"><strong>Port</strong></p>
</td>
<td>
<p class="TableColumnHeadingPACKT CDPAlignCenter CDPAlign"><strong>Pool</strong></p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT">web1</p>
</td>
<td>
<p class="TableColumnContentPACKT">192.168.200.9</p>
</td>
<td>
<p class="TableColumnContentPACKT">80</p>
</td>
<td>
<p class="TableColumnContentPACKT"><kbd>POOL_WEB</kbd></p>
</td>
</tr>
<tr>
<td>
<p class="TableColumnContentPACKT">web2</p>
</td>
<td>
<p class="TableColumnContentPACKT">192.168.200.7</p>
</td>
<td>
<p class="TableColumnContentPACKT">80</p>
</td>
<td>
<p class="TableColumnContentPACKT"><kbd>POOL_WEB</kbd></p>
</td>
</tr>
</tbody>
</table>
<p>The following screenshot demonstrates the process of creating the first pool member:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/d71cf013-196f-4168-801d-2d076d78c99c.png" style="width:44.67em;height:28.92em;"/></div>
<p>Repeat the process shown in the preceding screenshot to create the second pool member, as shown here:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/289f753e-3452-43b3-b99c-253a9470f246.png" style="width:35.75em;height:23.33em;"/></div>
<p>The <span class="CodeInTextPACKT"><kbd>neutron lbaas-member-list</kbd> command </span>can be used to return the pool members for the <kbd><span class="CodeInTextPACKT">POOL_WEB</span></kbd> pool:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/ac020f8d-26ce-4856-aee4-55879eb625f2.png" style="width:56.58em;height:9.17em;"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a health monitor</h1>
                </header>
            
            <article>
                
<p>To provide high availability of an application to clients, it is recommended to create and apply a health monitor to a pool. Without a monitor, the load balancer will continue to send traffic to members that may not be available.</p>
<p>Using the <span class="CodeInTextPACKT"><kbd>neutron lbaas-healthmonitor-create</kbd> </span>command, create a health monitor with the following attributes:</p>
<ul>
<li>Name: <kbd><span class="CodeInTextPACKT">MONITOR_WEB</span></kbd></li>
<li>Delay: <kbd><span class="CodeInTextPACKT">5</span></kbd></li>
<li>Max retries:<kbd><span class="CodeInTextPACKT">3</span></kbd></li>
<li>Timeout: <kbd><span class="CodeInTextPACKT">4</span></kbd></li>
<li>Type: <kbd><span class="CodeInTextPACKT">TCP</span></kbd></li>
<li>Pool: <kbd><span class="CodeInTextPACKT">POOL_WEB</span></kbd></li>
</ul>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/c5a28c88-67c5-495b-895d-7a3182eb08d0.png" style="width:37.00em;height:29.75em;"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a listener</h1>
                </header>
            
            <article>
                
<p>The last step in creating a function load balancer is to create the listener. Using the <kbd><span class="CodeInTextPACKT">neutron lbaas-listener-create</span></kbd> command, create a listener with the following attributes:</p>
<ul>
<li>Name: <kbd><span class="CodeInTextPACKT">LISTENER_WEB</span></kbd></li>
<li>Port: <kbd><span class="CodeInTextPACKT">80</span></kbd></li>
<li>Protocol: <kbd><span class="CodeInTextPACKT">HTTP</span></kbd></li>
<li>Pool: <kbd><span class="CodeInTextPACKT">POOL_WEB</span></kbd></li>
</ul>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/82c57729-641d-4686-8e3d-90c168536365.png" style="width:45.33em;height:29.42em;"/></div>
<p>Multiple listeners can be created for each load balancer, allowing users to balance traffic for multiple protocols and applications on the same Virtual IP.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The LBaaS network namespace</h1>
                </header>
            
            <article>
                
<p>A listing of the network namespaces on the host running the LBaaS v2 agent reveals a network namespace that corresponds to the load balancer we just created:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/fb08f1d1-2b03-40c5-aff6-5dcc35912979.png" style="width:33.58em;height:7.67em;"/></div>
<p>The IP configuration within the namespace reveals an interface that corresponds to the subnet of the virtual IP:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/b1346693-1084-42d0-9372-ec3b44c0ca3c.png" style="width:46.50em;height:12.33em;"/></div>
<p>Neutron creates an HAProxy configuration file specific to every load balancer that is created by users. The load balancer configuration files can be found in the <span class="CodeInTextPACKT"><kbd>/var/lib/neutron/lbaas/v2/</kbd> </span>directory on the host(s) running the LBaaS v2 agent.</p>
<p>The configuration file for this load balancer built by Neutron can be seen in the following screenshot:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/5b03b7e2-6369-4d0d-b303-896c46cec8f0.png" style="width:41.08em;height:26.25em;"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Confirming load balancer functionality</h1>
                </header>
            
            <article>
                
<p>From within the <kbd>qlbaas</kbd><span class="CodeInTextPACKT"> </span>namespace, confirm direct connectivity to <span class="CodeInTextPACKT"><kbd>web1</kbd> </span>and <span class="CodeInTextPACKT"><kbd>web2</kbd> by </span>using <span class="CodeInTextPACKT">curl</span>:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/b7beb5f0-3f0f-46d3-86bd-690126021913.png" style="width:61.25em;height:7.08em;"/></div>
<p>By connecting to the VIP address rather than the individual pool members, you can observe the default round-robin load balancing algorithm in effect:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/b2d15168-8d9e-465e-9fad-b384eb413ea4.png" style="width:51.25em;height:9.00em;"/></div>
<p>With round-robin load balancing, every connection is evenly distributed among the two pool members.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Observing health monitors</h1>
                </header>
            
            <article>
                
<p>A packet capture on <kbd><span class="CodeInTextPACKT">web1</span></kbd> reveals that the load balancer is performing TCP health checks every 5 seconds:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/9c8d2ceb-a751-430d-ada7-f234b6e4d829.png" style="width:30.75em;height:31.17em;"/></div>
<p>In the preceding output, the load balancer is initiating a connection every 5 seconds and performing the health check prescribed by the health monitor: "a <span class="CodeInTextPACKT">G</span><span class="CodeInTextPACKT">ET </span>request: against<span class="CodeInTextPACKT">/".</span></p>
<p>To observe the monitor removing a pool member from eligibility, stop the web service on <kbd><span class="CodeInTextPACKT">web1</span></kbd> and observe the packet captures on <span class="CodeInTextPACKT"><kbd>web1</kbd> </span>and logs on the <kbd>controller</kbd> node:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/000019a5-b95f-4dfa-92db-e685f8aa2bfd.png" style="width:47.83em;height:13.83em;"/></div>
<p>In the preceding output, the web service is stopped and connections to port <kbd>80</kbd> are refused. Immediately following the third failure, the load balancer marks the pool member as <kbd><span class="CodeInTextPACKT">DOWN</span></kbd>:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/bb02ad35-3f36-4c76-9b98-0ddc49c545a4.png" style="width:55.25em;height:5.75em;"/></div>
<p>While <kbd><span class="CodeInTextPACKT">web1</span></kbd> is down, all subsequent connections to the VIP are sent to <kbd><span class="CodeInTextPACKT">web2</span></kbd>:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/e5ed0060-1ecb-4989-812d-e365583f7a0e.png" style="width:56.83em;height:10.58em;"/></div>
<p>After restarting the web service on <kbd><span class="CodeInTextPACKT">web1</span></kbd>, the load balancer places the server back in the pool upon the next successful health check:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/f8d45c44-ce0e-4145-a7ef-f17523058617.png"/></div>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Connecting to the virtual IP externally</h1>
                </header>
            
            <article>
                
<p>To connect to a virtual IP externally, a floating IP must be associated with the VIP since the virtual IP exists within a subnet behind the router and is not reachable directly.</p>
<p class="mce-root"/>
<p class="mce-root"/>
<p>Using the <span class="CodeInTextPACKT"><kbd>openstack floating ip create</kbd> </span>command, assign a floating IP to be used with the virtual IP:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/af964d0b-5353-41db-8b15-86234e9603b7.png" style="width:43.92em;height:17.00em;"/></div>
<p>A test from a workstation to the floating IP confirms external connectivity to the load balancer and its pool members:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/9d5cf858-b4d5-4ef0-87d6-398ec2ca1221.png" style="width:25.58em;height:10.08em;"/></div>
<div class="packt_tip">If the connection is not successful, be sure to confirm security groups allow connections to port 80.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Load balancer management in the dashboard</h1>
                </header>
            
            <article>
                
<p>Out of the box, the LBaaS panels for load balancer management in Horizon are not installed. To install the panels, perform the following:</p>
<p>On the controller node, install the <kbd><span class="CodeInTextPACKT">python-neutron-lbaas-dashboard</span></kbd><a><span class="CodeInTextPACKT"> </span></a>package:</p>
<pre><strong><span># apt install <span class="CodeInTextPACKT">python-neutron-lbaas-dashboard</span></span></strong> </pre>
<p><span>Then, update the OpenStack Dashboard configuration file at</span> <kbd><span class="CodeInTextPACKT">/etc/openstack-dashboard/local_settings.py</span></kbd> to enable the panels. Search for <kbd><span class="CodeInTextPACKT">enable_lb</span></kbd> in the <kbd><span class="CodeInTextPACKT">OPENSTACK_NEUTRON_NETWORK</span></kbd> dictionary and change the value from <span class="CodeInTextPACKT">False</span> to <span class="CodeInTextPACKT">True</span>:</p>
<pre>OPENSTACK_NEUTRON_NETWORK = {<br/>    'enable_router': True,<br/>    'enable_quotas': False,<br/>    'enable_ipv6': False,<br/>    'enable_distributed_router': False,<br/>    'enable_ha_router': False,<br/>    'enable_lb': True,<br/>    'enable_firewall': False,<br/>    'enable_vpn': False,<br/>    'enable_fip_topology_check': False,<br/>} </pre>
<p>Lastly, restart the Apache service:</p>
<pre><strong><span># systemctl restart apache2</span></strong> </pre>
<p><span>Once the panels have been installed and activated, load balancers can be managed from the <span class="ScreenTextPACKT"><span class="packt_screen">Project</span> </span>panel by clicking on <span class="ScreenTextPACKT"><span class="packt_screen">Network | Load Balancers</span> </span>in the menu on the left-hand side of the screen:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/1d8086f0-e818-4d13-beea-0c61960ca6b7.png"/></p>
<p class="mce-root"/>
<p>In Horizon, load balancers are created and managed as a single entity that includes pool, members, and monitors. This is unlike LBaaS v1, where members and monitors may have been managed separately in their own panel.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a load balancer in the dashboard</h1>
                </header>
            
            <article>
                
<p>To create a load balancer, perform the following steps:</p>
<ol>
<li><span>Click on the <span class="ScreenTextPACKT"><span class="packt_screen">Create Load Balancer</span></span> button within the <span class="ScreenTextPACKT"><span class="packt_screen">Load Balancers</span></span> panel. A wizard will appear that resembles the one shown in the following screenshot:</span></li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/add02b45-07c5-4816-9403-ba6677215122.png" style="width:63.00em;height:22.58em;"/></div>
<ol start="2">
<li>From the <span><span class="ScreenTextPACKT"><span class="packt_screen">Load Balancer Details</span></span> panel, you can enter a name for the load balancer, a description, an IP address, and select the respective subnet for the Virtual IP:</span></li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/764a655d-6ccc-457e-b3f0-2559648c02d4.png" style="width:65.83em;height:23.67em;"/></div>
<ol start="3">
<li>From <span>the <span class="ScreenTextPACKT"><span class="packt_screen">Listen</span></span><span class="ScreenTextPACKT"><span class="packt_screen">er</span></span> panel, you can enter a name for the listener, a description, and choose the protocol and port:</span></li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/a9f8919c-a7a7-440b-a440-d26b2ab09761.png"/></div>
<ol start="4">
<li>From <span>the</span> <span class="packt_screen">Pool Details</span> <span>panel, you can enter a name for the pool, a description, and select the load balancing method:</span></li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/65fc8a79-4c9e-4aaa-b98c-2c8e0edf7f95.png"/></div>
<ol start="5">
<li><span>From the <span class="ScreenTextPACKT"><span class="packt_screen">Pool Members</span></span> panel, you can select the pool members that will make up the pool:</span></li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/2e8fd671-c741-4e2c-b301-92c63595c928.png" style="width:32.92em;height:16.25em;"/></div>
<ol start="6">
<li>Click th<span>e <span class="ScreenTextPACKT"><span class="packt_screen">Add</span></span> button next to the pool member to add it to the pool:</span></li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/3c61baa6-9c5c-4161-be50-354d71015fa9.png" style="width:41.25em;height:31.83em;"/></div>
<ol start="7">
<li>From <span>the <span class="ScreenTextPACKT"><span class="packt_screen">Monitor Details</span></span> panel, you can set the monitor type, interval, retries, and timeout values:</span></li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/74b97bfc-d11a-4a03-aef1-74eb09915024.png"/></div>
<ol start="8">
<li>Once <span>the load balancer has been configured, click the blue <span class="ScreenTextPACKT"><span class="packt_screen">Create Load Balancer</span></span> button to complete the wizard. The load balancer will appear in the list of load balancers:</span></li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/6ddcf652-12e8-4001-b769-2f78b16b7fa7.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Assigning a floating IP to the load balancer</h1>
                </header>
            
            <article>
                
<p>To assign a floating IP to a load balancer within the Horizon dashboard:</p>
<ol>
<li><span>Click the arrow under the <span class="packt_screen">Actions</span> menu next to the load balancer and select <span class="ScreenTextPACKT"><span class="packt_screen">Associate Floating IP</span></span>:</span></li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/ba43f384-9fa6-4e67-9072-dda1382b23fd.png"/></div>
<ol start="2">
<li>A wizard will pop up that allows you to select an existing floating IP or a network from which a new one can be created:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/b858df0d-e6d9-4117-84f3-c4aaf758a99a.png" style="width:56.42em;height:19.75em;"/></div>
<ol start="3">
<li><span>Once a floating IP or network has been chosen, click on the blue <span class="ScreenTextPACKT"><span class="packt_screen">Associate</span></span> button to associate the floating IP with the virtual IP of the load balancer.</span></li>
</ol>
<p>The load balancer details will be updated to reflect the new floating IP.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>Load-balancing-as-a-Service provides users with the ability to scale their application programmatically through the Neutron API. Users can balance traffic to pools consisting of multiple application servers and can provide high availability of their application through the use of intelligent health monitors. The LBaaS v2 API even supports SSL offloading with certificates managed by Barbican, another OpenStack project, as well as certificate bundles and SNI support.</p>
<p>The HAProxy driver offers functionality that can address basic load balancing needs, but may not be enough for most production environments. The load balancers are not highly-available and may present a weakness in the application's network architecture. The use of Octavia over the HAProxy driver is recommended for production-grade clouds and is compatible with the LBaaS v2 API.</p>
<p>More information on Octavia and how it may be implemented can be found at the following URL: <span class="URLPACKT"><a href="https://docs.openstack.org/octavia/pike/reference/introduction.html">https://docs.openstack.org/octavia/pike/reference/introduction.html</a>.</span></p>
<p>In the next chapter, we will take a look at a few other advanced Neutron features, including 802.1q VLAN tagging (vlan-aware-vms) and BGP speaker functionality.</p>


            </article>

            
        </section>
    </body></html>