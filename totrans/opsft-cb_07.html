<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Chapter&#xA0;7.&#xA0;OpenShift for Java Developers"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch07" class="calibre1"/>Chapter 7. OpenShift for Java Developers</h1></div></div></div><p class="calibre6">This chapter presents a number of recipes that show you how to get started with Java web application development on OpenShift. You will learn how to create and deploy <span class="strong"><strong class="calibre7">Java Enterprise Edition</strong></span> (<span class="strong"><strong class="calibre7">Java EE</strong></span>) <a id="id565" class="calibre1"/>applications on OpenShift using the JBoss EAP 6 and JBoss AS 7 application server cartridges. This chapter will also cover how to develop and host your Spring Framework applications on the Tomcat server. The specific recipes within this chapter are as follows:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Creating and deploying Java EE 6 applications using the JBoss EAP and PostgreSQL 9.2 cartridges</li><li class="listitem">Configuring application security by defining the database login module in standalone.xml</li><li class="listitem">Installing modules with JBoss cartridges</li><li class="listitem">Managing JBoss cartridges using the management web interface and CLI</li><li class="listitem">Creating and deploying Spring applications using the Tomcat 7 cartridge</li><li class="listitem">Taking thread dumps of Java cartridges</li><li class="listitem">Choosing between Java 6 and Java 7</li><li class="listitem">Enabling hot deployment for Java applications</li><li class="listitem">Skipping the Maven build</li><li class="listitem">Forcing a clean Maven build</li><li class="listitem">Overriding the default Maven build command</li><li class="listitem">Installing the JAR file not present in the Maven central repository</li><li class="listitem">Developing OpenShift Java applications using Eclipse</li><li class="listitem">Using Eclipse System Explorer to SSH into the application gear</li><li class="listitem">Debugging Java applications in the Cloud</li></ul></div></div>

<div class="book" title="Chapter&#xA0;7.&#xA0;OpenShift for Java Developers">
<div class="book" title="Introduction"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch07lvl1sec83" class="calibre1"/>Introduction</h1></div></div></div><p class="calibre6">This chapter will explore how Java developers can get started with OpenShift to develop Java EE or Spring applications. Java is often thought of as the de facto open source, enterprise programming language. OpenShift supports the JBoss application server, which is a certified platform for Java EE 6 development. As an OpenShift Online user, you have access to both the community version of JBoss and commercial JBoss EAP 6 for free. The <span class="strong"><em class="calibre10">Creating and deploying Java EE 6 applications using the JBoss EAP and PostgreSQL 9.2 cartridges</em></span> recipe will cover how to develop and deploy Java EE 6 applications on OpenShift. There is also a community-supported cartridge for WildFly, a certified Java EE 7 application server that you can use to deploy Java EE 7 applications. This chapter will not cover the WildFly cartridge.</p><p class="calibre6">A popular alternative to Java EE development is Spring Framework. Spring developers normally <a id="id566" class="calibre1"/>use Apache Tomcat<a id="id567" class="calibre1"/> to host their applications. OpenShift supports two versions of Tomcat: Apache Tomcat 6 and Apache Tomcat 7. The <span class="strong"><em class="calibre10">Creating and deploying Spring applications using the Tomcat 7 cartridge</em></span> recipe will cover how to develop a Spring application and deploy it on OpenShift. Also, it is possible to run Apache Tomcat 8 (currently in beta) on OpenShift. You can read my blog to learn how to deploy Apache Tomcat 8<a id="id568" class="calibre1"/> on OpenShift at <a class="calibre1" href="https://www.openshift.com/blogs/how-to-run-apache-tomcat-8-on-openshift">https://www.openshift.com/blogs/how-to-run-apache-tomcat-8-on-openshift</a>.</p><p class="calibre6">OpenShift uses Apache Maven to manage dependencies and build your OpenShift apps. All OpenShift Java applications are Maven-based applications. This chapter assumes that you are familiar with Apache Maven. In<a id="id569" class="calibre1"/> the event that you are not comfortable with Maven, then please refer to the documentation at <a class="calibre1" href="http://maven.apache.org/guides/getting-started/index.html">http://maven.apache.org/guides/getting-started/index.html</a>. This chapter will cover various aspects of using Apache Maven with OpenShift, such as how to use your own JARs (not hosted on the Maven central repository) with OpenShift, and so on. OpenShift also allows you to use other build tools, such as Apache Ant and Gradle. Please refer to my blogs on<a id="id570" class="calibre1"/> Apache Ant (<a class="calibre1" href="https://www.openshift.com/blogs/running-ant-builds-on-openshift">https://www.openshift.com/blogs/running-ant-builds-on-openshift</a>) and Gradle (<a class="calibre1" href="https://www.openshift.com/blogs/run-gradle-builds-on-openshift">https://www.openshift.com/blogs/run-gradle-builds-on-openshift</a>) to learn how to use them with OpenShift applications.</p><p class="calibre6">Almost all Java developers use an IDE to build their applications. OpenShift has first-class support for the Eclipse IDE. The <span class="strong"><em class="calibre10">Developing OpenShift Java applications using Eclipse</em></span> recipe will walk you through a step-by-step process of creating and managing an application from within Eclipse. You can even SSH into the application gear from within Eclipse. This will be covered in the <span class="strong"><em class="calibre10">Using Eclipse System Explorer to SSH into the application gear </em></span>recipe.</p><p class="calibre6">If you want to run the examples on your local machine, then please install Java 7, Apache Maven, and Eclipse. The instructions to install Java for your operating system<a id="id571" class="calibre1"/> can be found at <a class="calibre1" href="http://www.java.com/en/download/help/download_options.xml">http://www.java.com/en/download/help/download_options.xml</a>. Next, instructions to install Apache Maven<a id="id572" class="calibre1"/> can be found here: <a class="calibre1" href="http://maven.apache.org/download.cgi#Installation">http://maven.apache.org/download.cgi#Installation</a>. Finally, you can install Eclipse<a id="id573" class="calibre1"/> on your machine by following the instructions mentioned here: <a class="calibre1" href="http://wiki.eclipse.org/Eclipse/Installation">http://wiki.eclipse.org/Eclipse/Installation</a>.</p><p class="calibre6">This chapter is based on the assumption that you know the basics of OpenShift application development and database cartridges. In the event that you are not comfortable with the basics, I will recommend that you first read <a class="calibre1" title="Chapter 3. Creating and Managing Applications" href="part0041_split_000.html#page">Chapter 3</a>, <span class="strong"><em class="calibre10">Creating and Managing Applications</em></span> to <a class="calibre1" title="Chapter 6. Using MongoDB and Third-party Database Cartridges with OpenShift Applications" href="part0079_split_000.html#page">Chapter 6</a>, <span class="strong"><em class="calibre10">Using MongoDB and Third-party Database Cartridges with OpenShift Applications</em></span> before continuing with this chapter.</p><p class="calibre6">In this chapter, we will develop a simple job portal application that will allow users to post job openings for a company. Users can create a company and then post jobs for that company. All the source code is on the <span class="strong"><em class="calibre10">OpenShift-Cookbook</em></span> repository of the GitHub organization at <a class="calibre1" href="https://github.com/OpenShift-Cookbook">https://github.com/OpenShift-Cookbook</a>.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Creating and deploying Java EE 6 applications using the JBoss EAP and PostgreSQL 9.2 cartridges"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch07lvl1sec84" class="calibre1"/>Creating and deploying Java EE 6 applications using the JBoss EAP and PostgreSQL 9.2 cartridges</h1></div></div></div><p class="calibre6">Gone are the days <a id="id574" class="calibre1"/>when Java EE or J2EE (as it was called in the olden days) was <a id="id575" class="calibre1"/>considered <a id="id576" class="calibre1"/>evil. Java EE <a id="id577" class="calibre1"/>now provides a very productive environment to build web applications. Java EE has embraced convention over configuration and annotations, which means that you are no longer required to maintain XML to configure each and every component. In this recipe, you will learn how to build a Java EE 6 application and deploy it on OpenShift. This recipe assumes that you have basic knowledge of Java and Java EE 6. If you are not comfortable with Java EE 6, please read the official <a id="id578" class="calibre1"/>tutorial at <a class="calibre1" href="http://docs.oracle.com/javaee/6/tutorial/doc/">http://docs.oracle.com/javaee/6/tutorial/doc/</a>.</p><p class="calibre6">In this recipe, you will build a simple job portal that will allow users to post job openings and view a list of all the persisted jobs in the system. These two functionalities will be exposed using two REST endpoints.</p><p class="calibre6">The source code for the application created in this recipe is on GitHub at <a class="calibre1" href="https://github.com/OpenShift-Cookbook/chapter7-jobstore-javaee6-simple">https://github.com/OpenShift-Cookbook/chapter7-jobstore-javaee6-simple</a>. The example application that you will build in this recipe is a simple version of the <code class="email">jobstore</code> application with only a single domain class and without any application interface. You can get the complete <code class="email">jobstore</code> application source code on GitHub as well at <a class="calibre1" href="https://github.com/OpenShift-Cookbook/chapter7-jobstore-javaee6">https://github.com/OpenShift-Cookbook/chapter7-jobstore-javaee6</a>.</p></div>

<div class="book" title="Creating and deploying Java EE 6 applications using the JBoss EAP and PostgreSQL 9.2 cartridges">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch07lvl2sec327" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To complete this recipe, you will need the <code class="email">rhc</code> command-line client installed on your machine. Please refer to the <span class="strong"><em class="calibre10">Installing the OpenShift rhc command-line client</em></span> recipe in <a class="calibre1" title="Chapter 1. Getting Started with OpenShift" href="part0014_split_000.html#page">Chapter 1</a>, <span class="strong"><em class="calibre10">Getting Started with OpenShift</em></span>, for details. Also, you will need an IDE to work with the application code. The recommended IDE to work with OpenShift is Eclipse Luna, but you can also work with other IDEs, such as IntelliJ Idea and NetBeans. Download and install the Eclipse IDE for Java EE developers<a id="id579" class="calibre1"/> from the official website at <a class="calibre1" href="https://www.eclipse.org/downloads/">https://www.eclipse.org/downloads/</a>.</p></div></div>

<div class="book" title="Creating and deploying Java EE 6 applications using the JBoss EAP and PostgreSQL 9.2 cartridges">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch07lvl2sec328" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Perform the following steps to<a id="id580" class="calibre1"/> create the <code class="email">jobstore</code> application:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open a new <a id="id581" class="calibre1"/>command-line<a id="id582" class="calibre1"/> terminal, and go to a <a id="id583" class="calibre1"/>convenient<a id="id584" class="calibre1"/> location. Create a new JBoss EAP application by executing the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc create-app jobstore jbosseap-6</strong></span>
</pre></div></li><li class="listitem" value="2">The preceding command will create a Maven project and clone it to your local machine.</li><li class="listitem" value="3">Change the directory to <code class="email">jobstore</code>, and execute the following command to add the PostgreSQL 9.2 cartridge to the application:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridge-add postgresql-9.2</strong></span>
</pre></div></li><li class="listitem" value="4">Open Eclipse and navigate to the project workspace. Then, import the application created in step 1 as a Maven project. To import an existing Maven project, navigate to <span class="strong"><strong class="calibre7">File</strong></span>|<span class="strong"><strong class="calibre7">Import</strong></span>|<span class="strong"><strong class="calibre7">Maven</strong></span>|<span class="strong"><strong class="calibre7">Existing Maven Projects</strong></span>. Then, navigate to the location of your OpenShift Maven application created in step 1.</li><li class="listitem" value="5">Next, update <code class="email">pom.xml</code> to use Java 7. The Maven project created by OpenShift is configured to use JDK 6. Replace the properties with the one shown in the following code:<div class="informalexample"><pre class="programlisting">&lt;maven.compiler.source&gt;1.7&lt;/maven.compiler.source&gt;
&lt;maven.compiler.target&gt;1.7&lt;/maven.compiler.target&gt;</pre></div></li><li class="listitem" value="6">Update the Maven project to allow the changes to take effect. You can update the Maven project by right-clicking on the project and navigating to <span class="strong"><strong class="calibre7">Maven</strong></span>|<span class="strong"><strong class="calibre7">Update Project</strong></span>.</li><li class="listitem" value="7">Now, let us write the domain classes for our application. Java EE uses JPA to define the data model and manage entities. The application has one domain class: <code class="email">Job</code>. Create a new package called <code class="email">org.osbook.jobstore.domain</code>, and then create <a id="id585" class="calibre1"/>a new Java class <a id="id586" class="calibre1"/>called <code class="email">Job</code> inside it. Have<a id="id587" class="calibre1"/> a look <a id="id588" class="calibre1"/>at the following code:<div class="informalexample"><pre class="programlisting">@Entity
public class Job {

@Id
@GeneratedValue(strategy = GenerationType.AUTO)
private Long id;

@NotNull
private String title;

@NotNull
@Size(max = 4000)
private String description;

@Column(updatable = false)
@Temporal(TemporalType.DATE)
@NotNull
private Date postedAt = new Date();

@NotNull
private String company;

//setters and getters removed for brevity

}</pre></div></li><li class="listitem" value="8">Create a <code class="email">META-INF</code> folder <a id="id589" class="calibre1"/>at <code class="email">src/main/resources</code>, and then create a <code class="email">persistence.xml</code> file with the following code:<div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;persistence 
xsi:schemaLocation="http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd"
version="2.0"&gt;

&lt;persistence-unit name="jobstore" transaction-type="JTA"&gt;
&lt;provider&gt;org.hibernate.ejb.HibernatePersistence&lt;/provider&gt;
&lt;jta-data-source&gt;java:jboss/datasources/PostgreSQLDS&lt;/jta-data-source&gt;

&lt;exclude-unlisted-classes&gt;false&lt;/exclude-unlisted-classes&gt;

&lt;properties&gt;
&lt;property name="hibernate.show_sql" value="true" /&gt;
&lt;property name="hibernate.hbm2ddl.auto"value="update" /&gt;
&lt;/properties&gt;
&lt;/persistence-unit&gt;

&lt;/persistence&gt;</pre></div></li><li class="listitem" value="9">Now, we will<a id="id590" class="calibre1"/> create the <code class="email">JobService</code> class <a id="id591" class="calibre1"/>that will use the JPA <code class="email">EntityManager</code> API to work with the database. Create a new<a id="id592" class="calibre1"/> package called <code class="email">org.osbook.jobstore.services</code>, and create a new Java class as shown in the following code. It <a id="id593" class="calibre1"/>defines the <code class="email">save</code><a id="id594" class="calibre1"/> and <code class="email">findAll </code>operations on the <code class="email">Job</code> entity.<div class="informalexample"><pre class="programlisting">@Stateless
public class JobService {

@PersistenceContext(unitName = "jobstore")
private EntityManager entityManager;

public Job save(Job job) {
entityManager.persist(job);
return job;
}

public List&lt;Job&gt; findAll() {
return entityManager
.createQuery("SELECT j from org.osbook.jobstore.domain.Job j order by j.postedAt desc", Job.class)
.getResultList();
}
}</pre></div></li><li class="listitem" value="10">Next, enable <span class="strong"><strong class="calibre7">Contexts and Dependency Injection</strong></span> (<span class="strong"><strong class="calibre7">CDI</strong></span>)<a id="id595" class="calibre1"/> in the <code class="email">jobstore</code> application by creating a file with the name <code class="email">beans.xml</code> in the <code class="email">src/main/webapp/WEB-INF</code> directory as follows:<div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0"?&gt;
&lt;beans 
 xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://jboss.org/schema/cdi/beans_1_0.xsd"/&gt;</pre></div></li><li class="listitem" value="11">The <code class="email">jobstore</code> application<a id="id596" class="calibre1"/> will expose the <a id="id597" class="calibre1"/>REST JSON <a id="id598" class="calibre1"/>web service. Before you can write the JAX-RS resources, you have to configure<a id="id599" class="calibre1"/> JAX-RS in your application. Create a new package called <code class="email">org.osbook.jobstore.rest</code> and a new class<a id="id600" class="calibre1"/> called <code class="email">RestConfig</code>, as shown in the following code:<div class="informalexample"><pre class="programlisting">@ApplicationPath("/api/v1")
public class RestConfig extends Application {
}</pre></div></li><li class="listitem" value="12">Create a JAX-RS resource to expose the <code class="email">create</code> and <code class="email">findAll </code>operations of <code class="email">JobService</code> as REST endpoints as follows:<div class="informalexample"><pre class="programlisting">@Path("/jobs")
public class JobResource {

@Inject
private JobService jobService;

@POST
@Consumes(MediaType.APPLICATION_JSON)
public Response createNewJob(@Valid Job job) {
job = jobService.save(job);
return Response.status(Status.CREATED).build();
}

@GET
@Produces(MediaType.APPLICATION_JSON)
public List&lt;Job&gt; showAll() {
return jobService.findAll();
}
}</pre></div></li><li class="listitem" value="13">Commit the <a id="id601" class="calibre1"/>code, and push it to the OpenShift application as shown in the following commands:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ git add .</strong></span>
<span class="strong"><strong class="calibre7">$ git commit -am "jobstore application created"</strong></span>
<span class="strong"><strong class="calibre7">$ git push</strong></span>
</pre></div></li><li class="listitem" value="14">After the build finishes successfully, the application will be accessible at <code class="email">http://jobstore-{domain-name}.rhcloud.com</code>. Please replace <code class="email">domain-name</code> with your own domain name.</li><li class="listitem" value="15">To test the REST endpoints, you can use <code class="email">curl</code>. <code class="email">curl</code> is a command-line tool for transferring data across various protocols. We will use it to test our REST endpoints. To create a new job, you will run the following <code class="email">curl</code> command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ curl -i -X POST -H "Content-Type: application/json" -H "Accept: application/json" -d '{"title":"OpenShift Evangelist","description":"OpenShift Evangelist","company":"Red Hat"}'http://jobstore-{domain-name}.rhcloud.com/api/v1/jobs</strong></span>
</pre></div></li><li class="listitem" value="16">To view all the jobs, you can run the following <code class="email">curl</code> command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ curl http://jobstore-{domain-name}.rhcloud.com/api/v1/jobs</strong></span>
</pre></div></li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Creating and deploying Java EE 6 applications using the JBoss EAP and PostgreSQL 9.2 cartridges">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch07lvl2sec329" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">In the preceding steps, we created a Java EE application and <a id="id602" class="calibre1"/>deployed it on OpenShift. In step 1, you <a id="id603" class="calibre1"/>used the <code class="email">rhc create-app</code> command to create a JBoss EAP web cartridge application. The <code class="email">rhc</code> command-line tool makes<a id="id604" class="calibre1"/> a request to the OpenShift broker and asks it to create a new application using the JBoss EAP <a id="id605" class="calibre1"/>cartridge. The anatomy of application creation was explained in the <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe in <a class="calibre1" title="Chapter 3. Creating and Managing Applications" href="part0041_split_000.html#page">Chapter 3</a>, <span class="strong"><em class="calibre10">Creating and Managing Applications</em></span>. Every OpenShift web cartridge specifies a template application that will be used as the default source code of the application. For Java web cartridges (JBoss EAP, JBoss AS7, Tomcat 6, and Tomcat 7), the template is a Maven-based application. After the application is created, it is cloned to the local machine using Git. The directory structure of the application is shown in the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ ls -a</strong></span>
<span class="strong"><strong class="calibre7">.git .openshift README.md pom.xml deployments src</strong></span>
</pre></div><p class="calibre6">As you can see in the preceding command, apart from the <code class="email">.git</code> and <code class="email">.openshift</code> directories, this looks like a standard Maven project. OpenShift uses Maven to manage application dependencies and build your Java applications.</p><p class="calibre6">Let us take a look at what's inside the <code class="email">jobstore</code> directory to better understand the layout of the application:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre7">The src directory</strong></span>: This <a id="id606" class="calibre1"/>directory contains the source code for the template application generated by OpenShift. You need to add your application source code here. The <code class="email">src</code> folder helps in achieving source code deployment when following the standard Maven directory conventions.</li><li class="listitem"><span class="strong"><strong class="calibre7">The pom.xml file</strong></span>: The Java <a id="id607" class="calibre1"/>applications created by OpenShift are Maven-based projects. So, a <code class="email">pom.xml</code> file is required when you do source code deployment on OpenShift. This <code class="email">pom.xml</code> file has a profile called <code class="email">openshift</code>, which will be executed when you push code to OpenShift as shown in the following code. This profile will create a <code class="email">ROOT</code> WAR file based upon your application source code.<div class="informalexample"><pre class="programlisting">&lt;profiles&gt;
&lt;profile&gt;
&lt;id&gt;openshift&lt;/id&gt;
&lt;build&gt;
&lt;finalName&gt;jobstore&lt;/finalName&gt;
&lt;plugins&gt;
&lt;plugin&gt;
&lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;
&lt;version&gt;2.1.1&lt;/version&gt;
&lt;configuration&gt;
&lt;outputDirectory&gt;deployments&lt;/outputDirectory&gt;
&lt;warName&gt;ROOT&lt;/warName&gt;
&lt;/configuration&gt;
&lt;/plugin&gt;
&lt;/plugins&gt;
&lt;/build&gt;
&lt;/profile&gt;
&lt;/profiles&gt;</pre></div></li><li class="listitem"><span class="strong"><strong class="calibre7">The deployments directory</strong></span>: You <a id="id608" class="calibre1"/>should <a id="id609" class="calibre1"/>use <a id="id610" class="calibre1"/>this directory if<a id="id611" class="calibre1"/> you <a id="id612" class="calibre1"/>want to do binary deployments on OpenShift, that is, you want to deploy a WAR or EAR file directly instead of pushing the source code.</li><li class="listitem"><span class="strong"><strong class="calibre7">The .git directory</strong></span>: This is a<a id="id613" class="calibre1"/> local Git repository. This directory contains the complete history of the repository. The <code class="email">config</code> file in<code class="email">.git/</code> contains the configuration for the repository. It defines a Git remote origin that points to the OpenShift application gear SSH URL. This makes sure that when you do <code class="email">git push</code>, the source code is pushed to the remote Git repository hosted on your application gear. You can view the details of the origin Git remote by executing the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ git remote show origin</strong></span>
</pre></div></li><li class="listitem"><span class="strong"><strong class="calibre7">The .openshift directory</strong></span>: This is an <a id="id614" class="calibre1"/>OpenShift-specific directory, which can be used for the following purposes:<div class="book"><ul class="itemizedlist1"><li class="listitem">The files under the <code class="email">action_hooks</code> subdirectory allow you to hook onto the application lifecycle.</li><li class="listitem">The files under the <code class="email">config</code> subdirectory allow you to make changes to the JBoss EAP configuration. The directory contains the <code class="email">standalone.xml</code> JBoss EAP-specific configuration file.</li><li class="listitem">The files under the <code class="email">cron</code> subdirectory are used when you add the cron cartridge to your application. This allows you to run scripts or jobs on a periodic basis.</li><li class="listitem">The files under the <code class="email">markers</code> subdirectory allow you to specify whether you want to use Java 6 or Java 7 or you want to do hot deploy or debug the application running in the Cloud, and so on.</li></ul></div></li></ul></div><p class="calibre6">In step 2, you added the <a id="id615" class="calibre1"/>PostgreSQL 9.2 cartridge to the<a id="id616" class="calibre1"/> application <a id="id617" class="calibre1"/>using the <code class="email">rhc cartridge-add</code> command. We will use the PostgreSQL database to store the <code class="email">jobstore</code> application data. Then, in <a id="id618" class="calibre1"/>step 3, you imported the project in the Eclipse IDE as a Maven project. Eclipse Kepler has inbuilt support for Maven applications, which makes it easier to work with Maven-based applications.</p><p class="calibre6">From step 3 through step 5, you updated the project to use JDK 1.7 for the Maven compiler plugin. All the OpenShift Java applications use OpenJDK 7, so it makes sense to update the application to also use JDK 1.7 for compilation.</p><p class="calibre6">In step 6, you created the <code class="email">job</code> domain class and annotated it with JPA annotations. The <code class="email">@Entity</code> annotation marks the class as a JPA entity. An entity represents a table in the relational database, and each entity instance corresponds to a row in the table. Entity class fields represent the persistent state of the entity. You can learn more about JPA<a id="id619" class="calibre1"/> by reading the official documentation at <a class="calibre1" href="http://docs.oracle.com/javaee/6/tutorial/doc/bnbpz.html">http://docs.oracle.com/javaee/6/tutorial/doc/bnbpz.html</a>.</p><p class="calibre6">The <code class="email">@NotNull</code> and <code class="email">@Size</code> annotation<a id="id620" class="calibre1"/> marks are Bean Validation annotations. Bean Validation is a new validation model available as a part of the Java EE 6 platform. The <code class="email">@NotNull</code> annotation<a id="id621" class="calibre1"/> adds a constraint that the value of the field must not be null. If the value is null, an exception will be raised. The <code class="email">@Size</code> annotation adds a constraint that the value must match the specified minimum and maximum boundaries. You can learn more about Bean Validation by reading the official documentation<a id="id622" class="calibre1"/> at <a class="calibre1" href="http://docs.oracle.com/javaee/6/tutorial/doc/gircz.html">http://docs.oracle.com/javaee/6/tutorial/doc/gircz.html</a>.</p><p class="calibre6">In JPA, entities are managed within a persistence context. Within the persistence context, the entity manager manages the entities. The configuration of the entity manager is defined in a standard configuration XML file called <code class="email">persitence.xml</code>. In step 7, you created the <code class="email">persistence.xml</code> file. The most important configuration option is the <code class="email">jta-datasource-source</code> configuration tag. It points to <code class="email">java:jboss/datasources/PostgreSQLDS</code>. When a user creates a JBoss EAP 6 application, then OpenShift <a id="id623" class="calibre1"/>defines a PostgreSQL <a id="id624" class="calibre1"/>datasource<a id="id625" class="calibre1"/> in the <code class="email">standalone.xml</code> file. The <code class="email">standalone.xml</code> file is a JBoss configuration file, which includes the <a id="id626" class="calibre1"/>technologies required by the Java EE 6 full profile specification plus Java Connector 1.6 architecture, Java XML API for RESTful web services, and OSGi. Developers can override the configuration by making changes to the <code class="email">standalone.xml</code> file in the <code class="email">.openshift/config</code> location of your application directory. So, if you open the <code class="email">standalone.xml</code> file in <code class="email">.openshift/config/</code> in your favorite editor, you will find the following PostgreSQL datasource configuration:</p><div class="informalexample"><pre class="programlisting">&lt;datasource jndi-name="java:jboss/datasources/PostgreSQLDS"
enabled="${postgresql.enabled}" use-java-context="true" pool-name="PostgreSQLDS"
use-ccm="true"&gt;
&lt;connection-url&gt;jdbc:postgresql://${env.OPENSHIFT_POSTGRESQL_DB_HOST}:${env.OPENSHIFT_POSTGRESQL_DB_PORT}/${env.OPENSHIFT_APP_NAME}
&lt;/connection-url&gt;
&lt;driver&gt;postgresql&lt;/driver&gt;
&lt;security&gt;
&lt;user-name&gt;${env.OPENSHIFT_POSTGRESQL_DB_USERNAME}&lt;/user-name&gt;
&lt;password&gt;${env.OPENSHIFT_POSTGRESQL_DB_PASSWORD}&lt;/password&gt;
&lt;/security&gt;
&lt;validation&gt;
&lt;check-valid-connection-sql&gt;SELECT 1&lt;/check-valid-connection-sql&gt;
&lt;background-validation&gt;true&lt;/background-validation&gt;
&lt;background-validation-millis&gt;60000&lt;/background-validation-millis&gt;
&lt;!--&lt;validate-on-match&gt;true&lt;/validate-on-match&gt; --&gt;
&lt;/validation&gt;
&lt;pool&gt;
&lt;flush-strategy&gt;IdleConnections&lt;/flush-strategy&gt;
&lt;allow-multiple-users /&gt;
&lt;/pool&gt;
&lt;/datasource&gt;</pre></div><p class="calibre6">In step 8, you created stateless <span class="strong"><strong class="calibre7">Enterprise JavaBeans</strong></span> (<span class="strong"><strong class="calibre7">EJBs</strong></span>) <a id="id627" class="calibre1"/>for our application service layer. The service classes work with the <code class="email">EntityManager</code> API to perform operations on the <code class="email">Job</code> entity.</p><p class="calibre6">In step 9, you configured CDI by creating the <code class="email">beans.xml</code> file in the <code class="email">src/main/webapp/WEB-INF</code> directory. We are using CDI in our application so that we can use dependency injection instead of manually creating the objects ourselves. The CDI container will manage the bean life cycle, and the developer just has to write the business logic. To let the JBoss application server know that we are using CDI, we need to create a file called <code class="email">beans.xml</code> in our <code class="email">WEB-INF</code> directory. The file can be completely blank, but its presence tells the container that the CDI framework needs to be loaded.</p><p class="calibre6">In step 10 and step 11, you configured JAX-RS and defined the REST resources for the <code class="email">Job</code> entity. You activated JAX-RS by creating a class that extends <code class="email">javax.ws.rs.ApplicationPath</code>. You need to specify the base URL under which your web service will be available. This is done by annotating the <code class="email">RestConfig</code> class with the <code class="email">ApplicationPath</code> annotation. You used <code class="email">/api/v1</code> as the application path.</p><p class="calibre6">In step 12, you<a id="id628" class="calibre1"/> added and committed the changes to <a id="id629" class="calibre1"/>the local repository and then <a id="id630" class="calibre1"/>pushed the changes to<a id="id631" class="calibre1"/> the application gear. After the bits are pushed, OpenShift will stop all the cartridges and then invoke the <code class="email">mvn -e clean package -Popenshift -DskipTests</code> command to build the project. Maven will build a <code class="email">ROOT.war</code> file, which will be copied to the JBoss EAP <code class="email">deployments</code> folder. After the build successfully finishes, all the cartridges are started. Then the new updated <code class="email">ROOT.war</code> file will be deployed. You can view the running application at <code class="email">http://jobstore-{domain-name}.rhcloud.com</code>. Please replace <code class="email">{domain-name}</code> with your account domain name.</p><p class="calibre6">Finally, you tested the REST endpoints using <code class="email">curl</code> in step 14.</p></div></div>

<div class="book" title="Creating and deploying Java EE 6 applications using the JBoss EAP and PostgreSQL 9.2 cartridges">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch07lvl2sec330" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre6">You can perform all the aforementioned steps with just a single command as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc create-app jobstore jbosseap postgresql-9.2 --from-code https://github.com/OpenShift-Cookbook/chapter7-jobstore-javaee6-simple.git --timeout 180</strong></span>
</pre></div></div></div>

<div class="book" title="Creating and deploying Java EE 6 applications using the JBoss EAP and PostgreSQL 9.2 cartridges">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch07lvl2sec331" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Configuring application security by defining the database login module in standalone.xml</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Managing JBoss cartridges using the management web interface and CLI</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Configuring application security by defining the database login module in standalone.xml"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch07lvl1sec85" class="calibre1"/>Configuring application security by defining the database login module in standalone.xml</h1></div></div></div><p class="calibre6">In the <span class="strong"><em class="calibre10">Creating and deploying Java EE 6 applications using the JBoss EAP and PostgreSQL 9.2 cartridges</em></span> recipe, you<a id="id632" class="calibre1"/> learned how to develop a Java EE 6 application on OpenShift. The application allows you to create company entities and then assign jobs to them. The problem with the application is that it is not secured. The Java EE specification defines a simple, role-based security model for EJBs and web components. JBoss security is an extension to the application server and is included by default with your OpenShift JBoss applications. You can view the extension in the JBoss <code class="email">standalone.xml</code> configuration file. The <code class="email">standalone.xml</code> file exists in the <code class="email">.openshift/config</code> location. The following code shows the extension:</p><div class="informalexample"><pre class="programlisting">&lt;extension module="org.jboss.as.security" /&gt;</pre></div><p class="calibre6">OpenShift allows developers to update the <code class="email">standalone.xml</code> configuration file to meet their application needs. You make a change to the <code class="email">standalone.xml</code> configuration file, commit the change to the local Git repository, then push the changes to the OpenShift application gear. Then, after the successful build, OpenShift will replace the existing <code class="email">standalone.xml</code> file with your updated configuration file and then finally start the server. But please make sure that your changes are valid; otherwise, the application will fail to start.</p><p class="calibre6">In this recipe, you will learn how to define the database login module in <code class="email">standalone.xml</code> to authenticate users before they can perform any operation with the application.</p><p class="calibre6">The source code for the application created in this recipe is on GitHub at <a class="calibre1" href="https://github.com/OpenShift-Cookbook/chapter7-jobstore-security">https://github.com/OpenShift-Cookbook/chapter7-jobstore-security</a>.</p></div>

<div class="book" title="Configuring application security by defining the database login module in standalone.xml">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch07lvl2sec332" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">This recipe builds on the application created in the <span class="strong"><em class="calibre10">Creating and deploying Java EE 6 applications using the JBoss EAP and PostgreSQL 9.2 cartridges</em></span> recipe. So, please refer to that recipe before continuing with this recipe.</p></div></div>

<div class="book" title="Configuring application security by defining the database login module in standalone.xml">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch07lvl2sec333" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Perform the following steps to<a id="id633" class="calibre1"/> add security to your web application:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Create the OpenShift application created in the <span class="strong"><em class="calibre10">Creating and deploying Java EE 6 applications using the JBoss EAP and PostgreSQL 9.2 cartridges</em></span> recipe using the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc create-app jobstore jbosseap postgresql-9.2 --from-code https://github.com/OpenShift-Cookbook/chapter7-jobstore-javaee6-simple.git --timeout 180</strong></span>
</pre></div></li><li class="listitem" value="2">After the application creation, SSH into the application gear, and connect with the PostgreSQL database using the <code class="email">psql</code> client. Then, create the following tables and insert the test data:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc ssh</strong></span>
<span class="strong"><strong class="calibre7">$ psql</strong></span>
<span class="strong"><strong class="calibre7">jobstore=# CREATE TABLE USERS(email VARCHAR(64) PRIMARY KEY, password VARCHAR(64));</strong></span>
<span class="strong"><strong class="calibre7">jobstore=# CREATE TABLE USER_ROLES(email VARCHAR(64), role VARCHAR(32));</strong></span>
<span class="strong"><strong class="calibre7">jobstore=# INSERT into USERS values('admin@jobstore.com', 'ISMvKXpXpadDiUoOSoAfww==');</strong></span>
<span class="strong"><strong class="calibre7">jobstore=# INSERT into USER_ROLES values('admin@jobstore.com', 'admin');</strong></span>
</pre></div></li><li class="listitem" value="3">Exit from the SSH shell, and open the <code class="email">standalone.xml</code> file in the<code class="email">.openshift/config</code> directory. Update the security domain with the following code:<div class="informalexample"><pre class="programlisting">&lt;security-domain name="other" cache-type="default"&gt;
&lt;authentication&gt;
&lt;login-module code="Remoting" flag="optional"&gt;
&lt;module-option name="password-stacking"value="useFirstPass" /&gt;
&lt;/login-module&gt;
&lt;login-module code="Database" flag="required"&gt;
&lt;module-option name="dsJndiName"
value="java:jboss/datasources/PostgreSQLDS" /&gt;
&lt;module-option name="principalsQuery"
value="select password from USERS where email=?" /&gt;
&lt;module-option name="rolesQuery"
value="select role, 'Roles' from USER_ROLES where email=?" /&gt;
&lt;module-option name="hashAlgorithm" value="MD5" /&gt;
&lt;module-option name="hashEncoding" value="base64" /&gt;
&lt;/login-module&gt;
&lt;/authentication&gt;
&lt;/security-domain&gt;</pre></div></li><li class="listitem" value="4">Create the web <a id="id634" class="calibre1"/>deployment descriptor (that is, <code class="email">web.xml</code>) in the <code class="email">src/main/webapp/WEB-INF</code> folder. Add the following content to it:<div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app version="3.0"

xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"&gt;

&lt;security-constraint&gt;
&lt;web-resource-collection&gt;
&lt;web-resource-name&gt;WebAuth&lt;/web-resource-name&gt;
&lt;description&gt;application security constraints
&lt;/description&gt;
&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;http-method&gt;GET&lt;/http-method&gt;
&lt;http-method&gt;POST&lt;/http-method&gt;
&lt;/web-resource-collection&gt;
&lt;auth-constraint&gt;
&lt;role-name&gt;admin&lt;/role-name&gt;
&lt;/auth-constraint&gt;
&lt;/security-constraint&gt;
&lt;login-config&gt;
&lt;auth-method&gt;FORM&lt;/auth-method&gt;
&lt;realm-name&gt;jdbcRealm&lt;/realm-name&gt;
&lt;form-login-config&gt;
&lt;form-login-page&gt;/login.html&lt;/form-login-page&gt;
&lt;form-error-page&gt;/error.html&lt;/form-error-page&gt;
&lt;/form-login-config&gt;
&lt;/login-config&gt;
&lt;security-role&gt;
&lt;role-name&gt;admin&lt;/role-name&gt;
&lt;/security-role&gt;

&lt;/web-app&gt;</pre></div></li><li class="listitem" value="5">Create the <code class="email">login.html</code> file in the <code class="email">src/main/webapp</code> directory. The <code class="email">login.html</code> page will be used for user authentication. The following code shows the contents of this file:<div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset="UTF-8"&gt;
&lt;title&gt;Login&lt;/title&gt;
&lt;link href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.1.1/css/bootstrap.css" rel="stylesheet"&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class="container"&gt;
&lt;form class="form-signin" role="form" method="post"action="j_security_check"&gt;
&lt;h2 class="form-signin-heading"&gt;Please sign in&lt;/h2&gt;
&lt;input type="text" id="j_username"name="j_username" class="form-control" placeholder="Email address" required autofocus&gt;
&lt;input type="password" id="j_password"name="j_password" class="form-control"placeholder="Password" required&gt;
&lt;button class="btn btn-lg btn-primary btn-block"type="submit"&gt;Sign in&lt;/button&gt;
&lt;/form&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div></li><li class="listitem" value="6">Create an <code class="email">error.html</code> file in the <code class="email">src/main/webapp</code> directory. The <code class="email">error.html</code> page will <a id="id635" class="calibre1"/>be shown after unsuccessful authentication. The following code shows the contents of this file:<div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset="US-ASCII"&gt;
&lt;title&gt;Error page&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h2&gt;Incorrect username/password&lt;/h2&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div></li><li class="listitem" value="7">Commit the changes, and push them to the OpenShift application gear:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ git add .</strong></span>
<span class="strong"><strong class="calibre7">$ git commit –am "enabled security"</strong></span>
<span class="strong"><strong class="calibre7">$ git push</strong></span>
</pre></div></li><li class="listitem" value="8">Go to the application page at <code class="email">http://jobstore-{domain-name}.rhcloud.com</code>, and you will be asked to log in before you can view the application. Use <code class="email">admin@jobstore.com/admin</code> as the username-password combination to log in to the application.</li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Configuring application security by defining the database login module in standalone.xml">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch07lvl2sec334" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">Let's now understand what you did in the preceding steps. In step 1, you recreated the <code class="email">jobstore</code> application we developed in the <span class="strong"><em class="calibre10">Creating and deploying Java EE 6 applications using the JBoss EAP and PostgreSQL 9.2 cartridges</em></span> recipe. Next, in step 2, you performed an SSH into the application gear and created the <code class="email">USERS</code> and <code class="email">USER_ROLES</code> tables. These tables will be used by the JBoss database login module to authenticate users. As our application does not have the user registration functionality, we created a default user for the application. Storing the password as a clear text string is a bad practice, so we have stored the MD5 hash of the password. The MD5 hash of the <code class="email">admin</code> password is <code class="email">ISMvKXpXpadDiUoOSoAfww==</code>. If you want to generate the hashed password in your application, I have <a id="id636" class="calibre1"/>included a simple Java class, which uses <code class="email">org.jboss.crypto.CryptoUtil</code> to generate the MD5 hash of any string. The <code class="email">CryptoUtil</code> class is part of the <code class="email">picketbox</code> library. The following code depicts this:</p><div class="informalexample"><pre class="programlisting">import org.jboss.crypto.CryptoUtil;

public class PasswordHash {

public static String getPasswordHash(String password) {
return CryptoUtil.createPasswordHash("MD5", CryptoUtil.BASE64_ENCODING,
null, null, password);
}

public static void main(String[] args) throws Exception {
System.out.println(getPasswordHash("admin"));
}
}</pre></div><p class="calibre6">In step 3, you logged out of the SSH session and updated the <code class="email">standalone.xml</code> JBoss configuration file with the database login module configuration. There are several login module implementations available out of the box. This book will only talk about the database login module, as discussing all the modules is outside the scope of this book. You can read about all the login modules<a id="id637" class="calibre1"/> at <a class="calibre1" href="https://docs.jboss.org/author/display/AS7/Security+subsystem+configuration">https://docs.jboss.org/author/display/AS7/Security+subsystem+configuration</a>. The database login module checks the user credentials against a relational database. To configure the database login module, you have to specify a few configuration options. The <code class="email">dsJndiName</code> option is used to specify the application datasource. As we are using a configured PostgreSQL datasource for our application, you specified the same <code class="email">dsJndiName</code> option value. Next, you have to specify the SQL queries to fetch the user and its roles. Then, you have specified that the password will be hashed against an MD5 hash algorithm by specifying the <code class="email">hashAlgorithm</code> configuration.</p><p class="calibre6">In step 4, you applied the database login module to the <code class="email">jobstore</code> application by defining the security constraints in <code class="email">web.xml</code>. This configuration will add a security constraint on all the web resources of the application that will restrict access to authenticated users with role admin. You have also configured your application to use FORM-based authentication. This will make sure that when unauthenticated users visit the website, they will be redirected to the <code class="email">login.html</code> page created in step 5. If the user enters a wrong e-mail/password combination, then they will be redirected to the <code class="email">error.html</code> page created in step 6.</p><p class="calibre6">Finally, in step 7, you <a id="id638" class="calibre1"/>committed the changes to the local Git repository and pushed the changes to the application gear. OpenShift will make sure that the JBoss EAP application server uses the updated <code class="email">standalone.xml</code> configuration file. Now, the user will be asked to authenticate before they can work with the application.</p></div></div>

<div class="book" title="Configuring application security by defining the database login module in standalone.xml">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch07lvl2sec335" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Creating and deploying Java EE 6 applications using the JBoss EAP and PostgreSQL 9.2 cartridges</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Installing modules with JBoss cartridges</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Managing JBoss cartridges using the management web interface and CLI</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Installing modules with JBoss cartridges"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch07lvl1sec86" class="calibre1"/>Installing modules with JBoss cartridges</h1></div></div></div><p class="calibre6">From version 7 <a id="id639" class="calibre1"/>of the JBoss application server, class loading <a id="id640" class="calibre1"/>is based on the JBoss <a id="id641" class="calibre1"/>Modules project. In this recipe, you will learn how to install the <code class="email">Twitter4J</code> library as a module on the JBoss EAP 6 cartridge. The <code class="email">modules</code> directory under the JBoss server home houses all the modules installed on the application server.</p><p class="calibre6">The source code for the application created in this recipe is on GitHub at <a class="calibre1" href="https://github.com/OpenShift-Cookbook/chapter7-recipe4">https://github.com/OpenShift-Cookbook/chapter7-recipe4</a>.</p></div>

<div class="book" title="Installing modules with JBoss cartridges">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch07lvl2sec336" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">This recipe builds on the application created in the <span class="strong"><em class="calibre10">Creating and deploying Java EE 6 applications using the JBoss EAP and PostgreSQL 9.2 cartridges</em></span> recipe. So, please refer to that recipe before continuing with this recipe.</p></div></div>

<div class="book" title="Installing modules with JBoss cartridges">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch07lvl2sec337" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Perform the following steps to <a id="id642" class="calibre1"/>install the <code class="email">Twitter4J</code> library as <a id="id643" class="calibre1"/>a module:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Create the OpenShift application<a id="id644" class="calibre1"/> created in the <span class="strong"><em class="calibre10">Creating and deploying Java EE 6 applications using the JBoss EAP and PostgreSQL 9.2 cartridges</em></span> recipe using the following <a id="id645" class="calibre1"/>command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc app-create jobstore jbosseap postgresql-9.2 --from-code https://github.com/OpenShift-Cookbook/chapter5-jobstore-javaee6.git --timeout 180</strong></span>
</pre></div></li><li class="listitem" value="2">To install a new module, you have to create the module path under the <code class="email">.openshift/config/modules</code> directory as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ mkdir –p .openshift/config/modules/org/twitter4j/main</strong></span>
</pre></div></li><li class="listitem" value="3">Download the <code class="email">twitter4j-core</code> library<a id="id646" class="calibre1"/> from <a class="calibre1" href="http://mvnrepository.com/artifact/org.twitter4j/twitter4j-core/3.0.5">http://mvnrepository.com/artifact/org.twitter4j/twitter4j-core/3.0.5</a>, and place it under the <code class="email">.openshift/config/modules/org/twitter4j/main</code> directory.</li><li class="listitem" value="4">Now, in the <code class="email">main</code> folder, add a file named <code class="email">module.xml</code>. This file contains the actual module definition as follows:<div class="informalexample"><pre class="programlisting">&lt;module  name="org.twitter4j"&gt;
&lt;resources&gt;
&lt;resource-root path="twitter4j-core-3.0.5.jar" /&gt;
&lt;/resources&gt;
&lt;dependencies&gt;
&lt;module name="javax.api"/&gt;
&lt;/dependencies&gt;
&lt;/module&gt;</pre></div></li><li class="listitem" value="5">Now, to use this module in your application, you have to first add its dependency in your <code class="email">pom.xml</code> file. Make sure that the scope is provided, as the server will already have this dependency since you are adding it as a module:<div class="informalexample"><pre class="programlisting">&lt;dependency&gt;
&lt;groupId&gt;org.twitter4j&lt;/groupId&gt;
&lt;artifactId&gt;twitter4j-core&lt;/artifactId&gt;
&lt;version&gt;3.0.5&lt;/version&gt;
&lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;</pre></div></li><li class="listitem" value="6">Secondly, you have to update the Maven WAR plugin configuration by adding the <code class="email">org.twitter4j</code> module dependency in the <code class="email">META-INF/MANIFEST.MF</code> location:<div class="informalexample"><pre class="programlisting">&lt;plugin&gt;
&lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;
&lt;version&gt;2.4&lt;/version&gt;
&lt;configuration&gt;
&lt;archive&gt;
&lt;manifestEntries&gt;
&lt;Dependencies&gt;org.twitter4j&lt;/Dependencies&gt;
&lt;/manifestEntries&gt;
&lt;/archive&gt;
&lt;outputDirectory&gt;deployments&lt;/outputDirectory&gt;
&lt;warName&gt;ROOT&lt;/warName&gt;
&lt;failOnMissingWebXml&gt;false&lt;/failOnMissingWebXml&gt;
&lt;/configuration&gt;
&lt;/plugin&gt;</pre></div></li><li class="listitem" value="7">Finally, commit the changes, and push them to the application gear. Now, after the server restarts, JBoss will have the <code class="email">twitter4j</code> library as a module.</li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Installing modules with JBoss cartridges">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch07lvl2sec338" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">In the preceding steps, you <a id="id647" class="calibre1"/>learned how to install a third-party library<a id="id648" class="calibre1"/> as a module. The alternative to using a<a id="id649" class="calibre1"/> third-party library is to add a<a id="id650" class="calibre1"/> compile scope dependency in <code class="email">pom.xml</code> and then use the <code class="email">twitter4j</code> library in your application. The advantage of using a module is that you do not have to bundle the JAR file with your application archive. If you are deploying multiple applications on a single server instance, then the server will only need one copy of the JAR file.</p><p class="calibre6">After creating the application in step 1, you created a directory structure required to define a module inside the<code class="email">.openshift/config</code> directory in step 2. This directory is added to the module path of the JBoss EAP server associated with your OpenShift application. It has the same structure as the standard JBoss EAP <code class="email">modules</code> directory. Inside <code class="email">org.twitter4j.main</code>, you placed the <code class="email">twitter4j-core-3.0.5.jar</code> file in step 3. In step 4, you created a file called <code class="email">module.xml</code> inside the <code class="email">org.twitter4j.main</code> directory. The <code class="email">module.xml</code> file is used to define a module and its dependencies. The module name <code class="email">org.twitter4j</code> corresponds to the module attribute that you will define in your application manifest. Next, you need to state the path to the <code class="email">twitter4j-core</code> library and finally, its dependencies.</p><p class="calibre6">Next, in step 5, you added a provided scope dependency to the <code class="email">twitter4j-core</code> library. The provided scope indicated that you expect the application container to provide the dependency at runtime. Also, provided dependencies are not packaged with web applications. This makes sure that the application archives are smaller in size and the application deploys faster. Also, in step 5, you updated the Maven WAR plugin configuration to add a dependency on the <code class="email">org.twitter4j</code> module to the application archive <code class="email">META-INF/MANIFEST.MF</code> file.</p><p class="calibre6">In step 6, you committed the changes and pushed them to the application gear.</p><p class="calibre6">In this recipe, I have not covered how to use the <code class="email">Twitter4J</code> library. If you want to see <code class="email">Twitter4J</code> in action, I have created an application for you, which will tweet after posting a job. To use the application, you have to first create a Twitter application. Go to <a class="calibre1" href="https://dev.twitter.com">https://dev.twitter.com</a>, and create a new Twitter application. Give the application the read-and-write level access. Once you are done, create a new OpenShift application by running the following command. Please replace the environment variable values with your Twitter application values. You<a id="id651" class="calibre1"/> can find these values under the Twitter application's <span class="strong"><strong class="calibre7">API Keys</strong></span> section.</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc create-app jobstore jbosseap postgresql-9.2 --env TWITTER_CONSUMER_KEY=$TWITTER_CONSUMER_KEY TWITTER_CONSUMER_SECRET=$TWITTER_CONSUMER_SECRET TWITTER_ACCESS_TOKEN_KEY=$TWITTER_ACCESS_TOKEN_KEY TWITTER_ACCESS_TOKEN_SECRET=$TWITTER_ACCESS_TOKEN_SECRET --from-code https://github.com/OpenShift-Cookbook/chapter7-recipe4.git</strong></span>
</pre></div><p class="calibre6">After the application is <a id="id652" class="calibre1"/>successfully created, a tweet will be sent after <a id="id653" class="calibre1"/>every job <a id="id654" class="calibre1"/>posting.</p></div></div>

<div class="book" title="Installing modules with JBoss cartridges">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch07lvl2sec339" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Creating and deploying Java EE 6 applications using the JBoss EAP and PostgreSQL 9.2 cartridges</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Managing JBoss cartridges using the management web interface and CLI</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Managing JBoss cartridges using the management web interface and CLI"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch07lvl1sec87" class="calibre1"/>Managing JBoss cartridges using the management web interface and CLI</h1></div></div></div><p class="calibre6">JBoss provides three<a id="id655" class="calibre1"/> different ways to manage the <a id="id656" class="calibre1"/>server: a web interface, a command-line client, and <a id="id657" class="calibre1"/>the XML<a id="id658" class="calibre1"/> configuration files. In this recipe, you will learn how to deploy WAR files to your JBoss cartridge using the web management interface and JBoss CLI.</p></div>

<div class="book" title="Managing JBoss cartridges using the management web interface and CLI">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch07lvl2sec340" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To complete this recipe, you will need to have the JBoss application server binary on your local machine. This is required to connect with the JBoss cartridge using <code class="email">jboss-cli</code>. Download the JBoss AS7 binary<a id="id659" class="calibre1"/> from the official website at <a class="calibre1" href="http://www.jboss.org/jbossas/downloads">http://www.jboss.org/jbossas/downloads</a>. Extract the ZIP file, and you will find the <code class="email">jboss-cli</code> script in the <code class="email">bin</code> folder.</p><p class="calibre6">In this recipe, we will use the <code class="email">jobstore</code> application that we created in the <span class="strong"><em class="calibre10">Creating and deploying Java EE 6 applications using the JBoss EAP and PostgreSQL 9.2 cartridges</em></span> recipe.</p></div></div>

<div class="book" title="Managing JBoss cartridges using the management web interface and CLI">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch07lvl2sec341" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Perform the following steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open a new command-line terminal, and navigate to the directory where the <code class="email">jobstore</code> application is located. Run the <code class="email">rhc port-forward</code> command to forward the remote ports on your local machine:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc port-forward --app myapp</strong></span>
<span class="strong"><strong class="calibre7">To connect to a service running on OpenShift, use the Local address</strong></span>

<span class="strong"><strong class="calibre7">Service    Local               OpenShift</strong></span>
<span class="strong"><strong class="calibre7">---------- -------------- ---- ------------------</strong></span>
<span class="strong"><strong class="calibre7">java       127.0.0.1:3528  =&gt;  127.8.104.129:3528</strong></span>
<span class="strong"><strong class="calibre7">java       127.0.0.1:4447  =&gt;  127.8.104.129:4447</strong></span>
<span class="strong"><strong class="calibre7">java       127.0.0.1:5445  =&gt;  127.8.104.129:5445</strong></span>
<span class="strong"><strong class="calibre7">java       127.0.0.1:8080  =&gt;  127.8.104.129:8080</strong></span>
<span class="strong"><strong class="calibre7">java       127.0.0.1:9990  =&gt;  127.8.104.129:9990</strong></span>
<span class="strong"><strong class="calibre7">java       127.0.0.1:9999  =&gt;  127.8.104.129:9999</strong></span>
<span class="strong"><strong class="calibre7">postgresql 127.0.0.1:5433  =&gt;  127.8.104.130:5432</strong></span>

<span class="strong"><strong class="calibre7">Press CTRL-C to terminate port forwarding</strong></span>
</pre></div></li><li class="listitem" value="2">Open the management interface at <code class="email">http://127.0.0.1:9990</code> in your favorite web browser. This information is available in the output of the <code class="email">rhc port-forward</code> command.</li><li class="listitem" value="3">In this recipe, we will deploy the WAR file of the application we created in the <span class="strong"><em class="calibre10">Creating and deploying Java EE 6 applications using the JBoss EAP and PostgreSQL 9.2 cartridges</em></span> recipe using the JBoss management interface. Download the WAR file<a id="id660" class="calibre1"/> from <a class="calibre1" href="https://github.com/OpenShift-Cookbook/chapter7-recipe5/raw/master/ROOT.war">https://github.com/OpenShift-Cookbook/chapter7-recipe5/raw/master/ROOT.war</a> to your local machine.</li><li class="listitem" value="4">After downloading <a id="id661" class="calibre1"/>the WAR <a id="id662" class="calibre1"/>file, navigate to <span class="strong"><strong class="calibre7">Runtime</strong></span> | <span class="strong"><strong class="calibre7">Manage Deployments</strong></span>, and remove the existing <code class="email">ROOT.war</code> file by <a id="id663" class="calibre1"/>clicking on the <span class="strong"><strong class="calibre7">Remove</strong></span> button as<a id="id664" class="calibre1"/> shown in the following screenshot. It will ask you to confirm the removal, and you can click on the <span class="strong"><strong class="calibre7">OK</strong></span> button. Have a look at the following screenshot:<div class="mediaobject"><img src="../images/00062.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="5">To deploy the WAR file, click on the <span class="strong"><strong class="calibre7">Add</strong></span> button, and then upload the <code class="email">ROOT.war</code> file from your local machine. After uploading the WAR file, you will be asked to verify the deployment name. Choose the default values, and click on the <span class="strong"><strong class="calibre7">Save</strong></span> button as shown in the following screenshot:<div class="mediaobject"><img src="../images/00063.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="6">Uploading the <a id="id665" class="calibre1"/>WAR file does<a id="id666" class="calibre1"/> not initiate the deployment. You<a id="id667" class="calibre1"/> have to click on the <span class="strong"><strong class="calibre7">En/Disable</strong></span> button to<a id="id668" class="calibre1"/> initiate the deployment. You will be asked to confirm your decision. Click on the <span class="strong"><strong class="calibre7">Confirm</strong></span> button as shown in the following screenshot:<div class="mediaobject"><img src="../images/00064.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="7">Now, if you go to <code class="email">http://myapp-{domain-name}.rhcloud.com</code>, you will see your application deployed.</li><li class="listitem" value="8">Another way to deploy an application is via the <code class="email">jboss-cli</code> command-line interface. The <code class="email">jboss-cli</code> script can be found in your local downloaded JBoss archive <code class="email">bin</code> folder. Launch the <code class="email">jboss-cli</code> client, and you will see the message shown in the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ ~/ jboss-eap-6.2/bin/jboss-cli.sh </strong></span>
<span class="strong"><strong class="calibre7">You are disconnected at the moment. Type 'connect' to connect to the server or 'help' for the list of supported commands.</strong></span>
<span class="strong"><strong class="calibre7">[disconnected /]</strong></span>
</pre></div></li><li class="listitem" value="9">To connect to the <a id="id669" class="calibre1"/>JBoss <a id="id670" class="calibre1"/>cartridge, type the <code class="email">connect</code> command as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">[disconnected /] connect </strong></span>
<span class="strong"><strong class="calibre7">[standalone@localhost:9999 /]</strong></span>
</pre></div></li><li class="listitem" value="10">Now, you can <a id="id671" class="calibre1"/>check the deployed applications using the <code class="email">deploy</code> command. Type <code class="email">deploy</code>, and then press <span class="strong"><em class="calibre10">Enter</em></span>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">[standalone@localhost:9999 /] deploy </strong></span>

<span class="strong"><strong class="calibre7">ROOT.war</strong></span>
</pre></div></li><li class="listitem" value="11">As you can see in the<a id="id672" class="calibre1"/> preceding command, <code class="email">ROOT.war</code> is currently deployed. This WAR file was deployed using the web interface. To withdraw this WAR file, type the <code class="email">undeploy</code> command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">[standalone@localhost:9999 /] undeploy ROOT.war</strong></span>
</pre></div></li><li class="listitem" value="12">Now, if you go to <code class="email">http://myapp-{domain-name}.rhcloud.com</code>, you will get a 404 error as the application is not deployed.</li><li class="listitem" value="13">To deploy the application using <code class="email">jboss-cli</code>, you can use the <code class="email">deploy</code> command as shown in the following command line. Please make sure you have downloaded the application <code class="email">ROOT.war</code> file as discussed in step 3. Have a look at the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">[standalone@localhost:9999 /] deploy ~/chapter5/recipe8/jobstore/ROOT.war</strong></span>
<span class="strong"><strong class="calibre7">[standalone@localhost:9999 /]</strong></span>
</pre></div></li><li class="listitem" value="14">Finally, you can see the application running at <code class="email">http://myapp-{domain-name}.rhcloud.com</code>.</li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Managing JBoss cartridges using the management web interface and CLI">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch07lvl2sec342" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">In the preceding steps, you learned how to manage your application deployment from the JBoss web management and command-line interface. In step 1, you ran the <code class="email">rhc port-forward</code> command to enable SSH port forwarding. The <code class="email">rhc port-forward</code> command forwarded all the remote ports running on the application gear to your local machine. In the output of the <code class="email">rhc port-forward</code> command, you can see that the management interface is exposed on port <code class="email">9090</code>.</p><p class="calibre6">From step 3 through <a id="id673" class="calibre1"/>step 5, you saw how to connect <a id="id674" class="calibre1"/>with the web interface from your local machine and undeploy the existing <code class="email">ROOT.war</code> file. The web interface is a <span class="strong"><strong class="calibre7">Google Web Toolkit</strong></span> (<span class="strong"><strong class="calibre7">GWT</strong></span>)<a id="id675" class="calibre1"/> application accessible on port <code class="email">9090</code>. Google Web Toolkit is an <a id="id676" class="calibre1"/>open source set of tools that allows Java developers to write complex JavaScript-based web applications in Java. OpenShift <a id="id677" class="calibre1"/>only exposes port <code class="email">8080</code> to the outside world; all other ports are internal to the application gear and can only be connected via port forwarding. This is a secure setup as no one from the outside world will be able to connect with your application web management interface, because the <code class="email">rhc port-forward</code> command will only work if their SSH keys are uploaded. The web console is divided into two main tabs: the <span class="strong"><strong class="calibre7">Profile</strong></span> and the <span class="strong"><strong class="calibre7">Runtime</strong></span> tab. The <span class="strong"><strong class="calibre7">Profile</strong></span> tab gives access to all the subsystem configurations. You can edit the configuration without fiddling with XML. For example, you can go to <code class="email">http://127.0.0.1:9990/console/App.html#datasources</code> to edit the <code class="email">datasource</code> configuration. The <span class="strong"><strong class="calibre7">Runtime</strong></span> tab can be used to manage application deployment, and you used it to undeploy the WAR file in step 5. You can learn more about the management interface from the <a id="id678" class="calibre1"/>documentation at <a class="calibre1" href="https://docs.jboss.org/author/display/AS7/Admin+Guide">https://docs.jboss.org/author/display/AS7/Admin+Guide</a>.</p><p class="calibre6">In step 6, you uploaded the <code class="email">ROOT.war</code> file to your JBoss cartridge. After upload, the deployment is listed in the <span class="strong"><strong class="calibre7">Deployments</strong></span> table. The WAR file is not deployed by default; you have to click on the <span class="strong"><strong class="calibre7">En/Disable</strong></span> button to enable the deployment of the application as you did in step 7.</p><p class="calibre6">Another way to deploy <a id="id679" class="calibre1"/>an application <a id="id680" class="calibre1"/>is using the <code class="email">jboss-cli</code> command-line interface. In step 9, you launched the <code class="email">jboss-cli</code> script. The <code class="email">jboss-cli</code> console<a id="id681" class="calibre1"/> provides a built-in autocomplete feature using the <span class="strong"><em class="calibre10">Tab</em></span> key. At any point in time, you can list all the available commands using the <span class="strong"><em class="calibre10">Tab</em></span> key as shown in the following <a id="id682" class="calibre1"/>command. For brevity, only part of the output is shown:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">[standalone@localhost:9999 /] </strong></span>
<span class="strong"><strong class="calibre7">alias               connection-factory  help                ls       read-operation      version….             </strong></span>
</pre></div><p class="calibre6">In step 9, you undeployed the existing <code class="email">ROOT.war</code> file using the <code class="email">undeploy</code> command. The <code class="email">undeploy</code> command takes the application that is already deployed as an argument. Finally, in step 10, you deployed the <code class="email">ROOT.war</code> file on your local machine to the JBoss cartridge running on <a id="id683" class="calibre1"/>OpenShift using the <code class="email">deploy</code> command.</p></div></div>

<div class="book" title="Managing JBoss cartridges using the management web interface and CLI">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch07lvl2sec343" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Configuring application security by defining the database login module in standalone.xml</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Installing modules with JBoss cartridges</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Creating and deploying Spring applications using the Tomcat 7 cartridge"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch07lvl1sec88" class="calibre1"/>Creating and deploying Spring applications using the Tomcat 7 cartridge</h1></div></div></div><p class="calibre6">Spring Framework<a id="id684" class="calibre1"/> is a<a id="id685" class="calibre1"/> very <a id="id686" class="calibre1"/>popular <a id="id687" class="calibre1"/>alternative<a id="id688" class="calibre1"/> to Java EE web development. Java developers around the world use Spring Framework to build their enterprise applications. Spring Framework is often thought of as a lightweight alternative to Java EE, and Java developers normally use a lightweight web container, such as Apache Tomcat, for deployment. At the time of this writing, OpenShift supports two versions of Apache Tomcat: Apache Tomcat 6 and Apache Tomcat 7. They are shown using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridges|grep Tomcat</strong></span>
<span class="strong"><strong class="calibre7">jbossews-1.0        Tomcat 6 (JBoss EWS 1.0)                web</strong></span>
<span class="strong"><strong class="calibre7">jbossews-2.0        Tomcat 7 (JBoss EWS 2.0)                web</strong></span>
</pre></div><p class="calibre6">In this recipe, you will learn how to develop a simple Spring Framework application from scratch using OpenShift's Tomcat 7 cartridge. The application exposes a REST endpoint. When a user makes an HTTP request to <code class="email">/api/v1/ping</code>, then the applicaton will return a JSON response with the message <code class="email">It works</code>.</p><p class="calibre6">The source code for the application created in this recipe is on GitHub at <a class="calibre1" href="https://github.com/OpenShift-Cookbook/chapter7-jobstore-spring">https://github.com/OpenShift-Cookbook/chapter7-jobstore-spring</a>.</p></div>

<div class="book" title="Creating and deploying Spring applications using the Tomcat 7 cartridge">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch07lvl2sec344" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To complete this recipe, you will need the <code class="email">rhc</code> command-line client installed on your machine. Please refer to the <span class="strong"><em class="calibre10">Installing the OpenShift rhc command-line client</em></span> recipe in <a class="calibre1" title="Chapter 1. Getting Started with OpenShift" href="part0014_split_000.html#page">Chapter 1</a>, <span class="strong"><em class="calibre10">Getting Started with OpenShift</em></span>, for details.</p></div></div>

<div class="book" title="Creating and deploying Spring applications using the Tomcat 7 cartridge">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch07lvl2sec345" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Perform the following steps to create an application using Spring Framework:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open a new command-line terminal, and go to a convenient location. Create a new Tomcat 7 and MySQL 5.5 application by executing the following commands:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc create-appmyapp tomcat-7</strong></span>
</pre></div><p class="calibre14">The preceding command will create a Maven-based project and clone it to your local machine.</p></li><li class="listitem" value="2">Open Eclipse and navigate to the project workspace. Then, import the application created in step 1 as a Maven application. To import an existing Maven project, navigate to <span class="strong"><strong class="calibre7">File</strong></span>|<span class="strong"><strong class="calibre7">Import</strong></span>|<span class="strong"><strong class="calibre7">Maven</strong></span>|<span class="strong"><strong class="calibre7">Existing Maven Projects</strong></span>. Then browse to the location of your OpenShift Maven application created in step 1.</li><li class="listitem" value="3">Next, update <code class="email">pom.xml</code> to use Java 7. The Maven project created by OpenShift is<a id="id689" class="calibre1"/> configured to use JDK 6. Replace <a id="id690" class="calibre1"/>the properties<a id="id691" class="calibre1"/> with<a id="id692" class="calibre1"/> the one shown in the following code:<div class="informalexample"><pre class="programlisting">&lt;maven.compiler.source&gt;1.7&lt;/maven.compiler.source&gt;
&lt;maven.compiler.target&gt;1.7&lt;/maven.compiler.target&gt;</pre></div></li><li class="listitem" value="4">Update the Maven project to allow the changes to take effect. You can update the Maven project by right-clicking on the project and navigating to <span class="strong"><strong class="calibre7">Maven</strong></span>|<span class="strong"><strong class="calibre7">Update Project</strong></span>.</li><li class="listitem" value="5">Add Spring Maven <a id="id693" class="calibre1"/>dependencies to <a id="id694" class="calibre1"/>your <code class="email">pom.xml</code> file. These<a id="id695" class="calibre1"/> are the minimum dependencies that you need to write a REST JSON web service <a id="id696" class="calibre1"/>using Spring Framework. The code is as follows:<div class="informalexample"><pre class="programlisting">&lt;dependency&gt;
&lt;groupId&gt;org.springframework&lt;/groupId&gt;
&lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;
&lt;version&gt;4.0.3.RELEASE&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
&lt;groupId&gt;javax.servlet&lt;/groupId&gt;
&lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;
&lt;version&gt;3.1.0&lt;/version&gt;
&lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
&lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;
&lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;
&lt;version&gt;2.3.1&lt;/version&gt;
&lt;/dependency&gt;</pre></div></li><li class="listitem" value="6">Create a new package called <code class="email">org.myapp.config</code>, and create a new class named <code class="email">WebMvcConfig</code>:<div class="informalexample"><pre class="programlisting">@EnableWebMvc
@ComponentScan(basePackageClasses = PingResource.class)
@Configuration
public class WebMvcConfig extends WebMvcConfigurerAdapter {

    @Bean
    public MappingJackson2JsonView jsonView() {
        MappingJackson2JsonView jsonView = new MappingJackson2JsonView();
        jsonView.setPrefixJson(true);
        return jsonView;
    }
}</pre></div></li><li class="listitem" value="7">Create another configuration class in the <code class="email">org.myapp.config</code> package. This <code class="email">@Configuration</code> class will be used for defining application beans, such as <code class="email">datasource</code>, and so on. This will be covered later in this recipe. The code is as follows:<div class="informalexample"><pre class="programlisting">import org.springframework.context.annotation.Configuration;

@Configuration
public class ApplicationConfig {
}</pre></div></li><li class="listitem" value="8">From Servlet 3.0 onwards, the <code class="email">web.xml</code> deployment <a id="id697" class="calibre1"/>descriptor is optional. Prior to Servlet 3.0, we configured <a id="id698" class="calibre1"/>the Spring<a id="id699" class="calibre1"/> MVC <a id="id700" class="calibre1"/>dispatcher servlet in <code class="email">web.xml</code>, but now we can programmatically configure it using <code class="email">WebApplicationInitializer</code>. Create a new class called <code class="email">JobStoreWebApplicationInitializer</code> in the <code class="email">org.myapp.config</code> package as follows:<div class="informalexample"><pre class="programlisting">public class JobStoreWebApplicationInitializer implements WebApplicationInitializer {
    @Override
    public void onStartup(ServletContext servletContext) throws ServletException {
        AnnotationConfigWebApplicationContext webApplicationContext = new AnnotationConfigWebApplicationContext();
        webApplicationContext.register(ApplicationConfig.class, WebMvcConfig.class);

        Dynamic dynamc = servletContext.addServlet("dispatcherServlet", new DispatcherServlet(webApplicationContext));
        dynamc.addMapping("/api/v1/*");
        dynamc.setLoadOnStartup(1);
    }

}</pre></div></li><li class="listitem" value="9">Now, we will create a simple REST resource called <code class="email">PingResource</code>. <code class="email">PingResource</code> will be invoked when a request is made to <code class="email">/api/v1/ping</code> and will respond with a JSON message. Create a new class called <code class="email">PingResource</code> in the <code class="email">org.myapp.rest</code> package. Have a look at the following code:<div class="informalexample"><pre class="programlisting">@Controller
@RequestMapping("/ping")
public class PingResource {

@RequestMapping(method=RequestMethod.GET,produces=MediaType.APPLICATION_JSON_VALUE)
public @ResponseBody PingResponse ping(){
return new PingResponse("It works!!");
}
}</pre></div></li><li class="listitem" value="10">Also, create another class called <code class="email">PingResponse</code> as shown in the following code:<div class="informalexample"><pre class="programlisting">public class PingResponse {

private String message;

public PingResponse(String message) {
this.message = message;
}

public String getMessage() {
return message;
}
}</pre></div></li><li class="listitem" value="11">Commit the changes<a id="id701" class="calibre1"/> and push them to the<a id="id702" class="calibre1"/> OpenShift<a id="id703" class="calibre1"/> application<a id="id704" class="calibre1"/> gear as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ git add .</strong></span>
<span class="strong"><strong class="calibre7">$ git commit -am "Spring 4 application"</strong></span>
<span class="strong"><strong class="calibre7">$ git push</strong></span>
</pre></div></li><li class="listitem" value="12">You can test the <code class="email">PingResource</code> using a command-line tool, such as <code class="email">curl</code>, or by opening the <code class="email">http://myapp-{domain-name}.rhcloud.com/api/v1/ping</code> location in your favorite browser. You should see the following JSON message:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ curl http://myapp-osbook.rhcloud.com/api/v1/ping</strong></span>

<span class="strong"><strong class="calibre7">{"message":"It works!!"}</strong></span>
</pre></div></li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Creating and deploying Spring applications using the Tomcat 7 cartridge">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch07lvl2sec346" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">In the preceding steps, we created a Spring application<a id="id705" class="calibre1"/> and deployed it to OpenShift. In step 1, you used the <code class="email">rhc create-app</code> command to create Apache <a id="id706" class="calibre1"/>Tomcat 7 MySQL 5.5. Every OpenShift web cartridge specifies a template application that will be used <a id="id707" class="calibre1"/>as the default source code of<a id="id708" class="calibre1"/> the application. For Java-based web cartridges, such as JBoss EAP, JBoss AS7, Tomcat 6, and Tomcat 7, the template is a Maven-based application. After the application is created, the template application is cloned to the local machine using Git. The directory structure of the application is shown in the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ ls -a</strong></span>
<span class="strong"><strong class="calibre7">.git .openshift README.md pom.xml webapps src</strong></span>
</pre></div><p class="calibre6">As you can see in the preceding command-line output, apart from the<code class="email">.git</code> and <code class="email">.openshift</code> directories, this looks like a standard Maven project. OpenShift uses Maven for managing application dependencies and building your Java applications.</p><p class="calibre6">The directory structure was explained in the <span class="strong"><em class="calibre10">Creating and deploying Java EE 6 applications using the JBoss EAP and PostgreSQL 9.2 cartridges</em></span> recipe. Please refer to the recipe to get an understanding of the directory structure.</p><p class="calibre6">From step 3 through step 5, you made a few changes in <code class="email">pom.xml</code>. You updated the project to use JDK 1.7 for the Maven compiler plugin. All the OpenShift Java applications use OpenJDK 7, so it makes sense to update the application to also use JDK 1.7 for compilation. Another change you made to <code class="email">pom.xml</code> is that you updated the Maven WAR plugin configuration not to fail the build if <code class="email">web.xml</code> is not found. Next, you added the Spring Web MVC dependencies to <code class="email">pom.xml</code>. The Servlet 3.1.0 is provided, as this should exist in Apache Tomcat 7. The <code class="email">jackson-databind</code> dependency is added to convert Java objects to JSON.</p><p class="calibre6">From step 6 through step 8, you configured the Spring Web MVC framework programmatically. Normally, we configure the Spring Web MVC dispatcher servlet in <code class="email">web.xml</code>, but now, we can programmatically configure it using <code class="email">WebApplicationInitializer</code>. From Spring 3.1, Spring provides an implementation of the <code class="email">ServletContainerInitializer</code> interface called <code class="email">SpringServletContainerInitializer</code>. The <code class="email">SpringServletContainerInitializer</code> class delegates to an implementation of <code class="email">org.springframework.web.WebApplicationInitializer</code> that you provide. There is just one method that you need to implement: <code class="email">WebApplicationInitializer#onStartup(ServletContext)</code>. You are handed the <code class="email">ServletContext</code> parameter that you need to initialize.</p><p class="calibre6">From step 9 through step 11, you<a id="id709" class="calibre1"/> created a simple REST JSON<a id="id710" class="calibre1"/> resource called <code class="email">PingResource</code> using Spring MVC. <code class="email">PingResource</code> is available at the<code class="email">/api/v1/ping</code> URL as<a id="id711" class="calibre1"/> defined using <a id="id712" class="calibre1"/>the <code class="email">@RequestMapping</code> annotation.</p></div></div>

<div class="book" title="Creating and deploying Spring applications using the Tomcat 7 cartridge">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch07lvl2sec347" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre6">You can perform all the preceding steps with just the following single command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc create-app jobstore tomcat-7 mysql-5.5 --from-code https://github.com/OpenShift-Cookbook/chapter7-spring-recipe.git --timeout 180</strong></span>
</pre></div></div></div>

<div class="book" title="Creating and deploying Spring applications using the Tomcat 7 cartridge">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch07lvl2sec348" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Taking thread dumps of Java cartridges</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Taking thread dumps of Java cartridges"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch07lvl1sec89" class="calibre1"/>Taking thread dumps of Java cartridges</h1></div></div></div><p class="calibre6">In this recipe, you will learn<a id="id713" class="calibre1"/> how to take thread dumps of your Java cartridge applications. A thread dump lists all the Java threads that are currently active in a <span class="strong"><strong class="calibre7">Java Virtual Machine</strong></span> (<span class="strong"><strong class="calibre7">JVM</strong></span>)<a id="id714" class="calibre1"/>. It can help you understand the state of every thread in the JVM at a particular point in time. It gives you a snapshot of exactly what's executing at a moment in time. Thread dumps are very useful to debug a deadlock condition or to understand resource usage.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note19" class="calibre1"/>Note</h3><p class="calibre6">This command will work with all the four supported Java cartridges (Apache Tomcat 6, Apache Tomcat 7, JBoss AS7, and JBoss EAP).</p></div></div>

<div class="book" title="Taking thread dumps of Java cartridges">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch07lvl2sec349" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">This recipe will request for a thread dump of the application created in the <span class="strong"><em class="calibre10">Creating and deploying Java EE 6 applications using the JBoss EAP and PostgreSQL 9.2 cartridges</em></span> recipe. So, please refer to the aforementioned recipe before continuing with this recipe.</p></div></div>

<div class="book" title="Taking thread dumps of Java cartridges">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch07lvl2sec350" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Perform the following steps to take a thread dump of your Java application:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open a new command-line terminal, and navigate to the directory where the <code class="email">jobstore</code> application is located.</li><li class="listitem" value="2">To take a thread dump of the <code class="email">jobstore</code> application, run the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc threaddump --app jobstore</strong></span>
</pre></div></li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Taking thread dumps of Java cartridges">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch07lvl2sec351" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">When you run the<a id="id715" class="calibre1"/> <code class="email">rhc threaddump</code> command, the JBoss EAP cartridge initiates a thread dump. It first gets<a id="id716" class="calibre1"/> the process ID of the JBoss application server and then runs the <code class="email">kill -3 &lt;process id&gt;</code> command. The <code class="email">kill -3</code> command sends the <code class="email">HUP</code> or <code class="email">BREAK</code> signal to the Java process. The thread dump log will be placed in the <code class="email">jbosseap.log</code> file in <code class="email">$OPENSHIFT_LOG_DIR/</code>, which you can download on your local machine for analysis. You can also view the logfile using the <code class="email">rhc tail</code> command<a id="id717" class="calibre1"/>, as mentioned in the following command output:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc tail -f app-root/logs/jbosseap.log -o '-n 250'</strong></span>
</pre></div><p class="calibre6">To download the thread dump file on your local machine, you can use the <code class="email">rhc scp</code> command. The <code class="email">rhc scp</code> command<a id="id718" class="calibre1"/> can be used to transfer files to and from your applications using SCP (<a class="calibre1" href="http://en.wikipedia.org/wiki/Secure_copy">http://en.wikipedia.org/wiki/Secure_copy</a>). Run the following command to download the <code class="email">jbosseap.log</code> file:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc scp jobstore download ./ app-root/logs/jbosseap.log</strong></span>
</pre></div><p class="calibre6">Now, you can use tools, such as samurai<a id="id719" class="calibre1"/> (<a class="calibre1" href="http://yusuke.homeip.net/samurai/en/index.html">http://yusuke.homeip.net/samurai/en/index.html</a>), to analyze the thread dump on your local machine.</p></div></div>

<div class="book" title="Taking thread dumps of Java cartridges">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch07lvl2sec352" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre6">You can also take a thread dump of the Java application using the <code class="email">jps</code> and <code class="email">jstack</code> JVM tools. To do that, perform the following steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open a command-line terminal and then SSH into the <code class="email">jobstore</code> application gear as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc ssh --app jobstore</strong></span>
</pre></div></li><li class="listitem" value="2">Once inside the application gear, run the <code class="email">jps</code> utility to list all the available Java processes as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ jps –l</strong></span>
</pre></div></li><li class="listitem" value="3">The <code class="email">jps</code> utility ships with JDK and lists all the Java process IDs.</li><li class="listitem" value="4">The output of the <code class="email">jps -l</code> command is as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">59850 sun.tools.jps.Jps</strong></span>
<span class="strong"><strong class="calibre7">157027 /var/lib/openshift/541ecec35004466ec000007f/jbosseap/jboss-modules.jar</strong></span>
</pre></div></li><li class="listitem" value="5">Now, to take a <a id="id720" class="calibre1"/>thread dump of the Java process with ID <code class="email">157027</code>, run the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ jstack 157027 &gt;&gt; /tmp/threaddump.log</strong></span>
</pre></div></li><li class="listitem" value="6">The <code class="email">jstack</code> utility is also part of JDK and is used to take a thread dump of a Java process.</li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Taking thread dumps of Java cartridges">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch07lvl2sec353" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Choosing between Java 6 and Java 7</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Enabling hot deployment for Java applications</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Creating and deploying Java EE 6 applications using the JBoss EAP and PostgreSQL 9.2 cartridges</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Choosing between Java 6 and Java 7"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch07lvl1sec90" class="calibre1"/>Choosing between Java 6 and Java 7</h1></div></div></div><p class="calibre6">OpenShift supports both <a id="id721" class="calibre1"/>Java 6 and Java 7 to run your applications. By default, all the Java applications use OpenJDK 7, but you can configure your application to use OpenJDK 6 as well. To get the exact version of your Java installation, you can SSH into the application gear and run the <code class="email">java -version</code> command or run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc ssh --app jobstore --command "java -version"</strong></span>
</pre></div><p class="calibre6">In this recipe, you will learn how you can choose among different supported versions of Java.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note20" class="calibre1"/>Note</h3><p class="calibre6">This recipe will work with all the four supported Java cartridges (Apache Tomcat 6, Apache Tomcat 7, JBoss AS7, and JBoss EAP).</p></div></div>

<div class="book" title="Choosing between Java 6 and Java 7">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch07lvl2sec354" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Perform the following steps to switch to OpenJDK 6:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Create a new JBoss AS 7 application by running the<a id="id722" class="calibre1"/> following command. If you already have a Java application deployed on OpenShift, then you can use that as well.<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc create-app myapp jbossas-7</strong></span>
</pre></div></li><li class="listitem" value="2">Once the application is created, you can check the default Java version by running the <code class="email">java -version</code> command on the application gear as shown in the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc ssh --command "java -version"</strong></span>
<span class="strong"><strong class="calibre7">java version "1.7.0_51"</strong></span>
<span class="strong"><strong class="calibre7">OpenJDK Runtime Environment (rhel-2.4.4.1.el6_5-i386 u51-b02)</strong></span>
<span class="strong"><strong class="calibre7">OpenJDK Server VM (build 24.45-b08, mixed mode)</strong></span>
</pre></div></li><li class="listitem" value="3">To configure your application to use Java 6, delete a marker file called <code class="email">java7</code> in the <code class="email">.openshift/markers</code> directory as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rm –f .openshift/markers/java7</strong></span>
</pre></div></li><li class="listitem" value="4">Commit the changes and push them to your application gear as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ git commit –am "switched to Java 6"</strong></span>
<span class="strong"><strong class="calibre7">$ git push</strong></span>
</pre></div></li><li class="listitem" value="5">After a successful <a id="id723" class="calibre1"/>build, run the <code class="email">java -version</code> command<a id="id724" class="calibre1"/> again to verify that you are now using Java 6 as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc ssh --command "java -version"</strong></span>
<span class="strong"><strong class="calibre7">java version "1.6.0_30"</strong></span>
<span class="strong"><strong class="calibre7">OpenJDK Runtime Environment (IcedTea6 1.13.1) (rhel-3.1.13.1.el6_5-i386)</strong></span>
<span class="strong"><strong class="calibre7">OpenJDK Server VM (build 23.25-b01, mixed mode)</strong></span>
</pre></div></li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Choosing between Java 6 and Java 7">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch07lvl2sec355" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">OpenShift uses the marker files to configure various aspects of the application, such as the Java version, hot deployment, debugging, and so on. The presence of a marker file in the <code class="email">.openshift/markers</code> location tells OpenShift that you want to enable the feature. For example, every OpenShift application has a <code class="email">java7</code> marker file in the <code class="email">.openshift/markers</code> directory that informs OpenShift that it should use Java 7 for application deployment. When you perform code deployment using <code class="email">git push</code>, OpenShift will set the <code class="email">JAVA_HOME</code> environment variable depending on the Java version you want to use in your application.</p><p class="calibre6">To use Java 6, you just deleted the <code class="email">java7</code> marker file. This informs OpenShift that it should fall back to Java 6. From now on, your application will use Java 6.</p></div></div>

<div class="book" title="Choosing between Java 6 and Java 7">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch07lvl2sec356" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Taking thread dumps of Java cartridges</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Enabling hot deployment for Java applications</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Enabling hot deployment for Java applications"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch07lvl1sec91" class="calibre1"/>Enabling hot deployment for Java applications</h1></div></div></div><p class="calibre6">Every time you make a change<a id="id725" class="calibre1"/> and push it to the OpenShift application <a id="id726" class="calibre1"/>gear, OpenShift stops your gear (that is, all the cartridges), copies the source code from your application Git repo to <code class="email">app-root/runtime/repo</code>, performs a build, prepares the artifact, and finally starts your gear (that is, all the cartridges). This process takes time and does not suit rapid development. To enable rapid development and faster deployment, OpenShift supports hot deployment. Hot deployment means that you can deploy your changes without the need to restart all the application cartridges.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note21" class="calibre1"/>Note</h3><p class="calibre6">This recipe will work with all the four supported Java cartridges (Apache Tomcat 6, Apache Tomcat 7, JBoss AS7, and JBoss EAP).</p></div></div>

<div class="book" title="Enabling hot deployment for Java applications">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch07lvl2sec357" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Perform the following steps to enable hot deployment:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open a new command-line terminal, and navigate to the directory where you want to create the application. To create a new JBoss EAP application, execute the following command. If you already have an OpenShift Java application, then you can work with that as well. Have a look at the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc create-app myapp jbosseap</strong></span>
</pre></div></li><li class="listitem" value="2">To enable hot deployment, create a new file with the name <code class="email">hot_deploy</code> inside the <code class="email">.openshift/markers</code> directory. On *nix machines, you can create a new file using the <code class="email">touch</code> command as shown in the following command. On Windows machines, you can use file explorer to create a new file. Have a look at the following code:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ touch .openshift/markers/hot_deploy</strong></span>
</pre></div></li><li class="listitem" value="3">Add the new file to the Git repository index, commit it to the local repository, and then push the changes to the application's remote Git repository:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ git add .openshift/markers/hot_deploy</strong></span>
<span class="strong"><strong class="calibre7">$ git commit –am "enabled hot deployment"</strong></span>
<span class="strong"><strong class="calibre7">$ git push</strong></span>
</pre></div></li><li class="listitem" value="4">In the <code class="email">git push</code> logs, you will see a message that cartridges are not stopped because hot deployment is enabled as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">remote: Not stopping cartridge jbosseap because hot deploy is enabled</strong></span>
</pre></div></li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Enabling hot deployment for Java applications">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch07lvl2sec358" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">The presence of the <code class="email">hot_deploy</code> marker file<a id="id727" class="calibre1"/> informs OpenShift that you<a id="id728" class="calibre1"/> want to do hot deployment. Before stopping and starting the application cartridges, OpenShift checks for the existence of the <code class="email">hot_deploy</code> marker file. For JBoss cartridges, hot deployment is achieved by using the JBoss deployment scanner. The scanner polls the <code class="email">deployments</code> directory every 5 seconds to check for the existence of the WAR file. If the WAR file exists, it will undeploy the existing WAR file and deploy the new WAR file. You can configure the deployment scanner's <code class="email">scan-interval</code> option in <code class="email">.openshift/config/standalone.xml</code>:</p><div class="informalexample"><pre class="programlisting">&lt;subsystem &gt;
&lt;deployment-scanner path="deployments" relative-to="jboss.server.base.dir"
scan-interval="5000" deployment-timeout="300" /&gt;
&lt;/subsystem&gt;</pre></div><p class="calibre6">When your application is using hot deploy, then your application will have downtime starting when the JBoss deployment scanner recognizes the new WAR file, undeploys the old one, and deploys the new WAR file. Your application will be back online once the new file is deployed.</p><p class="calibre6">Hot deployment is ideal for development, and I recommend you should always use it during development.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note22" class="calibre1"/>Note</h3><p class="calibre6">If you set new environment variables with hot deployment enabled, then you have to restart the application to allow the server to pick the new environment variables.</p></div></div></div>

<div class="book" title="Enabling hot deployment for Java applications">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch07lvl2sec359" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Taking thread dumps of Java cartridges</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Choosing between Java 6 and Java 7</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Skipping the Maven build"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch07lvl1sec92" class="calibre1"/>Skipping the Maven build</h1></div></div></div><p class="calibre6">Every OpenShift Java application <a id="id729" class="calibre1"/>is a Maven-based application. Whenever you run a <code class="email">git push</code> command, a Maven build is performed, and the resulting archive (WAR or EAR) is deployed. There are scenarios where you don't want to do a Maven build with every push to the gear. These scenarios can be WAR deployment or executing only action hooks. In this recipe, you will learn how to skip the Maven build step during deployment.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note23" class="calibre1"/>Note</h3><p class="calibre6">This recipe will work with all the four supported Java cartridges (Apache Tomcat 6, Apache Tomcat 7, JBoss AS7, and JBoss EAP).</p></div></div>

<div class="book" title="Skipping the Maven build">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch07lvl2sec360" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To complete this recipe, you will need the <code class="email">jobstore</code> application created in the <span class="strong"><em class="calibre10">Creating and deploying Java EE 6 applications using the JBoss EAP and PostgreSQL 9.2 cartridges</em></span> recipe. Please refer to this recipe if you don't have a running OpenShift application.</p></div></div>

<div class="book" title="Skipping the Maven build">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch07lvl2sec361" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Perform the following steps to skip the Maven build:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open a new command-line terminal, and navigate to the directory where the <code class="email">jobstore</code> application is located. If you don't have a Java OpenShift application, then you can recreate a new application by following the steps mentioned in the <span class="strong"><em class="calibre10">Creating and deploying Java EE 6 applications using the JBoss EAP and PostgreSQL 9.2 cartridges</em></span> recipe.</li><li class="listitem" value="2">To skip a Maven build during deployment, create a marker file called <code class="email">skip_maven_build</code> in the <code class="email">.openshift/markers</code> directory. On *nix systems, you can use the <code class="email">touch</code> command as shown in the following command. On Windows machines, you can use file explorer. Have a look at the following code:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ touch .openshift/markers/skip_maven_build</strong></span>
</pre></div></li><li class="listitem" value="3">Add the new file to the Git repository index, commit it to the local repository, and then push the changes to the application's remote Git repository as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ git add .openshift/markers/skip_maven_build</strong></span>
<span class="strong"><strong class="calibre7">$ git commit –am "skipmaven build"</strong></span>
<span class="strong"><strong class="calibre7">$ git push</strong></span>
</pre></div></li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Skipping the Maven build">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch07lvl2sec362" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">The presence<a id="id730" class="calibre1"/> of the <code class="email">skip_maven_build</code> marker informs OpenShift that it should not build the application. In the <code class="email">git push</code> command output, you will see that the Maven build is skipped because of the presence of the <code class="email">skip_maven_build</code> marker file:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">remote: skip_maven_build marker found; build will be skipped</strong></span>
</pre></div></div></div>

<div class="book" title="Skipping the Maven build">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch07lvl2sec363" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre6">Another way to skip the Maven build is to delete the <code class="email">pom.xml</code> file. If there is no <code class="email">pom.xml</code> file, then OpenShift does not try to build the application.</p></div></div>

<div class="book" title="Skipping the Maven build">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch07lvl2sec364" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Forcing a clean Maven build</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Installing the JAR file not present in the Maven central repository</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Overriding the default Maven build command</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Forcing a clean Maven build"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch07lvl1sec93" class="calibre1"/>Forcing a clean Maven build</h1></div></div></div><p class="calibre6">The first time you push your<a id="id731" class="calibre1"/> changes to the application gear, Maven will download all the dependencies and will store those dependencies in the <code class="email">.m2</code> directory under your application gear home directory. After the first push, OpenShift will reuse all the dependencies in the <code class="email">.m2</code> repository and will only download new dependencies. This saves build time and make application deployment faster. But, there are a few situations when you want to do a clean build. One situation can be when you want to download all the latest Maven dependencies. In this recipe, you will learn how you can inform OpenShift to perform a clean build.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note24" class="calibre1"/>Note</h3><p class="calibre6">This recipe will work with all the four supported Java cartridges (Apache Tomcat 6, Apache Tomcat 7, JBoss AS7, and JBoss EAP).</p></div></div>

<div class="book" title="Forcing a clean Maven build">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch07lvl2sec365" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To complete this recipe, you will need the <code class="email">jobstore</code> application created in the <span class="strong"><em class="calibre10">Creating and deploying Java EE 6 applications using the JBoss EAP and PostgreSQL 9.2 cartridges</em></span> recipe. Please refer to this recipe if you don't have a running OpenShift application.</p></div></div>

<div class="book" title="Forcing a clean Maven build">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch07lvl2sec366" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Perform the following steps to force a clean Maven build of your Java application:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open a new command-line terminal, and navigate to the directory where the <code class="email">jobstore</code> application is located. If you don't have a Java OpenShift application, then you can recreate a new application by following the steps mentioned in the <span class="strong"><em class="calibre10">Creating and deploying Java EE 6 applications using the JBoss EAP and PostgreSQL 9.2 cartridges</em></span> recipe.</li><li class="listitem" value="2">To force a clean Maven build during deployment, create a marker file called <code class="email">force_clean_build</code> inside the application's<code class="email">.openshift/markers</code> directory. On *nix systems, you can use the <code class="email">touch</code> command as shown in the following command. On Windows machines, you can use file explorer. Have a look at the following screenshot:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ touch .openshift/markers/force_clean_build</strong></span>
</pre></div></li><li class="listitem" value="3">Add the new file to the Git repository index, commit it to the local repository, and then push the changes to the application's remote Git repository as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ git add .openshift/markers/force_clean_build</strong></span>
<span class="strong"><strong class="calibre7">$ git commit –am "force_clean_buildmarker added"</strong></span>
<span class="strong"><strong class="calibre7">$ git push</strong></span>
</pre></div></li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Forcing a clean Maven build">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch07lvl2sec367" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">The presence of<a id="id732" class="calibre1"/> the <code class="email">force_clean_build</code> marker file informs OpenShift that you want to do a clean build. When you run a <code class="email">git push</code> command, OpenShift will first delete the <code class="email">.m2</code> directory and then start the build process by invoking the <code class="email">mvn clean package -Popenshift -DskipTests</code> command. Maven will now download all the dependencies again. You will see the following log message in the <code class="email">git push</code> command output. Have a look at the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">remote: Force clean build enabled - cleaning dependencies</strong></span>
</pre></div></div></div>

<div class="book" title="Forcing a clean Maven build">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch07lvl2sec368" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Forcing a clean Maven build</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Installing the JAR file not present in the Maven central repository</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Overriding the default Maven build command</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Overriding the default Maven build command"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch07lvl1sec94" class="calibre1"/>Overriding the default Maven build command</h1></div></div></div><p class="calibre6">OpenShift, by default, will execute the <code class="email">mvn -e clean package -Popenshift -DskipTests</code> command to build the project. If you don't want to use the OpenShift Maven profile or want to run tests, then you have to tell OpenShift to run a different command. In this recipe, you <a id="id733" class="calibre1"/>will learn how you can tell OpenShift to use a different command.</p></div>

<div class="book" title="Overriding the default Maven build command">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch07lvl2sec369" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To complete this recipe, you will need the <code class="email">jobstore</code> application created in the <span class="strong"><em class="calibre10">Creating and deploying Java EE 6 applications using the JBoss EAP and PostgreSQL 9.2 cartridges</em></span> recipe. Please refer to this recipe if you don't have a running OpenShift application.</p></div></div>

<div class="book" title="Overriding the default Maven build command">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch07lvl2sec370" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Perform the following steps to <a id="id734" class="calibre1"/>override the default Maven build command:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open a new command-line terminal, and navigate to the directory where the <code class="email">jobstore</code> application is located.</li><li class="listitem" value="2">To configure OpenShift to use a different build command, create a new environment variable with the name <code class="email">MAVEN_ARGS</code>. The value of the <code class="email">MAVEN_ARGS</code> environment variable is the Maven build phases you want to run, as shown in the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc env-set MAVEN_ARGS="clean install"</strong></span>
</pre></div></li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Overriding the default Maven build command">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch07lvl2sec371" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">Before running the build, OpenShift first checks whether the environment variable called <code class="email">MAVEN_ARGS</code> is set. It uses the phases and goals defined in this environment variable to create a Maven command that will be used to build the project. If <code class="email">MAVEN_ARGS</code> is not set, then it will set the default value, that is, <code class="email">clean package -Popenshift -DskipTests</code>, else it will use the value of the <code class="email">MAVEN_ARGS</code> environment variable.</p><p class="calibre6">Now, when you run the <code class="email">git push</code> command, you will see an entry in the <code class="email">git push</code> logs, as shown in the following command output:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">remote: Found pom.xml... attempting to build with 'mvn -e clean install'</strong></span>
</pre></div></div></div>

<div class="book" title="Overriding the default Maven build command">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch07lvl2sec372" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Forcing a clean Maven build</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Installing the JAR file not present in the Maven central repository</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Skipping the Maven build</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Installing the JAR file not present in the Maven central repository"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch07lvl1sec95" class="calibre1"/>Installing the JAR file not present in the Maven central repository</h1></div></div></div><p class="calibre6">OpenShift will download all the<a id="id735" class="calibre1"/> dependencies from the Maven central repositories specified <a id="id736" class="calibre1"/>in your <code class="email">pom.xml</code> file. There are times when your application depends on the libraries that do not exist in any public Maven repository. In this recipe, you will learn how you can use the OpenShift action hooks to install a local JAR.</p></div>

<div class="book" title="Installing the JAR file not present in the Maven central repository">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch07lvl2sec373" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To complete this recipe, you will need the <code class="email">jobstore</code> application created in the <span class="strong"><em class="calibre10">Creating and deploying Java EE 6 applications using the JBoss EAP and PostgreSQL 9.2 cartridges</em></span> recipe. Please refer to this recipe if you don't have a running OpenShift application.</p></div></div>

<div class="book" title="Installing the JAR file not present in the Maven central repository">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch07lvl2sec374" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Perform the following steps to install the JAR file not present in the configured Maven repositories:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open a new command-line terminal, and navigate to the directory where the <code class="email">jobstore</code> application is located.</li><li class="listitem" value="2">Create a <code class="email">lib</code> directory in the root of your application directory, and add your local JAR file here. To demonstrate this recipe, I have created a simple library that you can download from <a class="calibre1" href="https://github.com/OpenShift-Cookbook/chapter7-recipe14/raw/master/lib/simplelogger-0.0.1.jar">https://github.com/OpenShift-Cookbook/chapter7-recipe14/raw/master/lib/simplelogger-0.0.1.jar</a>.</li><li class="listitem" value="3">Create a <code class="email">pre_build</code> action hook inside the <code class="email">.openshift/action_hooks</code> directory, and add the following content to it:<div class="informalexample"><pre class="programlisting">#!/bin/bash</pre></div><p class="calibre14">The following command will install the JAR file to the local Maven repository located on the application gear:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">mvn install:install-file -Dfile=$OPENSHIFT_REPO_DIR/lib/simplelogger-0.0.1.jar -DgroupId=org.osbook -DartifactId=simplelogger -Dversion=0.0.1 -Dpackaging=jar</strong></span>
</pre></div></li><li class="listitem" value="4">Make sure the <code class="email">pre_build</code> action hook is executable. You can make the <code class="email">pre_build</code> action hook script executable by running the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ chmod +x .openshift/action_hooks/pre_build</strong></span>
</pre></div></li><li class="listitem" value="5">Add the dependency to the application's <code class="email">pom.xml</code> file so that your application can use the library in the application source code as follows:<div class="informalexample"><pre class="programlisting">&lt;dependency&gt;
&lt;groupId&gt;org.osbook&lt;/groupId&gt;
&lt;artifactId&gt;simplelogger&lt;/artifactId&gt;
&lt;version&gt;0.0.1&lt;/version&gt;
&lt;/dependency&gt;</pre></div></li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Installing the JAR file not present in the Maven central repository">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch07lvl2sec375" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">In step 2, you created a <code class="email">lib</code> directory inside the application source code root. You downloaded the <code class="email">simplelogging</code> library and placed it in the <code class="email">lib</code> directory. Next, in step 2, you created a <code class="email">pre_build</code> action hook that installs the <code class="email">simplelogging-0.0.1.jar</code> file into the application gear's<code class="email">.m2</code> repository. The <code class="email">pre_build</code> script is executed before the build step. This means your library will be available during the build.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note25" class="calibre1"/>Note</h3><p class="calibre6">On Windows, the execute permissions on the action hooks will be lost during <code class="email">git push</code>. You can fix the problem by running the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">git update-index --chmod=+x .openshift/action_hooks/*</strong></span>
</pre></div></div><p class="calibre6">Finally, you added the<a id="id737" class="calibre1"/> library as a dependency in your application's <code class="email">pom.xml</code> file so<a id="id738" class="calibre1"/> that you can use the library in your application.</p></div></div>

<div class="book" title="Installing the JAR file not present in the Maven central repository">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch07lvl2sec376" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Forcing a clean Maven build</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Overriding the default Maven build command</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Skipping the Maven build</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Developing OpenShift Java applications using Eclipse"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch07lvl1sec96" class="calibre1"/>Developing OpenShift Java applications using Eclipse</h1></div></div></div><p class="calibre6">You can build, deploy, and <a id="id739" class="calibre1"/>manage your OpenShift Java <a id="id740" class="calibre1"/>applications right from within the Eclipse IDE using the JBoss Tools OpenShift plugin. This recipe will guide you through installation, setup, application creation, and managing your application from within Eclipse. In this recipe, you will develop a Java EE 6 PostgreSQL 9.2 application and deploy it on the JBoss EAP 6 application server running on OpenShift all from within Eclipse.</p></div>

<div class="book" title="Developing OpenShift Java applications using Eclipse">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch07lvl2sec377" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">Download the latest Eclipse package<a id="id741" class="calibre1"/> for your operating system from the official Eclipse website at <a class="calibre1" href="http://www.eclipse.org/downloads/">http://www.eclipse.org/downloads/</a>. At the time of this writing, the latest Eclipse package is Kepler.</p><p class="calibre6">It is very easy to install Eclipse; just extract the downloaded package, and we are done. On Linux and Mac, open a new command-line terminal, and type the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ tar -xzvf eclipse-jee-kepler-R-*.tar.gz </strong></span>
</pre></div><p class="calibre6">On Windows, you can extract the ZIP file using WinZip or 7-zip<a id="id742" class="calibre1"/> (<a class="calibre1" href="http://www.7-zip.org/download.html">http://www.7-zip.org/download.html</a>) or any other software.</p><p class="calibre6">After we have extracted the<a id="id743" class="calibre1"/> Eclipse file, there will be a folder <a id="id744" class="calibre1"/>named <code class="email">*eclipse*</code> in the directory where we extracted Eclipse. We can optionally create a shortcut to the executable file.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note26" class="calibre1"/>Note</h3><p class="calibre6">It is recommended that you use the latest version of Eclipse, that is, Kepler, to work with OpenShift. Earlier versions are not supported and might not even work.</p></div></div></div>

<div class="book" title="Developing OpenShift Java applications using Eclipse">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch07lvl2sec378" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Perform the following steps to create OpenShift applications using OpenShift Eclipse tooling:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">After downloading and extracting the Eclipse Kepler IDE for Java EE, open Eclipse, and navigate to the project workspace. Navigate to <span class="strong"><strong class="calibre7">Help</strong></span>|<span class="strong"><strong class="calibre7">Eclipse Marketplace</strong></span>.</li><li class="listitem" value="2">In the search box, type <code class="email">jboss tools</code>, and then click on the <span class="strong"><strong class="calibre7">Go</strong></span> button. After clicking on the <span class="strong"><strong class="calibre7">Go</strong></span> button, we will see <span class="strong"><strong class="calibre7">JBoss Tools (Kepler)</strong></span> as the first result. Now click on the <span class="strong"><strong class="calibre7">Install</strong></span> button. Have a look at the following screenshot:<div class="mediaobject"><img src="../images/00065.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="3">After clicking on <a id="id745" class="calibre1"/>the <span class="strong"><strong class="calibre7">Install</strong></span> button, you <a id="id746" class="calibre1"/>will get a list of plugins that you can install. As the purpose of this recipe is to demonstrate the OpenShift Eclipse support, we will only select <span class="strong"><strong class="calibre7">JBoss OpenShift Tools</strong></span> from the list. After selecting <span class="strong"><strong class="calibre7">JBoss OpenShift Tools</strong></span>, click on the <span class="strong"><strong class="calibre7">Confirm</strong></span> button. Have a look at the following screenshot:<div class="mediaobject"><img src="../images/00066.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="4">Accept the license<a id="id747" class="calibre1"/> by clicking on<a id="id748" class="calibre1"/> the <span class="strong"><strong class="calibre7">I accept the terms of the license agreement</strong></span> radio button, and then click on the <span class="strong"><strong class="calibre7">Finish</strong></span> button.</li><li class="listitem" value="5">As the JBoss Tools OpenShift plugin is unsigned, you will get a security message. Click on the <span class="strong"><strong class="calibre7">OK</strong></span> button, and restart Eclipse to apply the changes.</li><li class="listitem" value="6">Now that you've installed the OpenShift Eclipse plugin, you have everything required to start building the application. Create a new OpenShift application by navigating to <span class="strong"><strong class="calibre7">File</strong></span>|<span class="strong"><strong class="calibre7">New</strong></span>|<span class="strong"><strong class="calibre7">Other</strong></span>|<span class="strong"><strong class="calibre7">OpenShift Application</strong></span>:<div class="mediaobject"><img src="../images/00067.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="7">Click on the <span class="strong"><strong class="calibre7">Next</strong></span> button, and you will be asked to provide your OpenShift account credentials. If you do not have an OpenShift account, you can click on the sign up <span class="strong"><strong class="calibre7">here</strong></span> <a id="id749" class="calibre1"/>link on the wizard <a id="id750" class="calibre1"/>to create a new OpenShift account. Have a look at the following screenshot:<div class="mediaobject"><img src="../images/00068.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="8">Enter your OpenShift account details. Also, check the <span class="strong"><strong class="calibre7">Save password</strong></span> checkbox so that we do not have to enter the password with every command. Click on the <span class="strong"><strong class="calibre7">Next</strong></span> button. Have a look at the following screenshot:<div class="mediaobject"><img src="../images/00069.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="9">After clicking<a id="id751" class="calibre1"/> on the <span class="strong"><strong class="calibre7">Next</strong></span> button, you<a id="id752" class="calibre1"/> will be asked to enter additional information for password recovery. I choose <span class="strong"><strong class="calibre7">No</strong></span>, but you can choose <span class="strong"><strong class="calibre7">Yes</strong></span> as well.</li><li class="listitem" value="10">Next, you will be asked to create a new OpenShift domain if you don't have a domain associated with your account already. The domain name is the unique namespace, and all the user applications will exist under this namespace. This is shown in the following screenshot:<div class="mediaobject"><img src="../images/00070.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="11">Next, you will be <a id="id753" class="calibre1"/>asked to upload your<a id="id754" class="calibre1"/> public SSH keys to OpenShift, as shown in the following screenshot:<div class="mediaobject"><img src="../images/00071.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="12">You can either upload your existing SSH keys or create a new SSH key by clicking on the <span class="strong"><strong class="calibre7">New</strong></span> button. Let's create a new key by clicking on the <span class="strong"><strong class="calibre7">New</strong></span> button. We need to provide a name for the key and a name for the private and public key filenames. I have used my name as the key name and filename. Have a look at the following screenshot:<div class="mediaobject"><img src="../images/00072.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="13">Now, you will be <a id="id755" class="calibre1"/>directed to the <a id="id756" class="calibre1"/>application creation wizard where you have to enter the application details. The details include the name of the application, the type of the application, the gear profile (whether you want a small, medium, or large instance; in a free tier, you have access only to small instances), whether you want a scalable application or a nonscalable application, and whether you want to embed any or multiple cartridges, such as MySQL, PostgreSQL, MongoDB, and others. For our application, we will select the JBoss EAP and PostgreSQL cartridges. We will name the application <code class="email">jobstore</code> as shown in the following screenshot:<div class="mediaobject"><img src="../images/00073.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="14">Next, you have to <a id="id757" class="calibre1"/>set up a <code class="email">jobstore</code> application <a id="id758" class="calibre1"/>and configure the server adapter settings. Choose the default and click on <span class="strong"><strong class="calibre7">Next</strong></span>.</li><li class="listitem" value="15">The next screen will ask us to specify the location where we want to clone the Git repository and the name of the Git remote. Have a look at the following screenshot:<div class="mediaobject"><img src="../images/00074.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="16">Finally, click on the <a id="id759" class="calibre1"/><span class="strong"><strong class="calibre7">Finish</strong></span> button to initiate <a id="id760" class="calibre1"/>the application creation process. This will create an application container for us, called a gear, and set up all the required SELinux policies and cgroup configuration. OpenShift will install the PostgreSQL cartridge on the application gear, and the JBoss Tools OpenShift plugin will show an information box with the PostgreSQL details.</li><li class="listitem" value="17">Finally, the project is imported as a Maven project in the Eclipse workspace. After importing the application to Eclipse, you will be asked whether you want to publish the uncommitted changes. You might start wondering why it is asking you to publish changes. The reason is that when a project is imported into Eclipse, JBoss Tools creates a new file called <code class="email">.jsdtscope</code> under the <code class="email">.settings</code> directory. As the file is not ignored, the OpenShift Eclipse plugin asks you for a deployment. You can easily ignore the file by navigating to the <span class="strong"><strong class="calibre7">Git Staging</strong></span> view. To open the <span class="strong"><strong class="calibre7">Git Staging</strong></span> view, navigate to <span class="strong"><strong class="calibre7">Window</strong></span>|<span class="strong"><strong class="calibre7">Show View</strong></span>|<span class="strong"><strong class="calibre7">Other</strong></span>|<span class="strong"><strong class="calibre7">Git</strong></span>|<span class="strong"><strong class="calibre7">Git Staging</strong></span>. Have a look at the following screenshot:<div class="mediaobject"><img src="../images/00075.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="18">Right-click on <a id="id761" class="calibre1"/>the <code class="email">.jsdtscope</code> file under<a id="id762" class="calibre1"/> the <span class="strong"><strong class="calibre7">Git Staging</strong></span> view, and then choose <span class="strong"><strong class="calibre7">Ignore</strong></span>. Have a look at the following screenshot:<div class="mediaobject"><img src="../images/00076.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="19">Next, open the <span class="strong"><strong class="calibre7">OpenShift Explorer</strong></span> view. Navigate to <span class="strong"><strong class="calibre7">Window</strong></span>|<span class="strong"><strong class="calibre7">Show View</strong></span>|<span class="strong"><strong class="calibre7">Other</strong></span>|<span class="strong"><strong class="calibre7">JBoss Tools</strong></span>|<span class="strong"><strong class="calibre7">OpenShift Explorer</strong></span>. This will open up a new view as shown in the following screenshot:<div class="mediaobject"><img src="../images/00077.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="20">Now, right-click on the application, and then click on the <span class="strong"><strong class="calibre7">Show in Web Browser</strong></span> option. This will open up the template application in the default browser.</li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Developing OpenShift Java applications using Eclipse">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch07lvl2sec379" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">The preceding steps help<a id="id763" class="calibre1"/> you to create OpenShift Java <a id="id764" class="calibre1"/>applications using Eclipse. In this recipe, I used the JBoss EAP cartridge, but you can do the same for the Tomcat or JBoss AS7 cartridge. The preceding steps are self-explanatory and do not require any explanation. Now, I will explain to you how your development workflow should work. The recommended way to work with OpenShift Eclipse tooling is split into two steps, which are as follows:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Write code for functionality, and then commit the code to a Git local repository using the <span class="strong"><strong class="calibre7">Git Staging</strong></span> view. The <span class="strong"><strong class="calibre7">Git Staging</strong></span> view gives a graphical view to the changes, and you can easily compare and look at all the files we have changed.</li><li class="listitem" value="2">In the <span class="strong"><strong class="calibre7">Git Staging</strong></span> view, you have two options. You can either commit the changes to the local repository or do a commit and push together. When you perform <code class="email">git commit</code> and <code class="email">push</code> together, the code is pushed to a Git remote called <code class="email">origin</code>. The <code class="email">origin</code> remote points to a private Git repository created by OpenShift. When the code is pushed to the remote repository, OpenShift will kick off the build. The problem with the <span class="strong"><strong class="calibre7">Git Staging</strong></span> view <span class="strong"><strong class="calibre7">Commit and Push</strong></span> button is that you will not be able to monitor the application build logs. To view the application build logs, you should use the server view publication mechanism. We will use the server configured for the <code class="email">jobstore</code> OpenShift application. To publish the changes, right-click on the server, and click on <span class="strong"><strong class="calibre7">Publish</strong></span>. This internally does a <code class="email">git push</code>. The advantage of this approach is that it will open up a new console view, where we can monitor the application build progress.</li></ol><div class="calibre13"/></div><p class="calibre6">Let's make a small change to the application to better understand the development workflow discussed in the previous section. Open the <code class="email">index.html</code> file, and consider the following code:</p><div class="informalexample"><pre class="programlisting">&lt;h1&gt;
    Welcome to OpenShift, JBossEAP6.0 Cartridge
&lt;/h1&gt;</pre></div><p class="calibre6">And change it to:</p><div class="informalexample"><pre class="programlisting">&lt;h1&gt;
Welcome to JobStore application
&lt;/h1&gt;</pre></div><p class="calibre6">Go to the <span class="strong"><strong class="calibre7">Git Staging</strong></span> view, and<a id="id765" class="calibre1"/> you will see the change shown<a id="id766" class="calibre1"/> in the following screenshot:</p><div class="mediaobject"><img src="../images/00078.jpeg" alt="How it works…" class="calibre8"/></div><p class="calibre9"> </p><p class="calibre6">Next, drag the change to <span class="strong"><strong class="calibre7">Staged Changes</strong></span>, and write a commit message. Have a look at the following screenshot:</p><div class="mediaobject"><img src="../images/00079.jpeg" alt="How it works…" class="calibre8"/></div><p class="calibre9"> </p><p class="calibre6">Commit the change by clicking on the <span class="strong"><strong class="calibre7">Commit</strong></span> button. As I mentioned before, do not use <span class="strong"><strong class="calibre7">Commit and Push</strong></span>, as that will trigger application deployment and will not show the build log. The build log is very useful when the build fails.</p><p class="calibre6">Go to the <span class="strong"><strong class="calibre7">Servers</strong></span> view, and you will see a server configured for the <code class="email">jobstore</code> application.</p><p class="calibre6">Right-click on the application<a id="id767" class="calibre1"/> server, and then <a id="id768" class="calibre1"/>click on <span class="strong"><strong class="calibre7">Publish</strong></span>. Have a look at the following screenshot:</p><div class="mediaobject"><img src="../images/00080.jpeg" alt="How it works…" class="calibre8"/></div><p class="calibre9"> </p><p class="calibre6">You will get a dialog where you have to confirm whether you want to publish the changes or not. Click on <span class="strong"><strong class="calibre7">Yes</strong></span>, and it will open a new <span class="strong"><strong class="calibre7">Console</strong></span> view where we can track the build progress. Have a look at the following screenshot:</p><div class="mediaobject"><img src="../images/00081.jpeg" alt="How it works…" class="calibre8"/></div><p class="calibre9"> </p><p class="calibre6">To view the logfiles of the JBoss EAP application server, go to the <span class="strong"><strong class="calibre7">OpenShift Explorer</strong></span> view, and right-click on the <a id="id769" class="calibre1"/>application. Click on <span class="strong"><strong class="calibre7">Tail files…</strong></span>. Have a <a id="id770" class="calibre1"/>look at the following screenshot:</p><div class="mediaobject"><img src="../images/00082.jpeg" alt="How it works…" class="calibre8"/></div><p class="calibre9"> </p><p class="calibre6">Next, you will configure to tail only the JBoss EAP <code class="email">server.log</code> file. By default, it will tail all the logfiles, which includes the database logfiles as well, as shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00083.jpeg" alt="How it works…" class="calibre8"/></div><p class="calibre9"> </p><p class="calibre6">It will open up another console view where it will tail only the JBoss EAP <code class="email">server.log</code> file.</p><p class="calibre6">Finally, we can view the change in the browser by right-clicking on the <span class="strong"><strong class="calibre7">jobstore</strong></span> server, and then navigating to <span class="strong"><strong class="calibre7">Show In</strong></span>|<span class="strong"><strong class="calibre7">Web Browser</strong></span>. This will open up the default web browser, where we can view <a id="id771" class="calibre1"/>the change that we made <a id="id772" class="calibre1"/>in <code class="email">index.html</code>.</p></div></div>

<div class="book" title="Developing OpenShift Java applications using Eclipse">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch07lvl2sec380" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre6">You can do a lot more with the OpenShift Eclipse plugin. For faster development, you should enable hot deployment. The OpenShift Eclipse plugin makes it very easy to enable hot deployment. To enable hot deployment, right-click on the project, and then navigate to <span class="strong"><strong class="calibre7">OpenShift</strong></span>|<span class="strong"><strong class="calibre7">Configure Markers</strong></span>. Have a look at the following screenshot:</p><div class="mediaobject"><img src="../images/00084.jpeg" alt="There's more…" class="calibre8"/></div><p class="calibre9"> </p><p class="calibre6">Then, you will see a view where you can configure which OpenShift markers you want to enable for the application. Select the <span class="strong"><strong class="calibre7">Hot Deploy</strong></span> marker. Have a look at the following screenshot:</p><div class="mediaobject"><img src="../images/00085.jpeg" alt="There's more…" class="calibre8"/></div><p class="calibre9"> </p><p class="calibre6">This will create a new empty file called <code class="email">hot_deploy</code> in the <code class="email">.openshift/markers</code> directory. You can commit the changes by going to the <span class="strong"><strong class="calibre7">Git Staging</strong></span> view. Go to the <span class="strong"><strong class="calibre7">Servers</strong></span> view, and publish this change. The build log will show that the cartridges are not stopped as hot deploy is enabled. Have a look at the following build log:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">Not stopping cartridge jbosseap because hot deploy is enabled</strong></span>
<span class="strong"><strong class="calibre7">Not stopping cartridge postgresql because hot deploy is enabled</strong></span>
</pre></div></div></div>

<div class="book" title="Developing OpenShift Java applications using Eclipse">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch07lvl2sec381" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Using Eclipse System Explorer to SSH into the application gear</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Debugging Java applications in the Cloud</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Using Eclipse System Explorer to SSH into the application gear"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch07lvl1sec97" class="calibre1"/>Using Eclipse System Explorer to SSH into the application gear</h1></div></div></div><p class="calibre6">In this recipe, you will learn how you <a id="id773" class="calibre1"/>can SSH into the application gear from within Eclipse.</p></div>

<div class="book" title="Using Eclipse System Explorer to SSH into the application gear">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch07lvl2sec382" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">This recipe requires you to have Eclipse with the JBoss Tools OpenShift plugin installed. Please refer to the <span class="strong"><em class="calibre10">Developing OpenShift Java applications using Eclipse</em></span> recipe for more information.</p></div></div>

<div class="book" title="Using Eclipse System Explorer to SSH into the application gear">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch07lvl2sec383" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Perform the following steps to<a id="id774" class="calibre1"/> learn how to SSH into the application gear from within Eclipse:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Create a new application using the OpenShift Eclipse plugin. Refer to the <span class="strong"><em class="calibre10">Developing OpenShift Java applications using Eclipse</em></span> recipe for instructions.</li><li class="listitem" value="2">Navigate to <span class="strong"><strong class="calibre7">Window</strong></span>|<span class="strong"><strong class="calibre7">Open Perspective</strong></span>|<span class="strong"><strong class="calibre7">Other</strong></span>|<span class="strong"><strong class="calibre7">Remote System Explorer</strong></span> to open the <span class="strong"><strong class="calibre7">Remote System Explorer</strong></span> perspective. Have a look at the following screenshot:<div class="mediaobject"><img src="../images/00086.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="3">Go to <span class="strong"><strong class="calibre7">OpenShift Explorer</strong></span> and copy the SSH connection details as shown in the following screenshot:<div class="mediaobject"><img src="../images/00087.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="4">Copy the SSH details <a id="id775" class="calibre1"/>as shown in the following screenshot:<div class="mediaobject"><img src="../images/00088.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="5">Go back to the <span class="strong"><strong class="calibre7">Remote System Explorer</strong></span> perspective, and define a new connection to the remote system as shown in the following screenshot:<div class="mediaobject"><img src="../images/00089.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="6">Next, it will ask you to<a id="id776" class="calibre1"/> select the remote system type. Select the <span class="strong"><strong class="calibre7">SSH Only</strong></span> option as shown in the following screenshot:<div class="mediaobject"><img src="../images/00090.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="7">Next, you will be asked to enter the details of the new connection. Enter the hostname of your application as shown in the following screenshot:<div class="mediaobject"><img src="../images/00091.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="8">Click on the <span class="strong"><strong class="calibre7">Finish</strong></span> <a id="id777" class="calibre1"/>button to create a new connection. The connection will be listed in the left-hand side bar.</li><li class="listitem" value="9">To open an SSH terminal, navigate to <span class="strong"><strong class="calibre7">Ssh Terminals</strong></span>|<span class="strong"><strong class="calibre7">Launch Terminal</strong></span> as follows:<div class="mediaobject"><img src="../images/00092.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="10">Next, you will be <a id="id778" class="calibre1"/>asked to enter the user ID with which you want to connect. The user ID is the <code class="email">UUID</code> part of the SSH connection URL. Click on <span class="strong"><strong class="calibre7">OK</strong></span>. Have a look at the following screenshot:<div class="mediaobject"><img src="../images/00093.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="11">Launch the terminal again, and you will see an SSH terminal as shown in the following screenshot:<div class="mediaobject"><img src="../images/00094.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Using Eclipse System Explorer to SSH into the application gear">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch07lvl2sec384" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">In the preceding steps, you <a id="id779" class="calibre1"/>used Eclipse Remote System Explorer to SSH into the OpenShift application gear. Remote System Explorer comes bundled with Eclipse Kepler for Java EE. Remote System Explorer allows you to connect and work with a variety of remote systems. To learn more about Remote System Explorer, you can refer to the documentation<a id="id780" class="calibre1"/> at <a class="calibre1" href="http://help.eclipse.org/kepler/index.jsp?nav=%2F56">http://help.eclipse.org/kepler/index.jsp?nav=%2F56</a>.</p></div></div>

<div class="book" title="Using Eclipse System Explorer to SSH into the application gear">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch07lvl2sec385" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Developing OpenShift Java applications using Eclipse</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Debugging Java applications in the Cloud</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Debugging Java applications in the Cloud"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch07lvl1sec98" class="calibre1"/>Debugging Java applications in the Cloud</h1></div></div></div><p class="calibre6">In this recipe, you will learn <a id="id781" class="calibre1"/>how to debug Java applications running on <a id="id782" class="calibre1"/>OpenShift.</p></div>

<div class="book" title="Debugging Java applications in the Cloud">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch07lvl2sec386" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">This recipe requires you to have Eclipse with the JBoss Tools OpenShift plugin installed. Please refer to the <span class="strong"><em class="calibre10">Developing OpenShift Java applications using Eclipse</em></span> recipe for more information.</p></div></div>

<div class="book" title="Debugging Java applications in the Cloud">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch07lvl2sec387" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Perform the following steps to learn how to debug your Java applications:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">In the <span class="strong"><em class="calibre10">Developing OpenShift Java applications using Eclipse</em></span> recipe, you learned how to create a Java application using the Eclipse plugin. The application that we developed used the OpenShift template application as its starting point. As you might know, in the <code class="email">rhc</code> command line, you can use the <code class="email">--from-code</code> option to specify your own template application. Let's create a new Java application using Eclipse that uses the application we created in the <span class="strong"><em class="calibre10">Creating and deploying Java EE 6 applications using the JBoss EAP and PostgreSQL 9.2 cartridges</em></span> recipe using Eclipse. Create a new OpenShift application by navigating to <span class="strong"><strong class="calibre7">File</strong></span>|<span class="strong"><strong class="calibre7">New</strong></span>|<span class="strong"><strong class="calibre7">Other</strong></span>|<span class="strong"><strong class="calibre7">OpenShift Application</strong></span>. After validating your account, you will get a screen where you need to enter the application details. Please select the <span class="strong"><strong class="calibre7">JBoss EAP</strong></span> and <span class="strong"><strong class="calibre7">PostgreSQL 9.2</strong></span> cartridges. To specify the Git repository, click on the <span class="strong"><strong class="calibre7">Advanced</strong></span> button, and then uncheck the <span class="strong"><strong class="calibre7">Use default source code</strong></span> checkbox. <p class="calibre14">In the input box, specify<a id="id783" class="calibre1"/> the URL of the Git repository as <a id="id784" class="calibre1"/>shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00095.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="2">Next, you have to set up a <code class="email">jobstore</code> application and configure the server adapter settings. Choose the default and click on <span class="strong"><strong class="calibre7">Next</strong></span>.</li><li class="listitem" value="3">The next screen will ask us to specify the location where you want to clone the Git repository and the name of the Git remote. Specify a writable directory, and click on <span class="strong"><strong class="calibre7">Finish</strong></span>.</li><li class="listitem" value="4">Now, a new application instance will be created using the selected cartridges and Git repository. Finally, the project will be imported into Eclipse as a Maven project.</li><li class="listitem" value="5">To enable <a id="id785" class="calibre1"/>debugging, you have to create a new <a id="id786" class="calibre1"/>marker file called <code class="email">enable_jpda</code> inside the <code class="email">.openshift/markers</code> directory. The Eclipse plugin can help us create the file. Right-click on the project, and navigate to <span class="strong"><strong class="calibre7">OpenShift</strong></span> |<span class="strong"><strong class="calibre7">Configure Markers…</strong></span>.</li><li class="listitem" value="6">This will open a dialog where you can select the marker files. Select the <span class="strong"><strong class="calibre7">Enable JPDA</strong></span> marker as shown in the following screenshot. This will create a new file called <code class="email">enable_jpda</code> inside the <code class="email">.openshift/markers</code> directory.<div class="mediaobject"><img src="../images/00096.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="7">Go to the <span class="strong"><strong class="calibre7">Git Staging</strong></span> view, and commit the change. Have a look at the following screenshot:<div class="mediaobject"><img src="../images/00097.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="8">After <a id="id787" class="calibre1"/>committing the change, go to the <span class="strong"><strong class="calibre7">Servers</strong></span><a id="id788" class="calibre1"/> view, and publish your changes. This will start the server with JPDA enabled.</li><li class="listitem" value="9">Now, enable port forwarding so that you can connect with the JPDA port. Go to the <span class="strong"><strong class="calibre7">OpenShift Explorer</strong></span> view, and right-click on the project to enable port forwarding. Have a look at the following screenshot:<div class="mediaobject"><img src="../images/00098.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="10">This will open a dialog where you can configure port forwarding. Click on the <span class="strong"><strong class="calibre7">Start All</strong></span> button to enable port forwarding. The port <code class="email">8787</code> is used to debug. This is shown in the following screenshot:<div class="mediaobject"><img src="../images/00099.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="11">Now, we will<a id="id789" class="calibre1"/> add the breakpoint to<a id="id790" class="calibre1"/> the <code class="email">CompanyResource</code> class at line number 32. After setting the debug point, create a new debug configuration by right-clicking on the debug point, navigating to <span class="strong"><strong class="calibre7">Debug Configurations</strong></span>|<span class="strong"><strong class="calibre7">Remote Java Application</strong></span>|<span class="strong"><strong class="calibre7">New</strong></span> and giving it a name, and enter the port as <code class="email">8787</code> as shown in the following screenshot:<div class="mediaobject"><img src="../images/00100.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="12">After entering<a id="id791" class="calibre1"/> all the details, click on the <a id="id792" class="calibre1"/><span class="strong"><strong class="calibre7">Debug</strong></span> button. Open the debug perspective, and you will see the remote debugger in action. Please note that it will take some time to enable remote debugging, so please be patient. This is shown in the following screenshot:<div class="mediaobject"><img src="../images/00101.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="13">Now, go to <code class="email">http://jobstore-{domain-name}.rhcloud.com/#companies/new</code> and create a new company. This will invoke the breakpoint as shown in the following screenshot:<div class="mediaobject"><img src="../images/00102.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Debugging Java applications in the Cloud">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch07lvl2sec388" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">The preceding steps<a id="id793" class="calibre1"/> enable Java developers to debug<a id="id794" class="calibre1"/> their OpenShift Java applications. To enable debugging, you created a marker file under the<code class="email">.openshift/markers</code> directory using the Eclipse plugin. The file is committed, and the changes are pushed to the OpenShift application gear. After a push, the JBoss server is stopped and then started again. The JBoss cartridge checks the presence of the <code class="email">enable_jpda</code> file. If the <code class="email">enable_jpda</code> marker file exists, then the server is started in debug mode. The debugging provided by JBoss is based on the<a id="id795" class="calibre1"/> <span class="strong"><strong class="calibre7">Java Platform Debugger Architecture</strong></span> (<span class="strong"><strong class="calibre7">JPDA</strong></span>). To enable debugging, the JBoss server is started with the <code class="email">JAVA_OPTS</code> environment variable set to the value shown in the following code:</p><div class="informalexample"><pre class="programlisting">JAVA_OPTS="-Xdebug -Xrunjdwp:transport=dt_socket,address=${OPENSHIFT_JBOSSEAP_IP}:8787,server=y,suspend=n ${JAVA_OPTS}"</pre></div><p class="calibre6">As the port <code class="email">8787</code> is not accessible to the outside world, you have to enable port forwarding. After enabling port forwarding, you created a new remote Java application that will connect to the JBoss EAP cartridge running in debug mode.</p></div></div>

<div class="book" title="Debugging Java applications in the Cloud">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch07lvl2sec389" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Developing OpenShift Java applications using Eclipse</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Using Eclipse System Explorer to SSH into the application gear</em></span> recipe</li></ul></div></div></div></body></html>