- en: Understanding Identity Synchronization
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 理解身份同步
- en: The main component in a hybrid identity and access management solution is the
    connectivity between the on-premises **Active Directory** (**AD**)and the **Azure**
    **Active Directory** (**A****AD**), including the related synchronization of objects
    and attributes. Microsoft tries to make the synchronization process straightforward
    without administrators needing to have the complete details of the system under
    the hood.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 混合身份和访问管理解决方案的主要组成部分是本地 **Active Directory**（**AD**）与 **Azure** **Active Directory**（**AAD**）之间的连接，包括对象和属性的相关同步。微软力图使同步过程简化，管理员无需了解系统内部的所有细节。
- en: In this chapter, we'll discuss the essential identity-synchronization scenarios
    and tools for the successful implementation of a full hybrid identity life cycle
    management. We'll start with an overview of the **Microsoft Identity Manager** (**MIM**)
    and the Azure AD Connect tool, and then we can dive into the identity-synchronization
    scenarios. Afterward, we'll run through the different processes, the AD user account
    cleanup for a hybrid environment and all the crucial parts and steps of the identity
    synchronization in Azure AD Connect. The chapter will be rounded up with a lot
    of practical tips and use cases.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将讨论实现完整的混合身份生命周期管理所需的基本身份同步场景和工具。我们将从**Microsoft Identity Manager**（**MIM**）和
    Azure AD Connect 工具的概述开始，然后深入探讨身份同步场景。接下来，我们将介绍混合环境中 AD 用户账户清理的不同流程，以及 Azure AD
    Connect 中身份同步的所有关键部分和步骤。本章最后将提供许多实用提示和使用案例。
- en: 'We''ll cover the following essential topics:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将涵盖以下基本主题：
- en: Technology overview
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 技术概述
- en: Synchronization scenarios
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 同步场景
- en: Synchronization terms and processes
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 同步术语和流程
- en: In the first section, we start with the technology overview.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 在第一部分中，我们将从技术概述开始。
- en: Technology overview
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术概述
- en: The **Microsoft Identity Manager** (**MIM**) 2016 or other identity management
    products are typically used to prepare the identities stored in the local Active
    Directory for cloud synchronization. The Azure AD Connect tool is generally used
    to synchronize the AD identities to the Azure AD to be used in connected **software
    as a a service** (**SaaS**) applications or other functionalities. The main advantage
    that MIM 2016 provides for this solution is to help with domain/forest consolidations,
    attribute normalization, and complete on-premise identity management with the
    help of workflows to support your business processes.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: '**Microsoft Identity Manager**（**MIM**）2016 或其他身份管理产品通常用于为云同步准备存储在本地 Active
    Directory 中的身份。Azure AD Connect 工具通常用于将 AD 身份同步到 Azure AD，以便在连接的**软件即服务**（**SaaS**）应用程序或其他功能中使用。MIM
    2016 为该解决方案提供的主要优势是，通过工作流支持业务流程，帮助进行域/林整合、属性标准化，以及完整的本地身份管理。'
- en: As you can see in the following diagram, MIM 2016 is also capable of synchronizing
    identities with the Azure AD. So, you're probably wondering which tool you should
    use to sync identities with Azure AD.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 如下图所示，MIM 2016 同样能够与 Azure AD 同步身份。因此，你可能在想，应该使用哪个工具来同步 Azure AD 的身份。
- en: The short, practical answer for common scenarios is the Azure AD Connect tool
    because it supports all the provided synchronization functionality of the Microsoft
    Azure AD.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 对于常见场景，简短而实际的答案是 Azure AD Connect 工具，因为它支持 Microsoft Azure AD 提供的所有同步功能。
- en: 'The following diagram provides a schematic view of the usage scenarios of both
    tools:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 下图展示了两种工具的使用场景示意图：
- en: '![](img/f0979a2b-a13e-4b80-a258-51fd5469010c.png)'
  id: totrans-13
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f0979a2b-a13e-4b80-a258-51fd5469010c.png)'
- en: Identity synchronization architecture
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 身份同步架构
- en: Azure AD Connect doesn't offer an active user write back. You'll find this option
    is deactivated in the Azure AD Connect configuration. To add this functionality,
    you can use the MIM Graph API connector like in Azure B2B user management, where
    you need to write the guest user back to your AD. To view a comparison between
    the tools, check out *Hybrid Identity directory integration tools comparison*
    at [https://docs.microsoft.com/en-us/azure/active-directory/hybrid/plan-hybrid-identity-design-considerations-tools-comparison](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/plan-hybrid-identity-design-considerations-tools-comparison)[.](https://bit.ly/2zXq9Ir)
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD Connect不提供活动用户回写。您会发现此选项在Azure AD Connect配置中被禁用。要添加此功能，您可以像在Azure B2B用户管理中一样，使用MIM
    Graph API连接器，将来宾用户回写到您的AD中。要查看工具之间的比较，请访问[Hybrid Identity目录集成工具比较](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/plan-hybrid-identity-design-considerations-tools-comparison)[.](https://bit.ly/2zXq9Ir)，并参考*混合身份目录集成工具比较*。
- en: Microsoft Identity Manager (MIM) 2016
  id: totrans-16
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 微软身份管理器（MIM）2016
- en: 'MIM 2016 is the primary identity and access management product of Microsoft
    that provides all the different server roles and components needed in this field
    of technology. MIM 2016 is mainly used to provide a sanitized and central identity
    in on-premise environments. In the context of a hybrid architecture, it plays
    a crucial role in connecting any repository to manage identities in different
    repositories. Furthermore, complex identity-management scenarios are provided
    with this component. This also includes the management of Azure AD and many SaaS
    applications in today''s market, as you can see in the following diagram:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: MIM 2016是微软的主要身份与访问管理产品，提供了在这一领域所需的所有不同服务器角色和组件。MIM 2016主要用于在本地环境中提供一个清洁的、集中的身份。在混合架构的上下文中，它在连接任何存储库以管理不同存储库中的身份方面发挥着至关重要的作用。此外，该组件还提供复杂的身份管理场景。这也包括今天市场中Azure
    AD和许多SaaS应用程序的管理，您可以在以下图表中看到：
- en: '![](img/533279a4-8047-40e1-8247-6a5f0eb8c9fd.png)'
  id: totrans-18
  prefs: []
  type: TYPE_IMG
  zh: '![](img/533279a4-8047-40e1-8247-6a5f0eb8c9fd.png)'
- en: Identity Manager functionality and objects
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 身份管理器功能和对象
- en: The following section gives you a short overview of the key components of MIM
    2016 to help a solution architect/engineer to identify possible interactions or
    elements that need to be included in a design blueprint for a suitable solution. We
    also use some of these components in the provided implementation guides of the
    book, such as in [Chapter 8](efbe1917-c755-4449-b29e-fa4a21e819fd.xhtml), *Using
    the Azure AD App Proxy and the Web Application Proxy**,* where we implement the
    Azure AD **business to business** (**B2B**) scenarios.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 以下部分简要概述了MIM 2016的关键组件，帮助解决方案架构师/工程师识别设计蓝图中可能的交互或需要包含的元素。我们也在书中提供的实施指南中使用了一些组件，例如在[第8章](efbe1917-c755-4449-b29e-fa4a21e819fd.xhtml)，*使用Azure
    AD应用程序代理和Web应用程序代理*，在其中我们实现了Azure AD的**企业对企业**（**B2B**）场景。
- en: 'The following main feature sets are provided by MIM 2016:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: MIM 2016提供的主要功能集如下：
- en: Identity synchronization including provisioning/deprovisioning
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 身份同步，包括提供/撤销权限
- en: Access request and Access Policy Management
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 访问请求和访问策略管理
- en: Delegation of administration
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 委派管理
- en: Self-service password reset and account unlock
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 自助密码重置和账户解锁
- en: Self-service group management
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 自助组管理
- en: Role management (RBAC, ABAC, SoD)
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 角色管理（RBAC，ABAC，SoD）
- en: Manual managed groups
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 手动管理的组
- en: Manager-based groups
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基于管理者的组
- en: Criteria-based groups (attribute-based access controls)
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基于条件的组（基于属性的访问控制）
- en: Time-limited group memberships
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 限时组成员资格
- en: Certificate management
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 证书管理
- en: Reporting and compliance and Access Certification
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 报告与合规性以及访问认证
- en: If you want to use MIM 2016 as your central identity-management system, we highly
    recommend you take a look at the **Workflow Activity Library** (**WAL**) under
    [http://microsoft.github.io/MIMWAL/](http://microsoft.github.io/MIMWAL/). Also,
    the combination of the newly integrated privileged access-management solution
    in Windows Server 2016 and MIM 2016 provides a very effective way to manage and
    limit security issues with administrative accounts.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您希望将MIM 2016作为您的中央身份管理系统，我们强烈建议您查看**工作流活动库**（**WAL**）[http://microsoft.github.io/MIMWAL/](http://microsoft.github.io/MIMWAL/)。此外，Windows
    Server 2016中新集成的特权访问管理解决方案与MIM 2016结合使用，为管理和限制行政账户的安全问题提供了一种非常有效的方法。
- en: MIM synchronization service
  id: totrans-35
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: MIM同步服务
- en: The MIM synchronization service is the heart of the product. You can import
    and aggregate data in a central identity store, which is called **metaverse**
    (**MV**). The service provides a staging zone to compare the connected directory
    with the metaverse. This staging zone is called the **connector space** (**CS**).
    The connection to any repository is done over specific connectors, which are also
    called **management agents** (**MAs**). The synchronization service is also responsible
    for the data integrity through all connected repositories, including the provisioning
    and deprovisioning of objects, including their attributes. You can find an overview
    of the available connectors at [https://docs.microsoft.com/en-us/microsoft-identity-manager/supported-management-agents](https://docs.microsoft.com/en-us/microsoft-identity-manager/supported-management-agents).
    In case you need a custom connector, MIM provides a development framework to fit
    your needs.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: MIM 同步服务是该产品的核心。您可以在一个中心身份存储中导入和聚合数据，该存储被称为**元宇宙**（**MV**）。该服务提供了一个暂存区，用于将连接的目录与元宇宙进行比较。此暂存区称为**连接器空间**（**CS**）。与任何存储库的连接是通过特定的连接器进行的，这些连接器也称为**管理代理**（**MAs**）。同步服务还负责所有连接存储库的数据完整性，包括对象的配置和撤销配置，以及它们的属性。您可以在
    [https://docs.microsoft.com/en-us/microsoft-identity-manager/supported-management-agents](https://docs.microsoft.com/en-us/microsoft-identity-manager/supported-management-agents)
    查找可用连接器的概述。如果您需要自定义连接器，MIM 提供了一个开发框架以满足您的需求。
- en: 'The following screenshot shows an example of different directories and systems
    that can be connected:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了可以连接的不同目录和系统的示例：
- en: '![](img/377ce317-4559-472e-b97d-45be96bd60c8.png)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
  zh: '![](img/377ce317-4559-472e-b97d-45be96bd60c8.png)'
- en: Microsoft Identity Manager Synchronization Service Manager
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: Microsoft 身份管理器同步服务管理器
- en: 'Refer to the following practical notes:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 请参考以下实用的注意事项：
- en: 'MIM synchronization service is a state-based system by default:'
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 默认情况下，MIM 同步服务是基于状态的系统：
- en: Imported data will be compared with previously imported data; differences indicate
    modifications in the source
  id: totrans-42
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 导入的数据将与之前导入的数据进行比较；差异表示源数据已被修改
- en: Imported data will be compared with previously exported data; no difference
    indicates a successful export
  id: totrans-43
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 导入的数据将与之前导出的数据进行比较；如果没有差异，表示导出成功
- en: MIM is not real-time; it uses run cycles that can be configured
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: MIM 不是实时的；它使用可以配置的运行周期
- en: MIM synchronization can work event-based with a synchronization service extension,
    as we provide in the following section.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: MIM 同步可以通过同步服务扩展实现基于事件的工作方式，详情请参见以下章节。
- en: MIM synchronization service extensions
  id: totrans-46
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: MIM 同步服务扩展
- en: 'To extend the functionality of the MIM synchronization service, you could use
    the Lithnet AutoSync. Lithnet AutoSync runs as a Windows service in addition to
    the MIM synchronization service. The service enables you to execute MIM Management
    Agent run profiles automatically. Furthermore, Lithnet AutoSync empowers you to
    perform exports and delta synchronizations automatically if the MIM synchronization
    engine detects a change. Now you have an event-based and a run-cycle-enabled synchronization
    engine. The following screenshot shows the configuration on the sync engine that
    you saw in the preceding screenshot:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 要扩展 MIM 同步服务的功能，您可以使用 Lithnet AutoSync。Lithnet AutoSync 作为 Windows 服务运行，并与 MIM
    同步服务一起工作。该服务使您能够自动执行 MIM 管理代理的运行配置文件。此外，Lithnet AutoSync 使您能够在 MIM 同步引擎检测到更改时自动执行导出和增量同步。现在，您拥有一个基于事件和支持运行周期的同步引擎。以下截图显示了在前面截图中看到的同步引擎配置：
- en: '![](img/5b52466d-f147-4050-b787-b82aedc21300.png)'
  id: totrans-48
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5b52466d-f147-4050-b787-b82aedc21300.png)'
- en: Lithnet Autosync management console
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: Lithnet Autosync 管理控制台
- en: To learn more about the Lithnet AutoSync tool, check out [https://github.com/lithnet/miis-autosync](https://github.com/lithnet/miis-autosync)[.](https://bit.ly/2UMTgXM)
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 若要了解更多关于 Lithnet AutoSync 工具的信息，请访问 [https://github.com/lithnet/miis-autosync](https://github.com/lithnet/miis-autosync)[.](https://bit.ly/2UMTgXM)
- en: MIM service and portal
  id: totrans-51
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: MIM 服务和门户
- en: The MIM service provides all the necessary capabilities for policies and workflows.
    All objects like groups, users, workflows, requests, and other resources used
    in MIM are stored as objects in the MIM Service database. These objects can be
    modified with typical CRUD (**Create**, **Read**, **Update**, **Delete**) operations requests
    to the MIM service **Identity-Management** (**IdM**) Platform.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
- en: 'With the MIM portal, users interact with the system by using a web browser.
    The usage depends on the permissions; users can be granted to do requests, respond
    to approval requests, cancel existing pending requests, or manage objects in the
    IdM system:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/e91794b5-89cd-48a3-a436-0430105430bf.png)'
  id: totrans-54
  prefs: []
  type: TYPE_IMG
- en: Microsoft Identity Manager Standard Portal
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
- en: The default MIM Portal is based on a SharePoint solution and can be highly customized.
    You can find some example configurations at [https://docs.microsoft.com/en-us/microsoft-identity-manager/reference/mim-portal-customizations](https://docs.microsoft.com/en-us/microsoft-identity-manager/reference/mim-portal-customizations).
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
- en: MIM service extensions
  id: totrans-57
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The Lithnet **Forefront Identity Manager** (**FIM**)/MIM Service REST API is
    a wrapper for the FIM/MIM Service's **Simple Object Access Protocol** (**SOAP**)/**Windows
    Communication Foundation** (**WCF**) endpoint, exposing create, update, delete,
    and search functionalities via a series of standard HTTP calls. The API returns
    JSON-formatted data, making it compatible with a wide range of platforms and services.
    By default, MIM doesn't provide a REST API to the MIM Service. With this extension,
    you can adopt your own functionality to MIM 2016, such as your own portal as we've
    done, or to interact with Power BI and other technologies to provide custom solutions.
    For more information about the Lithnet REST API for FIM/MIM Service, visit [https://github.com/lithnet/resourcemanagement-webservice](https://bit.ly/1PsgEjp).
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
- en: MIM password reset and user account unlock
  id: totrans-59
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'MIM provides two password-related features that can help you to offer solutions
    in your on-premises environment:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
- en: '**Password synchronization**: Password synchronization to other repositories
    based on the AD password change or reset'
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Password and account self-service**: Separate portals to provide a self-service
    password reset and account-unlock capabilities'
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The following screenshot shows the web-based Password Reset and Account Unlock
    functionality:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/94e00fe5-f7c7-432d-8eaf-7e712d4fcfe5.png)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
- en: Microsoft Identity Manager Self-Service Password Reset dialog
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
- en: In particular, if you have older Windows clients, such as Windows 7 or Windows
    8/8.1, in your environment, you can provide the Password Reset functionality in
    the Windows login UI. The Password Reset functionality in Azure only provides
    support for Windows 10 clients but delivers more capabilities in the verification
    options than the MIM solution.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
- en: Be aware that MIM 2016 isn't able to provide a password hash synchronization
    such as Azure AD Connect in a hybrid scenario.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
- en: MIM privileged access management
  id: totrans-68
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: MIM 2016 provides a **p****rivileged access management** (**PAM**) solution,
    restricts privileged access within an existing AD environment.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
- en: 'PAM solves the following two targets:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
- en: You can get back the authority over a compromised AD environment if you provide
    a separate bastion environment that is more protected from malicious attacks
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: With the isolation of privileged accounts, you can limit the risk of losing
    sensible credentials
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'PAM helps to address the following problems:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
- en: Pass-the-hash and pass-the-ticket attacks
  id: totrans-74
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Kerberos compromises or spear phishing
  id: totrans-75
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Unauthorized privilege escalations
  id: totrans-76
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Other vulnerabilities and attacks
  id: totrans-77
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The following screenshot shows you the role-activation and user-verification
    processes on the MIM PAM example portal, which you can customize based on your
    needs:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/a37ad9f6-38ef-4d40-ae87-48213d020b25.png)'
  id: totrans-79
  prefs: []
  type: TYPE_IMG
- en: MIM privileged access management sample portal
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
- en: Now that you know a bit about MIM's standard functionality, we'll provide you
    with an overview of an additional solution we developed with a partner company.
    Hopefully, it gives you an idea of the possibilities that MIM provides and how
    they can be expanded.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
- en: Additional solution
  id: totrans-82
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Based on our many years of experience and successfully implemented projects
    in the area of Identity and access management, we've decided to map the recurring
    requirements in our solution that fill the gaps we couldn't fulfill with the MIM
    standard functionality.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
- en: 'The following five key pillars will be provided by our solution and enable
    us to implement highly standardized identity and access-management processes that
    are flexible and customizable:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/fced768f-8e86-4135-8739-e064628a9e82.png)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
- en: Inovit Identity solution - building blocks
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
- en: 'The main features of **Organizational Management** and the frontend are the
    following:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
- en: Supports several cloud scenarios and traditional IT infrastructures
  id: totrans-88
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Representation of the organizational structure (parameterization and inheritance)
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Management of the organizational structure (manual or synchronized)
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Allows you to build efficient, role-based access controls
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Enables you to deliver beneficial cost management
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: User-friendly and highly responsive frontend
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Single page application** (**SPA**) architecture'
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Integrated governance features
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: No SharePoint installation required
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Highly customizable
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Single frontend for on-premises or cloud-only deployment
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A clear strategy for future invests
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Cloud management
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The following screenshot schematically shows the frontend:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/b04b979b-a17b-43c6-8e3d-af8b380c4981.png)'
  id: totrans-102
  prefs: []
  type: TYPE_IMG
- en: Identity Directory SPA portal
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
- en: 'The main features of **User Management** are as follows:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
- en: Standard processes (onboarding, mutation, offboarding)
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Time-limited user accounts
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Management of standard and administrative user accounts
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Management of Azure B2B accounts
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Automatic `samAccountName` and user generation
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Alignment of UPN, email, and SIP for cloud usage
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为云使用对齐 UPN、电子邮件和 SIP
- en: Password reset and account unlock
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 密码重置和账户解锁
- en: 'The following screenshot schematically shows the positions and role assignment
    in the frontend:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图简要显示了前端中的位置和角色分配：
- en: '![](img/9d57138c-6bdf-4562-9b89-7cbbd0a272d8.png)'
  id: totrans-113
  prefs: []
  type: TYPE_IMG
  zh: '![](img/9d57138c-6bdf-4562-9b89-7cbbd0a272d8.png)'
- en: Identity Director position-based Access Management
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 身份管理服务基于职位的访问管理
- en: 'The main features of **Access Management** are the following:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: '**访问管理**的主要特点如下：'
- en: Position-based, role-based, attribute-based access management
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基于职位、角色和属性的访问管理
- en: Permissions directly assigned to a user (if required)
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 权限直接分配给用户（如有需要）
- en: Approval and notification workflow support
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 审批和通知工作流支持
- en: Administration of privileged accounts
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 特权账户的管理
- en: Authorization direct views and reports
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 授权的直接视图和报告
- en: Bidirectional interfacing with services such as SharePoint and Microsoft teams
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 与 SharePoint 和 Microsoft Teams 等服务的双向接口
- en: 'The main features of **Service Management** are as follows:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: '**服务管理**的主要特点如下：'
- en: Automated and straightforward adaptation of systems and services
  id: totrans-123
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 系统和服务的自动化和简便适配
- en: Representation of the service catalog
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务目录的表示
- en: Synchronization-based order units
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基于同步的订单单元
- en: Workflow-based order units (notification and approvals)
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基于工作流的订单单元（通知和审批）
- en: Management of Office 365 and other cloud services
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Office 365 和其他云服务的管理
- en: Cloud deployment based on identity director service
  id: totrans-128
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 基于身份管理服务的云部署
- en: With our Azure-based next-gen SaaS integration, you'll be able to choose where
    you want to start your implementation, whether on-premises based on MIM or directly
    in the cloud. There will also be a fully supported transition path to the cloud.
    On Azure, we use the Identity Director Service with a Cosmos DB backend that provides
    the same functionality and additional features that you already have with an on-premises
    MIM platform. The highly responsive frontend won't change for the user.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 通过我们的基于 Azure 的下一代 SaaS 集成，您将能够选择从哪里开始实施，无论是基于 MIM 的本地部署还是直接在云端。也将有一个完全支持的云过渡路径。在
    Azure 上，我们使用身份管理服务和 Cosmos DB 后端，它提供与您现有的本地 MIM 平台相同的功能和额外的功能。高度响应的前端对用户没有任何变化。
- en: On-premises deployment based on MIM 2016
  id: totrans-130
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 基于 MIM 2016 的本地部署
- en: MIM 2016 represents Microsoft's on-premises Identity and Access Management solution.
    MIM 2016 builds the base platform to our on-premises deployment method. With a
    robust synchronization framework and many interfaces, such as REST, SOAP, LDAP,
    SQL, PowerShell and file-based, you can harmonize AD identities for synchronization
    with Azure AD. The MIM 2016 Service provides a dominant workflow component that
    works state and event-based to solve the Identity and Access Management requirements
    of your business. With MIM 2016 in place, you benefit from cloud-ready identities,
    powerful user self-service, and enhanced security.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: MIM 2016 代表了微软的本地身份和访问管理解决方案。MIM 2016 为我们的本地部署方法构建了基础平台。借助强大的同步框架和众多接口，如 REST、SOAP、LDAP、SQL、PowerShell
    和基于文件的接口，您可以协调 AD 身份与 Azure AD 的同步。MIM 2016 服务提供了一个主导的工作流组件，它基于状态和事件工作，以解决您的业务的身份和访问管理需求。通过
    MIM 2016，您可以受益于云就绪身份、强大的用户自助服务和增强的安全性。
- en: Now that we've had a quick look at MIM, and the additional available extensions
    and solutions for preparing and managing the AD objects, we'll proceed with our
    connection to the Azure AD.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经快速了解了 MIM，以及用于准备和管理 AD 对象的其他可用扩展和解决方案，我们将继续连接到 Azure AD。
- en: Azure Active Directory Connect
  id: totrans-133
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure Active Directory Connect
- en: Azure AD Connect is part of the identity bridge to build a hybrid cloud identity
    and access management. The main purpose of this tool is to synchronize on-premises
    identities to the cloud and is limited back to the AD. Azure AD Connect is also
    able to install and configure the whole identity bridge. This means that you can
    also install and configure your **Active Directory Federation Services **(**ADFS**)
    infrastructure for federation reasons with this tool or use pass-through authentication
    combined with seamless **single sign-on **(**SSO**) to provide a modern and comfortable
    authentication scenario. The tools are also capable of integrating external federation
    tools, such as PingFederate.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD Connect 是构建混合云身份和访问管理的身份桥梁的一部分。此工具的主要目的是将本地身份同步到云，并限制回 AD。Azure AD
    Connect 还能够安装和配置整个身份桥梁。这意味着你还可以使用此工具安装和配置**Active Directory 联邦服务**（**ADFS**）基础设施，以进行联邦操作，或者结合无缝的**单点登录**（**SSO**）使用通行身份验证，从而提供现代且舒适的身份验证场景。这些工具还能够集成外部联邦工具，如
    PingFederate。
- en: 'The following screenshot provides you with a schematic overview of the Azure
    AD Connect components, whose practical usage we''ll explain during the chapter:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图为你提供了 Azure AD Connect 组件的示意图，我们将在本章中解释其实际使用：
- en: '![](img/69f0142e-84de-4983-aa7d-7c29a5ce01fb.png)'
  id: totrans-136
  prefs: []
  type: TYPE_IMG
  zh: '![](img/69f0142e-84de-4983-aa7d-7c29a5ce01fb.png)'
- en: Azure AD Connect synchronization schema overview including management capabilities
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD Connect 同步架构概览，包括管理功能
- en: 'The following terms are used in the preceding figure:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 以下术语在前图中使用：
- en: '**Connected Data Source (CD)**: A data source that can be represented by a
    repository, directory, database, or data included in flat files.'
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**连接的数据源（CD）**：可以通过存储库、目录、数据库或包含在平面文件中的数据来表示的数据源。'
- en: '**Management agent or call connector (MA)**: The **management agent** (**MA**)
    is the connector to a CD and manages the data specific to the connected data source. Currently,
    AD and Azure AD are the supported MAs, as you can see here: [https://docs.microsoft.com/en-us/microsoft-identity-manager/reference/microsoft-identity-manager-2016-connector-version-history](https://docs.microsoft.com/en-us/microsoft-identity-manager/reference/microsoft-identity-manager-2016-connector-version-history).'
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**管理代理或称为连接器（MA）**：**管理代理**（**MA**）是连接到 CD 的连接器，并管理与连接数据源相关的数据。目前，AD 和 Azure
    AD 是支持的 MAs，如你在这里看到的：[https://docs.microsoft.com/en-us/microsoft-identity-manager/reference/microsoft-identity-manager-2016-connector-version-history](https://docs.microsoft.com/en-us/microsoft-identity-manager/reference/microsoft-identity-manager-2016-connector-version-history)。'
- en: '**Connector space** **(CS)**: This represents a storage and staging area. It
    stores the states that indicates whether a piece of information has changed in
    the CD. Each CD has its logical sector in the CS.'
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**连接器空间** (**CS**)：表示存储和暂存区。它存储指示 CD 中某一信息是否已更改的状态。每个 CD 在 CS 中都有其逻辑区域。'
- en: '**Metaverse:** The central data store that contains the imported and aggregated
    identity information from all connected data sources. It provides a global view
    over all objects and attributes.'
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**元宇宙：** 中央数据存储，包含来自所有连接数据源的已导入和汇总的身份信息。它提供了所有对象和属性的全局视图。'
- en: '**Staging: **If you run a staged import operation on an MA, such as Full/Delta
    Import (Stage Only), the data is imported from the **connected directory** (**CD**)
    into the CS, but no synchronization rule is applied to it. So, a staged import
    doesn''t affect the metaverse.'
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**暂存：** 如果你在 MA 上运行暂存导入操作，如完全/增量导入（仅暂存），数据将从**连接目录**（**CD**）导入到 CS 中，但不会应用任何同步规则。因此，暂存导入不会影响元宇宙。'
- en: '**Import:** The process of how objects and attributes from the connected data
    source will be moved into the connector space, including the associated operations,
    such as creation, modification, deletion, or verification. The import process
    can be a full or delta import.'
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**导入：** 将来自连接数据源的对象和属性移动到连接器空间的过程，包括相关操作，如创建、修改、删除或验证。导入过程可以是完全导入或增量导入。'
- en: '**Synchronization: **The process of applying all the configured rules to the
    staged objects in the connector space. Synchronization can be divided into inbound
    and outbound processes.'
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**同步：** 将所有配置的规则应用于连接器空间中的暂存对象的过程。同步可以分为入站和出站过程。'
- en: '**Export: **The process of writing changes that occurred during synchronization
    from the CS back to the connected data source.'
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**导出：** 将同步过程中发生的更改从 CS 写回到连接数据源的过程。'
- en: Synchronization scenarios
  id: totrans-147
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 同步场景
- en: 'With the creation of a new Azure AD tenant, the directory information is managed
    independently from the on-premises AD forest by default. So, basically, a new
    onboarded user must be created in both directories: the Azure AD and the local
    AD. Unless you drive a cloud-only company, you always need to synchronize identities
    from the on-premises AD to the Azure AD tenant you own to provide a single identity.
    After the synchronization process is in place, Azure AD and AD can be viewed as
    one unique identity service. The following section provides you with several integration
    scenarios, including the user sign-in options. We will divide this section into
    the following situations:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建新的 Azure AD 租户时，默认情况下，目录信息与本地 AD 林的管理是独立的。因此，基本上，必须在两个目录中创建一个新用户：Azure AD
    和本地 AD。除非你经营一个纯云公司，否则你总是需要将本地 AD 的身份同步到你拥有的 Azure AD 租户，以提供单一身份。在同步过程完成后，Azure
    AD 和 AD 可以视为一个独特的身份服务。接下来的部分为你提供了几种集成场景，包括用户登录选项。我们将这个部分分为以下几种情况：
- en: Single-forest integration
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 单森林集成
- en: Multi-forest integration
  id: totrans-150
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 多森林集成
- en: Multi Azure Active Directory Integration
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 多 Azure Active Directory 集成
- en: Azure Active Directory Domain Services Integration
  id: totrans-152
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure Active Directory 域服务集成
- en: Stretched Active Directory to Azure IaaS
  id: totrans-153
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 扩展的 Active Directory 到 Azure IaaS
- en: Azure Active Directory B2B Integration
  id: totrans-154
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure Active Directory B2B 集成
- en: Azure Active Directory and Microsoft Office 365 synchronization
  id: totrans-155
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure Active Directory 和 Microsoft Office 365 同步
- en: Identity and password hash synchronization including SSO options
  id: totrans-156
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 包括 SSO 选项的身份和密码哈希同步
- en: Identity synchronization including PingFederate integration
  id: totrans-157
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 包括 PingFederate 集成的身份同步
- en: Identity and password hash synchronization including ADFS integration
  id: totrans-158
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 包括 ADFS 集成的身份和密码哈希同步
- en: Azure Active Directory Connect high availability
  id: totrans-159
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure Active Directory Connect 高可用性
- en: Let's start with the single-forest integration.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从单森林集成开始。
- en: Single-forest integration
  id: totrans-161
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 单森林集成
- en: 'The single-forest scenario is a commonly used one. A single forest can contain
    one or multiple domains and a single instance of **Azure AD**. The express settings
    of **Azure AD Connect** support this scenario. We recommend filtering the objects
    so that service accounts, computers, or other objects won''t be synchronized to
    the cloud:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 单森林场景是最常用的场景。单一森林可以包含一个或多个域，并且只需一个 **Azure AD** 实例。**Azure AD Connect** 的快速设置支持这种场景。我们建议过滤对象，以便服务账户、计算机或其他对象不会同步到云：
- en: '![](img/65a104a8-b7a7-4ca0-adee-063d1c84cc5c.png)'
  id: totrans-163
  prefs: []
  type: TYPE_IMG
  zh: '![](img/65a104a8-b7a7-4ca0-adee-063d1c84cc5c.png)'
- en: Azure AD Connect single-forest integration scenario
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD Connect 单森林集成场景
- en: Additional **Azure AD Connect** servers connected to the same **Azure AD** aren't
    supported. Excluded is the high availability option with the **Azure AD Connect**
    staging mode, which is explained in the section, *Azure Active Directory Connect
    high availability*.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 额外的 **Azure AD Connect** 服务器连接到相同的 **Azure AD** 不被支持。排除的是使用 **Azure AD Connect**
    阶段模式的高可用性选项，这将在*Azure Active Directory Connect 高可用性*一节中解释。
- en: Multi-forest integration
  id: totrans-166
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 多森林集成
- en: 'Larger organizations or distributed organizations have environments with multiple
    on-premises ADs. They''re typically used in account/resource forests or provided
    through mergers and acquisitions. These rules need to be followed:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 较大的组织或分布式组织通常会有多个本地 AD 环境。它们通常用于账户/资源林，或者通过并购而来。这些规则需要遵循：
- en: Users have only one enabled account across all on-premises **Active Directory
    Forests**
  id: totrans-168
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用户在所有本地 **Active Directory Forests** 中仅有一个启用的账户
- en: '`UserPrincipalName` and Source anchor will be provided from the forest'
  id: totrans-169
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`UserPrincipalName` 和源锚点将由森林提供'
- en: Users have only one mailbox
  id: totrans-170
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用户只有一个邮箱
- en: Users that have a linked mailbox also have an account in a different forest
  id: totrans-171
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 拥有关联邮箱的用户在不同的森林中也有账户
- en: There's no need to use **Azure AD Connect** on a domain-joined server
  id: totrans-172
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不需要在加入域的服务器上使用 **Azure AD Connect**
- en: 'The following diagram shows the account/resource forest scenario:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 下图展示了账户/资源林场景：
- en: '![](img/7f12531e-9b7b-4d36-9edc-d7af9e3fe73c.png)'
  id: totrans-174
  prefs: []
  type: TYPE_IMG
  zh: '![](img/7f12531e-9b7b-4d36-9edc-d7af9e3fe73c.png)'
- en: Azure AD Connect multi-forest integration scenario
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD Connect 多森林集成场景
- en: 'Remember: multiple forests and multiple **Azure AD Connect** tools on one Azure
    AD aren''t supported. The only exception is the usage of a staging server. A staging
    server can be configured for high-availability scenarios (active/passive). In
    this scenario, the staging server doesn’t export information to the target system.'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
- en: 'If you have multiple forests, a single sync server and the users are represented
    in one directory and, you choose the option Users are represented only once across
    all directories, then each object in every forest is represented once in the Metaverse
    and aggregated in the target Azure AD tenant:'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/60a04d77-af23-417a-ae7f-16de31fbea10.png)'
  id: totrans-178
  prefs: []
  type: TYPE_IMG
- en: Azure AD Connect multi-forest integration scenario including synchronization
    mappings
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
- en: If you have numerous forests full of mesh with optional GALSync, you should
    use the User identities exist across multiple directories option.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
- en: 'If you use the mail attribute as matching criteria, the identity objects are
    joined with the mail attribute.This results in the following behavior—the user
    with a mailbox in one forest is joined with the contact in any other forest:'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/19d44136-6ab7-4f8f-8c82-39ab6808c999.png)'
  id: totrans-182
  prefs: []
  type: TYPE_IMG
- en: Multi-forest integration scenario (mail attribute mapping)
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
- en: It's essential that objects are unique across AD forests. If objects are unique
    across every forest, you're in a good position. With object matching and joining,
    you can provide a good state when using cloud services. With the usage of joins,
    the precedence of synchronization rules also comes into play. If you join two
    objects based on an email address, and a specific attribute value where Object
    1 isn't filled and Object 2 is populated, the value of the attribute (Object 2)
    will be used. But what if both objects have filled the attribute with different
    values? This is where precedence comes in.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
- en: Rules with higher precedence are implemented later than lower valued rules.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
- en: The precedence will be set at the time of adding the forest to Azure AD Connect.
    So, if the forest of Object 1 was added before the forest of Object 2, the value
    of Object 1 will win the game. The preceding diagram shows this scenario.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
- en: 'Other objects are contacts you will find in such scenarios where a **Global
    Address List** (**GAL**) synchronization was implemented between two forests.
    Azure AD Connect provides the following default behaviors:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
- en: If Azure AD contact finds a match of a contact and a user, a join will happen
  id: totrans-188
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If there's no user object available, a contact object will be created
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If a subsequent user object is found with a match to a contact, a user object
    will be built in AAD
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If you have an account/resource forest scenario and you use the User identities
    exist across multiple directories option
  id: totrans-191
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'If you use the matching criteria of **ObjectSID** and the **msExchangeMasterAccountSID**
    attribute, the expected results are that the users are disabled in this forest.
    Furthermore, the mailbox is linked to the account forest. The user will be presented
    uniquely in the Azure AD:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/ecaf964b-9cd4-4ca3-b9ef-52b35cb9004d.png)'
  id: totrans-193
  prefs: []
  type: TYPE_IMG
- en: Account/Resource forest integration scenario
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
- en: The preceding diagram also shows the Azure AD Connect behavior in a scenario
    where the AD object will be checked to determine whether it's a linked mailbox
    before it attempts to match **msExchMasterAccountSID.** This will be done with
    the **recipientTypeDetails** attribute. A value of `2` means that it's a linked
    mailbox. Keep in mind that disabled user accounts are also synchronized to Azure
    AD by default. Deactivated accounts are commonly used in exchange-resource forest
    deployments. The account forest holds the active user account and the resource
    forest holds the disabled user account. We will discuss rule precedence in [Chapter
    3](8f401db9-e842-4a9a-8b12-5fdd175df3c0.xhtml), Exploring advanced synchronization
    concepts.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
- en: Multi-Azure Active Directory Integration
  id: totrans-196
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Sometimes you need to have multiple Azure Active Directories, for example if
    parts of your organization are based in China or you need to follow government
    regulations. For each Azure AD directory, you'll need one Azure AD Connect installation.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
- en: 'In a single-forest filtering scenario to multiple Azure ADs, the following
    needs to be done:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
- en: Azure AD Connect must be configured for filtering
  id: totrans-199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: DNS domain registration is only possible in a single Azure AD
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: UPNs of the users on-premises must use separate namespaces
  id: totrans-201
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Federation configuration needs to be customized
  id: totrans-202
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: One Azure AD directory can enable Exchange hybrid with the on-premises AD
  id: totrans-203
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Global Address List synchronization needs to be performed through MIM 2016
  id: totrans-204
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Windows 10 devices can only be with one Azure AD tenant
  id: totrans-205
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The SSO option with the password hash synchronization and pass-through authentication
    activated can work only with one Azure AD tenant
  id: totrans-206
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Group and device write-back scenarios are possible
  id: totrans-207
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The following diagram shows the multiple Azure AD situation:'
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/48e9100d-6fb7-461a-8478-da1f2523d99c.png)'
  id: totrans-209
  prefs: []
  type: TYPE_IMG
- en: Connecting multiple Azure AD to one AD forest
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
- en: It's unsupported to sync the same user to multiple Azure ADs.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
- en: Azure Active Directory Domain Services Integration
  id: totrans-212
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'This service provides the capabilities to use AD Domain Services as a Service
    in Azure. It delivers two domain controllers with a small footprint of management
    options. It integrates directly with your Azure AD. It’s an excellent option to
    move entirely to the cloud with everything you use on-premises. This provides
    smaller companies with an opportunity to live without a local infrastructure.
    Just imagine that a main legacy **LOB** can now be used in an Azure AD integration
    scenario and everything will be managed under service conditions:'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/279370ae-d2ce-4e9d-a5c0-039bdf64ec92.png)'
  id: totrans-214
  prefs: []
  type: TYPE_IMG
- en: Azure AD Domain Services integration scenario
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
- en: 'The solution provides capabilities to support NTLM/Kerberos and LDAP applications.
    You can also securely expose LDAP in an example for printing solutions. We used
    this option in [Chapter 1](54c375d9-b7d0-4478-8777-33935239254b.xhtml), *Building
    and Managing Azure Active Directory*. Note that you need to activate the password-hash
    sync option in Azure AD Connect, so the user can be successfully synced between
    Azure AD and the Azure AD Domain Services. Furthermore, you benefit from the following
    additional features:'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
- en: '**AD account lockout protection**—Users are locked out for 30 minutes if five
    invalid passwords are used within 2 minutes. Accounts are automatically unlocked
    after 30 minutes.'
  id: totrans-217
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Custom** **organizational** **units** (**OUs**)—You are able to create multiple
    OUs.'
  id: totrans-218
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Group policy support**—You are able to use group policies to manage servers.'
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Stretched Active Directory to Azure IaaS
  id: totrans-220
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Extending your local AD Domain Services to Azure IaaS provides you with a very
    flexible scenario to use your line-of-business applications in the cloud. To use
    this integration, you need to build a VPN or Express Route connection to Azure.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
- en: 'Domain controllers are highly sensitive roles and will have the most concerns
    focus on the trust of the service. Many alternative solutions don''t support seamless
    lift and shift migration to Azure like this one:'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/34ac1298-cca7-4104-abe0-a5e689bc5689.png)'
  id: totrans-223
  prefs: []
  type: TYPE_IMG
- en: Extending your Active Directory to the cloud
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
- en: 'Follow the following notes:'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
- en: '**Domain controllers (RW)**: The best choice for IaaS workloads and will be
    aware of your replication considerations'
  id: totrans-226
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Domain controllers (RO)**: Normally used for scenarios with poor security
    and not an appropriate choice for IaaS workloads'
  id: totrans-227
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Resource forest scenarios**: Not recommended for use in IaaS'
  id: totrans-228
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In the next section, we'll take a look at the Azure AD B2B integration scenario.
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
- en: Azure Active Directory B2B integration
  id: totrans-230
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Azure AD B2B allows any partner to use their own identities and credentials
    in a collaboration scenario. For the authentication flows and capabilities, we''ll
    take a more in-depth look in [Chapter 8](efbe1917-c755-4449-b29e-fa4a21e819fd.xhtml),
    *Using the Azure AD App Proxy and the Web Application Proxy* and [Chapter 10](6b29475f-7917-49bf-91d4-3024835d0278.xhtml), *Exploring
    Azure AD Identity Services*. For now, we''ll give a quick overview of the synchronization
    part:'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/d45f123c-2203-474b-b7a4-e2909c41ee90.png)'
  id: totrans-232
  prefs: []
  type: TYPE_IMG
- en: Azure AD B2B local application access scenario
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
- en: 'For **Azure AD**** B2B** users to use on-premises Kerberos applications, we
    need to synchronize the guest user accounts back to the **On-Premises Active Directory**.
    For this reason, you need to provide your default Azure AD domain suffix in your
    local AD. In our case, it''s `inovitcloudlabs.onmicrosoft.com`. You will find
    the option in the AD Domains and Trusts console:'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/b02962fd-ad8d-4581-882f-e6581a83c9e0.png)'
  id: totrans-235
  prefs: []
  type: TYPE_IMG
- en: Adding your Azure AD tenant suffix to your local UPN suffixes
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
- en: The registration of the new UPN suffix is necessary because the Azure AD Application
    Proxy checks the local AD for the existence of the guest user `UserPrincipalName`,
    such as `jochen.nickel_inovit.ch#EXT#@inovitcloudlabs.onmicrosoft.com`.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
- en: Microsoft provides a default solution for synchronizing the guest users back
    to the local AD; check it out at [https://bit.ly/2Bor7xy](https://bit.ly/2Bor7xy).
    The solution contains the needed MIM 2016 configuration or a script to deploy
    the solution successfully. Don't be worried, we'll do the default configuration
    and extension later in the book.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
- en: Azure Active Directory and Microsoft Office 365 synchronization
  id: totrans-239
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The following scenario works for the most Office 365 services because every
    service uses its own directory inside of the Azure AD to store and manage identities.
    In particular, with SharePoint, we need many additional attributes in the **User
    Profile Application**, but you can''t configure the sync between Azure AD and
    SharePoint Online. You can find all the default attributes at [https://support.office.com/en-us/article/information-about-user-profile-synchronization-in-sharepoint-online-177eb196-5887-43c9-84c3-b98a43d35129](https://support.office.com/en-us/article/information-about-user-profile-synchronization-in-sharepoint-online-177eb196-5887-43c9-84c3-b98a43d35129).
    The following diagram shows the SharePoint Online synchronization scenario in
    a schematic view:'
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/103cb38e-4970-46ce-9b3f-9d2e084ab99c.png)'
  id: totrans-241
  prefs: []
  type: TYPE_IMG
- en: Azure AD to User Profile App synchronization extension
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
- en: One option is to extend the synchronization part with your solution, using the
    Microsoft Azure AD Graph API. In our case, we used a complete serverless solution
    based on Azure Functions and Logic Apps.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
- en: Identity and password-hash synchronization including SSO options
  id: totrans-244
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: By synchronizing identities and the associated password hashes from the on-premises
    AD to the Azure AD, we can build a basic scenario for smaller companies that don’t
    want to invest in an ADFS infrastructure. Also, there's no SSO required. With
    this scenario, the same password can be used to authenticate the user either in
    the cloud or on-premises, depending on what resource is being accessed. Furthermore,
    the Password Reset and Account Unlock features are available with an Azure AD
    Premium license. A requirement is Azure AD Connect with password-hash synchronization
    enabled. Optional password write-back is enabled.
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
- en: For this process, a rehashing functionality is in place, which allows the user
    to have two different hash values in the local AD and the Azure AD. Additionally,
    multi-forest synchronization is also supported.
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
- en: 'The following diagram shows the identity and password-hash synchronization
    scenario:'
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/01a9bd00-e6ef-4bc9-92c5-cd1951d096ad.png)'
  id: totrans-248
  prefs: []
  type: TYPE_IMG
- en: Azure AD Connect password-hash synchronization scenario
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
- en: 'To add SSO to the solution, you can enable Pass-through authentication and
    the seamless SSO feature in the Azure AD Connect tool. This is the most commonly
    recommended option from Microsoft to reduce complexity and put Azure AD in the
    role of the central system to provide authentication to your SaaS and on-premises
    Kerberos/Claims-based applications:'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/a75c9b10-47e4-4d70-90eb-7f6650eb5f2e.png)'
  id: totrans-251
  prefs: []
  type: TYPE_IMG
- en: PTA and seamless SSO enablement
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
- en: It's highly recommended you enable password-hash synchronization, so in case
    of an on-premises service interrupt, your users can still use cloud services.
    For now, you can read about this feature at [https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-pta](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-pta)[.](https://bit.ly/2SOVtAk)
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
- en: Identity synchronization including PingFederate integration
  id: totrans-254
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Microsoft now directly integrates non-Microsoft products into Azure AD Connect.
    The first one is the integration of PingFederate, which is very popular in the
    market. There''s no change on the directory synchronization—you enable PingFederate
    as your federation provider instead of ADFS:'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/fd571f7a-a098-43d1-8a23-fd6b323f090f.png)'
  id: totrans-256
  prefs: []
  type: TYPE_IMG
- en: Integrating PingIdentity for federation and header-based authentication
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
- en: The main decision that Microsoft has made with this partnership is to move more
    and more into the hybrid identity management approach to help you to enable Microsoft
    and other cloud services quickly.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
- en: Identity and password-hash synchronization including ADFS integration
  id: totrans-259
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: With the implementation of the federation, all authentication is retained on-premises,
    and all passwords are stored on-premises only. All authentication traffic is redirected
    from Azure AD to the on-premises ADFS, which authenticates the user against a
    trusted AD domain. This scenario is commonly used in different company sizes if
    SSO is required and password-hash synchronization is prohibited due to \ security
    reasons.
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
- en: The requirement is the usage of a federation service provider, such as ADFS in
    addition to Azure AD Connect in a highly available deployment.
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
- en: 'The following diagram shows the identity and password-hash synchronization
    with ADFS scenario:'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/c1ca8d1e-f95c-46e4-83c7-eb4f3a9d7eb4.png)'
  id: totrans-263
  prefs: []
  type: TYPE_IMG
- en: Combine federation with password-hash synchronization
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
- en: You can also combine the ADFS integration with password-hash synchronization
    to provide the capability if the on-premises infrastructure turns into an outage
    and users can still access their cloud services with their known password.
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
- en: Azure Active Directory Connect high availability
  id: totrans-266
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: For high-availability reasons, a new Azure AD Connect server can be rebuilt
    and resynchronized in a couple of hours for a small or medium-sized business.
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
- en: Remember that the `sourceAnchor` attribute is used to join the objects from
    on-premises and the cloud. The sync engine matches the objects together again
    on reinstallation.
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
- en: It's very important that you document your configuration changes, such as special
    filtering or synchronization rules. You need to reapply these settings before
    you start the synchronization process. You can use the Azure AD Connect documenter
    ([https://github.com/Microsoft/AADConnectConfigDocumenter](https://github.com/Microsoft/AADConnectConfigDocumenter))
    to save your changes.
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
- en: Larger organizations with more than 100,000 users, groups, and other objects
    will take much more time to rebuild the synchronization. If there needs to be
    a faster time to recovery, Azure Active Directory Connect can be configured to
    use a dedicated SQL server deployment with SQL high availability. This option
    provides the needed data directly. With more than 100,000 users, an SQL server
    is required because a large organization wants to have low recovery time for the
    synchronization service.
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
- en: Another way to provide a highly redundant system is to use another server with
    Azure Active Directory Connect installed and configured in Staging mode. This
    functionality also reduces recovery time.
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
- en: 'The following diagram shows a staging-mode configuration:'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/239cee63-2632-495d-a6c4-c863a73d3ccc.png)'
  id: totrans-273
  prefs: []
  type: TYPE_IMG
- en: Enable the staging mode for HA
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
- en: With Azure AD Connect version 1.1.524.0, Microsoft added the SQL **Always-on
    Availability** (**AOA**) Group support. SQL clustering was added in an earlier
    release. Be aware that SQL AOA needs to be enabled before you install Azure AD
    Connect.
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
- en: Synchronization terms and processes
  id: totrans-276
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this section, we'll discuss and implement the practical use of the synchronization
    terms and procedures. We'll combine theory directly with practical use. For this
    reason, we'll install, configure, and run the processes immediately in the Azure
    AD Connect tool. To use the guidance, you should deploy a virtual machine with
    the domain controller role enabled.
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
- en: Build the virtual machine on Azure or your local virtualization platform. An
    excellent option is to follow the guide at [https://docs.microsoft.com/en-us/office365/enterprise/base-configuration-dev-test-environment](https://docs.microsoft.com/en-us/office365/enterprise/base-configuration-dev-test-environment) with
    the usage of your free trial Azure or MSDN subscription. We provide you with a
    complete scripting solution in the code package of the book, or you can follow
    the instructions in [Chapter 7](468509fa-856c-411d-abdb-e9a39c266750.xhtml), *Deploying
    Solutions on Azure AD and ADFS*.
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
- en: We use the same domain name you used in [Chapter 1](54c375d9-b7d0-4478-8777-33935239254b.xhtml), *Building
    and Managing Azure Active Directory*. In our case, we use the domain name `inovitlabs.ch`.
    So, change the scripts for your environment.
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
- en: Now that we have our primary test environment in place, we can start the preparation
    and installation of the Azure AD Connect on the Domain Controller. We use this
    scenario to reduce the costs of your test environment. Be aware that we'll extend
    the test environment in the coming chapters to demonstrate the functionalities
    we discuss in this book.
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
- en: 'Are you ready? Let''s prepare the domain:'
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
- en: 'Log in with the domain administrator credentials and run the following script
    to create the demo organizational unit structure:'
  id: totrans-282
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-283
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'The following diagram shows the expected result:'
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/ad5d3b0f-6bfa-4b10-9aa7-67e2d8e5f2a3.png)'
  id: totrans-285
  prefs: []
  type: TYPE_IMG
- en: Azure AD service organizational unit
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
- en: 'Enable the Active Directory recycle bin feature:'
  id: totrans-287
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-288
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Create the **group-managed service account** (**gMSA**) to run the Azure AD
    Connect service. Replace the computer name with the one you choose for your test
    environment:'
  id: totrans-289
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-290
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Create the service account for the Active Directory Management Agent that will
    be used to connect and do the synchronization operations:'
  id: totrans-291
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-292
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: The Active Directory Management Agent account needs to be configured with the
    correct permissions on the domain level.
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
- en: 'Configure the permissions to configure the `svcaadcadma` Azure AD Connect with
    the Active Directory user''s and computer''s console (`dsa.msc`). Don''t forget
    to enable the advanced features under the view option where you can see the Security
    tabs:'
  id: totrans-294
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Replicate Directory Changes
  id: totrans-295
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Replicate Directory Changes All
  id: totrans-296
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The following screenshot shows the expected result:'
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/b51db496-0ec0-4cd1-8bae-41e0625ab93f.png)'
  id: totrans-298
  prefs: []
  type: TYPE_IMG
- en: Assigning correct permissions to the Azure AD Connect AD Management Agent service
    account
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
- en: Now that we've finished the preparation tasks in our test environment, let's
    run through the following sections for the theoretical explanations and the practical
    execution. For every task, we'll use the same credentials in an evaluated PowerShell
    session.
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
- en: UserPrincipalName suffix decisions
  id: totrans-301
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '`UserPrincipalName` is one of the most relevant user attributes in the connection
    from a local AD to the **Azure A****D**. Azure AD Connect follows the rules shown
    here:'
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/4bd3840d-734a-4688-ad61-768c3f61ec65.png)'
  id: totrans-303
  prefs: []
  type: TYPE_IMG
- en: User Principal Name decision path
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
- en: 'As you can see in the preceding diagram, AAD Connect uses the following logic
    by default:'
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
- en: If a UPN is available, it will be used
  id: totrans-306
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If a UPN isn't available, it uses the user's **sAMAccountName** and the **fully
    qualified domain name** (**FQDN**) of the connect AD domain
  id: totrans-307
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If the UPN to be exported to the Azure AD isn't verified, the suffix will be
    replaced with **<tenant>.onmicrosoft.com**
  id: totrans-308
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Remember that users can exist in any synchronized forest and they include `UserPrincipalName`
    and `sourceAnchor`. In the case of using linked mailboxes, they will be ignored
    because the synchronization engine will find an active and deactivated account
    representation of the user.
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
- en: Active Directory preparations
  id: totrans-310
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'To prepare your AD environment, you can use the IdFix tool, which you can download
    from [http://bit.ly/1VnsvVn](http://bit.ly/1VnsvVn). It performs the discovery
    and remediation of identity objects and their attributes in an on-premises AD
    environment in preparation for synchronization to Azure AD. IdFix is provided
    for AD administrators that plan to use Azure AD Connect with the Azure AD/Office
    365 services. You can use the tool for every synchronization scenario:'
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/1d1dc543-bf7f-4f05-89bf-068a6080de4e.png)'
  id: totrans-312
  prefs: []
  type: TYPE_IMG
- en: Incorrect user accounts found by the IdFix tool
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
- en: 'To test the IdFix utility, we''ll create some incorrect test users with the
    following script:'
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-315
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The following screenshot shows the expected result:'
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/f41fa94a-0075-421a-8133-a0620ab0ebf2.png)'
  id: totrans-317
  prefs: []
  type: TYPE_IMG
- en: Creation result of the damaged user accounts
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
- en: 'Now we can run the IdFix tool to check the local AD for a user that will build
    errors in a synchronization:'
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/50a1f40a-338c-4a43-9db0-6f34b02a10b8.png)'
  id: totrans-320
  prefs: []
  type: TYPE_IMG
- en: Errors found on the damaged user accounts
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
- en: After you test the IdFix tool, delete the created test user accounts.
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
- en: 'With the next steps we will start the installation of the Azure AD Connect
    tool:'
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
- en: Run the Azure AD Connect installation. Download the actual version of the tool
    from [https://www.microsoft.com/en-us/download/details.aspx?id=47594](https://www.microsoft.com/en-us/download/details.aspx?id=47594)
    [and start the installation with the Domain Administrator credentials.](https://bit.ly/1JPD3qY)
  id: totrans-324
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Choose the custom installation option so that we can view all the essential
    configuration steps. I always use the custom option and not the Express option.
  id: totrans-325
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Use the gMSA created in the previous steps to configure the Azure AD Connect
    service:'
  id: totrans-326
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/d0d47629-e355-4539-8bc4-7a45da8e2bb8.png)'
  id: totrans-327
  prefs: []
  type: TYPE_IMG
- en: Service account configuration
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
- en: 'At this time, we don''t set any User sign-in option:'
  id: totrans-329
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/cfd7e498-3eea-487c-94c8-1b8af9b18117.png)'
  id: totrans-330
  prefs: []
  type: TYPE_IMG
- en: User sign-in configuration
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
- en: In the next section, we'll discuss the source anchor decision process, so click
    Next and wait for the next lab part.
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
- en: Source Anchor decisions
  id: totrans-333
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: It’s crucial to understand Source Anchor because it builds the basis for the
    relationship between the AD Domain Services user and the Azure AD user. The `sourceAnchor`
    attribute can't be changed. Be aware that your configuration fits your expected
    scenario.
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
- en: 'The attribute provides the following capabilities to you:'
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
- en: Supports faster rebuilding scenarios
  id: totrans-336
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Supports the move from a cloud-only to a synchronized scenario with a hard match
  id: totrans-337
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In a federation scenario, it builds the claim with `UserPrincipalName` to identify
    a user uniquely
  id: totrans-338
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The following rules need to be followed when choosing a `sourceAnchor` attribute:'
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
- en: Less than 60 characters
  id: totrans-340
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'No special characters, such as {, }, |, ~, <, >, (, ), '' ; : , [, ], ", @,
    _,\, !, #, $, %, &, *, +, /, =, ?, ^, or `'
  id: totrans-341
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Globally unique
  id: totrans-342
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: String, integer, or binary
  id: totrans-343
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Should not be based on the user's name and case-sensitive
  id: totrans-344
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Assigned at object-creation time
  id: totrans-345
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Azure AD Connect uses the following defaults as the `sourceAnchor` attribute:'
  id: totrans-346
  prefs: []
  type: TYPE_NORMAL
- en: Azure AD Connect (version 1.1.486.0 and older) usage of the objectGUID as the
    `sourceAnchor` attribute
  id: totrans-347
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure AD Connect (version 1.1.524.0 and after) usage of the ms-DS-ConsistencyGuid
    as `sourceAnchor` attribute
  id: totrans-348
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The following screenshot shows the configuration in the Azure AD Connect installation
    wizard:'
  id: totrans-349
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/04e1a01b-c9bd-4b57-9703-0548a061f69a.png)'
  id: totrans-350
  prefs: []
  type: TYPE_IMG
- en: sourceAnchor definition of Azure AD Connect
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
- en: The Management Agent user account must be granted write permissions to the ms-DS-ConsistencyGuid
    attribute in the local AD. Keep in mind, only newer versions of Azure AD Connect
    (1.1.552.0 and after) support switching from ObjectGuid to ms-DS-ConsistencyGuid
    as the `sourceAnchor` attribute.
  id: totrans-352
  prefs: []
  type: TYPE_NORMAL
- en: Connected Directories
  id: totrans-353
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The **Synchronization Engine** from the Azure AD Connect processes identities
    from the AD and the Azure AD. Every directory or repository organizes the data
    in their method and provides different access methods. The data repositories that
    are synchronized with Azure AD Connect are called connected data sources or **connected
    directories** (**CDs**). The two supported CDs in Azure AD Connect are the AD
    and the Azure AD. You can connect any other repository but in a Microsoft, unsupported
    way. The following diagram shows the basic concept of synchronization:'
  id: totrans-354
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/16d19282-8ddb-4fba-a144-0b8dbaace242.png)'
  id: totrans-355
  prefs: []
  type: TYPE_IMG
- en: Basic concept of a connector and the connected directory
  id: totrans-356
  prefs: []
  type: TYPE_NORMAL
- en: Now, let's jump back to the Azure AD Connect configuration and log back into
    your Domain Controller.
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
- en: 'We will configure the two repositories:'
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
- en: 'Provide your global administrator credentials from your Azure AD and click
    Next:'
  id: totrans-359
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/d8679d60-869b-4763-9884-24861aa2917c.png)'
  id: totrans-360
  prefs: []
  type: TYPE_IMG
- en: Connect Azure AD Connect to the Azure AD
  id: totrans-361
  prefs: []
  type: TYPE_NORMAL
- en: 'Connect the local Active Directory:'
  id: totrans-362
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/18493b17-7ddb-4432-be41-f2117d97ccd3.png)'
  id: totrans-363
  prefs: []
  type: TYPE_IMG
- en: Connect the local AD
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
- en: 'Use the created AD Management Agent account for this task:'
  id: totrans-365
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/fb6c6cd9-9976-4bd9-8db3-5d513f1b4a4f.png)'
  id: totrans-366
  prefs: []
  type: TYPE_IMG
- en: Configure the AD Management Agent service account
  id: totrans-367
  prefs: []
  type: TYPE_NORMAL
- en: 'Find your verified custom domain, in my case inovitlabs.ch:'
  id: totrans-368
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/7edcd30e-934f-4067-ac22-a1483767acc6.png)'
  id: totrans-369
  prefs: []
  type: TYPE_IMG
- en: Define the sign-in options
  id: totrans-370
  prefs: []
  type: TYPE_NORMAL
- en: 'On the Domain and OU filtering page, choose the created Managed Business Objects
    OU. With the following setting, no newly created OUs will be included in the synchronization
    process:'
  id: totrans-371
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/6c223ef9-3ea0-408d-be63-142081d57e9e.png)'
  id: totrans-372
  prefs: []
  type: TYPE_IMG
- en: OU filtering options
  id: totrans-373
  prefs: []
  type: TYPE_NORMAL
- en: 'With the following option, every newly established OU under Managed Business
    Objects will be included in the synchronization process:'
  id: totrans-374
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/0f0e1a64-1b7e-46b4-b25e-73ad0545fa71.png)'
  id: totrans-375
  prefs: []
  type: TYPE_IMG
- en: The second part of OU filtering options
  id: totrans-376
  prefs: []
  type: TYPE_NORMAL
- en: 'Configure the `sourceAnchor` ms-DS-ConsistencyGuid as we discussed in the *Source
    Anchor decisions* section :'
  id: totrans-377
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/d9457fe4-4e99-498b-a8d3-9bf63a6982b2.png)'
  id: totrans-378
  prefs: []
  type: TYPE_IMG
- en: sourceAnchor definition dialog
  id: totrans-379
  prefs: []
  type: TYPE_NORMAL
- en: 'In the Filter users and devices section, choose the default option. You could
    also use the group option for proof of concepts:'
  id: totrans-380
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/a614ae7c-de2a-421b-a42b-efd295c08866.png)'
  id: totrans-381
  prefs: []
  type: TYPE_IMG
- en: Filter users and devices dialog
  id: totrans-382
  prefs: []
  type: TYPE_NORMAL
- en: 'In the Optional features section, you see the available synchronization options,
    which we discussed in the integration scenarios. Keep in mind that you need the
    correct permissions for the Active Directory Management Agent account to write
    back to the local AD:'
  id: totrans-383
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/3536a0a4-4c2e-401a-a1e5-5d0f4676d3c5.png)'
  id: totrans-384
  prefs: []
  type: TYPE_IMG
- en: Azure AD Connect Optional features section
  id: totrans-385
  prefs: []
  type: TYPE_NORMAL
- en: Click Next to finish the configuration. Be sure that you don't enable the synchronization
    process because we do the things step by step.
  id: totrans-386
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'The directories will be connected after we finish the Azure AD Connect installation
    wizard, and can be viewed in the Synchronization Service Manager under Connectors:'
  id: totrans-387
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/1a2f749c-34db-4afb-88a4-67bf654ef134.png)'
  id: totrans-388
  prefs: []
  type: TYPE_IMG
- en: Azure AD Connect - Connected directories
  id: totrans-389
  prefs: []
  type: TYPE_NORMAL
- en: After installing and configuring the Azure AD Connect tool, we can jump into
    the detailed sections of the synchronization. In the upcoming [Chapter 3](8f401db9-e842-4a9a-8b12-5fdd175df3c0.xhtml), *Exploring
    Advanced Synchronization Concepts*, we'll enable the available writeback, extension,
    and filtering options.
  id: totrans-390
  prefs: []
  type: TYPE_NORMAL
- en: Import flow
  id: totrans-391
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The internal sync engine contains two namespaces that store identity information:
    the CS and the **metaverse** (**MV**). The CS is used to detect changes in the
    connected data sources. The connector space is also used to proceed outgoing changes
    for the export process into the connected data source.'
  id: totrans-392
  prefs: []
  type: TYPE_NORMAL
- en: Data can flow in each direction, but it can't flow in both directions simultaneously.
  id: totrans-393
  prefs: []
  type: TYPE_NORMAL
- en: 'Just to recap: the MV is a storage area that contains the aggregated identity
    information from multiple connected data. It''s very important to understand that
    every synchronization engine object must have a **globally unique identifier**
    (**GUID**) for data integration reasons and the relationships between the objects.'
  id: totrans-394
  prefs: []
  type: TYPE_NORMAL
- en: The import process is done between the connected data source and the connector
    space. For this reason, we provide some information about the connector space.
  id: totrans-395
  prefs: []
  type: TYPE_NORMAL
- en: 'Connector space objects have two attributes:'
  id: totrans-396
  prefs: []
  type: TYPE_NORMAL
- en: '**Globally unique identifier** (**GUID**)'
  id: totrans-397
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Distinguished name** (**DN**)'
  id: totrans-398
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'CS objects can be one of the following:'
  id: totrans-399
  prefs: []
  type: TYPE_NORMAL
- en: A CS object
  id: totrans-400
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A placeholder
  id: totrans-401
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The following diagram shows the schematic view of the **Synchronization Engine**:'
  id: totrans-402
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/a8ccbf48-de66-454c-8f1a-70ad56bc8cc4.png)'
  id: totrans-403
  prefs: []
  type: TYPE_IMG
- en: Synchronization Engine overview
  id: totrans-404
  prefs: []
  type: TYPE_NORMAL
- en: Now let's see the import flow in action. Keep in mind that we already have users
    in our Azure AD from [Chapter 1](54c375d9-b7d0-4478-8777-33935239254b.xhtml),
    *Building and Managing Azure AD:*
  id: totrans-405
  prefs: []
  type: TYPE_NORMAL
- en: Log into your Domain Controller and open the Azure AD Connect Synchronization
    Service Manager.
  id: totrans-406
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Run a Full Import on the connected Active Directory:'
  id: totrans-407
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/62d846b8-9d54-4a03-87f2-23e67a758d81.png)'
  id: totrans-408
  prefs: []
  type: TYPE_IMG
- en: Full Import profile run
  id: totrans-409
  prefs: []
  type: TYPE_NORMAL
- en: 'The sync engine imports the organizational structure (placeholder) into the
    CS:'
  id: totrans-410
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/575c2606-7f41-4259-a0ce-5dff307a0249.png)'
  id: totrans-411
  prefs: []
  type: TYPE_IMG
- en: Statistics after Full Import
  id: totrans-412
  prefs: []
  type: TYPE_NORMAL
- en: 'You see the imported organizational structure:'
  id: totrans-413
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/cf75545f-39f6-4562-9b09-2d6ff852144e.png)'
  id: totrans-414
  prefs: []
  type: TYPE_IMG
- en: Imported objects
  id: totrans-415
  prefs: []
  type: TYPE_NORMAL
- en: 'Run a Full Import on the connected Azure Active Directory:'
  id: totrans-416
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/7d82aed0-7d49-4dc9-a714-a0ae1a6e41c9.png)'
  id: totrans-417
  prefs: []
  type: TYPE_IMG
- en: Full Import on Azure AD
  id: totrans-418
  prefs: []
  type: TYPE_NORMAL
- en: 'No objects are created in the CS. Remember that we already have users in the
    Azure AD—there''s no user write-back available:'
  id: totrans-419
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/261c972a-bba2-4157-8bc7-12218e04e5c5.png)'
  id: totrans-420
  prefs: []
  type: TYPE_IMG
- en: Full Import Azure AD statistics
  id: totrans-421
  prefs: []
  type: TYPE_NORMAL
- en: Also, there's no interaction with the MV with an import flow. In the next section,
    you'll learn more about placeholder objects.
  id: totrans-422
  prefs: []
  type: TYPE_NORMAL
- en: Placeholder objects
  id: totrans-423
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: An example of a placeholder object is the containers to validate the path to
    the AD objects. We can also talk about a placeholder object to which the manager
    attribute refers. As a rule, we can say that placeholder objects don't contain
    values and are not linked with the MV.
  id: totrans-424
  prefs: []
  type: TYPE_NORMAL
- en: 'Run profiles—one per forest, one step per domain:'
  id: totrans-425
  prefs: []
  type: TYPE_NORMAL
- en: We import (stage) all objects into the CS (even filtered by the Connector Filter)
  id: totrans-426
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Full Import—all objects
  id: totrans-427
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Delta Import—only changed objects
  id: totrans-428
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Next, we'll move to the synchronization flows.
  id: totrans-429
  prefs: []
  type: TYPE_NORMAL
- en: Synchronization flows
  id: totrans-430
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Synchronization flows are specific to the processes between the CS and the
    MV objects. As a rule, we can say that multiple CS objects can be linked to one
    MV object. This is typical because the MV represents the unique identity object
    over all connected systems. On the other hand, a CS object can''t have a link
    to multiple MV objects, as shown in the image below:'
  id: totrans-431
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/99744c52-9595-49a0-b065-91bd0df677e2.png)'
  id: totrans-432
  prefs: []
  type: TYPE_IMG
- en: Synchronization flow overview
  id: totrans-433
  prefs: []
  type: TYPE_NORMAL
- en: 'The synchronization flows are configured over the synchronization rules that
    you can view in the Azure AD Connect Synchronization Rules Editor:'
  id: totrans-434
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/9a75c387-813c-4e3f-a5b8-c39e864b6acd.png)'
  id: totrans-435
  prefs: []
  type: TYPE_IMG
- en: Synchronization rules editor overview
  id: totrans-436
  prefs: []
  type: TYPE_NORMAL
- en: In [Chapter 3](8f401db9-e842-4a9a-8b12-5fdd175df3c0.xhtml), *Exploring Advanced
    Synchronization Concepts,* we'll discuss the synchronization rules in detail.
    For now, we'll focus on the main functions and explanations.
  id: totrans-437
  prefs: []
  type: TYPE_NORMAL
- en: Inbound synchronization
  id: totrans-438
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The inbound synchronization is defined by a subset of synchronization rules
    and contains the terms shown in the following diagram. If we use an inbound synchronization,
    the synchronization engine will update the changes between the MV and the CS.
    The inbound synchronization happens when the content of the MV is updated by using
    the data in the CS:'
  id: totrans-439
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/25da1a55-e2f6-4f69-b4fe-ca7a1eb186d1.png)'
  id: totrans-440
  prefs: []
  type: TYPE_IMG
- en: Inbound synchronization overview
  id: totrans-441
  prefs: []
  type: TYPE_NORMAL
- en: Another term for the provisioning is **Projection** and it's part of the outbound
    synchronization. We can also say that provisioning is an object-level operation
    because the synchronization engine creates a new object in the MV based on the
    object in the CS and creates a link between them. The join is in the special process,
    which creates the link. So, the join is also an object-level operation. The import
    attribute flow is used from the synchronization engine to update attribute values
    of the MV object. We can say that the import flow is attribute-level-based and
    requires a link between the CS and the MV object.
  id: totrans-442
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s take a look at our Azure AD Connect:'
  id: totrans-443
  prefs: []
  type: TYPE_NORMAL
- en: Log into your Domain Controller and open the Azure AD Connect Synchronization
    Service Manager.
  id: totrans-444
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Run a Full Synchronization on the local AD:'
  id: totrans-445
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/87eefc41-5b19-4e6a-bd3e-e13fdfa17018.png)'
  id: totrans-446
  prefs: []
  type: TYPE_IMG
- en: Full Synchronization run on the local AD
  id: totrans-447
  prefs: []
  type: TYPE_NORMAL
- en: 'Nothing happens on the MV. You will only find 5 Disconnectors for the organizational
    structure (placeholders):'
  id: totrans-448
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/eb5e3d84-e1a9-42e2-8e1e-efab70d2a9ec.png)'
  id: totrans-449
  prefs: []
  type: TYPE_IMG
- en: Full Synchronization statistics
  id: totrans-450
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s create a test user with the same `UserPrincipalName` as an existing
    user in Azure AD. In my case, I use `jochen.nickel@inovitlabs.ch`:'
  id: totrans-451
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-452
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Run a Delta import on the local AD:'
  id: totrans-453
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/2bedc4ba-32d2-4cbf-acc2-f8286ee78158.png)'
  id: totrans-454
  prefs: []
  type: TYPE_IMG
- en: Delta Import statistics on local AD
  id: totrans-455
  prefs: []
  type: TYPE_NORMAL
- en: 'Run a Delta Synchronization on the local AD:'
  id: totrans-456
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/a69d8700-253d-4e6b-867a-d88e116477fe.png)'
  id: totrans-457
  prefs: []
  type: TYPE_IMG
- en: Delta synchronization on local AD statistics
  id: totrans-458
  prefs: []
  type: TYPE_NORMAL
- en: In the actual state, we would have a provisioning of the user in the Azure AD.
    For this reason, we need to run a Full Synchronization on the Azure AD to get
    all the changes. This procedure avoids the making of a wrong provisioning, because
    we want to join the user based on the `UserPrincipalName`.
  id: totrans-459
  prefs: []
  type: TYPE_NORMAL
- en: 'Run a Full Synchronization on the Azure AD:'
  id: totrans-460
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/a6ea3c94-750e-4b95-8bc4-6077f327df57.png)'
  id: totrans-461
  prefs: []
  type: TYPE_IMG
- en: Full synchronization statistics
  id: totrans-462
  prefs: []
  type: TYPE_NORMAL
- en: Click on Connectors without Flow Updates and inspect the changes.
  id: totrans-463
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Run an Export on the Azure AD which will recognize that the user will be joined
    by `UserPrincipalName`. We prove this with a Metaverse Search:'
  id: totrans-464
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/24b2cf40-d14e-4f5f-bcad-516bb80def73.png)'
  id: totrans-465
  prefs: []
  type: TYPE_IMG
- en: Metaverse Search options
  id: totrans-466
  prefs: []
  type: TYPE_NORMAL
- en: You synchronized your first user, including a join operation! You can follow
    up by mapping all the accounts. This is how you can map existing on-premises accounts
    with Azure AD accounts.
  id: totrans-467
  prefs: []
  type: TYPE_NORMAL
- en: 'If you run an Export on the AD, you''ll receive a permission issue error:'
  id: totrans-468
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/6c08162c-7f5a-419b-bd13-22fed36ed41f.png)'
  id: totrans-469
  prefs: []
  type: TYPE_IMG
- en: Export statistics on AD
  id: totrans-470
  prefs: []
  type: TYPE_NORMAL
- en: 'Modify the cmdlets to your environment and execute them to grant the AD Management
    Account the permissions to write to `ms-ds-consistencyGuid`:'
  id: totrans-471
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-472
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Run the Export on the AD again and the error will disappear.
  id: totrans-473
  prefs: []
  type: TYPE_NORMAL
- en: 'You can also use the email address or write `ImmutableId` to a PowerShell script.
    You can use the following script for this purpose, [https://gallery.technet.microsoft.com/scriptcenter/Convert-between-Immutable-e1e96aa9](https://gallery.technet.microsoft.com/scriptcenter/Convert-between-Immutable-e1e96aa9) or
    the following procedure:'
  id: totrans-474
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-475
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'After you successfully join all the users, you can run a complete default sync
    cycle with the following PowerShell cmdlet:'
  id: totrans-476
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-477
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: This would happen if you enable the synchronization in the installation and
    configuration wizard of Azure AD Connect.
  id: totrans-478
  prefs: []
  type: TYPE_NORMAL
- en: 'By default, the Azure AD Connect Sync Engine schedulers runs the following
    on the initial run:'
  id: totrans-479
  prefs: []
  type: TYPE_NORMAL
- en: AD—Full Import
  id: totrans-480
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: AAD—Full Import
  id: totrans-481
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: AD—Full Sync
  id: totrans-482
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: AAD—Full Sync
  id: totrans-483
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: AAD—Export
  id: totrans-484
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: AD—Export
  id: totrans-485
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Now that we've done the practical tasks, let's look at the rest of the theoretical
    information.
  id: totrans-486
  prefs: []
  type: TYPE_NORMAL
- en: Outbound synchronization
  id: totrans-487
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: With outbound synchronization, you update the exported objects when an MV object
    is changed but not deleted. The primary purpose of the outbound synchronization
    is to check the changes to MV objects, which need to be updated in the CS.
  id: totrans-488
  prefs: []
  type: TYPE_NORMAL
- en: 'With outbound synchronization, we use the following three processes. You will
    get a provisioning process if changes are applied to an object in the MV. The
    deprovisioning process always depends on the provisioning itself, because the
    provisioning process is the only one that can initiate the export attribute flow.
    The objects in the CS during an export are provided with the pending export flag
    to make them export objects. You can see the process in the following diagram:'
  id: totrans-489
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/21dc04d7-5c7a-4f32-bc8d-cd8350638d40.png)'
  id: totrans-490
  prefs: []
  type: TYPE_IMG
- en: Outbound synchronization overview
  id: totrans-491
  prefs: []
  type: TYPE_NORMAL
- en: If changes happen to an MV object, the synchronization engine can create joined
    objects as part of the provisioning process. Furthermore, the synchronization
    engine can rename a joined object and disjoin an object.
  id: totrans-492
  prefs: []
  type: TYPE_NORMAL
- en: Joins
  id: totrans-493
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Joins are an excellent functionality. We call a linked object in the CS, with
    an object in the MV a joined object. Otherwise, it''s a disjoined object. The
    following diagram shows the Joins concept:'
  id: totrans-494
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/286671bf-776d-468d-85c1-2e237cf51178.png)'
  id: totrans-495
  prefs: []
  type: TYPE_IMG
- en: Joins overview
  id: totrans-496
  prefs: []
  type: TYPE_NORMAL
- en: With the synchronization process, an object from the CS will be a joined object.
    In this case, the related attributes can flow. The attribute flow is in both directions.
  id: totrans-497
  prefs: []
  type: TYPE_NORMAL
- en: The disjoined object usage delivers such that the required information about
    the object is already stored and they are convertible in both ways. With an import
    you always create a disjoined object as well with the export.
  id: totrans-498
  prefs: []
  type: TYPE_NORMAL
- en: Connector objects
  id: totrans-499
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Now that we have discussed the join operations we will explain the different
    connector objects, which are used by the system to build the connection between
    the connector space and the metaverse object.
  id: totrans-500
  prefs: []
  type: TYPE_NORMAL
- en: 'There are two types of connector objects:'
  id: totrans-501
  prefs: []
  type: TYPE_NORMAL
- en: Connectors
  id: totrans-502
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Explicit connectors
  id: totrans-503
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A connector is an object in the CS. The object is linked to an object in the
    MV, so every rule applies to this object. Furthermore, an explicit connector exists.
    With this type of connector, the object is linked to an object in the MV. This
    type of connector can only be created with the Joiner functionality, which isn't
    available in Azure AD Connect.
  id: totrans-504
  prefs: []
  type: TYPE_NORMAL
- en: Disconnector objects
  id: totrans-505
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'There are three types of disconnector objects:'
  id: totrans-506
  prefs: []
  type: TYPE_NORMAL
- en: Disconnectors
  id: totrans-507
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Explicit disconnectors
  id: totrans-508
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Filtered disconnectors
  id: totrans-509
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We speak about a disconnector when an object in the CS isn't linked to an object
    in the MV. An explicit disconnector is also not a linked object in the MV and
    can only be joined with the Joiner toolset of the synchronization engine. This
    feature is not available in Azure AD Connect. The meaning of a filtered disconnector
    is an object in the CS, that is prevented from being joined or projected to an
    object in the MV.
  id: totrans-510
  prefs: []
  type: TYPE_NORMAL
- en: Export flow
  id: totrans-511
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'During the export process, the synchronization engine checks all the exported
    objects with the **Pending Export** flag in the CS, and an update will be sent
    to the data source:'
  id: totrans-512
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/29e73f73-0954-40f3-9544-cc8e575cfa43.png)'
  id: totrans-513
  prefs: []
  type: TYPE_IMG
- en: Export flow overview
  id: totrans-514
  prefs: []
  type: TYPE_NORMAL
- en: 'At this moment, the synchronization engine can only validate whether the export
    was successful. It needs an import to prove that the exported values are correctly
    transported to the repository:'
  id: totrans-515
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/d3ca2b48-322e-419a-a696-e8b964ae6cfc.png)'
  id: totrans-516
  prefs: []
  type: TYPE_IMG
- en: Import flow to prove the export
  id: totrans-517
  prefs: []
  type: TYPE_NORMAL
- en: Now that you are equipped with the essential information about Azure AD Connect
    and synchronization tasks, we'll jump into the details of the synchronization
    rules editor in [Chapter 3](8f401db9-e842-4a9a-8b12-5fdd175df3c0.xhtml), *Exploring
    Advanced Synchronization Concepts*.
  id: totrans-518
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  id: totrans-519
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this chapter, we discussed the most important identity synchronization tools:
    Microsoft Identity Manager and Azure Active Directory Connect. We walked through
    the typical synchronization scenarios. Now you''re able to adopt the best scenario
    for your requirements. In the *Synchronization terms and processes* section, we
    took a deep dive into the synchronization service, so you know exactly what''s
    happening under the hood, which will help you to avoid mistakes and provide better
    troubleshooting for synchronization errors.'
  id: totrans-520
  prefs: []
  type: TYPE_NORMAL
- en: In the next chapter, we'll explore additional filtering, join attributes, declarative
    provisioning options, and generic connector usage.
  id: totrans-521
  prefs: []
  type: TYPE_NORMAL
