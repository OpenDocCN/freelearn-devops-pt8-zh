<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Chapter&#xA0;2.&#xA0;The OpenStack Client" id="MSDG1-189e69df43a248268db97cde1b1a8e47"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02" class="calibre1"/>Chapter 2. The OpenStack Client</h1></div></div></div><p class="calibre10">In this chapter, we will cover the following topics:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Introduction – using OpenStack</li><li class="listitem">Installing Python on Windows</li><li class="listitem">Installing the OpenStack clients</li><li class="listitem">Configuring your Linux or macOS environment</li><li class="listitem">Configuring your Windows environment</li><li class="listitem">Common OpenStack networking tasks</li><li class="listitem">Common OpenStack server (instances) tasks</li><li class="listitem">Common OpenStack image tasks</li><li class="listitem">Common OpenStack identity tasks</li><li class="listitem">Common OpenStack storage tasks</li><li class="listitem">Common OpenStack orchestration tasks</li></ul></div></div>

<div class="book" title="Chapter&#xA0;2.&#xA0;The OpenStack Client" id="MSDG1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="Introduction – using OpenStack"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch02lvl1sec21" class="calibre1"/>Introduction – using OpenStack</h1></div></div></div><p class="calibre10">OpenStack can <a id="id65" class="calibre1"/>be interacted with in a number of ways – from using the Horizon (the OpenStack control panel) web interface to, the power of the command <a id="id66" class="calibre1"/>line to using third -party software, all of which are transparently integrated with OpenStack. In this chapter, we will introduce the OpenStack <span class="strong"><strong class="calibre2">Command-Line Interface</strong></span> (<span class="strong"><strong class="calibre2">CLI</strong></span>) and see how to configure it for use with your installation of OpenStack. The OpenStack command-line tools, like the vast majority of OpenStack, are written in Python. This means that there is a direct dependency on Python being available on the computer <a id="id67" class="calibre1"/>that will be running the clients.</p><p class="calibre10">When we interact with OpenStack, we are technically making REST API calls to the services that run the Service <span class="strong"><strong class="calibre2">APIs</strong></span> (<span class="strong"><strong class="calibre2">Application Programming Interfaces</strong></span>). A REST API defines a set of functions that developers can perform requests and receive responses via HTTP protocol such as GET and POST. The OpenStack command-line clients translate your intuitive commands into these HTTP calls. In a typical deployment of OpenStack, and one that has been described in <a class="calibre1" title="Chapter 1. Installing OpenStack with Ansible" href="part0014_split_000.html#DB7S2-189e69df43a248268db97cde1b1a8e47">Chapter 1</a>, <span class="strong"><em class="calibre18">Installing OpenStack with Ansible</em></span>, using Ansible, our OpenStack API services have been deployed across three Controller nodes. To allow us to interact with any one of the three Controller nodes so that <a id="id68" class="calibre1"/>each of them can respond independently, we place these services behind a load balancer. It is the load balancer <span class="strong"><strong class="calibre2">VIP</strong></span> (<span class="strong"><strong class="calibre2">Virtual IP</strong></span>), the IP address we have <a id="id69" class="calibre1"/>associated for use with each of the configured pools, that as a user of OpenStack that we are interested in.</p><p class="calibre10">There is one particular service that a user is interested in when configuring their environment for use with OpenStack and that is the <code class="email">Keystone</code> service.</p><p class="calibre10">The <code class="email">Keystone</code> service (OpenStack Identity service) essentially performs two functions in OpenStack. It authorizes users to allow them to perform the actions they have requested, as well as provides a catalog of services back to the user. This catalog is a mapping of the OpenStack service address endpoints. For this reason, we do not need to configure our client to know where to find each and every OpenStack service. When a user configures their environment to use OpenStack from the command line, the only information they need to be aware of is the IP address and port that <code class="email">Keystone</code> has been installed on. See the following diagram for how this conceptually looks to a user:</p><div class="mediaobject"><img src="../images/00006.jpeg" alt="Introduction – using OpenStack" class="calibre16"/></div><p class="calibre17"> </p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip14" class="calibre1"/>Tip</h3><p class="calibre10">This chapter is intended as a quick reference guide for commands that are explained in more detail throughout the book.</p></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Installing Python on Windows"><div class="book" id="NQU22-189e69df43a248268db97cde1b1a8e47"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec22" class="calibre1"/>Installing Python on Windows</h1></div></div></div><p class="calibre10">In order <a id="id70" class="calibre1"/>to be able to install the required OpenStack client tools under Windows, we must first prepare our Windows desktop machine <a id="id71" class="calibre1"/>with Python. The following applies to Windows 10.</p></div>

<div class="book" title="Installing Python on Windows">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch02lvl2sec42" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre10">Ensure that you are logged into your desktop and have the following installed:</p><div class="book"><ul class="itemizedlist"><li class="listitem">PowerShell</li><li class="listitem">Python 2.7 from here: <a class="calibre1" href="https://www.python.org/downloads/windows/">https://www.python.org/downloads/windows/</a></li><li class="listitem">Microsoft Visual C++ Build Tools with feature Windows 10 SDK</li></ul></div></div></div>

<div class="book" title="Installing Python on Windows">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch02lvl2sec43" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre10">Configuring your Windows environment can be achieved from <span class="strong"><strong class="calibre2">Properties</strong></span> of your PC. Follow these instructions to ensure that Python is available in your system path, as well as set the appropriate environment variables under PowerShell:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Navigate to the <span class="strong"><strong class="calibre2">This PC</strong></span> icon on your desktop and choose <span class="strong"><strong class="calibre2">Properties</strong></span>, as shown here:<div class="mediaobject"><img src="../images/00007.jpeg" alt="How to do it…" class="calibre16"/></div><p class="calibre23"> </p></li><li class="listitem" value="2">Next, choose <span class="strong"><strong class="calibre2">Advanced system settings</strong></span> from the menu on the left:<div class="mediaobject"><img src="../images/00008.jpeg" alt="How to do it…" class="calibre16"/></div><p class="calibre23"> </p></li><li class="listitem" value="3">Now, <a id="id72" class="calibre1"/>select <span class="strong"><strong class="calibre2">Environment Variables</strong></span> from <a id="id73" class="calibre1"/>the <span class="strong"><strong class="calibre2">Advanced</strong></span> tab of the <span class="strong"><strong class="calibre2">System Properties</strong></span> window, as shown here:<div class="mediaobject"><img src="../images/00009.jpeg" alt="How to do it…" class="calibre16"/></div><p class="calibre23"> </p></li><li class="listitem" value="4">To set the path for Python, double-click on the <span class="strong"><strong class="calibre2">Path</strong></span> entry as shown here:<div class="mediaobject"><img src="../images/00010.jpeg" alt="How to do it…" class="calibre16"/></div><p class="calibre23"> </p></li><li class="listitem" value="5">Now <a id="id74" class="calibre1"/>add a <span class="strong"><strong class="calibre2">New</strong></span> line to the path as shown <a id="id75" class="calibre1"/>as follows. We assume that you did a default installation of Python 2.7 and it is installed at <code class="email">C:\Python27</code>:<div class="mediaobject"><img src="../images/00011.jpeg" alt="How to do it…" class="calibre16"/></div><p class="calibre23"> </p></li><li class="listitem" value="6">Now <a id="id76" class="calibre1"/>click on <span class="strong"><strong class="calibre2">OK</strong></span>. When you load up a PowerShell <a id="id77" class="calibre1"/>session, you should now be able to test that Python is working as expected, as shown here:<div class="mediaobject"><img src="../images/00012.jpeg" alt="How to do it…" class="calibre16"/></div><p class="calibre23"> </p></li><li class="listitem" value="7">You should now be able to install the OpenStack clients as described in the next recipe.</li></ol><div class="calibre20"/></div></div></div>

<div class="book" title="Installing Python on Windows">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch02lvl2sec44" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre10">Configuring <a id="id78" class="calibre1"/>your Windows environment is a little more involved than it is for Unix/Linux environments. We first have to ensure that Python is set up <a id="id79" class="calibre1"/>properly, and available for use in a shell. We then to have a mechanism for loading environment variables into our shell, which isn't a native feature of Windows. We do this using a PowerShell script. However, because PowerShell is quite powerful, we have to remove a restriction to allow this to work. Once we have this all set up correctly, we are able to use the OpenStack environment from our Windows desktop.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Installing the OpenStack clients" id="OPEK1-189e69df43a248268db97cde1b1a8e47"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec23" class="calibre1"/>Installing the OpenStack clients</h1></div></div></div><p class="calibre10">There are <a id="id80" class="calibre1"/>a number of OpenStack clients available that are used to interact with OpenStack from the command line. Historically, each service in OpenStack has its own client. For example, the OpenStack Compute project, Nova, has its own <code class="email">nova</code> client. Similarly, the OpenStack networking project, Neutron, also has its own client called <code class="email">neutron</code> client. And so on.</p><p class="calibre10">Officially, there is a convergence to using one client: the OpenStack client. However, not all commands and features are available under this one tool. Moreover, the OpenStack client still requires each individual project command-line tool installed to function; however, it provides a more consistent interface without the need to remember each individual project name.</p></div>

<div class="book" title="Installing the OpenStack clients" id="OPEK1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch02lvl2sec45" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre10">As we are <a id="id81" class="calibre1"/>preparing your desktop for interacting with OpenStack from the command line, you will appreciate that there are a variety of choices you can make for your desktop OS of choice. This section will describe the installation of OpenStack clients.</p><p class="calibre10">As we will be installing the OpenStack clients using <code class="email">pip</code>, ensure that this is installed by following these steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">First, load up a Terminal and become the <span class="strong"><em class="calibre18">root</em></span> user with the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">sudo -i</strong></span>
</pre></div></li><li class="listitem" value="2">We'll be using <code class="email">pip</code> to install the clients. If <code class="email">pip</code> is not installed, carry out the following steps:<p class="calibre22">On macOS or variants use this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">wget  https://bootstrap.pypa.io/get-pip.py</strong></span>
<span class="strong"><strong class="calibre2">python get-pip.py</strong></span>
</pre></div></li><li class="listitem" value="3">On popular Linux systems, use your package manager to install the packages:<p class="calibre22">
<span class="strong"><strong class="calibre2">Ubuntu</strong></span>: Ensure that <code class="email">python-dev</code> and <code class="email">python-pip</code> are installed</p><p class="calibre22">
<span class="strong"><strong class="calibre2">Red Hat</strong></span>: Ensure that <code class="email">python-devel</code> and <code class="email">python-pip</code> are installed</p></li></ol><div class="calibre20"/></div><div class="informalexample" title="Note"><h3 class="title2"><a id="note02" class="calibre1"/>Note</h3><p class="calibre10">
<span class="strong"><strong class="calibre2">Windows</strong></span>: Be sure that you have Python installed and available in <span class="strong"><strong class="calibre2">PATH</strong></span> and Microsoft Visual C++ Build Tools installed.</p></div></div></div>

<div class="book" title="Installing the OpenStack clients" id="OPEK1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch02lvl2sec46" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre10">With <code class="email">pip</code> installed on our system, we are able to install the clients using the following simple steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">To install the OpenStack client, carry out the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">pip install python-openstackclient</strong></span>
</pre></div></li><li class="listitem" value="2">To install the individual clients, carry out the following commands:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">pip install python-novaclient</strong></span>
<span class="strong"><strong class="calibre2">pip install python-neutronclient</strong></span>
<span class="strong"><strong class="calibre2">pip install python-glanceclient</strong></span>
<span class="strong"><strong class="calibre2">pip install python-heatclient</strong></span>
<span class="strong"><strong class="calibre2">pip install python-keystoneclient</strong></span>
<span class="strong"><strong class="calibre2">pip install python-cinderclient</strong></span>
<span class="strong"><strong class="calibre2">pip install python-swiftclient</strong></span>
</pre></div></li></ol><div class="calibre20"/></div><div class="informalexample" title="Note"><h3 class="title2"><a id="tip15" class="calibre1"/>Tip</h3><p class="calibre10">Each of the projects have their own client, so the syntax is:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">pip install python-PROJECTclient</strong></span>
</pre></div></div><div class="book" title="Alternative – use a preconfigured OpenStack client virtual machine"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec02" class="calibre1"/>Alternative – use a preconfigured OpenStack client virtual machine</h3></div></div></div><p class="calibre10">Sometimes <a id="id82" class="calibre1"/>the clients are in development at a different pace to the projects installed in your, environment which can make <a id="id83" class="calibre1"/>for version incompatibilities. To overcome this, either use <code class="email">virtualenv</code> (<a class="calibre1" href="https://pypi.python.org/pypi/virtualenv">https://pypi.python.org/pypi/virtualenv</a>) or use a virtual machine, under VirtualBox, that has been preconfigured for accessing your OpenStack environments. To use a prebuilt virtual environment, carry out the following:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Clone the client VirtualBox Vagrant environment:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">git clone https://github.com/OpenStackCookbook/openstack-client.git</strong></span>
</pre></div></li><li class="listitem" value="2">Launch the client:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">cd openstack-client</strong></span>
<span class="strong"><strong class="calibre2">vagrant up</strong></span>
</pre></div></li><li class="listitem" value="3">Access the virtual machine:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">vagrant ssh</strong></span>
</pre></div></li></ol><div class="calibre20"/></div></div></div></div>

<div class="book" title="Installing the OpenStack clients" id="OPEK1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch02lvl2sec47" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre10">Installing <a id="id84" class="calibre1"/>the OpenStack clients is made very simple using the <code class="email">pip</code> command-line tool, which is used to install Python packages. The main tool for using OpenStack on the command line is called the <span class="strong"><strong class="calibre2">OpenStack client</strong></span>. This tool is used to <a id="id85" class="calibre1"/>control all aspects of OpenStack. However, there are some commands and options that have yet to make it into the main OpenStack clients. To overcome this, the older legacy project tools can still be used. Ensure that these are also installed using the following syntax:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">pip install python-PROJECTclient</strong></span>
</pre></div><p class="calibre10">Replace <span class="strong"><em class="calibre18">PROJECT</em></span> with the specific name of the OpenStack project, such as <span class="strong"><em class="calibre18">glance</em></span> or <span class="strong"><em class="calibre18">neutron</em></span>.</p><p class="calibre10">Alternatively, create <a id="id86" class="calibre1"/>these tools in small virtual machine so that the tools are always available. A Vagrant OpenStack client environment is available from <a class="calibre1" href="https://github.com/OpenStackCookbook/ope">https://github.com/OpenStackCookbook/ope</a>.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Configuring your Linux or macOS environment" id="PNV61-189e69df43a248268db97cde1b1a8e47"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec24" class="calibre1"/>Configuring your Linux or macOS environment</h1></div></div></div><p class="calibre10">The OpenStack <a id="id87" class="calibre1"/>tools are configured by setting environment <a id="id88" class="calibre1"/>variables in your shell or desktop.</p></div>

<div class="book" title="Configuring your Linux or macOS environment" id="PNV61-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch02lvl2sec48" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre10">Ensure that you have the OpenStack clients installed as described in the first recipe, <span class="strong"><em class="calibre18">Introduction – using OpenStack</em></span>, in this chapter.</p></div></div>

<div class="book" title="Configuring your Linux or macOS environment" id="PNV61-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch02lvl2sec49" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre10">Configuration of your command-line environment is achieved by setting environment variables; however, it is easier and more convenient to place these variables in a file that we can later load into our environment. During the installation, OpenStack-Ansible creates a plain text file called <code class="email">openrc</code> and places this in the <code class="email">/root</code> directory of all the containers created. This file is a great starting point for configuring the environment as it has all the required elements needed to operate your CLI environment.</p><p class="calibre10">On your own client, for example, Linux or Mac-based, choose a working directory, such as <code class="email">$HOME/openstack</code>, and create a file called <code class="email">openrc</code> (or a meaningful name of your choice) with the following contents:</p><div class="informalexample"><pre class="programlisting">export OS_USERNAME=admin
export OS_PASSWORD=secrete
export OS_TENANT_NAME=admin
export OS_AUTH_URL=http://192.168.100.117:5000/v3
export OS_NO_CACHE=1
export OS_USER_DOMAIN_NAME=Default
export OS_PROJECT_DOMAIN_NAME=Default

export OS_IDENTITY_API_VERSION=3
export OS_AUTH_VERSION=3</pre></div><p class="calibre10">Now you use this file in your shell by sourcing it as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">source openrc</strong></span>
</pre></div><div class="informalexample" title="Note"><h3 class="title2"><a id="tip16" class="calibre1"/>Tip</h3><p class="calibre10">In Bash, you can use this syntax too:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">    . openrc</strong></span>
</pre></div><p class="calibre10">This file <a id="id89" class="calibre1"/>includes authentication details into your cloud environment. Keep it safe and ensure the permissions don't allow any other users to <a id="id90" class="calibre1"/>read this file. If in doubt, just set the permissions as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">chmod 0600 openrc</strong></span>
</pre></div><p class="calibre10">This will set the file to be read/write for you (user) only.</p></div><p class="calibre10">You can now use the command-line tools. If anything has gone wrong when executing the commands in the book, check your credentials in the file – ensure that you've set the correct tenant/project, username, and password, as well as ensure you're specifying the correct OpenStack authentication URL endpoint. Once you make any changes to this file, remember to source them back into your shell.</p></div></div>

<div class="book" title="Configuring your Linux or macOS environment" id="PNV61-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch02lvl2sec50" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre10">Essentially, we're just setting some environment variables in our shell, which our client tools use to authenticate into our OpenStack environment. To make it easier though, we store these environment variables in a file. This makes access to our environment easy as we just run one command to set all the required credentials.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Configuring your Windows environment" id="QMFO1-189e69df43a248268db97cde1b1a8e47"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec25" class="calibre1"/>Configuring your Windows environment</h1></div></div></div><p class="calibre10">Configuring <a id="id91" class="calibre1"/>your Windows environment for use with OpenStack requires a little more effort – but the basic premise remains: we're configuring our desktop so that it has access to environment variables, as well as ensuring that our tools, written in Python, are able to execute properly.</p></div>

<div class="book" title="Configuring your Windows environment" id="QMFO1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch02lvl2sec51" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre10">The following applies to Windows 10. Ensure that you have followed the steps to install Python.</p></div></div>

<div class="book" title="Configuring your Windows environment" id="QMFO1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch02lvl2sec52" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre10">Carry out the following to load the required environment variables into your Windows session:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">To be able to source in the required OpenStack environment functions as we do on a Unix/Linux platform, we can achieve a similar outcome using some PowerShell. In the PowerShell Terminal, go and grab the following PowerShell script and download it into your working client directory (for example <code class="email">C:\Users\Username\OpenStack</code>):<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">mkdir OpenStack</strong></span>
<span class="strong"><strong class="calibre2">cd OpenStack</strong></span>
<span class="strong"><strong class="calibre2">wget https://raw.githubusercontent.com/OpenStackCookbook/vagrant-openstack/master/Source-OpenRC.ps1 -UseBasicParsing -OutFile Source-OpenRC.ps1</strong></span>
</pre></div></li><li class="listitem" value="2">Using the <a id="id92" class="calibre1"/>same OpenStack credentials as described in the <span class="strong"><em class="calibre18">Configuring your Linux or macOS environment</em></span> recipe, ensure that it is named <code class="email">openrc</code> to match the following example and execute the following in PowerShell:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">.\Source-OpenRC.ps1 .\openrc</strong></span>
</pre></div><div class="note" title="Note"><h3 class="title2"><a id="note03" class="calibre1"/>Note</h3><p class="calibre10">
<span class="strong"><strong class="calibre2">Warning</strong></span>: You may get an error executing the PowerShell script. Most Windows 10 desktops appear to have a default policy of restricted, which excludes the running of PowerShell scripts that aren't signed – even the ones you have created yourself. To remove this for this session, execute the following and acknowledge the warning:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">Set-ExecutionPolicy –ExecutionPolicy RemoteSigned Unrestricted -Scope CurrentUser</strong></span>
</pre></div></div></li><li class="listitem" value="3">You should now be able to use your OpenStack clients under your Windows desktop PowerShell Terminal.</li></ol><div class="calibre20"/></div></div></div>

<div class="book" title="Configuring your Windows environment" id="QMFO1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch02lvl2sec53" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre10">Configuring your Windows environment is a little more involved than it is for Unix/Linux environments. We have to have a mechanism for loading environment variables into our shell that isn't a native feature of Windows. We do this using a PowerShell script. However, we have to remove a restriction to allow this to work. Once we have this all set up correctly, we are able to use the OpenStack environment from our Windows desktop.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Common OpenStack networking tasks" id="RL0A1-189e69df43a248268db97cde1b1a8e47"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec26" class="calibre1"/>Common OpenStack networking tasks</h1></div></div></div><p class="calibre10">This section <a id="id93" class="calibre1"/>outlines common OpenStack networking tasks for quick reference only. For more details on using Neutron and how Neutron works – including details of when and where to use features such as Floating IPs and Routers, refer to <a class="calibre1" title="Chapter 4. Neutron – OpenStack Networking" href="part0048_split_000.html#1DOR01-189e69df43a248268db97cde1b1a8e47">Chapter 4</a>, <span class="strong"><em class="calibre18">Neutron –  OpenStack Networking</em></span>.</p></div>

<div class="book" title="Common OpenStack networking tasks" id="RL0A1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch02lvl2sec54" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre10">Ensure that you have the OpenStack clients installed, as described in the first recipes in this chapter.</p></div></div>

<div class="book" title="Common OpenStack networking tasks" id="RL0A1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch02lvl2sec55" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre10">Carry out the following steps to create and modify networks in OpenStack:</p><div class="book" title="Creating a network"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec03" class="calibre1"/>Creating a network</h3></div></div></div><p class="calibre10">There are <a id="id94" class="calibre1"/>usually two steps to create <a id="id95" class="calibre1"/>a network: creating the equivalent of an L2 network, followed by assigning a subnet (and details to it).</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">First, create the network:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack network create NETWORK_NAME</strong></span>
</pre></div></li><li class="listitem" value="2">Now create the subnet on this network:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack subnet create SUBNET_NAME</strong></span>
<span class="strong"><strong class="calibre2">    --network NETWORK_NAME--subnet-range CIDR</strong></span>
</pre></div></li></ol><div class="calibre20"/></div><div class="book" title="Creating a provider network (for use with Floating IPs)"><div class="book"><div class="book"><div class="book"><h4 class="title3"><a id="ch02lvl4sec01" class="calibre1"/>Creating a provider network (for use with Floating IPs)</h4></div></div></div><p class="calibre10">To create <a id="id96" class="calibre1"/>a floating IP provider network, carry out the following commands. This command assumes that our provider interface, as seen from OpenStack (and configured in Neutron), is using the "flat" interface. Typical deployments in a datacenter would likely use "vlan" as the provider type and device, so adjust to suit your environment.</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">First, create the network (in this example, we're specifying a provider type of <code class="email">flat</code>):<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack network create </strong></span>
<span class="strong"><strong class="calibre2">    --share </strong></span>
<span class="strong"><strong class="calibre2">    --project admin </strong></span>
<span class="strong"><strong class="calibre2">    --external </strong></span>
<span class="strong"><strong class="calibre2">    --default </strong></span>
<span class="strong"><strong class="calibre2">    --provider-network-type flat </strong></span>
<span class="strong"><strong class="calibre2">    --provider-physical-network flat </strong></span>
<span class="strong"><strong class="calibre2">    GATEWAY_NET</strong></span>
</pre></div></li><li class="listitem" value="2">Now we <a id="id97" class="calibre1"/>specify some options of the subnet that make sense for this network to be accessed from outside of OpenStack:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack subnet create</strong></span>
<span class="strong"><strong class="calibre2">    --project admin</strong></span>
<span class="strong"><strong class="calibre2">    --subnet-range 192.168.100.0/24</strong></span>
<span class="strong"><strong class="calibre2">    --dhcp</strong></span>
<span class="strong"><strong class="calibre2">    --gateway 192.168.100.1</strong></span>
<span class="strong"><strong class="calibre2">    --allocation-pool start=192.168.100.200,end=192.168.100.250</strong></span>
<span class="strong"><strong class="calibre2">    --network GATEWAY_NET</strong></span>
<span class="strong"><strong class="calibre2">    GATEWAY_SUBNET</strong></span>
</pre></div></li></ol><div class="calibre20"/></div></div><div class="book" title="Creating a new security group"><div class="book"><div class="book"><div class="book"><h4 class="title3"><a id="ch02lvl4sec02" class="calibre1"/>Creating a new security group</h4></div></div></div><p class="calibre10">Creating <a id="id98" class="calibre1"/>a new security group, for example, <code class="email">webserver</code> in the project <code class="email">development</code>, is achieved as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack security group create </strong></span>
<span class="strong"><strong class="calibre2">    --project development </strong></span>
<span class="strong"><strong class="calibre2">    webserver</strong></span>
</pre></div></div><div class="book" title="Adding a rule to a security group"><div class="book"><div class="book"><div class="book"><h4 class="title3"><a id="ch02lvl4sec03" class="calibre1"/>Adding a rule to a security group</h4></div></div></div><p class="calibre10">To add a <a id="id99" class="calibre1"/>rule to a security group called <code class="email">webserver</code> created in the previous step, such as allowing inbound access from anywhere to port <code class="email">80</code>, carry out the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack security group rule create</strong></span>
<span class="strong"><strong class="calibre2">    --remote-ip 0.0.0.0/0</strong></span>
<span class="strong"><strong class="calibre2">    --dst-port 80:80</strong></span>
<span class="strong"><strong class="calibre2">    --protocol tcp</strong></span>
<span class="strong"><strong class="calibre2">    --ingress</strong></span>
<span class="strong"><strong class="calibre2">    --project development</strong></span>
<span class="strong"><strong class="calibre2">    webserver</strong></span>
</pre></div></div><div class="book" title="Creating a router"><div class="book"><div class="book"><div class="book"><h4 class="title3"><a id="ch02lvl4sec04" class="calibre1"/>Creating a router</h4></div></div></div><p class="calibre10">To create <a id="id100" class="calibre1"/>a router called <code class="email">myRouter</code> in our project, execute the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack router add myRouter</strong></span>
</pre></div></div><div class="book" title="Adding a subnet to a router"><div class="book"><div class="book"><div class="book"><h4 class="title3"><a id="ch02lvl4sec05" class="calibre1"/>Adding a subnet to a router</h4></div></div></div><p class="calibre10">To add <a id="id101" class="calibre1"/>a private tenant subnet, called <code class="email">private-subnet</code>, to our router called <code class="email">myRouter</code>, issue the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack router add subnet myRouter private-subnet</strong></span>
</pre></div><div class="book" title="Setting a gateway on the router"><div class="book"><div class="book"><div class="book"><h5 class="title4"><a id="ch02lvl5sec01" class="calibre24"/>Setting a gateway on the router</h5></div></div></div><p class="calibre10">To add <a id="id102" class="calibre1"/>a gateway to our router, we first must ensure that the gateway network has been created with the <code class="email">--external</code> flag as described in the <span class="strong"><em class="calibre18">Creating a provider network</em></span> section in this chapter (for use with Floating IPs). We will then execute the following command to set the external gateway network to be that of <code class="email">GATEWAY_NET</code> on our router called <code class="email">myRouter</code>:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack router set myRouter </strong></span>
<span class="strong"><strong class="calibre2">--external-gateway GATEWAY_NET</strong></span>
</pre></div></div></div></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Common OpenStack server (instances) tasks" id="SJGS1-189e69df43a248268db97cde1b1a8e47"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec27" class="calibre1"/>Common OpenStack server (instances) tasks</h1></div></div></div><p class="calibre10">This section <a id="id103" class="calibre1"/>outlines a number of common commands that can be run when operating with instances (for example, virtual machines). For more detailed information and explanation of each task, refer to <a class="calibre1" title="Chapter 5. Nova – OpenStack Compute" href="part0062_split_000.html#1R42S1-189e69df43a248268db97cde1b1a8e47">Chapter 5</a>, <span class="strong"><em class="calibre18">Nova – OpenStack Compute</em></span>.</p></div>

<div class="book" title="Common OpenStack server (instances) tasks" id="SJGS1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch02lvl2sec56" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre10">Ensure that you have the OpenStack clients installed as described in the first recipes of this chapter.</p></div></div>

<div class="book" title="Common OpenStack server (instances) tasks" id="SJGS1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch02lvl2sec57" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre10">Carry out the following to launch and manipulate running instances:</p><div class="book" title="Launching an instance"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec04" class="calibre1"/>Launching an instance</h3></div></div></div><p class="calibre10">To launch <a id="id104" class="calibre1"/>in an instance from the command line, you need the following information:</p><div class="book"><ul class="itemizedlist"><li class="listitem">An image</li><li class="listitem">A network</li><li class="listitem">A flavor</li><li class="listitem">An optional security group (default is used otherwise)</li><li class="listitem">An optional key (if you intend to access the instance)</li></ul></div><p class="calibre10">Carry out the following steps to launch an instance from the command line:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">First, list the images available:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack image list</strong></span>
</pre></div></li><li class="listitem" value="2">Now we list the networks available (it will be the UUID of the Network we will use):<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack network list</strong></span>
</pre></div></li><li class="listitem" value="3">We need a flavor, if you need reminding of them, list them with the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack flavor list</strong></span>
</pre></div></li><li class="listitem" value="4">If you require specific security groups, list them with the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack security group list</strong></span>
</pre></div></li><li class="listitem" value="5">If you <a id="id105" class="calibre1"/>need to get the name of the key pair to use, use the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack keypair list</strong></span>
</pre></div></li><li class="listitem" value="6">Now you can boot the instance with the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack server create</strong></span>
<span class="strong"><strong class="calibre2">    --image IMAGE</strong></span>
<span class="strong"><strong class="calibre2">    --flavor FLAVOR</strong></span>
<span class="strong"><strong class="calibre2">    --security-group SECGROUP</strong></span>
<span class="strong"><strong class="calibre2">    --nic net-id=NETWORK_UUID</strong></span>
<span class="strong"><strong class="calibre2">    --key-name KEYPAIR_NAME</strong></span>
<span class="strong"><strong class="calibre2">    INSTANCE_NAME</strong></span>
</pre></div></li></ol><div class="calibre20"/></div></div><div class="book" title="Listing OpenStack Instances"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec05" class="calibre1"/>Listing OpenStack Instances</h3></div></div></div><p class="calibre10">To list the OpenStack instances launched, issue the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack server list</strong></span>
</pre></div></div><div class="book" title="Create instance snapshot"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec06" class="calibre1"/>Create instance snapshot</h3></div></div></div><p class="calibre10">To create <a id="id106" class="calibre1"/>a snapshot of a running instance, carry out the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack server image create</strong></span>
<span class="strong"><strong class="calibre2">    --name snapshotRunningWebserver1</strong></span>
<span class="strong"><strong class="calibre2">    myRunningWebserver1</strong></span>
</pre></div></div><div class="book" title="Resizing an instance"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec07" class="calibre1"/>Resizing an instance</h3></div></div></div><p class="calibre10">To alter <a id="id107" class="calibre1"/>the flavor of a running instance and respawn with the new settings, carry out the following commands:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">We first specify the new flavor size with the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack server resize --flavor m1.small myWebserver1</strong></span>
</pre></div></li><li class="listitem" value="2">Next, list <a id="id108" class="calibre1"/>the running instances to confirm the state. The status should be <code class="email">VERIFY_RESIZE</code>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack server list</strong></span>
</pre></div><p class="calibre22">This shows output like the following:</p><div class="mediaobject"><img src="../images/00013.jpeg" alt="Resizing an instance" class="calibre16"/></div><p class="calibre23"> </p></li><li class="listitem" value="3">Then we confirm the action with the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack server resize --confirm myWebserver1</strong></span>
</pre></div></li></ol><div class="calibre20"/></div></div><div class="book" title="Creating a flavor"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec08" class="calibre1"/>Creating a flavor</h3></div></div></div><p class="calibre10">To create <a id="id109" class="calibre1"/>a flavor, called <code class="email">m1.tiny</code>, which is made up of 512 MB RAM, 1 vCPU, and no fixed size disk, carry out the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack flavor create</strong></span>
<span class="strong"><strong class="calibre2">    --ram 512</strong></span>
<span class="strong"><strong class="calibre2">    --disk 0</strong></span>
<span class="strong"><strong class="calibre2">  </strong></span>
<span class="strong"><strong class="calibre2">  --vcpus 1</strong></span>
<span class="strong"><strong class="calibre2">    --public</strong></span>
<span class="strong"><strong class="calibre2">    m1.tiny</strong></span>
</pre></div></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Common OpenStack image tasks" id="TI1E1-189e69df43a248268db97cde1b1a8e47"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec28" class="calibre1"/>Common OpenStack image tasks</h1></div></div></div><p class="calibre10">This section <a id="id110" class="calibre1"/>outlines a number of steps, intended as a quick overview only, when operating against the OpenStack Image service (known as Glance). For more detailed information and explanation of each task, refer to <a class="calibre1" title="Chapter 6. Glance – OpenStack Image Service" href="part0087_split_000.html#2IV0U1-189e69df43a248268db97cde1b1a8e47">Chapter 6</a>, <span class="strong"><em class="calibre18">Glance – OpenStack Image Service</em></span>.</p></div>

<div class="book" title="Common OpenStack image tasks" id="TI1E1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch02lvl2sec58" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre10">Ensure that you have the OpenStack clients installed, as described in the first recipes in this chapter.</p></div></div>

<div class="book" title="Common OpenStack image tasks" id="TI1E1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch02lvl2sec59" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre10">Carry out the following steps to create and modify images in OpenStack:</p><div class="book" title="Uploading an image to Glance"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec09" class="calibre1"/>Uploading an image to Glance</h3></div></div></div><p class="calibre10">Uploading an <a id="id111" class="calibre1"/>image to OpenStack is achieved with the following. To upload, a QCOW2 image such as one provided by CirrOS for testing, carry out the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack image create</strong></span>
<span class="strong"><strong class="calibre2">    --container-type bare</strong></span>
<span class="strong"><strong class="calibre2">    --disk-format qcow2</strong></span>
<span class="strong"><strong class="calibre2">    --public</strong></span>
<span class="strong"><strong class="calibre2">    --file</strong></span>
<span class="strong"><strong class="calibre2"> /path/to/cirros-0.3.5-x86_64-disk.img</strong></span>
</pre></div></div><div class="book" title="Downloading an image or snapshot from Glance as a file"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec10" class="calibre1"/>Downloading an image or snapshot from Glance as a file</h3></div></div></div><p class="calibre10">To download <a id="id112" class="calibre1"/>an image <a id="id113" class="calibre1"/>from Glance, perhaps for copying to another environment or to store as an offsite backup, carry out the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack image save</strong></span>
<span class="strong"><strong class="calibre2">    --file myImage.qcow2 myImage</strong></span>
</pre></div></div><div class="book" title="Sharing images between projects"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec11" class="calibre1"/>Sharing images between projects</h3></div></div></div><p class="calibre10">In most <a id="id114" class="calibre1"/>situations, an image is either public (available to all projects), or private (only available to the project that the image was uploaded onto). However, you are able to share a private image to isolated projects of your choosing. To do this, you will need the following:</p><div class="book"><ul class="itemizedlist"><li class="listitem">The image UUID of the image you will be sharing</li><li class="listitem">The UUID of the project that you will be sharing the image with</li></ul></div><p class="calibre10">Carry out the following steps to share an image with another project. In the following example, we will share the <code class="email">cirros-image</code>, currently only available in <code class="email">admin</code> project with the <code class="email">anotherProject</code> project:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">First, query the project list:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack project list</strong></span>
</pre></div><p class="calibre22">This will bring back output like the following:</p><div class="mediaobject"><img src="../images/00014.jpeg" alt="Sharing images between projects" class="calibre16"/></div><p class="calibre23"> </p></li><li class="listitem" value="2">We will set the image to be shared:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack image set cirros-image --shared</strong></span>
</pre></div></li><li class="listitem" value="3">We will then tell OpenStack which project we want this sharing using the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack image add project anotherProject</strong></span>
</pre></div><p class="calibre22">This will bring back output like the following – we will use the <span class="strong"><strong class="calibre2">image_id</strong></span> in the next step:</p><div class="mediaobject"><img src="../images/00015.jpeg" alt="Sharing images between projects" class="calibre16"/></div><p class="calibre23"> </p></li><li class="listitem" value="4">Important: as a user in the <span class="strong"><strong class="calibre2">receiving</strong></span> (<span class="strong"><strong class="calibre2">anotherProject</strong></span>) project, execute the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack image set --accept f6578a80-5f6f-4f2d-9a8a-9d84cec8a60d</strong></span>
</pre></div></li><li class="listitem" value="5">Now, as <a id="id115" class="calibre1"/>that same user, you can confirm that you can see this shared image by executing an image listing:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack image list</strong></span>
</pre></div><p class="calibre22">This will bring back output like the following, showing the available image:</p><div class="mediaobject"><img src="../images/00016.jpeg" alt="Sharing images between projects" class="calibre16"/></div><p class="calibre23"> </p></li></ol><div class="calibre20"/></div></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Common OpenStack identity tasks" id="UGI01-189e69df43a248268db97cde1b1a8e47"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec29" class="calibre1"/>Common OpenStack identity tasks</h1></div></div></div><p class="calibre10">This <a id="id116" class="calibre1"/>section outlines a number of common steps to take for a number of common actions using the OpenStack Identity service. This is intended as a quick reference guide only. For more detailed information and explanation of each task, refer to <a class="calibre1" title="Chapter 3. Keystone – OpenStack Identity Service" href="part0035_split_000.html#11C3M1-189e69df43a248268db97cde1b1a8e47">Chapter 3</a>, <span class="strong"><em class="calibre18">Keystone – OpenStack Identity Service</em></span>.</p></div>

<div class="book" title="Common OpenStack identity tasks" id="UGI01-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch02lvl2sec60" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre10">Ensure that you have the OpenStack clients installed, as described in the first recipes of this chapter.</p></div></div>

<div class="book" title="Common OpenStack identity tasks" id="UGI01-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch02lvl2sec61" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre10">Carry out the following steps to create and modify users and projects in OpenStack:</p><div class="book" title="Creating a new project"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec12" class="calibre1"/>Creating a new project</h3></div></div></div><p class="calibre10">Creating a <a id="id117" class="calibre1"/>new user in a project is achieved with the following command. For example, to create the project called <code class="email">development</code>, execute the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack project create development</strong></span>
</pre></div></div><div class="book" title="Creating a user"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec13" class="calibre1"/>Creating a user</h3></div></div></div><p class="calibre10">To create <a id="id118" class="calibre1"/>a user called <code class="email">developer</code>, with a password of <code class="email">password123</code>, carry out the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack user create</strong></span>
<span class="strong"><strong class="calibre2">    --domain default</strong></span>
<span class="strong"><strong class="calibre2">    --password password123</strong></span>
<span class="strong"><strong class="calibre2">    --enable</strong></span>
<span class="strong"><strong class="calibre2">    developer</strong></span>
</pre></div></div><div class="book" title="Adding a user to a project"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec14" class="calibre1"/>Adding a user to a project</h3></div></div></div><p class="calibre10">To add <a id="id119" class="calibre1"/>a user with the <code class="email">_member_</code> role (regular user) to the <code class="email">development</code> project, carry out the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack role add</strong></span>
<span class="strong"><strong class="calibre2">    --project development</strong></span>
<span class="strong"><strong class="calibre2">    --user developer</strong></span>
<span class="strong"><strong class="calibre2">    _member_</strong></span>
</pre></div></div><div class="book" title="Changing a user's password as an administrator"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec15" class="calibre1"/>Changing a user's password as an administrator</h3></div></div></div><p class="calibre10">As an <a id="id120" class="calibre1"/>administrator, you have the ability to alter someone's password. To do this for the <code class="email">developer</code> user, carry out the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack user set --password cookbook4 developer</strong></span>
</pre></div></div><div class="book" title="Changing your own password"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec16" class="calibre1"/>Changing your own password</h3></div></div></div><p class="calibre10">To change <a id="id121" class="calibre1"/>your own password to something else, issue the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack user password set --password cookbook4</strong></span>
</pre></div></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Common OpenStack storage tasks" id="VF2I1-189e69df43a248268db97cde1b1a8e47"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec30" class="calibre1"/>Common OpenStack storage tasks</h1></div></div></div><p class="calibre10">This section <a id="id122" class="calibre1"/>outlines a number of common tasks using the OpenStack Block and Object Storage service. For more information on storage, refer to <a class="calibre1" title="Chapter 7. Cinder – OpenStack Block Storage" href="part0094_split_000.html#2PKKS1-189e69df43a248268db97cde1b1a8e47">Chapter 7</a>, <span class="strong"><em class="calibre18">Cinder – OpenStack Block Storage</em></span> and <a class="calibre1" title="Chapter 8. Swift – OpenStack Object Storage" href="part0105_split_000.html#344B21-189e69df43a248268db97cde1b1a8e47">Chapter 8</a>, <span class="strong"><em class="calibre18">Swift – OpenStack Object Storage</em></span>.</p></div>

<div class="book" title="Common OpenStack storage tasks" id="VF2I1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch02lvl2sec62" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre10">Ensure that you have the OpenStack clients installed, as described in the first recipes of this chapter.</p></div></div>

<div class="book" title="Common OpenStack storage tasks" id="VF2I1-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch02lvl2sec63" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre10">Carry out the following steps to create and modify users and projects in OpenStack:</p><div class="book" title="Create a new Cinder volume"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec17" class="calibre1"/>Create a new Cinder volume</h3></div></div></div><p class="calibre10">To create <a id="id123" class="calibre1"/>a new Cinder block storage volume, carry out the following command. The size is in gigabytes:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack volume create --size 5 my5GVolume</strong></span>
</pre></div></div><div class="book" title="Attaching a volume"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec18" class="calibre1"/>Attaching a volume</h3></div></div></div><p class="calibre10">To attach <a id="id124" class="calibre1"/>a volume to a running instance, carry out the following command. The running <span class="strong"><strong class="calibre2">instance UUID</strong></span> is used and can be found by listing the running instances:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack server add volume my5GVolume 58ea640b-16ba-447c-85db-952174d70f7c</strong></span>
</pre></div></div><div class="book" title="Detaching a volume"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec19" class="calibre1"/>Detaching a volume</h3></div></div></div><p class="calibre10">To detach <a id="id125" class="calibre1"/>a volume, first unmount it from the running instance as you would normally, then carry out the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack server remove volume my5GVolume 58ea640b-16ba-447c-85db-952174d70f7c</strong></span>
</pre></div></div><div class="book" title="Creating a volume snapshot"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec20" class="calibre1"/>Creating a volume snapshot</h3></div></div></div><p class="calibre10">To make <a id="id126" class="calibre1"/>a snapshot of a volume, carry out the following steps. First, you must detach the volume from the running instance to ensure data consistency. The action is described in the previous task.</p><p class="calibre10">Now once detached, issue the following</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack snapshot create --name myVolumeSnapshot myVolume</strong></span>
</pre></div><p class="calibre10">Listing Object Storage statistics</p><p class="calibre10">To display information about Object Storage containers, carry out the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack object store account show</strong></span>
</pre></div></div><div class="book" title="Listing Object Storage containers and contents"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec21" class="calibre1"/>Listing Object Storage containers and contents</h3></div></div></div><p class="calibre10">To list <a id="id127" class="calibre1"/>contents of an object <a id="id128" class="calibre1"/>store, issue the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack object store list</strong></span>
<span class="strong"><strong class="calibre2">openstack object store list myContainer</strong></span>
</pre></div></div><div class="book" title="Creating and uploading files to the Object Storage service"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec22" class="calibre1"/>Creating and uploading files to the Object Storage service</h3></div></div></div><p class="calibre10">To create <a id="id129" class="calibre1"/>an Object Storage container, issue the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack object create myContainer</strong></span>
</pre></div><p class="calibre10">To upload <a id="id130" class="calibre1"/>files to an Object Storage container, issue the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack object create myContainer myFile  </strong></span>
</pre></div></div><div class="book" title="Downloading from Object Storage"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec23" class="calibre1"/>Downloading from Object Storage</h3></div></div></div><p class="calibre10">To download <a id="id131" class="calibre1"/>files from an Object Storage container, use this command</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack object save myContainer myFile</strong></span>
</pre></div><p class="calibre10">To download all files from an Object Storage container, issue the following command</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack object save myContainer</strong></span>
</pre></div></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Common OpenStack orchestration tasks" id="10DJ41-189e69df43a248268db97cde1b1a8e47"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec31" class="calibre1"/>Common OpenStack orchestration tasks</h1></div></div></div><p class="calibre10">This section <a id="id132" class="calibre1"/>outlines a number of common tasks using the OpenStack Orchestration (Heat) service to launch <span class="strong"><em class="calibre18">stacks</em></span> (orchestrated environments using Heat). For more information on Heat and orchestration, refer to <a class="calibre1" title="Chapter 9. OpenStack Orchestration Using Heat and Ansible" href="part0113_split_000.html#3BOFI1-189e69df43a248268db97cde1b1a8e47">Chapter 9</a>, <span class="strong"><em class="calibre18">OpenStack Orchestration Using Heat and Ansible</em></span>.</p></div>

<div class="book" title="Common OpenStack orchestration tasks" id="10DJ41-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch02lvl2sec64" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre10">Ensure that you have the OpenStack clients installed, as described in the first recipes of this chapter.</p></div></div>

<div class="book" title="Common OpenStack orchestration tasks" id="10DJ41-189e69df43a248268db97cde1b1a8e47">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch02lvl2sec65" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre10">Carry out the following steps to create and use Heat templates in OpenStack to create orchestrated environments:</p><div class="book" title="Launch a stack from a template and environment file"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec24" class="calibre1"/>Launch a stack from a template and environment file</h3></div></div></div><p class="calibre10">To launch <a id="id133" class="calibre1"/>a stack <a id="id134" class="calibre1"/>from a heat orchestration template (hot), issue the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack stack create</strong></span>
<span class="strong"><strong class="calibre2">    --template myStack.yml</strong></span>
<span class="strong"><strong class="calibre2">    --environment myStack-Env.yml</strong></span>
<span class="strong"><strong class="calibre2">    myStack</strong></span>
</pre></div></div><div class="book" title="Listing stacks"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec25" class="calibre1"/>Listing stacks</h3></div></div></div><p class="calibre10">To list <a id="id135" class="calibre1"/>the running stacks, issue the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack stack list</strong></span>
</pre></div></div><div class="book" title="Deleting a running stack"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec26" class="calibre1"/>Deleting a running stack</h3></div></div></div><p class="calibre10">To destroy <a id="id136" class="calibre1"/>a running stack named <code class="email">myStack</code>, issue the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack stack delete myStack</strong></span>
</pre></div></div><div class="book" title="Listing resources in a stack"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec27" class="calibre1"/>Listing resources in a stack</h3></div></div></div><p class="calibre10">To list <a id="id137" class="calibre1"/>the resources in a running stack, issue the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack stack resource list</strong></span>
</pre></div><p class="calibre10">To list the details of a specific resource, for example, named <code class="email">myResource</code>, issue the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack stack resource show myResource</strong></span>
</pre></div></div><div class="book" title="Viewing the outputs of a running Stack"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec28" class="calibre1"/>Viewing the outputs of a running Stack</h3></div></div></div><p class="calibre10">To view <a id="id138" class="calibre1"/>the outputs produced by the Stack, issue the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack stack output list</strong></span>
</pre></div><p class="calibre10">To view the details of the specific output, carry out the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openstack stack output show myOutput</strong></span>
</pre></div></div></div></div></body></html>