<html><head></head><body><div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Configuring and Managing Identity Protection</h1>
                </header>
            
            <article>
                
<p class="mce-root">After reading about and learning how to configure the monitoring of your identity management infrastructure in the previous chapter, we will now dive into identity protection. Protecting your identity is one of the main focuses of security today, so you should be able to put the right capabilities in place that protect your organization against any attack.</p>
<p class="mce-root">At the beginning of our identity protection journey, we will start with an overview of the Microsoft Cloud services that can help you in this field. We will also dive into a number of different services, starting with the theory before moving on and applying that theory in an example configuration. After working through this chapter, you should be able to identify the correct solution component for your existing or future requirements. To summarize, this chapter covers the following topics:</p>
<ul>
<li>Microsoft Identity Protection solutions</li>
<li>Azure ATP and how to use it</li>
<li>Azure AD Identity Protection</li>
<li>Using Azure AD <strong>Privileged Identity Management</strong> (<strong>PIM</strong>) to protect administrative privileges</li>
</ul>
<p>Let's start with an introduction to Microsoft Identity Protection solutions so we can maximize problem detection during different attack stages.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Microsoft Identity Protection solutions</h1>
                </header>
            
            <article>
                
<p>Microsoft has developed and established a huge portfolio of identity protection features on both Azure and on-premises to help organizations secure their identities and protect themselves against sensitive data leakage. There are many single services available, but a unified identity protection solution is expected in the near future. We already see many integrations between identity protection services that detect, investigate, and prevent advanced attacks, compromised identities, and insider threats—including data leakage<span>—</span>to form a broad and deep identity investigation solution that works on-premises and in the cloud. Some of the more common attacks that are faced by organizations include password spray attacks, leaked or reused credentials, spoofed domains, malicious links or attachments, and much more. The following figure illustrates the different services often used to maximize the detection of attacks in their various stages:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/d2fc75ba-032b-4e2d-a53f-a65f450f40ea.png" style="width:54.00em;height:24.67em;" width="951" height="435"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Attack vectors and protection products overview</div>
<p><span>As you can see in the above figure, an attacker first successfully targets patient zero with backdoor malware designed to establish command and control. The attacker then moves laterally through the network and obtains privileged credentials and accesses sensitive systems. During this stage, the Office 365 </span><strong>Advanced Email Threat Protection</strong><span>, </span><strong>Windows Defender ATP</strong><span>, the </span><strong>Azure ATP</strong><span>, and </span><strong>Azure AD Identity Protection</strong><span> should all be in place to protect the identities at stake. An attacker will then try to use remote code execution from a local machine to a Domain Controller in order to gain access to domain administrator accounts.</span></p>
<p><span>It's important at this stage that </span><strong>Azure ATP</strong><span> and </span><strong>Azure AD Privileged Identity Management</strong><span> are used to establish the right controls. After this step, if successful, the attacker is free to access sensitive data and open it exfiltrate such information. To protect your sensitive data, the </span><strong>Microsoft Cloud App Security Broker</strong><span> (</span><strong>MSCASB</strong><span>) and the </span><strong>Cloud App Security</strong><span> service can help you to extend the protection of your sensitive data.</span></p>
<p>Now that we've had a look at a potential attack scenario and the related technology involved, we can dive deeper into each of the related services. We'll use the <strong>crawl</strong>-<strong>walk</strong>-<strong>run</strong> strategy to start, as follows:</p>
<ul>
<li><strong>Crawl</strong>: First, protect your privileged users and primary environments by:
<ul>
<li>Enabling Azure MFA for your administrative accounts, or better, using Azure AD PIM</li>
<li>Monitoring your risk reports and using the identity secure store functionality</li>
<li class="mce-root">Enabling and configuring Azure ATP to protect your primary user domains</li>
</ul>
</li>
<li><strong>Walk</strong>: Then, protect all users and Domain Controllers by:
<ul>
<li>Blocking legacy authentication and using conditional access (for more information, visit: <a href="https://bit.ly/2M3NXzw">https://bit.ly/2M3NXzw</a>)</li>
<li>Turning on password hash synchronization in Azure AD Connect and banned password checking (for more information, visit: <a href="https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-password-ban-bad">https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-password-ban-bad</a>)</li>
<li>Protecting all domains and forests using Azure ATP</li>
<li>Monitoring all Azure ATP alerts and investigating any lateral movements or domain dominance alerts</li>
</ul>
</li>
<li><strong>Run</strong>: Finally, protect all users and integrate the alerts into your security operations flow by:
<ul>
<li>Enabling Azure MFA for your end users using sign-in and the user risk policy</li>
</ul>
</li>
</ul>
<p>In this chapter, we will focus on identity protection technologies that are mentioned in the preceding strategy. Other processes will be looked at in <a href="bf7343f1-51f5-4e33-a9a6-e6e682e58071.xhtml" target="_blank">Chapter 13</a>, <em>Identifying and Detecting Sensitive Data</em> and <a href="efbe1917-c755-4449-b29e-fa4a21e819fd.xhtml" target="_blank">Chapter 8</a>, <em>Using the Azure AD App Proxy and the Web Application Proxy</em>. However, now, let's start with the Azure ATP service.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Azure ATP and how to use it</h1>
                </header>
            
            <article>
                
<p>Azure ATP is used to detect and investigate advanced attacks, compromised identities, and insider threats. Thanks to behavioral analytics in the backend, it provides very fast threat detection and also reduces the fatigue of false positives. Furthermore, it provides focused essential information using the Azure ATP attack timeline. Azure ATP is simple to work with, and the architecture is quite easy to understand because there are only two components per service and a downloadable sensor, which monitors local traffic, that is installed directly on your Domain Controllers. The sensors use dynamic resource limitation based on the domain controller's load.</p>
<p>There is another, more complex deployment method available, however, which uses a standalone sensor on a dedicated server and requires the configuration of port-mirroring from the Domain Controllers in order to receive network traffic. The service integrates directly with the Microsoft Intelligent Security Graph. You can find more information about this functionality at <a href="https://www.microsoft.com/en-us/security/operations/intelligence">https://www.microsoft.com/en-us/security/operations/intelligence</a>.</p>
<p>Azure ATP helps you to detect the following advanced attacks:</p>
<ul>
<li>Reconnaissance attacks, such as:
<ul>
<li>Account enumeration</li>
<li>User group membership enumeration</li>
<li>User and IP enumeration</li>
<li>Host and server name enumeration (DNS)</li>
</ul>
</li>
<li>Compromised credentials, such as:
<ul>
<li>Brute force attempts</li>
<li>Suspicious VPN connections</li>
<li>Suspicious group membership modifications</li>
<li>Honey Token account suspicious activity</li>
</ul>
</li>
<li>Lateral movements, such as:
<ul>
<li>Pass-the-Ticket</li>
<li>Pass-the-Hash</li>
<li>Overpass-the-Hash</li>
</ul>
</li>
<li>Domain dominance<span>, such as:</span>
<ul>
<li>Golden Ticket attacks</li>
<li>DC shadowing</li>
<li>Skeleton Key attacks</li>
<li>Remote code execution on Domain Controllers</li>
<li>Service creation on Domain Controllers</li>
</ul>
</li>
</ul>
<p>The on-premises product with the most basic features available is Microsoft <strong>Advanced Threat Analytics</strong> (<strong>ATA</strong>), which is still supported and in development. The cloud service, on the other hand, provides the <span>functionality to protect your environment, so we recommend Azure ATP over ATA.</span></p>
<p>We will now see how to configure Azure ATP in your environment.</p>
<div class="packt_tip">You need to have finished <a href="54c375d9-b7d0-4478-8777-33935239254b.xhtml" target="_blank">Chapter 1</a>, B<em>uilding and Managing Azure Active Directory</em> and <a href="c0918163-6616-4bdb-aa82-4a65f578d268.xhtml" target="_blank">Chapter 2</a>, <em>Understanding Identity Synchronization</em> to complete the configuration which follows.</div>
<p>So, let us get started! To configure Azure ATP, you need to follow the below steps:</p>
<ol>
<li>Open the link, <a href="https://portal.atp.azure.com/">https://portal.atp.azure.com/</a>, in a browser and log on as a global administrator.</li>
<li>Next, create your instance of <span class="packt_screen">Azure Advanced Threat Protection</span>, as shown in the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/154dfa14-043a-452b-9743-0a8eb750b590.png" style="width:26.42em;height:17.58em;" width="624" height="415"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Azure ATP creation dialog</div>
<ol start="3">
<li>Before configuring Azure ATP, you need to create a service account in your local active directory. Log on to your Domain Controller and open an elevated PowerShell and execute the following cmdlet:</li>
</ol>
<pre style="padding-left: 60px"><strong>New-ADUser -Name "Azure ATP Service Account" -SamAccountName svcaatp -UserPrincipalName svcaatp@inovitdemos.ch -path "OU=Users,OU=AAD,OU=Managed Service Objects,DC=inovitdemos,DC=ch" -AccountPassword (ConvertTo-SecureString "YourPassword" -AsPlainText -Force) -Enabled $True</strong></pre>
<ol start="4">
<li>Jump back to the Azure AD portal and follow the configuration instructions.</li>
<li>Now, use the newly-created service account, <span>as shown in the following screenshot:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/9742df0a-8f2d-4dab-8f70-29428e7a7c1c.png" style="width:27.75em;height:12.25em;" width="771" height="339"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Connecting the directory services</div>
<ol start="6">
<li>Afterward, directly deploy your first Azure ATP sensor on your <span class="packt_screen">Domain Controller</span>, <span>as shown in the following screenshot:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/063574e5-a7b8-424e-8529-ab28169f3cce.png" style="width:36.58em;height:12.67em;" width="1078" height="373"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Deploying the Azure ATP agents</div>
<ol start="7">
<li>Download the setup executable to your <span>Domain Controller</span> and start the installation.</li>
<li>Choose your preferred language and choose the <span class="packt_screen">Sensor</span>-only deployment method, <span>as shown in the following screenshot:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/24f14719-1189-435d-9f98-fc1b99fd5c0d.png" width="780" height="478"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Choosing the sensor type </div>
<ol start="9">
<li>Click <span class="packt_screen">Next</span> and <span class="packt_screen">Configure the Sensor</span> with the <span class="packt_screen">Access key</span> of the portal, <span>as shown in the following screenshot:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/408899ba-04af-4942-ac9a-2487bad718ef.png" width="776" height="476"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Getting the sensor agent shared key and installation path</div>
<ol start="10">
<li>Finish the installation and open the <kbd>services.msc</kbd> management console to view the newly-installed services, which should include the following two services:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/313a833a-c0de-475e-bd55-e566f45051d2.png" style="width:21.67em;height:2.75em;" width="308" height="39"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Newly installed services for Azure ATP</div>
<ol start="11">
<li>Next, enable the sensor as a <span class="packt_screen">Domain synchronizer</span> to gather the related information for Active Directory, <span>as shown in the following screenshot:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/838f58b7-8be9-4208-9338-e4cd0711a319.png" style="width:52.58em;height:34.42em;" width="995" height="651"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Enabling the synchronizer role</div>
<ol start="12">
<li>The next configuration task is the activation of the <span class="packt_screen">Suspected Golden Ticket usage</span> detection, which can be found under the <span class="packt_screen">Preview</span> section, <span>as shown in the following screenshot:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/f0bf5c97-ea95-453e-8bee-265e8509ac31.png" style="width:42.42em;height:11.33em;" width="686" height="183"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Activation of the golden ticket protection</div>
<ol start="13">
<li>Configure all of the relevant <span class="packt_screen">Scheduled reports</span> and notification settings for testing its capability, <span>as shown in the following screenshot:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/25502508-db0f-4f40-8668-9f0592b3ead8.png" style="width:54.25em;height:22.42em;" width="968" height="400"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Reporting section overview</div>
<ol start="14">
<li>The <span class="packt_screen">Notifications </span>settings page looks like the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/80a930b9-4982-4739-98af-0ba26cdc3444.png" style="width:55.92em;height:44.75em;" width="916" height="732"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Configuring notifications</div>
<p>Now that you have configured your Azure ATP service, you can use the guidance available at <a href="https://gallery.technet.microsoft.com/ATA-Playbook-ef0a8e38">https://gallery.technet.microsoft.com/ATA-Playbook-ef0a8e38</a> to create attacks and test your environment in realistic scenarios. The document is written for Microsoft ATA, but you can still use it for testing purposes. You can also use the following Azure ATP security alert guide to validate your results: <a href="https://docs.microsoft.com/en-us/azure-advanced-threat-protection/suspicious-activity-guide">https://docs.microsoft.com/en-us/azure-advanced-threat-protection/suspicious-activity-guide</a>. In the next section, we will dive into the features of Azure AD Identity Protection.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Azure AD Identity Protection</h1>
                </header>
            
            <article>
                
<p>Azure AD Identity Protection introduces automatic, risk-based, conditional access to help protect users against suspicious logins and compromised credentials. Azure AD Identity Protections also offers insight into, and a consolidated view of, threat detection based on machine-learning. Furthermore, the service delivers an important level of remediation recommendations, as well as performing compromise risk calculations about a user and their session. The service requires an Azure AD Premium P2 or equivalent licensing.</p>
<p>You will get the following capabilities from this service:</p>
<ul>
<li><strong>Detection</strong>: Vulnerabilities and risky accounts are detected by:
<ul>
<li>Highlighting vulnerabilities and providing custom recommendations</li>
<li>Calculating sign-in and user risk levels</li>
</ul>
</li>
<li><strong>Investigation</strong>: Risk events are investigated and solved by:
<ul>
<li>Notifications</li>
<li>The provision of relevant and contextual information</li>
<li>Basic workflows used in tracking</li>
<li>Easy access to remediation actions (for example, a password reset)</li>
</ul>
</li>
<li><strong>Risk-based conditional access</strong>: It includes:
<ul>
<li>Risk mitigation, such as blocking sign-ins or requesting multi-factor authentication</li>
<li>Blocking or securing risky user accounts</li>
<li>Asking users to register for Azure MFA</li>
</ul>
</li>
</ul>
<p>To get a greater understanding of this service, we need to start configuring it. So, login as a global administrator to <a href="https://portal.azure.com">https://portal.azure.com</a> and complete the following steps:</p>
<ol>
<li>Go the <span class="packt_screen">Azure AD Identity Protection</span> tab or use the <span class="packt_screen">Search</span> option to search the service</li>
<li>Start the on-boarding process by visiting the onboard menu under <span class="packt_screen">Settings</span> and clicking <span class="packt_screen">Create</span> at the bottom of the page, as shown in the following screenshot. Follow the process and finish on-boarding:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/829842c8-390b-4eb2-aa7c-18b2cd927aed.png" width="1547" height="606"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Azure AD Identity Protection wizard</div>
<ol start="3">
<li>Now jump directly into the <span class="packt_screen">Overview</span> section, as shown in the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/6e03c8ff-d653-41df-8631-3bd8bae4709e.png" width="1612" height="643"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Azure AD Identity Protection portal overview</div>
<ol start="4">
<li class="mce-root">The portal will present you with the relevant risks facing your environment, such as:
<ul>
<li class="mce-root">Users who are not enrolled with Azure MFA</li>
<li class="mce-root">Azure AD or Azure resource roles that don't require Azure MFA</li>
<li class="mce-root">The assignment of too many global administrator roles</li>
</ul>
</li>
</ol>
<ol start="5">
<li>Now, configure your first scenario by using the following source <a href="https://docs.microsoft.com/en-us/azure/active-directory/identity-protection/quickstart-sign-in-risk-policy">https://docs.microsoft.com/en-us/azure/active-directory/identity-protection/quickstart-sign-in-risk-policy</a>, with one of your users</li>
<li>Next, configure the alerts and weekly digest settings for information about the activities in and against your environment</li>
<li>After the service is enabled, you can test the functionality of Azure AD Identity Protection with the existing playbook, which is available at: <a href="https://docs.microsoft.com/en-us/azure/active-directory/identity-protection/playbook">https://docs.microsoft.com/en-us/azure/active-directory/identity-protection/playbook</a>.</li>
</ol>
<p>As you can see, running Azure AD Identity Protection doesn't require some long configuration task. However, we do recommend that you run your tests based on the provided playbook and get as much experience as possible:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/13433a3b-161f-4ad5-8312-24e4e3e6977d.png" style="width:38.92em;height:18.75em;" width="901" height="434"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Identity Secure Score information</div>
<p>As shown in the preceding screenshot, the <span class="packt_screen">Identity Secure Score</span> provides you with information on your identity security position and how it can be improved. The service will recommend activating certain security features and following specific recommendations, for example:</p>
<ul>
<li style="list-style-type: none">
<ul>
<li>Enabling Azure MFA for Azure AD privileged roles</li>
<li>Enabling self-service password reset</li>
<li>Enabling sign-in and user risk policies</li>
<li>Not allowing the expiration of passwords, or turning on password hash sync if you are in a hybrid configuration</li>
<li>Ensuring all users are enrolled to Azure MFA</li>
<li>Not using more than five global administrators</li>
<li>Disabling accounts that have not been used in the last 30 days</li>
<li>Blocking legacy authentication</li>
<li>Not allowing users to grant consent to unmanaged applications</li>
</ul>
</li>
</ul>
<p>We will discuss some areas of identity protection in more detail in <a href="1f239a9c-c62a-4e40-ab58-ce78cd87e8be.xhtml" target="_blank">Chapter 6</a>, <em>M</em><span><em>anaging Authentication Protocols</em> and <a href="bf7343f1-51f5-4e33-a9a6-e6e682e58071.xhtml">Chapter 13</a></span>, <span><em>Identifying and Detecting Sensitive Data</em>. We will also offer a deep-dive into the Cloud App Security service, which provides you with capabilities to protect against the following:</span></p>
<ul>
<li><strong>Malicious insiders</strong>: Protection against disgruntled employees</li>
<li><strong>Malware</strong>: Detection of malware in cloud storage as soon as they are uploaded</li>
<li><strong>Rogue applications</strong>: Identification of rogue applications that can access your sensitive data</li>
<li><strong>Compromised accounts</strong>: Combating advanced attackers that leverage compromised user credentials</li>
<li><strong>Data exfiltration</strong>: Detection of unusual flows of data either within or outside of your organization</li>
<li><strong>Ransomware</strong>: Identification of ransomware that uses sophisticated behavioral analytics technology</li>
</ul>
<p>Now that we have looked at Azure AD Identity Protection, it's time to move on to the Azure AD PIM service.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Using Azure AD PIM to protect administrative privileges</h1>
                </header>
            
            <article>
                
<p>Azure Active Directory <strong>Privileged Identity Management</strong> (<strong>PIM</strong>) provides similar functionality to the Microsoft Identity Manager, including <strong>Privileged Access Management</strong> (<strong>PAM</strong>) in the on-premises infrastructure.</p>
<div class="packt_infobox">If you need more information about the on-premises PAM solution, visit <a href="https://docs.microsoft.com/en-us/microsoft-identity-manager/pam/privileged-identity-management-for-active-directory-domain-services">https://docs.microsoft.com/en-us/microsoft-identity-manager/pam/privileged-identity-management-for-active-directory-domain-service<span>s</span></a><span>.</span></div>
<p>With Azure AD PIM, you can manage, control, and monitor your privileged identities and access to your directory information and resources in an Azure environment. The main reason for using Azure AD PIM is to reduce the attack surface and to enable administrative access just-in-time. Privileged access is often configured as permanent and unmonitored, but with Azure AD PIM you can avoid security breaches and risks.</p>
<p>The service allows you to assign time-bound access to resources using a start and end date and that requires approval to activate privileged roles. To protect the activation of a role, the service uses Azure Multi-Factor Authentication. For example, during the activation process, a user can be forced to justify why they need to activate their role. Furthermore, you can also enable notifications that alert you when a privileged role is activated. For auditing and compliance requirements, you are also able to configure and enable access reviews that ensure a user needs a specific role. You can also download an audit history for both internal and external audits.</p>
<div class="mce-root packt_tip">To use Azure AD Privileged Identity Management, you need to own an Azure AD Premium P2 license, which is also part of the EMS E5 or Microsoft 365 E5 plan, for every privileged account you want to protect. If you don't have access to an Azure AD Premium P2 license, protect your permanent privileged accounts with Multi-Factor Authentication. To do so, you will need to meet the licensing requirements, which are explained in full at <a href="https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-mfa-licensing">https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-mfa-licensing</a>.</div>
<p>Now that we know the basic functionally of Azure AD PIM, let's start with an example configuration. </p>
<div class="packt_infobox">To work through this lab, you must have completed the lab tasks in the first chapters, or have your own users already created.</div>
<p><span>The following table illustrates a common example configuration used by many companies when they first begin using the cloud:</span></p>
<table style="border-collapse: collapse;width: 100%" border="1">
<tbody>
<tr>
<td style="width: 25.4245%" class="CDPAlignCenter CDPAlign"><strong>Directory role</strong></td>
<td style="width: 10%" class="CDPAlignCenter CDPAlign"><strong>User</strong></td>
</tr>
<tr>
<td style="width: 25.4245%">Global Administrator</td>
<td style="width: 10%"><kbd>Don.Hall@inovitdemos.ch</kbd></td>
</tr>
<tr>
<td style="width: 25.4245%">Global Administrator</td>
<td style="width: 10%"><kbd>Dan.Jump@inovitdemos.ch</kbd></td>
</tr>
<tr>
<td style="width: 25.4245%">Global Administrator</td>
<td style="width: 10%"><kbd>Chris.Gray@inovitdemos.ch</kbd></td>
</tr>
</tbody>
</table>
<p> </p>
<p class="mce-root">Keep in mind that unmanaged privileged accounts create a vulnerability that can be exploited to access critical systems with sensitive data. Continuously randomizing credentials for each account<span>—</span>whether scheduled or in direct response to an attack<span>—</span>is the first step to take.</p>
<p>First, let's enable Azure AD PIM on our test tenant and use the default role configurations. We need to ensure that it works and to remember to implement a breaking-glass account. Afterward, we will be able to gather feedback and adjust our configuration as necessary.</p>
<p>Now we will start the configuration by enabling PIM with the Quick Start wizard.</p>
<ol>
<li>First, log in with your global administrator account at <a href="https://portal.azure.com">https://portal.azure.com</a> and navigate to Azure AD PIM. </li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/363c3284-32a4-440c-8b0a-92b50aec4138.png" style="width:50.08em;height:42.33em;" width="1074" height="909"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Azure AD PIM - Quick Start options</div>
<p style="padding-left: 90px">In our case, we use the account<span> </span><kbd>admin@inovitdemos.onmicrosoft.com</kbd>, which will act as our breaking-glass account:</p>
<div class="packt_quote packt_infobox">A breaking-glass account allows you to modify your configuration even if Azure AD PIM, the Multi-Factor Authentication service, or the federation service, is not available. Make sure to protect this account and use your Azure AD PIM controlled account to administer your environment.</div>
<ol start="2">
<li>Now enable the service by using <span class="packt_screen">Consent to PIM</span><span>, as shown in the preceding screenshot.</span></li>
<li>Now verify your identity<span>, as shown in the following screenshot:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/d88ee301-8f5c-4096-81e9-8cd63927d9f8.png" style="width:57.83em;height:12.75em;" width="1184" height="262"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Identity verification process</div>
<div class="packt_infobox">The more information required dialog box appears if Azure MFA hasn't been previously enabled.</div>
<ol start="4">
<li>Fill in and finish the additional security verification dialog.</li>
<li>Click <span class="packt_screen">Consent</span> to proceed,<span> as shown in the following screenshot:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/e9f1f4f1-552d-4f50-80c0-228f433e3b95.png" style="width:10.75em;height:2.00em;" width="246" height="46"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Consent to activate the feature</div>
<ol start="6">
<li>Next, select <span class="packt_screen">Sign up PIM for Azure AD Roles</span> under the <span class="packt_screen">Manage</span> | <span class="packt_screen">Azure AD roles</span> section<span>, as shown in the following screenshot:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/e8df9d6d-16e8-4344-aae7-94390575ccf5.png" style="width:14.92em;height:10.00em;" width="349" height="232"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Sign up process to PIM</div>
<ol start="7">
<li>Click <span class="packt_screen">Sign up</span> to start the discovery process for administrative roles.</li>
<li>View your own <span class="packt_screen">Active roles</span> in the portal, <span>as shown in the following screenshot, including their status:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/84f3bb99-0f76-4497-98b2-d2e1e1c1446b.png" style="width:62.92em;height:34.67em;" width="1095" height="605"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Insides about the active roles</div>
<p>In the next tasks we will add users to roles and test the configuration.</p>
<ol start="1">
<li>Now, return to <span class="packt_screen">Azure AD roles</span> page and manually assign the three global administrators as eligible admins for the specific Azure AD<span>, as shown in the following screenshot. Note that y</span>ou can also use the <span class="packt_screen">Manage</span> | <span class="packt_screen">Wizard</span> option to modify your role assignments:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/42120412-8cc8-4bdf-bb8c-5f1d1b0a0580.png" style="width:65.25em;height:25.75em;" width="1522" height="602"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Modification of role assignments</div>
<ol start="2">
<li>Click on <span class="packt_screen">Manage</span> | <span class="packt_screen">Roles</span> and choose the <span class="packt_screen">Global Administrator</span> role<span>, as shown in the following screenshot:</span></li>
</ol>
<div class="CDPAlignCenter packt_figref CDPAlign"><img src="Images/8feb8b92-c819-4e23-9481-8d8f0098354b.png" style="width:59.67em;height:8.58em;" width="1555" height="225"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Configuring the Global Administrator role</div>
<ol start="3">
<li>You should see all of the members present, including their assignment type, <span>as shown in the following screenshot:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/06c2ebd2-ad5b-40e7-a3e4-83a1e5c8d806.png" style="width:66.75em;height:25.50em;" width="1564" height="596"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Assigned roles overview</div>
<ol start="4">
<li>Now edit your three test users so they are eligible by clicking the three dots at the end of the user line<span>, as shown in the following screenshot:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/9b3bb7ee-a7c7-448c-b10c-6634b68b180b.png" style="width:12.00em;height:5.92em;" width="308" height="149"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Choosing the assignment type to make him eligible</div>
<ol start="5">
<li>You should end up with the following result:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/c8530b11-838c-42ef-a6f2-2654b9edf757.png" style="width:27.17em;height:11.58em;" width="750" height="317"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Result of changes</div>
<div class="packt_quote packt_tip">Practical note: Check the description of the role and see what you can do with it.</div>
<ol start="6">
<li>Click on <span class="packt_screen">Access reviews</span> to create an access review for a role.</li>
<li>Click <span class="packt_screen">New.</span></li>
<li>Choose and fill in the following values because it's a best practice to start with a monthly review:
<ul>
<li><strong>Review name</strong>: Global Administrator role monthly review</li>
<li><strong>Description</strong>: <span>Global Administrator role monthly review</span></li>
<li><strong>Frequency</strong>: Monthly</li>
<li><strong>Review role membership</strong>: Global Administrator</li>
<li><strong>Reviewers</strong>: Selected users</li>
<li><strong>Select reviewers</strong>: Use your <kbd>admin@tenantname.onmicrosoft.com</kbd> (PIM role administrator)</li>
<li><strong>Upon completion settings</strong>:
<ul>
<li><strong>Auto apply</strong>: Enable</li>
<li><strong>Reviewer not responding</strong>: Remove access</li>
</ul>
</li>
</ul>
</li>
</ol>
<ol start="9">
<li>Leave the remaining default settings and then click <span class="packt_screen">Start</span>. You should end up with the following result:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/8cd58b0c-9a30-4355-a2b5-5a9e5da5b644.png" style="width:57.50em;height:5.50em;" width="1143" height="109"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Access review overview</div>
<ol start="10">
<li>Now that we have converted the accounts from permanent to eligible and have created our first access review for the <span class="packt_screen">Global Administrator</span> role, we will test our configuration with Don Hall.</li>
<li>Open a new private browser session and navigate to <a href="https://portal.azure.com">https://portal.azure.com</a>.</li>
<li>Log in with <kbd>don.hall@yourdomain.com</kbd>.</li>
<li>Navigate to Azure AD PIM or use the <span class="packt_screen">Search</span> option to find it.</li>
</ol>
<ol start="14">
<li>Click on <span class="packt_screen">My roles</span>. You should find that you are eligible for the <span class="packt_screen">Global Administrator</span> role<span>, as shown in the following screenshot:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/4877f617-d161-4d43-b381-70c51208e0e2.png" style="width:56.33em;height:12.58em;" width="1474" height="330"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">View your own roles</div>
<ol start="15">
<li>Click <span class="packt_screen">Activate</span> to use your role. You will need to verify your account before proceeding.</li>
<li>Click <span class="packt_screen">Verify my identity</span> to complete Azure MFA enrollment.</li>
<li>Respond to the verification process and click <span class="packt_screen">Activate</span><span>, as shown in the following screenshot:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/6dc8cce2-e306-436b-8884-6c851714dce8.png" style="width:22.00em;height:18.33em;" width="430" height="356"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Activate the global administrator role</div>
<ol start="18">
<li>Note that you can customize activation time; the role is active for 1 hour by default. Now, provide an activation reason and click <span class="packt_screen">Activate</span>. Then, sign out and try your first login as G<span class="packt_screen">lobal Administrator</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/aa4680c3-f9b1-41f9-9798-237fe953183b.png" style="width:20.50em;height:22.25em;" width="428" height="463"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Proofing the activation</div>
<ol start="19">
<li>That's it! You've just successfully gained privileged access with Azure AD PIM.</li>
<li>Now, sign Don Hall out and log back in with your permanent administrator that also has the privileged administrator role assigned.</li>
</ol>
<ol start="21">
<li>Click on <span class="packt_screen">Activity</span> | <span class="packt_screen">Directory roles audit history</span> to find the role activation from Don Hall<span>, as shown in the following screenshot:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/ccd1aebd-e431-4304-8f1a-5c81f751d4e6.png" width="1299" height="701"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Roles audit history</div>
<p>Check the following features on the <span class="packt_screen">Azure AD roles</span> section to get more experience on how to configure Azure AD PIM:</p>
<ul>
<li>Go to <span class="packt_screen">Tasks</span> | <span class="packt_screen">Application Access</span> to verify your role assignment.</li>
<li>Go to <span class="packt_screen">Review access</span> to complete a review.</li>
<li>Go to <span class="packt_screen">Approve requests</span> if you have configured a role approval; you can do this under <span class="packt_screen">Manage</span> | <span class="packt_screen">Settings</span> | <span class="packt_screen">Roles</span>:</li>
</ul>
<p class="CDPAlignCenter CDPAlign"><img src="Images/554b0540-068f-44de-9195-29614cb85a62.png" style="width:55.33em;height:40.92em;" width="1055" height="780"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Guest Inviter role assignment</div>
<p>Now that we have successfully enabled Azure AD PIM for <span class="packt_screen">Azure AD roles</span>, assigned and tested our first role, created an access review for the role, and viewed the audit history, we're closer to understanding Azure AD <span class="packt_screen">Privileged Identity Management</span>. (Note that there is an additional lab for Azure resources and other features in the code section of the book for this chapter.)</p>
<p>To summarize, you should complete the following Azure AD PIM tasks for your Azure resources:</p>
<ul>
<li>Enable Just in Time access to Azure</li>
<li>Expire access automatically</li>
<li>Assign temporary access for quick tasks or on-call schedules</li>
<li>Get alerts when new users or groups are assigned resource access, or when eligible assignments are activated</li>
<li>Use Azure AD sign in for Azure VMs</li>
</ul>
<p>Before we close our section on PIM, we should tell you that Azure AD PIM, and Office 365 E5, offer Privileged Access Management functionality for privileged tasks and workload roles:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/70300e55-88dd-4e8f-a4b6-7c7d044ee987.png" width="1462" height="401"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Office 365 Privileged Identity Management portal</div>
<p>Now that we have configured the Privileged Identity Management and the protection, we provide a good state of security to our organization.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>After completing this chapter, you should be able to explain the main requirements when protecting identities and why they're a part of your security solution. In this chapter, we looked at the key issues of core identity protection components, and how to enable and configure the relevant services for your needs. If you would like more information on the Windows Defender ATP<strong> </strong>service, check out the <a href="bf7343f1-51f5-4e33-a9a6-e6e682e58071.xhtml">Chapters 13</a>, <em>Identifying and Detecting Sensitive Data</em>.</p>
<p>In the next <a href="1f239a9c-c62a-4e40-ab58-ce78cd87e8be.xhtml" target="_blank">Chapter 6</a>, <em>Managing Authentication Protocols</em>, we will discuss the all-important modern protocols, including OAuth 2.0, OpenID Connect, and SAML 2.0, which help you to establish a suitable authentication design for your organization and customers.</p>


            </article>

            
        </section>
    </div>



  </body></html>