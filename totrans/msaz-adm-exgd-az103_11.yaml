- en: Managing Azure VMs and VM Backups
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In the previous chapter, we covered **Virtual Machines** (**VMs**) in Azure
    and how to create and configure them from the Azure portal and PowerShell. We
    also looked at how to automate these steps using ARM templates.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
- en: This chapter continues with the second part of *Deploying and Managing Virtual
    Machines* objective***.*** In this chapter, we are going to focus on the different
    ways you can manage your VMs after creation. You will learn how to resize and
    deploy your VMs using the Azure portal, PowerShell, and CLI. You will also learn
    how to add additional data disks and network interfaces to your VMs. We are going
    to cover how you can automate the configuration management of your virtual machines,
    and you will learn how to configure backup and restore operations for your VMs.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
- en: 'The following topics will be covered in this chapter:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
- en: Managing VM sizes
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Redeploying VMs
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Moving VMs
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Adding data disks and network interfaces
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Automating configuration management
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Configuring VM backup and restore operations
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Technical requirements
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This chapter uses Azure PowerShell ([https://docs.microsoft.com/en-us/powershell/azure/install-az-ps?view=azps-1.8.0](https://docs.microsoft.com/en-us/powershell/azure/install-az-ps?view=azps-1.8.0))
    for examples.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
- en: Managing VM sizes
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In the first part of this chapter, we are going to look at some management capabilities
    for virtual machines. After creation, you can manage and change (vertical scale)
    the sizes of Windows and Linux VMs from the Azure portal, PowerShell, and CLI.
    **Vertical scaling**, also known as **scale up** and **scale down**, means increasing
    or decreasing VM sizes in response to different workloads.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
- en: In the upcoming demonstrations, we are going to resize VMs using the Azure portal
    and CLI.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
- en: Resizing a VM in the Azure portal
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'To manage and change the sizes of the VMs to scale up and down from the Azure
    portal, you have to take the following steps:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to the Azure portal by opening [https://portal.azure.com](https://portal.azure.com).
  id: totrans-17
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Go to the overview blade of one of the VMs that we created earlier or create
    a new one.
  id: totrans-18
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Under **Settings**, select **Size**.
  id: totrans-19
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'In the **Size** overview blade, you can easily select another VM size. In the
    top menu, there are different filters. You can filter on the different sizes,
    the VM generation type, the different VM types, the disk type, and you can add
    your own filter to it as well. Once you have selected the VM size, click the **Resize**
    button to actually resize it:'
  id: totrans-20
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/d404e9f1-932f-45c3-b3e8-d37d8580e80d.png)'
  id: totrans-21
  prefs: []
  type: TYPE_IMG
- en: Resizing the VM
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
- en: If the VM is currently running, then the changing its size will be implemented
    when the VM is restarted.
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the next section, we are going to resize the same VM using the CLI.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
- en: Resizing a VM using the CLI
  id: totrans-25
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: You can also resize your VM using the CLI. You can run CLI scripts from the
    Azure Cloud Shell or from your local file system. You can use the Azure Cloud
    Shell for PowerShell scripts and commands as well. We are going to resize the VM
    from Azure Cloud Shell using the CLI in this demonstration.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
- en: 'To resize a VM using the CLI, you have to perform the following steps:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to the Azure portal by opening [https://portal.azure.com](https://portal.azure.com).
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Open Azure Cloud Shell by clicking the following menu item in the top-right
    menu in the Azure portal:'
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/c95930b1-816d-4f97-b093-708e9eda879c.png)'
  id: totrans-30
  prefs: []
  type: TYPE_IMG
- en: Opening Azure Cloud Shell
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
- en: Make sure that the Bash shell is selected.
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Add the following line of code to list the different available machine sizes
    for your region:'
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'To resize your VM to a different size, add the following line of code. If the
    size is not available, you can replace the required VM size with one that is available
    for your subscription or region:'
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: We have now resized our VM using the Azure portal and CLI. In the next section,
    we are going to move VMs across different regions and redeploy them.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
- en: Redeploying VMs
  id: totrans-38
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: You can also redeploy the VMs after their creation. This can be helpful when
    you are facing difficulties troubleshooting **Remote Desktop Protocol** (**RDP**)
    connections or application access to Windows and Linux VMs. When you redeploy
    a VM, Azure will shut down the VM, move the VM to a new node within the Azure
    infrastructure, and then power it back on. All your configuration options and
    associated resources will remain during redeployment. After you redeploy a VM,
    the temporary disk is lost and any dynamic IP addresses associated with the virtual
    network interface are updated.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
- en: Redeploying Windows VMs can easily be done from the Azure portal, using PowerShell
    and the CLI as well. In the next demonstration, we are going to redeploy a VM
    from the Azure portal and PowerShell.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
- en: Redeploying a VM from the Azure portal
  id: totrans-41
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'To redeploy a VM from the Azure portal, you have to take the following steps:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to the Azure portal by opening [https://portal.azure.com](https://portal.azure.com).
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Again, go to the overview blade of one of the VMs that we created earlier or
    create a new one.
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Under **Support + troubleshooting**, select **Redeploy**. This will open the
    **Redeploy** blade, where you can select the **Redeploy **button to redeploy the
    VM:'
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/243d2082-2811-4865-bb2d-7c2d46e34bd4.png)'
  id: totrans-46
  prefs: []
  type: TYPE_IMG
- en: Redeploying the VM
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
- en: The VM will be unavailable during redeployment.
  id: totrans-48
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the next demonstration, we are going to redeploy the same VM using PowerShell.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
- en: Redeploying a VM from PowerShell
  id: totrans-50
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'To redeploy a VM from PowerShell, you have to take the following steps:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to the Azure portal by opening [https://portal.azure.com](https://portal.azure.com).
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open the Azure Cloud Shell again by clicking the following menu item in the
    top-right menu in the Azure portal.
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Make sure that this time **PowerShell** is selected.
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Add the following line of code to redeploy the VM:'
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: We have now covered most of the different ways to redeploy your VMs. In the
    next section, we are going to add extra data disks and network interfaces to a
    VM.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
- en: Moving VMs
  id: totrans-58
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: You can also move VMs and other resources across different subscriptions and
    resource groups. You can move resources using the Azure portal, Azure PowerShell,
    Azure CLI, or the REST API to move resources.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
- en: When you move a VM to another resource group, both the source and the target
    are locked during the operation. Also, write and delete operations are blocked
    on the resource group until it has completely finished moving the VM. By locking
    these two operations, you can't add, update, or delete any resource in the resource
    group. However, applications that use these resources, for instance when you move
    an Azure SQL database to another resource group, will not experience any downtime.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
- en: Moving a resource only moves it to a new resource group. The actual location
    will remain the same, and this cannot be changed. Even when the new resource group
    is deployed in another location, the moved resource will still remain in the original
    location.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
- en: There are limitations for moving resources across different subscriptions and
    resource groups. This can be part of the exam questions. For more information,
    you can refer to the documentation at: [https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-group-move-resources](https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-group-move-resources).
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
- en: Adding data disks and network interfaces
  id: totrans-63
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: You can add a new managed data disk and extra network interfaces to a Windows
    VM by using the Azure portal, PowerShell, and CLI. The size of the VM determines
    how many data disks you can attach to one single VM.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
- en: Adding a data disk
  id: totrans-65
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'To add a data disk from the Azure portal, you have to perform the following
    steps:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to the Azure portal by opening [https://portal.azure.com](https://portal.azure.com).
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Go to the overview blade of one of the VMs that we created earlier.
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Under **Settings**, select **Disks**. Click the **Add data disk **button:'
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/1ce4d6d3-ded4-46cf-ab61-c583e3d75d2a.png)'
  id: totrans-70
  prefs: []
  type: TYPE_IMG
- en: Adding a data disk
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
- en: 'You can now add an existing disk or create a new disk. We don''t have an extra
    disk in place, so select **Create disk**:'
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/7d669316-aa4f-4faa-988b-a5a87d91764c.png)'
  id: totrans-73
  prefs: []
  type: TYPE_IMG
- en: Creating a new disk
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
- en: 'In the Create managed disk blade, add the following values:'
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Disk name**: `PacktDisk2`.'
  id: totrans-76
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Resource group**: Keep the default selected group here.'
  id: totrans-77
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Account type**: Here, you can select three different options: Standard HHD, Standard
    SSD, and Premium SSD. Select any one.'
  id: totrans-78
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Size**: Keep the default size here.'
  id: totrans-79
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Source type**: Here, you can select three different options as well: None,
    Snapshot, Storage Blob. Select **None**:'
  id: totrans-80
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](img/6c3c8259-cc3d-4e45-9530-c420d9b47caf.png)'
  id: totrans-81
  prefs: []
  type: TYPE_IMG
- en: Disk settings
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
- en: Click **Create** to create the disk.
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The disk is now added to the VM. To initialize the new data disk, you can log
    into your server and create a new volume inside **Disk management**. After this,
    you can format the disk to complete the initialization of it.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
- en: Adding a network interface
  id: totrans-85
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'To add an extra network interface to the VM from the Azure portal, you have
    to perform the following steps:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
- en: 'From the Overview blade of the virtual machine, under **Settings**, select **Networking**. In
    there, click **Attach network interface**:'
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/ad0df9e8-2623-4663-a0b9-eeeb34069a87.png)'
  id: totrans-88
  prefs: []
  type: TYPE_IMG
- en: Adding a network interface
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
- en: 'A popup will be displayed where you have to click the **Create network interface**
    to create a new network interface. You can also add existing network interfaces
    here:'
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/a286fa64-b419-4957-bc41-b388c9323e2e.png)'
  id: totrans-91
  prefs: []
  type: TYPE_IMG
- en: Creating a new network interface
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
- en: 'In the Create network interface blade, add the following values:'
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Name**: `PacktNIC`.'
  id: totrans-94
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Subnet**: Select the default subnet here.'
  id: totrans-95
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Private IP address assignment**: Choose either **Dynamic **or **Static**.'
  id: totrans-96
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Resource group**: Keep the default selected here:'
  id: totrans-97
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](img/280ca362-f669-415c-86a1-19941d51616a.png)'
  id: totrans-98
  prefs: []
  type: TYPE_IMG
- en: Network interface settings
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
- en: Click **Create**.
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The network interface is now added to the VM and can be configured by logging
    into the VM and by configuring the network adapter.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
- en: In the preceding sections, we managed our VMs using manual actions or single
    scripts. In the next part of this chapter, we are going to look at automating
    configuration management for our VMs.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
- en: Automating configuration management
  id: totrans-103
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: There are various ways in Azure to automate the creation and the configuration
    of your infrastructure. You can use ARM templates to deploy your infrastructure
    as a code, or use Azure Automation, PowerShell scripts and more.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
- en: 'When the different Azure resources are deployed, there are some tools that
    you can use to manage the configuration of the resources. For example, when you
    want to automate the configuration of your VMs, Azure provides the following tools:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
- en: '**Chef**: Chef is a third-party solution that offers a DevOps automation platform
    for Linux, Windows, and macOS devices. It can be used for virtual and physical
    server configurations. It requires an agent to be installed on the virtual machines
    or servers, which connects to the Chef server to check whether there are available
    updates and other configurations for the machines. You can use the **Chef Automate**
    platform to package and deploy applications as well.'
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Puppet**: Puppet is a third-party solution as well, and it has similar capabilities
    to Chef. You can enable support for Puppet when you create a virtual machine from
    the Azure portal automatically. You can add it as an extension when you create
    a new virtual machine. It will install the Puppet agent, which connects to the
    Puppet master server.'
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Desired State Configuration** (**DSC**):DSC is the process of forcing a configuration
    on a system. It uses configuration files that consist of PowerShell scripts. These
    scripts are responsible for making the required configurations to the system and
    for ensuring that these systems stay in sync. So, for example, when you have created
    a DSC file to configure IIS on a Windows Server and this is removed by an administrator,
    the DSC file will reinstall and configure IIS again.'
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Custom Script Extensions**: You can configure software installation tasks
    and various post deployment, configuration, and management tasks using Custom
    Script Extensions. Scripts can be downloaded from Azure storage or GitHub, or
    provided to the Azure portal at extension runtime, and are executed on the VMs.
    You can integrate Custom Script Extensions with ARM templates, and you can run
    them using PowerShell, CLI, the VM REST API, and the Azure portal.'
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Configuring VM backup and restore operations
  id: totrans-110
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this demonstration, we will be performing a backup and restore operation
    for a VM. We are going to backup the VM that we used throughout this chapter and
    restore it from a Recovery Services vault.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
- en: Creating a Recovery Services vault
  id: totrans-112
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The first step is to create a Recovery Services vault, which can be used to
    store backups.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
- en: 'We are going to create the Recovery Services vault in Azure. You can create
    this using the Azure portal, PowerShell, and CLI. We are going to create the vault
    from the Azure portal. To create this, perform the following steps:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to the Azure portal by opening [https://portal.azure.com](https://portal.azure.com).
  id: totrans-115
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Create a new resource. Then, select **Management tools** and then **Backup and
    Site Recovery**.
  id: totrans-116
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Add the following values to create a new vault:'
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Name**: `PacktVMVault`.'
  id: totrans-118
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Subscription**:Select a subscription here.'
  id: totrans-119
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Resource group**: Create a new one and call it `PacktVMVault`.'
  id: totrans-120
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Location**: Pick a location:'
  id: totrans-121
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](img/6e0315fd-8d40-47b2-83ed-6b5db9be19e0.png)'
  id: totrans-122
  prefs: []
  type: TYPE_IMG
- en: Creating a new Recovery Services vault
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
- en: Click the **Create** button.
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: We have now created a Recovery Services vault, which we can use to restore backups.
    We will create and configure a backup policy in the next section.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
- en: Creating and configuring a backup policy
  id: totrans-126
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'From the Recovery Services vault overview blade, you can configure a backup
    policy. In this demonstration, we are going to configure one. Therefore, perform
    the following steps:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to the Azure portal by opening [https://portal.azure.com](https://portal.azure.com).
  id: totrans-128
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open the Recovery Services vault that we created in the previous step.
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'In the top menu, click **+ Backup**:'
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/b5c4794d-7000-4e2a-8d55-fade1a0d4263.png)'
  id: totrans-131
  prefs: []
  type: TYPE_IMG
- en: Creating a new backup
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
- en: 'In the next screen, select the following and click **Backup**:'
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/5c4e8034-a26b-46d3-9afa-4e969c745633.png)'
  id: totrans-134
  prefs: []
  type: TYPE_IMG
- en: Setting a backup goal
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
- en: 'Now we need to select a backup policy. We can use the default policy that is
    created for us by Azure, and which makes a daily backup, or we can create a custom
    policy in here. Under Choose backup policy, select Create New:'
  id: totrans-136
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/0d674f3e-9533-42f6-a06d-dfff83863f9a.png)'
  id: totrans-137
  prefs: []
  type: TYPE_IMG
- en: Creating a new backup policy
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
- en: 'For the new policy, fill in the following values:'
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/18f5629d-2896-4fac-bb46-013229fad0c6.png)'
  id: totrans-140
  prefs: []
  type: TYPE_IMG
- en: Creating a backup policy
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
- en: Once you have filled in all the values, click **OK**.
  id: totrans-142
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Then we have to select the VMs that we want to backup. Select them and click **OK**:'
  id: totrans-143
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**![](img/c733f9ea-c64f-4557-83f3-4af46493bdfe.png)** [Selecting the VM to
    backup]'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
- en: Click **Enable backup**.
  id: totrans-145
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The VM will now be backed up every day at the same time.
  id: totrans-146
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'If you open the VM overview blade, under **Operations**, select **Backup**.
    You will see that there is a backup policy applied and that the Recovery Services
    vault is displayed as well. Click **Backup now** in the top menu to perform a
    manual backup:'
  id: totrans-147
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/79c46260-4eb8-4924-90ef-ba8c8750bc8f.png)'
  id: totrans-148
  prefs: []
  type: TYPE_IMG
- en: Backing up the VM
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
- en: Keep the default retaining date and click **OK**.
  id: totrans-150
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Select **View all Jobs** to see the progress of the backup:'
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/b00f5b5a-b560-4b01-8b2e-c6571841a6ca.png)'
  id: totrans-152
  prefs: []
  type: TYPE_IMG
- en: Backup jobs
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
- en: 'All the jobs are displayed in the list:'
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/efe8afa1-1c2d-4905-b5e6-c48ff73278e7.png)'
  id: totrans-155
  prefs: []
  type: TYPE_IMG
- en: List of backups
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
- en: When the backup is created, we can restore it. In the next and last section
    of this demonstration, we are going to restore the backup of the VM.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
- en: Restoring a backup
  id: totrans-158
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this last demonstration, we are going to restore the backup of the VM that
    we created. Therefore, take the following steps:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
- en: 'In the Overview blade of the Backup section of the VM, select **Restore VM** in
    the top menu:'
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/d55e1aa1-d38c-44d9-8a83-80012e955e97.png)'
  id: totrans-161
  prefs: []
  type: TYPE_IMG
- en: Restoring the backup
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
- en: 'Select the restore point from the list and click **OK**:'
  id: totrans-163
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/20a58e6e-881c-4fa1-b03f-0c01f433bb56.png)'
  id: totrans-164
  prefs: []
  type: TYPE_IMG
- en: Selecting a restore point
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
- en: 'In the next blade, you can set the restore configuration. You can choose between
    creating a new VM or replacing a VM. Select **Replace existing** and select the
    following values:'
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/e6c0133c-cd05-4e87-8b68-f5d0fb516104.png)'
  id: totrans-167
  prefs: []
  type: TYPE_IMG
- en: Setting the restore configuration
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
- en: Make sure that the VM is turned off.
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click **OK **and **Restore**.
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The backup will now be restored and the existing VM will be replaced by the
    backup.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
- en: Azure Site Recovery is already covered in [Chapter 6](6bb56fd5-3785-42d2-b32c-4ba14333dca4.xhtml),
    *Configuring Azure Files and Implementing Azure Backup*. For more information
    about what features and capabilities it has to offer, you can refer to that chapter.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  id: totrans-173
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we covered how to manage your VMs and how to implement VM backups.
    We also covered how to manage your VMs from the Azure portal, and how to move
    and redeploy them using PowerShell and CLI. We looked into the automation of configuration
    management and we took a deep dive into Azure backup and restore operations for
    your VMs.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
- en: In the next chapter, we will begin with the first part of the *Deploying and
    Managing Virtual Networks* objective by covering how to implement and manage virtual
    networking.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
- en: Questions
  id: totrans-176
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Answer the following questions to test your knowledge of the information in
    this chapter. You can find the answers in the *Assessments* section at the end
    of this book:'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
- en: Can you use both PowerShell and the CLI to move, redeploy, and resize your Windows
    and Linux VMs?
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Yes'
  id: totrans-179
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'No'
  id: totrans-180
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Can you only add extra data disks and network interfaces from the Azure portal?
  id: totrans-181
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Yes'
  id: totrans-182
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'No'
  id: totrans-183
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Can you use Custom Script Extensions to configure macOS machines after deployment?
  id: totrans-184
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Yes'
  id: totrans-185
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'No'
  id: totrans-186
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Further reading
  id: totrans-187
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'You can check out the following links for more information about the topics
    that were covered in this chapter:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
- en: '*Resize a Windows VM*: [https://docs.microsoft.com/en-us/azure/virtual-machines/windows/resize-vm](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/resize-vm).'
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Resize a Linux virtual machine using Azure CLI*: [https://docs.microsoft.com/en-us/azure/virtual-machines/linux/change-vm-size](https://docs.microsoft.com/en-us/azure/virtual-machines/linux/change-vm-size).[ ](https://docs.microsoft.com/en-us/azure/virtual-machines/linux/change-vm-size)'
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Redeploy Windows virtual machine to new Azure node*: [https://docs.microsoft.com/en-us/azure/virtual-machines/troubleshooting/redeploy-to-new-node-windows](https://docs.microsoft.com/en-us/azure/virtual-machines/troubleshooting/redeploy-to-new-node-windows).'
  id: totrans-191
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Redeploy Linux virtual machine to new Azure node*: [https://docs.microsoft.com/en-us/azure/virtual-machines/troubleshooting/redeploy-to-new-node-linux](https://docs.microsoft.com/en-us/azure/virtual-machines/troubleshooting/redeploy-to-new-node-linux).'
  id: totrans-192
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Attach a data disk to a Windows VM with PowerShell*:[ ](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/attach-disk-ps)[https://docs.microsoft.com/en-us/azure/virtual-machines/windows/attach-disk-ps](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/attach-disk-ps).'
  id: totrans-193
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Move Azure VMs to another region*: [https://docs.microsoft.com/en-us/azure/site-recovery/azure-to-azure-tutorial-migrate?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json](https://docs.microsoft.com/en-us/azure/site-recovery/azure-to-azure-tutorial-migrate?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).'
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Custom Script Extension for Windows*: [https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/custom-script-windows](https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/custom-script-windows).'
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Windows PowerShell Desired State Configuration Overview*: [https://docs.microsoft.com/en-us/powershell/dsc/overview/overview](https://docs.microsoft.com/en-us/powershell/dsc/overview/overview).'
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*What is Azure Backup?*: [https://docs.microsoft.com/en-us/azure/backup/backup-overview](https://docs.microsoft.com/en-us/azure/backup/backup-overview).'
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*About Site Recovery*: [https://docs.microsoft.com/en-us/azure/site-recovery/site-recovery-overview](https://docs.microsoft.com/en-us/azure/site-recovery/site-recovery-overview).'
  id: totrans-198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*关于站点恢复*：[https://docs.microsoft.com/en-us/azure/site-recovery/site-recovery-overview](https://docs.microsoft.com/en-us/azure/site-recovery/site-recovery-overview).'
