<html><head></head><body><div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Tips and Tricks for Azure</h1>
                </header>
            
            <article>
                
<p>There's always more than only one way to do a particular thing. This statement is especially true in the Azure ecosystem, where we're given multiple tools and shortcuts when provisioning resources, configuring services, and developing applications. This chapter will show the reader how to enhance productivity even more, and shorten the time needed to deliver a working solution.</p>
<p>The following topics will be covered in this chapter:</p>
<ul>
<li>Cloud Shell and the Azure CLI</li>
<li>Locks on resources</li>
<li>Proper naming conventions</li>
<li>Resources in Azure</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Technical requirements</h1>
                </header>
            
            <article>
                
<p>To perform exercises from this chapter, you will need the following:</p>
<ul>
<li>An Azure subscription</li>
<li>The Azure CLI, available at <a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest</a></li>
</ul>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">The Azure CLI and Cloud Shell</h1>
                </header>
            
            <article>
                
<p>Using the Azure portal to perform all actions, such as provisioning a resource, changing its configuration, or finding a particular value, is indeed one of the easiest ways of managing both your subscription and deployed services. However, it may become cumbersome when you have tens or hundreds of different subscriptions, resource groups, and instances. In such scenarios, it is always better to have access to scripts and commands that speed things up and allow for automation, if needed. In this section, we will cover two basic tools available in Azure: the Azure CLI and Cloud Shell, which you can use when just the portal is not enough.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">The Azure CLI</h1>
                </header>
            
            <article>
                
<p>The Azure CLI is a cross-platform command-line tool, which you can install locally to manage Azure resources. In general, a command looks like this:</p>
<pre><strong>$ az [resource] [command] -param1 "Foo" -param2 123</strong></pre>
<p>For example, you can use the Azure CLI to create a function app like this:</p>
<pre><strong>$ az functionapp create --name "handsonazureapp" --storage-account "handsonazurestorage" --consumption-plan-location "westeurope" --resource-group "myResourceGroup"</strong></pre>
<p>The instruction for installing the Azure CLI can be found in the <em>Technical requirements</em><strong> </strong>section. It points to an article that describes the process for multiple different platforms, <span>such as</span> Windows, macOS, and Linux. Once the Azure CLI is installed, open your command line terminal and enter the following command:</p>
<pre><strong>$ az login</strong></pre>
<p>After a moment, you should see a result similar to mine, where you are asked to authenticate the Azure CLI locally:</p>
<pre><strong>$ az login</strong><br/><strong>To sign in, use a web browser to open the page https://microsoft.com/devicelogin and enter the code DRXXXXXXX to authenticate.</strong></pre>
<p class="mce-root"/>
<p class="mce-root"/>
<p>To authenticate the tool, go to the displayed web page and enter the displayed code. If everything is correct, the command will end successfully, and as a result, it will display information about all subscriptions attached to the account. When using the Azure CLI, you do not have to remember all the commands—to find the one you are looking for, you can use the following, which will find all related commands:</p>
<pre><strong>$ az find -q "query"</strong></pre>
<p>Let's assume that you want to work with Azure Functions<em> </em>now. To interrogate all the commands related to that service, I can use the following query:</p>
<pre><strong>$ az find -q function</strong><br/><strong>`az functionapp create`</strong><br/><strong>    Create a function app.</strong><br/><strong>    The function app's name must be able to produce a unique FQDN as</strong><br/><strong>    AppName.azurewebsites.net.</strong><br/><br/><strong>`az functionapp list`</strong><br/><strong>    List function apps.</strong><br/><br/><strong>`az functionapp delete`</strong><br/><strong>    Delete a function app.</strong><br/><br/><strong>`az functionapp stop`</strong><br/><strong>    Stop a function app.</strong><br/><br/><strong>`az functionapp start`</strong><br/><strong>    Start a function app.</strong><br/><br/><strong>`az functionapp restart`</strong><br/><strong>    Restart a function app.</strong><br/><br/><strong>`az functionapp update`</strong><br/><strong>    Update a function app.</strong><br/><br/><strong>`az functionapp`</strong><br/><strong>    Manage function apps.</strong><br/><br/><strong>`az functionapp config`</strong><br/><strong>    Configure a function app.</strong><br/><br/><strong>`az functionapp show`</strong><br/><strong>    Get the details of a function app.</strong></pre>
<p class="mce-root"/>
<p>As you can see, it is super easy—you can quickly provision new resources without even touching the Azure portal. Here you can find a full example of instruction for creating a function app:</p>
<pre><strong>$ az storage account create --sku Standard_LRS --kind Storage --resource-group handsonazure-euw-rg --name handsonazurestorage</strong><br/><strong>$ az functionapp create --name handsonazure-euw-functionapp --storage-account handsonazurestorage --resource-group handsonazure-euw-rg --consumption-plan-location westeurope</strong></pre>
<div class="packt_infobox">In the above example, I skipped the process of creating a resource group. If you want to create a new one, just use the <kbd>az group create</kbd> command.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Cloud Shell</h1>
                </header>
            
            <article>
                
<p>An alternative to using the Azure CLI is a tool named Cloud Shell. You can access it directly within the Azure portal by clicking on the Cloud Shell button:</p>
<div class="CDPAlignCenter CDPAlign"><img src="Images/3684be71-9a64-49d1-98cb-51f668dcd541.png" style="width:38.67em;height:5.92em;" width="503" height="77"/></div>
<p>When you open Cloud Shell, a welcome screen will be displayed at the bottom of the portal, asking you to select a shell you are interested in:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/3a190688-e3aa-4f17-8f3a-3f3be418aec8.png" style="width:50.67em;height:19.42em;" width="661" height="253"/></p>
<p class="mce-root"/>
<p class="mce-root"/>
<p>The choice does not really matter as you can change the selected option anytime. As I personally prefer PowerShell over Bash, the default option in my case is the former.</p>
<div class="packt_infobox">Both Bash and PowerShell scripts are aligned with each other when it comes to functionalities. You should select a shell that you prefer to work with.</div>
<p>If this is your first time with Cloud Shell, you will also <span>be</span><span> asked to mount a storage account that can be used with the feature. Cloud Shell uses it to persist files between your sessions. You have two options here; either you let it create a storage account for you, or you can select particular options by clicking on the </span><span class="packt_screen">Show advanced settings</span><strong> </strong><span>button:</span></p>
<div class="CDPAlignCenter CDPAlign"><img src="Images/41bc8dff-d081-4b72-abcf-7b213f65b6d3.png" width="739" height="257"/></div>
<p>Once everything is configured correctly, Azure will attempt to initialize your Cloud Shell account:</p>
<pre>Your cloud drive has been created in:<br/><br/>Subscription Id: &lt;subscription-id&gt;<br/>Resource group: cloudshell-euw-rg<br/>Storage account: cloudshelleuwstorage<br/>File share: cloudshelleuwfileshare<br/><br/>Initializing your account for Cloud Shell...\<br/>Requesting a Cloud Shell.Succeeded.<br/>Connecting terminal...<br/><br/>Welcome to Azure Cloud Shell<br/><br/>Type "dir" to see your Azure resources<br/>Type "help" to learn about Cloud Shell<br/><br/>MOTD: Switch to PowerShell from Bash: pwsh<br/><br/>VERBOSE: Authenticating to Azure ...<br/>VERBOSE: Building your Azure drive ...<br/>Azure:/<br/>PS Azure:\&gt;</pre>
<p>Using Cloud Shell is similar to browsing a file system. Your Azure resources are presented as directories, which can be accessed by common command-line commands <span>such as</span> <kbd>dir </kbd>or <kbd>cd</kbd>. You can select a subscription you would like to work with by entering the following command:</p>
<pre><strong>PS Azure:\&gt; cd &lt;subscription-name&gt;</strong></pre>
<p>Then it is easy to browse all resources within it by using the following command:</p>
<pre><strong>PS Azure:\&gt; cd AllResources</strong><br/><strong>PS Azure:\&gt; dir</strong></pre>
<p>Note that there is a limit on resources you can access via Cloud Shell—currently you can use it to operate on the following services:</p>
<ul>
<li>Resources groups</li>
<li>Web Apps</li>
<li>Storage accounts</li>
<li>Virtual machines</li>
</ul>
<p>For example, to obtain a connection string for Azure Files, you can use something like this:</p>
<pre><strong>PS Azure:\&gt; cd StorageAccounts\&lt;storage-account-name&gt;\files</strong><br/><strong>PS Azure:\&gt; dir</strong></pre>
<p>Of course, inside Cloud Shell, you can use both Azure Powershell commands and the Azure CLI. If you enter the <kbd>az</kbd><strong> </strong>command in the command line, you will see the following result:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/f120a7a0-6b20-4e1b-a48f-7a3dd88b50a9.png" width="887" height="599"/></p>
<p>Basically, all you have learned in the previous section can be applied here. This is a great tool that will enhance your productivity once you get used to using commands instead of browsing the Azure portal.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Locks</h1>
                </header>
            
            <article>
                
<p>Creating and managing Azure resources is much easier when leveraging the various commands available that allow you to work faster and enable you to automate processes. However, when you have hundreds of resources provisioned, mistakes may happen—you can accidentally move, rename, or even delete a resource, which should not <span>even</span><span> </span><span>be touched. To prevent such scenarios, it is possible to use locks—a simple feature that stops you from performing a forbidden action. In this section, you will learn how to create them, and use them for your own purposes.</span></p>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Creating and managing locks</h1>
                </header>
            
            <article>
                
<p>Locks are available on almost every resource available in the Portal. You access them by simply clicking on the <span class="packt_screen">Locks </span>blade:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/1190707f-404c-46f7-8fc8-d7c846140e9b.png" style="width:37.17em;height:36.17em;" width="535" height="521"/></p>
<p class="mce-root"/>
<p>In the preceding example, let's assume that I want to secure my resource group and disallow deleting it. To do so, I have to click on the <span class="packt_screen">+ Add</span><strong> </strong>button and the appropriate lock type:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/8b957699-95d8-491b-9d6b-bc2c640f4728.png" style="width:41.25em;height:19.58em;" width="752" height="357"/></p>
<p>Now if I try to delete a resource group, I will get the following error:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/1473626f-1c5c-4558-a0c5-f37d622c00e9.png" style="width:33.58em;height:16.67em;" width="517" height="256"/></p>
<p>As you probably noticed, there are two types of lock; d<span>elete and </span><span>read-only.</span></p>
<p>The read-only lock prevents me from introducing changes to the resource—for a resource group, I cannot, for example, add a new service:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/5cbb7fcf-fd17-4e92-8de3-3eb605fc5681.png" style="width:62.00em;height:29.83em;" width="825" height="396"/></p>
<p>Of course, read-only locks work differently for different resources. If I introduce one to my Azure Storage Account, it will prevent me from making any changes to the service configuration:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/f9322fef-30d3-4065-8a14-d99197cdeab5.png" style="width:31.92em;height:22.50em;" width="527" height="372"/></p>
<div class="packt_tip">Locks are also Azure resources, meaning that you can manage them by Azure Powershell commands (<span>such as</span> <kbd>Get-AzureRmResourceLock</kbd>), or ARM templates.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Naming conventions</h1>
                </header>
            
            <article>
                
<p>Governing and managing resources in Azure can become a challenge if you do not introduce a proper naming convention that is simple, intuitive, and easy to follow. In the world of software development, proper naming for services is especially difficult as you have to take into account different regions, environments, and instances. In this section, we will try to discover different concepts for naming conventions, which you will able to apply or adjust to your needs.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Finding the best naming convention</h1>
                </header>
            
            <article>
                
<p>In Azure, you have to consider the following aspects of a resource:</p>
<ul>
<li>A region where it is provisioned</li>
<li>A resource type</li>
<li>A resource name</li>
<li>A resource instance type/environment</li>
</ul>
<p>We will start from a resource group. By default you can name it as follows:</p>
<pre>MyNewService<br/>newPortal<br/>oldplatform</pre>
<p>The rule of thumb is to select a name that will be self-explanatory. While selecting a name <span>such as</span> <kbd>MyNewService</kbd> should be fine, it does not give you the following information:</p>
<ul>
<li>Where the resource group is located</li>
<li>What environment (test/production/staging/and so on) it represents</li>
</ul>
<p class="mce-root"/>
<p>What is more, if you, for example, list resources inside your subscription, you will not know which resource type <kbd>MyNewService</kbd> is, without selecting its type. While, of course, commands <span>such as</span> <kbd>az group list</kbd><strong> </strong>give you the full information about a resource, you will need to include an additional field if you want to export only a resource name. In such cases, it would be worth annotating the resource group name with the resource type as follows:</p>
<pre>MyNewServiceResourceGroup<br/>newPortal-resourceGroup<br/>oldplatform-rg</pre>
<p>So far so good—the name of the resource looks much better now. Let's now consider adding a location:</p>
<pre>MyNewResourceResourceGroupEastUS2<br/>newPortal-westEurope-resourceGroup<br/>oldplatform-eun-rg</pre>
<p>Things look much better now—we immediately know what resource type we are considering and where it is located. With that information it much easier to browse through different services. The last thing that could be added is the environment:</p>
<pre>MyNewResourceResourceGroupEastUS2Test<br/>newPortal-westEurope-prod-resourceGroup<br/>oldplatform-staging-eun-rg</pre>
<p>Now the information is complete. Of course, everything depends on your personal setup, as you may decide that all environments are stored inside a single resource group. Even then it is worth including the rest of the data so that you will have cohesive names for all provisioned resources. </p>
<div class="packt_tip">Remember that different Azure resources have different limits when it comes to their names. While Azure App Services<em> </em>may be quite liberated about this, Azure Storage<em> </em>disallows you from using characters other than letters and numbers.</div>
<p>In fact, your requirements for the naming convention will imply what really has to be included in the resource name, for example:</p>
<ul>
<li>Whether you deploy resources in different regions</li>
<li>Whether you use multiple environments for developing your applications</li>
<li>Whether you use a single resource group for multiple environments</li>
</ul>
<p class="mce-root"/>
<p class="mce-root"/>
<p>The general rule is to use a convention that you <span>both</span><span> </span><span>like, and is flexible enough to cover services deployed to Azure after a few years. The worst thing here is having to change it after some time because it cannot reflect the changes in your business.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Resources in Azure</h1>
                </header>
            
            <article>
                
<p>Microsoft Azure is all about resources—you manage them directly or indirectly, but nonetheless most of what you touch is a resource of some kind. Whether it is a particular service (<span>such as</span> Azure Functions or Azure Traffic Manager), a part of it (<span>such as</span> the application settings available for Azure App Services), or a distinct feature (<span>such as </span>locks, as discussed in this chapter), you can manage all of them using Azure Resource Manager (which is often referred to as Azure RM). In the last section of this chapter, we will discuss how to access properties of Azure resources, so you can use them to investigate the configuration and automate processes, <span>such as</span> deployment or monitoring.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Azure Resource Explorer</h1>
                </header>
            
            <article>
                
<p>The easiest way to access Azure resources is to use <strong>Azure Resource Explorer</strong>. You can access it by going to <a href="https://resources.azure.com/">https://resources.azure.com/</a><a href="https://resources.azure.com/">.</a></p>
<p>Your default screen will look similar to mine:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/c3cfbc77-7da7-4d25-98fd-a4c682ea99a3.png" width="1207" height="316"/></p>
<p>To browse your resources, you have to expand nodes available on the left. Initially, you have access to two different node types:</p>
<ul>
<li><span class="packt_screen">providers</span>: Those are related to a specific Azure service, <span>such as</span> Azure Cosmos DB<em> </em>or Azure Storage</li>
<li><span class="packt_screen">subscription</span>:<strong> </strong>As a subscription is also an Azure resource, you can browse it using Azure Resource Explorer</li>
</ul>
<p class="mce-root"/>
<p>These two node types give you access to different kinds of operation; providers are a high-level representation of a specific Azure service, while subscription contains information regarding resources provisioned within it. What is more, it gives you the possibility to directly check the parameters of your resource:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/b32bae21-eeea-42e9-83e6-4fd81bcd9bba.png" width="1085" height="857"/></p>
<p class="mce-root"/>
<p class="mce-root"/>
<p>The gathered information can be used to enter the required information in ARM templates. You can always consult them with the visible results from Azure Resource Explorer. This tool allows you to also directly edit the resource parameters (by clicking on the <span class="packt_screen">Edit </span>button), and generates a PowerShell/Ansible script, which can be used to manage it. In the following, you can find an example of a PowerShell command, generated for my Azure Storage<em> </em>account:</p>
<pre># PowerShell equivalent script<br/><br/># GET handsonazureeuwstorage<br/>Get-AzureRmResource -ResourceGroupName handsonazure-euw-rg -ResourceType Microsoft.Storage/storageAccounts -ResourceName "handsonazureeuwstorage" -ApiVersion 2017-10-01<br/><br/># SET handsonazureeuwstorage<br/>$PropertiesObject = @{<br/>  #Property = value;<br/>}<br/>Set-AzureRmResource -PropertyObject $PropertiesObject -ResourceGroupName handsonazure-euw-rg -ResourceType Microsoft.Storage/storageAccounts -ResourceName "handsonazureeuwstorage" -ApiVersion 2017-10-01 -Force<br/><br/># DELETE handsonazureeuwstorage<br/>Remove-AzureRmResource -ResourceGroupName handsonazure-euw-rg -ResourceType Microsoft.Storage/storageAccounts -ResourceName "handsonazureeuwstorage" -ApiVersion 2017-10-01 -Force<br/><br/># Action ListAccountSas<br/>$ParametersObject = @{<br/>  signedServices = "(String)"<br/>  signedResourceTypes = "(String)"<br/>  signedPermission = "(String)"<br/>  signedIp = "(String)"<br/>  signedProtocol = "(String)"<br/>  signedStart = "(String)"<br/>  signedExpiry = "(String)"<br/>  keyToSign = "(String)"<br/>}<br/><br/>Invoke-AzureRmResourceAction -ResourceGroupName handsonazure-euw-rg -ResourceType Microsoft.Storage/storageAccounts -ResourceName handsonazureeuwstorage -Action ListAccountSas -Parameters $ParametersObject -ApiVersion 2017-10-01 -Force<br/><br/># Action ListServiceSas<br/>$ParametersObject = @{<br/>  canonicalizedResource = "(String)"<br/>  signedResource = "(String)"<br/>  signedPermission = "(String)"<br/>  signedIp = "(String)"<br/>  signedProtocol = "(String)"<br/>  signedStart = "(String)"<br/>  signedExpiry = "(String)"<br/>  signedIdentifier = "(String)"<br/>  startPk = "(String)"<br/>  endPk = "(String)"<br/>  startRk = "(String)"<br/>  endRk = "(String)"<br/>  keyToSign = "(String)"<br/>  rscc = "(String)"<br/>  rscd = "(String)"<br/>  rsce = "(String)"<br/>  rscl = "(String)"<br/>  rsct = "(String)"<br/>}<br/><br/>Invoke-AzureRmResourceAction -ResourceGroupName handsonazure-euw-rg -ResourceType Microsoft.Storage/storageAccounts -ResourceName handsonazureeuwstorage -Action ListServiceSas -Parameters $ParametersObject -ApiVersion 2017-10-01 -Force<br/><br/># Action listKeys<br/>Invoke-AzureRmResourceAction -ResourceGroupName handsonazure-euw-rg -ResourceType Microsoft.Storage/storageAccounts -ResourceName handsonazureeuwstorage -Action listKeys -ApiVersion 2017-10-01 -Force<br/><br/># Action regenerateKey<br/>$ParametersObject = @{<br/>  keyName = "(String)"<br/>}<br/><br/>Invoke-AzureRmResourceAction -ResourceGroupName handsonazure-euw-rg -ResourceType Microsoft.Storage/storageAccounts -ResourceName handsonazureeuwstorage -Action regenerateKey -Parameters $ParametersObject -ApiVersion 2017-10-01 -Force</pre>
<p>As you can see, you do not have to write such scripts on your own, you can just use Azure Resource Manager, copy them, and potentially adjust them to your needs.</p>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this, the last chapter of this book, we covered topics not related to a specific service, but rather extending your current knowledge, and allowing you to become a better user, developer, and architect of solutions based on Microsoft Azure. You have learned how to use the Azure CLI and Cloud Shell to ease management operations, how to leverage locks to secure all fragile resources, and how to read an Azure service configuration. We also discussed the pros for adopting proper naming conventions and how they affect your applications deployed in Azure. This was an exciting journey through the Azure cloud, where you discovered many different PaaS offerings from this particular platform. Azure is a fantastic ecosystem and allows you to build both small web pages and complex, enterprise-level platforms. What is more, it is also incredibly dynamic—this is why I strongly encourage you to take a look at the <em>Further reading</em><strong> </strong>sections detailed in this book, so you can get more experience with it and become familiar with the more advanced concepts. The important thing here is also to constantly update your knowledge, whether through reading blogs, going to meetups, or conferences, and of course reading articles and books. As cloud computing is one of the major topics in recent years when it comes to software development, it is crucial to become familiar with it and build your skill set, which you can use in your daily work.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Questions</h1>
                </header>
            
            <article>
                
<ol>
<li>What are the two different types of lock for resources in Azure, and how do they work?</li>
<li>Can you use the Azure CLI inside Cloud Shell?</li>
<li>Where can you obtain detailed information about your provisioned resources in Azure?</li>
<li>What pros can a proper naming convention give you?</li>
<li>Why does Cloud Shell require the provisioning of a storage account?</li>
</ol>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Further reading</h1>
                </header>
            
            <article>
                
<ul>
<li>Please refer to the Azure blog at <a href="https://azure.microsoft.com/en-us/blog/">https://azure.microsoft.com/en-us/blog/</a>.</li>
</ul>


            </article>

            
        </section>
    </div>



  </body></html>