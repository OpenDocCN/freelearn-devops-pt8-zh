<html><head></head><body>
<div id="_idContainer190" class="calibre2">
<h1 class="chapter-number" id="_idParaDest-69"><a id="_idTextAnchor306" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1.1">3</span></h1>
<h1 id="_idParaDest-70" class="calibre5"><a id="_idTextAnchor307" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.2.1">Setting Up Zabbix Monitoring</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.3.1">Zabbix is built to be flexible and should be able to monitor just about anything you could ever require. </span><span class="kobospan" id="kobo.3.2">In this chapter, we will learn more about working with Zabbix to build a lot of different options for monitoring. </span><span class="kobospan" id="kobo.3.3">We’ll go over them recipe by recipe so that you end up with a solid understanding of how </span><span><span class="kobospan" id="kobo.4.1">they work.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.5.1">We’ll cover the following recipes on the different </span><span><span class="kobospan" id="kobo.6.1">monitoring types:</span></span></p>
<ul class="calibre14">
<li class="calibre15"><span class="kobospan" id="kobo.7.1">Setting up Zabbix </span><span><span class="kobospan" id="kobo.8.1">agent monitoring</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.9.1">Working with SNMP monitoring the </span><span><span class="kobospan" id="kobo.10.1">old way</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.11.1">Setting up SNMP monitoring the </span><span><span class="kobospan" id="kobo.12.1">new way</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.13.1">Creating Zabbix simple checks and the </span><span><span class="kobospan" id="kobo.14.1">Zabbix trapper</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.15.1">Working with calculated and </span><span><span class="kobospan" id="kobo.16.1">dependent items</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.17.1">Creating </span><span><span class="kobospan" id="kobo.18.1">external checks</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.19.1">Setting up </span><span><span class="kobospan" id="kobo.20.1">JMX monitoring</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.21.1">Setting up </span><span><span class="kobospan" id="kobo.22.1">database monitoring</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.23.1">Setting up HTTP </span><span><span class="kobospan" id="kobo.24.1">agent monitoring</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.25.1">Using Zabbix browser items to simulate a </span><span><span class="kobospan" id="kobo.26.1">web user</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.27.1">Using Zabbix preprocessing to alter </span><span><span class="kobospan" id="kobo.28.1">item values</span></span></li>
</ul>
<h1 id="_idParaDest-71" class="calibre5"><a id="_idTextAnchor308" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor309" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.29.1">Technical requirements</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.30.1">We will need a Zabbix server capable of performing monitoring, with the </span><span><span class="kobospan" id="kobo.31.1">following requirements:</span></span></p>
<ul class="calibre14">
<li class="calibre15"><span class="kobospan" id="kobo.32.1">A server with Zabbix server installed on a Linux distribution of your choice, such as Rocky Linux or Ubuntu. </span><span class="kobospan" id="kobo.32.2">However, a distribution such as Debian, Alma Linux, or anything else will suit you just </span><span><span class="kobospan" id="kobo.33.1">as well.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.34.1">A MariaDB (MySQL) server to monitor – for example, the Zabbix server database we set up in </span><a href="B19803_01.xhtml#_idTextAnchor021" class="pcalibre calibre6 pcalibre1"><span><em class="italic"><span class="kobospan" id="kobo.35.1">Chapter 1</span></em></span></a><span><span class="kobospan" id="kobo.36.1">.</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.37.1">I’ll be using the same server that we used in the previous chapter, but any Zabbix server </span><span><span class="kobospan" id="kobo.38.1">should do.</span></span></p>
<h1 id="_idParaDest-72" class="calibre5"><a id="_idTextAnchor310" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor311" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.39.1">Setting up Zabbix agent monitoring</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.40.1">Starting from the release of Zabbix 5, Zabbix also officially started support for the new Zabbix </span><a id="_idIndexMarker162" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.41.1">Agent 2. </span><span class="kobospan" id="kobo.41.2">Zabbi</span><a id="_idTextAnchor312" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.42.1">x Agent 2 brings some major improvements and is even written in another coding language – Golang instead of C. </span><span class="kobospan" id="kobo.42.2">In this recipe, we will explore how to work with Zabbix Agent 2 and explore some of the new features introduced </span><span><span class="kobospan" id="kobo.43.1">by it.</span></span><a id="_idTextAnchor313" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor314" class="pcalibre calibre6 pcalibre1"/></p>
<h2 id="_idParaDest-73" class="calibre7"><a id="_idTextAnchor315" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.44.1">Getting ready</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.45.1">To get started with Zabbix Agent 2, all we need to do is install it on a host that we want to monitor. </span><span class="kobospan" id="kobo.45.2">Make </span><a id="_idIndexMarker163" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.46.1">sure you have an empty </span><strong class="bold"><span class="kobospan" id="kobo.47.1">Red Hat Enterprise Linux</span></strong><span class="kobospan" id="kobo.48.1"> (</span><strong class="bold"><span class="kobospan" id="kobo.49.1">RHEL</span></strong><span class="kobospan" id="kobo.50.1">)-based or Ubuntu Linux host ready </span><span><span class="kobospan" id="kobo.51.1">to monitor</span><a id="_idTextAnchor316" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor317" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.52.1">.</span></span></p>
<h2 id="_idParaDest-74" class="calibre7"><a id="_idTextAnchor318" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.53.1">How to do it…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.54.1">Let’s learn how to install Zabbix Agent 2 and then move on to working </span><span><span class="kobospan" id="kobo.55.1">with it.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.56.1">Installing Zabbix Agent 2</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.57.1">Let’s start </span><a id="_idIndexMarker164" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.58.1">by installing Zab</span><a id="_idTextAnchor319" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.59.1">bix Agent 2 on </span><a id="_idIndexMarker165" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.60.1">the Linux host we want to monitor. </span><span class="kobospan" id="kobo.60.2">I’ll show you how to do this on both RHEL and </span><span><span class="kobospan" id="kobo.61.1">Ubuntu systems:</span></span></p>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.62.1">Issue the following command to add </span><span><span class="kobospan" id="kobo.63.1">the repository.</span></span><p class="calibre3"><span class="kobospan" id="kobo.64.1">For RHEL-based systems, this is </span><span><span class="kobospan" id="kobo.65.1">as follows:</span></span></p><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.66.1">rpm -Uvh https://repo.zabbix.com/zabbix/7.0/rocky/9/x86_64/zabbix-release-7.0-2.el9.noarch.rpm</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.67.1">For Ubuntu systems, this is </span><span><span class="kobospan" id="kobo.68.1">as follows:</span></span></p><pre class="source-code"><strong class="bold1"><span class="kobospan1" id="kobo.69.1">wget https://repo.zabbix.com/zabbix/7.0/ubuntu/pool/main/z/zabbix-release/zabbix-release_7.0-1+ubuntu22.04_all.deb</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.70.1">dpkg -i zabbix-release_7.0-1+ubuntu22.04_all.deb</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.71.1">Then, issue </span><a id="_idIndexMarker166" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.72.1">the following </span><a id="_idIndexMarker167" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.73.1">c</span><a id="_idTextAnchor320" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.74.1">ommand to install Zabbix </span><span><span class="kobospan" id="kobo.75.1">Agent 2.</span></span><p class="calibre3"><span class="kobospan" id="kobo.76.1">Here’s the command for </span><span><span class="kobospan" id="kobo.77.1">RHEL-based systems:</span></span></p><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.78.1">dnf -y install zabbix-agent2</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.79.1">Here’s the command for </span><span><span class="kobospan" id="kobo.80.1">Ubuntu systems:</span></span></p><pre class="source-code"><strong class="bold1"><span class="kobospan1" id="kobo.81.1">apt install zabbix-agent2</span></strong></pre></li> </ol>
<p class="calibre3"><span class="kobospan" id="kobo.82.1">Congratulations – Zabbix Agent 2 is now installed and ready </span><span><span class="kobospan" id="kobo.83.1">to use!</span></span></p>
<p class="callout-heading"><span class="kobospan" id="kobo.84.1">Important note</span></p>
<p class="callout"><span class="kobospan" id="kobo.85.1">When adding new repositories to your system, always check out the Zabbix download page. </span><span class="kobospan" id="kobo.85.2">You can find the right up-to-date repository for your system </span><span><span class="kobospan" id="kobo.86.1">here: </span></span><a href="https://www.zabbix.com/download" class="pcalibre calibre6 pcalibre1"><span><span class="kobospan" id="kobo.87.1">https://www.zabbix.com/download</span></span></a><span><span class="kobospan" id="kobo.88.1">.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.89.1">Using a Zabbix agent in passive mode</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.90.1">Let’s </span><a id="_idIndexMarker168" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.91.1">start by building a Zabbi</span><a id="_idTextAnchor321" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.92.1">x agent with </span><span><span class="kobospan" id="kobo.93.1">p</span><a id="_idTextAnchor322" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.94.1">assive </span></span><span><a id="_idIndexMarker169" class="pcalibre calibre6 pcalibre1"/></span><span><span class="kobospan" id="kobo.95.1">checks:</span></span></p>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.96.1">After installing Zabbix Agent 2, let’s open the Zabbix agent configuration file </span><span><span class="kobospan" id="kobo.97.1">for editing:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.98.1">vim /etc/zabbix/zabbix_agent2.conf</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.99.1">In this file, we can edit all the Zabbix agent configuration values we could need from the </span><span><span class="kobospan" id="kobo.100.1">server side.</span></span></p></li> <li class="calibre15"><span class="kobospan" id="kobo.101.1">Let’s start by editing the </span><span><span class="kobospan" id="kobo.102.1">following parameters:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.103.1">
Server=127.0.0.1
Hostname=Zabbix server</span></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.104.1">Change the value of </span><strong class="source-inline1"><span class="kobospan" id="kobo.105.1">Server</span></strong><span class="kobospan" id="kobo.106.1"> to the IP of the Zabbi</span><a id="_idTextAnchor323" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.107.1">x server that will moni</span><a id="_idTextAnchor324" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.108.1">tor this passive </span><a id="_idIndexMarker170" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.109.1">agent. </span><span class="kobospan" id="kobo.109.2">Change the value for </span><strong class="source-inline1"><span class="kobospan" id="kobo.110.1">Hostname</span></strong><span class="kobospan" id="kobo.111.1"> to the </span><a id="_idIndexMarker171" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.112.1">hostname of the monitored server. </span><span class="kobospan" id="kobo.112.2">We can get the IP address of our server with the </span><span><span class="kobospan" id="kobo.113.1">following command:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.114.1">ip addr</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.115.1">Now, restart the Zabbix Agent </span><span><span class="kobospan" id="kobo.116.1">2 process:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.117.1">systemctl enable zabbix-agent2</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.118.1">systemctl restart zabbix-agent2</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.119.1">Next, move to the frontend of your Zabbix server and add this host </span><span><span class="kobospan" id="kobo.120.1">for monitoring.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.121.1">Go to </span><strong class="bold"><span class="kobospan" id="kobo.122.1">Data collection</span></strong><span class="kobospan" id="kobo.123.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.124.1">Hosts</span></strong><span class="kobospan" id="kobo.125.1"> in your Zabbix frontend and click </span><strong class="bold"><span class="kobospan" id="kobo.126.1">Create host</span></strong><span class="kobospan" id="kobo.127.1"> in the </span><span><span class="kobospan" id="kobo.128.1">top-right corner.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.129.1">To create this host in our Zabbix server, we need to fill in the values shown in the </span><span><span class="kobospan" id="kobo.130.1">following scr</span><a id="_idTextAnchor325" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.131.1">eenshot:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer097">
<span class="kobospan" id="kobo.132.1"><img alt="Figure 3.1 – The Zabbix host creation page for lar-book-agent" src="image/B19803_03_01.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.133.1">Figure 3.1 – The Zabbix host creation page for lar-book-agent</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.134.1">It’s </span><a id="_idIndexMarker172" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.135.1">important to add </span><span><span class="kobospan" id="kobo.136.1">the following:</span></span></p>
<ul class="calibre14">
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.137.1">Host name</span></strong><span class="kobospan" id="kobo.138.1">: To </span><a id="_idIndexMarker173" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.139.1">identify the host (has to </span><span><span class="kobospan" id="kobo.140.1">be unique).</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.141.1">Host groups</span></strong><span class="kobospan" id="kobo.142.1">: To logically </span><span><span class="kobospan" id="kobo.143.1">group hosts.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.144.1">Interfaces</span></strong><span class="kobospan" id="kobo.145.1">: To m</span><a id="_idTextAnchor326" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.146.1">onitor this host on a specific interface. </span><span class="kobospan" id="kobo.146.2">N</span><a id="_idTextAnchor327" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.147.1">o interface means no communication. </span><span class="kobospan" id="kobo.147.2">It’s possible to have a host without an interface in Zabbix 7 if we don’t need it. </span><span class="kobospan" id="kobo.147.3">In the case of a Zabbix-agent-monitored host, an agent interface </span><span><span class="kobospan" id="kobo.148.1">is required.</span></span></li>
</ul>
<ol class="calibre16">
<li value="8" class="calibre15"><span class="kobospan" id="kobo.149.1">Make sure you add the correct IP address to the </span><strong class="bold"><span class="kobospan" id="kobo.150.1">Agent</span></strong> <span><span class="kobospan" id="kobo.151.1">interface configuration.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.152.1">It is also important to add a template to this host. </span><span class="kobospan" id="kobo.152.2">With Zabbix 7, this can be done on the same tab. </span><span class="kobospan" id="kobo.152.3">As this is a Linux server monitored by a Zabbix agent, let’s add the correct out-of-the-box template, as shown in the </span><span><span class="kobospan" id="kobo.153.1">following sc</span><a id="_idTextAnchor328" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.154.1">reenshot:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer098">
<span class="kobospan" id="kobo.155.1"><img alt="Figure 3.2 – The Zabbix host template page for lar-book-agent" src="image/B19803_03_02.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.156.1">Figure 3.2 – The Zabbix host template page for lar-book-agent</span></p>
<ol class="calibre16">
<li value="10" class="calibre15"><span class="kobospan" id="kobo.157.1">Click </span><a id="_idIndexMarker174" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.158.1">the blue</span><a id="_idTextAnchor329" class="pcalibre calibre6 pcalibre1"/> <strong class="bold"><span class="kobospan" id="kobo.159.1">Add</span></strong><span class="kobospan" id="kobo.160.1"> button to finish creating</span><a id="_idTextAnchor330" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.161.1"> this agent host. </span><span class="kobospan" id="kobo.161.2">Now that you’ve got this host, make </span><a id="_idIndexMarker175" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.162.1">sure the </span><strong class="bold"><span class="kobospan" id="kobo.163.1">ZBX</span></strong><span class="kobospan" id="kobo.164.1"> icon turns green, indicating that this host is up and being monitored by the passive </span><span><span class="kobospan" id="kobo.165.1">Zab</span><a id="_idTextAnchor331" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.166.1">bix agent:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer099">
<span class="kobospan" id="kobo.167.1"><img alt="Figure 3.3 – The Zabbix configuration hosts page for lar-book-agent" src="image/B19803_03_03.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.168.1">Figure 3.3 – The Zabbix configuration hosts page for lar-book-agent</span></p>
<ol class="calibre16">
<li value="11" class="calibre15"><span class="kobospan" id="kobo.169.1">Because we configured our host and added a template with items, we can now see the values that were received on items for this host by going to </span><strong class="bold"><span class="kobospan" id="kobo.170.1">Monitoring</span></strong><span class="kobospan" id="kobo.171.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.172.1">Hosts</span></strong><span class="kobospan" id="kobo.173.1"> and checking the </span><strong class="bold"><span class="kobospan" id="kobo.174.1">Latest data</span></strong><span class="kobospan" id="kobo.175.1"> button. </span><span class="kobospan" id="kobo.175.2">Please note that the values could take around 1 minute to</span><a id="_idTextAnchor332" class="pcalibre calibre6 pcalibre1"/> <span><span class="kobospan" id="kobo.176.1">show up:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer100">
<span class="kobospan" id="kobo.177.1"><img alt="Figure 3.4 – The Zabbix Latest data page for lar-book-agent" src="image/B19803_03_04.JPG" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.178.1">Figure 3.4 – The Zabbix Latest data page for lar-book-agent</span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.179.1">Using a Zabbix agent in active mode</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.180.1">Now, let’s</span><a id="_idTextAnchor333" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.181.1"> learn </span><a id="_idIndexMarker176" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.182.1">how to configure the Zabbix agent </span><a id="_idTextAnchor334" class="pcalibre calibre6 pcalibre1"/><a id="_idIndexMarker177" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.183.1">with active checks. </span><span class="kobospan" id="kobo.183.2">We need to change some values on the monitored Linux server </span><span><span class="kobospan" id="kobo.184.1">host side:</span></span></p>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.185.1">Start by executing the </span><span><span class="kobospan" id="kobo.186.1">following command:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.187.1">vim /etc/zabbix/zabbix_agent2.conf</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.188.1">Now, let’s edit the following value to change this host to an </span><span><span class="kobospan" id="kobo.189.1">active agent:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.190.1">
ServerActive=127.0.0.1</span></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.191.1">Change the value for </span><strong class="source-inline1"><span class="kobospan" id="kobo.192.1">ServerActive</span></strong><span class="kobospan" id="kobo.193.1"> to the IP of the Zabbix server that will monitor this passive agent. </span><span class="kobospan" id="kobo.193.2">Then, change the value of </span><strong class="source-inline1"><span class="kobospan" id="kobo.194.1">Hostname</span></strong><span class="kobospan" id="kobo.195.1"> to your hostname. </span><span class="kobospan" id="kobo.195.2">In my case, this </span><span><span class="kobospan" id="kobo.196.1">is </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.197.1">lar-book-agent</span></strong></span><span><span class="kobospan" id="kobo.198.1">:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.199.1">
Hostname=lar-book-agent</span></pre></li> </ol>
<p class="callout-heading"><span class="kobospan" id="kobo.200.1">Important note</span></p>
<p class="callout"><span class="kobospan" id="kobo.201.1">Keep in mind that if you’re working with multiple Zabbix servers or Zabbix proxies, such as when you’re running a Zabbix server in high availability, you need to fill in all the Zabbix </span><a id="_idIndexMarker178" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.202.1">servers or Zabbix proxies IP addresses when using the </span><strong class="source-inline1"><span class="kobospan" id="kobo.203.1">ServerActive</span></strong><span class="kobospan" id="kobo.204.1"> parameter. </span><strong class="bold"><span class="kobospan" id="kobo.205.1">High availability</span></strong><span class="kobospan" id="kobo.206.1"> (</span><strong class="bold"><span class="kobospan" id="kobo.207.1">HA</span></strong><span class="kobospan" id="kobo.208.1">) nodes are delimited by a semicolon (</span><strong class="source-inline1"><span class="kobospan" id="kobo.209.1">;</span></strong><span class="kobospan" id="kobo.210.1">), while different Zabbix environment IPs are delimited by a </span><span><span class="kobospan" id="kobo.211.1">comma (</span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.212.1">,</span></strong></span><span><span class="kobospan" id="kobo.213.1">).</span></span></p>
<ol class="calibre16">
<li value="4" class="calibre15"><span class="kobospan" id="kobo.214.1">Now, restart the Zabbix Agent </span><span><span class="kobospan" id="kobo.215.1">2 process:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.216.1">systemctl restart zabbix-agent2</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.217.1">Next, move </span><a id="_idIndexMarker179" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.218.1">t</span><a id="_idTextAnchor335" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.219.1">o the frontend of your Zabbix </span><a id="_idIndexMarker180" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.220.1">server and ad</span><a id="_idTextAnchor336" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.221.1">d another host with a template to do active checks instead of </span><span><span class="kobospan" id="kobo.222.1">passive ones.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.223.1">First, let’s rename our passive host. </span><span class="kobospan" id="kobo.223.2">To do that, go to </span><strong class="bold"><span class="kobospan" id="kobo.224.1">Data collection</span></strong><span class="kobospan" id="kobo.225.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.226.1">Hosts</span></strong><span class="kobospan" id="kobo.227.1"> in your Zabbix frontend and click the host we just created. </span><span class="kobospan" id="kobo.227.2">Change </span><strong class="bold"><span class="kobospan" id="kobo.228.1">Host nam</span><a id="_idTextAnchor337" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.229.1">e</span></strong> <span><span class="kobospan" id="kobo.230.1">as follows:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer101">
<span class="kobospan" id="kobo.231.1"><img alt="Figure 3.5 – The Zabbix host configuration page for lar-book-agent_passive" src="image/B19803_03_05.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.232.1">Figure 3.5 – The Zabbix host configuration page for lar-book-agent_passive</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.233.1">We are doing this because, for an active Zabbix agent, the hostname in the Zabbix agent configuration file needs to match the configuration of our host, as seen on the Zabbix frontend. </span><span class="kobospan" id="kobo.233.2">For passive agents, this isn’t </span><span><span class="kobospan" id="kobo.234.1">the case.</span></span></p>
<ol class="calibre16">
<li value="7" class="calibre15"><span class="kobospan" id="kobo.235.1">Click on the blue </span><strong class="bold"><span class="kobospan" id="kobo.236.1">Update</span></strong><span class="kobospan" id="kobo.237.1"> button to save </span><span><span class="kobospan" id="kobo.238.1">the changes.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.239.1">Go to </span><strong class="bold"><span class="kobospan" id="kobo.240.1">Data collection</span></strong><span class="kobospan" id="kobo.241.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.242.1">Hosts</span></strong><span class="kobospan" id="kobo.243.1"> in your Zabbix frontend and click </span><strong class="bold"><span class="kobospan" id="kobo.244.1">Create host</span></strong><span class="kobospan" id="kobo.245.1"> in the </span><span><span class="kobospan" id="kobo.246.1">top-right corner.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.247.1">Now, let’s create the host,</span><a id="_idTextAnchor338" class="pcalibre calibre6 pcalibre1"/> <span><span class="kobospan" id="kobo.248.1">as follows:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer102">
<span class="kobospan" id="kobo.249.1"><img alt="Figure 3.6 – The Zabbix host configuration page for lar-book-age﻿nt" src="image/B19803_03_06.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.250.1">Figure 3.6 – The Zabbix host configuration page for lar-book-age</span><a id="_idTextAnchor339" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.251.1">nt</span></p>
<ol class="calibre16">
<li value="10" class="calibre15"><span class="kobospan" id="kobo.252.1">Also, make </span><a id="_idIndexMarker181" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.253.1">su</span><a id="_idTextAnchor340" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.254.1">re you </span><a id="_idIndexMarker182" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.255.1">add the correct template, named </span><strong class="source-inline1"><span class="kobospan" id="kobo.256.1">Linux by Zabbix </span><a id="_idTextAnchor341" class="pcalibre calibre6 pcalibre1"/></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.257.1">agent active</span></strong></span><span><span class="kobospan" id="kobo.258.1">:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer103">
<span class="kobospan" id="kobo.259.1"><img alt="Figure 3.7 – The Zabbix host template page for lar-book-agent" src="image/B19803_03_07.JPG" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.260.1">Figure 3.7 – The Zabbix host template page for lar-book-agent</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.261.1">Please note that as of Zabbix 6.2, the </span><strong class="bold"><span class="kobospan" id="kobo.262.1">ZBX</span></strong><span class="kobospan" id="kobo.263.1"> icon should turn green for an active agent. </span><span class="kobospan" id="kobo.263.2">Note that when we navigate to </span><strong class="bold"><span class="kobospan" id="kobo.264.1">Monitoring</span></strong><span class="kobospan" id="kobo.265.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.266.1">Hosts</span></strong><span class="kobospan" id="kobo.267.1"> and check </span><strong class="bold"><span class="kobospan" id="kobo.268.1">Latest data</span></strong><span class="kobospan" id="kobo.269.1">, we can see our active data </span><span><span class="kobospan" id="kobo.270.1">coming in.</span></span></p>
<p class="callout-heading"><span class="kobospan" id="kobo.271.1">Tip</span></p>
<p class="callout"><span class="kobospan" id="kobo.272.1">As you might have noticed, a Zabbix agent can run in both passive and active mode at the same time. </span><span class="kobospan" id="kobo.272.2">Keep this in mind when creating your own Zabbix agent templates as you might want to combine the check types. </span><span class="kobospan" id="kobo.272.3">In the end, the </span><strong class="source-inline1"><span class="kobospan" id="kobo.273.1">Item</span></strong><span class="kobospan" id="kobo.274.1"> type will determine how the checks are executed towa</span><a id="_idTextAnchor342" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor343" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.275.1">rd </span><span><span class="kobospan" id="kobo.276.1">the agent.</span></span></p>
<h2 id="_idParaDest-75" class="calibre7"><a id="_idTextAnchor344" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.277.1">How it works…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.278.1">Now </span><a id="_idIndexMarker183" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.279.1">that we’ve configured our Zabbix agents and know how they should be set up, let’s see how the different </span><span><span class="kobospan" id="kobo.280.1">modes work.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.281.1">Passive agent</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.282.1">The </span><strong class="bold"><span class="kobospan" id="kobo.283.1">passive agent</span></strong><span class="kobospan" id="kobo.284.1"> works by </span><a id="_idTextAnchor345" class="pcalibre calibre6 pcalibre1"/><a id="_idIndexMarker184" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.285.1">collecting data from </span><a id="_idIndexMarker185" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.286.1">our host with the Zabbix </span><a id="_idTextAnchor346" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.287.1">agent. </span><span class="kobospan" id="kobo.287.2">Every time an item on our host reaches its </span><em class="italic"><span class="kobospan" id="kobo.288.1">update interval</span></em><span class="kobospan" id="kobo.289.1">, the Zabbix server asks the Zabbix agent what th</span><a id="_idTextAnchor347" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.290.1">e value </span><span><span class="kobospan" id="kobo.291.1">is now:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer104">
<span class="kobospan" id="kobo.292.1"><img alt="Figure 3.8 – Communication diagram between the server and the passive agent" src="image/B19803_03_08.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.293.1">Figure 3.8 – Communication diagram between the server and the passive agent</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.294.1">Passive agents are great when you’re working in environments where you want to keep communication initiated from the Zabbix server or Zabbix proxy side. </span><span class="kobospan" id="kobo.294.2">An example of this is when there is a firewall that is only allowing outgoing traffic, as seen from the Zabbix server or </span><span><span class="kobospan" id="kobo.295.1">proxy side.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.296.1">Active agent</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.297.1">The </span><strong class="bold"><span class="kobospan" id="kobo.298.1">active agent</span></strong><span class="kobospan" id="kobo.299.1"> works by </span><a id="_idIndexMarker186" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor348" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.300.1">sending data from the Zabbix agent t</span><a id="_idTextAnchor349" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.301.1">o a Zabbix </span><a id="_idIndexMarker187" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.302.1">server or Zabbix proxy. </span><span class="kobospan" id="kobo.302.2">Every time an item on our agent reaches its update interval, the agent will collect the value to sen</span><a id="_idTextAnchor350" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.303.1">d to </span><span><span class="kobospan" id="kobo.304.1">our server:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer105">
<span class="kobospan" id="kobo.305.1"><img alt="Figure 3.9 – Communication diagram between the server and the active agent" src="image/B19803_03_09.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.306.1">Figure 3.9 – Communication diagram between the server and the active agent</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.307.1">The active agent is great wh</span><a id="_idTextAnchor351" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.308.1">en you’re working in an environment where there is a firewall that is only a</span><a id="_idTextAnchor352" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.309.1">ccepting outgoing connections, as seen from the Zabbix agent side. </span><span class="kobospan" id="kobo.309.2">This is used in a lot of environments as it can mitigate one of the main security concerns that is mostly associated with monitoring hosts. </span><span class="kobospan" id="kobo.309.3">Instead of allowing the Zabbix server to access all the different subnets (which is a bigger risk), we allow the hosts to send data to Zabbix instead – many to one instead of one </span><span><span class="kobospan" id="kobo.310.1">to many.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.311.1">On the other hand, having the Zabbix agent working in active mode can also be a lot more efficient. </span><span class="kobospan" id="kobo.311.2">Most of the load that comes from getting data to your Zabbix server is now on the Zabbix agent side. </span><span class="kobospan" id="kobo.311.3">Because there are more Zabbix agents out there than you have Zabbix servers or proxies, offloading a load like this is a </span><span><span class="kobospan" id="kobo.312.1">great idea.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.313.1">As mentioned previously, we can use both types of checks at the same time, giving us the freedom to configure every type of check we need. </span><span class="kobospan" id="kobo.313.2">In this case, our setup would </span><a id="_idTextAnchor353" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.314.1">look </span><span><span class="kobospan" id="kobo.315.1">like this:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer106">
<span class="kobospan" id="kobo.316.1"><img alt="Figure 3.10 – Communication diagram between the server and both agent types" src="image/B19803_03_10.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.317.1">Figure 3.10 – Communication diagram between the server and both agent types</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.318.1">This might be the case in situations where we want to mainly monitor passively, but, for example, log file monitoring with the Zabbix agent must be done with an active Zabbix agent. </span><span class="kobospan" id="kobo.318.2">In this case, we can combine our modes and make sure we use the full scale of our features provided in th</span><a id="_idTextAnchor354" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor355" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.319.1">e </span><span><span class="kobospan" id="kobo.320.1">Zabbix agent.</span></span></p>
<h2 id="_idParaDest-76" class="calibre7"><a id="_idTextAnchor356" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.321.1">See also</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.322.1">There’s a lot of stuff going on under the hood of Zabbix Agent 2. </span><span class="kobospan" id="kobo.322.2">If you’re interested in learning </span><a id="_idIndexMarker188" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.323.1">mo</span><a id="_idTextAnchor357" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.324.1">re about the core of Zabbix Agent 2, check out this cool blog post by Alexey </span><span><span class="kobospan" id="kobo.325.1">Petrov: </span></span><a href="https://blog.zabbix.com/magic-of-new-zab﻿﻿bix-agent/8460/" class="pcalibre calibre6 pcalibre1"><span><span class="kobospan" id="kobo.326.1">https://blog.zabbix.com/magic-of-new-zab</span><span id="_idTextAnchor358"/><span id="_idTextAnchor359"/><span class="kobospan" id="kobo.327.1">bix-agent/8460/</span></span></a><span><span class="kobospan" id="kobo.328.1">.</span></span></p>
<h1 id="_idParaDest-77" class="calibre5"><a id="_idTextAnchor360" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.329.1">Working with SNMP monitoring the old way</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.330.1">Now, let’s do something I enjoy most when working with Zabbix: build SNMP monitoring. </span><span class="kobospan" id="kobo.330.2">My </span><a id="_idIndexMarker189" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.331.1">professional ro</span><a id="_idTextAnchor361" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.332.1">ots lie in network engineering, and I have worked with SNMP monitoring a lot to monitor all these different </span><span><span class="kobospan" id="kobo.333.1">network devices.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.334.1">Please do keep in mind that although this recipe will cover how to work with SNMP monitoring the old way, it is still a valid option. </span><span class="kobospan" id="kobo.334.2">Zabbix 6.4 introduced an entirely new way of setting up SNMP monitoring. </span><span class="kobospan" id="kobo.334.3">The new way utilizes bulk metric collection and is more efficient for the SNMP device and number of network sessions, so it might be a good idea to check out that recip</span><a id="_idTextAnchor362" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor363" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.335.1">e after </span><span><span class="kobospan" id="kobo.336.1">this one.</span></span></p>
<h2 id="_idParaDest-78" class="calibre7"><a id="_idTextAnchor364" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.337.1">Getting ready</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.338.1">To get started, we need the two Linux hosts we used in the </span><span><span class="kobospan" id="kobo.339.1">previous recipes:</span></span></p>
<ul class="calibre14">
<li class="calibre15"><span class="kobospan" id="kobo.340.1">Our Zabbix </span><span><span class="kobospan" id="kobo.341.1">server host</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.342.1">The host we used in the previous recipe to monitor via the Za</span><a id="_idTextAnchor365" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor366" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.343.1">bbix </span><span><span class="kobospan" id="kobo.344.1">active agent</span></span></li>
</ul>
<h2 id="_idParaDest-79" class="calibre7"><a id="_idTextAnchor367" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.345.1">How to do it…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.346.1">Monitoring via SNMP polling is easy and very powerful. </span><span class="kobospan" id="kobo.346.2">We will start by configuring SNMPv3 on our monitored </span><span><span class="kobospan" id="kobo.347.1">Linux host:</span></span></p>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.348.1">Let’s start by issuing the following commands to install SNMP on the host we would like to be monitored </span><span><span class="kobospan" id="kobo.349.1">by SNMP.</span></span><p class="calibre3"><span class="kobospan" id="kobo.350.1">For </span><span><span class="kobospan" id="kobo.351.1">RHEL-based systems:</span></span></p><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.352.1">dnf install net-snmp net-snmp-utils</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.353.1">For </span><span><span class="kobospan" id="kobo.354.1">Ubuntu systems:</span></span></p><pre class="source-code"><strong class="bold1"><span class="kobospan1" id="kobo.355.1">apt install snmp snmpd libsnmp-dev</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.356.1">Now, let’s create the new SNMPv3 user that we will use to monitor our host. </span><span class="kobospan" id="kobo.356.2">Please note that we’ll be using insecure passwords, so make sure you use secure passwords </span><a id="_idIndexMarker190" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.357.1">for your production environments. </span><span class="kobospan" id="kobo.357.2">Issue the </span><span><span class="kobospan" id="kobo.358.1">following command:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.359.1">net-snmp-create-v3-user -ro -a my_authpass -x my_privpass -A SHA -X AES snmpv3user</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.360.1">Please note that on some installations, you might have to stop </span><strong class="source-inline"><span class="kobospan" id="kobo.361.1">snmpd</span></strong><span class="kobospan" id="kobo.362.1"> before executing this command. </span><span class="kobospan" id="kobo.362.2">You can start it </span><span><span class="kobospan" id="kobo.363.1">again after.</span></span></p><p class="calibre3"><span class="kobospan" id="kobo.364.1">This will cr</span><a id="_idTextAnchor368" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.365.1">eate an SNMPv3 user with a username of </span><strong class="source-inline"><span class="kobospan" id="kobo.366.1">snmpv3user</span></strong><span class="kobospan" id="kobo.367.1">, an authentication password of </span><strong class="source-inline"><span class="kobospan" id="kobo.368.1">my_authpass</span></strong><span class="kobospan" id="kobo.369.1">, and a privilege password of </span><span><strong class="source-inline"><span class="kobospan" id="kobo.370.1">my_ privpass</span></strong></span><span><span class="kobospan" id="kobo.371.1">.</span></span></p></li> <li class="calibre15"><span class="kobospan" id="kobo.372.1">Make sure you edit the SNMP configuration file so that you can read all </span><span><span class="kobospan" id="kobo.373.1">SNMP objects:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.374.1">vim /etc/snmp/snmpd.conf</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.375.1">Add the following line to the existing </span><strong class="source-inline1"><span class="kobospan" id="kobo.376.1">view systemview</span></strong><span class="kobospan" id="kobo.377.1"> lines. </span><span class="kobospan" id="kobo.377.2">If there are none, simply create this </span><span><span class="kobospan" id="kobo.378.1">new line:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.379.1">
view  systemview  included  .1</span></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.380.1">Now, enable and start the </span><strong class="source-inline1"><span class="kobospan" id="kobo.381.1">snmpd</span></strong><span class="kobospan" id="kobo.382.1"> daemon so that you can start monitoring </span><span><span class="kobospan" id="kobo.383.1">this server:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.384.1">systemctl enable snmpd</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.385.1">systemctl start snmpd</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.386.1">This is all we need to do on the Linux host side; we can now go to the Zabbix frontend to configure our host. </span><span class="kobospan" id="kobo.386.2">Go to </span><strong class="bold"><span class="kobospan" id="kobo.387.1">Data collection</span></strong><span class="kobospan" id="kobo.388.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.389.1">Hosts</span></strong><span class="kobospan" id="kobo.390.1"> in your Zabbix frontend and click </span><strong class="bold"><span class="kobospan" id="kobo.391.1">Create host</span></strong><span class="kobospan" id="kobo.392.1"> in the </span><span><span class="kobospan" id="kobo.393.1">top-right corner.</span></span></p></li> <li class="calibre15"><span class="kobospan" id="kobo.394.1">Fill in </span><a id="_idIndexMarker191" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.395.1">the host </span><span><span class="kobospan" id="kobo.396.1">c</span><a id="_idTextAnchor369" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.397.1">onfiguration page:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer107">
<span class="kobospan" id="kobo.398.1"><img alt="Figure 3.11 – Zabbix host configuration page for lar-book-agent_snmp" src="image/B19803_03_11.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.399.1">Figure 3.11 – Zabbix host configuration page for lar-book-agent_snmp</span></p>
<ol class="calibre16">
<li value="7" class="calibre15"><span class="kobospan" id="kobo.400.1">Don</span><a id="_idTextAnchor370" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.401.1">’t forget to change the IP address of the SNMP interface to your </span><span><span class="kobospan" id="kobo.402.1">own value.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.403.1">Make sure you add the right out-of-the-box template, as shown in the </span><span><span class="kobospan" id="kobo.404.1">foll</span><a id="_idTextAnchor371" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.405.1">owing screenshot:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer108">
<span class="kobospan" id="kobo.406.1"><img alt="Figure 3.12 – Adding the Linux by SNMP template to the host" src="image/B19803_03_12.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.407.1">Figure 3.12 – Adding the Linux by SNMP template to the host</span></p>
<p class="callout-heading"><span class="kobospan" id="kobo.408.1">Tip</span></p>
<p class="callout"><span class="kobospan" id="kobo.409.1">While upgrading from an earlier Zabbix version to Zabbix 6, you won’t get all the new out-of-the-box templates. </span><span class="kobospan" id="kobo.409.2">If you feel like you are missing some templates</span><a id="_idTextAnchor372" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.410.1">, you can download them from the Zabbix GitHub </span><span><span class="kobospan" id="kobo.411.1">repository: </span></span><a href="https://git.zabbix.com/projects/ZBX/repos/zabbix/browse/templates" class="pcalibre calibre6 pcalibre1"><span><span class="kobospan" id="kobo.412.1">https://git.zabbix.com/projects/ZBX/repos/zabbix/browse/templates</span></span></a><span><span class="kobospan" id="kobo.413.1">.</span></span><a id="_idTextAnchor373" class="pcalibre calibre6 pcalibre1"/></p>
<ol class="calibre16">
<li value="9" class="calibre15"><span class="kobospan" id="kobo.414.1">We are using </span><a id="_idIndexMarker192" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.415.1">some macros in our configuration here for the username and password. </span><span class="kobospan" id="kobo.415.2">We can use these macros to add a bunch of hosts with the same credentials. </span><span class="kobospan" id="kobo.415.3">This is very useful, for instance, if you have a bunch of switches with the same </span><span><span class="kobospan" id="kobo.416.1">SNMPv3 credentials.</span></span><p class="calibre3"><span class="kobospan" id="kobo.417.1">Let’s fill in the macros under </span><strong class="bold"><span class="kobospan" id="kobo.418.1">Administration</span></strong><span class="kobospan" id="kobo.419.1"> |</span><a id="_idTextAnchor374" class="pcalibre calibre6 pcalibre1"/> <strong class="bold"><span class="kobospan" id="kobo.420.1">Macros</span></strong><span class="kobospan" id="kobo.421.1">, </span><span><span class="kobospan" id="kobo.422.1">like so:</span></span></p></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer109">
<span class="kobospan" id="kobo.423.1"><img alt="Figure 3.13 – Zabbix global macro page with SNMP macros" src="image/B19803_03_13.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.424.1">Figure 3.13 – Zabbix global macro page with SNMP macros</span></p>
<p class="callout-heading"><span class="kobospan" id="kobo.425.1">Tip</span></p>
<p class="callout"><span class="kobospan" id="kobo.426.1">A cool feature in Zabbix 6 is the ability to hide macros in the frontend by using the </span><strong class="bold"><span class="kobospan" id="kobo.427.1">Secret text</span></strong><span class="kobospan" id="kobo.428.1"> macro typ</span><a id="_idTextAnchor375" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.429.1">e. </span><span class="kobospan" id="kobo.429.2">Do keep in mind that macros of the </span><strong class="bold"><span class="kobospan" id="kobo.430.1">Secret text</span></strong><span class="kobospan" id="kobo.431.1"> type are still unencrypted in the Zabbix database, So, for fully encrypted macros, we would need something such as HashiCorp or Cyb</span><a id="_idTextAnchor376" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.432.1">erArk Vault. </span><span class="kobospan" id="kobo.432.2">Check out the documentation for more </span><span><span class="kobospan" id="kobo.433.1">information: </span></span><a href="https://www.zabbix.com/documentation/current/en/manual/config/secrets" class="pcalibre calibre6 pcalibre1"><span><span class="kobospan" id="kobo.434.1">https://www.zabbix.com/documentation/current/en/manual/config/secrets</span></span></a><span><span class="kobospan" id="kobo.435.1">.</span></span></p>
<ol class="calibre16">
<li value="10" class="calibre15"><span class="kobospan" id="kobo.436.1">Use the </span><a id="_idIndexMarker193" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.437.1">dropdown to change </span><strong class="bold"><span class="kobospan" id="kobo.438.1">{$SNMPV3_AUTH}</span></strong><span class="kobospan" id="kobo.439.1"> and </span><strong class="bold"><span class="kobospan" id="kobo.440.1">{$SNMPV3_PRIV</span><a id="_idTextAnchor377" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.441.1">}</span></strong><span class="kobospan" id="kobo.442.1"> to </span><span><strong class="bold"><span class="kobospan" id="kobo.443.1">Secret text</span></strong></span><span><span class="kobospan" id="kobo.444.1">:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer110">
<span class="kobospan" id="kobo.445.1"><img alt="Figure 3.14 – Zabbix Secret text used to hide sensitive (authentication) data" src="image/B19803_03_14.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.446.1">Figure 3.14 – Zabbix Secret text used to hide sensitive (authentication) data</span></p>
<ol class="calibre16">
<li value="11" class="calibre15"><span class="kobospan" id="kobo.447.1">Now, after appl</span><a id="_idTextAnchor378" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.448.1">ying these changes by clicking </span><strong class="bold"><span class="kobospan" id="kobo.449.1">Update</span></strong><span class="kobospan" id="kobo.450.1">, we should be able to monitor our Linux server via SNMPv3. </span><span class="kobospan" id="kobo.450.2">Let’s go to </span><strong class="bold"><span class="kobospan" id="kobo.451.1">Monitoring</span></strong><span class="kobospan" id="kobo.452.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.453.1">Hosts</span></strong><span class="kobospan" id="kobo.454.1"> and check the </span><strong class="bold"><span class="kobospan" id="kobo.455.1">Latest data</span></strong><span class="kobospan" id="kobo.456.1"> page f</span><a id="_idTextAnchor379" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.457.1">or our </span><span><span class="kobospan" id="kobo.458.1">new host:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer111">
<span class="kobospan" id="kobo.459.1"><img alt="Figure 3.15 – SNMP – the Latest data page for lar-book-agent_snmp" src="image/B19803_03_15.JPG" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.460.1">Figure 3.15 – SNMP – the Latest data page for lar-book-agent_snmp</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.461.1">Note t</span><a id="_idTextAnchor380" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.462.1">hat </span><a id="_idIndexMarker194" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.463.1">it might take around 1 minute for your data to show </span><span><span class="kobospan" id="kobo.464.1">up here.</span></span></p>
<p class="callout-heading"><span class="kobospan" id="kobo.465.1">Tip</span></p>
<p class="callout"><span class="kobospan" id="kobo.466.1">When working with macros, there are three levels in cascading order: global, template, and host-level macros. </span><a id="_idTextAnchor381" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.467.1">When working with global-level macros, keep in mind that they are not exported with templates or hosts. </span><span class="kobospan" id="kobo.467.2">You want to </span><a id="_idTextAnchor382" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.468.1">use template-level and host-level macros in most cases to keep your exports independent of Zabbix</span><a id="_idTextAnchor383" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor384" class="pcalibre calibre6 pcalibre1"/> <span><span class="kobospan" id="kobo.469.1">global settings.</span></span></p>
<h2 id="_idParaDest-80" class="calibre7"><a id="_idTextAnchor385" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.470.1">How it works…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.471.1">When we create a host, as we did in </span><em class="italic"><span class="kobospan" id="kobo.472.1">Step 4</span></em><span class="kobospan" id="kobo.473.1">, Zabbix polls the host using SNMP. </span><span class="kobospan" id="kobo.473.2">Polling SNMP like this uses SNMP OIDs. </span><span class="kobospan" id="kobo.473.3">For instance, when we poll the </span><strong class="bold"><span class="kobospan" id="kobo.474.1">Free memory</span></strong><span class="kobospan" id="kobo.475.1"> item, we ask the SNMP agent running on our Linux host to provide us the value for OID </span><strong class="source-inline"><span class="kobospan" id="kobo.476.1">1.3.6.1.4.1.2021.4.6.0</span></strong><span class="kobospan" id="kobo.477.1">. </span><span class="kobospan" id="kobo.477.2">That value is then returned to us on th</span><a id="_idTextAnchor386" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.478.1">e </span><span><span class="kobospan" id="kobo.479.1">Zabbix server:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer112">
<span class="kobospan" id="kobo.480.1"><img alt="Figure 3.16 – Diagram showing communication between Zabbix server and SNMP host" src="image/B19803_03_16.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.481.1">Figure 3.16 – Diagram showing communication between Zabbix server and SNMP host</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.482.1">The OID is like the address (or path) of where our metric is located. </span><span class="kobospan" id="kobo.482.2">By requesting the OID, the metric </span><span><span class="kobospan" id="kobo.483.1">is requested.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.484.1">SNMPv3 adds authentication and encryption to this process, making sure that when our Zabbix server requests information, that request is first encrypted and the data is sent back encrypted </span><span><span class="kobospan" id="kobo.485.1">as well.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.486.1">We also </span><a id="_idIndexMarker195" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.487.1">included the option to use </span><strong class="bold"><span class="kobospan" id="kobo.488.1">Combined requests</span></strong><span class="kobospan" id="kobo.489.1"> when configuring our host. </span><span class="kobospan" id="kobo.489.2">Combined requests request several OIDs in the same stream, making this the preferred method of doing SNMP requests as it is more efficient. </span><span class="kobospan" id="kobo.489.3">Only disable it for hosts that do not support </span><strong class="bold"><span class="kobospan" id="kobo.490.1">Combined requests</span></strong><span class="kobospan" id="kobo.491.1">. </span><span class="kobospan" id="kobo.491.2">Even better is to use an SNMP bulk request, which we will discuss in the </span><span><span class="kobospan" id="kobo.492.1">next recipe.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.493.1">Lastly, let’s take a look at SNMP OIDs, the most important part of our SNMP request. </span><span class="kobospan" id="kobo.493.2">OIDs w</span><a id="_idTextAnchor387" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.494.1">ork in a tree-like structure, meaning that every number behind the dot can contain another value. </span><span class="kobospan" id="kobo.494.2">For example, let’s look at this OID for </span><span><span class="kobospan" id="kobo.495.1">our host:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.496.1">
1.3.6.1.4.1.2021.4 = UCD-SNMP-MIB::memory</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.497.1">If we poll that OID with either the SNMPwalk CLI tool or our Zabbix server, we will get several </span><span><span class="kobospan" id="kobo.498.1">OIDs back:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.499.1">
.1.3.6.1.4.1.2021.4.1.0 = INTEGER: 0
.1.3.6.1.4.1.2021.4.2.0 = STRING: swap
.1.3.6.1.4.1.2021.4.3.0 = INTEGER: 1679356 kB
.1.3.6.1.4.1.2021.4.4.0 = INTEGER: 1674464 kB
.1.3.6.1.4.1.2021.4.5.0 = INTEGER: 1872872 kB
.1.3.6.1.4.1.2021.4.6.0 = INTEGER: 184068 kB</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.500.1">This includes our </span><strong class="source-inline"><span class="kobospan" id="kobo.501.1">1.3.6.1.4.1.2021.4.6.0</span></strong><span class="kobospan" id="kobo.502.1"> OID with the value that contains our free m</span><a id="_idTextAnchor388" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.503.1">emory. </span><span class="kobospan" id="kobo.503.2">This is how SNMP is built, like </span><span><span class="kobospan" id="kobo.504.1">a tree.</span></span></p>
<h1 id="_idParaDest-81" class="calibre5"><a id="_idTextAnchor389" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.505.1">Setting up SNMP monitoring the new way</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.506.1">SNMP monitoring has had an entire overhaul starting with Zabbix 6.4, introducing a new way to </span><a id="_idIndexMarker196" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.507.1">build SNMP monitoring. </span><span class="kobospan" id="kobo.507.2">The old way is still available and works, but all out-of-the-box monitoring will be overhauled to work with the </span><span><span class="kobospan" id="kobo.508.1">new way.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.509.1">The new way will utilize SNMP bulk queries, making it a lot more efficient. </span><span class="kobospan" id="kobo.509.2">As such, in this recipe, we will look at how to build SNMP monitoring the </span><span><span class="kobospan" id="kobo.510.1">new way.</span></span></p>
<h2 id="_idParaDest-82" class="calibre7"><a id="_idTextAnchor390" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.511.1">Getting ready</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.512.1">To get started, we need the two </span><span><span class="kobospan" id="kobo.513.1">Linux hosts:</span></span></p>
<ul class="calibre14">
<li class="calibre15"><span class="kobospan" id="kobo.514.1">Our Zabbix </span><span><span class="kobospan" id="kobo.515.1">server environment</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.516.1">Any Linux host running the </span><span><span class="kobospan" id="kobo.517.1">SNMP server</span></span></li>
</ul>
<h2 id="_idParaDest-83" class="calibre7"><a id="_idTextAnchor391" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.518.1">How to do it…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.519.1">Let’s be efficient and start building some bulk SNMP queries. </span><span class="kobospan" id="kobo.519.2">First things first, get your </span><span><span class="kobospan" id="kobo.520.1">hosts ready:</span></span></p>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.521.1">First, log in to your Zabbix server CLI. </span><span class="kobospan" id="kobo.521.2">We will start by installing some additional tools to make building SNMP </span><span><span class="kobospan" id="kobo.522.1">monitoring easier.</span></span><p class="calibre3"><span class="kobospan" id="kobo.523.1">For </span><span><span class="kobospan" id="kobo.524.1">RHEL-based systems:</span></span></p><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.525.1">dnf install net-snmp-utils</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.526.1">For </span><span><span class="kobospan" id="kobo.527.1">Ubuntu systems:</span></span></p><pre class="source-code"><strong class="bold1"><span class="kobospan1" id="kobo.528.1">apt install libsnmp-dev</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.529.1">Then, on the Linux host we would like to monitor, we must install the </span><span><span class="kobospan" id="kobo.530.1">SNMP server.</span></span><p class="calibre3"><span class="kobospan" id="kobo.531.1">For </span><span><span class="kobospan" id="kobo.532.1">RHEL-based systems:</span></span></p><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.533.1">dnf install net-snmp net-snmp-utils</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.534.1">For </span><span><span class="kobospan" id="kobo.535.1">Ubuntu systems:</span></span></p><pre class="source-code"><strong class="bold1"><span class="kobospan1" id="kobo.536.1">apt install snmp snmpd libsnmp-dev</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.537.1">Now, let’s configure a new SNMPv3 user on the host we want to monitor and set up the server so that we can </span><span><span class="kobospan" id="kobo.538.1">query information:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.539.1">net-snmp-create-v3-user -ro -a my_authpass -x my_privpass -A SHA -X AES snmpv3user</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.540.1">This will create an SNMPv3 user with a username of </span><strong class="source-inline"><span class="kobospan" id="kobo.541.1">snmpv3user</span></strong><span class="kobospan" id="kobo.542.1">, an authentication password of </span><strong class="source-inline"><span class="kobospan" id="kobo.543.1">my_authpass</span></strong><span class="kobospan" id="kobo.544.1">, and a privilege password of </span><strong class="source-inline"><span class="kobospan" id="kobo.545.1">my_ privpass</span></strong><span class="kobospan" id="kobo.546.1">. </span><span class="kobospan" id="kobo.546.2">Please make sure you use secure passwords in your </span><span><span class="kobospan" id="kobo.547.1">production environments!</span></span></p></li> <li class="calibre15"><span class="kobospan" id="kobo.548.1">Make sure </span><a id="_idIndexMarker197" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.549.1">you edit the SNMP configuration file so that you can read all </span><span><span class="kobospan" id="kobo.550.1">SNMP objects:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.551.1">vim /etc/snmp/snmpd.conf</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.552.1">Add the following line to the rest of the </span><strong class="source-inline1"><span class="kobospan" id="kobo.553.1">view </span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.554.1">systemview</span></strong></span><span><span class="kobospan" id="kobo.555.1"> lines:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.556.1">
view  systemview  included  .1</span></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.557.1">Now, enable and start the </span><strong class="source-inline1"><span class="kobospan" id="kobo.558.1">snmpd</span></strong><span class="kobospan" id="kobo.559.1"> daemon so that you can start monitoring </span><span><span class="kobospan" id="kobo.560.1">this server:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.561.1">systemctl enable snmpd</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.562.1">systemctl start snmpd</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.563.1">This is all we need to do on the Linux host side; we can now go to the Zabbix frontend to configure </span><span><span class="kobospan" id="kobo.564.1">our host.</span></span></p></li> <li class="calibre15"><span class="kobospan" id="kobo.565.1">Go to </span><strong class="bold"><span class="kobospan" id="kobo.566.1">Data collection</span></strong><span class="kobospan" id="kobo.567.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.568.1">Hosts</span></strong><span class="kobospan" id="kobo.569.1"> in your Zabbix frontend and click </span><strong class="bold"><span class="kobospan" id="kobo.570.1">Create host</span></strong><span class="kobospan" id="kobo.571.1"> in the top-right corner. </span><span class="kobospan" id="kobo.571.2">We will create a new host with the </span><span><span class="kobospan" id="kobo.572.1">following information:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer113">
<span class="kobospan" id="kobo.573.1"><img alt="Figure 3.17 – Zabbix host configuration page for lar-book-snmp_bulk" src="image/B19803_03_17.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.574.1">Figure 3.17 – Zabbix host configuration page for lar-book-snmp_bulk</span></p>
<ol class="calibre16">
<li value="8" class="calibre15"><span class="kobospan" id="kobo.575.1">Before adding </span><a id="_idIndexMarker198" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.576.1">the host, make sure you click on the small dotted underlined </span><strong class="bold"><span class="kobospan" id="kobo.577.1">Add</span></strong><span class="kobospan" id="kobo.578.1"> button in the </span><strong class="bold"><span class="kobospan" id="kobo.579.1">Interfaces</span></strong><span class="kobospan" id="kobo.580.1"> section and </span><span><span class="kobospan" id="kobo.581.1">select </span></span><span><strong class="bold"><span class="kobospan" id="kobo.582.1">SNMP</span></strong></span><span><span class="kobospan" id="kobo.583.1">:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer114">
<span class="kobospan" id="kobo.584.1"><img alt="Figure 3.18 – Zabbix interface configuration for lar-book-snmp_bulk" src="image/B19803_03_18.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.585.1">Figure 3.18 – Zabbix interface configuration for lar-book-snmp_bulk</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.586.1">Make sure you fill in the right IP address and credentials for the host you are going </span><span><span class="kobospan" id="kobo.587.1">to monitor.</span></span></p>
<ol class="calibre16">
<li value="9" class="calibre15"><span class="kobospan" id="kobo.588.1">Switch to the </span><strong class="bold"><span class="kobospan" id="kobo.589.1">Macros</span></strong><span class="kobospan" id="kobo.590.1"> tab and add the </span><span><span class="kobospan" id="kobo.591.1">following information:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer115">
<span class="kobospan" id="kobo.592.1"><img alt="Figure 3.19 – Zabbix host configuration Macros tab for lar-book-snmp_bulk" src="image/B19803_03_19.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.593.1">Figure 3.19 – Zabbix host configuration Macros tab for lar-book-snmp_bulk</span></p>
<ol class="calibre16">
<li value="10" class="calibre15"><span class="kobospan" id="kobo.594.1">Let’s also </span><a id="_idIndexMarker199" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.595.1">go to </span><strong class="bold"><span class="kobospan" id="kobo.596.1">Value mapping</span></strong><span class="kobospan" id="kobo.597.1"> and create the following value map. </span><span class="kobospan" id="kobo.597.2">We’ll use </span><span><span class="kobospan" id="kobo.598.1">this later:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer116">
<span class="kobospan" id="kobo.599.1"><img alt="Figure 3.20 – Zabbix host configuration Value mapping tab for lar-book-snmp_bulk" src="image/B19803_03_20.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.600.1">Figure 3.20 – Zabbix host configuration Value mapping tab for lar-book-snmp_bulk</span></p>
<ol class="calibre16">
<li value="11" class="calibre15"><span class="kobospan" id="kobo.601.1">Now, you can click on the big </span><strong class="bold"><span class="kobospan" id="kobo.602.1">Add</span></strong><span class="kobospan" id="kobo.603.1"> button at the bottom of the page and the host will </span><span><span class="kobospan" id="kobo.604.1">be created.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.605.1">At this point, we have to start building our SNMP checks. </span><span class="kobospan" id="kobo.605.2">But before we do that, we should decide which checks to build. </span><span class="kobospan" id="kobo.605.3">Let’s do a quick SNMP walk from the Zabbix server </span><span><span class="kobospan" id="kobo.606.1">Linux CLI:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.607.1">snmpwalk -On -v3  -l authPriv -u snmpv3user -a SHA -A "my_authpass"  -x AES -X "my_privpass" 192.168.1.86 .1.3.6.1.2.1.2.2.1.2</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.608.1">This SNMP walk will show us an output similar to </span><span><span class="kobospan" id="kobo.609.1">the following:</span></span></p><pre class="source-code"><span class="kobospan1" id="kobo.610.1">.1.3.6.1.2.1.2.2.1.2.1 = STRING: lo
.1.3.6.1.2.1.2.2.1.2.</span><strong class="bold1"><span class="kobospan1" id="kobo.611.1">2</span></strong><span class="kobospan1" id="kobo.612.1"> = STRING: ens192</span></pre><p class="calibre3"><span class="kobospan" id="kobo.613.1">These are the SNMP interfaces that are available within our system and I want to add them for monitoring. </span><span class="kobospan" id="kobo.613.2">Let’s say I want to monitor the </span><strong class="source-inline"><span class="kobospan" id="kobo.614.1">ens192</span></strong><span class="kobospan" id="kobo.615.1"> interface. </span><span class="kobospan" id="kobo.615.2">Remember that the index for the </span><strong class="source-inline"><span class="kobospan" id="kobo.616.1">ens192</span></strong><span class="kobospan" id="kobo.617.1"> interface is the number </span><strong class="source-inline"><span class="kobospan" id="kobo.618.1">2</span></strong><span class="kobospan" id="kobo.619.1">; we will need </span><span><span class="kobospan" id="kobo.620.1">it later.</span></span></p><p class="calibre3"><span class="kobospan" id="kobo.621.1">To add all the interface information in bulk to our Zabbix environment, I will use a lower OID. </span><span class="kobospan" id="kobo.621.2">However, note that </span><strong class="source-inline"><span class="kobospan" id="kobo.622.1">.1.3.6.1.2.1.2.2.1</span></strong><span class="kobospan" id="kobo.623.1"> contains all our </span><span><span class="kobospan" id="kobo.624.1">interface information.</span></span></p></li> <li class="calibre15"><span class="kobospan" id="kobo.625.1">Test the </span><a id="_idIndexMarker200" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.626.1">SNMP walk with all </span><span><span class="kobospan" id="kobo.627.1">interface information:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.628.1">snmpwalk -On -v3  -l authPriv -u snmpv3user -a SHA -A "my_authpass"  -x AES -X "my_privpass" 192.168.1.86 .1.3.6.1.2.1.2.2.1</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.629.1">You should see a lot more </span><span><span class="kobospan" id="kobo.630.1">output now.</span></span></p></li> <li class="calibre15"><span class="kobospan" id="kobo.631.1">Let’s go back to the Zabbix frontend by going to </span><strong class="bold"><span class="kobospan" id="kobo.632.1">Data collection</span></strong><span class="kobospan" id="kobo.633.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.634.1">Hosts</span></strong><span class="kobospan" id="kobo.635.1">, choosing the </span><strong class="source-inline1"><span class="kobospan" id="kobo.636.1">lar-book-snmp_bulk</span></strong><span class="kobospan" id="kobo.637.1"> host, and going </span><span><span class="kobospan" id="kobo.638.1">to </span></span><span><strong class="bold"><span class="kobospan" id="kobo.639.1">Item</span></strong></span><span><span class="kobospan" id="kobo.640.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.641.1">In the top-right corner, click </span><strong class="bold"><span class="kobospan" id="kobo.642.1">Create item</span></strong><span class="kobospan" id="kobo.643.1"> and add the </span><span><span class="kobospan" id="kobo.644.1">following information:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer117">
<span class="kobospan" id="kobo.645.1"><img alt="Figure 3.21 – Zabbix item configuration for ifTable.walk" src="image/B19803_03_21.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.646.1">Figure 3.21 – Zabbix item configuration for ifTable.walk</span></p>
<ol class="calibre16">
<li value="16" class="calibre15"><span class="kobospan" id="kobo.647.1">Don’t forget to switch to the </span><strong class="bold"><span class="kobospan" id="kobo.648.1">Tags</span></strong><span class="kobospan" id="kobo.649.1"> tab and add </span><span><span class="kobospan" id="kobo.650.1">the following:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer118">
<span class="kobospan" id="kobo.651.1"><img alt="Figure 3.22 – Zabbix item configuration ifTable.walk Tags tab" src="image/B19803_03_22.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.652.1">Figure 3.22 – Zabbix item configuration ifTable.walk Tags tab</span></p>
<ol class="calibre16">
<li value="17" class="calibre15"><span class="kobospan" id="kobo.653.1">Click on the big </span><strong class="bold"><span class="kobospan" id="kobo.654.1">Add</span></strong><span class="kobospan" id="kobo.655.1"> button at the bottom of the window to add this item to </span><span><span class="kobospan" id="kobo.656.1">the host.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.657.1">This item will </span><a id="_idIndexMarker201" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.658.1">now collect our SNMP data in bulk. </span><span class="kobospan" id="kobo.658.2">At this point, we can create dependent items to get specific values. </span><span class="kobospan" id="kobo.658.3">You should be back on the </span><strong class="bold"><span class="kobospan" id="kobo.659.1">Items</span></strong><span class="kobospan" id="kobo.660.1"> page for the host, where we can once again click on </span><span><strong class="bold"><span class="kobospan" id="kobo.661.1">Create item</span></strong></span><span><span class="kobospan" id="kobo.662.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.663.1">My interface was called </span><strong class="source-inline1"><span class="kobospan" id="kobo.664.1">ens192</span></strong><span class="kobospan" id="kobo.665.1">, so let’s get the operational status for that interface. </span><span class="kobospan" id="kobo.665.2">Add the </span><span><span class="kobospan" id="kobo.666.1">following information:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer119">
<span class="kobospan" id="kobo.667.1"><img alt="Figure 3.23 – Zabbix item configuration for ifOperStatus[ens192]" src="image/B19803_03_23.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.668.1">Figure 3.23 – Zabbix item configuration for ifOperStatus[ens192]</span></p>
<ol class="calibre16">
<li value="20" class="calibre15"><span class="kobospan" id="kobo.669.1">Don’t forget to switch to the </span><strong class="bold"><span class="kobospan" id="kobo.670.1">Tags</span></strong><span class="kobospan" id="kobo.671.1"> tab and add </span><span><span class="kobospan" id="kobo.672.1">the following:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer120">
<span class="kobospan" id="kobo.673.1"><img alt="Figure 3.24 – Zabbix item configuration ifOperStatus[ens192] Tags tab" src="image/B19803_03_24.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.674.1">Figure 3.24 – Zabbix item configuration ifOperStatus[ens192] Tags tab</span></p>
<ol class="calibre16">
<li value="21" class="calibre15"><span class="kobospan" id="kobo.675.1">Last, but certainly not least, we will need to go to the </span><strong class="bold"><span class="kobospan" id="kobo.676.1">Preprocessing</span></strong><span class="kobospan" id="kobo.677.1"> tab. </span><span class="kobospan" id="kobo.677.2">This is where we </span><a id="_idIndexMarker202" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.678.1">will decide which value to extract from the bulk. </span><span class="kobospan" id="kobo.678.2">Remember the index from </span><em class="italic"><span class="kobospan" id="kobo.679.1">Step 12</span></em><span class="kobospan" id="kobo.680.1">? </span><span class="kobospan" id="kobo.680.2">Let’s use it now by adding the OID for the interface operational status (</span><strong class="source-inline1"><span class="kobospan" id="kobo.681.1">1.3.6.1.2.1.2.2.1.8</span></strong><span class="kobospan" id="kobo.682.1">) with an index </span><span><span class="kobospan" id="kobo.683.1">of </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.684.1">2</span></strong></span><span><span class="kobospan" id="kobo.685.1">:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer121">
<span class="kobospan" id="kobo.686.1"><img alt="Figure 3.25 – Zabbix item configuration ifOperStatus[ens192] Preprocessing tab" src="image/B19803_03_25.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.687.1">Figure 3.25 – Zabbix item configuration ifOperStatus[ens192] Preprocessing tab</span></p>
<ol class="calibre16">
<li value="22" class="calibre15"><span class="kobospan" id="kobo.688.1">Now, click the big </span><strong class="bold"><span class="kobospan" id="kobo.689.1">Add</span></strong><span class="kobospan" id="kobo.690.1"> button at the bottom of the page and let’s see if it </span><span><span class="kobospan" id="kobo.691.1">all worked.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.692.1">Go to </span><strong class="bold"><span class="kobospan" id="kobo.693.1">Monitoring</span></strong><span class="kobospan" id="kobo.694.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.695.1">Latest data</span></strong><span class="kobospan" id="kobo.696.1"> and find your host – that </span><span><span class="kobospan" id="kobo.697.1">is, </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.698.1">lar-book-snmp_bulk</span></strong></span><span><span class="kobospan" id="kobo.699.1">:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer122">
<span class="kobospan" id="kobo.700.1"><img alt="Figure 3.26 – Zabbix lar-book-snmp_bulk under Monitoring | Latest data" src="image/B19803_03_26.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.701.1">Figure 3.26 – Zabbix lar-book-snmp_bulk under Monitoring | Latest data</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.702.1">As you can see, we are now collecting the SNMP information in bulk and then collecting a single value from the </span><span><span class="kobospan" id="kobo.703.1">bulk information.</span></span></p>
<p class="callout-heading"><span class="kobospan" id="kobo.704.1">Important note</span></p>
<p class="callout"><span class="kobospan" id="kobo.705.1">It is always recommended to use the </span><strong class="bold"><span class="kobospan" id="kobo.706.1">Do not keep history</span></strong><span class="kobospan" id="kobo.707.1"> option on items collecting values in bulk. </span><span class="kobospan" id="kobo.707.2">That way, we aren’t storing duplicate values for no reason. </span><span class="kobospan" id="kobo.707.3">Once you finish building all your SNMP items, don’t forget to make </span><span><span class="kobospan" id="kobo.708.1">that change.</span></span></p>
<h2 id="_idParaDest-84" class="calibre7"><a id="_idTextAnchor392" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.709.1">How it works…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.710.1">The new SNMP walk might seem like a bit of a headscratcher at first. </span><span class="kobospan" id="kobo.710.2">Why do we need this new change? </span><span class="kobospan" id="kobo.710.3">The way the internals work in Zabbix before 6.4 is that it will collect each SNMP </span><a id="_idIndexMarker203" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.711.1">OID separately. </span><span class="kobospan" id="kobo.711.2">There is a smart mechanism that combines requests to make it a bit more efficient, but it was never officially a bulk request (even though that’s what the frontend </span><span><span class="kobospan" id="kobo.712.1">called it).</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.713.1">Now, with the new </span><strong class="source-inline"><span class="kobospan" id="kobo.714.1">walk[]</span></strong><span class="kobospan" id="kobo.715.1"> item key, we are collecting all the SNMP values in a single SNMP </span><strong class="source-inline"><span class="kobospan" id="kobo.716.1">GetBulk</span></strong><span class="kobospan" id="kobo.717.1"> request. </span><span class="kobospan" id="kobo.717.2">This makes the entire process a lot more efficient and stresses the SNMP devices a </span><span><span class="kobospan" id="kobo.718.1">lot less.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.719.1">There’s also a new addition in Zabbix 7.0 that is for the following </span><span><span class="kobospan" id="kobo.720.1">three pollers:</span></span></p>
<ul class="calibre14">
<li class="calibre15"><span><span class="kobospan" id="kobo.721.1">Agent poller</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.722.1">HTTP </span><span><span class="kobospan" id="kobo.723.1">agent poller</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.724.1">SNMP poller (for </span><strong class="source-inline1"><span class="kobospan" id="kobo.725.1">walk[OID]</span></strong><span class="kobospan" id="kobo.726.1"> and </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.727.1">get[OID]</span></strong></span><span><span class="kobospan" id="kobo.728.1"> items)</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.729.1">These processes now execute checks asynchronously. </span><span class="kobospan" id="kobo.729.2">What this means for our SNMP checks using </span><strong class="source-inline"><span class="kobospan" id="kobo.730.1">walk[]</span></strong><span class="kobospan" id="kobo.731.1"> or </span><strong class="source-inline"><span class="kobospan" id="kobo.732.1">get[]</span></strong><span class="kobospan" id="kobo.733.1"> is that they can execute multiple (item) checks at the same time. </span><span class="kobospan" id="kobo.733.2">In older versions of Zabbix, these pollers could only execute a single check at </span><span><span class="kobospan" id="kobo.734.1">a time.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.735.1">It’s still possible to add multiple of these processes with </span><strong class="bold"><span class="kobospan" id="kobo.736.1">StartSNMPPollers</span></strong><span class="kobospan" id="kobo.737.1">, for example, but it now functions differently. </span><span class="kobospan" id="kobo.737.2">They will execute a maximum of 1,000 checks per poller, something that can be configured with the </span><span><strong class="bold"><span class="kobospan" id="kobo.738.1">MaxConcurrentChecksPerPoller</span></strong></span><span><span class="kobospan" id="kobo.739.1"> parameter.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.740.1">So, what did we use? </span><span class="kobospan" id="kobo.740.2">Well, we started with a simple request, which was to get all of the values under the SNMP interface’s OID – that is, </span><strong class="source-inline"><span class="kobospan" id="kobo.741.1">.1.3.6.1.2.1.2.2.1</span></strong><span class="kobospan" id="kobo.742.1">. </span><span class="kobospan" id="kobo.742.2">This contains all the information for our SNMP interfaces, as shown in the </span><span><span class="kobospan" id="kobo.743.1">following screenshot:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer123">
<span class="kobospan" id="kobo.744.1"><img alt="Figure 3.27 – Zabbix lar-book-snmp_bulk raw SNMP walk on Monitoring | Latest data" src="image/B19803_03_031.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.745.1">Figure 3.27 – Zabbix lar-book-snmp_bulk raw SNMP walk on Monitoring | Latest data</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.746.1">After, we extracted a single value from the bulk we collected with a </span><span><span class="kobospan" id="kobo.747.1">preprocessing step:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer124">
<span class="kobospan" id="kobo.748.1"><img alt="Figure 3.28 – Zabbix lar-book-snmp_bulk SNMP walk value preprocessing" src="image/B19803_03_28.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.749.1">Figure 3.28 – Zabbix lar-book-snmp_bulk SNMP walk value preprocessing</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.750.1">We can do this to extract any OID from the already completed SNMP walk manually. </span><span class="kobospan" id="kobo.750.2">This is super useful if you have a lot of information from an SNMP walk item but you only need a few static values from </span><span><span class="kobospan" id="kobo.751.1">the walk.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.752.1">This becomes </span><a id="_idIndexMarker204" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.753.1">extra apparent once we collect big pieces of information and start using LLD rules to automate the task later, as well as when we still need to get some specific values, something that might not be an option for LLD. </span><span class="kobospan" id="kobo.753.2">All that information can be collected in a single call to the SNMP device and then split into LLD rules, as well as </span><span><span class="kobospan" id="kobo.754.1">separate items.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.755.1">We’ll continue working with this kind of new monitoring in </span><a href="B19803_07.xhtml#_idTextAnchor1318" class="pcalibre calibre6 pcalibre1"><span><em class="italic"><span class="kobospan" id="kobo.756.1">Chapter 7</span></em></span></a><span class="kobospan" id="kobo.757.1">, </span><em class="italic"><span class="kobospan" id="kobo.758.1">Using Discovery for Automatic Creation</span></em><span class="kobospan" id="kobo.759.1">, in the </span><em class="italic"><span class="kobospan" id="kobo.760.1">Setting up Zabbix SNMP low-level discovery the n</span><a id="_idTextAnchor393" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor394" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.761.1">ew </span></em><span><em class="italic"><span class="kobospan" id="kobo.762.1">way</span></em></span><span><span class="kobospan" id="kobo.763.1"> recipe.</span></span></p>
<h1 id="_idParaDest-85" class="calibre5"><a id="_idTextAnchor395" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.764.1">Creating Zabbix simple checks and the Zabbix trapper</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.765.1">In this </span><a id="_idIndexMarker205" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.766.1">recipe,</span><a id="_idTextAnchor396" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.767.1"> we will go over two checks that can help you build some</span><a id="_idTextAnchor397" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.768.1"> more customized setups. </span><span class="kobospan" id="kobo.768.2">Zabbix simple checks provide you with an easy way to </span><a id="_idIndexMarker206" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.769.1">monitor some specific data, while the Zabbix trapper combines with the Zabbix sender to get data from your hosts into the server, providing you with some scripting options. </span><span class="kobospan" id="kobo.769.2">Le</span><a id="_idTextAnchor398" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor399" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.770.1">t’s </span><span><span class="kobospan" id="kobo.771.1">get started.</span></span></p>
<h2 id="_idParaDest-86" class="calibre7"><a id="_idTextAnchor400" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.772.1">Getting ready</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.773.1">To create these checks, we will need a Zabbix server and a Linux host to monitor. </span><span class="kobospan" id="kobo.773.2">We can use the host with a Zabbix agent and SNMP monitoring from the </span><span><span class="kobospan" id="kobo.774.1">previous recipes.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.775.1">Note that we do not need the Zabbix agent f</span><a id="_idTextAnchor401" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor402" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.776.1">or </span><span><span class="kobospan" id="kobo.777.1">these checks.</span></span></p>
<h2 id="_idParaDest-87" class="calibre7"><a id="_idTextAnchor403" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.778.1">How to do it…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.779.1">As the name suggests, working w</span><a id="_idTextAnchor404" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.780.1">ith simple checks is quite simple. </span><span class="kobospan" id="kobo.780.2">So, let’s </span><span><span class="kobospan" id="kobo.781.1">get started.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.782.1">Creating simple checks</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.783.1">We will </span><a id="_idIndexMarker207" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.784.1">create a simple check to monitor whether a service is running and accepting TCP connections on a </span><span><span class="kobospan" id="kobo.785.1">certain port:</span></span></p>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.786.1">To get this done, we will need to create a new host on the Zabbix frontend. </span><span class="kobospan" id="kobo.786.2">Go to </span><strong class="bold"><span class="kobospan" id="kobo.787.1">Data collection</span></strong><span class="kobospan" id="kobo.788.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.789.1">Hosts</span></strong><span class="kobospan" id="kobo.790.1"> in your Zabbix frontend and click </span><strong class="bold"><span class="kobospan" id="kobo.791.1">Create host</span></strong><span class="kobospan" id="kobo.792.1"> in the </span><span><span class="kobospan" id="kobo.793.1">top-right corner.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.794.1">Create a host with the </span><span><span class="kobospan" id="kobo.795.1">fol</span><a id="_idTextAnchor405" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.796.1">lowing settings:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer125">
<span class="kobospan" id="kobo.797.1"><img alt="Figure 3.29 – Zabbix host configuration page for lar-book-agent_simple" src="image/B19803_03_29.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.798.1">Figure 3.29 – Zabbix host configuration page for lar-book-agent_simple</span></p>
<ol class="calibre16">
<li value="3" class="calibre15"><span class="kobospan" id="kobo.799.1">Now, go to </span><strong class="bold"><span class="kobospan" id="kobo.800.1">Data collection</span></strong><span class="kobospan" id="kobo.801.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.802.1">Hosts</span></strong><span class="kobospan" id="kobo.803.1"> and go to </span><strong class="bold"><span class="kobospan" id="kobo.804.1">Items</span></strong><span class="kobospan" id="kobo.805.1"> for the newly created</span><a id="_idTextAnchor406" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.806.1"> host. </span><span class="kobospan" id="kobo.806.2">We want to create a new item here by clicking the </span><strong class="bold"><span class="kobospan" id="kobo.807.1">Create </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.808.1">item</span></strong></span><span><span class="kobospan" id="kobo.809.1"> button.</span></span><p class="calibre3"><span class="kobospan" id="kobo.810.1">We must create a new item with the following values. </span><span class="kobospan" id="kobo.810.2">After doing so, click the </span><strong class="bold"><span class="kobospan" id="kobo.811.1">Add</span></strong><span class="kobospan" id="kobo.812.1"> button at the bott</span><a id="_idTextAnchor407" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.813.1">om of </span><span><span class="kobospan" id="kobo.814.1">the page:</span></span></p></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer126">
<span class="kobospan" id="kobo.815.1"><img alt="Figure 3.30 – The Zabbix item configuration page for the port 22 check on the lar-book-agent_simple host" src="image/B19803_03_30.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.816.1">Figure 3.30 – The Zabbix item configuration page for the port 22 check on the lar-book-agent_simple host</span></p>
<ol class="calibre16">
<li value="4" class="calibre15"><span class="kobospan" id="kobo.817.1">Make sure </span><a id="_idIndexMarker208" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor408" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.818.1">that you also add a tag to the item since we need this in several places to filter and find our item when we’re working with Zabbix. </span><span class="kobospan" id="kobo.818.2">Set i</span><a id="_idTextAnchor409" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.819.1">t up </span><span><span class="kobospan" id="kobo.820.1">like this:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer127">
<span class="kobospan" id="kobo.821.1"><img alt="Figure 3.31 – Zabbix SSH port item, Tag tab" src="image/B19803_03_31.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.822.1">Figure 3.31 – Zabbix SSH port item, Tag tab</span></p>
<p class="callout-heading"><span class="kobospan" id="kobo.823.1">Important note</span></p>
<p class="callout"><span class="kobospan" id="kobo.824.1">We are adding the </span><strong class="source-inline1"><span class="kobospan" id="kobo.825.1">net.tcp.services[ssh,,22]</span></strong><span class="kobospan" id="kobo.826.1"> item key here. </span><span class="kobospan" id="kobo.826.2">The port in this case is optional as we can specify the service SSH with a different port if we </span><span><span class="kobospan" id="kobo.827.1">want to.</span></span></p>
<ol class="calibre16">
<li value="5" class="calibre15"><span class="kobospan" id="kobo.828.1">Now, w</span><a id="_idTextAnchor410" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.829.1">e should </span><a id="_idIndexMarker209" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.830.1">be able to see whether our server is accepting SSH connections on port </span><strong class="source-inline1"><span class="kobospan" id="kobo.831.1">22</span></strong><span class="kobospan" id="kobo.832.1"> on our </span><strong class="bold"><span class="kobospan" id="kobo.833.1">Latest data</span></strong><span class="kobospan" id="kobo.834.1"> screen. </span><span class="kobospan" id="kobo.834.2">Navigate to </span><strong class="bold"><span class="kobospan" id="kobo.835.1">Monitoring</span></strong><span class="kobospan" id="kobo.836.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.837.1">Hosts</span></strong><span class="kobospan" id="kobo.838.1"> and check the </span><strong class="bold"><span class="kobospan" id="kobo.839.1">Latest data</span></strong><span class="kobospan" id="kobo.840.1"> screen for</span><a id="_idTextAnchor411" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.841.1"> our </span><span><span class="kobospan" id="kobo.842.1">new value:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer128">
<span class="kobospan" id="kobo.843.1"><img alt="Figure 3.32 – Zabbix Latest data page for lar-book-agent_simple, item port 22 check" src="image/B19803_03_32.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.844.1">Figure 3.32 – Zabbix Latest data page for lar-book-agent_simple, item port 22 check</span></p>
<ol class="calibre16">
<li value="6" class="calibre15"><span class="kobospan" id="kobo.845.1">There is one more thing wrong here. </span><span class="kobospan" id="kobo.845.2">As you can see, we do not currently have a value mapping setup. </span><span class="kobospan" id="kobo.845.3">Here, </span><strong class="bold"><span class="kobospan" id="kobo.846.1">Last value</span></strong><span class="kobospan" id="kobo.847.1"> is just displaying </span><strong class="bold"><span class="kobospan" id="kobo.848.1">1</span></strong><span class="kobospan" id="kobo.849.1"> or </span><strong class="bold"><span class="kobospan" id="kobo.850.1">0</span></strong><span class="kobospan" id="kobo.851.1">, making it hard to distinguish what this means. </span><span class="kobospan" id="kobo.851.2">To change this, navigate back to </span><strong class="bold"><span class="kobospan" id="kobo.852.1">Data collection</span></strong><span class="kobospan" id="kobo.853.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.854.1">Hosts</span></strong><span class="kobospan" id="kobo.855.1"> and edit the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.856.1">lar-book-agent_simple</span></strong></span><span><span class="kobospan" id="kobo.857.1"> host.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.858.1">Click on </span><a id="_idIndexMarker210" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.859.1">the </span><strong class="bold"><span class="kobospan" id="kobo.860.1">V</span><a id="_idTextAnchor412" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.861.1">alue mapping</span></strong><span class="kobospan" id="kobo.862.1"> tab and click the small </span><strong class="bold"><span class="kobospan" id="kobo.863.1">Add</span></strong><span class="kobospan" id="kobo.864.1"> button to add a value ma</span><a id="_idTextAnchor413" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.865.1">pping, </span><span><span class="kobospan" id="kobo.866.1">like so:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer129">
<span class="kobospan" id="kobo.867.1"><img alt="Figure 3.33 – lar-book-agent_simple, Value mapping window" src="image/B19803_03_33.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.868.1">Figure 3.33 – lar-book-agent_simple, Value mapping window</span></p>
<ol class="calibre16">
<li value="8" class="calibre15"><span class="kobospan" id="kobo.869.1">Click on the blue </span><strong class="bold"><span class="kobospan" id="kobo.870.1">Add</span></strong><span class="kobospan" id="kobo.871.1"> button and click on the blue </span><span><strong class="bold"><span class="kobospan" id="kobo.872.1">Update</span></strong></span><span><span class="kobospan" id="kobo.873.1"> button.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.874.1">Then, back at the full </span><strong class="bold"><span class="kobospan" id="kobo.875.1">Data collection</span></strong><span class="kobospan" id="kobo.876.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.877.1">Hosts</span></strong><span class="kobospan" id="kobo.878.1"> list, navigate to our </span><strong class="source-inline1"><span class="kobospan" id="kobo.879.1">lar-book-agent_simple</span></strong><span class="kobospan" id="kobo.880.1"> host and click on </span><strong class="bold"><span class="kobospan" id="kobo.881.1">Items</span></strong><span class="kobospan" id="kobo.882.1"> for </span><span><span class="kobospan" id="kobo.883.1">this host.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.884.1">Edit the </span><strong class="bold"><span class="kobospan" id="kobo.885.1">Check if port 22 is available</span></strong><span class="kobospan" id="kobo.886.1"> item and add the following </span><a id="_idTextAnchor414" class="pcalibre calibre6 pcalibre1"/><span><span class="kobospan" id="kobo.887.1">value mapping:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer130">
<span class="kobospan" id="kobo.888.1"><img alt="Figure 3.34 – lar-book-agent_simple, edit item window" src="image/B19803_03_34.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.889.1">Figure 3.34 – lar-book-agent_simple, edit item window</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.890.1">That’s all </span><a id="_idIndexMarker211" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.891.1">there is to creating simple checks in Zabbix. </span><span class="kobospan" id="kobo.891.2">The latest data page will now l</span><a id="_idTextAnchor415" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.892.1">ook </span><span><span class="kobospan" id="kobo.893.1">like this:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer131">
<span class="kobospan" id="kobo.894.1"><img alt="Figure 3.35 – Latest data page for our port 22 check item" src="image/B19803_03_35.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.895.1">Figure 3.35 – Latest data page for our port 22 check item</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.896.1">As you ca</span><a id="_idTextAnchor416" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.897.1">n see, there is a human-readable value now displaying either </span><strong class="bold"><span class="kobospan" id="kobo.898.1">Up</span></strong><span class="kobospan" id="kobo.899.1"> or </span><strong class="bold"><span class="kobospan" id="kobo.900.1">Down</span></strong><span class="kobospan" id="kobo.901.1">, giving us a human-readable entry that’s easier to understand. </span><span class="kobospan" id="kobo.901.2">Now, let’s look at the Zabbix </span><span><span class="kobospan" id="kobo.902.1">trapper item.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.903.1">Creating a trapper</span><a id="_idTextAnchor417" class="pcalibre calibre6 pcalibre1"/></h3>
<p class="calibre3"><span class="kobospan" id="kobo.904.1">We can do some cool stuff with Zabbix trapper items once we get more advanced setups. </span><span class="kobospan" id="kobo.904.2">But for now, let’s create an item on our </span><span><strong class="source-inline"><span class="kobospan" id="kobo.905.1">lar-book-agent_simple</span></strong></span><span><span class="kobospan" id="kobo.906.1"> host:</span></span></p>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.907.1">Go to </span><strong class="bold"><span class="kobospan" id="kobo.908.1">Data collection</span></strong><span class="kobospan" id="kobo.909.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.910.1">Hosts</span></strong><span class="kobospan" id="kobo.911.1"> and click on the host, then go to </span><strong class="bold"><span class="kobospan" id="kobo.912.1">Items</span></strong><span class="kobospan" id="kobo.913.1">. </span><span class="kobospan" id="kobo.913.2">We want to </span><a id="_idIndexMarker212" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.914.1">create a new item here by clicking the </span><strong class="bold"><span class="kobospan" id="kobo.915.1">Create </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.916.1">item</span></strong></span><span><span class="kobospan" id="kobo.917.1"> button.</span></span><p class="calibre3"><span class="kobospan" id="kobo.918.1">So, let’s create the following item and click t</span><a id="_idTextAnchor418" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.919.1">he </span><span><strong class="bold"><span class="kobospan" id="kobo.920.1">Add</span></strong></span><span><span class="kobospan" id="kobo.921.1"> button:</span></span></p></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer132">
<span class="kobospan" id="kobo.922.1"><img alt="Figure 3.36 – Zabbix item trap receiver configuration screen for lar-book-agent_simple" src="image/B19803_03_36.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.923.1">Figure 3.36 – Zabbix item trap receiver configuration screen for lar-book-agent_simple</span></p>
<ol class="calibre16">
<li value="2" class="calibre15"><span class="kobospan" id="kobo.924.1">Mak</span><a id="_idTextAnchor419" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.925.1">e sure you also navigate to the </span><strong class="bold"><span class="kobospan" id="kobo.926.1">Tags</span></strong><span class="kobospan" id="kobo.927.1"> tab and add a tag. </span><span class="kobospan" id="kobo.927.2">We will use this later </span><span><span class="kobospan" id="kobo.928.1">f</span><a id="_idTextAnchor420" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.929.1">or filtering:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer133">
<span class="kobospan" id="kobo.930.1"><img alt="Figure 3.37 – Zabbix item trap receiver tag configuration screen for lar-book-agent_simple" src="image/B19803_03_37.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.931.1">Figure 3.37 – Zabbix item trap receiver tag configuration screen for lar-book-agent_simple</span></p>
<ol class="calibre16">
<li value="3" class="calibre15"><span class="kobospan" id="kobo.932.1">If we go </span><a id="_idIndexMarker213" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.933.1">to the CLI of our monitored server, we can install </span><span><span class="kobospan" id="kobo.934.1">Zabbix sender.</span></span><p class="calibre3"><span class="kobospan" id="kobo.935.1">Run the following command for </span><span><span class="kobospan" id="kobo.936.1">RHEL-based systems:</span></span></p><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.937.1">dnf -y install zabbix-sender</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.938.1">Run the following command for </span><span><span class="kobospan" id="kobo.939.1">Ubuntu systems:</span></span></p><pre class="source-code"><strong class="bold1"><span class="kobospan1" id="kobo.940.1">apt install zabbix-sender</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.941.1">After installation, we</span><a id="_idTextAnchor421" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.942.1"> can use Zabbix sender to send some information to our server (make sure you use your Zabbix server IP when using the </span><strong class="source-inline1"><span class="kobospan" id="kobo.943.1">-</span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.944.1">z</span></strong></span><span><span class="kobospan" id="kobo.945.1"> option):</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.946.1">zabbix_sender -z 10.16.16.152 -s "lar-book-agent_simple" -k trap -o "Let's test this book trapper"</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.947.1">Now, we should be able to see whether our monitored host has sent out the Zabbix trap and the Zabbix server has received this trap </span><span><span class="kobospan" id="kobo.948.1">for processing.</span></span></p></li> <li class="calibre15"><span class="kobospan" id="kobo.949.1">Navigate to </span><strong class="bold"><span class="kobospan" id="kobo.950.1">Monitoring</span></strong><span class="kobospan" id="kobo.951.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.952.1">Hosts</span></strong><span class="kobospan" id="kobo.953.1"> and check the </span><strong class="bold"><span class="kobospan" id="kobo.954.1">Latest data</span></strong><span class="kobospan" id="kobo.955.1"> screen for o</span><a id="_idTextAnchor422" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.956.1">ur </span><span><span class="kobospan" id="kobo.957.1">new value:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer134">
<span class="kobospan" id="kobo.958.1"><img alt="Figure 3.38 – Zabbix Latest data page for lar-book-agent_simple, item trap receiver" src="image/B19803_03_38.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.959.1">Figure 3.38 – Zabbix Latest data page for lar-book-agent_simple, item trap receiver</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.960.1">There it is – our Zabbix trap is in our </span><span><span class="kobospan" id="kobo.961.1">Zab</span><a id="_idTextAnchor423" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor424" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.962.1">bix frontend.</span></span></p>
<h2 id="_idParaDest-88" class="calibre7"><a id="_idTextAnchor425" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.963.1">How it works…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.964.1">Now that we have built our new items, let’s see how they work by diving into the theoretical side of Zabbix simple checks </span><span><span class="kobospan" id="kobo.965.1">and trappers.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.966.1">Simple checks</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.967.1">Zabbix</span><a id="_idTextAnchor426" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.968.1"> simple </span><a id="_idIndexMarker214" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.969.1">checks are a list of built-in checks that are made for monitoring certain values. </span><span class="kobospan" id="kobo.969.2">There is a list and descriptions available for all the simple checks that are available in the Zabbix </span><span><span class="kobospan" id="kobo.970.1">documentation: </span></span><a href="https://www.zabbix.com/documentation/current/manual/config/items/itemtypes/simple_checks" class="pcalibre calibre6 pcalibre1"><span><span class="kobospan" id="kobo.971.1">https://www.zabbix.com/documentation/current/manual/config/items/itemtypes/simple_checks</span></span></a><span><span class="kobospan" id="kobo.972.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.973.1">All </span><a id="_idTextAnchor427" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.974.1">of these checks are performed by the Zabbix server to collect data from a monitored host. </span><span class="kobospan" id="kobo.974.2">For example, when we do the Zabbix simple check to check whether a port is open, our Zabbix server requests whether it can reach that port and turns that into a status we can then see in our </span><span><span class="kobospan" id="kobo.975.1">Zabbix frontend.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.976.1">This means that if your monitored host’s firewall is blocking port </span><strong class="source-inline"><span class="kobospan" id="kobo.977.1">22</span></strong><span class="kobospan" id="kobo.978.1"> from the Zabbix server, we’ll get a service </span><em class="italic"><span class="kobospan" id="kobo.979.1">down</span></em><span class="kobospan" id="kobo.980.1"> value. </span><span class="kobospan" id="kobo.980.2">However, this doesn’t necessarily mean that SSH isn’t running on the server; it simply means SSH is down as seen from the side of the Zabbix ser</span><a id="_idTextAnchor428" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.981.1">ver </span><span><span class="kobospan" id="kobo.982.1">or proxy:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer135">
<span class="kobospan" id="kobo.983.1"><img alt="Figure 3.39 – Zabbix server-to-host communication diagram" src="image/B19803_03_39.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.984.1">Figure 3.39 – Zabbix server-to-host communication diagram</span></p>
<p class="callout-heading"><span class="kobospan" id="kobo.985.1">Tip</span></p>
<p class="callout"><span class="kobospan" id="kobo.986.1">Keep in mind that working with simple checks is dependent on external factors such as the firewall settings on the monitored host. </span><span class="kobospan" id="kobo.986.2">When you build simple checks, make sure to check these factors </span><span><span class="kobospan" id="kobo.987.1">as well.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.988.1">There’s one more thing to note here. </span><span class="kobospan" id="kobo.988.2">In Zabbix 6.4, the ability to add simple checks without an interface on the host was added. </span><span class="kobospan" id="kobo.988.3">This means you can simply add the item with the connection details as parameters in the item key instead of selecting </span><span><span class="kobospan" id="kobo.989.1">an interface.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.990.1">Trapper</span><a id="_idTextAnchor429" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.991.1">s</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.992.1">When working with Zabbix sender, we are doing exactly the opposite of most checks – we are </span><a id="_idIndexMarker215" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.993.1">building an item on our Zabbix server, which allows us to capture trap items. </span><span class="kobospan" id="kobo.993.2">This allows us to build some custom checks so that we can send data to our Zabbix server from a </span><span><span class="kobospan" id="kobo.994.1">mo</span><a id="_idTextAnchor430" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.995.1">nitored host:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer136">
<span class="kobospan" id="kobo.996.1"><img alt="Figure 3.40 – Zabbix server trap receiver diagram" src="image/B19803_03_40.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.997.1">Figure 3.40 – Zabbix server trap receiver diagram</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.998.1">Let’s say, for instance, that we want to build a</span><a id="_idTextAnchor431" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.999.1"> custom Python script that, at the end of running the scripts, sends output to the Zabbix server. </span><span class="kobospan" id="kobo.999.2">We could ask Python to send this data using the Zabbix sender utility, at which point we’d have this data available for processing on the </span><span><span class="kobospan" id="kobo.1000.1">Zabbix server.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1001.1">This process is used by some companies who write software to completely integrate their software into Zabbix. </span><span class="kobospan" id="kobo.1001.2">As you can see, we can greatly extend our options with Zabbix trappers and customize our Zabbix server even further. </span><span class="kobospan" id="kobo.1001.3">Amazingly, this also works with low-level discovery, so long as we send the correct data </span><span><span class="kobospan" id="kobo.1002.1">fo</span><a id="_idTextAnchor432" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor433" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1003.1">rmats (JSON).</span></span></p>
<h1 id="_idParaDest-89" class="calibre5"><a id="_idTextAnchor434" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1004.1">Working with calculated and dependent items</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.1005.1">Calculated</span><a id="_idTextAnchor435" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1006.1"> and dependent items are used in Zabbix to produce add</span><a id="_idTextAnchor436" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1007.1">itional values from existing values. </span><span class="kobospan" id="kobo.1007.2">Sometimes, we have already collected a value and we need to do more with the values created by that item. </span><span class="kobospan" id="kobo.1007.3">We can do exactly that by using calculated and </span><span><span class="kobospan" id="kobo.1008.1">dep</span><a id="_idTextAnchor437" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor438" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1009.1">endent items.</span></span></p>
<h2 id="_idParaDest-90" class="calibre7"><a id="_idTextAnchor439" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1010.1">Getting ready</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1011.1">To work with calculated items and dependent items, we are going to need the Zabbix server and monitored hosts from the previous recipes. </span><span class="kobospan" id="kobo.1011.2">We will add the items to the </span><strong class="source-inline"><span class="kobospan" id="kobo.1012.1">lar-book-agent_passive</span></strong><span class="kobospan" id="kobo.1013.1"> host and our Zabbix server (or any MySQL server) host so that we already have some items available to calculate and </span><span><span class="kobospan" id="kobo.1014.1">ma</span><a id="_idTextAnchor440" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor441" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1015.1">ke dependent.</span></span></p>
<h2 id="_idParaDest-91" class="calibre7"><a id="_idTextAnchor442" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1016.1">How to do it…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1017.1">Let’s see how we can extend our items. </span><span class="kobospan" id="kobo.1017.2">We’ll start by looking at </span><span><span class="kobospan" id="kobo.1018.1">calculated items.</span></span></p>
</div>


<div id="_idContainer190" class="calibre2">
<h3 class="calibre8"><span class="kobospan" id="kobo.1019.1">Working with calculated items</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.1020.1">Follow </span><a id="_idIndexMarker216" class="pcalibre calibre6 pcalibre1"/><span><span class="kobospan" id="kobo.1021.1">these steps:</span></span></p>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.1022.1">Let’s navigate to our host configuration by going to </span><strong class="bold"><span class="kobospan" id="kobo.1023.1">Data collection</span></strong><span class="kobospan" id="kobo.1024.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.1025.1">Hosts</span></strong><span class="kobospan" id="kobo.1026.1"> and clicking on our </span><strong class="source-inline1"><span class="kobospan" id="kobo.1027.1">lar-book-agent_passive</span></strong><span class="kobospan" id="kobo.1028.1"> host’s </span><strong class="bold"><span class="kobospan" id="kobo.1029.1">Items</span></strong><span class="kobospan" id="kobo.1030.1"> area. </span><span class="kobospan" id="kobo.1030.2">In the </span><strong class="bold"><span class="kobospan" id="kobo.1031.1">Name</span></strong><span class="kobospan" id="kobo.1032.1"> filter field, enter </span><strong class="source-inline1"><span class="kobospan" id="kobo.1033.1">memory</span></strong><span class="kobospan" id="kobo.1034.1">; you will get the </span><span><span class="kobospan" id="kobo.1035.1">foll</span><a id="_idTextAnchor443" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1036.1">owing output:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer137">
<span class="kobospan" id="kobo.1037.1"><img alt="Figure 3.41 – Zabbix item page for lar-book-agent_passive" src="image/B19803_03_41.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1038.1">Figure 3.41 – Zabbix item page for lar-book-agent_passive</span></p>
<ol class="calibre16">
<li value="2" class="calibre15"><span class="kobospan" id="kobo.1039.1">Now, we can create a calculated item</span><a id="_idTextAnchor444" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1040.1"> that is going to show us the average memory utilization over 15 minutes. </span><span class="kobospan" id="kobo.1040.2">We can use this value to determine how busy our host was during that period, without having to look at </span><span><span class="kobospan" id="kobo.1041.1">the graphs.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1042.1">Let’s click the </span><strong class="bold"><span class="kobospan" id="kobo.1043.1">Create item</span></strong><span class="kobospan" id="kobo.1044.1"> button and start creating our new calculated item. </span><span class="kobospan" id="kobo.1044.2">We want our item to have the </span><span><span class="kobospan" id="kobo.1045.1">follo</span><a id="_idTextAnchor445" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1046.1">wing values:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer138">
<span class="kobospan" id="kobo.1047.1"><img alt="Figure 3.42 – Zabbix item configuration page, average memory used" src="image/B19803_03_42.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1048.1">Figure 3.42 – Zabbix item configuration page, average memory used</span></p>
<ol class="calibre16">
<li value="4" class="calibre15"><span class="kobospan" id="kobo.1049.1">Make sure </span><a id="_idIndexMarker217" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1050.1">you also navigate to the </span><strong class="bold"><span class="kobospan" id="kobo.1051.1">Tags</span></strong><span class="kobospan" id="kobo.1052.1"> tab and add a tag that we will use later </span><span><span class="kobospan" id="kobo.1053.1">fo</span><a id="_idTextAnchor446" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1054.1">r filtering:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer139">
<span class="kobospan" id="kobo.1055.1"><img alt="Figure 3.43 – Calculated item Tags tab" src="image/B19803_03_43.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1056.1">Figure 3.43 – Calculated item Tags tab</span></p>
<ol class="calibre16">
<li value="5" class="calibre15"><span class="kobospan" id="kobo.1057.1">Now, if we go to check our </span><strong class="bold"><span class="kobospan" id="kobo.1058.1">Monitoring</span></strong><span class="kobospan" id="kobo.1059.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.1060.1">Hosts</span></strong><span class="kobospan" id="kobo.1061.1"> page and select </span><strong class="bold"><span class="kobospan" id="kobo.1062.1">Latest data</span></strong><span class="kobospan" id="kobo.1063.1">,</span><a id="_idTextAnchor447" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1064.1"> we can check out our value. </span><span class="kobospan" id="kobo.1064.2">Make sure you filter t</span><a id="_idTextAnchor448" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1065.1">he </span><strong class="bold"><span class="kobospan" id="kobo.1066.1">Name</span></strong><span class="kobospan" id="kobo.1067.1"> field for </span><strong class="source-inline1"><span class="kobospan" id="kobo.1068.1">memory</span></strong><span class="kobospan" id="kobo.1069.1"> so that you see the </span><span><span class="kobospan" id="kobo.1070.1">corr</span><a id="_idTextAnchor449" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1071.1">ect values:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer140">
<span class="kobospan" id="kobo.1072.1"><img alt="Figure 3.44 – Zabbix Latest data page for lar-book-agent_passive, memory items" src="image/B19803_03_44.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1073.1">Figure 3.44 – Zabbix Latest data page for lar-book-agent_passive, memory items</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1074.1">As we can see, we are calculating the 15-minute average of the memory utilization on our newly </span><span><span class="kobospan" id="kobo.1075.1">created item.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.1076.1">Working with dependent items</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.1077.1">It’s time </span><a id="_idIndexMarker218" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1078.1">to m</span><a id="_idTextAnchor450" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1079.1">ake our first dependent item. </span><span class="kobospan" id="kobo.1079.2">I’ll use the </span><strong class="source-inline"><span class="kobospan" id="kobo.1080.1">lar-book-rocky</span></strong><span class="kobospan" id="kobo.1081.1"> host or our (as it’s called by default) </span><strong class="bold"><span class="kobospan" id="kobo.1082.1">Zabbix server</span></strong><span class="kobospan" id="kobo.1083.1"> host, but any MySQL </span><a id="_idIndexMarker219" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1084.1">database server should work. </span><span class="kobospan" id="kobo.1084.2">Let’s say we want to request some variables from our MySQL database in one big batch. </span><span class="kobospan" id="kobo.1084.3">In this case, we can create dependent items on top of the first item to further process </span><span><span class="kobospan" id="kobo.1085.1">the data:</span></span></p>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.1086.1">Let’s start by creating the main check. </span><span class="kobospan" id="kobo.1086.2">Navigate to </span><strong class="bold"><span class="kobospan" id="kobo.1087.1">Data collection</span></strong><span class="kobospan" id="kobo.1088.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.1089.1">Hosts</span></strong><span class="kobospan" id="kobo.1090.1">, select our host, and click the </span><strong class="bold"><span class="kobospan" id="kobo.1091.1">Create item</span></strong><span class="kobospan" id="kobo.1092.1"> button to start creating our first new item. </span><span class="kobospan" id="kobo.1092.2">We want an item with the </span><span><span class="kobospan" id="kobo.1093.1">followin</span><a id="_idTextAnchor451" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1094.1">g variables:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer141">
<span class="kobospan" id="kobo.1095.1"><img alt="Figure 3.45 – Zabbix item configuration page, database sta﻿tus" src="image/B19803_03_45.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1096.1">Figure 3.45 – Zabbix item configuration page, database sta</span><a id="_idTextAnchor452" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1097.1">tus</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1098.1">This item is </span><a id="_idIndexMarker220" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1099.1">an SSH check that logs in to our Zabbix server host using SSH and then executes the code that was entered in the </span><strong class="bold"><span class="kobospan" id="kobo.1100.1">Executed script</span></strong><span class="kobospan" id="kobo.1101.1"> field. </span><span class="kobospan" id="kobo.1101.2">This code will then log in to our MariaDB database and will print its status. </span><span class="kobospan" id="kobo.1101.3">Make sure you enter your </span><span><span class="kobospan" id="kobo.1102.1">credentials correctly.</span></span></p>
<p class="callout-heading"><span class="kobospan" id="kobo.1103.1">Tip</span></p>
<p class="callout"><span class="kobospan" id="kobo.1104.1">Instead of using plaintext credentials in the MySQL command, which is not recommended, use macros in the </span><strong class="bold"><span class="kobospan" id="kobo.1105.1">Executed script</span></strong><span class="kobospan" id="kobo.1106.1"> field. </span><span class="kobospan" id="kobo.1106.2">This way, you can use the </span><strong class="bold"><span class="kobospan" id="kobo.1107.1">Secret text</span></strong><span class="kobospan" id="kobo.1108.1"> macro type to make sure no one can read your password from </span><span><span class="kobospan" id="kobo.1109.1">the frontend.</span></span><a id="_idTextAnchor453" class="pcalibre calibre6 pcalibre1"/></p>
<ol class="calibre16">
<li value="2" class="calibre15"><span class="kobospan" id="kobo.1110.1">Before saving this new item, make sure you also add a tag</span><a id="_idTextAnchor454" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1111.1">, </span><span><span class="kobospan" id="kobo.1112.1">like this:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer142">
<span class="kobospan" id="kobo.1113.1"><img alt="Figure 3.46 – Zabbix master item configuration page, Tags tab" src="image/B19803_03_46.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1114.1">Figure 3.46 – Zabbix master item configuration page, Tags tab</span></p>
<ol class="calibre16">
<li value="3" class="calibre15"><span class="kobospan" id="kobo.1115.1">Now, click the blue </span><strong class="bold"><span class="kobospan" id="kobo.1116.1">Add</span></strong><span class="kobospan" id="kobo.1117.1"> button to save this </span><span><span class="kobospan" id="kobo.1118.1">new item.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1119.1">Go back to </span><a id="_idIndexMarker221" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1120.1">the list of items and click on this host’s hostname, then </span><strong class="bold"><span class="kobospan" id="kobo.1121.1">Macros</span></strong><span class="kobospan" id="kobo.1122.1">. </span><span class="kobospan" id="kobo.1122.2">Create a new </span><strong class="source-inline1"><span class="kobospan" id="kobo.1123.1">{$USERNAME}</span></strong><span class="kobospan" id="kobo.1124.1"> and </span><strong class="source-inline1"><span class="kobospan" id="kobo.1125.1">{$PASSWORD}</span></strong><span class="kobospan" id="kobo.1126.1"> macro with your SSH username and password </span><span><span class="kobospan" id="kobo.1127.1">under </span></span><span><strong class="bold"><span class="kobospan" id="kobo.1128.1">Value</span></strong></span><span><span class="kobospan" id="kobo.1129.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1130.1">Next, go to </span><strong class="bold"><span class="kobospan" id="kobo.1131.1">Monitoring</span></strong><span class="kobospan" id="kobo.1132.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.1133.1">Latest data</span></strong><span class="kobospan" id="kobo.1134.1"> and check out the data for our new check. </span><span class="kobospan" id="kobo.1134.2">There should be a long list of MariaDB values. </span><span class="kobospan" id="kobo.1134.3">If so, we can continue creating the </span><span><span class="kobospan" id="kobo.1135.1">dependent item.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1136.1">To create the dependent item, navigate to </span><strong class="bold"><span class="kobospan" id="kobo.1137.1">Data collection</span></strong><span class="kobospan" id="kobo.1138.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.1139.1">Hosts</span></strong><span class="kobospan" id="kobo.1140.1">, select our host, and click the </span><strong class="bold"><span class="kobospan" id="kobo.1141.1">Create item</span></strong><span class="kobospan" id="kobo.1142.1"> button. </span><span class="kobospan" id="kobo.1142.2">We want this item to have the </span><span><span class="kobospan" id="kobo.1143.1">followin</span><a id="_idTextAnchor455" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1144.1">g variables:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer143">
<span class="kobospan" id="kobo.1145.1"><img alt="Figure 3.47 – Zabbix item configuration page, MariaDB aborted clients" src="image/B19803_03_47.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1146.1">Figure 3.47 – Zabbix item configuration page, MariaDB aborted clients</span></p>
<ol class="calibre16">
<li value="7" class="calibre15"><span class="kobospan" id="kobo.1147.1">Make</span><a id="_idTextAnchor456" class="pcalibre calibre6 pcalibre1"/> <a id="_idIndexMarker222" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1148.1">sure you add </span><a id="_idIndexMarker223" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1149.1">the </span><span><span class="kobospan" id="kobo.1150.1">fo</span><a id="_idTextAnchor457" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1151.1">llowing tag:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer144">
<span class="kobospan" id="kobo.1152.1"><img alt="Figure 3.48 – Zabbix dependent item configuration page, Tags tab" src="image/B19803_03_48.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1153.1">Figure 3.48 – Zabbix dependent item configuration page, Tags tab</span></p>
<ol class="calibre16">
<li value="8" class="calibre15"><span class="kobospan" id="kobo.1154.1">It’s very important to add preprocessing to this item; otherwise, we will simply get the same data as our master item. </span><span class="kobospan" id="kobo.1154.2">So, let’s add </span><span><span class="kobospan" id="kobo.1155.1">th</span><a id="_idTextAnchor458" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1156.1">e following:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer145">
<span class="kobospan" id="kobo.1157.1"><img alt="Figure 3.49 – Zabbix item Preprocessing page, MariaDB aborted clients" src="image/B19803_03_49.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1158.1">Figure 3.49 – Zabbix item Preprocessing page, MariaDB aborted clients</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1159.1">With the preprocessing added, the result will be the number of aborted clients for our </span><span><span class="kobospan" id="kobo.1160.1">MariaD</span><a id="_idTextAnchor459" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1161.1">B instance:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer146">
<span class="kobospan" id="kobo.1162.1"><img alt="Figure 3.50 – Zabbix Latest data page, MariaDB aborted clients" src="image/B19803_03_50.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1163.1">Figure 3.50 – Zabbix Latest data page, MariaDB aborted clients</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1164.1">As you ca</span><a id="_idTextAnchor460" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1165.1">n see, using a dependent item, we can use already available information from other Zabbix items and split them up into </span><span><span class="kobospan" id="kobo.1166.1">depen</span><a id="_idTextAnchor461" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor462" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1167.1">dent items.</span></span></p>
<h2 id="_idParaDest-92" class="calibre7"><a id="_idTextAnchor463" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1168.1">How it works…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1169.1">The calculated and dependent items we worked with in the </span><em class="italic"><span class="kobospan" id="kobo.1170.1">How to do it…</span></em><span class="kobospan" id="kobo.1171.1"> section can be quite complicated, so let’s go over how </span><span><span class="kobospan" id="kobo.1172.1">they work.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.1173.1">Calculated items</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.1174.1">Working with </span><a id="_idIndexMarker224" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1175.1">cal</span><a id="_idTextAnchor464" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1176.1">culated items can be a great way to get even more statistics out of your existing data. </span><span class="kobospan" id="kobo.1176.2">Sometimes, you just need to combine multiple items into one </span><span><span class="kobospan" id="kobo.1177.1">specific value.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1178.1">What we did just now works by taking several values of one item every 15 minutes and calculating the average, </span><a id="_idTextAnchor465" class="pcalibre calibre6 pcalibre1"/><span><span class="kobospan" id="kobo.1179.1">as follows:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer147">
<span class="kobospan" id="kobo.1180.1"><img alt="Figure 3.51 – Zabbix dependent item diagram" src="image/B19803_03_51.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1181.1">Figure 3.51 – Zabbix dependent item diagram</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1182.1">We’re t</span><a id="_idTextAnchor466" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1183.1">aking those values and calculating the average every 15 minutes. </span><span class="kobospan" id="kobo.1183.2">It gives us a nice indication of what we are doing over a </span><span><span class="kobospan" id="kobo.1184.1">set period.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.1185.1">Dependent items</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.1186.1">Dep</span><a id="_idTextAnchor467" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1187.1">endent items </span><a id="_idIndexMarker225" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1188.1">work by taking the data from a master item and processing that data into other data. </span><span class="kobospan" id="kobo.1188.2">This way, we can structure our data and keep our check interval for all these items the same since the dependent items will receive their data on the update interval as the master item. </span><span class="kobospan" id="kobo.1188.3">That means that dependent items don’t have (and don’t need) an </span><span><span class="kobospan" id="kobo.1189.1">updat</span><a id="_idTextAnchor468" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1190.1">e interval:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer148">
<span class="kobospan" id="kobo.1191.1"><img alt="Figure 3.52 – Dependent item diagram" src="image/B19803_03_52.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1192.1">Figure 3.52 – Dependent item diagram</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1193.1">As we can see, dependent items work as duplicators, on which we use preprocessing options to </span><a id="_idIndexMarker226" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1194.1">get specific values. </span><span class="kobospan" id="kobo.1194.2">Note that </span><a id="_idTextAnchor469" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1195.1">preprocessing must be used to extract data from the master items since without preprocessing, our data will be the same as it is for the </span><span><span class="kobospan" id="kobo.1196.1">master item.</span></span></p>
<p class="callout-heading"><span class="kobospan" id="kobo.1197.1">Tip</span></p>
<p class="callout"><span class="kobospan" id="kobo.1198.1">Often, we don’t require our master item to be saved in our database since we already have the information in our dependent items. </span><span class="kobospan" id="kobo.1198.2">When we don’t want the master item to be saved, we can simply select the </span><strong class="bold"><span class="kobospan" id="kobo.1199.1">Do not keep history</span></strong><span class="kobospan" id="kobo.1200.1"> option on that master item. </span><span class="kobospan" id="kobo.1200.2">This will save us some </span><span><span class="kobospan" id="kobo.1201.1">st</span><a id="_idTextAnchor470" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor471" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1202.1">orage space.</span></span></p>
<h1 id="_idParaDest-93" class="calibre5"><a id="_idTextAnchor472" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1203.1">Creating external checks</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.1204.1">To further </span><a id="_idIndexMarker227" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1205.1">extend our Zabbix functionality, we </span><a id="_idTextAnchor473" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1206.1">can use custom scripts that can be executed as Zabbix external checks. </span><span class="kobospan" id="kobo.1206.2">Not everything that we want to monitor will always be standard in Zabbix, although a lot is. </span><span class="kobospan" id="kobo.1206.3">There’s always something that could be missing, and external checks are just a way to bypass s</span><a id="_idTextAnchor474" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor475" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1207.1">ome </span><span><span class="kobospan" id="kobo.1208.1">of these.</span></span></p>
<h2 id="_idParaDest-94" class="calibre7"><a id="_idTextAnchor476" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1209.1">Getting ready</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1210.1">In this recipe, we are going to need just our Zabbix server. </span><span class="kobospan" id="kobo.1210.2">We can create an item on our </span><strong class="source-inline"><span class="kobospan" id="kobo.1211.1">lar-book-rocky</span></strong><span class="kobospan" id="kobo.1212.1"> host, which is our Zabbix </span><span><span class="kobospan" id="kobo.1213.1">server-mo</span><a id="_idTextAnchor477" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor478" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1214.1">nitored host.</span></span></p>
<h2 id="_idParaDest-95" class="calibre7"><a id="_idTextAnchor479" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1215.1">How to do it…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1216.1">Follow </span><span><span class="kobospan" id="kobo.1217.1">these steps:</span></span></p>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.1218.1">First, let’s make </span><a id="_idIndexMarker228" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1219.1">sure our Zabbix server configuration is set up correctly. </span><span class="kobospan" id="kobo.1219.2">Execute the following on the Zabbix </span><span><span class="kobospan" id="kobo.1220.1">server CLI:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.1221.1">cat /etc/zabbix/zabbix_server.conf | grep ExternalScripts=</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.1222.1">This should show us the path where we will place the script that’s used by the Zabbix external check. </span><span class="kobospan" id="kobo.1222.2">By default, this is </span><strong class="source-inline1"><span class="kobospan" id="kobo.1223.1">/usr/lib/zabbix/ externalscripts/</span></strong><span class="kobospan" id="kobo.1224.1">. </span><span class="kobospan" id="kobo.1224.2">Let’s create a new script called </span><strong class="source-inline1"><span class="kobospan" id="kobo.1225.1">test_external</span></strong><span class="kobospan" id="kobo.1226.1"> in this folder with the </span><span><span class="kobospan" id="kobo.1227.1">following command:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.1228.1">vim /usr/lib/zabbix/externalscripts/test_external</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.1229.1">Add the following code to this file and </span><span><span class="kobospan" id="kobo.1230.1">save it:</span></span></p><pre class="source-code"><span class="kobospan1" id="kobo.1231.1">#!/bin/bash
echo $1</span></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.1232.1">Make sure ou</span><a id="_idTextAnchor480" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1233.1">r Zabbix server can execute the script by adding the right permissions to the file. </span><span class="kobospan" id="kobo.1233.2">The </span><strong class="source-inline1"><span class="kobospan" id="kobo.1234.1">zabbix</span></strong><span class="kobospan" id="kobo.1235.1"> user on your Linux server needs to be able to access and execute </span><span><span class="kobospan" id="kobo.1236.1">the file:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.1237.1">chmod +x /usr/lib/zabbix/externalscripts/test_external</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.1238.1">chown zabbix:zabbix /usr/lib/zabbix/externalscripts/test_external</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.1239.1">Now, we are ready to go to our host to create a new item. </span><span class="kobospan" id="kobo.1239.2">Navigate to </span><strong class="bold"><span class="kobospan" id="kobo.1240.1">Data collection</span></strong><span class="kobospan" id="kobo.1241.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.1242.1">Hosts</span></strong><span class="kobospan" id="kobo.1243.1">, select our host, </span><strong class="source-inline1"><span class="kobospan" id="kobo.1244.1">lar-book-rocky</span></strong><span class="kobospan" id="kobo.1245.1">, and click the </span><strong class="bold"><span class="kobospan" id="kobo.1246.1">Create item</span></strong><span class="kobospan" id="kobo.1247.1"> button. </span><span class="kobospan" id="kobo.1247.2">We want this item to be create</span><a id="_idTextAnchor481" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1248.1">d </span><span><span class="kobospan" id="kobo.1249.1">as follows:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer149">
<span class="kobospan" id="kobo.1250.1"><img alt="Figure 3.53 – Zabbix item configuration page" src="image/B19803_03_53.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1251.1">Figure 3.53 – Zabbix item configuration page</span></p>
<ol class="calibre16">
<li value="5" class="calibre15"><span class="kobospan" id="kobo.1252.1">Now that </span><a id="_idIndexMarker229" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1253.1">we’ve added this new item, let’s navigate to </span><strong class="bold"><span class="kobospan" id="kobo.1254.1">Monitoring</span></strong><span class="kobospan" id="kobo.1255.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.1256.1">Hosts</span></strong><span class="kobospan" id="kobo.1257.1"> and check the </span><strong class="bold"><span class="kobospan" id="kobo.1258.1">Latest data</span></strong><span class="kobospan" id="kobo.1259.1"> page for our host. </span><span class="kobospan" id="kobo.1259.2">Our </span><strong class="bold"><span class="kobospan" id="kobo.1260.1">Test</span></strong><span class="kobospan" id="kobo.1261.1"> variable should be returned by our script as </span><strong class="bold"><span class="kobospan" id="kobo.1262.1">Last value</span></strong><span class="kobospan" id="kobo.1263.1"> in Zabbix, as shown in the </span><span><span class="kobospan" id="kobo.1264.1">followin</span><a id="_idTextAnchor482" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1265.1">g screenshot:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer150">
<span class="kobospan" id="kobo.1266.1"><img alt="Figure 3.54 – Zabbix Latest data page" src="image/B19803_03_54.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1267.1">Figure 3.54 – Zabbix Latest data page</span></p>
<p class="callout-heading"><span class="kobospan" id="kobo.1268.1">Tip</span></p>
<p class="callout"><span class="kobospan" id="kobo.1269.1">Use the macros in the frontend as variables to send data from your frontend to your scripts. </span><span class="kobospan" id="kobo.1269.2">You can further automate your checks with this to enhance your </span><span><span class="kobospan" id="kobo.1270.1">ext</span><a id="_idTextAnchor483" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor484" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1271.1">ernal checks.</span></span></p>
<h2 id="_idParaDest-96" class="calibre7"><a id="_idTextAnchor485" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1272.1">How it works…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1273.1">External checks seem like they have a steep learning curve, but they are quite simple from the </span><a id="_idIndexMarker230" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1274.1">Zabbix side. </span><span class="kobospan" id="kobo.1274.2">All we do is execute an external script, at which point we will receive the standard result output (</span><strong class="source-inline"><span class="kobospan" id="kobo.1275.1">STDOUT</span></strong><span class="kobospan" id="kobo.1276.1">) and </span><span><span class="kobospan" id="kobo.1277.1">er</span><a id="_idTextAnchor486" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1278.1">ror (</span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.1279.1">STDERR</span></strong></span><span><span class="kobospan" id="kobo.1280.1">):</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer151">
<span class="kobospan" id="kobo.1281.1"><img alt="Figure 3.55 – Zabbix server external script communication diagram" src="image/B19803_03_55.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1282.1">Figure 3.55 – Zabbix server external script communication diagram</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1283.1">In our example, we sent a value of </span><strong class="source-inline"><span class="kobospan" id="kobo.1284.1">Test</span></strong><span class="kobospan" id="kobo.1285.1"> to our script, which the script then echoed back to us </span><span><span class="kobospan" id="kobo.1286.1">as </span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.1287.1">$1</span></strong></span><span><span class="kobospan" id="kobo.1288.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1289.1">When you have good knowledge of a programming language such as Python, you can use this function to build a lot more expansions on top of the current existing Zabbix feature set – a simple yet powerful tool </span><a id="_idTextAnchor487" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor488" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1290.1">to </span><span><span class="kobospan" id="kobo.1291.1">work with.</span></span></p>
<h1 id="_idParaDest-97" class="calibre5"><a id="_idTextAnchor489" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1292.1">Setting up JMX monitoring</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.1293.1">Zabbix has </span><a id="_idIndexMarker231" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1294.1">JMX monitoring built into it so that</span><a id="_idTextAnchor490" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1295.1"> we can monitor our Java applications. </span><span class="kobospan" id="kobo.1295.2">In this recipe, we’ll learn how to monitor Apache Tomcat with Zabbix JMX so that we can get a feel for what this monitoring option</span><a id="_idTextAnchor491" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor492" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1296.1"> is </span><span><span class="kobospan" id="kobo.1297.1">all about.</span></span></p>
<h2 id="_idParaDest-98" class="calibre7"><a id="_idTextAnchor493" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1298.1">Getting ready</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1299.1">To get ready for this recipe, we are going to need our Zabbix server so that we can monitor our </span><span><span class="kobospan" id="kobo.1300.1">JMX application.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1301.1">I used a CentOS 7 machine for this recipe, with Tomcat installed. </span><span class="kobospan" id="kobo.1301.2">It can be quite tricky to use Tomcat on later CentOS versions due to package dependencies, so I recommend sticking with CentOS 7 for this example. </span><span class="kobospan" id="kobo.1301.3">You can add the following to your Tomcat configuration after installing it to get it working for </span><span><span class="kobospan" id="kobo.1302.1">this recipe:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.1303.1">
JAVA_OPTS="-Djava.rmi.server.hostname=10.16.16.155
-Dcom.sun.management.jmxremote
-Dcom.sun.management.jmxremote.port=12345
-Dcom.sun.management.jmxremote.authenticate=false
-Dcom.sun.management.jmxremote.ssl=false"</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.1304.1">If you want to set up JMX monitoring in your production environment, you can use the settings you have probably already set up there. </span><span class="kobospan" id="kobo.1304.2">Simply change the port and IP </span><span><span class="kobospan" id="kobo.1305.1">addres</span><a id="_idTextAnchor494" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor495" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1306.1">s accordingly.</span></span></p>
<h2 id="_idParaDest-99" class="calibre7"><a id="_idTextAnchor496" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1307.1">How to do it…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1308.1">To set up JMX </span><a id="_idIndexMarker232" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1309.1">monitoring, we are going to add a host to our Zabbix server that will monitor our Apache Tomcat installation. </span><span class="kobospan" id="kobo.1309.2">But first, we will need to add some settings to our </span><strong class="source-inline"><span class="kobospan" id="kobo.1310.1">/</span></strong><span><strong class="source-inline"><span class="kobospan" id="kobo.1311.1">etc/zabbix/zabbix_server.conf</span></strong></span><span><span class="kobospan" id="kobo.1312.1"> file:</span></span></p>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.1313.1">Let’s edit the </span><strong class="source-inline1"><span class="kobospan" id="kobo.1314.1">zabbix_server.conf</span></strong><span class="kobospan" id="kobo.1315.1"> file by logging in to our Zabbix server and executing the </span><span><span class="kobospan" id="kobo.1316.1">following command:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.1317.1">vim /etc/zabbix/zabbix_server.conf</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.1318.1">Now, we need to add the following lines to </span><span><span class="kobospan" id="kobo.1319.1">this file:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.1320.1">
JavaGateway=127.0.0.1
StartJavaPollers=5</span></pre></li> </ol>
<p class="callout-heading"><span class="kobospan" id="kobo.1321.1">Tip</span></p>
<p class="callout"><span class="kobospan" id="kobo.1322.1">It’s possible to install your Java gateway on a host that’s separate from your Zabbix. </span><span class="kobospan" id="kobo.1322.2">This way, you can spread the load and scale more. </span><span class="kobospan" id="kobo.1322.3">Simply install it on a separate host and add the IP address of that host to the </span><strong class="source-inline1"><span class="kobospan" id="kobo.1323.1">JavaGateway</span></strong><span class="kobospan" id="kobo.1324.1"> parameter. </span><span class="kobospan" id="kobo.1324.2">So long as your Zabbix server or proxy can reach the gateway on port </span><strong class="source-inline1"><span class="kobospan" id="kobo.1325.1">10052</span></strong><span class="kobospan" id="kobo.1326.1"> over the network, this should work. </span><span class="kobospan" id="kobo.1326.2">We won’t be doing this in this example, so keep the Java gateway set up on the Zabbix server </span><span><span class="kobospan" id="kobo.1327.1">host itself.</span></span></p>
<ol class="calibre16">
<li value="3" class="calibre15"><span class="kobospan" id="kobo.1328.1">We will also need to install the </span><strong class="source-inline1"><span class="kobospan" id="kobo.1329.1">zabbix-java-gateway</span></strong><span class="kobospan" id="kobo.1330.1"> application on o</span><a id="_idTextAnchor497" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1331.1">ur Zabbix server with the </span><span><span class="kobospan" id="kobo.1332.1">following command.</span></span><p class="calibre3"><span><span class="kobospan" id="kobo.1333.1">RHEL-based systems:</span></span></p><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.1334.1">dnf install zabbix-java-gateway</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.1335.1">systemctl enable zabbix-java-gateway</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.1336.1">systemctl start zabbix-java-gateway</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.1337.1">systemctl restart zabbix-server</span></strong></pre><p class="calibre3"><span><span class="kobospan" id="kobo.1338.1">Ubuntu </span></span><span><a id="_idIndexMarker233" class="pcalibre calibre6 pcalibre1"/></span><span><span class="kobospan" id="kobo.1339.1">systems:</span></span></p><pre class="source-code"><strong class="bold1"><span class="kobospan1" id="kobo.1340.1">apt install zabbix-java-gateway</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.1341.1">systemctl enable zabbix-java-gateway</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.1342.1">systemctl start zabbix-java-gateway</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.1343.1">systemctl restart zabbix-server</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.1344.1">That is all we need to do on the server side of things to get JMX monitoring to work. </span><span class="kobospan" id="kobo.1344.2">Zabbix doesn’t include these settings by default, so we need to add the respective text to our file and install </span><span><span class="kobospan" id="kobo.1345.1">the application.</span></span></p></li> <li class="calibre15"><span class="kobospan" id="kobo.1346.1">To start monitoring our JMX host, go to </span><strong class="bold"><span class="kobospan" id="kobo.1347.1">Data collection</span></strong><span class="kobospan" id="kobo.1348.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.1349.1">Hosts</span></strong><span class="kobospan" id="kobo.1350.1"> in your Zabbix frontend and click </span><strong class="bold"><span class="kobospan" id="kobo.1351.1">Create host</span></strong><span class="kobospan" id="kobo.1352.1"> in the </span><span><span class="kobospan" id="kobo.1353.1">top-right corner.</span></span><p class="calibre3"><span class="kobospan" id="kobo.1354.1">Add a host with the </span><span><span class="kobospan" id="kobo.1355.1">foll</span><a id="_idTextAnchor498" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1356.1">owing settings:</span></span></p></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer152">
<span class="kobospan" id="kobo.1357.1"><img alt="Figure 3.56 – Zabbix item configuration page" src="image/B19803_03_56.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1358.1">Figure 3.56 – Zabbix item configuration page</span></p>
<ol class="calibre16">
<li value="5" class="calibre15"><span class="kobospan" id="kobo.1359.1">After th</span><a id="_idTextAnchor499" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1360.1">is, our </span><a id="_idIndexMarker234" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1361.1">JMX icon should turn green; let’s check this under </span><strong class="bold"><span class="kobospan" id="kobo.1362.1">Monitoring</span></strong><span class="kobospan" id="kobo.1363.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.1364.1">Hosts</span></strong><span class="kobospan" id="kobo.1365.1">. </span><span class="kobospan" id="kobo.1365.2">It should </span><a id="_idTextAnchor500" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1366.1">look </span><span><span class="kobospan" id="kobo.1367.1">like this:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer153">
<span class="kobospan" id="kobo.1368.1"><img alt="Figure 3.57 – Monitoring | Hosts" src="image/B19803_03_57.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1369.1">Figure 3.57 – Monitoring | Hosts</span></p>
<ol class="calibre16">
<li value="6" class="calibre15"><span class="kobospan" id="kobo.1370.1">If we click on </span><strong class="bold"><span class="kobospan" id="kobo.1371.1">Latest data</span></strong><span class="kobospan" id="kobo.1372.1"> for our new JMX-monitored host, we should also see our incoming data. </span><span class="kobospan" id="kobo.1372.2">Check it out; it should return sta</span><a id="_idTextAnchor501" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1373.1">ts </span><span><span class="kobospan" id="kobo.1374.1">like these:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer154">
<span class="kobospan" id="kobo.1375.1"><img alt="Figure 3.58 – Zabbix La﻿﻿test data page" src="image/B19803_03_58.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1376.1">Figure 3.58 – Zabbix La</span><a id="_idTextAnchor502" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor503" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1377.1">test data page</span></p>
<h2 id="_idParaDest-100" class="calibre7"><a id="_idTextAnchor504" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1378.1">How it works…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1379.1">Zabbix utilizes</span><a id="_idTextAnchor505" class="pcalibre calibre6 pcalibre1"/> <a id="_idIndexMarker235" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1380.1">a Java gateway either hosted on the Zabbix server itself or hosted on another server (proxy) to monitor </span><span><span class="kobospan" id="kobo.1381.1">JMX</span><a id="_idTextAnchor506" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1382.1"> applications:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer155">
<span class="kobospan" id="kobo.1383.1"><img alt="Figure 3.59 – Communication diagram between the Zabbix server and Java" src="image/B19803_03_59.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1384.1">Figure 3.59 – Communication diagram between the Zabbix server and Java</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1385.1">Zabbix polls the Java gateway and the Java gateway, in turn, communicates with our JMX application, as it does with Tomcat in our example. </span><span class="kobospan" id="kobo.1385.2">The data is then returned through the same path, at which point we can see our data in our </span><a id="_idTextAnchor507" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor508" class="pcalibre calibre6 pcalibre1"/><span><span class="kobospan" id="kobo.1386.1">Zabbix server.</span></span></p>
<h2 id="_idParaDest-101" class="calibre7"><a id="_idTextAnchor509" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1387.1">See also</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1388.1">There are loads of applications that can be monitored through Zabbix JMX. </span><span class="kobospan" id="kobo.1388.2">Check out the Zabbix </span><a id="_idIndexMarker236" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1389.1">monitoring </span><a id="_idTextAnchor510" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1390.1">and integrations page for more uses of Zabbix JMX </span><span><span class="kobospan" id="kobo.1391.1">monitoring: </span></span><a href="https://www.zabbix.com/integrations/jmx" class="pcalibre calibre6 pcalibre1"><span><span class="kobospan" id="kobo.1392.1">https://www.zabbix.com/integrations/jmx</span></span></a><span><span class="kobospan" id="kobo.1393.1">.</span></span></p>
<h1 id="_idParaDest-102" class="calibre5"><a id="_idTextAnchor511" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1394.1">Setting up database monitoring</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.1395.1">Datab</span><a id="_idTextAnchor512" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1396.1">ases are </span><a id="_idIndexMarker237" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1397.1">a black hole to a lot of engineers; data is being written to them and something is being done with this data. </span><span class="kobospan" id="kobo.1397.2">But what if you want to know more about the health of your database? </span><span class="kobospan" id="kobo.1397.3">That’s where Zabbix database monitoring comes in – we can use it to monitor the health </span><a id="_idTextAnchor513" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor514" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1398.1">of </span><span><span class="kobospan" id="kobo.1399.1">our database.</span></span></p>
<h2 id="_idParaDest-103" class="calibre7"><a id="_idTextAnchor515" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1400.1">Getting ready</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1401.1">For convenience, in this recipe, we’ll be monitoring our Zabbix database. </span><span class="kobospan" id="kobo.1401.2">This means that all we are going to need is our installed Zabbix server with our database on it. </span><span class="kobospan" id="kobo.1401.3">We’ll be using MariaDB in this example, so if you have a PostgreSQL setup, make sure you install a MariaDB instance on a Linux host (although the same kind of setup could be created on PostgreSQL if you change some of the </span><span><span class="kobospan" id="kobo.1402.1">O</span><a id="_idTextAnchor516" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor517" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1403.1">DBC parameters).</span></span></p>
<h2 id="_idParaDest-104" class="calibre7"><a id="_idTextAnchor518" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1404.1">How to do it…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1405.1">Before getting </span><a id="_idIndexMarker238" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1406.1">sta</span><a id="_idTextAnchor519" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1407.1">rted with the item configuration, we’ll have to do some stuff on the CLI side of </span><span><span class="kobospan" id="kobo.1408.1">the server:</span></span></p>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.1409.1">Let’s start by installing the required modules on </span><span><span class="kobospan" id="kobo.1410.1">our server.</span></span><p class="calibre3"><span><span class="kobospan" id="kobo.1411.1">RHEL-based systems:</span></span></p><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.1412.1">dnf install unixODBC mariadb-connector-odbc</span></strong></pre><p class="calibre3"><span><span class="kobospan" id="kobo.1413.1">Ubuntu systems:</span></span></p><pre class="source-code"><strong class="bold1"><span class="kobospan1" id="kobo.1414.1">apt install odbc-mariadb unixodbc unixodbc-dev odbcinst</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.1415.1">Now, let’s </span><a id="_idIndexMarker239" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1416.1">verify whether our </span><strong class="bold"><span class="kobospan" id="kobo.1417.1">Open Database Connectivity</span></strong><span class="kobospan" id="kobo.1418.1"> (</span><a id="_idTextAnchor520" class="pcalibre calibre6 pcalibre1"/><strong class="bold"><span class="kobospan" id="kobo.1419.1">ODBC</span></strong><span class="kobospan" id="kobo.1420.1">) configuration </span><span><span class="kobospan" id="kobo.1421.1">files exist:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.1422.1">odbcinst -j</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.1423.1">Your output should look similar </span><span><span class="kobospan" id="kobo.1424.1">to this:</span></span></p><pre class="source-code"><strong class="bold1"><span class="kobospan1" id="kobo.1425.1">unixODBC 2.3.7</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.1426.1">DRIVERS............: /etc/odbcinst.ini</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.1427.1">SYSTEM DATA SOURCES: /etc/odbc.ini</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.1428.1">FILE DATA SOURCES..: /etc/ODBCDataSources</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.1429.1">USER DATA SOURCES..: /root/.odbc.ini</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.1430.1">SQLULEN Size.......: 8</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.1431.1">SQLLEN Size........: 8</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.1432.1">SQLSETPOSIROW Size.: 8</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.1433.1">If the output is correct, we can go to the Linux CLI and continue by editing </span><strong class="source-inline1"><span class="kobospan" id="kobo.1434.1">odbc.ini</span></strong><span class="kobospan" id="kobo.1435.1"> so that we can connect to </span><span><span class="kobospan" id="kobo.1436.1">our database:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.1437.1">vim /etc/odbc.ini</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.1438.1">Now, fill in your Zabbix database information. </span><span class="kobospan" id="kobo.1438.2">It will look </span><span><span class="kobospan" id="kobo.1439.1">like this:</span></span></p><pre class="source-code"><strong class="bold1"><span class="kobospan1" id="kobo.1440.1">[book]</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.1441.1">Description = MySQL book test database</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.1442.1">Driver      = MariaDB</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.1443.1">Server      = 127.0.0.1</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.1444.1">Port        = 3306</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.1445.1">Database    = zabbix</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.1446.1">Let’s also </span><a id="_idIndexMarker240" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1447.1">check that our </span><span><span class="kobospan" id="kobo.1448.1">driver exists:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.1449.1">vim /etc/odbc.ini</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.1450.1">You should see </span><span><span class="kobospan" id="kobo.1451.1">the driver:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.1452.1"># Driver from the mariadb-connector-odbc package</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.1453.1"># Setup from the unixODBC package</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.1454.1">[MariaDB]</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.1455.1">Description     = ODBC for MariaDB</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.1456.1">Driver          = /usr/lib/libmaodbc.so</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.1457.1">Driver64        = /usr/lib64/libmaodbc.so</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.1458.1">FileUsage       = 1</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.1459.1">Now, let’s test wh</span><a id="_idTextAnchor521" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1460.1">ether our connection is working as expected by executing the </span><span><span class="kobospan" id="kobo.1461.1">following command:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.1462.1">isql -v book</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.1463.1">You should get a message saying </span><strong class="source-inline"><span class="kobospan" id="kobo.1464.1">Connected</span></strong><span class="kobospan" id="kobo.1465.1">; if you don’t, check your configuration files and </span><span><span class="kobospan" id="kobo.1466.1">try again.</span></span></p></li> <li class="calibre15"><span class="kobospan" id="kobo.1467.1">Now, let’s move to the Zabbix frontend to configure our first database check. </span><span class="kobospan" id="kobo.1467.2">Navigate to </span><strong class="bold"><span class="kobospan" id="kobo.1468.1">Data collection</span></strong><span class="kobospan" id="kobo.1469.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.1470.1">Hosts</span></strong><span class="kobospan" id="kobo.1471.1"> and click the </span><strong class="source-inline1"><span class="kobospan" id="kobo.1472.1">lar-book-rocky</span></strong><span class="kobospan" id="kobo.1473.1"> host; note </span><a id="_idIndexMarker241" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1474.1">that it might still be called </span><strong class="bold"><span class="kobospan" id="kobo.1475.1">Zabbix server</span></strong><span class="kobospan" id="kobo.1476.1">. </span><span class="kobospan" id="kobo.1476.2">Now go to </span><strong class="bold"><span class="kobospan" id="kobo.1477.1">Items</span></strong><span class="kobospan" id="kobo.1478.1">; we want to create a new item here by clicking the </span><strong class="bold"><span class="kobospan" id="kobo.1479.1">Create </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.1480.1">item</span></strong></span><span><span class="kobospan" id="kobo.1481.1"> button.</span></span></li>
</ol>
<p class="callout-heading"><span class="kobospan" id="kobo.1482.1">Tip</span></p>
<p class="callout"><span class="kobospan" id="kobo.1483.1">If you haven’t already, a great way to keep Zabbix structured is to keep all hostnames in Zabbix equal to the real server hostname. </span><span class="kobospan" id="kobo.1483.2">Rename your default </span><strong class="bold"><span class="kobospan" id="kobo.1484.1">Zabbix server</span></strong><span class="kobospan" id="kobo.1485.1"> host in the frontend to what you’ve called </span><span><span class="kobospan" id="kobo.1486.1">your server.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1487.1">We want to add an item with the </span><span><span class="kobospan" id="kobo.1488.1">fo</span><a id="_idTextAnchor522" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1489.1">llowing parameters:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer156">
<span class="kobospan" id="kobo.1490.1"><img alt="Figure 3.60 – Zabbix item configuration page, items in Zabbix database" src="image/B19803_03_60.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1491.1">Figure 3.60 – Zabbix item configuration page, items in Zabbix database</span></p>
<ol class="calibre16">
<li value="8" class="calibre15"><span class="kobospan" id="kobo.1492.1">Mak</span><a id="_idTextAnchor523" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1493.1">e </span><a id="_idIndexMarker242" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1494.1">sure you also add</span><a id="_idTextAnchor524" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1495.1"> a tag to </span><span><span class="kobospan" id="kobo.1496.1">the item:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer157">
<span class="kobospan" id="kobo.1497.1"><img alt="Figure 3.61 – Zabbix item configuration page, items in Zabbix database, Tags tab" src="image/B19803_03_61.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1498.1">Figure 3.61 – Zabbix item configuration page, items in Zabbix database, Tags tab</span></p>
<ol class="calibre16">
<li value="9" class="calibre15"><span class="kobospan" id="kobo.1499.1">Now, click the </span><strong class="bold"><span class="kobospan" id="kobo.1500.1">Add</span></strong><span class="kobospan" id="kobo.1501.1"> button and click on the name of the host to add the m</span><a id="_idTextAnchor525" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1502.1">acros, </span><span><span class="kobospan" id="kobo.1503.1">as follows:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer158">
<span class="kobospan" id="kobo.1504.1"><img alt="Figure 3.62 – Zabbix host macro configuration page" src="image/B19803_03_62.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1505.1">Figure 3.62 – Zabbix host macro configuration page</span></p>
<ol class="calibre16">
<li value="10" class="calibre15"><span class="kobospan" id="kobo.1506.1">Now, if you </span><a id="_idIndexMarker243" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1507.1">go to </span><strong class="bold"><span class="kobospan" id="kobo.1508.1">Monitoring</span></strong><span class="kobospan" id="kobo.1509.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.1510.1">Hosts</span></strong><span class="kobospan" id="kobo.1511.1"> and click on </span><strong class="bold"><span class="kobospan" id="kobo.1512.1">Latest data</span></strong><span class="kobospan" id="kobo.1513.1"> for our host, you’ll </span><a id="_idTextAnchor526" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1514.1">see </span><span><span class="kobospan" id="kobo.1515.1">the following:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer159">
<span class="kobospan" id="kobo.1516.1"><img alt="Figure 3.63 – Zabbix Latest data page for lar-book-rocky, items in Zabbix database" src="image/B19803_03_63.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1517.1">Figure 3.63 – Zabbix Latest data page for lar-book-rocky, items in Zabbix database</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1518.1">From here, we can see how many items have been written to the </span><a id="_idTextAnchor527" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor528" class="pcalibre calibre6 pcalibre1"/><span><span class="kobospan" id="kobo.1519.1">database directly.</span></span></p>
<h2 id="_idParaDest-105" class="calibre7"><a id="_idTextAnchor529" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1520.1">How it works…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1521.1">Zabbix database monitoring works by connecting to your database with the ODBC middleware API. </span><span class="kobospan" id="kobo.1521.2">Any database supported by ODBC can be queried with Zabbix </span><span><span class="kobospan" id="kobo.1522.1">dat</span><a id="_idTextAnchor530" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1523.1">abase monitoring:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer160">
<span class="kobospan" id="kobo.1524.1"><img alt="Figure 3.64 – A diagram showing communication between the Zabbix server and ODBC" src="image/B19803_03_64.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1525.1">Figure 3.64 – A diagram showing communication between the Zabbix server and ODBC</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1526.1">Your Zabbix server sends a command with, for instance, your MySQL query to the ODBC connector. </span><span class="kobospan" id="kobo.1526.2">Your ODBC connecter sends this query to the database through the ODBC A</span><a id="_idTextAnchor531" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1527.1">PI, which, in turn, returns a value to ODBC. </span><span class="kobospan" id="kobo.1527.2">ODBC then forwards the value to the Zabbix server and hey presto: we have a valu</span><a id="_idTextAnchor532" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor533" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1528.1">e under </span><span><span class="kobospan" id="kobo.1529.1">our item.</span></span></p>
<h2 id="_idParaDest-106" class="calibre7"><a id="_idTextAnchor534" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1530.1">There’s more…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1531.1">You can do loads of queries to your databases with Zabbix database monitoring, but keep in </span><a id="_idIndexMarker244" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1532.1">mind that you are working with actual queries. </span><span class="kobospan" id="kobo.1532.2">Querying a database takes time and processing power, so keep your database monitoring structured and define the right </span><span><span class="kobospan" id="kobo.1533.1">execution times.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1534.1">Alternatively, we can use Zabbix Agent 2 to monitor most databases natively. </span><span class="kobospan" id="kobo.1534.2">This can improve security and performance and keep</span><a id="_idTextAnchor535" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor536" class="pcalibre calibre6 pcalibre1"/> <span><span class="kobospan" id="kobo.1535.1">complexity lower.</span></span></p>
<h1 id="_idParaDest-107" class="calibre5"><a id="_idTextAnchor537" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1536.1">Setting up HTTP agent monitoring</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.1537.1">With the </span><a id="_idIndexMarker245" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1538.1">Zabbi</span><a id="_idTextAnchor538" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1539.1">x HTTP agent, we can monitor a web page or API by retrieving data from it. </span><span class="kobospan" id="kobo.1539.2">For instance, if there’s a counter on a web page and we want to keep an eye on that counter value, we can do so with the Z</span><a id="_idTextAnchor539" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor540" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1540.1">abbix </span><span><span class="kobospan" id="kobo.1541.1">HTTP monitor.</span></span></p>
<h2 id="_idParaDest-108" class="calibre7"><a id="_idTextAnchor541" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1542.1">Getting ready</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1543.1">For this recipe, we’re going to need a web page to monitor, as well as our Zabbix server. </span><span class="kobospan" id="kobo.1543.2">For this lab, we will use Zabbix update </span><span><span class="kobospan" id="kobo.1544.1">v1: </span></span><a href="https://services.zabbix.com/updates/v1" class="pcalibre calibre6 pcalibre1"><span><span class="kobospan" id="kobo.1545.1">https://services.zabbix.com/updates/v1</span></span></a><span><span class="kobospan" id="kobo.1546.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1547.1">Please note that your Zabbix server will need an active internet connecti</span><a id="_idTextAnchor542" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor543" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1548.1">on for </span><span><span class="kobospan" id="kobo.1549.1">this recipe.</span></span></p>
<h2 id="_idParaDest-109" class="calibre7"><a id="_idTextAnchor544" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1550.1">How to do it…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1551.1">Let’s poll the web page from Zabbix so that it shows the latest version of Zabbix 7.0 that’s </span><span><span class="kobospan" id="kobo.1552.1">currently available:</span></span></p>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.1553.1">Navigate to your Zabbix frontend and navigate to </span><strong class="bold"><span class="kobospan" id="kobo.1554.1">Data collection</span></strong><span class="kobospan" id="kobo.1555.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.1556.1">Hosts</span></strong><span class="kobospan" id="kobo.1557.1">. </span><span class="kobospan" id="kobo.1557.2">Then, click the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.1558.1">lar-book-agent_simple</span></strong></span><span><span class="kobospan" id="kobo.1559.1"> host.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1560.1">Now, </span><a id="_idTextAnchor545" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1561.1">go to </span><strong class="bold"><span class="kobospan" id="kobo.1562.1">Items</span></strong><span class="kobospan" id="kobo.1563.1">; we want to create a new item here by clicking the </span><strong class="bold"><span class="kobospan" id="kobo.1564.1">Create item</span></strong><span class="kobospan" id="kobo.1565.1"> button. </span><span class="kobospan" id="kobo.1565.2">We </span><a id="_idIndexMarker246" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1566.1">are going to need to create an </span><strong class="bold"><span class="kobospan" id="kobo.1567.1">HTTP agent</span></strong><span class="kobospan" id="kobo.1568.1"> item, as shown in the </span><span><span class="kobospan" id="kobo.1569.1">fo</span><a id="_idTextAnchor546" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1570.1">llowing screenshot:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer161">
<span class="kobospan" id="kobo.1571.1"><img alt="Figure 3.65 – Zabbix Item configuration page, visitor count on the oicts.com page" src="image/B19803_03_65.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1572.1">Figure 3.65 – Zabbix Item configuration page, visitor count on the oicts.com page</span></p>
<ol class="calibre16">
<li value="3" class="calibre15"><span class="kobospan" id="kobo.1573.1">Make sure you fill in the query fields </span><span><span class="kobospan" id="kobo.1574.1">as follows:</span></span><ul class="calibre17"><li class="calibre15"><span><strong class="source-inline1"><span class="kobospan" id="kobo.1575.1">type</span></strong></span><span><span class="kobospan" id="kobo.1576.1">: </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.1577.1">software_update_check</span></strong></span></li><li class="calibre15"><span><strong class="source-inline1"><span class="kobospan" id="kobo.1578.1">version</span></strong></span><span><span class="kobospan" id="kobo.1579.1">: </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.1580.1">1.0</span></strong></span></li><li class="calibre15"><strong class="source-inline1"><span class="kobospan" id="kobo.1581.1">software_update_check_hash</span></strong><span class="kobospan" id="kobo.1582.1">: A randomly generated 64-character string with lowercase letters </span><span><span class="kobospan" id="kobo.1583.1">and numbers</span></span></li></ul></li>
<li class="calibre15"><span class="kobospan" id="kobo.1584.1">We also need to add a</span><a id="_idTextAnchor547" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1585.1"> tag to </span><span><span class="kobospan" id="kobo.1586.1">this item:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer162">
<span class="kobospan" id="kobo.1587.1"><img alt="Figure 3.66 – Zabbix Item configuration page, visitor count on the oicts.com page, Tags ta﻿b" src="image/B19803_03_66.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1588.1">Figure 3.66 – Zabbix Item configuration page, visitor count on the oicts.com page, Tags ta</span><a id="_idTextAnchor548" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1589.1">b</span></p>
<ol class="calibre16">
<li value="5" class="calibre15"><span class="kobospan" id="kobo.1590.1">Use the </span><a id="_idIndexMarker247" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1591.1">following </span><span><span class="kobospan" id="kobo.1592.1">pr</span><a id="_idTextAnchor549" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1593.1">eprocessing steps:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer163">
<span class="kobospan" id="kobo.1594.1"><img alt="Figure 3.67 – Zabbix Item configuration page, visitor count on the oicts.com page, Preprocessing tab" src="image/B19803_03_67.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1595.1">Figure 3.67 – Zabbix Item configuration page, visitor count on the oicts.com page, Preprocessing tab</span></p>
<ol class="calibre16">
<li value="6" class="calibre15"><span class="kobospan" id="kobo.1596.1">Now, navigate to </span><strong class="bold"><span class="kobospan" id="kobo.1597.1">Monitoring</span></strong><span class="kobospan" id="kobo.1598.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.1599.1">Hosts</span></strong><span class="kobospan" id="kobo.1600.1"> and open the </span><strong class="bold"><span class="kobospan" id="kobo.1601.1">Latest data</span></strong><span class="kobospan" id="kobo.1602.1"> page for our </span><strong class="source-inline1"><span class="kobospan" id="kobo.1603.1">lar-book-agent_simple</span></strong><span class="kobospan" id="kobo.1604.1"> host. </span><span class="kobospan" id="kobo.1604.2">If everything is working as it should, we should now be requesting the latest Zabbix </span><span><span class="kobospan" id="kobo.1605.1">7.0 version:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer164">
<span class="kobospan" id="kobo.1606.1"><img alt="Figure 3.68 – Zabbi﻿﻿x Latest data page" src="image/3.67.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1607.1">Figure 3.68 – Zabbi</span><a id="_idTextAnchor550" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor551" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1608.1">x Latest data page</span></p>
<h2 id="_idParaDest-110" class="calibre7"><span class="kobospan" id="kobo.1609.1">How it work</span><a id="_idTextAnchor552" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1610.1">s…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1611.1">Here, we request the complete web page from Zabbix by navigating to the page with the HTTP agent and downloading it. </span><span class="kobospan" id="kobo.1611.2">Once we have the complete content of the page – in this case, an HTML/PHP page – we can </span><a id="_idTextAnchor553" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1612.1">process </span><span><span class="kobospan" id="kobo.1613.1">the data:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer165">
<span class="kobospan" id="kobo.1614.1"><img alt="Figure 3.69 – Diagram showing Zabbix HTTP agent communication" src="image/B19803_03_68.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1615.1">Figure 3.69 – Diagram showing Zabbix HTTP agent communication</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1616.1">We ask our </span><a id="_idIndexMarker248" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1617.1">preprocessor to go through the requested code via a JSONPath and only show the version for the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.1618.1">latest_release</span></strong></span><span><span class="kobospan" id="kobo.1619.1"> node.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1620.1">All that’s left is the number, ready for us to use in graphs and other types of </span><span><span class="kobospan" id="kobo.1621.1">data visualization.</span></span></p>
<h1 id="_idParaDest-111" class="calibre5"><a id="_idTextAnchor554" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1622.1">Using Zabbix browser items to simulate a web user</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.1623.1">Zabbix now includes the ability to monitor web pages in a brand-new way. </span><span class="kobospan" id="kobo.1623.2">It’s now possible </span><a id="_idIndexMarker249" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1624.1">to use the new Zabbix </span><strong class="bold"><span class="kobospan" id="kobo.1625.1">Browser items</span></strong><span class="kobospan" id="kobo.1626.1"> functionality to simulate the things a browser user would do when navigating your web page. </span><span class="kobospan" id="kobo.1626.2">This makes it possible to navigate to pages, simulate clicks, get results, and </span><span><span class="kobospan" id="kobo.1627.1">much more.</span></span></p>
<h2 id="_idParaDest-112" class="calibre7"><a id="_idTextAnchor555" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1628.1">Getting ready</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1629.1">For this recipe, we will only need our Zabbix server and Zabbix frontend. </span><span class="kobospan" id="kobo.1629.2">Keep in mind that we will be running Selenium in Docker on our Zabbix server to get this new type of </span><span><span class="kobospan" id="kobo.1630.1">monitoring working.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1631.1">We’ll also use some pre-prepared JavaScript that you can find </span><span><span class="kobospan" id="kobo.1632.1">here: </span></span><a href="https://github.com/PacktPublishing/Zabbix-7-IT-Infrastructure-Monitoring-Cookbook/blob/main/chapter03/browser_item_script.txt" class="pcalibre calibre6 pcalibre1"><span><span class="kobospan" id="kobo.1633.1">https://github.com/PacktPublishing/Zabbix-7-IT-Infrastructure-Monitoring-Cookbook/blob/main/chapter03/browser_item_script.txt</span></span></a><span><span class="kobospan" id="kobo.1634.1">.</span></span></p>
<h2 id="_idParaDest-113" class="calibre7"><a id="_idTextAnchor556" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1635.1">How to do it…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1636.1">First, we’ll log in to the CLI of our server and start preparing </span><span><span class="kobospan" id="kobo.1637.1">the environment:</span></span></p>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.1638.1">We’ll use a lightweight Docker container to run Selenium, which will handle the browser </span><a id="_idIndexMarker250" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1639.1">emulation. </span><span class="kobospan" id="kobo.1639.2">Issue the following on the Zabbix </span><span><span class="kobospan" id="kobo.1640.1">server CLI.</span></span><p class="calibre3"><span class="kobospan" id="kobo.1641.1">For </span><span><span class="kobospan" id="kobo.1642.1">RHEL-based systems:</span></span></p><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.1643.1">dnf install docker-ce</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.1644.1">For </span><span><span class="kobospan" id="kobo.1645.1">Ubuntu systems:</span></span></p><pre class="source-code"><strong class="bold1"><span class="kobospan1" id="kobo.1646.1">dnf install docker-ce</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.1647.1">Make sure you start Docker </span><span><span class="kobospan" id="kobo.1648.1">as well:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.1649.1">systemctl enable docker --now</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.1650.1">Now, let’s download and run our </span><span><span class="kobospan" id="kobo.1651.1">Docker container:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.1652.1">docker run -d -p 4444:4444 -p 7900:7900 --shm-size="2g" selenium/standalone-chrome:latest</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.1653.1">Next, we must edit the Zabbix </span><span><span class="kobospan" id="kobo.1654.1">server configuration:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.1655.1">vim /etc/zabbix/zabbix_server.conf</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.1656.1">Two new parameters have been added to the Zabbix server configuration file that we can edit. </span><span class="kobospan" id="kobo.1656.2">Let’s connect to the container and add some </span><span><span class="kobospan" id="kobo.1657.1">browser pollers:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.1658.1">WebDriverURL=http://localhost:4444</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.1659.1">StartBrowserPollers=2</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.1660.1">Restart your Zabbix server to make the changes </span><span><span class="kobospan" id="kobo.1661.1">take effect:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.1662.1">systemctl restart zabbbix-server</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.1663.1">With the Zabbix server side of things done, let’s move on to the Zabbix frontend. </span><span class="kobospan" id="kobo.1663.2">Navigate to </span><strong class="bold"><span class="kobospan" id="kobo.1664.1">Data collection</span></strong><span class="kobospan" id="kobo.1665.1"> | </span><span><strong class="bold"><span class="kobospan" id="kobo.1666.1">Hosts</span></strong></span><span><span class="kobospan" id="kobo.1667.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1668.1">Let’s add </span><a id="_idIndexMarker251" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1669.1">a new host to monitor our Zabbix </span><span><span class="kobospan" id="kobo.1670.1">frontend website:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer166">
<span class="kobospan" id="kobo.1671.1"><img alt="Figure 3.70 – Zabbix website host configuration window" src="image/B19803_03_69.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1672.1">Figure 3.70 – Zabbix website host configuration window</span></p>
<ol class="calibre16">
<li value="9" class="calibre15"><span class="kobospan" id="kobo.1673.1">Click on the </span><strong class="bold"><span class="kobospan" id="kobo.1674.1">Add</span></strong><span class="kobospan" id="kobo.1675.1"> button at the bottom of the page to add this </span><span><span class="kobospan" id="kobo.1676.1">new host.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1677.1">Now, let’s add an item to this host. </span><span class="kobospan" id="kobo.1677.2">Click </span><strong class="bold"><span class="kobospan" id="kobo.1678.1">Items</span></strong><span class="kobospan" id="kobo.1679.1"> next to the </span><strong class="bold"><span class="kobospan" id="kobo.1680.1">Zabbix website </span></strong><span class="kobospan" id="kobo.1681.1">host, then click on the </span><strong class="bold"><span class="kobospan" id="kobo.1682.1">Create item</span></strong><span class="kobospan" id="kobo.1683.1"> button in the </span><span><span class="kobospan" id="kobo.1684.1">top-right corner.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1685.1">To create the item, we will need to download a bit of JavaScript from the Packt GitHub repo. </span><span class="kobospan" id="kobo.1685.2">You can find it </span><span><span class="kobospan" id="kobo.1686.1">here: </span></span><a href="https://github.com/PacktPublishing/Zabbix-7-IT-Infrastructure-Monitoring-Cookbook/blob/main/chapter03/browser_item_script.txt" class="pcalibre calibre6 pcalibre1"><span><span class="kobospan" id="kobo.1687.1">https://github.com/PacktPublishing/Zabbix-7-IT-Infrastructure-Monitoring-Cookbook/blob/main/chapter03/browser_item_script.txt</span></span></a><span><span class="kobospan" id="kobo.1688.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1689.1">Now, let’s fill </span><a id="_idIndexMarker252" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1690.1">in the new item fields. </span><span class="kobospan" id="kobo.1690.2">Make sure you place the aforementioned script in the </span><strong class="bold"><span class="kobospan" id="kobo.1691.1">Script</span></strong><span class="kobospan" id="kobo.1692.1"> field. </span><span class="kobospan" id="kobo.1692.2">The item should now look </span><span><span class="kobospan" id="kobo.1693.1">like this:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer167">
<span class="kobospan" id="kobo.1694.1"><img alt="Figure 3.71 – Zabbix website host item configuration window" src="image/B19803_03_70.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1695.1">Figure 3.71 – Zabbix website host item configuration window</span></p>
<ol class="calibre16">
<li value="13" class="calibre15"><span class="kobospan" id="kobo.1696.1">Make sure you add a tag </span><span><span class="kobospan" id="kobo.1697.1">as well:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer168">
<span class="kobospan" id="kobo.1698.1"><img alt="Figure 3.72 – Zabbix website host item tag configuration window" src="image/B19803_03_71.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1699.1">Figure 3.72 – Zabbix website host item tag configuration window</span></p>
<ol class="calibre16">
<li value="14" class="calibre15"><span class="kobospan" id="kobo.1700.1">Now, save the item by clicking on the </span><strong class="bold"><span class="kobospan" id="kobo.1701.1">Add</span></strong><span class="kobospan" id="kobo.1702.1"> button at the bottom of </span><span><span class="kobospan" id="kobo.1703.1">the window.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1704.1">Since </span><a id="_idIndexMarker253" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1705.1">we’re using macros, make sure you add them to the host. </span><span class="kobospan" id="kobo.1705.2">Click on the </span><strong class="bold"><span class="kobospan" id="kobo.1706.1">Zabbix website</span></strong><span class="kobospan" id="kobo.1707.1"> hostname. </span><span class="kobospan" id="kobo.1707.2">Then, add the </span><span><span class="kobospan" id="kobo.1708.1">following macros:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer169">
<span class="kobospan" id="kobo.1709.1"><img alt="Figure 3.73 – Zabbix website host macros configuration window" src="image/B19803_03_72.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1710.1">Figure 3.73 – Zabbix website host macros configuration window</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1711.1">Make sure you fill in the correct URL. </span><span class="kobospan" id="kobo.1711.2">Also, don’t forget to set the password macro to the </span><strong class="bold"><span class="kobospan" id="kobo.1712.1">Secret </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.1713.1">text</span></strong></span><span><span class="kobospan" id="kobo.1714.1"> type.</span></span></p>
<ol class="calibre16">
<li value="16" class="calibre15"><span class="kobospan" id="kobo.1715.1">Navigating to </span><strong class="bold"><span class="kobospan" id="kobo.1716.1">Monitoring</span></strong><span class="kobospan" id="kobo.1717.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.1718.1">Latest data</span></strong><span class="kobospan" id="kobo.1719.1"> should now show us the value for our </span><span><span class="kobospan" id="kobo.1720.1">new host:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer170">
<span class="kobospan" id="kobo.1721.1"><img alt="Figure 3.74 – Zabbix website item result" src="image/B19803_03_73.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1722.1">Figure 3.74 – Zabbix website item result</span></p>
<ol class="calibre16">
<li value="17" class="calibre15"><span class="kobospan" id="kobo.1723.1">As we learned earlier in this chapter, we can extract data from this bulk metric item using dependent items. </span><span class="kobospan" id="kobo.1723.2">This is what we’ll </span><span><span class="kobospan" id="kobo.1724.1">do next.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1725.1">Let’s go </span><a id="_idIndexMarker254" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1726.1">back to </span><strong class="bold"><span class="kobospan" id="kobo.1727.1">Data collection</span></strong><span class="kobospan" id="kobo.1728.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.1729.1">Hosts</span></strong><span class="kobospan" id="kobo.1730.1"> and click on </span><strong class="bold"><span class="kobospan" id="kobo.1731.1">Items</span></strong><span class="kobospan" id="kobo.1732.1"> for the </span><strong class="bold"><span class="kobospan" id="kobo.1733.1">Zabbix </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.1734.1">website</span></strong></span><span><span class="kobospan" id="kobo.1735.1"> host.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1736.1">Click </span><strong class="bold"><span class="kobospan" id="kobo.1737.1">Create item</span></strong><span class="kobospan" id="kobo.1738.1"> in the top-right corner and create a new item to get the </span><span><span class="kobospan" id="kobo.1739.1">total duration:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer171">
<span class="kobospan" id="kobo.1740.1"><img alt="Figure 3.75 – Browser monitoring total duration item" src="image/B19803_03_74.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1741.1">Figure 3.75 – Browser monitoring total duration item</span></p>
<ol class="calibre16">
<li value="20" class="calibre15"><span class="kobospan" id="kobo.1742.1">Click on </span><strong class="bold"><span class="kobospan" id="kobo.1743.1">Preprocessing</span></strong><span class="kobospan" id="kobo.1744.1"> so that we can add preprocessing details </span><span><span class="kobospan" id="kobo.1745.1">as well:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer172">
<span class="kobospan" id="kobo.1746.1"><img alt="Figure 3.76 – Browser monitoring total duration item preprocessing" src="image/B19803_03_75.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1747.1">Figure 3.76 – Browser monitoring total duration item preprocessing</span></p>
<ol class="calibre16">
<li value="21" class="calibre15"><span class="kobospan" id="kobo.1748.1">Click on </span><strong class="bold"><span class="kobospan" id="kobo.1749.1">Tags</span></strong><span class="kobospan" id="kobo.1750.1"> – we can’t forget to add </span><span><span class="kobospan" id="kobo.1751.1">a tag:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer173">
<span class="kobospan" id="kobo.1752.1"><img alt="Figure 3.77 – Browser monitoring total duration item tag" src="image/B19803_03_76.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1753.1">Figure 3.77 – Browser monitoring total duration item tag</span></p>
<ol class="calibre16">
<li value="22" class="calibre15"><span class="kobospan" id="kobo.1754.1">Click </span><strong class="bold"><span class="kobospan" id="kobo.1755.1">Add</span></strong><span class="kobospan" id="kobo.1756.1"> to finish creating </span><span><span class="kobospan" id="kobo.1757.1">the item.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1758.1">Now, click </span><strong class="bold"><span class="kobospan" id="kobo.1759.1">Create item</span></strong><span class="kobospan" id="kobo.1760.1"> in the top-right corner again and create a new item to get the </span><a id="_idIndexMarker255" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1761.1">number of </span><span><span class="kobospan" id="kobo.1762.1">enabled hosts:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer174">
<span class="kobospan" id="kobo.1763.1"><img alt="Figure 3.78 – Browser monitoring enabled hosts item" src="image/B19803_03_77.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1764.1">Figure 3.78 – Browser monitoring enabled hosts item</span></p>
<ol class="calibre16">
<li value="24" class="calibre15"><span class="kobospan" id="kobo.1765.1">Click on </span><strong class="bold"><span class="kobospan" id="kobo.1766.1">Preprocessing</span></strong><span class="kobospan" id="kobo.1767.1"> and add some </span><span><span class="kobospan" id="kobo.1768.1">preprocessing details:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer175">
<span class="kobospan" id="kobo.1769.1"><img alt="Figure 3.79 – Browser monitoring enabled hosts item preprocessing" src="image/B19803_03_78.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1770.1">Figure 3.79 – Browser monitoring enabled hosts item preprocessing</span></p>
<ol class="calibre16">
<li value="25" class="calibre15"><span class="kobospan" id="kobo.1771.1">Click on </span><strong class="bold"><span class="kobospan" id="kobo.1772.1">Tags</span></strong><span class="kobospan" id="kobo.1773.1"> – we </span><a id="_idIndexMarker256" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1774.1">can’t forget to add </span><span><span class="kobospan" id="kobo.1775.1">a tag:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer176">
<span class="kobospan" id="kobo.1776.1"><img alt="Figure 3.80 – Browser monitoring enabled hosts item tag" src="image/B19803_03_79.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1777.1">Figure 3.80 – Browser monitoring enabled hosts item tag</span></p>
<ol class="calibre16">
<li value="26" class="calibre15"><span class="kobospan" id="kobo.1778.1">Click </span><strong class="bold"><span class="kobospan" id="kobo.1779.1">Add</span></strong><span class="kobospan" id="kobo.1780.1"> to finish creating </span><span><span class="kobospan" id="kobo.1781.1">the item.</span></span></li>
</ol>
<p class="callout-heading"><span class="kobospan" id="kobo.1782.1">Tip</span></p>
<p class="callout"><span class="kobospan" id="kobo.1783.1">Feel free to add more dependent items yourself to get even more statistics from the raw JSON that was collected by the master item. </span><span class="kobospan" id="kobo.1783.2">Don’t forget to set </span><strong class="bold"><span class="kobospan" id="kobo.1784.1">History</span></strong><span class="kobospan" id="kobo.1785.1"> to </span><strong class="bold"><span class="kobospan" id="kobo.1786.1">Do not store</span></strong><span class="kobospan" id="kobo.1787.1"> on the master item once you’ve finished adding dependent items to save some </span><span><span class="kobospan" id="kobo.1788.1">disk space.</span></span></p>
<ol class="calibre16">
<li value="27" class="calibre15"><span class="kobospan" id="kobo.1789.1">Let’s have a look at how this </span><span><span class="kobospan" id="kobo.1790.1">code works.</span></span></li>
</ol>
<h2 id="_idParaDest-114" class="calibre7"><a id="_idTextAnchor557" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1791.1">How it works…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1792.1">With the new Zabbix browser monitoring, we can use advanced JavaScript in combination with Selenium, for example. </span><span class="kobospan" id="kobo.1792.2">This gives us the option to do almost anything a normal browser user can. </span><span class="kobospan" id="kobo.1792.3">This provides us with endless opportunities to monitor what our end users </span><span><span class="kobospan" id="kobo.1793.1">are doing.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1794.1">Let’s have a look at some of the steps in </span><span><span class="kobospan" id="kobo.1795.1">our JavaScript:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.1796.1">
try {
    var params = JSON.parse(value); // Parse the JSON string passed from Zabbix
    var webUrl = params.webUrl;
    var username = params.username;
    var password = params.password;
    browser.navigate(webUrl);
    browser.collectPerfEntries("open page");</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.1797.1">We start by parsing the parameters that we defined in the Zabbix frontend. </span><span class="kobospan" id="kobo.1797.2">We don’t want to </span><a id="_idIndexMarker257" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1798.1">use just hardcoded usernames and passwords – we want to use other values that can be dynamic in this script, such as URLs, which are useful to parse. </span><span class="kobospan" id="kobo.1798.2">This way, we create flexibility, which can also be useful later when we template </span><span><span class="kobospan" id="kobo.1799.1">the item:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.1800.1">
    // Find and fill username
    var el = browser.findElement("xpath", "//input[@id='name']");
    if (el === null) {
        throw Error("cannot find name input field");
    }
    el.sendKeys(username);
    // Find and fill password
    el = browser.findElement("xpath", "//input[@id='password']");
    if (el === null) {
        throw Error("cannot find password input field");
    }
    el.sendKeys(password);
    // Find and click the login button
    el = browser.findElement("xpath", "//button[@id='enter']");
    if (el === null) {
        throw Error("cannot find login button");
    }
    el.click();</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.1801.1">Then, we have a </span><strong class="source-inline"><span class="kobospan" id="kobo.1802.1">browser.findElement</span></strong><span class="kobospan" id="kobo.1803.1"> function. </span><span class="kobospan" id="kobo.1803.2">We will be using this to find the correct field to fill in with the username and password before we click on the login button. </span><span class="kobospan" id="kobo.1803.3">With </span><a id="_idIndexMarker258" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1804.1">this type of monitoring, we are translating JavaScript to what looks like what a user could also </span><span><span class="kobospan" id="kobo.1805.1">be doing:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.1806.1">
    // Collect performance data after login
    browser.collectPerfEntries("login");</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.1807.1">We also collect some performance statistics so that we can find how quickly the login </span><span><span class="kobospan" id="kobo.1808.1">was performed:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.1809.1">
    // Navigate to Reports -&gt; System information
    el = browser.findElement("xpath", "//a[contains(text(),'Reports')]");
    if (el === null) {
        throw Error("cannot find Reports menu");
    }
    el.click();
    el = browser.findElement("xpath", "//a[contains(text(),'System information')]");
    if (el === null) {
        throw Error("cannot find System information submenu");
    }
    el.click();
    // Find the required server performance row and get the value
    nvps = browser.findElement("xpath", "//tr[th[contains(text(), 'Required server performance, new values per second')]]/td[1]");
    totalHosts = browser.findElement("xpath", "//tr[th[contains(text(), 'Number of hosts (enabled/disabled)')]]/td[1]");
    enabledHosts = browser.findElement("xpath", "//tr[th[contains(text(), 'Number of hosts (enabled/disabled)')]]/td[2]/span[1]");
    disabledHosts = browser.findElement("xpath", "//tr[th[contains(text(), 'Number of hosts (enabled/disabled)')]]/td[2]/span[2]");
    numberOfTemplates = browser.findElement("xpath", "//tr[th[contains(text(), 'Number of templates')]]/td[1]");
    totalItems = browser.findElement("xpath", "//tr[th/span[contains(text(), 'Number of items (enabled/disabled/not supported)')]]/td[1]");
    enabledItems = browser.findElement("xpath", "//tr[th/span[contains(text(), 'Number of items (enabled/disabled/not supported)')]]/td[2]/span[1]");
    disabledItems = browser.findElement("xpath", "//tr[th/span[contains(text(), 'Number of items (enabled/disabled/not supported)')]]/td[2]/span[2]");
    nsItems = browser.findElement("xpath", "//tr[th/span[contains(text(), 'Number of items (enabled/disabled/not supported)')]]/td[2]/span[3]");
    if (el === null) {
        throw Error("cannot find required server performance row");
    }
    var performanceValue = nvps.getText();
    var totalHosts = totalHosts.getText();
    var enabledHosts = enabledHosts.getText();
    var disabledHosts = disabledHosts.getText();
    var numberOfTemplates = numberOfTemplates.getText();
    var totalItems = totalItems.getText();
    var enabledItems = enabledItems.getText();
    var disabledItems = disabledItems.getText();
    var nsItems = nsItems.getText();</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.1810.1">Then, we have </span><a id="_idIndexMarker259" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1811.1">a few </span><strong class="source-inline"><span class="kobospan" id="kobo.1812.1">browser.findElement</span></strong><span class="kobospan" id="kobo.1813.1"> functions to navigate to the </span><strong class="bold"><span class="kobospan" id="kobo.1814.1">Reports</span></strong><span class="kobospan" id="kobo.1815.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.1816.1">System information</span></strong><span class="kobospan" id="kobo.1817.1"> menu. </span><span class="kobospan" id="kobo.1817.2">On this page, we want to find specific rows from the table. </span><span class="kobospan" id="kobo.1817.3">Something important to note here is that apart from using browser monitoring to gather performance data or see if a user’s functionality is still working, we can also use it to extract metrics. </span><span class="kobospan" id="kobo.1817.4">We’ll come back to </span><span><span class="kobospan" id="kobo.1818.1">this shortly:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.1819.1">
    // Find and click the logout button
    el = browser.findElement("xpath", "//a[contains(text(),'Sign out')]");
    if (el === null) {
        throw Error("cannot find logout button");
    }
    el.click();
    // Collect performance data after logout
    browser.collectPerfEntries("logout");
    // Set result with the performance value
    result = browser.getResult();
    result.performanceValue = performanceValue;
    result.totalHosts = totalHosts;
    result.enabledHosts = enabledHosts;
    result.disabledHosts = disabledHosts;
    result.numberOfTemplates = numberOfTemplates;
    result.totalItems = totalItems;
    result.enabledItems = enabledItems;
    result.disabledItems = disabledItems;
    result.nsItems = nsItems;
} catch (err) {
    if (!(err instanceof BrowserError)) {
        browser.setError(err.message);
    }
    result = browser.getResult();
    result.error.screenshot = browser.getScreenshot();
} finally {
    return JSON.stringify(result);
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.1820.1">We must ensure we log out (it’s best practice to end any session correctly), at which point we can do some more error and result-catching. </span><span class="kobospan" id="kobo.1820.2">At this point, I would love to show you the JSON result, but let’s not cut down any more trees than necessary. </span><span class="kobospan" id="kobo.1820.3">Open your </span><strong class="bold"><span class="kobospan" id="kobo.1821.1">Latest data</span></strong><span class="kobospan" id="kobo.1822.1"> page and have a look at some of the </span><span><span class="kobospan" id="kobo.1823.1">JSON entries:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.1824.1">
   "duration":1.8088712692260742,</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.1825.1">We can </span><a id="_idIndexMarker260" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1826.1">see the total duration of the whole item execution at the top of the </span><span><span class="kobospan" id="kobo.1827.1">JSON result:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.1828.1">
         {
            "mark":"open page",
            "navigation":{
….
</span><span class="kobospan1" id="kobo.1828.2">               "transfer_size":4220,
               "duration":0.08759999996423722,
….</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.1829.1">For each step we did, we can see a </span><strong class="source-inline"><span class="kobospan" id="kobo.1830.1">mark</span></strong><span class="kobospan" id="kobo.1831.1"> value, which will give us more information about the action we executed through </span><span><span class="kobospan" id="kobo.1832.1">the browser:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.1833.1">
"performanceValue":"9.46","totalHosts":"23","enabledHosts":"18","disabledHosts":"5","numberOfTemplates":"287","totalItems":"1108","enabledItems":"650","disabledItems":"241","nsItems":"217"}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.1834.1">Last, but not least, at the bottom, we have our extracted Zabbix system report values. </span><span class="kobospan" id="kobo.1834.2">We gathered all this information through this single browser item </span><span><span class="kobospan" id="kobo.1835.1">monitoring type:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer177">
<span class="kobospan" id="kobo.1836.1"><img alt="Figure 3.81 – Zabbix" src="image/B19803_03_80.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1837.1">Figure 3.81 – Zabbix</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1838.1">Using the dependent items we learned about earlier, we can now extract useful data from our bulk metric collection, which was done by the browser item type. </span><span class="kobospan" id="kobo.1838.2">This gives us nice and clean metrics in a single item, which can also easily be used in triggers. </span><span class="kobospan" id="kobo.1838.3">For example, we can use these triggers to specify whether the duration is too long or whether there are fewer hosts enabled now </span><span><span class="kobospan" id="kobo.1839.1">than before.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1840.1">As you </span><a id="_idIndexMarker261" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1841.1">can see, this single new item type opens up a world of possibilities for us. </span><span class="kobospan" id="kobo.1841.2">I can only imagine the Zabbix community finding more and more use cases for this and sharing their ama</span><a id="_idTextAnchor558" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor559" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1842.1">zing </span><span><span class="kobospan" id="kobo.1843.1">new templates.</span></span></p>
<h1 id="_idParaDest-115" class="calibre5"><a id="_idTextAnchor560" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1844.1">Using Zabbix preprocessing to alter item values</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.1845.1">Prepr</span><a id="_idTextAnchor561" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1846.1">ocessing </span><a id="_idIndexMarker262" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1847.1">item values is an important functional</span><a id="_idTextAnchor562" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1848.1">ity in Zabbix; we can use it to create all kinds of checks. </span><span class="kobospan" id="kobo.1848.2">We’ve already done some preprocessing in this chapter, but let’s take a deeper dive into </span><a id="_idTextAnchor563" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor564" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1849.1">it and what </span><span><span class="kobospan" id="kobo.1850.1">it does.</span></span></p>
<h2 id="_idParaDest-116" class="calibre7"><a id="_idTextAnchor565" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1851.1">Getting started</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1852.1">We are going to need a Zabbix server to create a check for. </span><span class="kobospan" id="kobo.1852.2">We will also need a</span><a id="_idTextAnchor566" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1853.1"> passive Zabbix agent on a Linux ho</span><a id="_idTextAnchor567" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1854.1">st to get our values from and preprocess them. </span><span class="kobospan" id="kobo.1854.2">We can use the agent that’s running on our Zabbix server for this. </span><span class="kobospan" id="kobo.1854.3">In my case, thi</span><a id="_idTextAnchor568" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor569" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1855.1">s </span><span><span class="kobospan" id="kobo.1856.1">is </span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.1857.1">lar-book-rocky</span></strong></span><span><span class="kobospan" id="kobo.1858.1">.</span></span></p>
<h2 id="_idParaDest-117" class="calibre7"><a id="_idTextAnchor570" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1859.1">How to do it…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1860.1">Follow </span><span><span class="kobospan" id="kobo.1861.1">these steps:</span></span></p>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.1862.1">Let’s start by logging in to our Zabbix frontend and going to </span><strong class="bold"><span class="kobospan" id="kobo.1863.1">Data collection</span></strong><span class="kobospan" id="kobo.1864.1"> | </span><span><strong class="bold"><span class="kobospan" id="kobo.1865.1">Hosts</span></strong></span><span><span class="kobospan" id="kobo.1866.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1867.1">Click on your Zabbix server host; in my case, it’s </span><span><span class="kobospan" id="kobo.1868.1">called </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.1869.1">lar-book-rocky</span></strong></span><span><span class="kobospan" id="kobo.1870.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1871.1">Now, go to </span><strong class="bold"><span class="kobospan" id="kobo.1872.1">Items</span></strong><span class="kobospan" id="kobo.1873.1"> and click on the blue </span><strong class="bold"><span class="kobospan" id="kobo.1874.1">Create item</span></strong><span class="kobospan" id="kobo.1875.1"> button in the top-right corner. </span><span class="kobospan" id="kobo.1875.2">Let’s create a new item with the </span><span><span class="kobospan" id="kobo.1876.1">fol</span><a id="_idTextAnchor571" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1877.1">lowing information:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer178">
<span class="kobospan" id="kobo.1878.1"><img alt="Figure 3.82 – New item creation screen, Get traffic statistics from CLI" src="image/B19803_03_81.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1879.1">Figure 3.82 – New item creation screen, Get traffic statistics from CLI</span></p>
<ol class="calibre16">
<li value="4" class="calibre15"><span class="kobospan" id="kobo.1880.1">Don’t </span><a id="_idIndexMarker263" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1881.1">forg</span><a id="_idTextAnchor572" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1882.1">et to add </span><span><span class="kobospan" id="kobo.1883.1">your tag:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer179">
<span class="kobospan" id="kobo.1884.1"><img alt="Figure 3.83 – New item creation screen, Get traffic statistics from CLI, Tags tab" src="image/B19803_03_82.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1885.1">Figure 3.83 – New item creation screen, Get traffic statistics from CLI, Tags tab</span></p>
<ol class="calibre16">
<li value="5" class="calibre15"><span class="kobospan" id="kobo.1886.1">Make sure you change </span><strong class="source-inline1"><span class="kobospan" id="kobo.1887.1">ens192</span></strong><span class="kobospan" id="kobo.1888.1"> to your primary network interface. </span><span class="kobospan" id="kobo.1888.2">You can find </span><a id="_idTextAnchor573" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1889.1">your primary network interface by logging</span><a id="_idTextAnchor574" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1890.1"> in to the Linux CLI and executing the </span><span><span class="kobospan" id="kobo.1891.1">following command:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.1892.1">Ifconfig</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.1893.1">Back on the item creation screen, click on the blue </span><strong class="bold"><span class="kobospan" id="kobo.1894.1">Add</span></strong><span class="kobospan" id="kobo.1895.1"> button. </span><span class="kobospan" id="kobo.1895.2">This item will use the Zabbix agent to execute a remote command on the </span><span><span class="kobospan" id="kobo.1896.1">Linux CLI.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1897.1">When we navigate to this new item, we’ll see that the item becomes unsupported. </span><span class="kobospan" id="kobo.1897.2">This is because when we use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.1898.1">system.run</span></strong><span class="kobospan" id="kobo.1899.1"> key, we need to allow it in the Zabbix </span><span><span class="kobospan" id="kobo.1900.1">ag</span><a id="_idTextAnchor575" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1901.1">ent configuration:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer180">
<span class="kobospan" id="kobo.1902.1"><img alt="Figure 3.84 – Unsupported item information, Unknown metric system.run" src="image/B19803_03_83.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1903.1">Figure 3.84 – Unsupported item information, Unknown metric system.run</span></p>
<ol class="calibre16">
<li value="8" class="calibre15"><span class="kobospan" id="kobo.1904.1">Log in </span><a id="_idIndexMarker264" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1905.1">to the Linux CLI of the monitored host and edit the Zabbix agent configuration by running the </span><span><span class="kobospan" id="kobo.1906.1">following command:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.1907.1">vim /etc/zabbix/zabbix_agent2.conf</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.1908.1">Go to the </span><strong class="source-inline1"><span class="kobospan" id="kobo.1909.1">Option: AllowKey</span></strong><span class="kobospan" id="kobo.1910.1"> line and add </span><strong class="source-inline1"><span class="kobospan" id="kobo.1911.1">AllowKey=system.run[</span><a id="_idTextAnchor576" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1912.1">*]</span></strong><span class="kobospan" id="kobo.1913.1">, as </span><span><span class="kobospan" id="kobo.1914.1">shown here:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer181">
<span class="kobospan" id="kobo.1915.1"><img alt="Figure 3.85 – Zabbix agent configuration file, AllowKey=system.run[*]" src="image/B19803_03_84.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1916.1">Figure 3.85 – Zabbix agent configuration file, AllowKey=system.run[*]</span></p>
<ol class="calibre16">
<li value="10" class="calibre15"><span class="kobospan" id="kobo.1917.1">Save t</span><a id="_idTextAnchor577" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1918.1">he file and resta</span><a id="_idTextAnchor578" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1919.1">rt the Zabbix agent, </span><span><span class="kobospan" id="kobo.1920.1">like so:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.1921.1">systemctl restart zabbix-agent2</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.1922.1">Back at the Zabbix frontend, the error we noticed in </span><em class="italic"><span class="kobospan" id="kobo.1923.1">Step 7</span></em><span class="kobospan" id="kobo.1924.1"> should be gone after a </span><span><span class="kobospan" id="kobo.1925.1">few minutes.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1926.1">Navigate to </span><strong class="bold"><span class="kobospan" id="kobo.1927.1">Monitoring</span></strong><span class="kobospan" id="kobo.1928.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.1929.1">Latest data</span></strong><span class="kobospan" id="kobo.1930.1"> and filter your Zabbix server host, </span><strong class="source-inline1"><span class="kobospan" id="kobo.1931.1">lar-book-rocky</span></strong><span class="kobospan" id="kobo.1932.1">, and the name of the new </span><strong class="bold"><span class="kobospan" id="kobo.1933.1">Get traffic statistics from </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.1934.1">CLI</span></strong></span><span><span class="kobospan" id="kobo.1935.1"> item.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1936.1">The value </span><a id="_idIndexMarker265" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1937.1">should now be pulled from the host. </span><span class="kobospan" id="kobo.1937.2">If we click on </span><strong class="bold"><span class="kobospan" id="kobo.1938.1">History</span></strong><span class="kobospan" id="kobo.1939.1">, we can see the full value; it shoul</span><a id="_idTextAnchor579" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1940.1">d look </span><span><span class="kobospan" id="kobo.1941.1">as follows:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer182">
<span class="kobospan" id="kobo.1942.1"><img alt="Figure 3.86 – Zabbix agent system.run command executing ifconfig ens192 results" src="image/B19803_03_85.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1943.1">Figure 3.86 – Zabbix agent system.run command executing ifconfig ens192 results</span></p>
<ol class="calibre16">
<li value="14" class="calibre15"><span class="kobospan" id="kobo.1944.1">The information we can see here is way too much for just one item, so we need to spl</span><a id="_idTextAnchor580" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1945.1">it it up. </span><span class="kobospan" id="kobo.1945.2">We’ll use prepro</span><a id="_idTextAnchor581" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1946.1">cessing to get the number of RX bytes from </span><span><span class="kobospan" id="kobo.1947.1">the information.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1948.1">Go back to </span><strong class="bold"><span class="kobospan" id="kobo.1949.1">Data collection</span></strong><span class="kobospan" id="kobo.1950.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.1951.1">Hosts</span></strong><span class="kobospan" id="kobo.1952.1"> and click on your Zabbix server host. </span><span class="kobospan" id="kobo.1952.2">Go to </span><strong class="bold"><span class="kobospan" id="kobo.1953.1">Items</span></strong><span class="kobospan" id="kobo.1954.1"> on </span><span><span class="kobospan" id="kobo.1955.1">this host.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1956.1">Click on the </span><strong class="bold"><span class="kobospan" id="kobo.1957.1">Get traffic statistics from CLI</span></strong><span class="kobospan" id="kobo.1958.1"> item to edit it. </span><span class="kobospan" id="kobo.1958.2">Change its name to </span><strong class="source-inline1"><span class="kobospan" id="kobo.1959.1">Total RX traffic in bytes for ens192</span></strong><span class="kobospan" id="kobo.1960.1"> and add </span><strong class="source-inline1"><span class="kobospan" id="kobo.1961.1">B</span></strong><span class="kobospan" id="kobo.1962.1"> to </span><strong class="bold"><span class="kobospan" id="kobo.1963.1">Units</span></strong><span class="kobospan" id="kobo.1964.1">, where </span><strong class="bold"><span class="kobospan" id="kobo.1965.1">B</span></strong><span class="kobospan" id="kobo.1966.1"> stands for </span><strong class="bold"><span class="kobospan" id="kobo.1967.1">bytes</span></strong><span class="kobospan" id="kobo.1968.1">. </span><span class="kobospan" id="kobo.1968.2">It wil</span><a id="_idTextAnchor582" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1969.1">l look </span><span><span class="kobospan" id="kobo.1970.1">like this:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer183">
<span class="kobospan" id="kobo.1971.1"><img alt="Figure 3.87 – Zabbix agent system.run it﻿em" src="image/B19803_03_86.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1972.1">Figure 3.87 – Zabbix agent system.run it</span><a id="_idTextAnchor583" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1973.1">em</span></p>
<ol class="calibre16">
<li value="17" class="calibre15"><span class="kobospan" id="kobo.1974.1">Add </span><a id="_idIndexMarker266" class="pcalibre calibre6 pcalibre1"/><span><span class="kobospan" id="kobo.1975.1">your tag:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer184">
<span class="kobospan" id="kobo.1976.1"><img alt="Figure 3.88 – New item creation screen, Get traffic statistics from CLI, Tags tab" src="image/B19803_03_87.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1977.1">Figure 3.88 – New item creation screen, Get traffic statistics from CLI, Tags tab</span></p>
<ol class="calibre16">
<li value="18" class="calibre15"><span class="kobospan" id="kobo.1978.1">Now, click on </span><strong class="bold"><span class="kobospan" id="kobo.1979.1">Preprocessing</span></strong><span class="kobospan" id="kobo.1980.1"> and click on the underlined </span><span><strong class="bold"><span class="kobospan" id="kobo.1981.1">Add</span></strong></span><span><span class="kobospan" id="kobo.1982.1"> button.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1983.1">A </span><strong class="bold"><span class="kobospan" id="kobo.1984.1">Regular expres</span><a id="_idTextAnchor584" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1985.1">sion</span></strong><span class="kobospan" id="kobo.1986.1"> (regex) field will be added. </span><span class="kobospan" id="kobo.1986.2">We are going to fill this so that it matches the total number of bytes for</span><a id="_idTextAnchor585" class="pcalibre calibre6 pcalibre1"/> <span><span class="kobospan" id="kobo.1987.1">your interface:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer185">
<span class="kobospan" id="kobo.1988.1"><img alt="Figure 3.89 – Zabbix agent system.run item preprocessing" src="image/B19803_03_88.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1989.1">Figure 3.89 – Zabbix agent system.run item preprocessing</span></p>
<ol class="calibre16">
<li value="20" class="calibre15"><span class="kobospan" id="kobo.1990.1">Make sure you also select the </span><strong class="bold"><span class="kobospan" id="kobo.1991.1">Discard value</span></strong><span class="kobospan" id="kobo.1992.1"> box under </span><strong class="bold"><span class="kobospan" id="kobo.1993.1">Custom </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.1994.1">on fail</span></strong></span><span><span class="kobospan" id="kobo.1995.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1996.1">Now, click on the underlined </span><strong class="bold"><span class="kobospan" id="kobo.1997.1">Add</span></strong><span class="kobospan" id="kobo.1998.1"> button again and use the drop-down menu for this </span><a id="_idIndexMarker267" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1999.1">new step to select </span><strong class="bold"><span class="kobospan" id="kobo.2000.1">Discard unchanged</span></strong><span class="kobospan" id="kobo.2001.1">. </span><span class="kobospan" id="kobo.2001.2">The result will</span><a id="_idTextAnchor586" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.2002.1"> look </span><span><span class="kobospan" id="kobo.2003.1">like this:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer186">
<span class="kobospan" id="kobo.2004.1"><img alt="Figure 3.90 – Zabbix agent system.run item preprocessing" src="image/B19803_03_89.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.2005.1">Figure 3.90 – Zabbix agent system.run item preprocessing</span></p>
<ol class="calibre16">
<li value="22" class="calibre15"><span class="kobospan" id="kobo.2006.1">We can now click the blue </span><strong class="bold"><span class="kobospan" id="kobo.2007.1">Update</span></strong><span class="kobospan" id="kobo.2008.1"> button to finish editing </span><span><span class="kobospan" id="kobo.2009.1">this item.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.2010.1">Navigate back to </span><strong class="bold"><span class="kobospan" id="kobo.2011.1">Monitoring</span></strong><span class="kobospan" id="kobo.2012.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.2013.1">Latest data</span></strong><span class="kobospan" id="kobo.2014.1"> and filter on your host and the new item name, </span><strong class="bold"><span class="kobospan" id="kobo.2015.1">Total RX traffic in bytes for ens192</span></strong><span class="kobospan" id="kobo.2016.1">. </span><span class="kobospan" id="kobo.2016.2">Make sure you use your own </span><span><span class="kobospan" id="kobo.2017.1">interface name.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.2018.1">We can now see our value coming in. </span><span class="kobospan" id="kobo.2018.2">Here, we have an item displaying our total RX traffic for our </span><a id="_idTextAnchor587" class="pcalibre calibre6 pcalibre1"/><span><span class="kobospan" id="kobo.2019.1">main interface:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer187">
<span class="kobospan" id="kobo.2020.1"><img alt="Figure 3.91 – Zabbix Total RX traffic i﻿﻿tem latest data" src="image/B19803_03_90.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.2021.1">Figure 3.91 – Zabbix Total RX traffic i</span><a id="_idTextAnchor588" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor589" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.2022.1">tem latest data</span></p>
<h2 id="_idParaDest-118" class="calibre7"><a id="_idTextAnchor590" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.2023.1">How it works…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.2024.1">We did some preprocessing in the </span><em class="italic"><span class="kobospan" id="kobo.2025.1">Working with calculated and dependent items</span></em><span class="kobospan" id="kobo.2026.1"> recipe to get data from a mast</span><a id="_idTextAnchor591" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.2027.1">er item. </span><span class="kobospan" id="kobo.2027.2">We also used preprocessing in the </span><em class="italic"><span class="kobospan" id="kobo.2028.1">Setting up HTTP agent monitoring</span></em><span class="kobospan" id="kobo.2029.1"> recipe to get a specific value from a web page. </span><span class="kobospan" id="kobo.2029.2">We didn’t go over the preprocessing concepts used in those recipes, though, so let’s go over </span><span><span class="kobospan" id="kobo.2030.1">them here.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.2031.1">When working with preprocessing, it’s important to know the basic setup. </span><span class="kobospan" id="kobo.2031.2">Let’s take a look at </span><a id="_idIndexMarker268" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.2032.1">the incoming data before we </span><span><span class="kobospan" id="kobo.2033.1">use</span><a id="_idTextAnchor592" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.2034.1"> preprocessing:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer188">
<span class="kobospan" id="kobo.2035.1"><img alt="Figure 3.92 – Zabbix agent system.run command executing ifconfig ens192 results" src="image/B19803_03_85.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.2036.1">Figure 3.92 – Zabbix agent system.run command executing ifconfig ens192 results</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.2037.1">This is a lot of information. </span><span class="kobospan" id="kobo.2037.2">When we look at how Zabbix items are used, we try to put graspable information in a single item. </span><span class="kobospan" id="kobo.2037.3">Luckily, we can preprocess this item before we store the value in Zabbix. </span><span class="kobospan" id="kobo.2037.4">In the following figure, we can see the preprocessing steps we adde</span><a id="_idTextAnchor593" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.2038.1">d to </span><span><span class="kobospan" id="kobo.2039.1">our item:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer189">
<span class="kobospan" id="kobo.2040.1"><img alt="Figure 3.93 – Zabbix agent system.run item preprocessing with two steps" src="image/B19803_03_92.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.2041.1">Figure 3.93 – Zabbix agent system.run item preprocessing with two steps</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.2042.1">Our first step is a regex. </span><span class="kobospan" id="kobo.2042.2">This step will make sure we only use the numbers we need. </span><span class="kobospan" id="kobo.2042.3">We match on the word </span><strong class="source-inline"><span class="kobospan" id="kobo.2043.1">RX</span></strong><span class="kobospan" id="kobo.2044.1">, then the word </span><strong class="source-inline"><span class="kobospan" id="kobo.2045.1">bytes</span></strong><span class="kobospan" id="kobo.2046.1">, and a sequence of numbers after them. </span><span class="kobospan" id="kobo.2046.2">This way, we end up with the total number of RX bytes in capture group 2. </span><span class="kobospan" id="kobo.2046.3">This is why we fill in </span><strong class="source-inline"><span class="kobospan" id="kobo.2047.1">\2</span></strong><span class="kobospan" id="kobo.2048.1"> in the output field. </span><span class="kobospan" id="kobo.2048.2">We also specify </span><strong class="bold"><span class="kobospan" id="kobo.2049.1">Custom on fail</span></strong><span class="kobospan" id="kobo.2050.1">, which will discard any value if the regex </span><span><span class="kobospan" id="kobo.2051.1">doesn’t match.</span></span></p>
<p class="calibre3"><a id="_idTextAnchor594" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.2052.1">Our second step is to discard any values tha</span><a id="_idTextAnchor595" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.2053.1">t are the same as the value received before. </span><span class="kobospan" id="kobo.2053.2">Instead of storing duplicate values, we simply discard them and save some space in our </span><span><span class="kobospan" id="kobo.2054.1">Zabbix database.</span></span></p>
<p class="callout-heading"><span class="kobospan" id="kobo.2055.1">Tip</span></p>
<p class="callout"><span class="kobospan" id="kobo.2056.1">It’s a lot easier t</span><a id="_idTextAnchor596" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.2057.1">o build a regex when using an online tool such as </span><a href="https://regex101.com/" class="pcalibre calibre6 pcalibre1"><span class="kobospan" id="kobo.2058.1">https://regex101.com/</span></a><span class="kobospan" id="kobo.2059.1">. </span><span class="kobospan" id="kobo.2059.2">You can see what number your capture groups will get, and there’s a lot of valuable information in the tools </span><span><span class="kobospan" id="kobo.2060.1">as well.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.2061.1">It’s important </span><a id="_idIndexMarker269" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.2062.1">to note that steps are executed in the sequence they are defined in the frontend. </span><span class="kobospan" id="kobo.2062.2">If the first step fails, the item becomes unsupported unless </span><strong class="bold"><span class="kobospan" id="kobo.2063.1">Custom on fail</span></strong><span class="kobospan" id="kobo.2064.1"> is set to do </span><span><span class="kobospan" id="kobo.2065.1">something else.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.2066.1">By adding preprocessing to Zabbix, we open up a whole range of options for our items, and we can alter our data in almost any way required. </span><span class="kobospan" id="kobo.2066.2">These two steps are just the beginning of the options that are available when diving into the world of </span><span><span class="kobospan" id="kobo.2067.1">Zabbix</span><a id="_idTextAnchor597" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor598" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.2068.1"> preprocessing.</span></span></p>
<h2 id="_idParaDest-119" class="calibre7"><a id="_idTextAnchor599" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.2069.1">See also</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.2070.1">Preprocessing in Zabbix is an important subject, and it’s impossible to cover every aspect of it in a single recipe. </span><span class="kobospan" id="kobo.2070.2">The two preprocessing steps in this recipe’s example are just</span><a id="_idTextAnchor600" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.2071.1"> two of the many options we can use. </span><span class="kobospan" id="kobo.2071.2">Check out the official Zabbix documentation to see the other options we can </span><span><span class="kobospan" id="kobo.2072.1">use:</span></span><span><span> </span></span><a href="https://www.zabbix.com/documentation/current/en/manual/config/items/preprocessing" class="pcalibre calibre6 pcalibre1"><span><span class="kobospan" id="kobo.2073.1">https://www.zabbix.com/documentation/current/en/manual/config/items/preprocessing</span></span></a><span><span class="kobospan" id="kobo.2074.1">.</span></span></p>
</div>
</body></html>