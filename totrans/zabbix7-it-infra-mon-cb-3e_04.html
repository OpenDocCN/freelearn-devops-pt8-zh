<html><head></head><body>
<div id="_idContainer237" class="calibre2">
<h1 class="chapter-number" id="_idParaDest-120"><a id="_idTextAnchor601" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1.1">4</span></h1>
<h1 id="_idParaDest-121" class="calibre5"><a id="_idTextAnchor602" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.2.1">Working with Triggers and Alerts</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.3.1">Now, what use would all of that collected data in Zabbix be without actually doing some alerting with it? </span><span class="kobospan" id="kobo.3.2">Of course, we can use Zabbix to collect our data and just go over it manually, but Zabbix gets a lot more useful when we actually start sending out notifications to users. </span><span class="kobospan" id="kobo.3.3">This way, we don’t have to always keep an eye on our Zabbix frontend, but we can just let our triggers and alerts do the work for us, redirecting us to the frontend only when we </span><span><span class="kobospan" id="kobo.4.1">need it.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.5.1">In Zabbix 7, you will find a new trigger expressions syntax compared to Zabbix 5. </span><span class="kobospan" id="kobo.5.2">This syntax has been available since Zabbix 5.4, so if you skipped some versions, this might be the first time you’re working with it. </span><span class="kobospan" id="kobo.5.3">If you’ve been working with a Zabbix version before version 5.4, keep in mind that you might need to get used to this new syntax. </span><span class="kobospan" id="kobo.5.4">If you have Zabbix 5.4 or higher running already, the syntax will be the same in </span><span><span class="kobospan" id="kobo.6.1">Zabbix 7.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.7.1">We will learn all about setting up effective triggers with the new expression format and about alerts in the </span><span><span class="kobospan" id="kobo.8.1">following recipes:</span></span></p>
<ul class="calibre14">
<li class="calibre15"><span class="kobospan" id="kobo.9.1">Setting </span><span><span class="kobospan" id="kobo.10.1">up triggers</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.11.1">Setting up </span><span><span class="kobospan" id="kobo.12.1">advanced triggers</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.13.1">Setting </span><span><span class="kobospan" id="kobo.14.1">up alerts</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.15.1">Keeping </span><span><span class="kobospan" id="kobo.16.1">alerts effective</span></span></li>
<li class="calibre15"><span><span class="kobospan" id="kobo.17.1">Customizing alerts</span></span></li>
</ul>
<h1 id="_idParaDest-122" class="calibre5"><a id="_idTextAnchor603" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor604" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.18.1">Technical requirements</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.19.1">For this chapter, we will need a Zabbix server, for instance, the one used in the </span><span><span class="kobospan" id="kobo.20.1">previous chapter.</span></span></p>
<ul class="calibre14">
<li class="calibre15"><span class="kobospan" id="kobo.21.1">The Zabbix server installed on a Linux distribution of your choice. </span><span class="kobospan" id="kobo.21.2">We will use the server set up in </span><a href="B19803_01.xhtml#_idTextAnchor021" class="pcalibre calibre6 pcalibre1"><span><em class="italic"><span class="kobospan" id="kobo.22.1">Chapter 1</span></em></span></a><span><span class="kobospan" id="kobo.23.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.24.1">MariaDB set up to work with your </span><span><span class="kobospan" id="kobo.25.1">Zabbix server.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.26.1">NGINX or Apache set up to serve the </span><span><span class="kobospan" id="kobo.27.1">Zabbix frontend.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.28.1">We will also need a Linux host to monitor so that we can actually build some cool triggers </span><span><span class="kobospan" id="kobo.29.1">to use.</span></span></li>
</ul>
<h1 id="_idParaDest-123" class="calibre5"><a id="_idTextAnchor605" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor606" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.30.1">Setting up triggers</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.31.1">Triggers are important</span><a id="_idTextAnchor607" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.32.1"> in Zabbix because they notify you as to what’s going on with your data. </span><span class="kobospan" id="kobo.32.2">We want </span><a id="_idIndexMarker270" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.33.1">to get a trigger when our data reaches a certain threshold or when we receive a </span><span><span class="kobospan" id="kobo.34.1">certain value.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.35.1">So, let’s get started with setting up some cool triggers. </span><span class="kobospan" id="kobo.35.2">There are loads of different options for defining triggers, but after reading this recipe, you should be able to set up some of the most prominent triggers. </span><span class="kobospan" id="kobo.35.3">Let’s take your trigger experience to the </span><span><span class="kobospan" id="kobo.36.1">next level.</span></span><a id="_idTextAnchor608" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor609" class="pcalibre calibre6 pcalibre1"/></p>
<h2 id="_idParaDest-124" class="calibre7"><a id="_idTextAnchor610" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.37.1">Getting ready</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.38.1">For this recipe, we will need our Zabbix server ready and we will need a Linux host. </span><span class="kobospan" id="kobo.38.2">I will use the </span><strong class="source-inline"><span class="kobospan" id="kobo.39.1">lar-book-agent_simple</span></strong><span class="kobospan" id="kobo.40.1"> host from the previous chapter because we already have some items </span><span><span class="kobospan" id="kobo.41.1">on that.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.42.1">We’ll also need one more host that is monitored by the Zabbix agent with the Zabbix agent template. </span><span class="kobospan" id="kobo.42.2">We’ll use one of the items on this host to create a trigger. </span><span class="kobospan" id="kobo.42.3">This will be the </span><strong class="source-inline"><span class="kobospan" id="kobo.43.1">lar-book-agent_passive</span></strong><span class="kobospan" id="kobo.44.1"> host from the </span><span><span class="kobospan" id="kobo.45.1">previous chapter.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.46.1">On this host, we will already have some triggers available, but we will extend these triggers further to inform us </span><span><span class="kobospan" id="kobo.47.1">even better.</span></span><a id="_idTextAnchor611" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor612" class="pcalibre calibre6 pcalibre1"/></p>
<h2 id="_idParaDest-125" class="calibre7"><a id="_idTextAnchor613" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.48.1">How to do it…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.49.1">In this section, we are going to create three triggers to monitor state changes. </span><span class="kobospan" id="kobo.49.2">Let’s get started by creating our </span><span><span class="kobospan" id="kobo.50.1">first trigger.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.51.1">Trigger 1 – SSH service monitoring</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.52.1">Let’s </span><a id="_idIndexMarker271" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.53.1">create</span><a id="_idTextAnchor614" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.54.1"> a simple trigger on the </span><strong class="source-inline"><span class="kobospan" id="kobo.55.1">lar-book-agent_simple</span></strong><span class="kobospan" id="kobo.56.1"> host. </span><span class="kobospan" id="kobo.56.2">We </span><a id="_idIndexMarker272" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.57.1">made a simple check on this host called </span><strong class="source-inline"><span class="kobospan" id="kobo.58.1">Check if port 22 is available</span></strong><span class="kobospan" id="kobo.59.1">, but we haven’t created anything to notify us about </span><span><span class="kobospan" id="kobo.60.1">this yet:</span></span></p>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.61.1">First, let’s get started by going to </span><strong class="bold"><span class="kobospan" id="kobo.62.1">Data collection</span></strong><span class="kobospan" id="kobo.63.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.64.1">Hosts</span></strong><span class="kobospan" id="kobo.65.1">, then clicking the host and going to </span><strong class="bold"><span class="kobospan" id="kobo.66.1">Triggers</span></strong><span class="kobospan" id="kobo.67.1">. </span><span class="kobospan" id="kobo.67.2">This is where we will find our triggers and where we can create them. </span><span class="kobospan" id="kobo.67.3">We want to create a new trigger here by clicking the blue </span><strong class="bold"><span class="kobospan" id="kobo.68.1">Create trigger</span></strong><span class="kobospan" id="kobo.69.1"> button in the </span><span><span class="kobospan" id="kobo.70.1">top-right corner.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.71.1">Let’s creat</span><a id="_idTextAnchor615" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.72.1">e a new trigger with the </span><span><span class="kobospan" id="kobo.73.1">following information</span><a id="_idTextAnchor616" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.74.1">:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer191">
<span class="kobospan" id="kobo.75.1"><img alt="Figure 4.1 – The Zabbix trigger creation page – Service unreachable" src="image/B19803_04_01.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.76.1">Figure 4.1 – The Zabbix trigger creation page – Service unreachable</span></p>
<ol class="calibre16">
<li value="3" class="calibre15"><span class="kobospan" id="kobo.77.1">Click on </span><strong class="bold"><span class="kobospan" id="kobo.78.1">Add</span></strong><span class="kobospan" id="kobo.79.1"> and finish creating the trigger. </span><span class="kobospan" id="kobo.79.2">This will create a trigger for us that will fire </span><a id="_idIndexMarker273" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.80.1">w</span><a id="_idTextAnchor617" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.81.1">hen our </span><strong class="bold"><span class="kobospan" id="kobo.82.1">Secure Shell</span></strong><span class="kobospan" id="kobo.83.1"> (</span><strong class="bold"><span class="kobospan" id="kobo.84.1">SSH</span></strong><span class="kobospan" id="kobo.85.1">) port </span><span><span class="kobospan" id="kobo.86.1">goes down.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.87.1">Let’s test </span><a id="_idIndexMarker274" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.88.1">this by navigat</span><a id="_idTextAnchor618" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.89.1">ing to our host </span><strong class="bold"><span class="kobospan" id="kobo.90.1">command-line interface</span></strong><span class="kobospan" id="kobo.91.1"> (</span><strong class="bold"><span class="kobospan" id="kobo.92.1">CLI</span></strong><span class="kobospan" id="kobo.93.1">) and executing some commands to shut our Zabbix server off from port </span><strong class="source-inline1"><span class="kobospan" id="kobo.94.1">22</span></strong><span class="kobospan" id="kobo.95.1">. </span><span class="kobospan" id="kobo.95.2">We will add an </span><strong class="source-inline1"><span class="kobospan" id="kobo.96.1">iptables</span></strong><span class="kobospan" id="kobo.97.1"> rule to block off all incoming traffic on port </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.98.1">22</span></strong></span><span><span class="kobospan" id="kobo.99.1"> (SSH):</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.100.1">iptables -A INPUT -p tcp -i ens192 -s 10.16.16.152</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.101.1">--destination-port 22 -j DROP</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.102.1">Make </span><a id="_idIndexMarker275" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.103.1">sure to change the </span><strong class="source-inline1"><span class="kobospan" id="kobo.104.1">ens192</span></strong><span class="kobospan" id="kobo.105.1"> network </span><a id="_idIndexMarker276" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.106.1">card and the IP address </span><strong class="source-inline1"><span class="kobospan" id="kobo.107.1">10.16.16.152</span></strong><span class="kobospan" id="kobo.108.1"> to your own values. </span><span class="kobospan" id="kobo.108.2">You can use the following co</span><a id="_idTextAnchor619" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.109.1">mmand to get </span><span><span class="kobospan" id="kobo.110.1">that information:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.111.1">ip addr</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.112.1">Now, if we click on </span><strong class="bold"><span class="kobospan" id="kobo.113.1">Dashboards</span></strong><span class="kobospan" id="kobo.114.1"> in the navigation bar, after a while we should see </span><span><span class="kobospan" id="kobo.115.1">the follow</span><a id="_idTextAnchor620" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.116.1">ing:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer192">
<span class="kobospan" id="kobo.117.1"><img alt="Figure 4.2 – Zabbix problems on a dashboard – port 22 down" src="image/B19803_04_02.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.118.1">Figure 4.2 – Zabbix problems on a dashboard – port 22 down</span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.119.1">Trigger 2 – triggering when there is a new Zabbix version</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.120.1">Now, to create </span><a id="_idIndexMarker277" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.121.1">our second trigger, let’s ramp it up a bit. </span><span class="kobospan" id="kobo.121.2">If you followed </span><span><em class="italic"><span class="kobospan" id="kobo.122.1">Chapter 3</span></em></span><span class="kobospan" id="kobo.123.1">, </span><em class="italic"><span class="kobospan" id="kobo.124.1">Setting Up Zabbix Monitoring</span></em><span class="kobospan" id="kobo.125.1">, in the recipe titled </span><em class="italic"><span class="kobospan" id="kobo.126.1">Setting up HTTP agent monitoring</span></em><span class="kobospan" id="kobo.127.1">, we created an item that polls the Zabbix website for the latest release </span><a id="_idIndexMarker278" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.128.1">of Zabbix, Zabbix 7.0. </span><span class="kobospan" id="kobo.128.2">Now, what we probably want to do ourselves is keep an eye out for any new version of Zabbix </span><span><span class="kobospan" id="kobo.129.1">being released:</span></span></p>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.130.1">Let’s navigate to </span><strong class="bold"><span class="kobospan" id="kobo.131.1">Data collection</span></strong><span class="kobospan" id="kobo.132.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.133.1">Hosts</span></strong><span class="kobospan" id="kobo.134.1"> and click on the </span><span><strong class="bold"><span class="kobospan" id="kobo.135.1">lar-book-agent_simple</span></strong></span><span><span class="kobospan" id="kobo.136.1"> host.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.137.1">Now, go to </span><strong class="bold"><span class="kobospan" id="kobo.138.1">Triggers</span></strong><span class="kobospan" id="kobo.139.1"> and click the </span><strong class="bold"><span class="kobospan" id="kobo.140.1">Create trigger</span></strong><span class="kobospan" id="kobo.141.1"> button. </span><span class="kobospan" id="kobo.141.2">We will build our trigge</span><a id="_idTextAnchor621" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.142.1">r with the </span><span><span class="kobospan" id="kobo.143.1">following sett</span><a id="_idTextAnchor622" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.144.1">ings:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer193">
<span class="kobospan" id="kobo.145.1"><img alt="Figure 4.3 – The Zabbix trigger creation page – new Zabbix 7.0 release trigger" src="image/B19803_04_03.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.146.1">Figure 4.3 – The Zabbix trigger creation page – new Zabbix 7.0 release trigger</span></p>
<ol class="calibre16">
<li value="3" class="calibre15"><span class="kobospan" id="kobo.147.1">Click on </span><strong class="bold"><span class="kobospan" id="kobo.148.1">A</span><a id="_idTextAnchor623" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.149.1">dd</span></strong><span class="kobospan" id="kobo.150.1"> and </span><a id="_idIndexMarker279" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.151.1">finish creating </span><span><span class="kobospan" id="kobo.152.1">the trigger.</span></span></li>
</ol>
<p class="calibre3"><span class="kobospan" id="kobo.153.1">Now, this might </span><a id="_idIndexMarker280" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.154.1">not actually trigger for you in the frontend, but I’ll explain to you just how this trigger works in the </span><em class="italic"><span class="kobospan" id="kobo.155.1">How it works…</span></em><span class="kobospan" id="kobo.156.1"> section of </span><span><span class="kobospan" id="kobo.157.1">this recipe.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.158.1">Trigger 3 – using multiple items in a trigger</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.159.1">We ha</span><a id="_idTextAnchor624" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.160.1">ve </span><a id="_idIndexMarker281" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.161.1">seen triggers that use one item, but we can also use multiple items in a single trigger. </span><span class="kobospan" id="kobo.161.2">Let’s build a new trigger by using multiple items in the </span><span><span class="kobospan" id="kobo.162.1">same expression:</span></span></p>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.163.1">Let’s navigate to </span><strong class="bold"><span class="kobospan" id="kobo.164.1">Data collection</span></strong><span class="kobospan" id="kobo.165.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.166.1">Hosts</span></strong><span class="kobospan" id="kobo.167.1"> and click on the </span><strong class="bold"><span class="kobospan" id="kobo.168.1">lar-book-agent_ passive</span></strong><span class="kobospan" id="kobo.169.1"> host. </span><span class="kobospan" id="kobo.169.2">Now, go to </span><strong class="bold"><span class="kobospan" id="kobo.170.1">Triggers</span></strong><span class="kobospan" id="kobo.171.1"> and click the </span><strong class="bold"><span class="kobospan" id="kobo.172.1">Create </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.173.1">trigger</span></strong></span><span><span class="kobospan" id="kobo.174.1"> button.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.175.1">We are </span><a id="_idIndexMarker282" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.176.1">going to create a trigger with the </span><span><span class="kobospan" id="kobo.177.1">following s</span><a id="_idTextAnchor625" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.178.1">ettings:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer194">
<span class="kobospan" id="kobo.179.1"><img alt="Figure 4.4 – The Zabbix trigger creation page – inbound or outbound packets trigger" src="image/B19803_04_04.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.180.1">Figure 4.4 – The Zabbix trigger creation page – inbound or outbound packets trigger</span></p>
<ol class="calibre16">
<li value="3" class="calibre15"><span class="kobospan" id="kobo.181.1">Pl</span><a id="_idTextAnchor626" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.182.1">ease note that your item keys might need different interface names. </span><span class="kobospan" id="kobo.182.2">In my case, the interface is called </span><strong class="source-inline1"><span class="kobospan" id="kobo.183.1">ens192</span></strong><span class="kobospan" id="kobo.184.1">, so use the correct name for your interface in its place. </span><span class="kobospan" id="kobo.184.2">Use the following Linux command to get the interface on </span><span><span class="kobospan" id="kobo.185.1">your host:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.186.1">ip addr</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.187.1">Click on </span><strong class="bold"><span class="kobospan" id="kobo.188.1">Add</span></strong><span class="kobospan" id="kobo.189.1"> and finish creating </span><span><span class="kobospan" id="kobo.190.1">the trigger.</span></span><p class="calibre3"><strong class="bold"><span class="kobospan" id="kobo.191.1">Here's a tip - </span></strong><span class="kobospan" id="kobo.192.1">On the trigger creation page, use the </span><strong class="bold"><span class="kobospan" id="kobo.193.1">Add</span></strong><span class="kobospan" id="kobo.194.1"> button next to the </span><strong class="bold"><span class="kobospan" id="kobo.195.1">Expression</span></strong><span class="kobospan" id="kobo.196.1"> field to add a condition and build your expression easily. </span><span class="kobospan" id="kobo.196.2">For example, we can use the </span><strong class="bold"><span class="kobospan" id="kobo.197.1">Select</span></strong><span class="kobospan" id="kobo.198.1"> button to pick an item from a list. </span><span class="kobospan" id="kobo.198.2">Something that’s also very useful, when using the </span><strong class="bold"><span class="kobospan" id="kobo.199.1">Function</span></strong><span class="kobospan" id="kobo.200.1"> drop-down menu, is the short explanation for every trigger function </span><span><span class="kobospan" id="kobo.201.1">that’s in</span><a id="_idTextAnchor627" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.202.1">cluded:</span></span></p></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer195">
<span class="kobospan" id="kobo.203.1"><img alt="Figure 4.5 – Trigger creation page" src="image/B19803_04_05.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.204.1">Figure 4.5 – Trigger creation page</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.205.1">That’s</span><a id="_idTextAnchor628" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.206.1"> all we need to do to build a trigger that will function on </span><span><span class="kobospan" id="kobo.207.1">two</span><a id="_idTextAnchor629" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor630" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.208.1"> items.</span></span></p>
<h2 id="_idParaDest-126" class="calibre7"><a id="_idTextAnchor631" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.209.1">How it works…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.210.1">We need </span><a id="_idIndexMarker283" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.211.1">a good understanding of how to build triggers and how they work so we can create a well-set-up monitoring platform. </span><span class="kobospan" id="kobo.211.2">Especially important here is that we make sure that our triggers are set up correctly and we test them well. </span><span class="kobospan" id="kobo.211.3">Triggers are a very important</span><a id="_idTextAnchor632" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.212.1"> part of Zabbix as they will be vital to inform you about things going on with your monitoring targets. </span><span class="kobospan" id="kobo.212.2">Configure your triggers too loosely and you will be missing things. </span><span class="kobospan" id="kobo.212.3">Configure them too strictly and you will be overloaded </span><span><span class="kobospan" id="kobo.213.1">with information.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.214.1">In all of these trig</span><a id="_idTextAnchor633" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.215.1">gers, we have also included a trigger severity, as we can see in the </span><span><span class="kobospan" id="kobo.216.1">following scre</span><a id="_idTextAnchor634" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.217.1">enshot:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer196">
<span class="kobospan" id="kobo.218.1"><img alt="Figure 4.6 – A Zabbix trigger severity selector" src="image/B19803_04_06.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.219.1">Figure 4.6 – A Zabbix trigger severity selector</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.220.1">These severities are important to make sure your alerts will be correctly defined by importance. </span><span class="kobospan" id="kobo.220.2">We can also filter on these severities in several places in the Zabbix fron</span><a id="_idTextAnchor635" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.221.1">tend and even in things such </span><span><span class="kobospan" id="kobo.222.1">as actions.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.223.1">Now, let’s discover why we built our triggers as </span><span><span class="kobospan" id="kobo.224.1">we did.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.225.1">Trigger 1 – SSH service monitoring</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.226.1">This is a very simple but effective trigger to set up in Zabbix. </span><span class="kobospan" id="kobo.226.2">When our value returns either </span><strong class="source-inline"><span class="kobospan" id="kobo.227.1">1</span></strong><span class="kobospan" id="kobo.228.1"> for </span><strong class="source-inline"><span class="kobospan" id="kobo.229.1">UP</span></strong><span class="kobospan" id="kobo.230.1"> or </span><strong class="source-inline"><span class="kobospan" id="kobo.231.1">0</span></strong><span class="kobospan" id="kobo.232.1"> for </span><strong class="source-inline"><span class="kobospan" id="kobo.233.1">DOWN</span></strong><span class="kobospan" id="kobo.234.1">, we can easily create triggers such as these—not just for monitoring </span><a id="_idIndexMarker284" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.235.1">logical ports that are up or down, but for everything that returns a simple val</span><a id="_idTextAnchor636" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.236.1">ue change from, for example, </span><strong class="source-inline"><span class="kobospan" id="kobo.237.1">1</span></strong><span class="kobospan" id="kobo.238.1"> to </span><strong class="source-inline"><span class="kobospan" id="kobo.239.1">0</span></strong><span class="kobospan" id="kobo.240.1"> and </span><span><span class="kobospan" id="kobo.241.1">vice versa.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.242.1">Now, if we break down our expression, we have </span><span><span class="kobospan" id="kobo.243.1">the fol</span><a id="_idTextAnchor637" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.244.1">lowing:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer197">
<span class="kobospan" id="kobo.245.1"><img alt="Figure 4.7 – A Zabbix trigger expression – port 22 (SSH)" src="image/B19803_04_07.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.246.1">Figure 4.7 – A Zabbix trigger expression – port 22 (SSH)</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.247.1">When buil</span><a id="_idTextAnchor638" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.248.1">ding an expression, we have </span><span><span class="kobospan" id="kobo.249.1">four parts:</span></span></p>
<ul class="calibre14">
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.250.1">Trigger function</span></strong><span class="kobospan" id="kobo.251.1">: The trigger function is the part of the expression that determines </span><a id="_idIndexMarker285" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.252.1">what we expect of the value, such as whether we want just the last value or, for example, an average value over a period </span><span><span class="kobospan" id="kobo.253.1">of time.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.254.1">Host</span></strong><span class="kobospan" id="kobo.255.1">: The host </span><a id="_idIndexMarker286" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.256.1">part of the expression is where we define which host we are using to trigger on. </span><span class="kobospan" id="kobo.256.2">Most of the time, it’s simply just the host (or template) we are </span><span><span class="kobospan" id="kobo.257.1">working on.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.258.1">Item key</span></strong><span class="kobospan" id="kobo.259.1">: The item </span><a id="_idIndexMarker287" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.260.1">key is the part of the expression where we define which item key we’ll be using to retrieve the value(s) on a host and feed it into the </span><span><span class="kobospan" id="kobo.261.1">trigger function.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.262.1">Operator</span></strong><span class="kobospan" id="kobo.263.1">: The </span><a id="_idIndexMarker288" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.264.1">operator determines how our function will be calculated based on the trigger expression—against a constant or another expression, for example. </span><span class="kobospan" id="kobo.264.2">The operator can be anything, </span><a id="_idTextAnchor639" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.265.1">such as </span><span><span class="kobospan" id="kobo.266.1">th</span><a id="_idTextAnchor640" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.267.1">e following:</span></span></li>
</ul>
<table class="no-table-style" id="table001-2">
<colgroup class="calibre10">
<col class="calibre11"/>
<col class="calibre11"/>
</colgroup>
<tbody class="calibre13">
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.268.1">=</span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.269.1">Equal to.</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.270.1">&lt;&gt;</span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.271.1">Not </span><span><span class="kobospan" id="kobo.272.1">equal to.</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.273.1">&gt;</span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.274.1">Bigger than.</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.275.1">&lt;</span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.276.1">Smaller than.</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.277.1">&gt;=</span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.278.1">Bigger than or </span><span><span class="kobospan" id="kobo.279.1">equal to.</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.280.1">&lt;=</span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.281.1">Smaller than or </span><span><span class="kobospan" id="kobo.282.1">equal to.</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.283.1">+</span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.284.1">Add to.</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.285.1">-</span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.286.1">Subtract from.</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.287.1">/</span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.288.1">Divide by.</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.289.1">*</span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.290.1">Multiply by.</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.291.1">and</span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.292.1">Logical AND. </span><span class="kobospan" id="kobo.292.2">Used to, for example, equal both one and </span><span><span class="kobospan" id="kobo.293.1">another expression.</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.294.1">or</span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.295.1">Logical OR. </span><span class="kobospan" id="kobo.295.2">Used to, for example, equal either one or </span><span><span class="kobospan" id="kobo.296.1">another epxression.</span></span></p>
</td>
</tr>
<tr class="no-table-style1">
<td class="no-table-style2">
<p class="calibre3"><span><span class="kobospan" id="kobo.297.1">not</span></span></p>
</td>
<td class="no-table-style2">
<p class="calibre3"><span class="kobospan" id="kobo.298.1">Logical NOT. </span><span class="kobospan" id="kobo.298.2">Used to, for example, specifically not equal </span><span><span class="kobospan" id="kobo.299.1">an expression.</span></span></p>
</td>
</tr>
</tbody>
</table>
<ul class="calibre14">
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.300.1">Constant</span></strong><span class="kobospan" id="kobo.301.1">: The constant </span><a id="_idIndexMarker289" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.302.1">is the actual constant (often a value) that our trigger function uses t</span><a id="_idTextAnchor641" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.303.1">o determine whether the trigger should be in an </span><strong class="source-inline1"><span class="kobospan" id="kobo.304.1">OK</span></strong><span class="kobospan" id="kobo.305.1"> or </span><strong class="source-inline1"><span class="kobospan" id="kobo.306.1">PROBLEM</span></strong><span class="kobospan" id="kobo.307.1"> state. </span><span class="kobospan" id="kobo.307.2">We can also use </span><span><span class="kobospan" id="kobo.308.1">macros here.</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.309.1">Now, for our first trigger, we defined our host and the item that gives us the SSH status. </span><span class="kobospan" id="kobo.309.2">What we are saying in the trigger function is that we want the last value to be </span><strong class="source-inline"><span class="kobospan" id="kobo.310.1">0</span></strong><span class="kobospan" id="kobo.311.1"> before </span><span><span class="kobospan" id="kobo.312.1">triggering it.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.313.1">For this item, that </span><a id="_idIndexMarker290" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.314.1">would mean it would trigger within a minute because in our item, we specified </span><span><span class="kobospan" id="kobo.315.1">the following:</span></span><a id="_idTextAnchor642" class="pcalibre calibre6 pcalibre1"/></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer198">
<span class="kobospan" id="kobo.316.1"><img alt="Figure 4.8 – The Zabbix item configuration page – port 22 availability item" src="image/B19803_04_08.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.317.1">Figure 4.8 – The Zabbix item configuration page – port 22 availability item</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.318.1">Looking a</span><a id="_idTextAnchor643" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.319.1">t the </span><strong class="bold"><span class="kobospan" id="kobo.320.1">Update interval</span></strong><span class="kobospan" id="kobo.321.1"> field on the </span><strong class="bold"><span class="kobospan" id="kobo.322.1">Item</span></strong><span class="kobospan" id="kobo.323.1"> configuration page, we can determine that when building this trigger, we are expecting our value to be </span><strong class="source-inline"><span class="kobospan" id="kobo.324.1">0</span></strong><span class="kobospan" id="kobo.325.1"> and that it will take a maximum of one minute of SSH port </span><strong class="source-inline"><span class="kobospan" id="kobo.326.1">22</span></strong><span class="kobospan" id="kobo.327.1"> downtime due to the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.328.1">1m</span></strong></span><span><span class="kobospan" id="kobo.329.1"> interval.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.330.1">Trigger 2 – triggering when there is a new Zabbix version</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.331.1">Now, for ou</span><a id="_idTextAnchor644" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.332.1">r second trigger, we did something different. </span><span class="kobospan" id="kobo.332.2">We not only made an expression for triggering this problem but also one for recovering from the trigger. </span><span class="kobospan" id="kobo.332.3">What we do in the </span><strong class="bold"><span class="kobospan" id="kobo.333.1">Problem expression</span></strong><span class="kobospan" id="kobo.334.1"> option is define a trigger function, telling our host to compare the </span><a id="_idIndexMarker291" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.335.1">last value with the value before it. </span><span class="kobospan" id="kobo.335.2">We did this by using the </span><strong class="bold"><span class="kobospan" id="kobo.336.1">change</span></strong> <span><span class="kobospan" id="kobo.337.1">trigger function.</span></span><a id="_idTextAnchor645" class="pcalibre calibre6 pcalibre1"/></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer199">
<span class="kobospan" id="kobo.338.1"><img alt="Figure 4.9 – A Zabbix trigger expression – HTTPS check" src="image/B19803_04_09.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.339.1">Figure 4.9 – A Zabbix trigger expression – HTTPS check</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.340.1">So, our trigger will only be activated when the latest Zabbix version has been changed. </span><span class="kobospan" id="kobo.340.2">We could just let the trigger resolve the first time the current value and the value before that are the same again, but I want to keep this trigger in the </span><strong class="source-inline"><span class="kobospan" id="kobo.341.1">PROBLEM</span></strong><span class="kobospan" id="kobo.342.1"> state just a </span><span><span class="kobospan" id="kobo.343.1">little longer.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.344.1">Therefore, I defined</span><a id="_idTextAnchor646" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.345.1"> a recovery expression as well. </span><span class="kobospan" id="kobo.345.2">I’m telling it that this problem can only be recovered if the last received value and the fifth last are received. </span><span class="kobospan" id="kobo.345.3">Check out the recovery expression </span><span><span class="kobospan" id="kobo.346.1">up close:</span></span></p>
<p class="calibre3"><a id="_idTextAnchor647" class="pcalibre calibre6 pcalibre1"/></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer200">
<span class="kobospan" id="kobo.347.1"><img alt="Figure 4.10 – Another Zabbix trigger expression – HTTPS check with different value" src="image/B19803_04_10.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.348.1">Figure 4.10 – Another Zabbix trigger expression – HTTPS check with different value</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.349.1">Recovery expressions are powerful when you want to extend your trigger functionality with just a bit more control over when it comes back into the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.350.1">OK</span></strong></span><span><span class="kobospan" id="kobo.351.1"> state.</span></span></p>
<p class="callout-heading"><span class="kobospan" id="kobo.352.1">Tip</span></p>
<p class="callout"><span class="kobospan" id="kobo.353.1">You can use the recovery expression to extend the trigger’s </span><strong class="source-inline1"><span class="kobospan" id="kobo.354.1">PROBLEM</span></strong><span class="kobospan" id="kobo.355.1"> state beyond what you defined in the </span><strong class="bold"><span class="kobospan" id="kobo.356.1">Problem expression</span></strong><span class="kobospan" id="kobo.357.1"> option. </span><span class="kobospan" id="kobo.357.2">This way, we know we are still close to the </span><strong class="source-inline1"><span class="kobospan" id="kobo.358.1">PROBLEM</span></strong><span class="kobospan" id="kobo.359.1"> state. </span><span class="kobospan" id="kobo.359.2">We define that we only want the trigger to go back to the </span><strong class="source-inline1"><span class="kobospan" id="kobo.360.1">OK</span></strong><span class="kobospan" id="kobo.361.1"> state after we’ve reached another threshold as defined in the recovery expression. </span><span class="kobospan" id="kobo.361.2">This will work by evaluating both the problem and recovery expressions, where the problem expression has to be </span><strong class="source-inline1"><span class="kobospan" id="kobo.362.1">FALSE</span></strong><span class="kobospan" id="kobo.363.1"> and the recovery </span><span><span class="kobospan" id="kobo.364.1">expression </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.365.1">TRUE</span></strong></span><span><span class="kobospan" id="kobo.366.1">.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.367.1">Trigger 3 – using multiple items in a trigger</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.368.1">Now, trigger 3 </span><a id="_idIndexMarker292" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.369.1">might</span><a id="_idTextAnchor648" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.370.1"> seem complicated because we’ve </span><a id="_idIndexMarker293" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.371.1">used more than one item, but it’s basically the </span><span><span class="kobospan" id="kobo.372.1">same setup:</span></span><a id="_idTextAnchor649" class="pcalibre calibre6 pcalibre1"/></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer201">
<span class="kobospan" id="kobo.373.1"><img alt="Figure 4.11 – A Zabbix trigger expression using several items" src="image/B19803_04_11.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.374.1">Figure 4.11 – A Zabbix trigger expression using several items</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.375.1">We have the same setup for the expression, with the function, host, item key, and value. </span><span class="kobospan" id="kobo.375.2">Yet when we are working with multiple items, we can add an </span><strong class="source-inline"><span class="kobospan" id="kobo.376.1">or</span></strong><span class="kobospan" id="kobo.377.1"> statement between the items. </span><span class="kobospan" id="kobo.377.2">This way, we can say we need to match one of the items before triggering the </span><strong class="source-inline"><span class="kobospan" id="kobo.378.1">PROBLEM</span></strong><span class="kobospan" id="kobo.379.1"> state. </span><span class="kobospan" id="kobo.379.2">In this case, we trigger when either item exceeds </span><span><span class="kobospan" id="kobo.380.1">the threshold.</span></span></p>
<p class="callout-heading"><span class="kobospan" id="kobo.381.1">Important note</span></p>
<p class="callout"><span class="kobospan" id="kobo.382.1">In this trigger expression, we have some empty lines between the different item expressions. </span><span class="kobospan" id="kobo.382.2">Empty lines between item expressions are totally fine and actually make for good readability. </span><span class="kobospan" id="kobo.382.3">Use this wisely when </span><span><span class="kobospan" id="kobo.383.1">building triggers.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.384.1">Old versus new trigger expression syntax</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.385.1">Now, if </span><a id="_idIndexMarker294" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.386.1">you’</span><a id="_idTextAnchor650" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.387.1">ve worked </span><a id="_idIndexMarker295" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.388.1">wi</span><a id="_idTextAnchor651" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.389.1">th Zabbix before version 5.4, the next part might be interesting to you. </span><span class="kobospan" id="kobo.389.2">As mentioned in our introduction, there has been a big update to expressions within Zabbix. </span><span class="kobospan" id="kobo.389.3">Trigger expressions now work in a new way, which is the same way as you will see in calculated items and other places for a </span><span><span class="kobospan" id="kobo.390.1">unified experience.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.391.1">Let’s take a look at the old expression syntax as seen in Zabbix 5.2 and </span><span><span class="kobospan" id="kobo.392.1">older versions</span><a id="_idTextAnchor652" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.393.1">:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer202">
<span class="kobospan" id="kobo.394.1"><img alt="Figure 4.12 – A Zabbix trigger expression using the old syntax" src="image/B19803_04_12.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.395.1">Figure 4.12 – A Zabbix trigger expression using the old syntax</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.396.1">In the old syntax, we always started with a </span><em class="italic"><span class="kobospan" id="kobo.397.1">curly bracket</span></em><span class="kobospan" id="kobo.398.1"> and then the hostname or template name. </span><span class="kobospan" id="kobo.398.2">Between the hostname or template name and the item key, we had a colon. </span><span class="kobospan" id="kobo.398.3">Marking the end of the item key, we had a </span><em class="italic"><span class="kobospan" id="kobo.399.1">dot</span></em><span class="kobospan" id="kobo.400.1">, but item keys can also include dots themselves. </span><span class="kobospan" id="kobo.400.2">Then, after the </span><em class="italic"><span class="kobospan" id="kobo.401.1">dot</span></em><span class="kobospan" id="kobo.402.1">, we have the trigger function followed by the ending </span><em class="italic"><span class="kobospan" id="kobo.403.1">curly bracket</span></em><span class="kobospan" id="kobo.404.1">. </span><span class="kobospan" id="kobo.404.2">Then, all we have left is the operator and constant we want to compare the </span><span><span class="kobospan" id="kobo.405.1">expression against.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.406.1">As you can imagine, this could become confusing at times, especially when using dots in item keys. </span><span class="kobospan" id="kobo.406.2">Now let’s check out the new </span><span><span class="kobospan" id="kobo.407.1">trigger syntax:</span></span><a id="_idTextAnchor653" class="pcalibre calibre6 pcalibre1"/></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer203">
<span class="kobospan" id="kobo.408.1"><img alt="Figure 4.13 – A Zabbix trigger expression using the new syntax" src="image/B19803_04_13.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.409.1">Figure 4.13 – A Zabbix trigger expression using the new syntax</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.410.1">Our </span><a id="_idIndexMarker296" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.411.1">new trigger </span><a id="_idIndexMarker297" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.412.1">syntax starts off right away with our trigger function; no hassle, just immediately showing you what we’re doing with this line. </span><span class="kobospan" id="kobo.412.2">This is followed by a </span><em class="italic"><span class="kobospan" id="kobo.413.1">bracket</span></em><span class="kobospan" id="kobo.414.1"> and a </span><em class="italic"><span class="kobospan" id="kobo.415.1">forward slash</span></em><span class="kobospan" id="kobo.416.1"> before entering the host or template name. </span><span class="kobospan" id="kobo.416.2">We then use another </span><em class="italic"><span class="kobospan" id="kobo.417.1">forward slash</span></em> <a id="_idTextAnchor654" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.418.1">to divide t</span><a id="_idTextAnchor655" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.419.1">he hostname or template name and the item key. </span><span class="kobospan" id="kobo.419.2">We end with a </span><em class="italic"><span class="kobospan" id="kobo.420.1">bracket</span></em><span class="kobospan" id="kobo.421.1">, and then all we have left is the operator and value we want to hold the </span><span><span class="kobospan" id="kobo.422.1">expression against.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.423.1">Starting with the trigger function makes for a clear indicator of what your line is doing. </span><span class="kobospan" id="kobo.423.2">Putting the hostname or template name into brackets and then dividing it with forward slashes from the item key makes for a more cohesive experience when writing expressions. </span><span class="kobospan" id="kobo.423.3">We also don’t have confusing extra dots any longer. </span><span class="kobospan" id="kobo.423.4">Altogether a very nice change to the trigger syntax, which in all honesty might take a bit of time to get </span><span><span class="kobospan" id="kobo.424.1">used to.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.425.1">It’s the small stuff that makes the entire software feel more professional and well thought out. </span><span class="kobospan" id="kobo.425.2">Zabbix including changes such as these really helps </span><span><span class="kobospan" id="kobo.426.1">with tha</span><a id="_idTextAnchor656" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor657" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.427.1">t.</span></span></p>
<h2 id="_idParaDest-127" class="calibre7"><a id="_idTextAnchor658" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.428.1">There’s more…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.429.1">Not only can </span><a id="_idTextAnchor659" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.430.1">we match one of the items in a trigger expression, but we can also use an </span><strong class="source-inline"><span class="kobospan" id="kobo.431.1">and</span></strong><span class="kobospan" id="kobo.432.1"> statement. </span><span class="kobospan" id="kobo.432.2">This way, we can make sure our trigger only goes into a </span><strong class="source-inline"><span class="kobospan" id="kobo.433.1">PROBLEM</span></strong><span class="kobospan" id="kobo.434.1"> state when multiple items are reaching a certain value. </span><span class="kobospan" id="kobo.434.2">Triggers are very powerful like this, allowing us to define our own criteria in great detail. </span><span class="kobospan" id="kobo.434.3">There’s no predefinition—we can add as many </span><strong class="source-inline"><span class="kobospan" id="kobo.435.1">and</span></strong><span class="kobospan" id="kobo.436.1">, </span><strong class="source-inline"><span class="kobospan" id="kobo.437.1">not</span></strong><span class="kobospan" id="kobo.438.1">, or </span><strong class="source-inline"><span class="kobospan" id="kobo.439.1">or</span></strong><span class="kobospan" id="kobo.440.1"> statements and different functions as we like in the trigger expressions. </span><span class="kobospan" id="kobo.440.2">Customize your triggers to exactly what you need, and suddenly you are going to have a lot more peace of mind beca</span><a id="_idTextAnchor660" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.441.1">use you know your triggers will notify you when something </span><span><span class="kobospan" id="kobo.442.1">is u</span><a id="_idTextAnchor661" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor662" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.443.1">p.</span></span></p>
<h2 id="_idParaDest-128" class="calibre7"><a id="_idTextAnchor663" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.444.1">See also</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.445.1">To know </span><a id="_idIndexMarker298" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.446.1">more about trigger expressions, check out the Zabbix documentation. </span><span class="kobospan" id="kobo.446.2">There’s a lot of information</span><a id="_idTextAnchor664" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.447.1"> on which functions you can use to build the perfect trigger. </span><span class="kobospan" id="kobo.447.2">For more details, go </span><span><span class="kobospan" id="kobo.448.1">to </span></span><a href="https://www.zabbix.com/documentation/current/en/manual/config/triggers/expression" class="pcalibre calibre6 pcalibre1"><span><span class="kobospan" id="kobo.449.1">https://www.zabbix.com/documentation/current/en/manual/config/triggers/expressi</span><span id="_idTextAnchor665"/><span id="_idTextAnchor666"/><span class="kobospan" id="kobo.450.1">on</span></span></a><span><span class="kobospan" id="kobo.451.1">.</span></span></p>
<h1 id="_idParaDest-129" class="calibre5"><a id="_idTextAnchor667" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.452.1">Setting up advanced triggers</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.453.1">Triggers in Zab</span><a id="_idTextAnchor668" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.454.1">bix keep getting more advanced and it might be hard to keep up. </span><span class="kobospan" id="kobo.454.2">For people working </span><a id="_idIndexMarker299" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.455.1">with Zabbix 5.2 or older and upgrading to Zabbix 7, not only is there a new Zabbix trigger syntax but there’s also a whole new array </span><span><span class="kobospan" id="kobo.456.1">of functions.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.457.1">Let’s dive into setting up some more advanced triggers in </span><span><span class="kobospan" id="kobo.458.1">Zabbi</span><a id="_idTextAnchor669" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor670" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.459.1">x 7.</span></span></p>
<h2 id="_idParaDest-130" class="calibre7"><a id="_idTextAnchor671" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.460.1">Getting ready</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.461.1">For this recipe, we will need our Zabbix server ready and we’ll need one host that is monitored by a Zabbix agent with the Zabbix agent template. </span><span class="kobospan" id="kobo.461.2">We’ll use the items on this host to create triggers. </span><span class="kobospan" id="kobo.461.3">Let’s use the </span><strong class="source-inline"><span class="kobospan" id="kobo.462.1">lar-book-agent_passive</span></strong><span class="kobospan" id="kobo.463.1"> host from the </span><span><span class="kobospan" id="kobo.464.1">previous chapter.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.465.1">If you don’t have this host from the previous chapter, simply hook up a new host with the default passive Linux monitoring template called </span><strong class="source-inline"><span class="kobospan" id="kobo.466.1">Linux by </span></strong><span><strong class="source-inline"><span class="kobospan" id="kobo.467.1">Zabbix agent</span></strong></span><span><span class="kobospan" id="kobo.468.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.469.1">We’ll also be touching on some more advanced topics that are discussed later in the book. </span><span class="kobospan" id="kobo.469.2">If you </span><a id="_idIndexMarker300" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.470.1">don’t</span><a id="_idTextAnchor672" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.471.1"> know how to use </span><strong class="bold"><span class="kobospan" id="kobo.472.1">Low-Level Discovery</span></strong><span class="kobospan" id="kobo.473.1"> (</span><strong class="bold"><span class="kobospan" id="kobo.474.1">LLD</span></strong><span class="kobospan" id="kobo.475.1">), for example, it might be a good idea to dive into </span><a href="B19803_07.xhtml#_idTextAnchor1318" class="pcalibre calibre6 pcalibre1"><span><em class="italic"><span class="kobospan" id="kobo.476.1">Chapter 7</span></em></span></a><span class="kobospan" id="kobo.477.1">, </span><em class="italic"><span class="kobospan" id="kobo.478.1">Using Discovery for Automatic </span></em><span><em class="italic"><span class="kobospan" id="kobo.479.1">Creation</span></em></span><span><span class="kobospan" id="kobo.480.1">, f</span><a id="_idTextAnchor673" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor674" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.481.1">irst.</span></span></p>
<h2 id="_idParaDest-131" class="calibre7"><a id="_idTextAnchor675" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.482.1">How to do it…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.483.1">Let’s take a look at three </span><em class="italic"><span class="kobospan" id="kobo.484.1">more advanced</span></em><span class="kobospan" id="kobo.485.1"> triggers compared to the three we’ve seen in the previous recipe: </span><strong class="source-inline"><span class="kobospan" id="kobo.486.1">trendavg</span></strong><span class="kobospan" id="kobo.487.1"> for going through trend data, </span><strong class="source-inline"><span class="kobospan" id="kobo.488.1">timeleft</span></strong><span class="kobospan" id="kobo.489.1"> to predict values in the </span><a id="_idIndexMarker301" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.490.1">future, and </span><strong class="bold"><span class="kobospan" id="kobo.491.1">time shifting</span></strong><span class="kobospan" id="kobo.492.1"> to compare to </span><span><span class="kobospan" id="kobo.493.1">the past.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.494.1">Advanced trigger 1 – trendavg function</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.495.1">First</span><a id="_idTextAnchor676" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.496.1">, we’ll </span><a id="_idTextAnchor677" class="pcalibre calibre6 pcalibre1"/><a id="_idIndexMarker302" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.497.1">take a look at one of the newer trigger functionalities, the trend </span><span><span class="kobospan" id="kobo.498.1">average function:</span></span></p>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.499.1">Let’s start by creating a new trigger in our frontend. </span><span class="kobospan" id="kobo.499.2">Navigate to </span><strong class="bold"><span class="kobospan" id="kobo.500.1">Data</span></strong> <strong class="bold"><span class="kobospan" id="kobo.501.1">collection</span></strong><span class="kobospan" id="kobo.502.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.503.1">Hosts</span></strong><span class="kobospan" id="kobo.504.1"> and </span><span><span class="kobospan" id="kobo.505.1">select </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.506.1">lar-book-agent_passive</span></strong></span><span><span class="kobospan" id="kobo.507.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.508.1">Navigate to </span><strong class="bold"><span class="kobospan" id="kobo.509.1">Triggers</span></strong><span class="kobospan" id="kobo.510.1"> and click on the blue </span><strong class="bold"><span class="kobospan" id="kobo.511.1">Create trigger</span></strong><span class="kobospan" id="kobo.512.1"> button in the </span><span><span class="kobospan" id="kobo.513.1">top-right corner.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.514.1">Next to the </span><strong class="bold"><span class="kobospan" id="kobo.515.1">Expression</span></strong><span class="kobospan" id="kobo.516.1"> field, click on the white </span><strong class="bold"><span class="kobospan" id="kobo.517.1">Add</span></strong><span class="kobospan" id="kobo.518.1"> button. </span><span class="kobospan" id="kobo.518.2">Fill out the trigger using the </span><span><span class="kobospan" id="kobo.519.1">expression bu</span><a id="_idTextAnchor678" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.520.1">ilder:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer204">
<span class="kobospan" id="kobo.521.1"><img alt="Figure 4.14 – trendavg trigger expression builder" src="image/B19803_04_14.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.522.1">Figure 4.14 – trendavg trigger expression builder</span></p>
<ol class="calibre16">
<li value="4" class="calibre15"><span class="kobospan" id="kobo.523.1">Click on </span><strong class="bold"><span class="kobospan" id="kobo.524.1">Ins</span><a id="_idTextAnchor679" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.525.1">ert</span></strong><span class="kobospan" id="kobo.526.1"> and add a name. </span><span class="kobospan" id="kobo.526.2">It will look like this if </span><span><span class="kobospan" id="kobo.527.1">done corre</span><a id="_idTextAnchor680" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.528.1">ctly.</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer205">
<span class="kobospan" id="kobo.529.1"><img alt="Figure 4.15 – trendavg trigger form filled out" src="image/B19803_04_15.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.530.1">Figure 4.15 – trendavg trigger form filled out</span></p>
<ol class="calibre16">
<li value="5" class="calibre15"><span class="kobospan" id="kobo.531.1">Now let’s </span><a id="_idIndexMarker303" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.532.1">click the blue </span><strong class="bold"><span class="kobospan" id="kobo.533.1">Add</span></strong><span class="kobospan" id="kobo.534.1"> button at the bottom of the page to finish creating </span><span><span class="kobospan" id="kobo.535.1">this trigger.</span></span></li>
</ol>
<p class="calibre3"><span class="kobospan" id="kobo.536.1">That’s all for creating this trigger. </span><span class="kobospan" id="kobo.536.2">Check out the </span><em class="italic"><span class="kobospan" id="kobo.537.1">How it works…</span></em><span class="kobospan" id="kobo.538.1"> section of this recipe to g</span><a id="_idTextAnchor681" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.539.1">et more information about </span><span><span class="kobospan" id="kobo.540.1">the trigger.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.541.1">Advanced trigger 2 – timeleft function</span></h3>
<p class="calibre3"><a id="_idTextAnchor682" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.542.1">Next up </span><a id="_idIndexMarker304" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.543.1">is our </span><strong class="source-inline"><span class="kobospan" id="kobo.544.1">timeleft</span></strong><span class="kobospan" id="kobo.545.1"> function, which is very useful for</span><a id="_idTextAnchor683" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.546.1"> things such as space utilization. </span><span class="kobospan" id="kobo.546.2">Let’s take </span><span><span class="kobospan" id="kobo.547.1">a look:</span></span></p>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.548.1">We’ll create a new trigger in our Zabbix frontend. </span><span class="kobospan" id="kobo.548.2">Navigate to </span><strong class="bold"><span class="kobospan" id="kobo.549.1">Data collection</span></strong><span class="kobospan" id="kobo.550.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.551.1">Hosts</span></strong><span class="kobospan" id="kobo.552.1"> and </span><span><span class="kobospan" id="kobo.553.1">select </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.554.1">lar-book-agent_passive</span></strong></span><span><span class="kobospan" id="kobo.555.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.556.1">Navigate to </span><strong class="bold"><span class="kobospan" id="kobo.557.1">Discovery rules</span></strong><span class="kobospan" id="kobo.558.1"> and click on </span><strong class="bold"><span class="kobospan" id="kobo.559.1">Trigger prototype</span></strong><span class="kobospan" id="kobo.560.1"> next to </span><strong class="bold"><span class="kobospan" id="kobo.561.1">Mounted </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.562.1">filesystem discovery</span></strong></span><span><span class="kobospan" id="kobo.563.1">.</span></span></li>
</ol>
<p class="callout-heading"><span class="kobospan" id="kobo.564.1">Important note</span></p>
<p class="callout"><span class="kobospan" id="kobo.565.1">In this case, we are creating the trigger prototype directly on the host, using an existing template discovery rule. </span><span class="kobospan" id="kobo.565.2">If you want to apply a trigger like this to every host using a template, make sure to create the trigger on a template level. </span><span class="kobospan" id="kobo.565.3">Furthermore, discovery rules are explained further in </span><a href="B19803_07.xhtml#_idTextAnchor1318" class="pcalibre calibre6 pcalibre1"><span><em class="italic"><span class="kobospan" id="kobo.566.1">Chapter 7</span></em></span></a><span class="kobospan" id="kobo.567.1">, </span><em class="italic"><span class="kobospan" id="kobo.568.1">Using Discovery for Automatic Creation</span></em><span class="kobospan" id="kobo.569.1">, of </span><span><span class="kobospan" id="kobo.570.1">this book.</span></span></p>
<ol class="calibre16">
<li value="3" class="calibre15"><span class="kobospan" id="kobo.571.1">Click on </span><strong class="bold"><span class="kobospan" id="kobo.572.1">Create </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.573.1">trigger prototype</span></strong></span><span><span class="kobospan" id="kobo.574.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.575.1">Next to </span><a id="_idIndexMarker305" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.576.1">the </span><strong class="bold"><span class="kobospan" id="kobo.577.1">Expression</span></strong><span class="kobospan" id="kobo.578.1"> field, click on the white </span><strong class="bold"><span class="kobospan" id="kobo.579.1">Add</span></strong><span class="kobospan" id="kobo.580.1"> button. </span><span class="kobospan" id="kobo.580.2">Fill out the trig</span><a id="_idTextAnchor684" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.581.1">ger using the </span><span><span class="kobospan" id="kobo.582.1">expression b</span><a id="_idTextAnchor685" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.583.1">uilder:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer206">
<span class="kobospan" id="kobo.584.1"><img alt="Figure 4.16 – timeleft trigger expression builder" src="image/B19803_04_16.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.585.1">Figure 4.16 – timeleft trigger expression builder</span></p>
<p class="callout-heading"><span class="kobospan" id="kobo.586.1">Important note</span></p>
<p class="callout"><span class="kobospan" id="kobo.587.1">Using short intervals in predictive triggers to predict long time periods is not recommended. </span><span class="kobospan" id="kobo.587.2">Make sure to use the right dataset for the time period we want to use in relation to the time we want </span><span><span class="kobospan" id="kobo.588.1">to predic</span><a id="_idTextAnchor686" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.589.1">t.</span></span></p>
<ol class="calibre16">
<li value="5" class="calibre15"><span class="kobospan" id="kobo.590.1">C</span><a id="_idTextAnchor687" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.591.1">lick the blue </span><strong class="bold"><span class="kobospan" id="kobo.592.1">Insert</span></strong><span class="kobospan" id="kobo.593.1"> button and the finished trigger will look </span><span><span class="kobospan" id="kobo.594.1">like</span><a id="_idTextAnchor688" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.595.1"> this.</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer207">
<span class="kobospan" id="kobo.596.1"><img alt="Figure 4.17 – timeleft trigger form filled out" src="image/B19803_04_17.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.597.1">Figure 4.17 – timeleft trigger form filled out</span></p>
<ol class="calibre16">
<li value="6" class="calibre15"><span class="kobospan" id="kobo.598.1">Click the blue </span><strong class="bold"><span class="kobospan" id="kobo.599.1">Add</span></strong><span class="kobospan" id="kobo.600.1"> button at the bottom </span><a id="_idIndexMarker306" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.601.1">of the page to finish setting up </span><span><span class="kobospan" id="kobo.602.1">the trigger.</span></span></li>
</ol>
<p class="calibre3"><span class="kobospan" id="kobo.603.1">We now have a new trigger using the </span><strong class="source-inline"><span class="kobospan" id="kobo.604.1">timeleft</span></strong><span class="kobospan" id="kobo.605.1"> function to tell us when hard disks are fil</span><a id="_idTextAnchor689" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.606.1">ling up within a week. </span><span class="kobospan" id="kobo.606.2">Check out the </span><em class="italic"><span class="kobospan" id="kobo.607.1">How it works…</span></em><span class="kobospan" id="kobo.608.1"> se</span><a id="_idTextAnchor690" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.609.1">ction of this recipe to get more information about </span><span><span class="kobospan" id="kobo.610.1">the trigger.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.611.1">Advanced trigger 3 – time shifting using mathematical functions</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.612.1">Lastly</span><a id="_idTextAnchor691" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.613.1">, we </span><a id="_idIndexMarker307" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.614.1">are going to work with time shifting, and in this case, we’ll do so in combination with a mathematical function. </span><span class="kobospan" id="kobo.614.2">Time shifting is a little bit of a difficult example, so bear </span><span><span class="kobospan" id="kobo.615.1">with me:</span></span></p>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.616.1">Let’s navigate to </span><strong class="bold"><span class="kobospan" id="kobo.617.1">Data collection</span></strong><span class="kobospan" id="kobo.618.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.619.1">Hosts</span></strong><span class="kobospan" id="kobo.620.1"> and select our </span><span><span class="kobospan" id="kobo.621.1">host, </span></span><span><strong class="bold"><span class="kobospan" id="kobo.622.1">lar-book-agent_passive</span></strong></span><span><span class="kobospan" id="kobo.623.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.624.1">Go to </span><strong class="bold"><span class="kobospan" id="kobo.625.1">Triggers</span></strong><span class="kobospan" id="kobo.626.1"> and click the blue </span><strong class="bold"><span class="kobospan" id="kobo.627.1">Create </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.628.1">trigger</span></strong></span><span><span class="kobospan" id="kobo.629.1"> button.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.630.1">Add the following trigger, as seen in </span><span><span class="kobospan" id="kobo.631.1">the scre</span><a id="_idTextAnchor692" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.632.1">enshot:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer208">
<span class="kobospan" id="kobo.633.1"><img alt="Figure 4.18 – Time shifting average trigger form filled out" src="image/B19803_04_18.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.634.1">Figure 4.18 – Time shifting average trigger form filled out</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.635.1">T</span><a id="_idTextAnchor693" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.636.1">his is</span><a id="_idTextAnchor694" class="pcalibre calibre6 pcalibre1"/> <a id="_idIndexMarker308" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.637.1">a ver</span><a id="_idTextAnchor695" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.638.1">y complex trigger to set up, so let’s dive right into how it’s set up in the </span><em class="italic"><span class="kobospan" id="kobo.639.1">How it </span></em><span><em class="italic"><span class="kobospan" id="kobo.640.1">works…</span></em></span><span> <a id="_idTextAnchor696" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor697" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.641.1">section.</span></span></p>
<h2 id="_idParaDest-132" class="calibre7"><a id="_idTextAnchor698" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.642.1">How it works…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.643.1">Advanced triggers can get very complex. </span><span class="kobospan" id="kobo.643.2">The triggers we have just set up are just the tip of the ic</span><a id="_idTextAnchor699" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.644.1">eberg. </span><span class="kobospan" id="kobo.644.2">Do not worry if these triggers seem intimidating, as there is plentiful documentation out there to help you set them up, which you can find </span><span><span class="kobospan" id="kobo.645.1">here: </span></span><a href="https://www.zabbix.com/documentation/current/en/manual/config/triggers" class="pcalibre calibre6 pcalibre1"><span><span class="kobospan" id="kobo.646.1">https://www.zabbix.com/documentation/current/en/manual/config/triggers</span></span></a><span><span class="kobospan" id="kobo.647.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.648.1">It’s near impossible to cover every single use case in this book, so the triggers we set up will show you what’s possible. </span><span class="kobospan" id="kobo.648.2">Use what you have learned in the examples in your own scenarios, but make sure to apply your own thinking </span><span><span class="kobospan" id="kobo.649.1">to it.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.650.1">Advanced trigger 1 – trendavg function</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.651.1">Let</span><a id="_idTextAnchor700" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.652.1">’s start </span><a id="_idIndexMarker309" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.653.1">off the </span><em class="italic"><span class="kobospan" id="kobo.654.1">How it works…</span></em><span class="kobospan" id="kobo.655.1"> section with the trend aver</span><a id="_idTextAnchor701" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.656.1">age. </span><span class="kobospan" id="kobo.656.2">Trend average is one of the few trigger functions that use trend data instead of history data. </span><span class="kobospan" id="kobo.656.3">Let’s do a short crash course on history and trend data in Zabbix. </span><span class="kobospan" id="kobo.656.4">History data is the exact value every time an item receives data from a monitored host. </span><span class="kobospan" id="kobo.656.5">Trend data is the average, minimum, and maximum values over one hour created from the history data and a count of the number </span><span><span class="kobospan" id="kobo.657.1">of values.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.658.1">Now, let’s look at the available functions for creating triggers using </span><span><span class="kobospan" id="kobo.659.1">trend data:</span></span></p>
<ul class="calibre14">
<li class="calibre15"><strong class="source-inline1"><span class="kobospan" id="kobo.660.1">trendavg</span></strong><span class="kobospan" id="kobo.661.1">: To get the average value from trend values within a </span><span><span class="kobospan" id="kobo.662.1">time period</span></span></li>
<li class="calibre15"><strong class="source-inline1"><span class="kobospan" id="kobo.663.1">trendmax</span></strong><span class="kobospan" id="kobo.664.1">: To get the maximum value from trend values within a </span><span><span class="kobospan" id="kobo.665.1">time period</span></span></li>
<li class="calibre15"><strong class="source-inline1"><span class="kobospan" id="kobo.666.1">trendmin</span></strong><span class="kobospan" id="kobo.667.1">: To get the minimum value from trend values within a </span><span><span class="kobospan" id="kobo.668.1">time period</span></span></li>
<li class="calibre15"><strong class="source-inline1"><span class="kobospan" id="kobo.669.1">trendcount</span></strong><span class="kobospan" id="kobo.670.1">: To get the number of retrieved trend values within a </span><span><span class="kobospan" id="kobo.671.1">time period</span></span></li>
<li class="calibre15"><strong class="source-inline1"><span class="kobospan" id="kobo.672.1">trendsum</span></strong><span class="kobospan" id="kobo.673.1">: To get a sum of trend values within a </span><span><span class="kobospan" id="kobo.674.1">time period</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.675.1">As I said, all of </span><a id="_idIndexMarker310" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.676.1">these will use our trend values. </span><span class="kobospan" id="kobo.676.2">The values used are stored in a special Za</span><a id="_idTextAnchor702" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.677.1">bbix trend cache in memory, for use in our trigger. </span><span class="kobospan" id="kobo.677.2">We’ve used the </span><strong class="source-inline"><span class="kobospan" id="kobo.678.1">trendavg</span></strong><span class="kobospan" id="kobo.679.1"> funct</span><a id="_idTextAnchor703" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.680.1">ion. </span><span class="kobospan" id="kobo.680.2">Let’s check out how we used it in our trigger </span><span><span class="kobospan" id="kobo.681.1">expressi</span><a id="_idTextAnchor704" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.682.1">on again:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer209">
<span class="kobospan" id="kobo.683.1"><img alt="Figure 4.19 – trendavg trigger expression" src="image/B19803_04_19.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.684.1">Figure 4.19 – trendavg trigger expression</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.685.1">We start off ou</span><a id="_idTextAnchor705" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.686.1">r trigger with the </span><strong class="source-inline"><span class="kobospan" id="kobo.687.1">trendavg</span></strong><span class="kobospan" id="kobo.688.1"> function and then the </span><em class="italic"><span class="kobospan" id="kobo.689.1">host/template</span></em><span class="kobospan" id="kobo.690.1"> and </span><em class="italic"><span class="kobospan" id="kobo.691.1">item key</span></em><span class="kobospan" id="kobo.692.1"> as we saw earlier in the last recipe. </span><span class="kobospan" id="kobo.692.2">What’s new here is the part where we state </span><strong class="source-inline"><span class="kobospan" id="kobo.693.1">1w:now-1w</span></strong><span class="kobospan" id="kobo.694.1">. </span><span class="kobospan" id="kobo.694.2">This is the time period; here we’ve stated to use a value from one </span><span><span class="kobospan" id="kobo.695.1">week ago.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.696.1">What this means is that if the average value from our trends one week ago is above 800 Mbps, then this trigger will go into a </span><span><span class="kobospan" id="kobo.697.1">problem state.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.698.1">Advanced trigger 2 – timeleft function</span></h3>
<p class="calibre3"><strong class="source-inline"><span class="kobospan" id="kobo.699.1">timeleft</span></strong><span class="kobospan" id="kobo.700.1"> i</span><a id="_idTextAnchor706" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.701.1">s another </span><a id="_idIndexMarker311" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.702.1">very interesting trigger function. </span><span class="kobospan" id="kobo.702.2">We can use </span><strong class="source-inline"><span class="kobospan" id="kobo.703.1">timeleft</span></strong><span class="kobospan" id="kobo.704.1"> to create triggers that only fire when it expects something to reach a certain threshold in the future. </span><span class="kobospan" id="kobo.704.2">This is called a predictive trigger, as it makes a prediction based on </span><span><span class="kobospan" id="kobo.705.1">older data.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.706.1">Let’s check out our trigger </span><span><span class="kobospan" id="kobo.707.1">expressi</span><a id="_idTextAnchor707" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.708.1">on again.</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer210">
<span class="kobospan" id="kobo.709.1"><img alt="Figure 4.20 – timeleft trigger expression﻿" src="image/B19803_04_20.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.710.1">Figure 4.20 – timeleft trigger expression</span><a id="_idTextAnchor708" class="pcalibre calibre6 pcalibre1"/></p>
<p class="calibre3"><span class="kobospan" id="kobo.711.1">As we c</span><a id="_idTextAnchor709" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.712.1">an see, we start our expression as usual: the </span><em class="italic"><span class="kobospan" id="kobo.713.1">trigger function</span></em><span class="kobospan" id="kobo.714.1">, </span><em class="italic"><span class="kobospan" id="kobo.715.1">host/template</span></em><span class="kobospan" id="kobo.716.1">, and our </span><em class="italic"><span class="kobospan" id="kobo.717.1">item key</span></em><span class="kobospan" id="kobo.718.1">. </span><span class="kobospan" id="kobo.718.2">In this case, we combined that with a time period we want to use for our predictive trigger to define its prediction. </span><span class="kobospan" id="kobo.718.3">We used </span><strong class="source-inline"><span class="kobospan" id="kobo.719.1">7h</span></strong><span class="kobospan" id="kobo.720.1">, to tell this expression to use seven hours </span><a id="_idIndexMarker312" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.721.1">of historic data. </span><span class="kobospan" id="kobo.721.2">Combine that with a threshold of </span><strong class="source-inline"><span class="kobospan" id="kobo.722.1">100</span></strong><span class="kobospan" id="kobo.723.1">, to make sure this will trigger if we expect to reach 100% disk space usage. </span><span class="kobospan" id="kobo.723.2">Now we only need one more element to complete this, the expected result, which in this case </span><span><span class="kobospan" id="kobo.724.1">is </span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.725.1">&lt;1w</span></strong></span><span><span class="kobospan" id="kobo.726.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.727.1">To sum it all up, this trigger expression looks at </span><em class="italic"><span class="kobospan" id="kobo.728.1">seven hours</span></em><span class="kobospan" id="kobo.729.1"> of historic data and if it expects to reach </span><em class="italic"><span class="kobospan" id="kobo.730.1">100%</span></em><span class="kobospan" id="kobo.731.1"> disk space in </span><em class="italic"><span class="kobospan" id="kobo.732.1">less than one week</span></em><span class="kobospan" id="kobo.733.1">, it will go into a problem state, alerting you that you will need to make sure your disks don’t run out </span><span><span class="kobospan" id="kobo.734.1">of space.</span></span></p>
<p class="calibre3"><strong class="bold"><span class="kobospan" id="kobo.735.1">A tip </span></strong><span class="kobospan" id="kobo.736.1">would be to combine the </span><strong class="source-inline"><span class="kobospan" id="kobo.737.1">timeleft</span></strong><span class="kobospan" id="kobo.738.1"> trigger function with other functions to limit how many times you get alerted. </span><span class="kobospan" id="kobo.738.2">For example, with disk space, we might expect a disk to fill up in a week, but you might not want to see that unless the used space is at least less than 50 Gigabytes. </span><span class="kobospan" id="kobo.738.3">Add another expression and you </span><span><span class="kobospan" id="kobo.739.1">ar</span><a id="_idTextAnchor710" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.740.1">e golden:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer211">
<span class="kobospan" id="kobo.741.1"><img alt="Figure 4.21 – timeleft trigger function expression" src="image/B19803_04_21.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.742.1">Figure 4.21 – timeleft trigger function expression</span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.743.1">Advanced trigger 3 – time shifting using mathematical functions</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.744.1">As a Zabbix trainer, time shifting trigger expressions are where my students and I always need </span><a id="_idIndexMarker313" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.745.1">to spend some additional time on what they all do exactly. </span><span class="kobospan" id="kobo.745.2">This makes sense, as it is one of the more complex expressions, and in this example, we even combined it with some </span><span><span class="kobospan" id="kobo.746.1">mathematical functions.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.747.1">So, let’s take another look at our expression and break</span><a id="_idTextAnchor711" class="pcalibre calibre6 pcalibre1"/> <span><span class="kobospan" id="kobo.748.1">it down.</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer212">
<span class="kobospan" id="kobo.749.1"><img alt="Figure 4.22 – Time shifting trigger expression" src="image/B19803_04_22.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.750.1">Figure 4.22 – Time shifting trigger expression</span></p>
<p class="calibre3"><a id="_idTextAnchor712" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.751.1">I’ve </span><a id="_idTextAnchor713" class="pcalibre calibre6 pcalibre1"/><a id="_idIndexMarker314" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.752.1">added line numbers for our convenience. </span><span class="kobospan" id="kobo.752.2">Now we can go over each line and explain what </span><span><span class="kobospan" id="kobo.753.1">they mean:</span></span></p>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.754.1">This is the opening bracket for our mathematical statement, using the operator between </span><span><span class="kobospan" id="kobo.755.1">two items.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.756.1">Our first item, using the time shift function. </span><span class="kobospan" id="kobo.756.2">This item will get our memory availability as a percentage from one week ago starting from this moment exactly. </span><span class="kobospan" id="kobo.756.3">If the current date and time are Monday 24th November at 14:00, it will get the one-hour average value for Monday 17th November between 13:00 </span><span><span class="kobospan" id="kobo.757.1">and 14:00.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.758.1">Our mathematical operator, stating a minus. </span><span class="kobospan" id="kobo.758.2">This means we’ll subtract the result of the first expression from the result of the </span><span><span class="kobospan" id="kobo.759.1">second expression.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.760.1">This is our second item, not using a time shift. </span><span class="kobospan" id="kobo.760.2">This item will be filled with a one-hour average value of the </span><span><span class="kobospan" id="kobo.761.1">last hour.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.762.1">The closing bracket ends our </span><span><span class="kobospan" id="kobo.763.1">mathematical statement.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.764.1">Finally, an operator and constant. </span><span class="kobospan" id="kobo.764.2">This states that this trigger will only trigger if the mathematical result is higher </span><span><span class="kobospan" id="kobo.765.1">than 20.</span></span></li>
</ol>
<p class="calibre3"><span class="kobospan" id="kobo.766.1">Now that we know what each of the lines does, let’s take a look at how it works in a real-life scenario. </span><span class="kobospan" id="kobo.766.2">We’re going to fill out the values manually and see whether the expression is </span><strong class="source-inline"><span class="kobospan" id="kobo.767.1">TRUE</span></strong><span class="kobospan" id="kobo.768.1"> or </span><strong class="source-inline"><span class="kobospan" id="kobo.769.1">FALSE</span></strong><span class="kobospan" id="kobo.770.1">. </span><strong class="source-inline"><span class="kobospan" id="kobo.771.1">TRUE</span></strong><span class="kobospan" id="kobo.772.1"> means that there is a problem and </span><strong class="source-inline"><span class="kobospan" id="kobo.773.1">FALSE</span></strong><span class="kobospan" id="kobo.774.1"> means everything is fine. </span><span class="kobospan" id="kobo.774.2">So, the math is </span><span><span class="kobospan" id="kobo.775.1">as follows:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.776.1">
(Last week - This week) = Result
If the Result is higher than 20 then the expression is True
This expression is: TRUE/FALSE</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.777.1">Filling it out with 80% memory available last week and only 50% available this week, we can see the </span><span><span class="kobospan" id="kobo.778.1">following happening:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.779.1">
(80 - 50) = 30
If 30 is higher than 20 the expression is TRUE
This expression is TRUE</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.780.1">Let’s </span><a id="_idIndexMarker315" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.781.1">do it one more time but with 80% memory available last week and 70% </span><span><span class="kobospan" id="kobo.782.1">this week:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.783.1">
(80 - 70) = 10
If 10 is higher than 20 the expression is TRUE
This expression is FALSE</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.784.1">This</span><a id="_idTextAnchor714" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.785.1"> is how you should go about setting up your ti</span><a id="_idTextAnchor715" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.786.1">me shifting expressions. </span><span class="kobospan" id="kobo.786.2">Simply use a notebook or whatever you like, write down your expression in simple text for yourself, and do </span><span><span class="kobospan" id="kobo.787.1">the ca</span><a id="_idTextAnchor716" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor717" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.788.1">lculations.</span></span></p>
<h2 id="_idParaDest-133" class="calibre7"><span class="kobospan" id="kobo.789.1">There’s mo</span><a id="_idTextAnchor718" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.790.1">re…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.791.1">Trigger expressions can also be tested w</span><a id="_idTextAnchor719" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.792.1">ithin Zabbix itself. </span><span class="kobospan" id="kobo.792.2">If we go to </span><strong class="bold"><span class="kobospan" id="kobo.793.1">Data collection</span></strong><span class="kobospan" id="kobo.794.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.795.1">Hosts</span></strong><span class="kobospan" id="kobo.796.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.797.1">Triggers</span></strong><span class="kobospan" id="kobo.798.1"> and select any of our three advanced triggers, we can do a little test. </span><span class="kobospan" id="kobo.798.2">For example, using the time shifting trigger, we can click </span><span><strong class="bold"><span class="kobospan" id="kobo.799.1">Expression co</span><a id="_idTextAnchor720" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.800.1">nstructor</span></strong></span><span><span class="kobospan" id="kobo.801.1">.</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer213">
<span class="kobospan" id="kobo.802.1"><img alt="Figure 4.23 – Time shifting trigger expression constructor" src="image/B19803_04_23.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.803.1">Figure 4.23 – Time shifting trigger expression constructor</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.804.1">Here, we can select </span><strong class="bold"><span class="kobospan" id="kobo.805.1">Test</span></strong><span class="kobospan" id="kobo.806.1"> and then fill out our values. </span><span class="kobospan" id="kobo.806.2">Let’s use the same 80% and 50% we did in the </span><span><span class="kobospan" id="kobo.807.1">earlier</span><a id="_idTextAnchor721" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.808.1"> example:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer214">
<span class="kobospan" id="kobo.809.1"><img alt="Figure 4.24 – Time shifting trigger expression constructor – Test" src="image/B19803_04_24.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.810.1">Figure 4.24 – Time shifting trigger expression constructor – Test</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.811.1">As you can see, this will tell us whether our expression ends up being </span><strong class="bold"><span class="kobospan" id="kobo.812.1">TRUE</span></strong><span class="kobospan" id="kobo.813.1"> or </span><strong class="bold"><span class="kobospan" id="kobo.814.1">FALSE</span></strong><span class="kobospan" id="kobo.815.1">, </span><a id="_idTextAnchor722" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.816.1">using any values we want to fill. </span><span class="kobospan" id="kobo.816.2">In short, if you want t</span><a id="_idTextAnchor723" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.817.1">o be sure your math on paper is doing the same thing directly in Zabbix, use </span><strong class="bold"><span class="kobospan" id="kobo.818.1">Expression constructor</span></strong><span class="kobospan" id="kobo.819.1"> to</span><a id="_idTextAnchor724" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor725" class="pcalibre calibre6 pcalibre1"/> <span><span class="kobospan" id="kobo.820.1">test it.</span></span></p>
<h1 id="_idParaDest-134" class="calibre5"><a id="_idTextAnchor726" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.821.1">Setting up alerts</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.822.1">Alertin</span><a id="_idTextAnchor727" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.823.1">g can be a very important part of your Zabbix setup. </span><span class="kobospan" id="kobo.823.2">When we set up alerts, we want the </span><a id="_idIndexMarker316" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.824.1">person on the other end to be informed of just what is going on. </span><span class="kobospan" id="kobo.824.2">It’s also important to not spam someone with alerts; we want it to </span><span><span class="kobospan" id="kobo.825.1">be effective.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.826.1">So, in this recipe, we will go over the basics of setting up alerts, so we know just how to get it right from </span><a id="_idTextAnchor728" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor729" class="pcalibre calibre6 pcalibre1"/><span><span class="kobospan" id="kobo.827.1">the start.</span></span></p>
<h2 id="_idParaDest-135" class="calibre7"><a id="_idTextAnchor730" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.828.1">Getting ready</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.829.1">For this recipe, we will only need two things. </span><span class="kobospan" id="kobo.829.2">We will have to use our Zabbix server to create our alerts and we will need some triggers, such as the triggers from the previous recipe. </span><span class="kobospan" id="kobo.829.3">The triggers will be used to initiate the alerting process to see just how the Zabbix server will convey </span><span><span class="kobospan" id="kobo.830.1">this in</span><a id="_idTextAnchor731" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor732" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.831.1">formation.</span></span></p>
<h2 id="_idParaDest-136" class="calibre7"><a id="_idTextAnchor733" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.832.1">How to do it…</span></h2>
<ol class="calibre16">
<li class="calibre15"><a id="_idTextAnchor734" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.833.1">Let’s start by setting up our action on the Zabbix frontend. </span><span class="kobospan" id="kobo.833.2">To do this, we will navigate to </span><strong class="bold"><span class="kobospan" id="kobo.834.1">Alerts</span></strong><span class="kobospan" id="kobo.835.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.836.1">Actions</span></strong><span class="kobospan" id="kobo.837.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.838.1">Trigger actions</span></strong><span class="kobospan" id="kobo.839.1"> and we will be served with </span><span><span class="kobospan" id="kobo.840.1">thi</span><a id="_idTextAnchor735" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.841.1">s screen:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer215">
<span class="kobospan" id="kobo.842.1"><img alt="Figure 4.25 – The Zabbix Trigger actions page with one trigger action" src="image/B19803_04_25.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.843.1">Figure 4.25 – The Zabbix Trigger actions page with one trigger action</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.844.1">There is already </span><a id="_idIndexMarker317" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.845.1">one action set up to notify </span><strong class="bold"><span class="kobospan" id="kobo.846.1">Zabbix administrators</span></strong><span class="kobospan" id="kobo.847.1"> of problem events. </span><span class="kobospan" id="kobo.847.2">In Zabbix 7, a lot of features, such as </span><strong class="bold"><span class="kobospan" id="kobo.848.1">Actions</span></strong><span class="kobospan" id="kobo.849.1"> and </span><strong class="bold"><span class="kobospan" id="kobo.850.1">Media</span></strong><span class="kobospan" id="kobo.851.1">, are predefined. </span><span class="kobospan" id="kobo.851.2">Most of the time, all we need to do is enable them and fill out </span><span><span class="kobospan" id="kobo.852.1">some information.</span></span></p>
<ol class="calibre16">
<li value="2" class="calibre15"><span class="kobospan" id="kobo.853.1">We will set up our own action, so let’s create a new action to notify a user in the </span><strong class="bold"><span class="kobospan" id="kobo.854.1">Zabbix administrators</span></strong><span class="kobospan" id="kobo.855.1"> group of our new triggers. </span><span class="kobospan" id="kobo.855.2">Click the blue </span><strong class="bold"><span class="kobospan" id="kobo.856.1">Create action</span></strong><span class="kobospan" id="kobo.857.1"> button to be taken to the </span><span><span class="kobospan" id="kobo.858.1">n</span><a id="_idTextAnchor736" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.859.1">ext page:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer216">
<span class="kobospan" id="kobo.860.1"><img alt="Figure 4.26 – The Zabbix action creation page – notify book reader" src="image/B19803_04_26.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.861.1">Figure 4.26 – The Zabbix action creation page – notify book reader</span></p>
<ol class="calibre16">
<li value="3" class="calibre15"><span class="kobospan" id="kobo.862.1">On this page, check the </span><strong class="bold"><span class="kobospan" id="kobo.863.1">Enabled</span></strong><span class="kobospan" id="kobo.864.1"> checkbox to make sure that this action will actually do something. </span><span class="kobospan" id="kobo.864.2">Make sure to name your action clearly so that you won’t have any issues with differentiating </span><span><span class="kobospan" id="kobo.865.1">between actions.</span></span><a id="_idTextAnchor737" class="pcalibre calibre6 pcalibre1"/></li>
<li class="calibre15"><span class="kobospan" id="kobo.866.1">Now, move </span><a id="_idIndexMarker318" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.867.1">on to the </span><span><strong class="bold"><span class="kobospan" id="kobo.868.1">Operat</span><a id="_idTextAnchor738" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.869.1">ions</span></strong></span><span><span class="kobospan" id="kobo.870.1"> tab:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer217">
<span class="kobospan" id="kobo.871.1"><img alt="Figure 4.27 – The Zabbix action creation page at the Operations tab – notify book reader" src="image/B19803_04_27.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.872.1">Figure 4.27 – The Zabbix action creation page at the Operations tab – notify book reader</span></p>
<ol class="calibre16">
<li value="5" class="calibre15"><span class="kobospan" id="kobo.873.1">The </span><strong class="bold"><span class="kobospan" id="kobo.874.1">Operations</span></strong><span class="kobospan" id="kobo.875.1"> tab is empty by default, so we are going to want to create some operations here. </span><span class="kobospan" id="kobo.875.2">There are three forms of operation that we are going to create </span><a id="_idTextAnchor739" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.876.1">here—let’s start with the </span><strong class="bold"><span class="kobospan" id="kobo.877.1">Operations</span></strong><span class="kobospan" id="kobo.878.1"> operation by </span><span><span class="kobospan" id="kobo.879.1">click</span><a id="_idTextAnchor740" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.880.1">ing </span></span><span><strong class="bold"><span class="kobospan" id="kobo.881.1">Add</span></strong></span><span><span class="kobospan" id="kobo.882.1">:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer218">
<span class="kobospan" id="kobo.883.1"><img alt="Figure 4.28 – Zabbix Operation details page – notify book reader" src="image/B19803_04_28.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.884.1">Figure 4.28 – Zabbix Operation details page – notify book reader</span></p>
<ol class="calibre16">
<li value="6" class="calibre15"><span class="kobospan" id="kobo.885.1">We have </span><a id="_idIndexMarker319" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.886.1">the option to add users and/or user groups here that we want to alert. </span><span class="kobospan" id="kobo.886.2">If you’ve followed along with </span><a href="B19803_01.xhtml#_idTextAnchor021" class="pcalibre calibre6 pcalibre1"><span><em class="italic"><span class="kobospan" id="kobo.887.1">Chapter 1</span></em></span></a><span class="kobospan" id="kobo.888.1">, </span><em class="italic"><span class="kobospan" id="kobo.889.1">Installing Zabbix and Getting Started Using the Frontend</span></em><span class="kobospan" id="kobo.890.1">, you can just select the </span><strong class="bold"><span class="kobospan" id="kobo.891.1">Networking</span></strong><span class="kobospan" id="kobo.892.1"> user group here. </span><span class="kobospan" id="kobo.892.2">If not, selecting just the </span><strong class="bold"><span class="kobospan" id="kobo.893.1">Zabbix administrators</span></strong><span class="kobospan" id="kobo.894.1"> group </span><span><span class="kobospan" id="kobo.895.1">is fine.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.896.1">After clicking the blue </span><strong class="bold"><span class="kobospan" id="kobo.897.1">Add</span></strong><span class="kobospan" id="kobo.898.1"> button at the bottom of the form, we will be taken back to the </span><span><strong class="bold"><span class="kobospan" id="kobo.899.1">Actions</span></strong></span><span><span class="kobospan" id="kobo.900.1"> screen.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.901.1">Now, we will create the next operation, named </span><strong class="bold"><span class="kobospan" id="kobo.902.1">Recovery operations</span></strong><span class="kobospan" id="kobo.903.1">. </span><span class="kobospan" id="kobo.903.2">What we do here is create an operation, </span><span><span class="kobospan" id="kobo.904.1">as </span><a id="_idTextAnchor741" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.905.1">follows:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer219">
<span class="kobospan" id="kobo.906.1"><img alt="Figure 4.29 – Zabbix Recovery operations details – notify book reader" src="image/B19803_04_29.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.907.1">Figure 4.29 – Zabbix Recovery operations details – notify book reader</span></p>
<ol class="calibre16">
<li value="9" class="calibre15"><span class="kobospan" id="kobo.908.1">Th</span><a id="_idTextAnchor742" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.909.1">is option will notify all users involved in the initial operation defined earlier. </span><span class="kobospan" id="kobo.909.2">All users that got a </span><strong class="source-inline1"><span class="kobospan" id="kobo.910.1">PROBLEM</span></strong><span class="kobospan" id="kobo.911.1"> generation notification will also receive the recovery this way. </span><span class="kobospan" id="kobo.911.2">Click </span><strong class="bold"><span class="kobospan" id="kobo.912.1">Add</span></strong><span class="kobospan" id="kobo.913.1">, and </span><span><span class="kobospan" id="kobo.914.1">let’s continue.</span></span><p class="calibre3"><span class="kobospan" id="kobo.915.1">Now, if you’re </span><a id="_idIndexMarker320" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.916.1">like me and you want to stay on top of things, you can create an update notification. </span><span class="kobospan" id="kobo.916.2">This way, we know that—for instance—someone acknowledged a problem and is working on it. </span><span class="kobospan" id="kobo.916.3">Normally, I would select different channels for stuff such as this—for instance, using </span><strong class="bold"><span class="kobospan" id="kobo.917.1">SMS</span></strong><span class="kobospan" id="kobo.918.1"> for high-priority alerts and a Slack or Teams channel for </span><span><span class="kobospan" id="kobo.919.1">everything else.</span></span></p></li>
<li class="calibre15"><span class="kobospan" id="kobo.920.1">Let’s click </span><strong class="bold"><span class="kobospan" id="kobo.921.1">Add</span></strong><span class="kobospan" id="kobo.922.1"> under </span><strong class="bold"><span class="kobospan" id="kobo.923.1">Update operations</span></strong><span class="kobospan" id="kobo.924.1"> to add the following to </span><span><span class="kobospan" id="kobo.925.1">ou</span><a id="_idTextAnchor743" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.926.1">r setup:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer220">
<span class="kobospan" id="kobo.927.1"><img alt="Figure 4.30 – Zabbix update operation details – notify book reader" src="image/B19803_04_30.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.928.1">Figure 4.30 – Zabbix update operation details – notify book reader</span></p>
<ol class="calibre16">
<li value="11" class="calibre15"><span class="kobospan" id="kobo.929.1">We wil</span><a id="_idTextAnchor744" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.930.1">l do the same thing here as we did for the </span><strong class="bold"><span class="kobospan" id="kobo.931.1">Recovery operations</span></strong><span class="kobospan" id="kobo.932.1"> option and notify all users involved of any update to this problem. </span><span class="kobospan" id="kobo.932.2">After clicking </span><strong class="bold"><span class="kobospan" id="kobo.933.1">Add</span></strong><span class="kobospan" id="kobo.934.1"> here, click the blue </span><strong class="bold"><span class="kobospan" id="kobo.935.1">Add</span></strong><span class="kobospan" id="kobo.936.1"> button again on the </span><strong class="bold"><span class="kobospan" id="kobo.937.1">Actions</span></strong><span class="kobospan" id="kobo.938.1"> screen to finish creating </span><span><span class="kobospan" id="kobo.939.1">the action.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.940.1">Now, the next thing we want to do is create a media type for actually notifying our users </span><a id="_idIndexMarker321" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.941.1">of the issue. </span><span class="kobospan" id="kobo.941.2">Go to </span><strong class="bold"><span class="kobospan" id="kobo.942.1">Alerts</span></strong><span class="kobospan" id="kobo.943.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.944.1">Media types</span></strong><span class="kobospan" id="kobo.945.1">, and you will be presented with the </span><span><span class="kobospan" id="kobo.946.1">following</span><a id="_idTextAnchor745" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.947.1"> screen:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer221">
<span class="kobospan" id="kobo.948.1"><img alt="Figure 4.31 – The Zabbix Media types page with predefined media options" src="image/B19803_04_31.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.949.1">Figure 4.31 – The Zabbix Media types page with predefined media options</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.950.1">A</span><a id="_idTextAnchor746" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.951.1">s you can see, there are quite a lot of predefined media types in Zabbix 7. </span><span class="kobospan" id="kobo.951.2">We have them for Slack, Opsgenie, and even Telegram. </span><span class="kobospan" id="kobo.951.3">Let’s start with something almost everyone has, </span><span><span class="kobospan" id="kobo.952.1">though: email.</span></span></p>
<ol class="calibre16">
<li value="13" class="calibre15"><span class="kobospan" id="kobo.953.1">Click the </span><strong class="bold"><span class="kobospan" id="kobo.954.1">Email</span></strong><span class="kobospan" id="kobo.955.1"> media type and we’ll edit it to suit </span><span><span class="kobospan" id="kobo.956.1">our</span><a id="_idTextAnchor747" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.957.1"> needs:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer222">
<span class="kobospan" id="kobo.958.1"><img alt="Figure 4.32 – The Zabbix Media type creation page for email" src="image/B19803_04_32.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.959.1">Figure 4.32 – The Zabbix Media type creation page for email</span></p>
<ol class="calibre16">
<li value="14" class="calibre15"><span class="kobospan" id="kobo.960.1">I set it up to reflect my Office 365 settings, but any </span><strong class="bold"><span class="kobospan" id="kobo.961.1">Simple Mail Transfer Protocol</span></strong><span class="kobospan" id="kobo.962.1"> (</span><strong class="bold"><span class="kobospan" id="kobo.963.1">SMTP</span><a id="_idTextAnchor748" class="pcalibre calibre6 pcalibre1"/></strong><span class="kobospan" id="kobo.964.1">) server </span><a id="_idIndexMarker322" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.965.1">should work. </span><span class="kobospan" id="kobo.965.2">Fill in your SMTP settings, and we should be able to </span><span><span class="kobospan" id="kobo.966.1">receive notifications.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.967.1">Be sure to </span><a id="_idIndexMarker323" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.968.1">also check the next tab, </span><strong class="bold"><span class="kobospan" id="kobo.969.1">Message templates</span></strong><span class="kobospan" id="kobo.970.1">. </span><span class="kobospan" id="kobo.970.2">For example, th</span><a id="_idTextAnchor749" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.971.1">e message template for a </span><strong class="bold"><span class="kobospan" id="kobo.972.1">Problem</span></strong><span class="kobospan" id="kobo.973.1"> generation event looks </span><span><span class="kobospan" id="kobo.974.1">li</span><a id="_idTextAnchor750" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.975.1">ke this:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer223">
<span class="kobospan" id="kobo.976.1"><img alt="Figure 4.33 – The default Zabbix Message template page for problems" src="image/B19803_04_33.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.977.1">Figure 4.33 – The default Zabbix Message template page for problems</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.978.1">We set this up like this so that we get a message telling us just what’s going on. </span><span class="kobospan" id="kobo.978.2">This is fully customizable as well, to reflect just what we want </span><span><span class="kobospan" id="kobo.979.1">to know.</span></span></p>
<ol class="calibre16">
<li value="16" class="calibre15"><span class="kobospan" id="kobo.980.1">Let’s keep the default settings for now. </span><span class="kobospan" id="kobo.980.2">Last but not least, go to </span><strong class="bold"><span class="kobospan" id="kobo.981.1">Users</span></strong><span class="kobospan" id="kobo.982.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.983.1">Users</span></strong><span class="kobospan" id="kobo.984.1"> and edit a user in the </span><strong class="bold"><span class="kobospan" id="kobo.985.1">Zabbix administrators</span></strong><span class="kobospan" id="kobo.986.1"> or </span><strong class="bold"><span class="kobospan" id="kobo.987.1">Networking</span></strong><span class="kobospan" id="kobo.988.1"> group. </span><span class="kobospan" id="kobo.988.2">I will use the </span><strong class="bold"><span class="kobospan" id="kobo.989.1">Admin</span></strong><span class="kobospan" id="kobo.990.1"> user as </span><span><span class="kobospan" id="kobo.991.1">an e</span><a id="_idTextAnchor751" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.992.1">xample.</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer224">
<span class="kobospan" id="kobo.993.1"><img alt="Figure 4.34 – The Zabbix user Media page for the Admin user" src="image/B19803_04_34.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.994.1">Figure 4.34 – The Zabbix user Media page for the Admin user</span></p>
<ol class="calibre16">
<li value="17" class="calibre15"><span class="kobospan" id="kobo.995.1">On this window, go to </span><strong class="bold"><span class="kobospan" id="kobo.996.1">Media</span></strong><span class="kobospan" id="kobo.997.1"> and click the </span><strong class="bold"><span class="kobospan" id="kobo.998.1">Add</span></strong><span class="kobospan" id="kobo.999.1"> button. </span><span class="kobospan" id="kobo.999.2">We want to </span><a id="_idTextAnchor752" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1000.1">add the following to notify us of all trigger severities at our </span><span><span class="kobospan" id="kobo.1001.1">email ad</span><a id="_idTextAnchor753" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1002.1">dress:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer225">
<span class="kobospan" id="kobo.1003.1"><img alt="Figure 4.35 – The Zabbix user media creation page for the Admin user" src="image/B19803_04_35.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1004.1">Figure 4.35 – The Zabbix user media creation page for the Admin user</span></p>
<ol class="calibre16">
<li value="18" class="calibre15"><span class="kobospan" id="kobo.1005.1">Now, click on </span><a id="_idIndexMarker324" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1006.1">the blue </span><strong class="bold"><span class="kobospan" id="kobo.1007.1">Add</span></strong><span class="kobospan" id="kobo.1008.1"> button and finish creating this </span><span><span class="kobospan" id="kobo.1009.1">user’s</span><a id="_idTextAnchor754" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor755" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1010.1"> media.</span></span></li>
</ol>
<h2 id="_idParaDest-137" class="calibre7"><a id="_idTextAnchor756" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1011.1">How it works…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1012.1">Now, that’s how </span><a id="_idIndexMarker325" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1013.1">we set up alerts in Zabbix. </span><span class="kobospan" id="kobo.1013.2">You will now receive alerts at your email add</span><a id="_idTextAnchor757" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1014.1">ress, as shown in the </span><span><span class="kobospan" id="kobo.1015.1">following flo</span><a id="_idTextAnchor758" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1016.1">wchart:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer226">
<span class="kobospan" id="kobo.1017.1"><img alt="Figure 4.36 – Diagram showing Zabbix problem flow" src="image/B19803_04_36.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1018.1">Figure 4.36 – Diagram showing Zabbix problem flow</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1019.1">When something breaks, a </span><strong class="bold"><span class="kobospan" id="kobo.1020.1">problem</span></strong><span class="kobospan" id="kobo.1021.1"> in Zabbix is triggered by our trigger configuration. </span><span class="kobospan" id="kobo.1021.2">Our </span><strong class="bold"><span class="kobospan" id="kobo.1022.1">action</span></strong><span class="kobospan" id="kobo.1023.1"> will then be triggered by our problem event and it will use the media type and user media </span><a id="_idIndexMarker326" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1024.1">configuration to notify our user. </span><span class="kobospan" id="kobo.1024.2">Our user then fixes the issue (for instance, rebooting a stuck server), and then an </span><strong class="bold"><span class="kobospan" id="kobo.1025.1">OK</span></strong><span class="kobospan" id="kobo.1026.1"> event will be generated. </span><span class="kobospan" id="kobo.1026.2">We will then trigger the action again and get an </span><span><span class="kobospan" id="kobo.1027.1">OK message.</span></span></p>
<p class="callout-heading"><span class="kobospan" id="kobo.1028.1">Tip</span></p>
<p class="callout"><span class="kobospan" id="kobo.1029.1">Before building alerts such as this, make a workflow (as shown in </span><span><em class="italic"><span class="kobospan" id="kobo.1030.1">Figure 4</span></em></span><em class="italic"><span class="kobospan" id="kobo.1031.1">.36</span></em><span class="kobospan" id="kobo.1032.1">) for yourself, specifying just which user groups and users should be notified. </span><span class="kobospan" id="kobo.1032.2">This way, it’s clear just how you will use Zabbix </span><span><span class="kobospan" id="kobo.1033.1">for a</span><a id="_idTextAnchor759" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor760" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1034.1">lerting.</span></span></p>
<h2 id="_idParaDest-138" class="calibre7"><a id="_idTextAnchor761" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1035.1">There’s more…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1036.1">There are loads of media types and integrations, and we’ve just touched the tip of the iceberg by </span><a id="_idIndexMarker327" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1037.1">seeing a list of predefined ones. </span><span class="kobospan" id="kobo.1037.2">Make sure to check out the Zabbix i</span><a id="_idTextAnchor762" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1038.1">ntegration list (</span><a href="https://www.zabbix.com/integrations" class="pcalibre calibre6 pcalibre1"><span class="kobospan" id="kobo.1039.1">https://www.zabbix.com/integrations</span></a><span class="kobospan" id="kobo.1040.1">) for more options or build your own using the Zabbix webhooks and other </span><span><span class="kobospan" id="kobo.1041.1">extensions a</span><a id="_idTextAnchor763" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor764" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1042.1">vailable.</span></span></p>
<h1 id="_idParaDest-139" class="calibre5"><a id="_idTextAnchor765" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1043.1">Keeping alerts effective</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.1044.1">It’s im</span><a id="_idTextAnchor766" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1045.1">portant </span><a id="_idIndexMarker328" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1046.1">to keep our alerts effective to make sure we are neither overwhelmed nor underwhelmed by notifications. </span><span class="kobospan" id="kobo.1046.2">To do this, we will change our trigger and the </span><strong class="bold"><span class="kobospan" id="kobo.1047.1">Email</span></strong><span class="kobospan" id="kobo.1048.1"> media type to reflect just what we wa</span><a id="_idTextAnchor767" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor768" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1049.1">nt </span><span><span class="kobospan" id="kobo.1050.1">to see.</span></span></p>
<h2 id="_idParaDest-140" class="calibre7"><a id="_idTextAnchor769" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1051.1">Getting ready</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1052.1">We will be using trigger 1 from the first recipe and the default email media type </span><span><span class="kobospan" id="kobo.1053.1">in Zabbix.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1054.1">Furthermore, of course, we’ll also be using our </span><span><span class="kobospan" id="kobo.1055.1">Zabb</span><a id="_idTextAnchor770" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor771" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1056.1">ix server.</span></span></p>
<h2 id="_idParaDest-141" class="calibre7"><a id="_idTextAnchor772" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1057.1">How to do it…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1058.1">To create effective alerts, let’s follow </span><span><span class="kobospan" id="kobo.1059.1">these steps:</span></span></p>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.1060.1">Let’s get started on trigger 1, which we created in this chapter’s </span><em class="italic"><span class="kobospan" id="kobo.1061.1">Setting up triggers</span></em><span class="kobospan" id="kobo.1062.1"> recipe. </span><span class="kobospan" id="kobo.1062.2">Navigate to the </span><strong class="source-inline1"><span class="kobospan" id="kobo.1063.1">lar-agent-simple</span></strong><span class="kobospan" id="kobo.1064.1"> host by going to </span><strong class="bold"><span class="kobospan" id="kobo.1065.1">Data collection</span></strong><span class="kobospan" id="kobo.1066.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.1067.1">Hosts</span></strong><span class="kobospan" id="kobo.1068.1"> and clicking </span><strong class="bold"><span class="kobospan" id="kobo.1069.1">Trigger</span></strong><span class="kobospan" id="kobo.1070.1"> for </span><span><span class="kobospan" id="kobo.1071.1">the host.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1072.1">Here, sometimes people use a different trigger name like the one we </span><a id="_idTextAnchor773" class="pcalibre calibre6 pcalibre1"/><span><span class="kobospan" id="kobo.1073.1">see here:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer227">
<span class="kobospan" id="kobo.1074.1"><img alt="Figure 4.37 – Trigger 1 from the previous recipe" src="image/B19803_04_37.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1075.1">Figure 4.37 – Trigger 1 from the previous recipe</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1076.1">Even when you’ve used the </span><strong class="source-inline"><span class="kobospan" id="kobo.1077.1">{HOST.NAME}</span></strong><span class="kobospan" id="kobo.1078.1"> macro in the trigger, it’s quite simple, so fortunately there isn’t a lot to change here. </span><span class="kobospan" id="kobo.1078.2">If you’ve used the hostna</span><a id="_idTextAnchor774" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1079.1">me in the trigger name, we can change the name to reflect a message that </span><span><span class="kobospan" id="kobo.1080.1">is clearer.</span></span></p>
<ol class="calibre16">
<li value="3" class="calibre15"><span class="kobospan" id="kobo.1081.1">Make sure to use a short and descriptive trigger name, such as </span><span><span class="kobospan" id="kobo.1082.1">the fo</span><a id="_idTextAnchor775" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1083.1">llowing:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer228">
<span class="kobospan" id="kobo.1084.1"><img alt="Figure 4.38 – New Trigger 1 name" src="image/B19803_04_38.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1085.1">Figure 4.38 – New Trigger 1 name</span></p>
<ol class="calibre16">
<li value="4" class="calibre15"><span class="kobospan" id="kobo.1086.1">Next, navigate </span><a id="_idIndexMarker329" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1087.1">to the </span><strong class="bold"><span class="kobospan" id="kobo.1088.1">Tags</span></strong><span class="kobospan" id="kobo.1089.1"> page to add a tag to keep the triggers organized. </span><span class="kobospan" id="kobo.1089.2">Let’s add </span><span><span class="kobospan" id="kobo.1090.1">the fo</span><a id="_idTextAnchor776" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1091.1">llowing:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer229">
<span class="kobospan" id="kobo.1092.1"><img alt="Figure 4.39 – Trigger 1 tags" src="image/B19803_04_39.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1093.1">Figure 4.39 – Trigger 1 tags</span></p>
<ol class="calibre16">
<li value="5" class="calibre15"><span class="kobospan" id="kobo.1094.1">Another great way of keeping everything organized is changing the message on media types. </span><span class="kobospan" id="kobo.1094.2">Let’s change the media type to reflect our needs. </span><span class="kobospan" id="kobo.1094.3">Navigate to </span><strong class="bold"><span class="kobospan" id="kobo.1095.1">Alerts</span></strong><span class="kobospan" id="kobo.1096.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.1097.1">Media types</span></strong><span class="kobospan" id="kobo.1098.1"> and select our media type </span><span><span class="kobospan" id="kobo.1099.1">named </span></span><span><strong class="bold"><span class="kobospan" id="kobo.1100.1">Email</span></strong></span><span><span class="kobospan" id="kobo.1101.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1102.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.1103.1">Message</span></strong> <strong class="bold"><span class="kobospan" id="kobo.1104.1">templates</span></strong><span class="kobospan" id="kobo.1105.1"> and click </span><strong class="bold"><span class="kobospan" id="kobo.1106.1">Edit</span></strong><span class="kobospan" id="kobo.1107.1"> next to our first problem. </span><span class="kobospan" id="kobo.1107.2">This will </span><a id="_idTextAnchor777" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1108.1">bring us to the </span><span><span class="kobospan" id="kobo.1109.1">following </span><a id="_idTextAnchor778" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1110.1">window:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer230">
<span class="kobospan" id="kobo.1111.1"><img alt="Figure 4.40 – Standard email media type message" src="image/B19803_04_40.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1112.1">Figure 4.40 – Standard email media type message</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1113.1">Currently, Zabbix uses the default configured message under the media type when we do </span><a id="_idIndexMarker330" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1114.1">not use a custom message. </span><span class="kobospan" id="kobo.1114.2">But if we want to change that message, we can do that here by creating a custom message. </span><span class="kobospan" id="kobo.1114.3">The default message under the </span><strong class="bold"><span class="kobospan" id="kobo.1115.1">Email</span></strong><span class="kobospan" id="kobo.1116.1"> media type looks as in the </span><span><span class="kobospan" id="kobo.1117.1">previous screenshot.</span></span></p>
<ol class="calibre16">
<li value="7" class="calibre15"><span class="kobospan" id="kobo.1118.1">We can change the message on the media type. </span><span class="kobospan" id="kobo.1118.2">For instance, if you don’t want to see the original problem ID or want a more customized message, simply remove that line, as shown in the </span><span><span class="kobospan" id="kobo.1119.1">following scre</span><a id="_idTextAnchor779" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1120.1">enshot:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer231">
<span class="kobospan" id="kobo.1121.1"><img alt="Figure 4.41 – Custom Email media type ﻿﻿message" src="image/B19803_04_41.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1122.1">Figure 4.41 – Custom Email media type </span><a id="_idTextAnchor780" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor781" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1123.1">message</span></p>
<h2 id="_idParaDest-142" class="calibre7"><a id="_idTextAnchor782" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1124.1">How it works…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1125.1">We</span><a id="_idTextAnchor783" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1126.1">’ve done two things in this recipe: changed our trigger name and added a tag to </span><span><span class="kobospan" id="kobo.1127.1">our trigger.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1128.1">Keeping trigger </span><a id="_idIndexMarker331" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1129.1">names clear and defined in a structured way is important to keep our Zabbix environment structured. </span><span class="kobospan" id="kobo.1129.2">Instead of just naming our trigger </span><strong class="source-inline"><span class="kobospan" id="kobo.1130.1">Port 22 SSH down on {HOST.NAME}</span></strong><span class="kobospan" id="kobo.1131.1">, we’ve added standardization to our setup and can now create cool structures such as this with our </span><span><span class="kobospan" id="kobo.1132.1">future tr</span><a id="_idTextAnchor784" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1133.1">iggers:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer232">
<span class="kobospan" id="kobo.1134.1"><img alt="Figure 4.42 – Trigger structure diagram" src="image/B19803_04_42.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1135.1">Figure 4.42 – Trigger structure diagram</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1136.1">Our triggers are all clear and we can immediately see which host, port, and service </span><span><span class="kobospan" id="kobo.1137.1">are down.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1138.1">On top of that, we’ve added a tag for the service that is down, which will now immediately display our service in a clear way, alerting us to exactly what is </span><span><span class="kobospan" id="kobo.1139.1">goi</span><a id="_idTextAnchor785" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1140.1">ng on:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer233">
<span class="kobospan" id="kobo.1141.1"><img alt="Figure 4.43 – Trigger down – structured" src="image/B19803_04_43.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1142.1">Figure 4.43 – Trigger down – structured</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1143.1">In Zabbix 6, a new tag policy was introduced. </span><span class="kobospan" id="kobo.1143.2">As we created the item used in the trigger with a </span><strong class="bold"><span class="kobospan" id="kobo.1144.1">component</span></strong><span class="kobospan" id="kobo.1145.1"> tag and we just added a trigger tag for </span><strong class="bold"><span class="kobospan" id="kobo.1146.1">scope</span></strong><span class="kobospan" id="kobo.1147.1">, we followed the new standard. </span><span class="kobospan" id="kobo.1147.2">In the problem view in the preceding screenshot, it becomes immediately apparent that we have a problem affecting the availability of the TCP service SSH. </span><span class="kobospan" id="kobo.1147.3">The </span><strong class="bold"><span class="kobospan" id="kobo.1148.1">scope</span></strong><span class="kobospan" id="kobo.1149.1"> tag generally contains either one of five options: </span><strong class="source-inline"><span class="kobospan" id="kobo.1150.1">availability</span></strong><span class="kobospan" id="kobo.1151.1">, </span><strong class="source-inline"><span class="kobospan" id="kobo.1152.1">performance</span></strong><span class="kobospan" id="kobo.1153.1">, </span><strong class="source-inline"><span class="kobospan" id="kobo.1154.1">notification</span></strong><span class="kobospan" id="kobo.1155.1">, </span><strong class="source-inline"><span class="kobospan" id="kobo.1156.1">security</span></strong><span class="kobospan" id="kobo.1157.1">, </span><span><span class="kobospan" id="kobo.1158.1">and </span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.1159.1">capacity</span></strong></span><span><span class="kobospan" id="kobo.1160.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1161.1">For more information about the new Zabbix tag policy that we still use in Zabbix 7, check out </span><span><span class="kobospan" id="kobo.1162.1">this link:</span></span></p>
<p class="calibre3"><a href="https://blog.zabbix.com/tags-in-zabbix-6-0-lts-usage-subfilters-and-guidelines/19565/" class="pcalibre calibre6 pcalibre1"><span><span class="kobospan" id="kobo.1163.1">https://blog.zabbix.com/tags-in-zabbix-6-0-lts-usage-subfilters-and-guidelines/19565/</span></span></a></p>
<p class="calibre3"><a id="_idTextAnchor786" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1164.1">Another thing we’ve done is removed the </span><strong class="source-inline"><span class="kobospan" id="kobo.1165.1">{HOST.NAME}</span></strong><span class="kobospan" id="kobo.1166.1"> macro if we’ve used it before. </span><span class="kobospan" id="kobo.1166.2">As we can already see which host this trigger is on by checking the </span><strong class="bold"><span class="kobospan" id="kobo.1167.1">Host</span></strong><span class="kobospan" id="kobo.1168.1"> field, we do not need to add the </span><strong class="source-inline"><span class="kobospan" id="kobo.1169.1">{HOST.NAME}</span></strong><span class="kobospan" id="kobo.1170.1"> macro. </span><span class="kobospan" id="kobo.1170.2">We need to keep trigger names short and effective and use the hostname macros in </span><strong class="bold"><span class="kobospan" id="kobo.1171.1">Media</span></strong><span class="kobospan" id="kobo.1172.1"> or simply use the field already available in </span><span><span class="kobospan" id="kobo.1173.1">the frontend.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1174.1">We’ve also </span><a id="_idIndexMarker332" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1175.1">changed our action in this recipe. </span><span class="kobospan" id="kobo.1175.2">Changing a message on media types is a powerful way to keep our problem channels structured. </span><span class="kobospan" id="kobo.1175.3">Sometimes, we want to see less or more information on certain channels, and changing media type messages is one way to </span><span><span class="kobospan" id="kobo.1176.1">do this.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1177.1">We can also create custom messages on an </span><strong class="bold"><span class="kobospan" id="kobo.1178.1">Action</span></strong><span class="kobospan" id="kobo.1179.1"> level, changing all the messages sent to the </span><span><span class="kobospan" id="kobo.1180.1">selected ch</span><a id="_idTextAnchor787" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor788" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1181.1">annels.</span></span></p>
<h2 id="_idParaDest-143" class="calibre7"><a id="_idTextAnchor789" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1182.1">There’s more…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1183.1">What I’m trying to show you in this recipe is that although it might be simple to set up Zabbix, it is not simple to set up a good monitoring solution with Zabbix—or any monitoring tool, for that matter—if you don’t plan. </span><span class="kobospan" id="kobo.1183.2">Carefully plan out how you want your triggers to be structured before you build everything in your </span><span><span class="kobospan" id="kobo.1184.1">Zabbix installation.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1185.1">An engineer who works in a structured way and takes the time to build a good monitoring solution will save a lot of hours in the future because they will understand the problem before </span><span><span class="kobospan" id="kobo.1186.1">anyon</span><a id="_idTextAnchor790" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor791" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1187.1">e else.</span></span></p>
<h1 id="_idParaDest-144" class="calibre5"><a id="_idTextAnchor792" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1188.1">Customizing alerts</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.1189.1">Alerting</span><a id="_idTextAnchor793" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1190.1"> is very useful, especially in combination with some of the tricks we’ve learned in this book </span><a id="_idIndexMarker333" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1191.1">so far to keep everything structured. </span><span class="kobospan" id="kobo.1191.2">But sometimes, we need a little more from our alerts than what we are already getting from Zabbix out of </span><span><span class="kobospan" id="kobo.1192.1">the box.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1193.1">In this recipe, we’ll do a small bit of customization to make the alerts more </span><a id="_idTextAnchor794" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor795" class="pcalibre calibre6 pcalibre1"/><span><span class="kobospan" id="kobo.1194.1">our own.</span></span></p>
<h2 id="_idParaDest-145" class="calibre7"><a id="_idTextAnchor796" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1195.1">Getting ready</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1196.1">For this recipe, all we are going to need is our current Zabbix </span><span><span class="kobospan" id="kobo.1197.1">server insta</span><a id="_idTextAnchor797" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor798" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1198.1">llation.</span></span></p>
<h2 id="_idParaDest-146" class="calibre7"><a id="_idTextAnchor799" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1199.1">How to do it…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1200.1">To customize alerts, follow </span><span><span class="kobospan" id="kobo.1201.1">these steps:</span></span></p>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.1202.1">Let’s create </span><a id="_idIndexMarker334" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1203.1">some custom severities in our Zabbix server to reflect our organization’s needs. </span><span class="kobospan" id="kobo.1203.2">Navigate to </span><strong class="bold"><span class="kobospan" id="kobo.1204.1">Administration</span></strong><span class="kobospan" id="kobo.1205.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.1206.1">General</span></strong><span class="kobospan" id="kobo.1207.1"> and select </span><strong class="bold"><span class="kobospan" id="kobo.1208.1">Trigger displaying options</span></strong><span class="kobospan" id="kobo.1209.1"> from the </span><span><span class="kobospan" id="kobo.1210.1">si</span><a id="_idTextAnchor800" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1211.1">de menu:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer234">
<span class="kobospan" id="kobo.1212.1"><img alt="Figure 4.44 – Administration | General from side menu" src="image/B19803_04_44.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1213.1">Figure 4.44 – Administration | General from side menu</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1214.1">After </span><a id="_idTextAnchor801" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1215.1">selecting this, we’ll be taken to the next page. </span><span class="kobospan" id="kobo.1215.2">This window contains the default Zabbix trigger severities, as shown in the </span><span><span class="kobospan" id="kobo.1216.1">following scre</span><a id="_idTextAnchor802" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1217.1">enshot:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer235">
<span class="kobospan" id="kobo.1218.1"><img alt="Figure 4.45 – Default trigger severities page" src="image/B19803_04_45.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1219.1">Figure 4.45 – Default trigger severities page</span></p>
<ol class="calibre16">
<li value="2" class="calibre15"><span class="kobospan" id="kobo.1220.1">Next</span><a id="_idTextAnchor803" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1221.1"> up, we can </span><a id="_idIndexMarker335" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1222.1">customize the default trigger severities, </span><span><span class="kobospan" id="kobo.1223.1">as f</span><a id="_idTextAnchor804" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1224.1">ollows:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer236">
<span class="kobospan" id="kobo.1225.1"><img alt="Figure 4.46 – Custom trigger severities page" src="image/B19803_04_46.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1226.1">Figure 4.46 – Custom trigger severities page</span></p>
<ol class="calibre16">
<li value="3" class="calibre15"><span class="kobospan" id="kobo.1227.1">Do not forget to click the blue </span><strong class="bold"><span class="kobospan" id="kobo.1228.1">Update</span></strong><span class="kobospan" id="kobo.1229.1"> button at the bottom of the page to save </span><span><span class="kobospan" id="kobo.1230.1">the c</span><a id="_idTextAnchor805" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor806" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1231.1">hanges.</span></span></li>
</ol>
<h2 id="_idParaDest-147" class="calibre7"><a id="_idTextAnchor807" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1232.1">How it works…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1233.1">Not all </span><a id="_idIndexMarker336" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1234.1">c</span><a id="_idTextAnchor808" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1235.1">ompanies like using terms such as </span><strong class="bold"><span class="kobospan" id="kobo.1236.1">High</span></strong><span class="kobospan" id="kobo.1237.1"> and </span><strong class="bold"><span class="kobospan" id="kobo.1238.1">Disaster</span></strong><span class="kobospan" id="kobo.1239.1">, but prefer using different severities such as </span><strong class="bold"><span class="kobospan" id="kobo.1240.1">P1</span></strong><span class="kobospan" id="kobo.1241.1"> and </span><strong class="bold"><span class="kobospan" id="kobo.1242.1">P2</span></strong><span class="kobospan" id="kobo.1243.1">. </span><span class="kobospan" id="kobo.1243.2">Using custom severities, we can customize Zabbix to make it more our own and reflect the terms we’ve already been using in different tools, </span><span><span class="kobospan" id="kobo.1244.1">for example.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1245.1">Changing custom severities is not a necessity by any means, but it can be a good way to adopt Zabbix more easily if you are used to </span><span><span class="kobospan" id="kobo.1246.1">something different.</span></span></p>
</div>
</body></html>