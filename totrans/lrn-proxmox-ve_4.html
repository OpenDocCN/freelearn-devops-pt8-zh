<html><head></head><body><div class="chapter" title="Chapter&#xA0;4.&#xA0;Creating Virtual Machines"><div class="titlepage"><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Creating Virtual Machines</h1></div></div></div><div class="blockquote"><table border="0" width="100%" cellspacing="0" cellpadding="0" class="blockquote" summary="Block quote"><tr><td valign="top"> </td><td valign="top"><p>
<span class="emphasis"><em>"...But if the concept of abstraction is so mundane in IT, what explains the increasing fascination with virtualization in recent years? The trend is even more hard-core in data centers, where virtualization is deeply ingrained in the development strategy of these environments since the mid-2000s. And the infatuation continues to grow....Accordingly, these facilities have been assaulted with virtual servers, virtual networks, virtual storage, virtual appliances, and other "V-technologies" that promise relief from the cuffs of reality."</em></span>
</p></td><td valign="top"> </td></tr><tr><td valign="top"> </td><td colspan="2" align="right" valign="top" style="text-align: center">--<span class="attribution">
<span class="emphasis"><em>Gustavo A. A. Santana, Data Center Virtualization Fundamentals</em></span>
</span></td></tr></table></div><p>In <a class="link" href="ch03.html" title="Chapter 3. Creating Containers">Chapter 3</a>, <span class="emphasis"><em>Creating Containers</em></span>, we explored the creation, configuration, and control of LXC containers using Proxmox VE. In this chapter, we turn our focus to KVM-QEMU virtual machine creation and control with Proxmox VE.</p><p>While we contrasted virtual machines with containers in <a class="link" href="ch01.html" title="Chapter 1. Proxmox VE Fundamentals">Chapter 1</a>, <span class="emphasis"><em>Proxmox VE Fundamentals</em></span>, we will take this opportunity to dive deeper into specific advantages virtual machines still seem to have over containers despite the clear signs that we're in the thrall of a container revolution. At the same time, we will explore use cases based on what we've learned.</p><p>We will then walk through the process of deriving virtual machines from ISO images using Proxmox VE. PVE is intended as a server virtualization platform; therefore, we'll walk through the creation and configuration of two VMs: the first running Microsoft Windows 2012r2 and the second running Fedora Core 23 Server.</p><p>Since both operating systems have graphical user interface components, we will take advantage of an opportunity to explore more of the PVE's feature set than we might otherwise have had an authentic need to cover.</p><p>By the conclusion of <a class="link" href="ch04.html" title="Chapter 4. Creating Virtual Machines">Chapter 4</a>, <span class="emphasis"><em>Creating Virtual Machines</em></span>, we'll have covered the following aspects of full virtualization with Proxmox VE:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Uploading ISOs to Proxmox VE's local storage</li><li class="listitem" style="list-style-type: disc">Creating and configuring virtual machines from the PVE web interface</li><li class="listitem" style="list-style-type: disc">Interacting with VMs using the PVE web interface's console feature</li><li class="listitem" style="list-style-type: disc">Reconfiguring a virtual machine</li><li class="listitem" style="list-style-type: disc">Controlling the state of a virtual machine</li></ul></div><p>First, however, we will take a step back and explore the persistent role hardware virtualization will have, even as enthusiasm for containers echoes around us.</p><div class="section" title="Distinguishing features of virtual machines"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec25"/>Distinguishing features of virtual machines</h1></div></div></div><p>Though containers have clearly gained impressive momentum in so brief a period, virtual machines continue to have salient and distinguishing features. For example:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A VM may run any operating system designed for the host's architecture; for example, Android-x86, FreeBSD, Ubuntu, Windows Server, and even desktop OSs can all run on separate virtual machines on a Proxmox VE host, provided the host has adequate hardware resources.</li></ul></div><p>
</p><div class="mediaobject"><img src="graphics/image_04_001.png" alt="Distinguishing features of virtual machines"/><div class="caption"><p>Ubuntu 15.04 virtual machine hosted on Proxmox VE and accessed via the SPICE console option in the PVE's Web interface</p></div></div><p>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">One VM may host many containers; when we look for creative and savvy data center solutions, we would like to stay consistently aware that OS virtualization and system virtualization have a complementary relationship, rather than a competitive or antagonistic one. VMs still offer more thorough isolation, for example, than containers.</li><li class="listitem" style="list-style-type: disc">VMs and containers call for different security concerns and approaches. Impressively thorough standards for system virtualization are mature and freely available, while intelligence on OS virtualization security and standardized solutions are not yet mature.</li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip26"/>Tip</h3><p>We'll address security and PVE more thoroughly in <a class="link" href="ch07.html" title="Chapter 7. Securing Proxmox VE">Chapter 7</a>, <span class="emphasis"><em>Securing Proxmox VE</em></span>.</p></div></div><p>System virtualization's distinguishing features suggest that, for the time being, virtual machines are more flexible than containers; for example, many operating systems may coexist on a single <span class="strong"><strong>hypervisor</strong></span> such as Proxmox VE. Containers cannot achieve this. For now, this means that pure containers will only exist when GNU-/Linux-based hosts have GNU-/Linux-based containers and Microsoft-based containers can only run on Microsoft OS-based hosts. Containers hosted by Proxmox VE thus require that the host OS share GNU/Linux libraries and binaries.</p><p>With as much momentum as the container movement has, this restriction of containers to Unix-type operating systems may change very soon with the release of Windows Server 2016, which is now available to preview; Microsoft has announced plans to incorporate Docker into the product (<a class="ulink" href="http://zdnet.com/article/microsoft-to-add-virtualized-containers-non-server-mode-to-windows-server-2016/">http://zdnet.com/article/microsoft-to-add-virtualized-containers-non-server-mode-to-windows-server-2016/</a>, accessed June 1, 2015).</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note27"/>Note</h3><p>Docker is an open-source containerization solution under very active development and that is generating significant attention. A brief investigation suggests that a Windows host running Docker can run Linux containers. This counterpoint is quickly resolved once we realize Docker actually does this only with the support of a system virtualization layer, such as boot2docker (<a class="ulink" href="https://github.com/boot2docker/boot2docker">https://github.com/boot2docker/boot2docker</a>).</p></div></div><p>The flexibility system virtualization may claim, with regard to operating systems, does come at a cost: <span class="emphasis"><em>virtual machines require more resources and have more overhead than containers</em></span>.</p><p>In the next section, we'll explore scenarios that make system virtualization nevertheless compelling.</p><div class="section" title="Scenarios for system virtualization"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec20"/>Scenarios for system virtualization</h2></div></div></div><p>From the distinguishing features discussed previously, some very powerful use cases emerge. For example:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Cross-platform software development and testing</li><li class="listitem" style="list-style-type: disc">Administration and management of systems in an enterprise with concerns across platforms</li><li class="listitem" style="list-style-type: disc">Dependency on legacy applications, systems, or data</li><li class="listitem" style="list-style-type: disc">A proving ground for deployment of new systems or policies</li><li class="listitem" style="list-style-type: disc">Labs serving IT and ICT students</li><li class="listitem" style="list-style-type: disc">Productivity and consistency across platforms</li></ul></div><p>These scenarios highlight the changes brought about by each difference, particularly between the two forms of virtualization encouraged and supported by Proxmox VE, virtual machines, and containers.</p><p>This chapter proceeds with confidence to an informed conclusion: containers and virtual machines (or OS virtualization and system virtualization) are two different tools that together provide the data center and its engineers with powerful flexibility and an opportunity to exercise discretion in the (re)formation of the datacenter.</p><p>Let's have a look at the VM creation process with Proxmox VE.</p></div></div></div>
<div class="section" title="Creating a virtual machine"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec26"/>Creating a virtual machine</h1></div></div></div><p>This section provides an abstract overview of the virtual machine creation process, from configuring the machine to the installation of the operating system and ultimately to controlling its state.</p><div class="section" title="Installation media"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec21"/>Installation media</h2></div></div></div><p>In the best-case scenario, the operating system intended for a new virtual machine is available as a downloadable ISO file. This single file is intended to perfectly represent an entire CD or DVD. In the case of several GNU/Linux distributions, the full install media spans several DVDs.</p><p>Usually, in these cases, a network installation (or <code class="literal">netinst</code>) disk image is available that provides just enough operating system to drive the system devices, the installer, and then download and install requested software from online repositories.</p><p>When the OS is available as an ISO, we can simply download it to a remote workstation and then upload it to the PVE host's local storage using PVE's web interface, and carry on with the creation of the VM.</p><div class="section" title="Uploading an ISO file to local storage on PVE"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec0"/>Uploading an ISO file to local storage on PVE</h3></div></div></div><p>There are five steps to working with an ISO image from a remote workstation.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Download the ISO from the Web to a local workstation and verify that the image is not corrupted or compromised (see <a class="ulink" href="http://www.online-tech-tips.com/cool-websites/what-is-checksum/">http://www.online-tech-tips.com/cool-websites/what-is-checksum/</a> to learn more about this process).</li><li class="listitem">Access the Proxmox VE web interface by navigating to it in a browser (point your browser to <code class="literal">https://&lt;ip address&gt;:8006</code>, where <code class="literal">&lt;ipaddress&gt;</code> is the IP address of PVE).</li><li class="listitem">In the left pane of the browser window, <span class="strong"><strong>Server View</strong></span> should be selected. Beneath the drop-down menu, a folder labeled <span class="strong"><strong>Datacenter</strong></span> should be available. Expand the contents to reveal your PVE host, labeled by hostname. Expand that to reveal the host's local storage, and then select its local storage. In the following screenshot, for example, the hostname of the PVE host is pve4, so the local storage is labeled <span class="strong"><strong>local (pve4)</strong></span>.<p>
</p><div class="mediaobject"><img src="graphics/image_04_002.png" alt="Uploading an ISO file to local storage on PVE"/><div class="caption"><p>Navigating to a PVE node's local storage</p></div></div><p>
</p></li><li class="listitem">After choosing local storage, three tabs should appear in the right pane: <span class="strong"><strong>Summary</strong></span>, <span class="strong"><strong>Content</strong></span>, and <span class="strong"><strong>Permissions</strong></span>. Select the <span class="strong"><strong>Content</strong></span> tab to reveal two buttons in the right pane, <span class="strong"><strong>Templates</strong></span> and <span class="strong"><strong>Uploads</strong></span>:<p>
</p><div class="mediaobject"><img src="graphics/image_04_003.png" alt="Uploading an ISO file to local storage on PVE"/><div class="caption"><p>Local storage</p></div></div><p>
</p></li><li class="listitem">To proceed, click on the <span class="strong"><strong>Upload</strong></span> button. In the dialog that appears, choose <span class="strong"><strong>ISO image</strong></span> from the drop-down menu labeled <span class="strong"><strong>Content</strong></span>, then click on the <span class="strong"><strong>Select File...</strong></span> button to browse the workstation's filesystem for the disk image to be uploaded to the PVE host.<p>
</p><div class="mediaobject"><img src="graphics/image_04_004.png" alt="Uploading an ISO file to local storage on PVE"/><div class="caption"><p>Upload dialog</p></div></div><p>
</p></li></ol></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note28"/>Note</h3><p>The path to the ISO files uploaded to PVE's local storage via its web interface is <code class="literal">/var/lib/template/iso</code> by default. With this in mind, note that files can also be transferred to this location from a workstation via <code class="literal">scp</code> or <code class="literal">sftp</code> to the Proxmox VE server, provided the tools are installed on the remote workstation.</p></div></div><p>With the install media available to PVE, we're ready to configure and create a VM using Proxmox VE's web interface. The next section explores the process.</p></div></div><div class="section" title="Preparing a virtual machine"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec22"/>Preparing a virtual machine</h2></div></div></div><p>We begin the process by finding the hostname and local storage of our Proxmox VE instance in the server view of the PVE web interface. Select the host and click on the <span class="strong"><strong>Create VM</strong></span> button (at the upper right corner of the page) to start configuring a new virtual machine.</p><p>A dialog entitled <span class="strong"><strong>Create: Virtual Machine</strong></span> appears in the browser window. This is used to provide initial specifications for the new virtual machine, including not only hardware specifications, but also the OS type and the name PVE will use to refer to the new VM.</p><p>The tabs, from left to right, are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">General</li><li class="listitem" style="list-style-type: disc">OS</li><li class="listitem" style="list-style-type: disc">CD/DVD</li><li class="listitem" style="list-style-type: disc">Hard Disk</li><li class="listitem" style="list-style-type: disc">CPU</li><li class="listitem" style="list-style-type: disc">Memory</li><li class="listitem" style="list-style-type: disc">Network</li><li class="listitem" style="list-style-type: disc">Confirm</li></ul></div><p>After completing a tab, move forward either by clicking on the next tab in the sequence or by clicking on the <span class="strong"><strong>Next</strong></span> button.</p><div class="section" title="Anticipating the configuration tabs"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec1"/>Anticipating the configuration tabs</h3></div></div></div><p>What follows is a brief overview of what we can expect from each tab in the <span class="strong"><strong>Create: Virtual Machine</strong></span> dialog.</p><div class="section" title="General"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl4sec0"/>General</h4></div></div></div><p>It's on the <span class="strong"><strong>General</strong></span> tab that the name and VM ID of a virtual machine are defined. Note that the "name" field doesn't refer to the VM's hostname; that's defined when the OS is configured. Rather, it is the name that Proxmox VE will use to refer to this VM in the web interface.</p><p>In a production environment, it's recommended that you stay deliberate and systematic with your naming scheme, just as you would be with a hostname in a datacenter.</p><p>When defining the VM ID, it is similarly important to be rigorously systematic. Each VM and container must be assigned a unique number that PVE refers to as VM ID. Although Proxmox VE will provide a default VM ID number, this is an arbitrary system, rather than a deliberated system resulting from a well-formed policy.</p><p>In a large production environment, consider assigning VM IDs in a dedicated range relative to the virtual server's purpose (for example, VM ID 1000-2000 for VMs providing web services). You'll appreciate that you did if your datacenter grows as you systematize backup plans and establish a plan for virtual-server lifecycle management.</p></div><div class="section" title="OS"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl4sec1"/>OS</h4></div></div></div><p>The <span class="strong"><strong>OS</strong></span> tab provides some support for creating VMs intended for use with specific operating systems. Note there are multiple options, based on the kernel version, for GNU/Linux distributions.</p><p>
</p><div class="mediaobject"><img src="graphics/image_04_005.png" alt="OS"/></div><p>
</p></div><div class="section" title="CD/DVD"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl4sec2"/>CD/DVD</h4></div></div></div><p>The <span class="strong"><strong>CD/DVD</strong></span> tab provides an opportunity to specify the initial disc image to be used for installing the OS; alternatively, we can direct PVE to rely on a physical disc in a local optical drive. If you select an ISO image, you're asked to choose from among the ISOs that are already uploaded to Proxmox VE.</p></div><div class="section" title="Hard Disk"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl4sec3"/>Hard Disk</h4></div></div></div><p>On the <span class="strong"><strong>Hard Disk</strong></span> tab, we can define the size of the secondary storage allocated for the VM. There's also a <span class="strong"><strong>Bus/Device</strong></span> field, as well as a field labeled <span class="strong"><strong>Storage</strong></span> to specify the location to store the virtual disk. For the purpose of this text, we'll keep this field set to the default, <span class="strong"><strong>local</strong></span>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip29"/>Tip</h3><p>For more on virtual storage, see <a class="link" href="ch05.html" title="Chapter 5. Working with Virtual Disks">Chapter 5</a>, <span class="emphasis"><em>Working with Virtual Disks</em></span>.</p></div></div></div><div class="section" title="CPU"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl4sec4"/>CPU</h4></div></div></div><p>The <span class="strong"><strong>CPU</strong></span> tab provides an opportunity to define not only the CPU socket count, but also the number of cores to utilize per socket.</p></div><div class="section" title="Memory"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl4sec5"/>Memory</h4></div></div></div><p>The <span class="strong"><strong>Memory</strong></span> tab offers two methods for allocating RAM for the virtual machine; we can select a fixed amount in MB, or we can automatically allocate RAM within a specified range.</p></div><div class="section" title="Network"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl4sec6"/>Network</h4></div></div></div><p>Of particular interest on the Network tab are the three networking modes available in the left column of the tab and the opportunity to define the <span class="strong"><strong>Model</strong></span> of the network interface in the right column.</p><p>
</p><div class="mediaobject"><img src="graphics/image_04_006.png" alt="Network"/></div><p>
</p><p>In the preceding screenshot, the VM will be configured to behave as if it's connected directly to the physical network by relying on PVE's bridged mode. By way of contrast, the NAT (network address translation) mode connects the VM to an isolated LAN maintained by the host and well isolated from the physical network.</p><p>In the same screenshot, the model of the network card is set to <span class="strong"><strong>Intel E1000</strong></span>. Performance is not as good as we'd get from <span class="strong"><strong>virtio paravirtualization</strong></span>, but Microsoft Windows guests will work out of the box with this model, whereas virtio would need additional drivers. Intel E1000 stands out for its compatibility, while virtio offers superior performance.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip30"/>Tip</h3><p>A VM configured with NAT mode can access resources on the physical network, but is not visible or accessible to resources beyond the Proxmox VE host.</p><p>Proxmox VE's network model is sophisticated and very flexible. To learn more, see <a class="link" href="ch06.html" title="Chapter 6. Networking with Proxmox VE">Chapter 6</a>, <span class="emphasis"><em>Networking and Proxmox VE</em></span>, which is a chapter dedicated to Proxmox VE networking. Also, consider a visit to the wiki page <a class="ulink" href="https://pve.proxmox.com/wiki/Network_Model">https://pve.proxmox.com/wiki/Network_Model</a>.</p></div></div></div><div class="section" title="Confirm"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl4sec7"/>Confirm</h4></div></div></div><p>The <span class="strong"><strong>Confirm</strong></span> tab offers a summary view of the VM configuration to review before committing to the creation of the VM.</p><p>On this tab, a <span class="strong"><strong>Finish</strong></span> button appears where the <span class="strong"><strong>Next</strong></span> button was on the other tabs. To create the VM, click on the <span class="strong"><strong>Finish</strong></span> button.</p><p>After completing the <span class="strong"><strong>Create: Virtual Machine</strong></span> dialog, the virtual machine is configured—analogous to having built a physical computer, plugged it in, powered it up just long enough to insert your installation media in the optical drive, and then eagerly looking forward to it powering back on for the installation of the OS.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip31"/>Tip</h3><p>Stay conscious of the host's hardware specifications and cognizant of how resources are allocated as VMs and containers accumulate on a PVE host.</p></div></div><p>The next step is to start the newly created VM and install its operating system. First, let's step section steps through controlling the state of a virtual machine: starting it, shutting it down, and abruptly stopping it.</p></div></div><div class="section" title="Controlling the state of a virtual machine"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec2"/>Controlling the state of a virtual machine</h3></div></div></div><p>At this point in the process, the freshly created VM appears in <span class="strong"><strong>Server View</strong></span> in a powered off state:</p><p>
</p><div class="mediaobject"><img src="graphics/image_04_007.png" alt="Controlling the state of a virtual machine"/><div class="caption"><p>The icon of a VM that is stopped</p></div></div><p>
</p><p>In the preceding screenshot, the only VM on the host has a VM ID of 101 and the name <code class="literal">fedora-ch4</code>. A stopped VM is represented by a monitor icon with a black display.</p><p>If we select the VM in the left pane, buttons to control its state appear in the right pane, which is exactly what we saw with containers in the previous chapter:</p><p>
</p><div class="mediaobject"><img src="graphics/image_04_008.png" alt="Controlling the state of a virtual machine"/><div class="caption"><p>Starting a VM</p></div></div><p>
</p><p>The <span class="strong"><strong>Start</strong></span> button will "power on" the VM and the boot process will begin.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note32"/>Note</h3><p>A running VM is represented by a monitor icon with a white screen that visually distinguishes it from the icon for a stopped VM.</p></div></div><p>Once started, we can open the VM's noVNC console to see what's going on during the boot process, from the BIOS options through the OS's first interaction with the user. The same tool works for graphical user interfaces and command line interfaces.</p><p>
</p><div class="mediaobject"><img src="graphics/image_04_009.png" alt="Controlling the state of a virtual machine"/><div class="caption"><p>Changing the state of a running VM</p></div></div><p>
</p><p>To stop a virtual machine gracefully, use the <span class="strong"><strong>Shutdown</strong></span> button that becomes available upon start. Alternatively, use <span class="strong"><strong>Stop</strong></span> to shut down a VM abruptly. The <span class="strong"><strong>Reset</strong></span> button will halt the virtual machine, much as a hardware reset button would.</p><p>To destroy a virtual machine, ensure first that it is in a stopped state, then press the <span class="strong"><strong>Remove</strong></span> button to reveal a concerned warning that the process initiated is not reversible. PVE will offer the choice to <span class="strong"><strong>Cancel</strong></span> and give the action additional consideration, or to follow through with the destruction of the machine.</p></div><div class="section" title="Controlling a VM from the PVE command line"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec3"/>Controlling a VM from the PVE command line</h3></div></div></div><p>The <code class="literal">qm</code> command allows us to control the state of a VM from a Proxmox VE  command line interface. In the following examples, the changes will be made to the virtual machine with VM ID 101:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">qm destroy 101</code>: This destroys the VM and deletes all of its used or owned volumes</li><li class="listitem" style="list-style-type: disc"><code class="literal">qm reset 101</code>: This resets the VM</li><li class="listitem" style="list-style-type: disc"><code class="literal">qm resume 101</code>: This resumes the VM (if it's suspended)</li><li class="listitem" style="list-style-type: disc"><code class="literal">qm shutdown 101</code>: This shuts down the VM</li><li class="listitem" style="list-style-type: disc"><code class="literal">qm start 101</code>: This starts the VM</li><li class="listitem" style="list-style-type: disc"><code class="literal">qm stop 101</code>: This stops the VM</li><li class="listitem" style="list-style-type: disc"><code class="literal">qm suspend 101</code>: This suspends the machine</li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note33"/>Note</h3><p>The qm command offers full control of a VM, from creation to destruction. To learn more, visit the manual page at <a class="ulink" href="https://pve.proxmox.com/wiki/Manual:_qm">https://pve.proxmox.com/wiki/Manual:_qm</a>.</p></div></div><p>In the sections that follow, the abstract outline and illustration of the VM-creation and configuration process will become more concrete and specific as we apply what we learned to building two virtual machines: first we'll walk through the creation of a Windows Server 2012r2 VM, and then we'll create a Fedora 23 Server virtual machine.</p></div></div></div>
<div class="section" title="Practicing the creation of virtual machines"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec27"/>Practicing the creation of virtual machines</h1></div></div></div><p>In this section and the next, we'll run through the entire VM creation process, from the acquisition of ISO images, to the configuration of the machines, and the installation of the operating systems.</p><p>First, we'll step through the process for a Microsoft Windows Server 2012r2 system. Afterwards, we'll look at the creation of a VM intended for Fedora 23 Server.</p><div class="section" title="Virtualizing Windows Server 2012r2 with Proxmox VE"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec23"/>Virtualizing Windows Server 2012r2 with Proxmox VE</h2></div></div></div><p>If you want to precisely follow the installation process outlined here, it will require a Windows Server 2012r2 ISO image, perhaps from an existing DVD if necessary. If you have access to the Volume License Center, you're perhaps able to download the image file from Microsoft by visiting <a class="ulink" href="https://www.microsoft.com/Licensing/servicecenter/default.aspx">https://www.microsoft.com/Licensing/servicecenter/default.aspx</a>.</p><p>At the time of writing, Windows Server 2012r2 is available for evaluation (limited to 180 days) at Microsoft's TechNet Evaluation Center: <a class="ulink" href="https://www.microsoft.com/en-us/evalcenter/evaluate-windows-server-2012-r2">https://www.microsoft.com/en-us/evalcenter/evaluate-windows-server-2012-r2</a>.</p><p>
</p><div class="mediaobject"><img src="graphics/image_04_010.png" alt="Virtualizing Windows Server 2012r2 with Proxmox VE"/><div class="caption"><p>Microsoft's TechNet Evaluation Center</p></div></div><p>
</p><p>
</p><div class="mediaobject"><img src="graphics/image_04_011.png" alt="Virtualizing Windows Server 2012r2 with Proxmox VE"/><div class="caption"><p>Sign up, login, and download Mircrosoft Windows Server 2012r2</p></div></div><p>
</p><p>Download the ISO from a workstation on the same physical network as your Proxmox VE server, and then upload the image to PVE via the web interface as described in the preceding section.</p><p>When the upload is complete, it should be visible in the <span class="strong"><strong>Content</strong></span> tab of the local storage.</p><p>
</p><div class="mediaobject"><img src="graphics/image_04_012.png" alt="Virtualizing Windows Server 2012r2 with Proxmox VE"/><div class="caption"><p>Viewing available image files</p></div></div><p>
</p></div><div class="section" title="Configuring and creating the virtual machine"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec24"/>Configuring and creating the virtual machine</h2></div></div></div><p>To configure and create a Windows Server VM quickly, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">To get started, upload the Microsoft Windows Server from your workstation to the Proxmox VE server as described previously.</li><li class="listitem">With the OS install media now available to PVE, we can click on the <span class="strong"><strong>Create VM</strong></span> button to initiate the <span class="strong"><strong>Create:</strong></span> Virtual Machine dialog as described previously. Complete the fields in the <span class="strong"><strong>General</strong></span> tab, as illustrated in the following screenshot:<p>
</p><div class="mediaobject"><img src="graphics/image_04_013.png" alt="Configuring and creating the virtual machine"/></div><p>
</p></li><li class="listitem">Proceed to the <span class="strong"><strong>OS</strong></span> tab of the dialog by clicking on <span class="strong"><strong>Next</strong></span>. The left column of this dialog consists of options for Microsoft operating systems. Choose the top-most option, <span class="strong"><strong>Microsoft Windows 8/Server 2012</strong></span>, and click on <span class="strong"><strong>Next</strong></span> to continue to the <span class="strong"><strong>CD/DVD</strong></span> tab.<p>
</p><div class="mediaobject"><img src="graphics/image_04_014.png" alt="Configuring and creating the virtual machine"/></div><p>
</p></li><li class="listitem">On the <span class="strong"><strong>CD/DVD</strong></span> tab, select the top option to choose an ISO file. With the <span class="strong"><strong>Storage</strong></span> field set to local, use the drop-down menu for the <span class="strong"><strong>ISO Image</strong></span> field to choose the uploaded 2012r2 image. Click on <span class="strong"><strong>Next</strong></span> to continue.<p>
</p><div class="mediaobject"><img src="graphics/image_04_015.png" alt="Configuring and creating the virtual machine"/></div><p>
</p></li><li class="listitem">On the <span class="strong"><strong>Hard Disk</strong></span> tab, stay mindful that Server 2012r2 requires at least 32 GB of storage. Set an appropriate disk size and ensure that <span class="strong"><strong>Bus/Device</strong></span> is set to <span class="strong"><strong>IDE</strong></span>; avoid choosing <span class="strong"><strong>virtio</strong></span>. Set the format to <span class="strong"><strong>QEMU image format (qcow2)</strong></span> and click on <span class="strong"><strong>Next</strong></span> to continue to the <span class="strong"><strong>CPU</strong></span> tab.<p>
</p><div class="mediaobject"><img src="graphics/image_04_016.png" alt="Configuring and creating the virtual machine"/></div><p>
</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip34"/>Tip</h3><p>We'll cover <span class="strong"><strong>Bus/Device</strong></span> types in the next chapter.</p></div></div></li><li class="listitem">On the <span class="strong"><strong>CPU</strong></span> tab, configure the number of sockets and the number of cores per socket to commit to the VM. For the purposes of this exercise, I've set <span class="strong"><strong>Sockets</strong></span> to <code class="literal">1</code> and set the number of cores to <code class="literal">2</code>. The <span class="strong"><strong>Type</strong></span> field should be set to <span class="strong"><strong>Default (kvm64)</strong></span>. Keep in mind that we can change the CPU configuration later as necessary. Click on <span class="strong"><strong>Next</strong></span> to configure the memory for the VM.<p>
</p><div class="mediaobject"><img src="graphics/image_04_017.png" alt="Configuring and creating the virtual machine"/></div><p>
</p></li><li class="listitem">Windows Server 2012r2 requires a minimum of 512 MB of RAM. As illustrated in the following screenshot, PVE provides an option for using a fixed amount of RAM or automatically allocating RAM within a specified range.<p>
</p><div class="mediaobject"><img src="graphics/image_04_018.png" alt="Configuring and creating the virtual machine"/></div><p>
</p><p>For the purposes of this exercise, a fixed amount of 2,048 MB of memory has been allocated, with the understanding that this can be easily changed later. When the memory is tuned the way you'd like, click on <span class="strong"><strong>Next</strong></span> to configure the network.</p></li><li class="listitem">As the following screenshot illustrates, the IP address of a VM can't be preconfigured like it can be with containers:<p>
</p><div class="mediaobject"><img src="graphics/image_04_019.png" alt="Configuring and creating the virtual machine"/></div><p>
</p><p>As illustrated, <span class="strong"><strong>Bridged mode</strong></span> is selected rather than <span class="strong"><strong>NAT mode</strong></span>. This choice is deliberate. In this case, <span class="strong"><strong>NAT mode</strong></span> would prevent us from accessing the virtual machine's desktop through Microsoft's, Remote Desktop Protocol or Remote Server Administration Tool.</p><p>
<span class="strong"><strong>Bridged mode</strong></span> provides more choices for accessing the VM, since it's somewhat analogous to attaching a machine to a switch on the physical network. There are consequences for this decision in regard to isolation and security, especially with Proxmox's firewall disabled.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip35"/>Tip</h3><p>To learn more about PVE's integrated firewall features, visit <a class="ulink" href="https://pve.proxmox.com/wiki/Proxmox_VE_Firewall#Enabling_firewall_for_qemu_guest_and_openvz_veth">https://pve.proxmox.com/wiki/Proxmox_VE_Firewall#Enabling_firewall_for_qemu_guest_and_openvz_veth</a>.</p></div></div><p>Networking can be reconfigured at any point after the creation of the virtual machine.</p><p>When the <span class="strong"><strong>Network</strong></span> tab is configured to your satisfaction, click on <span class="strong"><strong>Next</strong></span> to view a configuration summary and to confirm the configuration.</p></li><li class="listitem"> The final tab, labeled <span class="strong"><strong>Confirm</strong></span>, provides a summary of the VM's configuration and the opportunity to finally create the VM.<p>
</p><div class="mediaobject"><img src="graphics/image_04_020.png" alt="Configuring and creating the virtual machine"/></div><p>
</p><p>Click on the <span class="strong"><strong>Finish</strong></span> button to confirm your configuration and create the virtual machine, but feel encouraged to use this opportunity to return to a prior step and adjust the configuration.</p><p>Keep in mind, however, that many of these settings can be changed even after the VM is created and the OS installed, sometimes without even rebooting the machine.</p><p>Within 30 seconds, the new VM will appear in the left frame of the Web interface:</p><p>
</p><div class="mediaobject"><img src="graphics/image_04_021.png" alt="Configuring and creating the virtual machine"/></div><p>
</p></li></ol></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip36"/>Tip</h3><p>
<span class="strong"><strong>There's another way</strong></span></p><p>Note that in this chapter, the Windows Server VM is configured so we can quickly try Windows Server virtualization using a TechNet trial; the configuration is not optimized for performance and is not ideal for production. Ideally, a Windows Server virtual machine in Proxmox VE that is production ready will be configured to take advantage of paravirtualization; in PVE, this is just a matter of choosing <span class="strong"><strong>virtio</strong></span> on two tabs. On the <span class="strong"><strong>Hard Disk</strong></span> tab, consider choosing <span class="strong"><strong>virtio</strong></span> instead of <span class="strong"><strong>IDE</strong></span>; and on the <span class="strong"><strong>Network</strong></span> tab, consider virtio rather than Intel E1000. This does, however, complicate the Windows Server installation since it doesn't ship with virtio drivers. Consequently, we'd need to upload drivers on an ISO image to PVE and make them available to Windows Server early in the OS installation process. Fortunately, this configuration is well documented on the PVE wiki at <a class="ulink" href="https://pve.proxmox.com/wiki/Windows_2012_guest_best_practices">https://pve.proxmox.com/wiki/Windows_2012_guest_best_practices</a>.</p></div></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip37"/>Tip</h3><p>
<span class="strong"><strong>Downloading the example code</strong></span></p><p>You can download the example code files for this book from your account at <a class="ulink" href="http://www.packtpub.com">http://www.packtpub.com</a>. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p><p>You can download the code files by following these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in or register to our website using your e-mail address and password.</li><li class="listitem">Hover the mouse pointer on the <span class="strong"><strong>SUPPORT</strong></span> tab at the top.</li><li class="listitem">Click on <span class="strong"><strong>Code Downloads &amp; Errata</strong></span>.</li><li class="listitem">Enter the name of the book in the <span class="strong"><strong>Search</strong></span> box.</li><li class="listitem">Select the book for which you're looking to download the code files.</li><li class="listitem">Choose from the drop-down menu where you purchased this book from.</li><li class="listitem">Click on <span class="strong"><strong>Code Download</strong></span>.</li></ol></div></div></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip127"/>Tip</h3><p>Once the file is downloaded, please make sure that you unzip or extract the folder using the latest version of:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">WinRAR / 7-Zip for Windows</li><li class="listitem" style="list-style-type: disc">Zipeg / iZip / UnRarX for Mac</li><li class="listitem" style="list-style-type: disc">7-Zip / PeaZip for Linux</li></ul></div></div></div></div><div class="section" title="Starting the VM and installing Windows Server"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec25"/>Starting the VM and installing Windows Server</h2></div></div></div><p>After the virtual machine is configured and available for use, select it in the <span class="strong"><strong>Server View</strong></span> in the upper left pane of the web interface. Starting the VM is as simple as pressing the Start button that is revealed in the right pane as previously described.</p><p>When the machine is started, its icon will change from a monitor with a black screen to one with a white screen.</p><p>To access the machine's display via noVNC, click on the <span class="strong"><strong>Console</strong></span> button; a window will popup that allows you to watch the VM's boot from the Windows Server 2012r2 install disc and will eventually display the <span class="strong"><strong>Windows Setup</strong></span> wizard:</p><p>
</p><div class="mediaobject"><img src="graphics/image_04_022.png" alt="Starting the VM and installing Windows Server"/></div><p>
</p><p>Follow the on-screen instructions to complete the installation and configuration of Windows Server 2012r2.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip38"/>Tip</h3><p>Support for installation of this OS is available at <a class="ulink" href="https://technet.microsoft.com/en-us/library/jj134246.aspx">https://technet.microsoft.com/en-us/library/jj134246.aspx</a>.</p></div></div><p>Once the Windows Setup dialogs are complete, the installation will proceed and the machine will restart a few times until it is ready for a user to log in. Log in to the server to see the new desktop.</p><p>
</p><div class="mediaobject"><img src="graphics/image_04_023.png" alt="Starting the VM and installing Windows Server"/></div><p>
</p><p>Note that both the two preceding screenshots have double mouse-pointers. One for the local workstation and one for the desktop accessed via noVNC. This is awkward and cumbersome.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip39"/>Tip</h3><p>
<span class="strong"><strong>noVNC</strong></span></p><p>The name noVNC is counterintuitive; noVNC provides, in fact, remote desktop access and desktop sharing using the VNC protocol.</p><p>However, noVNC does distinguish itself; instead of connecting to a remote computer running a VNC server by configuring a client, choosing noVNC produces, from an HTML5- and JavaScript-enabled browser, a pop-up window that renders the remote desktop served by the virtual machine.</p></div></div><p>There's a simple solution, enable <span class="strong"><strong>Use tablet for pointer</strong></span> in the VM's <span class="strong"><strong>Options</strong></span> tab if it's not already enabled:</p><p>
</p><div class="mediaobject"><img src="graphics/image_04_024.png" alt="Starting the VM and installing Windows Server"/></div><p>
</p><p>If that doesn't resolve the issue, ensure the <span class="strong"><strong>Display</strong></span> field on the hardware tab is set to <span class="strong"><strong>Default</strong></span> rather than <span class="strong"><strong>SPICE</strong></span>.</p></div><div class="section" title="Creating a VM for Fedora 23 Server"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec26"/>Creating a VM for Fedora 23 Server</h2></div></div></div><p>In the previous sections, we detailed the configuration of a virtual machine  intended for use with Windows Server 2012r2. In this section, we'll build on our experience and apply what we learned to building a server running Fedora 23 (Server). Creating this VM offers a simple way to practice using paravirtualization for the virtual network interface card and the virtual hard-disk interface.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Review Fedora 23 Server installation at <a class="ulink" href="http://www.tecmint.com/installation-of-fedora-23-server-and-administration-with-cockpit-tool/">http://www.tecmint.com/installation-of-fedora-23-server-and-administration-with-cockpit-tool/</a>.</li><li class="listitem">Download the netinst ISO from <a class="ulink" href="http://mirrors.rit.edu/fedora/fedora/linux/releases/23/Server/x86_64/iso/Fedora-Server-netinst-x86_64-23.iso">http://mirrors.rit.edu/fedora/fedora/linux/releases/23/Server/x86_64/iso/Fedora-Server-netinst-x86_64-23.iso</a>.<p>
</p><div class="mediaobject"><img src="graphics/image_04_025.png" alt="Creating a VM for Fedora 23 Server"/><div class="caption"><p>Downloading the Fedora 23 net installation image</p></div></div><p>
</p></li><li class="listitem">Login to the PVE web interface.</li><li class="listitem">Upload the image to PVE's local storage as previously described.</li><li class="listitem">Click on <span class="strong"><strong>Create VM</strong></span>, just as we did for Windows Server 2012r2.</li><li class="listitem">In the <span class="strong"><strong>General</strong></span> tab of the <span class="strong"><strong>Create: Virtual Machine</strong></span> dialog, give the machine a well-considered name; in the following screenshot, <code class="literal">fedora-ch4</code> is used and the VM is assigned VM ID 101. Proceed to the <span class="strong"><strong>OS</strong></span> tab.<p>
</p><div class="mediaobject"><img src="graphics/image_04_026.png" alt="Creating a VM for Fedora 23 Server"/></div><p>
</p></li><li class="listitem">On the <span class="strong"><strong>OS</strong></span> tab, there are four options that aren't for Microsoft Windows; for Fedora 23, choose the <span class="strong"><strong>Linux 4.X/3.X/2.6 Kernel (I26)</strong></span> radio button and proceed to the <span class="strong"><strong>CD/DVD</strong></span> tab.<p>
</p><div class="mediaobject"><img src="graphics/image_04_027.png" alt="Creating a VM for Fedora 23 Server"/></div><p>
</p></li><li class="listitem">Choose the first option on the <span class="strong"><strong>CD/DVD</strong></span> tab, the <span class="strong"><strong>Use CD/DVD disc image file (iso)</strong></span> radio button; choose <span class="strong"><strong>local</strong></span> in the <span class="strong"><strong>Storage</strong></span> field and choose the image file uploaded in step 4 from the <span class="strong"><strong>ISO Image</strong></span> drop-down menu:<p>
</p><div class="mediaobject"><img src="graphics/image_04_028.png" alt="Creating a VM for Fedora 23 Server"/><div class="caption"><p>Selecting the Fedora install disk on the CD/DVD tab</p></div></div><p>
</p><p>Proceed to the <span class="strong"><strong>Hard Disk</strong></span> tab to configure a virtual hard disk for the Fedora Server VM.</p></li><li class="listitem">On this virtual machine, we'll rely on paravirtualization for improved efficiency. On the <span class="strong"><strong>Hard Disk</strong></span> tab, choose <span class="strong"><strong>VIRTIO</strong></span> from the <span class="strong"><strong>Bus/Device</strong></span> drop-down menu. Note that in the following screenshot, the <span class="strong"><strong>Disk size</strong></span> field has changed from the default 32 GB to 64 GB; please choose a disk size at your discretion. When finished, continue to the <span class="strong"><strong>CPU</strong></span> tab.<p>
</p><div class="mediaobject"><img src="graphics/image_04_029.png" alt="Creating a VM for Fedora 23 Server"/><div class="caption"><p>Configuring the Virtual Disk</p></div></div><p>
</p></li><li class="listitem">We'll configure the <span class="strong"><strong>CPU</strong></span> tab just as we did for the Windows Server 2012r2 VM we created in the preceding section: allocate 1 socket and 2 cores, and specify <span class="strong"><strong>Default (KVM64)</strong></span> in the <span class="strong"><strong>Type</strong></span> drop-down menu. When the <span class="strong"><strong>CPU</strong></span> tab is configured to your satisfaction, proceed to the Memory tab to allocate RAM for the VM.</li><li class="listitem">Use your discretion on the <span class="strong"><strong>Memory</strong></span> tab. In the screenshot below, a fixed-size memory of 1024 MB is specified. Once you've allocated RAM according to your preferences, continue to the <span class="strong"><strong>Network</strong></span> tab.<p>
</p><div class="mediaobject"><img src="graphics/image_04_030.png" alt="Creating a VM for Fedora 23 Server"/><div class="caption"><p>Allocate RAM for the Fedora virtual machine on the Memory tab</p></div></div><p>
</p></li><li class="listitem">On the network tab, let's configure Fedora so it's accessible to other machines on the physical network; just as we did with Microsoft Server, choose the <span class="strong"><strong>Bridged mode</strong></span> radio button. If your PVE host has a single network interface, set the <span class="strong"><strong>Bridge</strong></span> drop-down menu to <code class="literal">vmbr0</code>; otherwise, use your discretion to choose an appropriate bridge.<p>Then, in the right-hand column of the <span class="strong"><strong>Network</strong></span> tab, select <span class="strong"><strong>VirtIO (paravirtualized)</strong></span> as the <span class="strong"><strong>Model</strong></span> of the virtual network interface. To review, <span class="strong"><strong>Intel E1000</strong></span> is our most widely compatible choice, while <span class="strong"><strong>virtio</strong></span> is the best-performing alternative; both are supported "out of the box" by Fedora Server.</p><p>
</p><div class="mediaobject"><img src="graphics/image_04_031.png" alt="Creating a VM for Fedora 23 Server"/><div class="caption"><p>Configuring bridged mode network on the Network tab</p></div></div><p>
</p><p>Proceed to the <span class="strong"><strong>Confirm</strong></span> tab and commit to the VM configuration; this is a good opportunity to make discretionary changes to the configuration before building the VM.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip40"/>Tip</h3><p>Keep in mind through this process that, in every case except that of the virtual hard disk, the resources allocated here can be changed later with minimal fuss.</p></div></div></li><li class="listitem">Click on <span class="strong"><strong>Finish</strong></span> to create the virtual machine and close the <span class="strong"><strong>Create: Virtual Machine</strong></span> dialog.<p>We used the default display option in the Windows Server machine we configured in the previous section. It's a great option that works with an established technology underlying PVE's noVNC console.</p><p>However, by installing additional software on Windows Server, we could have relied on SPICE instead.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip41"/>Tip</h3><p>
<span class="strong"><strong>SPICE</strong></span></p><p>This option appears in the menu as <span class="strong"><strong>SPICE</strong></span> (the Simple Protocol for Independent Computing Environments), but it refers either to the SPICE protocol that's relied on, or to the dependence on a combination of SPICE components, including guest tools (installed on the VM) and the SPICE client installed on the Workstation. We can infer from this that making use of SPICE requires some post-installation work. SPICE is the only solution whose explicit mission is to provide remote access to VMs. Moreover, clients are available for mobile devices and several operating systems, and the protocol offers many options for both implementation and usage.
Red Hat is the current developer of this open source solution, and it promotes it heavily as part of its KVM-QEMU virtualization platform. The spice-module is also, however, integrated into Proxmox VE for use with its own KVM-QEMU VMs. Since Fedora Server includes software to support the SPICE display, let's see what preparing for that is like.</p></div></div></li><li class="listitem">While the Fedora Server virtual machine is still stopped, select its <span class="strong"><strong>Hardware</strong></span> tab.</li><li class="listitem">Double-click on the <span class="strong"><strong>Display</strong></span> configuration; the <span class="strong"><strong>Edit: Display</strong></span> dialog opens, with a drop-down menu labeled <span class="strong"><strong>Graphic Card</strong></span>. Change the selection from <span class="strong"><strong>Default</strong></span> to <span class="strong"><strong>SPICE</strong></span> and click on the <span class="strong"><strong>OK</strong></span> button:<p>
</p><div class="mediaobject"><img src="graphics/image_04_032.png" alt="Creating a VM for Fedora 23 Server"/><div class="caption"><p>Configuring the VM for use with the SPICE console</p></div></div><p>
</p><p>When you're ready to install Fedora 23 Server, select the VM in the left pane of the browser window. </p></li><li class="listitem">Once selected, start the VM. Click on the arrow beside the console button to reveal a choice between the noVNC and SPICE consoles.<p>
</p><div class="mediaobject"><img src="graphics/image_04_033.png" alt="Creating a VM for Fedora 23 Server"/><div class="caption"><p>Choosing the SPICE console to access a running virtual machine</p></div></div><p>
</p></li><li class="listitem">Select <span class="strong"><strong>SPICE</strong></span> to launch a popup console browser window.</li></ol></div><p>
</p><div class="mediaobject"><img src="graphics/image_04_034.png" alt="Creating a VM for Fedora 23 Server"/><div class="caption"><p>Initiating the installation of Fedora 23 on the virtual machine with the SPICE console</p></div></div><p>
</p><p>Proceed with the installation by pressing 
<span class="emphasis"><em>i
</em></span> or navigating to <span class="strong"><strong>Install Fedora 23</strong></span> with the up and down cursor keys on the keyboard.</p><p>After about 20 seconds, the graphical installer for Fedora 23 will begin to ask configuration questions, starting with the language to use with the installer, and moving on to the network configuration and host name. Ultimately, you'll also be asked to set the password of the root user and create additional accounts.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip42"/>Tip</h3><p>If you have questions about network configuration for your new Fedora 23 VM, see the <span class="emphasis"><em>Fedora 23 Networking Guide</em></span> at <a class="ulink" href="https://docs.fedoraproject.org/en-US/Fedora/23/pdf/Networking_Guide/Fedora-23-Networking_Guide-en-US.pdf">https://docs.fedoraproject.org/en-US/Fedora/23/pdf/Networking_Guide/Fedora-23-Networking_Guide-en-US.pdf</a>.</p></div></div><p>Follow the onscreen instructions to complete the Fedora 23 installation. The time spent on installation is contingent on how you allocated resources, how fast your Internet connection is, and what packages you choose to install during the initial Fedora 23 configuration process.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip43"/>Tip</h3><p>
<span class="strong"><strong>Support for Fedora 23 Server installation</strong></span></p><p>Fedora 23 Server  features can be found at <a class="ulink" href="https://getfedora.org/en/server/">https://getfedora.org/en/server/</a>.</p><p>The official Fedora 23 Server installation guide is at <a class="ulink" href="https://docs.fedoraproject.org/en-US/Fedora/23/html/Installation_Guide/">https://docs.fedoraproject.org/en-US/Fedora/23/html/Installation_Guide/</a>.</p><p>For post installation suggestions, go to <a class="ulink" href="http://www.tecmint.com/things-to-do-after-fedora-23-installation/">http://www.tecmint.com/things-to-do-after-fedora-23-installation/</a>.</p></div></div></div><div class="section" title="Command line virtual machine creation"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec27"/>Command line virtual machine creation</h2></div></div></div><p>We can use the <code class="literal">qm</code> create command to create a Proxmox VE virtual machine from the command line. This is a boon to command line users and those looking to script automated solutions.</p><p>The bash script that follows creates a VM to run Fedora 23 Server:</p><pre class="programlisting">    #!/bin/bash -ex&#13;    # Creates a VM intended for Fedora 23 Server&#13;     qm create 103 \&#13;         -balloon 512 \&#13;         -bootdisk virtio0 \&#13;         -cores 2 \&#13;         -ide2 local:iso/Fedora-Server-netinst-x86_64-23.iso,media=cdrom \&#13;         -memory 1024 \&#13;         -name fedora-server-ch4 \&#13;         -net0 virtio,bridge=vmbr0 \&#13;         -numa 0 \&#13;         -ostype l26 \&#13;         -sockets 1 \&#13;         -virtio0 local:101/vm-101-disk-1.qcow2,size=32G \&#13;         -vga qxl&#13;</pre><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip44"/>Tip</h3><p>See <a class="ulink" href="https://pve.proxmox.com/wiki/Manual:_qm">https://pve.proxmox.com/wiki/Manual:_qm</a> to learn more about creating virtual machines from the Proxmox VE command line interface.</p></div></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec28"/>Summary</h1></div></div></div><p>To the shrewd administrator, the capability to utilize containers in conjunction with virtual machines in production environments offers flexibility and increased opportunities for professional discretion and informed choices. System virtualization continues to have a currency in the datacenter.</p><p>Consequently, we began this chapter with a high-level overview of the VM creation and configuration process with Proxmox VE—from obtaining the install media, to configuring the VM, and installing the operating system.</p><p>Afterwards, we took that abstract outline and applied it to two concrete cases: the creation of a Microsoft Windows Server 2012r2 and Fedora 23 Server virtual machines.</p><p>In <a class="link" href="ch05.html" title="Chapter 5. Working with Virtual Disks">Chapter 5</a>, <span class="emphasis"><em>Working with Virtual Drives</em></span>, you will learn all you need to know to make informed choices when determining what format best suits our virtual hard drives.</p><p>We'll give particular attention to making use of VMs created with Oracle's VirtualBox, VMware Player, and VMware workstation in our new Proxmox virtual environments.</p><p>There's a certain satisfaction in repurposing something that was never intended for our scenario.</p><p>Let's experience that thrill next.</p></div></body></html>