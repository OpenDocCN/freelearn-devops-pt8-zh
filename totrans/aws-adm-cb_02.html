<html><head></head><body>
        <section>

            <header>
                <h1 class="header-title">Managing AWS Accounts</h1>
            </header>

            <article>
                
<p>In this chapter, we will cover the following topics:</p>
<ul>
<li>Setting up a master account</li>
<li>Creating a member account</li>
<li>Inviting an account</li>
<li>Managing your accounts</li>
<li>Adding a service control policy</li>
</ul>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Introduction</h1>
            </header>

            <article>
                
<p>We work with a lot of companies who maintain a large, ever-growing number of AWS accounts. Keeping a handle on all these accounts has typically been quite difficult to do—even for the most seasoned AWS users.</p>
<p>With the release of AWS Organizations, you now have the ability to centrally manage your AWS accounts, to arrange them into logical groupings and hierarchies, and to apply controls to them in ways which haven't previously been possible on the AWS platform.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Setting up a master account</h1>
            </header>

            <article>
                
<p>All accounts that use AWS Organizations for billing and control purposes must have a <em>master account</em>. This account controls membership to the organization, and pays the bills of all the members (someone's got to do it).</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">How to do it...</h1>
            </header>

            <article>
                
<p>To set up a master account, perform the following steps:</p>
<ol>
<li>Go to the <span class="packt_screen">My Organization</span> section of the account you want to become the master. You must be logged in with your root credentials (that is, those you created the account with):</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_02_001.png"/></div>
<ol start="2">
<li>In the <span class="packt_screen">AWS Organizations</span> section of the AWS console, click on <span class="packt_screen">Create organization</span>, as shown in the following screenshot:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_02_002.png"/></div>
<ol start="3">
<li>Unless you have a specific requirement, choose <span class="packt_screen">ENABLE ALL FEATURES</span> to get the full benefit of organizations, as shown in the following screenshot:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_02_003.png"/></div>
<ol start="4">
<li>Now that your account has been converted, you can return to the <span class="packt_screen">AWS Organizations</span> page to see a list of all your accounts:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_02_004.png"/></div>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">How it works...</h1>
            </header>

            <article>
                
<p>While this is a very simple recipe, it's the first thing you must do before you can use any of the useful features of AWS Organizations.</p>
<p>Here you can see a high-level diagram of the relationships between master accounts, members, and <strong>organizational units</strong> (<strong>OUs</strong>):</p>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="assets/B06236_02_05.png"/></div>
<p>We deliberately enable all the features of organizations. The consolidated billing option is available for backward compatibility—before organizations, consolidated billing was your only option to link accounts.</p>
<div class="packt_tip"><em>Do not use your master account for day-to-day tasks</em>. Since it is so important, it doesn't make sense to risk using it and/or having access keys for it. If your master account was to become compromised somehow, it would impact all of your member accounts. Just don't do it.</div>
<p>The master account will always have a star next to its name.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">There's more...</h1>
            </header>

            <article>
                
<p>All of the organizations functionality is exposed via the API. This means you can use the AWS SDKs or the CLI tool to do the same things you would in the web console.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Multi-factor authentication</h1>
            </header>

            <article>
                
<p>As mentioned in the consolidated billing confirmation e-mail, it is advisable to configure <strong>multi-factor authentication</strong> (<strong>MFA</strong>) on your console. To do this, log in as your root user (that is, the credentials you used when first creating your account), go to the <strong>Identity and Access Management</strong> (<strong>IAM</strong>) console, and follow the <span class="packt_screen">Activate MFA on your root account</span> prompts.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Using the CLI</h1>
            </header>

            <article>
                
<p>You can easily create your master account with the CLI tool. The following command will turn your account into a master account, with all organizations features enabled:</p>
<pre>
<strong>aws organizations create-organization</strong>
</pre>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">See also</h1>
            </header>

            <article>
                
<ul>
<li>The <em>Inviting an account</em> recipe</li>
<li>The <em>Creating a member account</em> recipe</li>
</ul>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Creating a member account</h1>
            </header>

            <article>
                
<p>Once your organization is up and running, the most common use you will have for it is automating the account creation process. Accounts created inside an organization are referred to as <strong>member accounts</strong>.</p>
<p>All charges incurred by a member account will be billed to the master account.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Getting ready</h1>
            </header>

            <article>
                
<p>Obviously, you will need an organization to perform this recipe. See the other recipes in this chapter to get started.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">How to do it...</h1>
            </header>

            <article>
                
<ol>
<li>Run the CLI tool command to create a new account, with appropriate values:</li>
</ol>
<pre>
<strong>        aws organizations create-account \</strong><br/><strong>          --email &lt;member-account-owners@email.com&gt; \</strong><br/><strong>          --account-name &lt;member-account-name&gt; \ </strong><br/><strong>          --query 'CreateAccountStatus.Id'</strong>
</pre>
<ol start="2">
<li>This command will return a <kbd>create account status</kbd> request ID value that you can use to check the status:</li>
</ol>
<pre>
<strong>        aws organizations describe-create-account-status \ </strong><br/><strong>          --create-account-request-id &lt;your-create-account-status-id&gt;</strong>
</pre>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">How it works...</h1>
            </header>

            <article>
                
<p>The command to create a member account in your organization is extremely simple.</p>
<div class="packt_infobox">The e-mail address used cannot be associated with any other AWS accounts.</div>
<p>The account creating process takes some time, so it is done <em>asynchronously</em>. This means that you won't receive an immediate status to your <kbd>create-account</kbd> command. Instead, the command in this recipe will return a request ID.</p>
<p>This ID is then passed to another account to check the status of the creation. When the status is <kbd>CREATED</kbd>, you can start to use the new account.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">There's more...</h1>
            </header>

            <article>
                
<p>While this functionality is definitely useful, the AWS Organizations service is relatively new. This means there are a few <em>features</em> you should be aware of.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Accessing the member account</h1>
            </header>

            <article>
                
<p>Once you've created your member account, it's time to put it to work!</p>
<p>An IAM role will be present in the new account, with a default name of <kbd>OrganizationAccountAccessRole</kbd>. This is so you can assume the role (from your master account) and administer the member account. While this name is as good as any, it can be configured by passing the <kbd>--role-name</kbd> argument when creating the account.</p>
<p>In order to assume the role, you need to know its <strong>Amazon Resource Name</strong> (<strong>ARN</strong>). Working out the ARN is a multi-step process:</p>
<ol>
<li>List your member accounts by running the following command in your master account:</li>
</ol>
<pre>
<strong>        aws organizations list-accounts</strong>
</pre>
<ol start="2">
<li>Find the account you created (by its name) and note the ID value in the record. Using that ID, generate the role's ARN by following this pattern:</li>
</ol>
<pre>
<strong>        arn:aws:iam::&lt;your-member-account-<br/>        id&gt;:role/OrganizationAccountAccessRole</strong>
</pre>
<ol start="3">
<li>If you have changed the created role's name, update the last part of the ARN accordingly.</li>
</ol>
<p>See the recipes in <a href="c19319d5-2db2-4b99-ad4c-1676db3bae2f.xhtml"><span class="ChapterrefPACKT">Chapter 8</span></a>, <em>Security and Identity</em> for information on how to best manage multiple accounts.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Service control policies</h1>
            </header>

            <article>
                
<p>The <strong>service control policies</strong> (<strong>SCPs</strong>) are another major feature of AWS Organizations. You can apply them at multiple levels/resources, including accounts (both member accounts and invited accounts). Check the other recipes in this chapter for more details.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Root credentials</h1>
            </header>

            <article>
                
<p>Some activities still require the root credentials of the account. An example activity would be closing (or deleting) an account (see the next section for more details).</p>
<p>In order to do this, you will need to do the password recovery process for the e-mail that was associated with the account when the <kbd>create-account</kbd> request was sent.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Deleting accounts</h1>
            </header>

            <article>
                
<p>At the time of writing, <em>there is no way to delete an account created in your organization via the API</em>. We can only imagine that being able to programmatically delete a member account created in an organization will be a <em>highly requested</em> feature, and will be addressed soon. You can still go into the member account and close it using the root credentials, but these don't exist by default.</p>
<div class="packt_infobox">While you can technically delete your <em>organization</em> via the API, you cannot do it if you have created any member accounts in your organization (because you can't delete them, your organization will never be empty). This should improve in the near future, but is still worth being aware of now.</div>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">See also</h1>
            </header>

            <article>
                
<ul>
<li>The <em>Setting up a master account</em> recipe</li>
<li>The <em>Adding a service control policy</em> recipe</li>
<li>The <em>Cross-account user roles</em> recipe in <a href="c19319d5-2db2-4b99-ad4c-1676db3bae2f.xhtml"><span class="ChapterrefPACKT">Chapter 8</span></a>, <em>Security and Identity</em></li>
</ul>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Inviting an account</h1>
            </header>

            <article>
                
<p>While it makes sense to create new accounts in your organization, what do you do with all the other accounts you have now?</p>
<p>You can invite existing accounts to your organization, which means you can treat them just like a member account from an administrative point of view. This greatly simplifies the administrative overhead of your accounts, as there isn't a separate process for <em>old</em> and <em>new</em> accounts.</p>
<p>As this is generally performed once for each existing account, we will use the console.</p>
<div class="packt_tip">All the AWS organizations functionality is available via the SDKs and AWS CLI tool. If you need to automate this process, you can.</div>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Getting ready</h1>
            </header>

            <article>
                
<p>You must have enabled AWS Organizations for one of your accounts (your master account), and have another account that has not been made part of an organization yet (that you will invite).</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">How to do it...</h1>
            </header>

            <article>
                
<ol>
<li>From the AWS console of the master account, click on your username, and select <span class="packt_screen">My Organization</span> from the drop-down menu:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_02_006.png"/></div>
<ol start="2">
<li>You will be taken to the <span class="packt_screen">AWS Organizations</span> console, where you will see your current account:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_02_007.png"/></div>
<ol start="3">
<li>Click on the <span class="packt_screen">Invitations</span> tab in the top-right of the console:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_02_008.png"/></div>
<ol start="4">
<li>Click on the <span class="packt_screen">Invite account</span> button. Specify the account ID (or main e-mail address) of the account to invite:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_02_009.png"/></div>
<ol start="5">
<li>Once you click <span class="packt_screen">Invite</span>, you will be taken to a list of invitations where you can view the status:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_02_010.png"/></div>
<ol start="6">
<li>At this stage, the target/invited account will receive an e-mail notifying them of the invite:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_02_011.png"/></div>
<ol start="7">
<li>Log in to the invited account and go to the <span class="packt_screen">My Organization</span> link under the user menu:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_02_012.png"/></div>
<ol start="8">
<li>In the <span class="packt_screen">AWS Organizations</span> console, you can see the pending invite on the left:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_02_013.png"/></div>
<ol start="9">
<li>Clicking on the invite, you can see its details:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_02_014.png"/></div>
<ol start="10">
<li>When the invite includes all features, you will be asked to confirm your acceptance:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_02_015.png"/></div>
<ol start="11">
<li>Once confirmed, you can now see the details of the organization you have joined:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_02_016.png"/></div>
<ol start="12">
<li>At this stage, the master account will be notified of the accepted invite:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_02_017.png"/></div>
<ol start="13">
<li>Back in the master account, you can now see the new account alongside the master:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_02_018.png"/></div>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">How it works...</h1>
            </header>

            <article>
                
<p>While there are many steps involved, the process of inviting an existing account is a relatively simple <em>handshake</em> process. This means that both sides must actively initiate/accept the invite, in order for it to succeed—an invite cannot be forced.</p>
<p>After specifying the target account's account ID (or e-mail address), the e-mail address associated will be notified.</p>
<p>As part of the handshake process, the invited account must explicitly accept the invite.</p>
<div class="packt_infobox">It is important to note that the default invite type (and what we have used in the recipe) is to use the full feature set for AWS Organizations. As noted in the console, this means that the invited account <em>could be prevented from leaving the organization</em> if the relevant policies are configured.</div>
<p>After confirmation, both parties will receive an e-mail detailing the membership. From this point forward, the bill for the invited account will be paid by the master account.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">There's more...</h1>
            </header>

            <article>
                
<p>Invited accounts are treated differently to accounts created via the organizations functionality.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Removing accounts</h1>
            </header>

            <article>
                
<p>Unlike <em>member accounts</em> (which are created via the AWS Organizations API), invited accounts can be removed from an organization.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Consolidated billing</h1>
            </header>

            <article>
                
<p>As an alternative to the <em>full feature</em> invite, it is possible to specify just <em>consolidated billing</em> mode for an organization. In this mode, no OUs or policies will be available, only the billing relationship will be shared between the accounts (that is, the master account will pay the bill of the member accounts).</p>
<div class="packt_infobox">Any pre-existing accounts that were configured to use consolidated billing will have been <em>automatically</em> migrated to AWS Organizations <em>in consolidated billing mode</em>.</div>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">See also</h1>
            </header>

            <article>
                
<ul>
<li>The <em>Creating a member account</em> recipe</li>
</ul>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Managing your accounts</h1>
            </header>

            <article>
                
<p>There are a number of ways to group and arrange your AWS accounts. How you do this is completely up to you, but here are a few examples to consider:</p>
<ul>
<li><strong>Business unit (BU) or location</strong>: You may wish to allow each BU to work in isolation on their own products or services, on their own schedule, without impacting other parts of the business</li>
<li><strong>Cost center</strong>: Grouping according to cost may help you track spend versus allocated budget</li>
<li><strong>Environment type</strong>: It may make sense to group your development, test, and production environments together in a way which helps you manage the controls across each environment</li>
<li><strong>Workload type or data classification</strong>: Your company may want to isolate workload types from each other, or ensure that particular controls are applied to all accounts containing a particular kind of data</li>
</ul>
<p>In the following fictitious example, we have isolated the <strong>Sitwell Enterprises Account</strong> from the rest of the organization by placing it in an OU called <strong>Sudden Valley</strong>. Perhaps they operate in a different geographical location and have different regulatory requirements around controls and access.</p>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" height="295" src="assets/image_02_019.png" width="439"/></div>
<div class="packt_figure packt_figref CDPAlignCenter CDPAlign">Organization hierarchy</div>
<p>Note that while it's also technically possible for us to put the master account inside an OU, we avoid doing this to make it obvious that:</p>
<ul>
<li>It's the master account and has control over the entire organization</li>
<li>The rules we set, using SCPs for the member accounts in our organization, do not apply to the master account (because they can't)</li>
</ul>
<p>Learn more about SCPs in the <em>Adding a service control policy</em> recipe in this chapter.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Getting ready</h1>
            </header>

            <article>
                
<p>Before we can proceed, you should have already done the following:</p>
<ul>
<li>Set up a master AWS account</li>
<li>Created an organization</li>
<li>Created member accounts in your organization, or manually added member accounts (by invitation) to your organization</li>
</ul>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">How to do it...</h1>
            </header>

            <article>
                
<p>We'll now cover the one-line commands you'll need to perform the common tasks required to manage your OU. These commands can only be performed in your master account.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Getting the root ID for your organization</h1>
            </header>

            <article>
                
<p>You can run this command to get the ID of the root for your organization. The root is created automatically for you when you create your organization in your master account. The ID returned to you will look something like this: <kbd>r-bmdw</kbd>.</p>
<pre>
<strong>aws organizations list-roots</strong>
</pre>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Creating an OU</h1>
            </header>

            <article>
                
<p>To create an OU, perform the following steps:</p>
<ol>
<li>Determine where you'd like this OU to live. If it lives directly underneath the root, then your root ID will be the parent. Alternatively, if this OU is going to be a child of another OU, use the ID of the OU instead. Obviously, if this is the first OU you're creating, the root will be the parent.</li>
</ol>
<ol start="2">
<li>Use the CLI to create your OU like so:</li>
</ol>
<pre>
<strong>        </strong><strong>aws organizations create-organizational-unit \</strong><br/><strong>          --parent-id &lt;root-id or parent-ou-id&gt; \<br/></strong><strong>          --name &lt;desired-ou-name&gt;</strong>
</pre>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Getting the ID of an OU</h1>
            </header>

            <article>
                
<p>If you need to fetch the ID of an OU, you can use the CLI to do so; note that you'll need to know the parent of the OU. Here is how you'd get a list of all the OUs and their IDs in a root or OU:</p>
<pre>
<strong>aws organizations list-organizational-units-for-parent \</strong><br/>  <strong>--parent-id &lt;root-id or parent-ou-id&gt;</strong>
</pre>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Adding an account to an OU</h1>
            </header>

            <article>
                
<p>To add an account to an OU, perform the following steps:</p>
<ol>
<li>When an account is initially added to your organization, it will be a child of the organization root. To add it to the OU you just created, you need to move it using the following CLI command:</li>
</ol>
<pre>
<strong>        </strong><strong>aws organizations move-account \<br/></strong><strong>          --account-id &lt;twelve-digit-account-id&gt; \</strong><br/><strong>          --source-parent-id &lt;root-id&gt; \</strong><br/><strong>          --destination-parent-id &lt;new-parent-ou-id&gt;</strong>
</pre>
<ol start="2">
<li>If you wish to move an account from one OU to another, simply use the same command but use the existing parent OU ID instead of the root ID.</li>
</ol>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Removing an account from an OU</h1>
            </header>

            <article>
                
<p>To remove an account from an OU, perform the following steps:</p>
<ol>
<li>If you wish to remove an account from an OU, you have two options. You can move it to another OU, or you can move it back to the root. If you decide you want to delete an OU, you'll need to make sure no accounts exist inside it first (we'll show you how to do this next).</li>
</ol>
<ol start="2">
<li>Run the following command to move an account back to the root:</li>
</ol>
<pre>
<strong>        aws organizations move-account \</strong><br/><strong>          --account-id &lt;twelve-digit-account-id&gt; \</strong><br/><strong>          --source-parent-id &lt;existing-parent-ou-id&gt; \</strong><br/><strong>          --destination-parent-id &lt;root-id&gt;</strong>
</pre>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Deleting an OU</h1>
            </header>

            <article>
                
<p>To delete an OU, you'll first need to make sure it's empty by removing its child accounts (as mentioned previously). You can then go ahead and delete the OU like so:</p>
<pre>
<strong>aws organizations delete-organizational-unit \</strong><br/>  <strong>--organizational-unit-id &lt;ou-id&gt;</strong>
</pre>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">How it works...</h1>
            </header>

            <article>
                
<p>If done right, grouping your accounts together using OUs will help you simplify the way you manage and administer them. Try to use only <em>just enough</em> OUs to get the job done. The idea is to use OUs to make your life easier, not harder.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">There's more...</h1>
            </header>

            <article>
                
<ul>
<li>The <strong>organizational control policies</strong> (<strong>OCPs</strong>) can be attached to your root, OU, or AWS accounts. At this time, only one kind of OCP is supported: SCP.</li>
<li>Accounts can only belong to one OU or root.</li>
<li>Similarly, OUs can only belong to one OU or root.</li>
<li>It's best to avoid deploying resources in the master account because this account can't be controlled with SCPs. The master account should be treated as a management account for audit, control, and billing purposes only.</li>
</ul>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">See also</h1>
            </header>

            <article>
                
<ul>
<li>The <em>Adding a service control policy</em> recipe</li>
</ul>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Adding a service control policy</h1>
            </header>

            <article>
                
<p>Before we begin, we should talk through what SCPs are and how they apply to your organization.</p>
<p>An SCP consists of a policy document which defines (by way of filtering) the services and actions which are able to be used and performed within an OU or in an AWS account. If you've previously configured an IAM policy, then you will have more than enough background knowledge to get started with SCPs. Apart from a couple of minor exceptions, they look exactly the same.</p>
<p>SCPs can be applied at different levels throughout an organization. These are the levels, starting from the bottom and going up:</p>
<ul>
<li><strong>AWS account level</strong>: An SCP applied to an AWS account takes effect on only that account. It's important to note that the SCP is very separate from the IAM policies which live inside the account. For example, an SCP might allow full access to S3 for an AWS account but the IAM policies inside the account may deny it (for certain roles and/or users).</li>
<li><strong>OU level</strong>: An SCP applied at the OU level will apply to all the AWS accounts which live inside the OU as well as any child OUs (remember that an OU can by a member of an OU).</li>
<li><strong>Root level</strong>: If an SCP is applied at this level, it will apply to all AWS accounts inside the organization.</li>
</ul>
<p>Things can start to get really interesting when you have an SCP applied at multiple levels. The <em>intersection</em> of the polices at the root, OU, account, and IAM levels is evaluated and will determine whether or not an API call is allowed to be made. For example, someone belonging to an IAM role which has full administrator access to an account still won't be able to call any EC2 APIs if any of the SCPs above it (account, OU, root) deny EC2 access.</p>
<p>In the following example, we have a top-level OU, Austero Bluth, with an SCP which allows access to all AWS resources for all OUs and accounts underneath it:</p>
<div class="packt_figure"><img class=" image-border" src="assets/image_02_020.png"/></div>
<div class="packt_figure CDPAlignCenter CDPAlign packt_figref">Organization hierarchy and policies</div>
<p>Austero Bluth has two child OUs; let's focus on Sudden Valley. It has an SCP which allows only EC2 and S3. By using a whitelisting approach, anything except these two services will be denied. Remembering that SCPs act like a filter, any OU or AWS accounts living underneath the Sudden Valley OU will, at most, have access to EC2 and S3.</p>
<p>The <strong>Sitwell Enterprises Account</strong> also has an SCP attached to it. This particular SCP allows S3 and SQS. Note that the SQS statement will have no effect here because the Sitwell account is inside an OU which does not allow SQS. Also note that this account has no access to EC2 despite the <strong>Sudden Valley OU</strong> allowing it; this is because EC2 wasn't explicitly allowed in the SCP attached to the account.</p>
<p>At the IAM level, we have a role in the Sitwell AWS account which allows full administrator privileges. But, because the intersection of the SCPs governing this account will only allow S3, anyone using this role will be denied access if they attempt to use EC2 or SQS, for example.</p>
<p>Let's also take a look at the <strong>Bluth Company Account</strong>. The SCP which is attached to it allows full AWS access; however, it lives inside an OU (Balboa Bay) which only allows EC2, RDS, and S3. There is an IAM role inside this account which also allows full admin access but, again, administrators in this account will be limited to EC2, RDS, and S3.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Getting ready</h1>
            </header>

            <article>
                
<p>We're going to step through creating an SCP and adding it to an OU.</p>
<p>You're going to need the ID of the OU in question; you can fetch it from the organizations web console or use the CLI. It will look something like this: <kbd>ou-bmdw-omzypry7</kbd>.</p>
<p>We'll be preparing a policy document as well. In this example, we're going to add an SCP to the Sudden Valley OU to allow access to EC2 and S3. Here's what our SCP looks like:</p>
<pre>
{ <br/>    "Version":"2012-10-17", <br/>    "Statement":[ <br/>        { <br/>            "Effect":"Allow", <br/>            "Action":["EC2:*","S3:*"], <br/>            "Resource":"*" <br/>        } <br/>    ] <br/>}
</pre>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">How to do it...</h1>
            </header>

            <article>
                
<ol>
<li>Open a new file in your text editor, add your JSON policy document, and save it.</li>
<li>Run the <kbd>create-policy</kbd> CLI command like so. We're getting a little tricky with the <kbd>tr</kbd> command here: we're using it to remove the carriage returns from the policy document, so pay close attention to the syntax in the example provided. Unfortunately, the organizations CLI doesn't allow us to provide the path to the policy document directly:</li>
</ol>
<pre>
<strong>        aws organizations create-policy \</strong><br/><strong>          --content "$(tr -d '\n' &lt; my-policy-file.json)" \ </strong><br/><strong>          --description "A policy description goes here" \</strong><br/><strong>          --name "My policy" \</strong><br/><strong>          --type SERVICE_CONTROL_POLICY</strong>
</pre>
<ol start="3">
<li>If the preceding CLI command works successfully, some JSON will be returned to you containing the ID of the policy we just added. It will look something like this: <kbd>p-o9to04s7</kbd>.</li>
<li>You can now go ahead and attach this policy to the OU. Use the following CLI command to do this:</li>
</ol>
<pre>
<strong>        aws organizations attach-policy \</strong><br/><strong>          --target-id &lt;ou-or-aws-account-id&gt; \</strong><br/><strong>          --policy-id &lt;policy-id&gt;</strong>
</pre>
<ol start="5">
<li>Unfortunately, the preceding command does not output anything if it ran successfully. You can double-check your handiwork in the AWS web console or use the following CLI command to verify that it worked:</li>
</ol>
<pre>
<strong>        aws organizations list-targets-for-policy \</strong><br/><strong>          --policy-id &lt;policy-id&gt;</strong>
</pre>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">How it works...</h1>
            </header>

            <article>
                
<p>Again, the policies you add will act as a filter at each level of your organizational structure. With this in mind, it might be a good time to point out that testing your policies on a single account before applying them organization-wide will save you a lot of heartache. Making sweeping changes to an SCP living at the top of your organization may create an unforeseen situation at the AWS account level at the bottom of the chain. A local admin in an AWS account is not able to override SCPs.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">There's more...</h1>
            </header>

            <article>
                
<ul>
<li>At the time of publishing, you are only able to have a single root inside an organization (it's created automatically for you when you create an organization).</li>
<li>For obvious reasons, the master account is not affected by any SCPs which are attached to it. You may also notice that it's technically possible to place the master account in an OU; again, it will be unaffected by any SCPs which have been attached to that OU.</li>
<li>Since the master account is unaffected by SCPs, it's a good idea to leave it as empty as possible and to not create any resources in it. Use child AWS accounts instead so you can apply fine-grained controls to them.</li>
<li>SCPs are required on each OU and account but shouldn't be considered the only form of access control for your AWS accounts. Apply IAM where appropriate.</li>
</ul>
<ul>
<li>When creating our policy, we have to specify a <kbd>--type</kbd> parameter. At the time of publishing, AWS only supports one variant of OCP: <kbd>SERVICE_CONTROL_POLICY</kbd>.</li>
<li>As much as possible, follow the principle of least privilege. You want to give your AWS accounts access to only the services they need. This helps you mitigate damage caused by misclicks, programming errors, or compromised accounts.</li>
<li>In the long run, you may find it advantageous to not assign controls at the root level. Instead, you may be better off adding <em>all</em> accounts to an OU and applying your controls to the OU instead.</li>
<li>Your policies can take a whitelisting or blacklisting approach. In this recipe, we've used a whitelist approach, but you may instead prefer to allow your OUs and accounts to use all services except the ones you explicitly disallow. You should choose one of these approaches and stick with it, as mixing the two will cause you lots of confusion down the road.</li>
<li>Unlike IAM policies, you can't specify conditions in SCP documents and <kbd>Resource</kbd> <em>must</em> be <kbd>*</kbd>.</li>
</ul>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">See also</h1>
            </header>

            <article>
                
<ul>
<li>The <em>Federating with your AWS account</em> recipe in <a href="c19319d5-2db2-4b99-ad4c-1676db3bae2f.xhtml"><span class="ChapterrefPACKT">Chapter 8</span></a>, <em>Security and Identity</em> for some discussion around IAM roles</li>
</ul>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    </body></html>