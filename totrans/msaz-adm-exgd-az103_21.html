<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Implementing Multi-Factor Authentication</h1>
                </header>
            
            <article>
                
<p>In the previous chapter, we covered the second part of the <em>Managing Identities</em> objective. <span><span>You've learned how to install Azure AD Connect and how to manage it.</span></span></p>
<p><span>This chapter covers the last part of this</span><em><span> </span></em><span>objective and is the last chapter of this book. </span><span>In this</span> <span>chapter,</span><span> we</span> <span>are going to focus on <strong>Multi-Factor Authentication (MFA)</strong> in Azure, so you can add a second layer of security to sign-up and sign-in experiences for your Azure resources. We are going to look at the different verification methods and how you can configure this. We are also going to configure fraud alerts, so users can report fraudulent attempts to access their resources. And to finish this chapter, we are going to configure trusted IPs to bypass MFA.</span></p>
<p><span>The following topics will be covered in this chapter:</span></p>
<ul>
<li>Azure MFA</li>
<li>Configuring user accounts for MFA</li>
<li>Configuring verification methods</li>
<li>Configuring fraud alerts</li>
<li>Configuring bypass options</li>
<li>Configuring trusted IPs</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Azure MFA</h1>
                </header>
            
            <article>
                
<p><span>MFA is a security feature that requires more than one method of authentication. You can use it to add an additional layer of security to the sign in of users. It enables two-step verification, where the user first signs in using something they know (such as a password), and then signs in with something they have (such as a smart phone), or some human characteristic (such as biometrics).</span></p>
<p class="mce-root"><span>Azure MFA maintains the simplicity for the users, but also helps to keep data and applications safe by providing additional security by requiring a second form of authentication. It offers a variety of configuration methods made by an administrator that determines whether users are challenged for MFA or not. </span></p>
<p><span>Azure MFA is part of the following offerings:</span></p>
<ul>
<li><strong>Azure Active Directory Premium license</strong>: With this license, you can use <span>Azure MFA Service (cloud) and Azure MFA Server (on-premises). The latter is most suitable in scenarios where an organization has <strong>Active Directory Federation Services</strong> (<strong>ADFS</strong>) installed and needs to manage infrastructure components.</span></li>
<li><strong>Azure Active Directory Global Administrators</strong>:<strong> </strong>A subset of the MFA features is available for administrator accounts in Azure.</li>
<li><strong>MFA for Office 365</strong>:<strong> </strong><span>A subset of the MFA features is </span><span>available for Office 365 users.</span></li>
</ul>
<p><span>With Azure MFA, you can use the following verification methods:</span></p>
<table style="border-collapse: collapse;width: 100%" border="1">
<tbody>
<tr>
<td>
<p><strong>Verification method</strong></p>
</td>
<td>
<p><strong>Description</strong></p>
</td>
</tr>
<tr>
<td>
<p>Voice call</p>
</td>
<td>
<p>A call is made to the registered phone of the user. The user needs to enter a PIN for verification.</p>
</td>
</tr>
<tr>
<td>
<p>Text message</p>
</td>
<td>
<p>A text message is sent to the user's mobile phone containing a six digit code. The user needs to fill in this code on the sign-in page.</p>
</td>
</tr>
<tr>
<td>
<p>Mobile app notification</p>
</td>
<td>
<p>A request for verification is sent to the user's smart phone. When necessary, the user will enter a PIN and then select <strong>Verify</strong>.</p>
</td>
</tr>
<tr>
<td>
<p>Mobile app verification code</p>
</td>
<td>
<p class="mce-root">The mobile app on the user's smart phone will display a verification code, which will refresh every 30 seconds. The user will select the most recent code and will enter it in the sign-in page.</p>
</td>
</tr>
<tr>
<td>
<p>Third-party tokens</p>
</td>
<td>
<p class="mce-root">Azure MFA Server can be configured to accept third-party security tokens.</p>
</td>
</tr>
</tbody>
</table>
<p>In the upcoming sections, we will enable MFA for the Azure AD tenant, configure user accounts, configure fraud alerts, and configure bypass options.</p>
<div class="packt_infobox">For the demos in this chapter, I will use an Azure Active Directory Premium P2 license.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Enabling MFA for an Azure AD tenant</h1>
                </header>
            
            <article>
                
<p>The following are the three different options for enabling MFA for your users, data, and applications:</p>
<ul>
<li><strong>Using a conditional access policy</strong>:<strong> </strong>You can use conditional access policies to enable<span> MFA. This can be enabled at the user or application level. You can also enable MFA for security groups or for all external users using a conditional access policy. This is available for premium Azure AD licenses.</span></li>
<li><strong>At</strong><strong> the user level</strong>:<span> </span><span>This option is covered in more detail in the next section of this chapter. This is the traditional method for enabling </span><span>MFA. With this method, the user needs to perform MFA every time they sign in. This will override conditional access policies when these are set.</span></li>
<li><strong>Using Azure AD Identity Protection</strong>:<strong> </strong>With this option, you will create an <span>Azure AD Identity Protection risk policy based on sign-in risk for all of your cloud applications. This will also override conditional access policies, if created. This option requires an Azure Active Directory P2 license.</span></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring user accounts for MFA</h1>
                </header>
            
            <article>
                
<p>Azure MFA is enabled in Azure AD at the user level. To enable MFA for a user account in Azure AD, take the following steps:</p>
<ol>
<li>Navigate to the Azure portal by opening <a href="https://portal.azure.com/">https://portal.azure.com/</a>.<a href="https://portal.azure.com/"/></li>
<li>Go to <span class="packt_screen">All services</span>, then type<span> </span><kbd>Azure Active Directory</kbd><span> </span>and open the Azure AD resource.</li>
</ol>
<ol start="3">
<li>In the Azure AD blade, under <span class="packt_screen">Manage</span><span>, select </span><span class="packt_screen">Users</span> as follows:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/aca40d2e-dd26-4c76-a88a-d54ec5ba295a.png" style="width:43.42em;height:26.75em;"/></div>
<div class="mce-root packt_figref CDPAlignCenter CDPAlign"><span>Azure AD user settings</span></div>
<ol start="4">
<li>In the<span> </span><span class="packt_screen">All users</span><span> </span>blade, select <span class="packt_screen">Multi-Factor Authentication</span><span> </span>in the top menu as follows:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/7d9b219f-c31d-448e-a8ba-72e82496e187.png" style="width:46.58em;height:16.17em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Selecting Multi-Factor Authentication</div>
<ol start="5">
<li class="CDPAlignLeft CDPAlign">You then will be redirected to the <span class="packt_screen">multi-factor authentication</span> portal. In there, select a user and click <span class="packt_screen">Enable</span><span> </span>at the right side of the screen as follows:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/07218d30-4cd5-4126-803c-af1a89eca6ef.png"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Enabling MFA for a user</div>
<ol start="6">
<li>After clicking the link, you will receive the following warning:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/64944165-4fea-4794-b0ac-7214941fc38b.png" style="width:35.08em;height:13.58em;"/></p>
<div class="CDPAlignCenter CDPAlign packt_figref">Warning window</div>
<ol start="7">
<li>Click <span class="packt_screen">enable multi-factor auth</span><span> </span>to activate MFA for this user.</li>
</ol>
<p>Now that we have enabled MFA for the user, we can look at how to configure the verification methods.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring the verification methods</h1>
                </header>
            
            <article>
                
<p>Verification methods are also configured in the Azure MFA portal, just as you enabled MFA for the user account in the previous step. Take the following steps:</p>
<ol>
<li>With the MFA portal still open, select <span class="packt_screen">service settings</span><span> </span>in the top menu as follows:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/746619c7-71f3-46db-87c3-fc80412bae6a.png"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign"><span>MFA portal service settings</span></div>
<ol start="2">
<li>Under<span> </span><span class="packt_screen">v</span><span class="packt_screen">erification options</span>, you can select the methods that you want to enable for your users. By default, all verification options are enabled, as follows:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/de2f7f15-a19b-4218-ab02-38ce15905015.png" style="width:22.83em;height:10.00em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign"><span>MFA verification options</span></div>
<ol start="3">
<li>If you want to disable options, uncheck the checkbox and click the <span class="packt_screen">Save</span><span> </span>button.</li>
</ol>
<p>We have seen how to configure the verification methods that users are allowed to use for using MFA in Azure. In the next section, we are going to look at how to configure trusted IPs.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring trusted IPs</h1>
                </header>
            
            <article>
                
<p><span>Trusted IPs are used by administrators of an Azure AD tenant. This option will bypass the MFA for users that sign in from a trusted IP, such as the company intranet.</span></p>
<p>Trusted IPs can be configured from the <span class="packt_screen">service settings</span><strong> </strong>page from the MFA portal. Take the following steps:</p>
<ol>
<li>With the<span> </span><span class="packt_screen">server settings</span><span> </span>page still open from the previous demonstration, under <span class="packt_screen">trusted ips</span>, check the checkbox that says<span> </span><span class="packt_screen">Skip multi-factor authentication for requests from federated users on my intranet</span>. <span>Then, add an IP address or a range of IP addresses in the</span><span> list as follows</span><span>:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/639a2dc4-f937-4318-8cb6-d9878f327d2b.png" style="width:30.83em;height:15.42em;"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref"><span>Trusted IP settings</span><strong><span><br/></span></strong></div>
<ol start="2">
<li>Click the <span class="packt_screen">Save</span> button to save your settings.</li>
</ol>
<p>In the next section, we are going to cover how to configure fraud alerts in the Azure portal.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring fraud alerts</h1>
                </header>
            
            <article>
                
<p>With the fraud alert feature, users can report<span> fraudulent attempts to access their resources using their phone or the mobile app. This is an MFA Server (on-premises) feature.</span></p>
<p>Fraud alerts are configured from the Azure portal, in the Azure Active Directory settings. Take the following steps:</p>
<ol>
<li><span>Navigate to the Azure portal by opening </span><a href="https://portal.azure.com">https://portal.azure.com</a>.</li>
<li>Select<span> </span><span class="packt_screen">All services</span>,<strong> </strong>then type<span> </span><kbd>Azure Active Directory</kbd><span> </span>in the search bar and open the settings.</li>
</ol>
<ol start="3">
<li class="mce-root">Under<span> </span><span class="packt_screen">Security</span>, <span>select </span><span class="packt_screen">MFA</span> as follows:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/72ad9500-1783-4a28-9e7b-f95b0d8597f6.png"/></p>
<div style="color: black" class="packt_figref CDPAlignCenter CDPAlign">MFA in Azure AD<strong><br/></strong></div>
<ol start="4">
<li>The <span class="packt_screen">Getting started</span> blade is automatically opened. Under <span class="packt_screen">Settings</span>, select the<span> </span><span class="packt_screen">Fraud alert</span>.</li>
</ol>
<ol start="5">
<li>The<span> </span><span class="packt_screen">Fraud alert</span><span> </span>settings page is opened. In here, you can enable users to submit fraud alerts as follows:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/02b38c8f-8310-456c-a4c9-9d6d240ce60b.png"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Enable submitting fraud alerts</div>
<ol start="6">
<li>Click the <span class="packt_screen">Save</span><span> </span>button to save the settings.</li>
</ol>
<p>We've now seen how we can allow users to submit fraud alerts. In the next section, we are covering how to configure bypass options.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring bypass options</h1>
                </header>
            
            <article>
                
<p>With the one-time bypass feature, users can authenticate once and bypass the MFA. This setting is <span>temporary, and after a specified number of seconds, it will expire automatically. This can be a solution in cases when a phone or mobile app doesn't receive a phone call or a notification.</span></p>
<p>This setting is also configured from the <span class="packt_screen">Azure Active Directory</span> settings in the Azure portal as follows:</p>
<ol>
<li><span>Navigate to the Azure portal by opening </span><a href="https://portal.azure.com">https://portal.azure.com</a>.</li>
<li>Select<span> </span><span class="packt_screen">All services</span>,<strong> </strong>then type<span> </span><kbd>Azure Active Directory</kbd><span> </span>in the search bar and open the settings.</li>
<li class="mce-root"><span>Under</span><span> </span><span class="packt_screen">Manage MFA Server</span><span>, select</span><span> </span><span class="packt_screen">One-time bypass</span> as follows:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/5849987c-ef9d-49e4-8abe-d29d2b6929a3.png" style="width:39.25em;height:33.67em;"/></div>
<div style="color: black" class="packt_figref CDPAlignCenter CDPAlign">One-time bypass<strong><br/></strong></div>
<ol start="4">
<li>In the settings page, enter the username, including the full domain name, such as <kbd>username@domain.com</kbd><span>. Specify the number of seconds that the bypass should last and the reason for the bypass.</span></li>
<li>Click the <span class="packt_screen">Add</span><span> </span>button. The time limit will go in <span>immediately.</span></li>
</ol>
<p>We've now covered how <span>to authenticate once and bypass the MFA using the one-time bypass feature.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p><span>In this chapter, we covered the last part the <em>Managing Identities</em><em> </em>objective by looking at how to configure user accounts for MFA<strong> </strong>in Azure. We covered different authentication methods and enabled it for our users. Lastly, we looked at the various ways to bypass MFA, such as trusted IP addresses.</span></p>
<p>With the knowledge gained throughout the chapters, you should be able to pass the AZ-103 exam. Don't forget to look at the <em>Further reading</em> sections at the end of each chapter, because there is a lot of extra information there that could be covered in the exam as well.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Questions</h1>
                </header>
            
            <article>
                
<p><span>Answer the following questions to test your knowledge of the information in this chapter. You can find the answers in the <em>Assessments</em> section at the end of this book:</span></p>
<ol>
<li><span>Can you add trusted IP addresses for</span><span> bypassing MFA for certain IPs</span>?
<ul>
<li>Yes</li>
<li>No</li>
</ul>
</li>
<li><span>MFA cannot be enabled using conditional access policies.</span>
<ul>
<li>Yes</li>
<li>No</li>
</ul>
</li>
<li>Are fraud alerts part of the MFA Server (on-premises) offering?<br/>
<ul>
<li>Yes</li>
<li>No</li>
</ul>
</li>
</ol>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Further reading</h1>
                </header>
            
            <article>
                
<p><span>You can check the following links for more information about the topics that are covered in this chapter:</span></p>
<ul>
<li><em>How it works: Azure Multi-Factor Authentication</em><strong><em>:</em> </strong><a href="https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-mfa-howitworks">https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-mfa-howitworks</a></li>
<li><em>Planning a cloud-based Azure Multi-Factor Authentication deployment:</em> <a href="https://docs.microsoft.com/en-us/azure/active-directory/authentication/howto-mfa-getstarted">https://docs.microsoft.com/en-us/azure/active-directory/authentication/howto-mfa-getstarted</a></li>
<li><em>Configure Azure Multi-Factor Authentication settings</em>: <a href="https://docs.microsoft.com/en-us/azure/active-directory/authentication/howto-mfa-mfasettings">https://docs.microsoft.com/en-us/azure/active-directory/authentication/howto-mfa-mfasettings</a></li>
<li><em>What is conditional access in Azure Active Directory?</em>: <a href="https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/overview">https://docs.microsoft.com/en-us/azu</a><a href="https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/overview">re/active-directory/conditional-access/overview</a></li>
<li><em>Quickstart: Require MFA for specific apps with Azure Active Directory conditional access</em>: <a href="https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/app-based-mfa">https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/app-based-mfa</a></li>
</ul>


            </article>

            
        </section>
    </body></html>