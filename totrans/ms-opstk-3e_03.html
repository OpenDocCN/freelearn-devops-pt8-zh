<html><head></head><body>
  <div id="_idContainer052">
   <h1 class="chapter-number" id="_idParaDest-64">
    <a id="_idTextAnchor108">
    </a>
    <span class="koboSpan" id="kobo.1.1">
     3
    </span>
   </h1>
   <h1 id="_idParaDest-65">
    <a id="_idTextAnchor109">
    </a>
    <span class="koboSpan" id="kobo.2.1">
     OpenStack Control Plane – Shared Services
    </span>
   </h1>
   <p class="author-quote">
    <span class="koboSpan" id="kobo.3.1">
     “The value of an idea lies in the using of it.”
    </span>
   </p>
   <p class="author-quote">
    <span class="koboSpan" id="kobo.4.1">
     – Thomas A.
    </span>
    <span class="koboSpan" id="kobo.4.2">
     Edison
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.5.1">
     Addressing the challenge of business continuity within the OpenStack private cloud comes down to the traits and capabilities of its control plane.
    </span>
    <span class="koboSpan" id="kobo.5.2">
     As highlighted in the first chapter, a variety of core services, including compute, imaging, storage, networking, and identity, should be designed for deployment with scalability and security in mind at an early stage.
    </span>
    <span class="koboSpan" id="kobo.5.3">
     The other facet of such a requirement is to treat other non-native OpenStack services the same way as core ones by designing for failure and scalability.
    </span>
    <span class="koboSpan" id="kobo.5.4">
     Such services include messaging queues and databases.
    </span>
    <span class="koboSpan" id="kobo.5.5">
     As we consider best practices for deploying to production, it is essential to iterate through each service that would be part of the OpenStack control plane.
    </span>
    <span class="koboSpan" id="kobo.5.6">
     Another challenge that arises during the deployment is the way OpenStack services are built and deployed.
    </span>
    <span class="koboSpan" id="kobo.5.7">
     As we saw in
    </span>
    <a href="B21716_02.xhtml#_idTextAnchor089">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.6.1">
        Chapter 2
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.7.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.8.1">
      Kicking Off the OpenStack Setup – The Right Way (DevSecOps)
     </span>
    </em>
    <span class="koboSpan" id="kobo.9.1">
     , containers to run our OpenStack services, breaking the control plane services into smaller chunks of units, will increase the reliability and scalability of each running service.
    </span>
    <span class="koboSpan" id="kobo.9.2">
     In this chapter, we will extend our designed layout to a production-ready environment by going through the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.10.1">
      following topics:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.11.1">
      Defining the perimeter of the OpenStack
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.12.1">
       control plane
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.13.1">
      Identifying different OpenStack services taking up part of the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.14.1">
       control plane
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.15.1">
      Preparing a first
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.16.1">
       production deployment
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.17.1">
      Deploying the next OpenStack environment
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.18.1">
       using kolla-ansible
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.19.1">
      Uncovering additional custom options for the OpenStack control
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.20.1">
       plane deployment
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-66">
    <a id="_idTextAnchor110">
    </a>
    <span class="koboSpan" id="kobo.21.1">
     The OpenStack control plane
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.22.1">
     When we started designing our first iteration layout, we encountered a variety of OpenStack
    </span>
    <a id="_idIndexMarker245">
    </a>
    <span class="koboSpan" id="kobo.23.1">
     services, each composed of several components.
    </span>
    <span class="koboSpan" id="kobo.23.2">
     One or several components can be designed to run in separate physical machines assigned with roles for logical operations and management reasons.
    </span>
    <span class="koboSpan" id="kobo.23.3">
     As highlighted in
    </span>
    <a href="B21716_01.xhtml#_idTextAnchor014">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.24.1">
        Chapter 1
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.25.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.26.1">
      Revisiting OpenStack – Design Considerations
     </span>
    </em>
    <span class="koboSpan" id="kobo.27.1">
     , separating the roles logically will support the orchestration of the OpenStack deployment and operation.
    </span>
    <span class="koboSpan" id="kobo.27.2">
     The term
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.28.1">
      control plane
     </span>
    </em>
    <span class="koboSpan" id="kobo.29.1">
     is widely used in the network glossary.
    </span>
    <span class="koboSpan" id="kobo.29.2">
     It dictates how to process and run requests.
    </span>
    <span class="koboSpan" id="kobo.29.3">
     As an abstract concept, the control plane can be formed of one or many system components that centrally manage and describe the way a request can be fulfilled.
    </span>
    <span class="koboSpan" id="kobo.29.4">
     When referring to the OpenStack logical layout, a cloud controller is designated to run most of the pieces of the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.30.1">
      control plane.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-67">
    <a id="_idTextAnchor111">
    </a>
    <span class="koboSpan" id="kobo.31.1">
     Running the control plane – cloud controller
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.32.1">
     The OpenStack APIs, scheduler services (including compute, storage, and file share schedulers), API
    </span>
    <a id="_idIndexMarker246">
    </a>
    <span class="koboSpan" id="kobo.33.1">
     endpoints, databases, and messaging queues are counted as part of the OpenStack control plane.
    </span>
    <span class="koboSpan" id="kobo.33.2">
     This section iterates through each service that is part of the cloud controller setup and summarizes them into two main categories, OpenStack and infrastructure services,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.34.1">
      as follows:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer045">
     <span class="koboSpan" id="kobo.35.1">
      <img alt="Figure 3.1 – An overview of the OpenStack control plane" src="image/B21716_03_01.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.36.1">
     Figure 3.1 – An overview of the OpenStack control plane
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.37.1">
     We will walk
    </span>
    <a id="_idIndexMarker247">
    </a>
    <span class="koboSpan" id="kobo.38.1">
     through the control plane in the following subsections and examine each service, its subcomponents, and the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.39.1">
      latest updates.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.40.1">
     Identity service
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.41.1">
     The identity service, as explored in
    </span>
    <a href="B21716_01.xhtml#_idTextAnchor014">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.42.1">
        Chapter 1
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.43.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.44.1">
      Revisiting OpenStack – Design Considerations
     </span>
    </em>
    <span class="koboSpan" id="kobo.45.1">
     , presents a vital component to authorize and authenticate service communication
    </span>
    <a id="_idIndexMarker248">
    </a>
    <span class="koboSpan" id="kobo.46.1">
     to accomplish a specific request, such as storage creation or instance provisioning.
    </span>
    <span class="koboSpan" id="kobo.46.2">
     As part of the control plane, Keystone
    </span>
    <a id="_idIndexMarker249">
    </a>
    <span class="koboSpan" id="kobo.47.1">
     consolidates a catalog of all existing OpenStack services to be reached through
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.48.1">
      its API.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.49.1">
     It is important to provide a glossary of key terms of Keystone when running the control plane services.
    </span>
    <span class="koboSpan" id="kobo.49.2">
     This is to ensure compliance and governance policies when dealing with different sets of domains, projects, and users
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.50.1">
      as follows:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.51.1">
       Project
      </span>
     </strong>
     <span class="koboSpan" id="kobo.52.1">
      : The concept of a
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.53.1">
       project
      </span>
     </em>
     <span class="koboSpan" id="kobo.54.1">
      has replaced that of a
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.55.1">
       tenant
      </span>
     </em>
     <span class="koboSpan" id="kobo.56.1">
      within version 3 of the Identity API.
     </span>
     <span class="koboSpan" id="kobo.56.2">
      The concept did not change, as a project is a logical construction of a set of resources isolating users
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.57.1">
       and groups.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.58.1">
       Domain
      </span>
     </strong>
     <span class="koboSpan" id="kobo.59.1">
      : Going up a layer, a domain contains a set of users, groups, and projects.
     </span>
     <span class="koboSpan" id="kobo.59.2">
      This abstract isolation could be very helpful for large enterprises with different sets of departments, for example.
     </span>
     <span class="koboSpan" id="kobo.59.3">
      Each department can be allocated a domain made up of different projects
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.60.1">
       and users.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.61.1">
       Role
      </span>
     </strong>
     <span class="koboSpan" id="kobo.62.1">
      : One of the key mechanisms of the Keystone service since its early days is the concept of the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.63.1">
       role
      </span>
     </em>
     <span class="koboSpan" id="kobo.64.1">
      .
     </span>
     <span class="koboSpan" id="kobo.64.2">
      A user or group of users can be assigned to different projects with different authorization layouts without the need to create multiple users with different assignments and switch manually to a different environment to access specific resources through
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.65.1">
       different projects.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.66.1">
       Catalog
      </span>
     </strong>
     <span class="koboSpan" id="kobo.67.1">
      : Keystone grants access to different services through its discovery service.
     </span>
     <span class="koboSpan" id="kobo.67.2">
      Those services, from a Keystone perspective, are exposed as OpenStack service endpoints and registered in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.68.1">
       service catalog.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.69.1">
       Token
      </span>
     </strong>
     <span class="koboSpan" id="kobo.70.1">
      : Accessing a specific service must be done through obtaining a token.
     </span>
     <span class="koboSpan" id="kobo.70.2">
      It can be considered as an information card that validates the user, as well as the expiration date and time.
     </span>
     <span class="koboSpan" id="kobo.70.3">
      It also checks which project(s) the token has been associated with, and to which endpoints.
     </span>
     <span class="koboSpan" id="kobo.70.4">
      The token concept itself has passed through different versions and ways of working.
     </span>
     <span class="koboSpan" id="kobo.70.5">
      When expanding a production OpenStack environment, it is necessary to have a basic understanding of the scoping mechanism for the Keystone token.
     </span>
     <span class="koboSpan" id="kobo.70.6">
      As a large number of users will be competing
     </span>
     <a id="_idIndexMarker250">
     </a>
     <span class="koboSpan" id="kobo.71.1">
      to access services and resources, scoping
     </span>
     <a id="_idIndexMarker251">
     </a>
     <span class="koboSpan" id="kobo.72.1">
      will help to better organize the access boundaries in a Keystone request, which can be categorized into
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.73.1">
       two groups:
      </span>
     </span>
     <ul>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.74.1">
         Scoped token
        </span>
       </strong>
       <span class="koboSpan" id="kobo.75.1">
        : Once a
       </span>
       <a id="_idIndexMarker252">
       </a>
       <span class="koboSpan" id="kobo.76.1">
        token request is created, the Identity API will specify which OpenStack services (endpoints) will be used by the requester and its associated roles.
       </span>
       <span class="koboSpan" id="kobo.76.2">
        It mainly contains information such as the reference to the project and
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.77.1">
         domain ID.
        </span>
       </span>
      </li>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.78.1">
         Unscoped token
        </span>
       </strong>
       <span class="koboSpan" id="kobo.79.1">
        : Unlike the scoped token, the created token request will not contain
       </span>
       <a id="_idIndexMarker253">
       </a>
       <span class="koboSpan" id="kobo.80.1">
        any specific authorization scope to access services.
       </span>
       <span class="koboSpan" id="kobo.80.2">
        When users present credentials for the first time, the usage of unscoped tokens avoids an excessive loop of authentication flow.
       </span>
       <span class="koboSpan" id="kobo.80.3">
        At a later time, the unscoped token can be narrowed down to a scoped one to limit authorization to a specific
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.81.1">
         service component(s).
        </span>
       </span>
      </li>
     </ul>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.82.1">
       User
      </span>
     </strong>
     <span class="koboSpan" id="kobo.83.1">
      : This is an API requester to consume OpenStack services
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.84.1">
       and resources.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.85.1">
       Group
      </span>
     </strong>
     <span class="koboSpan" id="kobo.86.1">
      : This is a collection of users or API requesters belonging to the same domain, as
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.87.1">
       explained previously.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.88.1">
     The Keystone API has been improved by providing more options for authentication mechanisms aside from the traditional password way, such as SAML2 and OpenID Connect based on OAuth.
    </span>
    <span class="koboSpan" id="kobo.88.2">
     Identity federation support has been a big milestone for the Keystone
    </span>
    <a id="_idIndexMarker254">
    </a>
    <span class="koboSpan" id="kobo.89.1">
     implementation, enabling pluggable
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.90.1">
      Identity Providers
     </span>
    </strong>
    <span class="koboSpan" id="kobo.91.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.92.1">
      IdP
     </span>
    </strong>
    <span class="koboSpan" id="kobo.93.1">
     ) through different backends, including SQL, LDAP, and even a federated IdP.
    </span>
    <span class="koboSpan" id="kobo.93.2">
     Within the latest OpenStack releases, including Antelope and Bobcat, several backends have been supported, allowing enterprises to leverage their existing authentication/authorization systems for more
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.94.1">
      consolidated management.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.95.1">
     A brief summary of the current supported authentication backends is
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.96.1">
      as follows:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.97.1">
       LDAP
      </span>
     </strong>
     <span class="koboSpan" id="kobo.98.1">
      : Many organizations might have existing LDAP instances and require a set of security policies to be followed for different compliance reasons.
     </span>
     <span class="koboSpan" id="kobo.98.2">
      In this setup, Keystone will need to grant access to the LDAP servers to read and write and will not handle an IdP
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.99.1">
       role internally.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.100.1">
       SQL
      </span>
     </strong>
     <span class="koboSpan" id="kobo.101.1">
      : Most of the default OpenStack deployments come with SQL configuration to store user information in a SQL database and provide direct interaction with the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.102.1">
       Keystone service.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.103.1">
       Federated IdP
      </span>
     </strong>
     <span class="koboSpan" id="kobo.104.1">
      : This is one of the most common setups, allowing organizations to leverage a complete consolidated identity point where Keystone will establish a trust relationship and act as a service provider.
     </span>
     <span class="koboSpan" id="kobo.104.2">
      The OpenStack community has developed
     </span>
     <a id="_idIndexMarker255">
     </a>
     <span class="koboSpan" id="kobo.105.1">
      more stable releases around
     </span>
     <a id="_idIndexMarker256">
     </a>
     <span class="koboSpan" id="kobo.106.1">
      this layout, offering more ways of authentication against multiple backends, such as SQL, LDAP, and Active Directory, through SAML assertions.
     </span>
     <span class="koboSpan" id="kobo.106.2">
      Lately, there has been more work on OpenID Connect and OAuth in its second version.
     </span>
     <span class="koboSpan" id="kobo.106.3">
      This even allows authentication using public social login platforms such as Google
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.107.1">
       and Facebook.
      </span>
     </span>
    </li>
   </ul>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.108.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.109.1">
     The Keystone
    </span>
    <a id="_idIndexMarker257">
    </a>
    <span class="koboSpan" id="kobo.110.1">
     Identity API supports the full
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.111.1">
      Create, Read, Update, and Delete
     </span>
    </strong>
    <span class="koboSpan" id="kobo.112.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.113.1">
      CRUD
     </span>
    </strong>
    <span class="koboSpan" id="kobo.114.1">
     ) RESTful operations API.
    </span>
    <span class="koboSpan" id="kobo.114.2">
     Commands are fired using the OpenStack CLI and not the Keystone CLI as the latter is no longer supported within Antelope and later releases, and the latest OpenStack releases that have adopted Identity API
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.115.1">
      version 3.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.116.1">
     Depending on which authentication and authorization strategy you adopt, the mechanism of Keystone is the same when dealing with pure OpenStack ecosystem workflows.
    </span>
    <span class="koboSpan" id="kobo.116.2">
     The Identity API’s interaction with the rest of the services might be overwhelming to tackle when dealing with a large infrastructure layout.
    </span>
    <span class="koboSpan" id="kobo.116.3">
     At this point, once we have iterated through the latest state of the art in Keystone, a brief overview of how interactions work will be helpful before listing the next services.
    </span>
    <span class="koboSpan" id="kobo.116.4">
     We should remember that Keystone will turn out to be the security hub of AA in the OpenStack ecosystem where default configurations would not be ideal to avoid possible security gaps and further boost your compliance
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.117.1">
      and governance.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.118.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.119.1">
     Keystone configuration can be customized through the Keystone
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.120.1">
      kolla-ansible
     </span>
    </strong>
    <span class="koboSpan" id="kobo.121.1">
     playbook located at
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.122.1">
      /kolla-ansible/ansible/roles/keystone
     </span>
    </strong>
    <span class="koboSpan" id="kobo.123.1">
     .
    </span>
    <span class="koboSpan" id="kobo.123.2">
     At the time of writing this book, the default
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.124.1">
      kolla-ansible
     </span>
    </strong>
    <span class="koboSpan" id="kobo.125.1">
     configuration within the Antelope and later releases uses
    </span>
    <a id="_idIndexMarker258">
    </a>
    <span class="koboSpan" id="kobo.126.1">
     Keystone fernet tokens to authenticate uses instead of traditional
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.127.1">
      Public Key Infrastructure
     </span>
    </strong>
    <span class="koboSpan" id="kobo.128.1">
     (
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.129.1">
       PKI
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.130.1">
      )-based tokens.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.131.1">
     The following
    </span>
    <a id="_idIndexMarker259">
    </a>
    <span class="koboSpan" id="kobo.132.1">
     workflow briefly demonstrates
    </span>
    <a id="_idIndexMarker260">
    </a>
    <span class="koboSpan" id="kobo.133.1">
     typical Keystone request and response interactions between an API requester (user or system) and identity service to access a specific
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.134.1">
      OpenStack service:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.135.1">
      A user or API requester authenticates against Keystone service using credentials.
     </span>
     <span class="koboSpan" id="kobo.135.2">
      Identity API receives the request and grants a token to the requester
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.136.1">
       once authenticated.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.137.1">
      The user or API requester presents the request with the received token to access the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.138.1">
       demanded service.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.139.1">
      The demanded service validates the eligibility of the presented token with the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.140.1">
       identity service.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.141.1">
      Once validated, the requested service replies with a response to the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.142.1">
       API requester.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.143.1">
     This workflow is depicted in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.144.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer046">
     <span class="koboSpan" id="kobo.145.1">
      <img alt="Figure 3.2 – Keystone API request processing" src="image/B21716_03_02.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.146.1">
     Figure 3.2 – Keystone API request processing
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.147.1">
     As noted previously, any request to access a specific service or resource will engage the identity
    </span>
    <a id="_idIndexMarker261">
    </a>
    <span class="koboSpan" id="kobo.148.1">
     service and later interactions will be
    </span>
    <a id="_idIndexMarker262">
    </a>
    <span class="koboSpan" id="kobo.149.1">
     handled by API requests.
    </span>
    <span class="koboSpan" id="kobo.149.2">
     Taking a more complex scenario, such as virtual machine creation, more interactions will be involved.
    </span>
    <span class="koboSpan" id="kobo.149.3">
     This would engage more services to be contacted, such as image, network, and storage, forming the essential resources to run an instance.
    </span>
    <span class="koboSpan" id="kobo.149.4">
     Hence, Keystone will validate each request by using the original authentication token.
    </span>
    <span class="koboSpan" id="kobo.149.5">
     A new desired service request will require a newly generated authenticated request using the first
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.150.1">
      authentication token.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.151.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.152.1">
     Keystone now has OAuth 2.0 Mutual TLS support.
    </span>
    <span class="koboSpan" id="kobo.152.2">
     Keystone Auth has a new plugin for the OAuth 2.0 Device
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.153.1">
      Authorization Grant.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.154.1">
     Compute service
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.155.1">
     Our control
    </span>
    <a id="_idIndexMarker263">
    </a>
    <span class="koboSpan" id="kobo.156.1">
     plane includes all compute service
    </span>
    <a id="_idIndexMarker264">
    </a>
    <span class="koboSpan" id="kobo.157.1">
     components except
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.158.1">
      nova-compute
     </span>
    </strong>
    <span class="koboSpan" id="kobo.159.1">
     , which will be running in dedicated hosts.
    </span>
    <span class="koboSpan" id="kobo.159.2">
     As covered in
    </span>
    <a href="B21716_01.xhtml#_idTextAnchor014">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.160.1">
        Chapter 1
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.161.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.162.1">
      Revisiting OpenStack – Design Considerations
     </span>
    </em>
    <span class="koboSpan" id="kobo.163.1">
     , the composition of different compute daemons constructs the main capability of the OpenStack ecosystem.
    </span>
    <span class="koboSpan" id="kobo.163.2">
     The following Nova services will run as part of the cloud
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.164.1">
      controller stack:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.165.1">
       nova-api
      </span>
     </strong>
     <span class="koboSpan" id="kobo.166.1">
      : This is the primary interface to handle compute requests, including the creation, listing, deletion, and management of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.167.1">
       compute resources.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.168.1">
       nova-scheduler
      </span>
     </strong>
     <span class="koboSpan" id="kobo.169.1">
      : This is a set of filters and weights to determine the most suitable compute hosts to run an instance based on custom or default characteristics such as host location, memory, or
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.170.1">
       CPU architecture.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.171.1">
       nova-conductor
      </span>
     </strong>
     <span class="koboSpan" id="kobo.172.1">
      : This is considered a novel addition to the Nova architecture prior to the latest OpenStack release,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.173.1">
       nova-conductor
      </span>
     </strong>
     <span class="koboSpan" id="kobo.174.1">
      insulates the compute process from contacting the database directly (counted as not trusted from a security perspective) and connects the database
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.175.1">
       directly instead.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.176.1">
       nova-novncproxy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.177.1">
      : This provides VNC console access to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.178.1">
       the instances.
      </span>
     </span>
    </li>
   </ul>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.179.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.180.1">
     The Nova playbook is located at
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.181.1">
      /kolla-ansible/ansible/roles/nova
     </span>
    </strong>
    <span class="koboSpan" id="kobo.182.1">
     in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.183.1">
      kolla-ansible
     </span>
    </strong>
    <span class="koboSpan" id="kobo.184.1">
     repository.
    </span>
    <span class="koboSpan" id="kobo.184.2">
     Note that the playbook does not separate each compute component on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.185.1">
      its own.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.186.1">
     Scheduling service
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.187.1">
     The Placement service, as highlighted in
    </span>
    <a href="B21716_01.xhtml#_idTextAnchor014">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.188.1">
        Chapter 1
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.189.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.190.1">
      Revisiting OpenStack – Design Consideration
     </span>
    </em>
    <span class="koboSpan" id="kobo.191.1">
     , is considered a great addition to the compute service to conduct fine-grained
    </span>
    <a id="_idIndexMarker265">
    </a>
    <span class="koboSpan" id="kobo.192.1">
     prefiltering and achieve advanced
    </span>
    <a id="_idIndexMarker266">
    </a>
    <span class="koboSpan" id="kobo.193.1">
     instance scheduling not only by checking compute resources but also for networking and storage pools.
    </span>
    <span class="koboSpan" id="kobo.193.2">
     The Placement service was introduced as part of the Nova architecture, and due to its evolution, it has been turned into a separate project.
    </span>
    <span class="koboSpan" id="kobo.193.3">
     Some important constructs that use this service are
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.194.1">
      as follows:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.195.1">
       Resource providers
      </span>
     </strong>
     <span class="koboSpan" id="kobo.196.1">
      : The Placement service tracks the underlying resources (types and occurrences), such as compute, storage pools, and networking, in the form of abstracted data
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.197.1">
       model objects.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.198.1">
       Resource class
      </span>
     </strong>
     <span class="koboSpan" id="kobo.199.1">
      : Tracked resources are classified by types that are categorized into two main sets of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.200.1">
       resource classes:
      </span>
     </span>
     <ul>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.201.1">
         Standard
        </span>
       </strong>
       <span class="koboSpan" id="kobo.202.1">
        :
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.203.1">
         MEMORY_MB
        </span>
       </strong>
       <span class="koboSpan" id="kobo.204.1">
        ,
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.205.1">
         VCPU
        </span>
       </strong>
       <span class="koboSpan" id="kobo.206.1">
        ,
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.207.1">
         DISK_GB
        </span>
       </strong>
       <span class="koboSpan" id="kobo.208.1">
        ,
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.209.1">
         IPV4_ADDRESS
        </span>
       </strong>
       <span class="koboSpan" id="kobo.210.1">
        ,
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.211.1">
         PCI_DEVICE
        </span>
       </strong>
       <span class="koboSpan" id="kobo.212.1">
        ,
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.213.1">
         SRIOV_NET_VF
        </span>
       </strong>
       <span class="koboSpan" id="kobo.214.1">
        ,
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.215.1">
         NUMA_CORE
        </span>
       </strong>
       <span class="koboSpan" id="kobo.216.1">
        ,
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.217.1">
         NUMA_SOCKET
        </span>
       </strong>
       <span class="koboSpan" id="kobo.218.1">
        ,
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.219.1">
         VGPU
        </span>
       </strong>
       <span class="koboSpan" id="kobo.220.1">
        , and
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.221.1">
         so on.
        </span>
       </span>
      </li>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.222.1">
         Custom
        </span>
       </strong>
       <span class="koboSpan" id="kobo.223.1">
        : Starting with the
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.224.1">
         CUSTOM_
        </span>
       </strong>
       <span class="koboSpan" id="kobo.225.1">
        prefix, custom resources can be created and added to the resource classes of the
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.226.1">
         Placement
        </span>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.227.1">
         service.
        </span>
       </span>
      </li>
     </ul>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.228.1">
       Inventories
      </span>
     </strong>
     <span class="koboSpan" id="kobo.229.1">
      : A collection of a set of resource classes provided by a given resource provider.
     </span>
     <span class="koboSpan" id="kobo.229.2">
      For example, a resource provider,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.230.1">
       RP01
      </span>
     </strong>
     <span class="koboSpan" id="kobo.231.1">
      , is associated with four resource classes:
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.232.1">
       16 VCPU
      </span>
     </strong>
     <span class="koboSpan" id="kobo.233.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.234.1">
       4096 MEMORY_MB
      </span>
     </strong>
     <span class="koboSpan" id="kobo.235.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.236.1">
       200 DISK_GB
      </span>
     </strong>
     <span class="koboSpan" id="kobo.237.1">
      , and
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.238.1">
        50 IPV4_ADDRESS
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.239.1">
       .
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.240.1">
       Traits
      </span>
     </strong>
     <span class="koboSpan" id="kobo.241.1">
      : These represent the characteristics of a resource provider.
     </span>
     <span class="koboSpan" id="kobo.241.2">
      For example, vCPU provided by a resource provider,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.242.1">
       RP01
      </span>
     </strong>
     <span class="koboSpan" id="kobo.243.1">
      , can be
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.244.1">
       HW_CPU_X86_SVM
      </span>
     </strong>
     <span class="koboSpan" id="kobo.245.1">
      (SVM x86 hardware
     </span>
     <a id="_idIndexMarker267">
     </a>
     <span class="koboSpan" id="kobo.246.1">
      architecture) and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.247.1">
       DISK_GB
      </span>
     </strong>
     <span class="koboSpan" id="kobo.248.1">
      can be
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.249.1">
       Solid-State Drive
      </span>
     </strong>
     <span class="koboSpan" id="kobo.250.1">
      (
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.251.1">
       SSD
      </span>
     </strong>
     <span class="koboSpan" id="kobo.252.1">
      ).
     </span>
     <span class="koboSpan" id="kobo.252.2">
      Both traits assigned to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.253.1">
       RP01
      </span>
     </strong>
     <span class="koboSpan" id="kobo.254.1">
      will be noted as
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.255.1">
       is_X86_SVM
      </span>
     </strong>
     <span class="koboSpan" id="kobo.256.1">
      and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.257.1">
       is_SSD
      </span>
     </strong>
     <span class="koboSpan" id="kobo.258.1">
      for both
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.259.1">
       VPCU
      </span>
     </strong>
     <span class="koboSpan" id="kobo.260.1">
      and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.261.1">
       DISK_GB
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.262.1">
       resources, respectively.
      </span>
     </span>
    </li>
   </ul>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.263.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.264.1">
     The Placement service provides standard traits; however, operators can still create custom traits by using the placement API CLI.
    </span>
    <span class="koboSpan" id="kobo.264.2">
     Traits can be specified in the Glance image characteristics, or the extra specs of the instance flavor used for the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.265.1">
      instance launch.
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.266.1">
       Allocation
      </span>
     </strong>
     <span class="koboSpan" id="kobo.267.1">
      : An instance that occupies resources in a compute node is considered a consumer for a resource provider.
     </span>
     <span class="koboSpan" id="kobo.267.2">
      This occupation of resources is represented as
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.268.1">
       allocation
      </span>
     </em>
     <span class="koboSpan" id="kobo.269.1">
      stored in a data
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.270.1">
       model record.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.271.1">
       Allocation candidates
      </span>
     </strong>
     <span class="koboSpan" id="kobo.272.1">
      : After processing each request, the Placement service reshuffles the existing resource providers and returns the latest available group to be available for the next
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.273.1">
       suitable requests.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.274.1">
     Through
    </span>
    <a id="_idIndexMarker268">
    </a>
    <span class="koboSpan" id="kobo.275.1">
     the Placement service, more advanced filtering options can
    </span>
    <a id="_idIndexMarker269">
    </a>
    <span class="koboSpan" id="kobo.276.1">
     be achieved.
    </span>
    <span class="koboSpan" id="kobo.276.2">
     The following workflow demonstrates how the networking service interacts with the compute service through placement.
    </span>
    <span class="koboSpan" id="kobo.276.3">
     The desired scenario is to schedule instance provisioning in a compute node based on the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.277.1">
      network bandwidth:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.278.1">
      An inventory is created through the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.279.1">
       compute service.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.280.1">
      A resource provider is created by the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.281.1">
       compute node.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.282.1">
      Under the compute resource provider, a networking resource provider is created by the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.283.1">
       networking service.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.284.1">
      The networking service reports the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.285.1">
       bandwidth inventories.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.286.1">
      The networking service provides a resource request for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.287.1">
       a port.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.288.1">
      The compute service receives the resource request from the port and adds it to the API request in a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.289.1">
       GET /
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.290.1">
        allocation_candidates
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.291.1">
       request.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.292.1">
      The exposed candidates will be filtered by the Placement service and the compute service will pick up the most
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.293.1">
       suitable one.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.294.1">
      The compute service claims the resources in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.295.1">
       Placement
      </span>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.296.1">
       service.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.297.1">
      The compute service exchanges the allocation update with the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.298.1">
       networking service.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.299.1">
      The Placement service updates its allocation candidates for the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.300.1">
       next request.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.301.1">
     The placement
    </span>
    <a id="_idIndexMarker270">
    </a>
    <span class="koboSpan" id="kobo.302.1">
     API provides additional
    </span>
    <a id="_idIndexMarker271">
    </a>
    <span class="koboSpan" id="kobo.303.1">
     capabilities by assisting the Nova scheduling process.
    </span>
    <span class="koboSpan" id="kobo.303.2">
     Prior to the Newton release, only computing resource usage (such as CPU and RAM) was tracked and managed.
    </span>
    <span class="koboSpan" id="kobo.303.3">
     With the addition of multiple resource providers (storage and network services), the placement API simplifies resource recording and scheduling through a unified
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.304.1">
      management method.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.305.1">
     Image service
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.306.1">
     The Glance API is part of the control plane.
    </span>
    <span class="koboSpan" id="kobo.306.2">
     However, as was highlighted in
    </span>
    <a href="B21716_01.xhtml#_idTextAnchor014">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.307.1">
        Chapter 1
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.308.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.309.1">
      Revisiting OpenStack – Design Consideration
     </span>
    </em>
    <span class="koboSpan" id="kobo.310.1">
     , storing the images can be handled by different
    </span>
    <a id="_idIndexMarker272">
    </a>
    <span class="koboSpan" id="kobo.311.1">
     data store types, such as Swift object storage, AWS S3, the Ceph storage system, VMware, filesystems, and, recently, the Cinder block storage service.
    </span>
    <span class="koboSpan" id="kobo.311.2">
     The evolution
    </span>
    <a id="_idIndexMarker273">
    </a>
    <span class="koboSpan" id="kobo.312.1">
     of the Glance service has been marked mostly by the flexibility of the storage image backend support within the latest OpenStack releases.
    </span>
    <span class="koboSpan" id="kobo.312.2">
     Within Antelope and later releases, the Glance API service can be configured to support a list of backends at the same time, where the Glance API will process the disk image operation using the default data store; otherwise, it will go through the defined
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.313.1">
      backend list.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.314.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.315.1">
     By default, the imaging service playbook supports file, HTTP, VMware, Cinder, Swift, and Ceph backends located in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.316.1">
      /kolla-ansible/ansible/roles/glance/defaults/main.yml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.317.1">
     file.
    </span>
    <span class="koboSpan" id="kobo.317.2">
     Enabling or disabling additional image storage backends can be done from the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.318.1">
      /kolla-ansible/etc/kolla/globals.yml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.319.1">
     file by setting
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.320.1">
      yes
     </span>
    </strong>
    <span class="koboSpan" id="kobo.321.1">
     or
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.322.1">
      no
     </span>
    </strong>
    <span class="koboSpan" id="kobo.323.1">
     to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.324.1">
      glance_backend_ceph
     </span>
    </strong>
    <span class="koboSpan" id="kobo.325.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.326.1">
      glance_backend_file
     </span>
    </strong>
    <span class="koboSpan" id="kobo.327.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.328.1">
      glance_backend_swift
     </span>
    </strong>
    <span class="koboSpan" id="kobo.329.1">
     , and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.330.1">
      glance_backend_vmware
     </span>
    </strong>
    <span class="koboSpan" id="kobo.331.1">
     for Ceph, file, Swift and VMware storage
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.332.1">
      backends, respectively.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.333.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.334.1">
      glance-registry
     </span>
    </strong>
    <span class="koboSpan" id="kobo.335.1">
     process running in the control plane will handle the metadata
    </span>
    <a id="_idIndexMarker274">
    </a>
    <span class="koboSpan" id="kobo.336.1">
     updates for each associated image in
    </span>
    <a id="_idIndexMarker275">
    </a>
    <span class="koboSpan" id="kobo.337.1">
     the database, including the image location defined in the storage backend path, as illustrated in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.338.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer047">
     <span class="koboSpan" id="kobo.339.1">
      <img alt="Figure 3.3 – The Glance control plane components" src="image/B21716_03_03.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.340.1">
     Figure 3.3 – The Glance control plane components
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.341.1">
     The other great addition to this Glance storage support capability is that the control plane can be customized to support multiple block storage backends for Glance.
    </span>
    <span class="koboSpan" id="kobo.341.2">
     If two Cinder storage volumes are created, a property can be assigned to a volume, for example, SSD or HDD, where the Glance API will be instructed to use the desired Cinder volume based on the cloud operator’s
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.342.1">
      desired configuration.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.343.1">
     Networking service
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.344.1">
     Unlike many other OpenStack services, the Neutron service is considered more complex due to
    </span>
    <a id="_idIndexMarker276">
    </a>
    <span class="koboSpan" id="kobo.345.1">
     the nature of its evolution through the OpenStack releases as
    </span>
    <a id="_idIndexMarker277">
    </a>
    <span class="koboSpan" id="kobo.346.1">
     well as its advanced virtual networking features and extensions.
    </span>
    <span class="koboSpan" id="kobo.346.2">
     As demonstrated in
    </span>
    <a href="B21716_01.xhtml#_idTextAnchor014">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.347.1">
        Chapter 1
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.348.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.349.1">
      Revisiting OpenStack – Design Consideration
     </span>
    </em>
    <span class="koboSpan" id="kobo.350.1">
     , the networking capaci
    </span>
    <a id="_idTextAnchor112">
    </a>
    <span class="koboSpan" id="kobo.351.1">
     ty and segmentation should be planned in advance not only to accommodate more circulating traffic but also to take advantage of virtual networking scalability.
    </span>
    <span class="koboSpan" id="kobo.351.2">
     For this, a network node is dedicated to handling different types of tenants and providers by design.
    </span>
    <span class="koboSpan" id="kobo.351.3">
     Meanwhile, the main Neutron API will run on the controller node as part of the control plane.
    </span>
    <span class="koboSpan" id="kobo.351.4">
     The number of Neutron drivers and plugins is increasing with each OpenStack release; within the Antelope release, most of the well-known SDN driver mechanisms are supported, including
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.352.1">
      openvswitch
     </span>
    </strong>
    <span class="koboSpan" id="kobo.353.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.354.1">
      OVN
     </span>
    </strong>
    <span class="koboSpan" id="kobo.355.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.356.1">
      linux bridge
     </span>
    </strong>
    <span class="koboSpan" id="kobo.357.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.358.1">
      l2population
     </span>
    </strong>
    <span class="koboSpan" id="kobo.359.1">
     , and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.360.1">
      baremetal
     </span>
    </strong>
    <span class="koboSpan" id="kobo.361.1">
     .
    </span>
    <span class="koboSpan" id="kobo.361.2">
     Advanced service plugins providing virtual network features such as VPNs, firewalling, and routing run on a separate network node.
    </span>
    <span class="koboSpan" id="kobo.361.3">
     It is strongly recommended to consider hardware network bonding for both cloud controllers and network nodes for performance and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.362.1">
      resiliency reasons.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.363.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.364.1">
     Networking configuration through the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.365.1">
      kolla-ansible
     </span>
    </strong>
    <span class="koboSpan" id="kobo.366.1">
     infrastructure code repository can take different forms depending on the networking features to be added.
    </span>
    <span class="koboSpan" id="kobo.366.2">
     All mechanisms, drivers, and service plugins are listed in the Neutron file (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.367.1">
      /kolla-ansible/ansible/roles/neutron/defaults/main.yml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.368.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.368.2">
     Neutron drivers such as Open vSwitch and OVN run on their own playbooks located in the same folder path,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.369.1">
      /kolla-ansible/ansible/roles/openvswitch
     </span>
    </strong>
    <span class="koboSpan" id="kobo.370.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.371.1">
      /
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.372.1">
       kolla-ansible/ansible/roles/ovn-controller
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.373.1">
      , respectively
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.374.1">
     Block storage service
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.375.1">
     Cinder’s main mission since its incubation within the OpenStack ecosystem has been to provide
    </span>
    <a id="_idIndexMarker278">
    </a>
    <span class="koboSpan" id="kobo.376.1">
     persistent storage to instances.
    </span>
    <span class="koboSpan" id="kobo.376.2">
     Unlike
    </span>
    <a id="_idIndexMarker279">
    </a>
    <span class="koboSpan" id="kobo.377.1">
     ephemeral storage, the block storage concept has been included in OpenStack since Bexar’s early release and kept as part of the Nova project.
    </span>
    <span class="koboSpan" id="kobo.377.2">
     However, since the Folsom release, it has been changed to its own service.
    </span>
    <span class="koboSpan" id="kobo.377.3">
     There are many reasons for this separation; the main reason is the development of the Cinder architecture.
    </span>
    <span class="koboSpan" id="kobo.377.4">
     Some of the block storage subcomponents are considered part of a control plane, including
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.378.1">
      cinder-api
     </span>
    </strong>
    <span class="koboSpan" id="kobo.379.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.380.1">
      cinder-scheduler
     </span>
    </strong>
    <span class="koboSpan" id="kobo.381.1">
     , as illustrated in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.382.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer048">
     <span class="koboSpan" id="kobo.383.1">
      <img alt="Figure 3.4 – Cinder control plane components" src="image/B21716_03_04.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.384.1">
     Figure 3.4 – Cinder control plane components
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.385.1">
     We will cover the block storage extensions in more depth in
    </span>
    <a href="B21716_05.xhtml#_idTextAnchor146">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.386.1">
        Chapter 5
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.387.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.388.1">
      OpenStack Storage – Block, Object, and
     </span>
    </em>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.389.1">
       File Shares
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.390.1">
      .
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.391.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.392.1">
     Block
    </span>
    <a id="_idIndexMarker280">
    </a>
    <span class="koboSpan" id="kobo.393.1">
     storage is not enabled by default in
    </span>
    <a id="_idIndexMarker281">
    </a>
    <span class="koboSpan" id="kobo.394.1">
     the current
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.395.1">
      kolla-ansible
     </span>
    </strong>
    <span class="koboSpan" id="kobo.396.1">
     infrastructure code repository.
    </span>
    <span class="koboSpan" id="kobo.396.2">
     Setting
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.397.1">
      enable_cinder
     </span>
    </strong>
    <span class="koboSpan" id="kobo.398.1">
     to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.399.1">
      'yes'
     </span>
    </strong>
    <span class="koboSpan" id="kobo.400.1">
     in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.401.1">
      /kolla-ansible/etc/kolla/globals.yml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.402.1">
     file will enable created instances to store their disks in the associated volume.
    </span>
    <span class="koboSpan" id="kobo.402.2">
     Supported Cinder storage backends are listed in the Cinder playbook defined in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.403.1">
      /kolla-ansible/ansible/roles/cinder/default/main.yml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.404.1">
     file and referenced with the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.405.1">
      cinder_backend
     </span>
    </strong>
    <span class="koboSpan" id="kobo.406.1">
     configuration stanza code.
    </span>
    <span class="koboSpan" id="kobo.406.2">
     Make sure to prepare an initial LVM volume named
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.407.1">
      cinder-volumes
     </span>
    </strong>
    <span class="koboSpan" id="kobo.408.1">
     as the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.409.1">
      kolla-ansible
     </span>
    </strong>
    <span class="koboSpan" id="kobo.410.1">
     wrapper will expect an existing volume group with the mentioned name as stated in the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.411.1">
       globals.yml
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.412.1">
      file.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.413.1">
     Object storage service
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.414.1">
     Swift is
    </span>
    <a id="_idIndexMarker282">
    </a>
    <span class="koboSpan" id="kobo.415.1">
     made up of several subcomponents to manage objects, including
    </span>
    <a id="_idIndexMarker283">
    </a>
    <span class="koboSpan" id="kobo.416.1">
     accounts, containers, and objects.
    </span>
    <span class="koboSpan" id="kobo.416.2">
     At the highest level, the main interface to interact with the rest of the object storage ring is the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.417.1">
      swift-proxy-server
     </span>
    </strong>
    <span class="koboSpan" id="kobo.418.1">
     daemon, which will be running on the cloud
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.419.1">
      controller instance(s).
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.420.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.421.1">
     Swift is disabled by default in the current
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.422.1">
      kolla-ansible
     </span>
    </strong>
    <span class="koboSpan" id="kobo.423.1">
     infrastructure code repository.
    </span>
    <span class="koboSpan" id="kobo.423.2">
     It can be enabled by setting
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.424.1">
      enable_swift
     </span>
    </strong>
    <span class="koboSpan" id="kobo.425.1">
     to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.426.1">
      yes
     </span>
    </strong>
    <span class="koboSpan" id="kobo.427.1">
     in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.428.1">
      /
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.429.1">
       kolla-ansible/etc/kolla/globals.yml
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.430.1">
      file.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.431.1">
     File-sharing service
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.432.1">
     As we have
    </span>
    <a id="_idIndexMarker284">
    </a>
    <span class="koboSpan" id="kobo.433.1">
     aimed to provide a managed
    </span>
    <a id="_idIndexMarker285">
    </a>
    <span class="koboSpan" id="kobo.434.1">
     shared file service in our initial production draft, a few components of the Manila service will be part of the control plane, including
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.435.1">
      manila-api
     </span>
    </strong>
    <span class="koboSpan" id="kobo.436.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.437.1">
      manila-scheduler
     </span>
    </strong>
    <span class="koboSpan" id="kobo.438.1">
     .
    </span>
    <span class="koboSpan" id="kobo.438.2">
     Like Cinder, the backend storage flavors of the file-sharing service can vary.
    </span>
    <span class="koboSpan" id="kobo.438.3">
     We will cover more configuration details of the file-sharing service in
    </span>
    <a href="B21716_05.xhtml#_idTextAnchor146">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.439.1">
        Chapter 5
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.440.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.441.1">
      OpenStack Storage – Block, Object, and
     </span>
    </em>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.442.1">
       File Shares
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.443.1">
      .
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.444.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.445.1">
     The file-sharing
    </span>
    <a id="_idIndexMarker286">
    </a>
    <span class="koboSpan" id="kobo.446.1">
     service is disabled by default
    </span>
    <a id="_idIndexMarker287">
    </a>
    <span class="koboSpan" id="kobo.447.1">
     in the current
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.448.1">
      kolla-ansible
     </span>
    </strong>
    <span class="koboSpan" id="kobo.449.1">
     infrastructure code repository.
    </span>
    <span class="koboSpan" id="kobo.449.2">
     Enabling the Manila service can be done by adjusting the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.450.1">
      enable_manila
     </span>
    </strong>
    <span class="koboSpan" id="kobo.451.1">
     setting to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.452.1">
      yes
     </span>
    </strong>
    <span class="koboSpan" id="kobo.453.1">
     in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.454.1">
      /
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.455.1">
       kolla-ansible/etc/kolla/globals.yml
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.456.1">
      file.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.457.1">
     Monitoring
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.458.1">
     As stated in
    </span>
    <a href="B21716_01.xhtml#_idTextAnchor014">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.459.1">
        Chapter 1
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.460.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.461.1">
      Revisiting OpenStack – Design Considerations
     </span>
    </em>
    <span class="koboSpan" id="kobo.462.1">
     , Ceilometer has been
    </span>
    <a id="_idIndexMarker288">
    </a>
    <span class="koboSpan" id="kobo.463.1">
     changed to act solely as a metric collector of resources running under
    </span>
    <a id="_idIndexMarker289">
    </a>
    <span class="koboSpan" id="kobo.464.1">
     the OpenStack command.
    </span>
    <span class="koboSpan" id="kobo.464.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.465.1">
      ceilometer-api
     </span>
    </strong>
    <span class="koboSpan" id="kobo.466.1">
     component is part of the control plane.
    </span>
    <span class="koboSpan" id="kobo.466.2">
     Considering the way Ceilometer
    </span>
    <a id="_idIndexMarker290">
    </a>
    <span class="koboSpan" id="kobo.467.1">
     functions, its agent-based architecture involves the existence of data collection agents that collect metric data via REST APIs and poll resources.
    </span>
    <span class="koboSpan" id="kobo.467.2">
     In addition to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.468.1">
      ceilometer-api
     </span>
    </strong>
    <span class="koboSpan" id="kobo.469.1">
     , a ceilometer polling agent also runs in the controller node with a central agent to poll all resources created by various tenants under the OpenStack infrastructure.
    </span>
    <span class="koboSpan" id="kobo.469.2">
     A notification agent listening to the message bus to consume notification data emitted by agents can optionally run on the cloud
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.470.1">
      controller node.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.471.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.472.1">
     The Ceilometer service is disabled by default in the current
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.473.1">
      kolla-ansible
     </span>
    </strong>
    <span class="koboSpan" id="kobo.474.1">
     infrastructure code repository.
    </span>
    <span class="koboSpan" id="kobo.474.2">
     Set
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.475.1">
      enable_ceilometer
     </span>
    </strong>
    <span class="koboSpan" id="kobo.476.1">
     to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.477.1">
      yes
     </span>
    </strong>
    <span class="koboSpan" id="kobo.478.1">
     in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.479.1">
      /kolla-ansible/etc/kolla/globals.yml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.480.1">
     file.
    </span>
    <span class="koboSpan" id="kobo.480.2">
     The default playbook configuration of Ceilometer is located under the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.481.1">
      /
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.482.1">
       kolla-ansible/ansible/roles/ceilometer
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.483.1">
      directory.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.484.1">
     Alarming
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.485.1">
     Alarming was originally designed as part of the Ceilometer features and was decoupled to run on
    </span>
    <a id="_idIndexMarker291">
    </a>
    <span class="koboSpan" id="kobo.486.1">
     its own project with the code name
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.487.1">
      Aodh
     </span>
    </strong>
    <span class="koboSpan" id="kobo.488.1">
     .
    </span>
    <span class="koboSpan" id="kobo.488.2">
     The alarming
    </span>
    <a id="_idIndexMarker292">
    </a>
    <span class="koboSpan" id="kobo.489.1">
     components can live within the cloud controller node, which includes additional components for alarm evaluation, a notifier, and a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.490.1">
      state database.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.491.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.492.1">
     The Aodh service
    </span>
    <a id="_idIndexMarker293">
    </a>
    <span class="koboSpan" id="kobo.493.1">
     is disabled by default in the current
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.494.1">
      kolla-ansible
     </span>
    </strong>
    <span class="koboSpan" id="kobo.495.1">
     infrastructure code repository.
    </span>
    <span class="koboSpan" id="kobo.495.2">
     Set
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.496.1">
      enable_aodh
     </span>
    </strong>
    <span class="koboSpan" id="kobo.497.1">
     to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.498.1">
      yes
     </span>
    </strong>
    <span class="koboSpan" id="kobo.499.1">
     in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.500.1">
      /kolla-ansible/etc/kolla/globals.yml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.501.1">
     file.
    </span>
    <span class="koboSpan" id="kobo.501.2">
     The default playbook configuration of Aodh is located under the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.502.1">
      /
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.503.1">
       kolla-ansible/ansible/roles/aodh
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.504.1">
      directory.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.505.1">
     Dashboard service
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.506.1">
     Horizon runs behind an Apache web server instance that serves as a frontend to expose OpenStack
    </span>
    <a id="_idIndexMarker294">
    </a>
    <span class="koboSpan" id="kobo.507.1">
     services in a dashboard, but not all non-core services are
    </span>
    <a id="_idIndexMarker295">
    </a>
    <span class="koboSpan" id="kobo.508.1">
     reflected in the dashboard by default.
    </span>
    <span class="koboSpan" id="kobo.508.2">
     Horizon needs to be configured by enabling directives for certain services and features, such as VPN as a service.
    </span>
    <span class="koboSpan" id="kobo.508.3">
     Horizon is based on the Python Django framework, which could be overutilized if the number of end users keeps increasing and requests are performed excessively.
    </span>
    <span class="koboSpan" id="kobo.508.4">
     Scaling the dashboard is something one should expect, especially if most of the supported directives for additional services are enabled and exposed to a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.509.1">
      wider audience.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.510.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.511.1">
     Horizon is counted as a core service in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.512.1">
      kolla-ansible
     </span>
    </strong>
    <span class="koboSpan" id="kobo.513.1">
     infrastructure code repository by default.
    </span>
    <span class="koboSpan" id="kobo.513.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.514.1">
      enable_openstack_core
     </span>
    </strong>
    <span class="koboSpan" id="kobo.515.1">
     stanza configuration is set to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.516.1">
      yes
     </span>
    </strong>
    <span class="koboSpan" id="kobo.517.1">
     by default, which includes the Horizon service in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.518.1">
      /kolla-ansible/etc/kolla/globals.yml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.519.1">
     file.
    </span>
    <span class="koboSpan" id="kobo.519.2">
     In the same file, you can enable additional Horizon directives to be managed through the dashboard by commenting out the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.520.1">
      enable_horizon_service
     </span>
    </strong>
    <span class="koboSpan" id="kobo.521.1">
     configuration line where the service refers to the additional OpenStack service.
    </span>
    <span class="koboSpan" id="kobo.521.2">
     By default, all additional services supported by the dashboard are enabled in the Horizon playbook, as reflected in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.522.1">
      /
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.523.1">
       kolla-ansible/ansible/roles/horizon/default/main.yml
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.524.1">
      file.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.525.1">
     As we
    </span>
    <a id="_idIndexMarker296">
    </a>
    <span class="koboSpan" id="kobo.526.1">
     have covered most of the OpenStack
    </span>
    <a id="_idIndexMarker297">
    </a>
    <span class="koboSpan" id="kobo.527.1">
     services that will be part of the control plane, the next section will iterate through the non-OpenStack services counted as
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.528.1">
      shared services.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-68">
    <a id="_idTextAnchor113">
    </a>
    <span class="koboSpan" id="kobo.529.1">
     Shared services – infrastructure services
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.530.1">
     In
    </span>
    <a href="B21716_01.xhtml#_idTextAnchor014">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.531.1">
        Chapter 1
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.532.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.533.1">
      Revisiting OpenStack – Cloud Design Considerations
     </span>
    </em>
    <span class="koboSpan" id="kobo.534.1">
     , we identified shared
    </span>
    <a id="_idIndexMarker298">
    </a>
    <span class="koboSpan" id="kobo.535.1">
     services as being non-OpenStack services.
    </span>
    <span class="koboSpan" id="kobo.535.2">
     Shared services, such as queuing messages, databases, and, optionally, the caching layer, are the most critical ones besides other
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.536.1">
      core services.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.537.1">
     Message queue
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.538.1">
     As part of
    </span>
    <a id="_idIndexMarker299">
    </a>
    <span class="koboSpan" id="kobo.539.1">
     the control plane, RabbitMQ is the most commonly used messaging service in OpenStack.
    </span>
    <span class="koboSpan" id="kobo.539.2">
     Dedicating separate nodes for the queue
    </span>
    <a id="_idIndexMarker300">
    </a>
    <span class="koboSpan" id="kobo.540.1">
     is highly recommended but is not a
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.541.1">
      must-have
     </span>
    </em>
    <span class="koboSpan" id="kobo.542.1">
     .
    </span>
    <span class="koboSpan" id="kobo.542.2">
     Vast deployment based on multi-regional OpenStack environments is a suitable case to run in a dedicated RabbitMQ cluster due to the meshed requests of different services, including compute, storage,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.543.1">
      and networks.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.544.1">
     The other overlooked aspect of the queuing message is the security requirement.
    </span>
    <span class="koboSpan" id="kobo.544.2">
     RabbitMQ sits between most OpenStack services as a communication hub.
    </span>
    <span class="koboSpan" id="kobo.544.3">
     It is important to keep message exchanges secured.
    </span>
    <span class="koboSpan" id="kobo.544.4">
     RabbitMQ supports TLS, which protects subscribers and clients from tampered-with messages and forces encryption
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.545.1">
      in transit.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.546.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.547.1">
     The RabbitMQ TLS option is disabled by default in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.548.1">
      kolla-ansible
     </span>
    </strong>
    <span class="koboSpan" id="kobo.549.1">
     infrastructure code repository.
    </span>
    <span class="koboSpan" id="kobo.549.2">
     It can be enabled by setting
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.550.1">
      rabbitmq_enable_tls
     </span>
    </strong>
    <span class="koboSpan" id="kobo.551.1">
     to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.552.1">
      yes
     </span>
    </strong>
    <span class="koboSpan" id="kobo.553.1">
     in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.554.1">
      /kolla-ansible/etc/kolla/globals.yml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.555.1">
     file.
    </span>
    <span class="koboSpan" id="kobo.555.2">
     Additional RabbitMQ configurations can be adjusted in its associated playbook, such as message and queue expiration, which are located in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.556.1">
      /
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.557.1">
       kolla-ansible/ansible/roles/rabbitmq/default/main.yml
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.558.1">
      file.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.559.1">
     Database
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.560.1">
     The other
    </span>
    <a id="_idIndexMarker301">
    </a>
    <span class="koboSpan" id="kobo.561.1">
     vital piece of the OpenStack puzzle ecosystem is the
    </span>
    <a id="_idIndexMarker302">
    </a>
    <span class="koboSpan" id="kobo.562.1">
     database holding updates of all service states and user-tracking information.
    </span>
    <span class="koboSpan" id="kobo.562.2">
     MariaDB is considered the database engine as part of the control plane, made better with the Galera wrapper for clustering in multi-master
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.563.1">
      cluster mode.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.564.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.565.1">
     MariaDB clustering relies on HAProxy for database instance switching.
    </span>
    <span class="koboSpan" id="kobo.565.2">
     More details will be discussed in
    </span>
    <a href="B21716_07.xhtml#_idTextAnchor174">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.566.1">
        Chapter 7
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.567.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.568.1">
      Running a Highly Available Cloud – Meeting the SLA
     </span>
    </em>
    <span class="koboSpan" id="kobo.569.1">
     .
    </span>
    <span class="koboSpan" id="kobo.569.2">
     The default database engine is configured with MariaDB in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.570.1">
      kolla-ansible
     </span>
    </strong>
    <span class="koboSpan" id="kobo.571.1">
     infrastructure
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.572.1">
      code repository.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.573.1">
     Caching
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.574.1">
     Caching comes
    </span>
    <a id="_idIndexMarker303">
    </a>
    <span class="koboSpan" id="kobo.575.1">
     as an optional piece of our control plane.
    </span>
    <span class="koboSpan" id="kobo.575.2">
     However, it is
    </span>
    <a id="_idIndexMarker304">
    </a>
    <span class="koboSpan" id="kobo.576.1">
     strongly recommended to begin with caching due to its light footprint in cloud controller utilization.
    </span>
    <span class="koboSpan" id="kobo.576.2">
     Memcached is becoming a standard to provide ephemeral data between different OpenStack services, such as API interaction information between the identity service and the rest of the services demanding
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.577.1">
      token validation.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.578.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.579.1">
     Memcached is enabled in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.580.1">
      kolla-ansible
     </span>
    </strong>
    <span class="koboSpan" id="kobo.581.1">
     infrastructure code repository by default.
    </span>
    <span class="koboSpan" id="kobo.581.2">
     The maximum cached memory size and number of connections can be set in the Memcached playbook located in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.582.1">
      /
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.583.1">
       kolla-ansible/ansible/roles/memcached/default/main.yml
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.584.1">
      file.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.585.1">
     Identifying the control plane of OpenStack is an essential step before starting the deployment of the private cloud.
    </span>
    <span class="koboSpan" id="kobo.585.2">
     That will help to identify which design layout will fit in your environment
    </span>
    <a id="_idIndexMarker305">
    </a>
    <span class="koboSpan" id="kobo.586.1">
     to ensure high availability as the highest
    </span>
    <a id="_idIndexMarker306">
    </a>
    <span class="koboSpan" id="kobo.587.1">
     priority.
    </span>
    <span class="koboSpan" id="kobo.587.2">
     The next section will iterate through the next design draft scoped around the OpenStack
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.588.1">
      control plane.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-69">
    <a id="_idTextAnchor114">
    </a>
    <span class="koboSpan" id="kobo.589.1">
     Arming the control plane – prepare for failure
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.590.1">
     The composition of different components around the OpenStack control plane requires more effort
    </span>
    <a id="_idIndexMarker307">
    </a>
    <span class="koboSpan" id="kobo.591.1">
     to keep them up and running with maximum resiliency.
    </span>
    <span class="koboSpan" id="kobo.591.2">
     There are a variety of ways to achieve maximum availability for the control plane, but they should be prepared and tested in advance.
    </span>
    <span class="koboSpan" id="kobo.591.3">
     Within the latest releases of OpenStack, several tools have been adopted to ensure a scalable and highly available control plane.
    </span>
    <span class="koboSpan" id="kobo.591.4">
     Another approach is simply reusing some patterns that already exist, such as highly available database layouts or messaging bus clustering.
    </span>
    <span class="koboSpan" id="kobo.591.5">
     We will discuss each of the OpenStack layers’ high availability in more depth in
    </span>
    <a href="B21716_07.xhtml#_idTextAnchor174">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.592.1">
        Chapter 7
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.593.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.594.1">
      Running a Highly Available Cloud – Meeting the SLA
     </span>
    </em>
    <span class="koboSpan" id="kobo.595.1">
     .
    </span>
    <span class="koboSpan" id="kobo.595.2">
     It is essential, at this level, to define a strategy to empower the control plane from both scalability and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.596.1">
      availability perspectives.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.597.1">
     Both terms should be considered from the first iteration of the design plan by addressing the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.598.1">
      following questions:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.599.1">
      How can a control plane respond to a large number of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.600.1">
       API requests?
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.601.1">
      How can hardware failure be faced and resolved in the least amount
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.602.1">
       of time?
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.603.1">
      Which design patterns can be used to ensure a stable and resilient
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.604.1">
       control plane?
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.605.1">
      How can we handle the growth of infrastructure services such as databases and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.606.1">
       messaging buses?
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.607.1">
     The OpenStack ecosystem has been designed to scale massively.
    </span>
    <span class="koboSpan" id="kobo.607.2">
     Armed with its modular architecture, designing the control plane for resiliency is an open door for different ways of implementation.
    </span>
    <span class="koboSpan" id="kobo.607.3">
     A summary of possible known design options to prepare for a successful control plane deployment is
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.608.1">
      as follows:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.609.1">
       Active/active
      </span>
     </strong>
     <span class="koboSpan" id="kobo.610.1">
      : All cluster nodes participate in processing requests.
     </span>
     <span class="koboSpan" id="kobo.610.2">
      This pattern is mainly associated with an
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.611.1">
       asymmetric clustering
      </span>
     </em>
     <span class="koboSpan" id="kobo.612.1">
      layout whereby an entry point
     </span>
     <a id="_idIndexMarker308">
     </a>
     <span class="koboSpan" id="kobo.613.1">
      such as a load balancer distributes the requests across active control plane services.
     </span>
     <span class="koboSpan" id="kobo.613.2">
      An active/active setup increases the performance and scalability of the cloud infrastructure by distributing the load across an army of nodes.
     </span>
     <span class="koboSpan" id="kobo.613.3">
      Automating the subscriptions or discarding a node can be orchestrated with a load balancer and does not necessarily require a resource manager depending on the load
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.614.1">
       balancer’s capabilities.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.615.1">
       Active/passive
      </span>
     </strong>
     <span class="koboSpan" id="kobo.616.1">
      : Unlike the previous mode, active nodes serve requests while standby
     </span>
     <a id="_idIndexMarker309">
     </a>
     <span class="koboSpan" id="kobo.617.1">
      nodes take over only when one or several active nodes fail.
     </span>
     <span class="koboSpan" id="kobo.617.2">
      Passive control plane nodes are referred to as
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.618.1">
       sleepy watchers
      </span>
     </em>
     <span class="koboSpan" id="kobo.619.1">
      and do not require an additional frontend point such as a load balancer, unlike in active/active mode.
     </span>
     <span class="koboSpan" id="kobo.619.2">
      Such designs are associated mainly with
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.620.1">
       symmetric clustering
      </span>
     </em>
     <span class="koboSpan" id="kobo.621.1">
      whereby resource manager software evaluates and ensures that the active control plane component is the only one serving the requests at any point
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.622.1">
       in time.
      </span>
     </span>
    </li>
   </ul>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.623.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.624.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.625.1">
      kolla-ansible
     </span>
    </strong>
    <span class="koboSpan" id="kobo.626.1">
     infrastructure code repository comes with predefined roles for a highly
    </span>
    <a id="_idIndexMarker310">
    </a>
    <span class="koboSpan" id="kobo.627.1">
     available control plane defined in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.628.1">
      globals.yml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.629.1">
     file with the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.630.1">
      'hacluster'
     </span>
    </strong>
    <span class="koboSpan" id="kobo.631.1">
     stanza configuration.
    </span>
    <span class="koboSpan" id="kobo.631.2">
     Most of the adopted clustering software tools within the OpenStack control
    </span>
    <a id="_idIndexMarker311">
    </a>
    <span class="koboSpan" id="kobo.632.1">
     plane services, including the Antelope release, use a few
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.633.1">
      HAProxy
     </span>
    </strong>
    <span class="koboSpan" id="kobo.634.1">
     instances for load balancing and Keepalived for
    </span>
    <a id="_idIndexMarker312">
    </a>
    <span class="koboSpan" id="kobo.635.1">
     dynamic cluster node health checks based on the concept of
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.636.1">
      Virtual IP
     </span>
    </strong>
    <span class="koboSpan" id="kobo.637.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.638.1">
      VIP
     </span>
    </strong>
    <span class="koboSpan" id="kobo.639.1">
     ) addresses.
    </span>
    <span class="koboSpan" id="kobo.639.2">
     The HAProxy playbook comes with the latest customizable configuration settings located under the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.640.1">
      /kolla-ansible/ansible/roles/loadbalancer/
     </span>
    </strong>
    <span class="koboSpan" id="kobo.641.1">
     directory.
    </span>
    <a href="B21716_07.xhtml#_idTextAnchor174">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.642.1">
        Chapter 7
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.643.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.644.1">
      Running a Highly Available Cloud – Meeting the SLA
     </span>
    </em>
    <span class="koboSpan" id="kobo.645.1">
     , will cover the HAProxy and Keepalived setup in more detail to deploy a highly available OpenStack
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.646.1">
      control plane.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.647.1">
     Designing for
    </span>
    <a id="_idIndexMarker313">
    </a>
    <span class="koboSpan" id="kobo.648.1">
     control plane failure would depend on the target
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.649.1">
      Service-Level Agreement
     </span>
    </strong>
    <span class="koboSpan" id="kobo.650.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.651.1">
      SLA
     </span>
    </strong>
    <span class="koboSpan" id="kobo.652.1">
     ) and available options within your infrastructure.
    </span>
    <span class="koboSpan" id="kobo.652.2">
     Active/active mode could be a
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.653.1">
      best-effort
     </span>
    </em>
    <span class="koboSpan" id="kobo.654.1">
     scalable and highly available implementation but would cost extra by dedicating either a hardware or software appliance to assign the load-balancing role of the cluster.
    </span>
    <span class="koboSpan" id="kobo.654.2">
     The choice of database is another dilemma that most cloud architects and operators pay special attention to due to complexity
    </span>
    <a id="_idIndexMarker314">
    </a>
    <span class="koboSpan" id="kobo.655.1">
     and performance concerns.
    </span>
    <span class="koboSpan" id="kobo.655.2">
     For example, an organization’s policy dictates the usage of the Oracle database engine.
    </span>
    <span class="koboSpan" id="kobo.655.3">
     Setting an active-active database setup might not be straightforward to address control plane high-availability requirements because that might require more specific tools and additional integration, unlike using other engines such as
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.656.1">
      MySQL Galera.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-70">
    <a id="_idTextAnchor115">
    </a>
    <span class="koboSpan" id="kobo.657.1">
     Planning for more
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.658.1">
     Relying on the CI/CD tool as a source of truth is a best practice to keep a consistent control plane
    </span>
    <a id="_idIndexMarker315">
    </a>
    <span class="koboSpan" id="kobo.659.1">
     services cluster.
    </span>
    <span class="koboSpan" id="kobo.659.2">
     As we will cover in
    </span>
    <a href="B21716_07.xhtml#_idTextAnchor174">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.660.1">
        Chapter 7
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.661.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.662.1">
      Running a Highly Available Cloud – Meeting the SLA
     </span>
    </em>
    <span class="koboSpan" id="kobo.663.1">
     , adding a new cloud controller node should be done transparently without disturbing the running API services.
    </span>
    <span class="koboSpan" id="kobo.663.2">
     That is another valid reason to develop more integration tests of service consistency during a new control plane node deployment in a separate environment.
    </span>
    <span class="koboSpan" id="kobo.663.3">
     A monitoring system should feed back the capacity, service availability, and resource usage to ensure a successful production day if all is
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.664.1">
      as expected.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.665.1">
     The process of deploying an additional cloud controller node to empower the control plane can be applied the same way when joining additional control plane services.
    </span>
    <span class="koboSpan" id="kobo.665.2">
     Deploying more OpenStack services will expose more APIs to interact with the other nodes and handle more user or service requests.
    </span>
    <span class="koboSpan" id="kobo.665.3">
     This can increase the load by hundreds of API requests per minute, and undoubtedly more CPU, memory, networking, and disk will be consumed.
    </span>
    <span class="koboSpan" id="kobo.665.4">
     Raising performance and scalability concerns for such matters should not limit the growth of your OpenStack cloud services portfolio as there are several ways to address such a challenge.
    </span>
    <span class="koboSpan" id="kobo.665.5">
     As long as automation is preserved throughout all operations tasks, the deployment of a new OpenStack component that counts as a new control plane service should pass through the CI/CD stages.
    </span>
    <span class="koboSpan" id="kobo.665.6">
     The new component should pass through the testing and development environments and send feedback with a few metrics such as capacity and usage limits before promoting it to the production environment.
    </span>
    <span class="koboSpan" id="kobo.665.7">
     A design decision can be made afterward, for example, by running the new component in the same cloud controller cluster or dedicating a separate physical or virtual node
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.666.1">
      to run.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.667.1">
     The addition
    </span>
    <a id="_idIndexMarker316">
    </a>
    <span class="koboSpan" id="kobo.668.1">
     of a new API service as part of the control plane should be reflected across the nodes running the specific service role.
    </span>
    <span class="koboSpan" id="kobo.668.2">
     That is where the CI/CD system will shine and ensure consistency when dealing with the exponential growth of the infrastructure in terms of nodes
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.669.1">
      and services.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.670.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.671.1">
     A few other OpenStack services will be covered and integrated in the next chapters as part of the
    </span>
    <a id="_idIndexMarker317">
    </a>
    <span class="koboSpan" id="kobo.672.1">
     control
    </span>
    <a id="_idIndexMarker318">
    </a>
    <span class="koboSpan" id="kobo.673.1">
     plane, such as
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.674.1">
      Magnum
     </span>
    </strong>
    <span class="koboSpan" id="kobo.675.1">
     and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.676.1">
      Zun
     </span>
    </strong>
    <span class="koboSpan" id="kobo.677.1">
     in
    </span>
    <a href="B21716_04.xhtml#_idTextAnchor125">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.678.1">
        Chapter 4
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.679.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.680.1">
      OpenStack Compute – Compute Capacity and Flavors
     </span>
    </em>
    <span class="koboSpan" id="kobo.681.1">
     ; LBaaSv2 in
    </span>
    <a href="B21716_06.xhtml#_idTextAnchor159">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.682.1">
        Chapter 6
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.683.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.684.1">
      OpenStack Networking – Connectivity and Managed Service Options
     </span>
    </em>
    <span class="koboSpan" id="kobo.685.1">
     ; and Watcher in
    </span>
    <a href="B21716_09.xhtml#_idTextAnchor204">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.686.1">
        Chapter 9
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.687.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.688.1">
      Benchmarking the Infrastructure – Evaluating Resource Capacity
     </span>
    </em>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.689.1">
       and Optimization
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.690.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-71">
    <a id="_idTextAnchor116">
    </a>
    <span class="koboSpan" id="kobo.691.1">
     Extending the deployment
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.692.1">
     Once different services that construct the control plane have been identified, it is a good time to
    </span>
    <a id="_idIndexMarker319">
    </a>
    <span class="koboSpan" id="kobo.693.1">
     update the initial design draft.
    </span>
    <span class="koboSpan" id="kobo.693.2">
     An ideal way to start deployment with the upcoming production stage in mind is to assign each physical node a set of roles to run different OpenStack services.
    </span>
    <span class="koboSpan" id="kobo.693.3">
     That brings us to the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.694.1">
      following
     </span>
    </span>
    <span class="No-Break">
     <a id="_idIndexMarker320">
     </a>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.695.1">
      configuration:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.696.1">
       Cloud controller node
      </span>
     </strong>
     <span class="koboSpan" id="kobo.697.1">
      : This runs the control plane services including OpenStack APIs, identity, imaging, file sharing, telemetry, and dashboard services.
     </span>
     <span class="koboSpan" id="kobo.697.2">
      Shared services, including a database with a MySQL Galera cluster, the RabbitMQ messaging service, and Memcached, will be part of the assigned cloud controller
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.698.1">
       node role.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.699.1">
       Compute node
      </span>
     </strong>
     <span class="koboSpan" id="kobo.700.1">
      : This runs KVM as the main hypervisor with Nova compute and networking
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.701.1">
       agent services.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.702.1">
       Network node
      </span>
     </strong>
     <span class="koboSpan" id="kobo.703.1">
      : This runs Neutron agent services, including
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.704.1">
       layer3
      </span>
     </strong>
     <span class="koboSpan" id="kobo.705.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.706.1">
       lbaas
      </span>
     </strong>
     <span class="koboSpan" id="kobo.707.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.708.1">
       dhcp
      </span>
     </strong>
     <span class="koboSpan" id="kobo.709.1">
      , and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.710.1">
       plugin agents.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.711.1">
       Storage node
      </span>
     </strong>
     <span class="koboSpan" id="kobo.712.1">
      : This runs Cinder volume services interfacing with the Cinder scheduler
     </span>
     <a id="_idIndexMarker321">
     </a>
     <span class="koboSpan" id="kobo.713.1">
      to provide block
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.714.1">
       storage resources.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.715.1">
       Deployer node
      </span>
     </strong>
     <span class="koboSpan" id="kobo.716.1">
      : This runs the orchestration deployment toolchain, including Ansible, the Kolla builder, and the CI server.
     </span>
     <span class="koboSpan" id="kobo.716.2">
      The deployer node will optionally host a local private
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.717.1">
       Docker registry.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.718.1">
     The updated design draft exposes a multi-node OpenStack environment, as shown in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.719.1">
      following diagram:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer049">
     <span class="koboSpan" id="kobo.720.1">
      <img alt="Figure 3.5 – A multi-node OpenStack deployment layout" src="image/B21716_03_05.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.721.1">
     Figure 3.5 – A multi-node OpenStack deployment layout
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.722.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.723.1">
     Depending
    </span>
    <a id="_idIndexMarker322">
    </a>
    <span class="koboSpan" id="kobo.724.1">
     on the availability of your hardware, the network and storage roles can be assigned to the cloud controller node.
    </span>
    <span class="koboSpan" id="kobo.724.2">
     Use the monitoring metrics data to decide in advance the right moment when those services should be installed in separate physical nodes.
    </span>
    <span class="koboSpan" id="kobo.724.3">
     Splitting storage and network services is recommended when dealing with the exponential growth of the OpenStack infrastructure usage.
    </span>
    <span class="koboSpan" id="kobo.724.4">
     If you are planning to run the nodes in a virtual environment using tools such as VMware ESXi or VirtualBox, make sure to have the hardware virtualization extensions installed in addition to the virtual
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.725.1">
      networking configuration.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-72">
    <a id="_idTextAnchor117">
    </a>
    <span class="koboSpan" id="kobo.726.1">
     Initializing the network
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.727.1">
     As depicted in
    </span>
    <a href="B21716_01.xhtml#_idTextAnchor014">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.728.1">
        Chapter 1
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.729.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.730.1">
      Revisiting OpenStack – Design Considerations
     </span>
    </em>
    <span class="koboSpan" id="kobo.731.1">
     , a few networks
    </span>
    <a id="_idIndexMarker323">
    </a>
    <span class="koboSpan" id="kobo.732.1">
     should exist and be prepared in advance.
    </span>
    <span class="koboSpan" id="kobo.732.2">
     Preparing the physical networking beforehand is essential as part of the extension of the production layout in the next iterations.
    </span>
    <span class="koboSpan" id="kobo.732.3">
     The proposed standard networks in our initial draft include management, tenant, storage, and external networks connecting different nodes in our initial
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.733.1">
      cluster layout.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.734.1">
     The following interfaces will
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.735.1">
      be considered:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.736.1">
       eth0
      </span>
     </strong>
     <span class="koboSpan" id="kobo.737.1">
      : The
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.738.1">
       management interface
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.739.1">
       eth1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.740.1">
      : The overlay and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.741.1">
       tenant interface
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.742.1">
       eth2
      </span>
     </strong>
     <span class="koboSpan" id="kobo.743.1">
      : The
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.744.1">
       external interface
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.745.1">
       eth3
      </span>
     </strong>
     <span class="koboSpan" id="kobo.746.1">
      : The
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.747.1">
       storage interface
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.748.1">
     As shown in the following diagram, four distinct types of traffic are considered for the OpenStack networking setup, including management, tenant and overlay, storage, and external.
    </span>
    <span class="koboSpan" id="kobo.748.2">
     Note that a network node is dedicated to managing various OpenStack networking services that would increase the performance with fewer chances of network saturation at the cloud controller
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.749.1">
      node level:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer050">
     <span class="koboSpan" id="kobo.750.1">
      <img alt="Figure 3.6 – Physical network segmentation layout" src="image/B21716_03_06.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.751.1">
     Figure 3.6 – Physical network segmentation layout
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.752.1">
     At the switching layer, networks are organized logically through the VLANs, where each network
    </span>
    <a id="_idIndexMarker324">
    </a>
    <span class="koboSpan" id="kobo.753.1">
     is assigned a VLAN ID coupled with the assigned network IP subnetwork address pool.
    </span>
    <span class="koboSpan" id="kobo.753.2">
     The following table provides an example of initial network mapping given a reserved IP pool
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.754.1">
      of
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.755.1">
       10.0.0.0/8
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.756.1">
      :
     </span>
    </span>
   </p>
   <table class="No-Table-Style _idGenTablePara-1" id="table001-3">
    <colgroup>
     <col/>
     <col/>
     <col/>
    </colgroup>
    <tbody>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.757.1">
           Network name
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.758.1">
           IP Pool
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.759.1">
           VLAN ID
          </span>
         </strong>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.760.1">
          Management
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.761.1">
           10.0.0.0/24
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.762.1">
           100
          </span>
         </strong>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.763.1">
         Overlay
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.764.1">
          and tenant
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.765.1">
           10.10.0.0/24
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.766.1">
           200
          </span>
         </strong>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.767.1">
          External
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.768.1">
           10.20.0.0/24
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.769.1">
           300
          </span>
         </strong>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.770.1">
          Storage
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.771.1">
           10.30.0.0/24
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.772.1">
           400
          </span>
         </strong>
        </span>
       </p>
      </td>
     </tr>
    </tbody>
   </table>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.773.1">
     Table 3.1 – The OpenStack network IP addresses
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.774.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.775.1">
     When managing OpenStack packages internally, the management interface does not require outbound access to the external network to reach the internet to download packages.
    </span>
    <span class="koboSpan" id="kobo.775.2">
     The deployer instance can be connected to the management network within the same VLAN to install the required packages directly.
    </span>
    <span class="koboSpan" id="kobo.775.3">
     External network access can be limited to the deployer instance and tenant network for future instances of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.776.1">
      external access.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.777.1">
     As we are dealing with OpenStack services running in Docker containers, it is essential to take the
    </span>
    <a id="_idIndexMarker325">
    </a>
    <span class="koboSpan" id="kobo.778.1">
     created virtual network components under the hood into consideration.
    </span>
    <span class="koboSpan" id="kobo.778.2">
     Once the OpenStack environment is deployed, Kolla will use the Neutron networking model to create a few bridges, ports, and namespaces across each node in the cluster.
    </span>
    <span class="koboSpan" id="kobo.778.3">
     As we will see in the next configuration section, Kolla maps each network interface to a Neutron physical network denoted as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.779.1">
      physnet
     </span>
    </strong>
    <span class="koboSpan" id="kobo.780.1">
     .
    </span>
    <span class="koboSpan" id="kobo.780.2">
     Each container bridge created by Neutron is defined in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.781.1">
      neutron_bridge_name
     </span>
    </strong>
    <span class="koboSpan" id="kobo.782.1">
     stanza code configuration to set the default Kolla naming convention stated as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.783.1">
      br_ex
     </span>
    </strong>
    <span class="koboSpan" id="kobo.784.1">
     .
    </span>
    <span class="koboSpan" id="kobo.784.2">
     As mentioned earlier, the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.785.1">
      kolla-ansible
     </span>
    </strong>
    <span class="koboSpan" id="kobo.786.1">
     deployment mode is highly customizable, so we can assign meaningful names for each bridge mapped to each network
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.787.1">
      interface, respectively.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.788.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.789.1">
     The assigned network interface will be used by Neutron to access the public network to allow tenants to create routers and assign floating IPs to workloads requiring internet access defined in the Kolla
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.790.1">
      /etc/kolla/gloabls.yml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.791.1">
     configuration file by assigning the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.792.1">
      neutron_external_interface
     </span>
    </strong>
    <span class="koboSpan" id="kobo.793.1">
     setting to the dedicated interface,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.794.1">
      eth2
     </span>
    </strong>
    <span class="koboSpan" id="kobo.795.1">
     , on the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.796.1">
      compute node.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.797.1">
     The network bonding layout is highly recommended to be configured in advance for each host.
    </span>
    <span class="koboSpan" id="kobo.797.2">
     As discussed earlier, the bonding configuration depends on the tools and running software when using Linux as an operating system that varies from one distribution to another.
    </span>
    <span class="koboSpan" id="kobo.797.3">
     Commonly used bonding configurations are the native Linux bonds and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.798.1">
      Open vSwitch.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.799.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.800.1">
     Bonding
    </span>
    <a id="_idIndexMarker326">
    </a>
    <span class="koboSpan" id="kobo.801.1">
     configuration is out of the scope of this book.
    </span>
    <span class="koboSpan" id="kobo.801.2">
     A good source of bonding configuration for Ubuntu using the kernel module can be found
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.802.1">
      here:
     </span>
    </span>
    <a href="https://help.ubuntu.com/community/UbuntuBonding ">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.803.1">
       https://help.ubuntu.com/community/UbuntuBonding
      </span>
     </span>
    </a>
   </p>
   <h2 id="_idParaDest-73">
    <a id="_idTextAnchor118">
    </a>
    <span class="koboSpan" id="kobo.804.1">
     Listing the cluster specs
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.805.1">
     The initial
    </span>
    <a id="_idIndexMarker327">
    </a>
    <span class="koboSpan" id="kobo.806.1">
     draft of the physical layout in
    </span>
    <a href="B21716_01.xhtml#_idTextAnchor014">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.807.1">
        Chapter 1
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.808.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.809.1">
      Revisiting OpenStack – Design Consideration
     </span>
    </em>
    <span class="koboSpan" id="kobo.810.1">
     , can be considered as a starting point to pick up our hardware specs for each host.
    </span>
    <span class="koboSpan" id="kobo.810.2">
     With slight differences between host roles, the following table summarizes a typical production hardware and software setup for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.811.1">
      each host:
     </span>
    </span>
   </p>
   <table class="No-Table-Style _idGenTablePara-1" id="table002-1">
    <colgroup>
     <col/>
     <col/>
     <col/>
     <col/>
     <col/>
     <col/>
     <col/>
    </colgroup>
    <tbody>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.812.1">
           Hostname
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <strong class="bold">
         <span class="koboSpan" id="kobo.813.1">
          CPU
         </span>
        </strong>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.814.1">
           cores
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.815.1">
           RAM
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.816.1">
           Disk
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.817.1">
           Network
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.818.1">
           Software
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.819.1">
           Role
          </span>
         </strong>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.820.1">
           cc01.os
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.821.1">
         8
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.822.1">
          128 GB
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.823.1">
          250 GB
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.824.1">
         4 x
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.825.1">
          10 GB
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.826.1">
         Ubuntu 22 LTS, OpenSSH, Python 2.7 or greater,
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.827.1">
          NTP client
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.828.1">
         Cloud
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.829.1">
          controller
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.830.1">
           cn01.os
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.831.1">
          12
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.832.1">
          240 GB
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.833.1">
          500 GB
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.834.1">
         4 x
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.835.1">
          10 GB
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.836.1">
         Ubuntu 22 LTS, OpenSSH, Python 2.7 or greater,
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.837.1">
          NTP client
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.838.1">
         Compute
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.839.1">
          node
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.840.1">
           net01.os
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.841.1">
         4
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.842.1">
          32 GB
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.843.1">
          250 GB
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.844.1">
         4 x
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.845.1">
          10 GB
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.846.1">
         Ubuntu 22 LTS, OpenSSH, Python2.7 or greater,
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.847.1">
          NTP client
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.848.1">
         Network
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.849.1">
          node
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.850.1">
           storage01.os
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.851.1">
         4
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.852.1">
          32 GB
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.853.1">
          1 TB
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.854.1">
          4x10 GB
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.855.1">
         Ubuntu 22 LTS, OpenSSH, python2.7 or greater,
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.856.1">
          NTP client
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.857.1">
         Storage
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.858.1">
          Node
         </span>
        </span>
       </p>
      </td>
     </tr>
    </tbody>
   </table>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.859.1">
     Table 3.2 – OpenStack hosts configurations
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.860.1">
     Note that OpenStack is designed to run on commodity hardware.
    </span>
    <span class="koboSpan" id="kobo.860.2">
     The table did not mention
    </span>
    <a id="_idIndexMarker328">
    </a>
    <span class="koboSpan" id="kobo.861.1">
     any precise hardware model that would depend on the set budget and resources to kick off a first setup.
    </span>
    <span class="koboSpan" id="kobo.861.2">
     As we planned, in the first chapter, to accommodate 200 instances with the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.862.1">
      small
     </span>
    </em>
    <span class="koboSpan" id="kobo.863.1">
     flavor during our first deployment, the production setup should be capable of being expanded with more hardware and scale horizontally for each layer of the OpenStack
    </span>
    <a id="_idIndexMarker329">
    </a>
    <span class="koboSpan" id="kobo.864.1">
     ecosystem.
    </span>
    <span class="koboSpan" id="kobo.864.2">
     The
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.865.1">
      undercloud
     </span>
    </strong>
    <span class="koboSpan" id="kobo.866.1">
     monitoring tools should regularly gather data on the performance and usage of each node to help in deciding the right sizing and additional resources needed to be plugged in.
    </span>
    <span class="koboSpan" id="kobo.866.2">
     The first hosts and hardware listings should not welcome any production workload before arming the cluster with a layer of redundancy that will be discussed in detail in
    </span>
    <a href="B21716_07.xhtml#_idTextAnchor174">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.867.1">
        Chapter 7
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.868.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.869.1">
      Running a Highly Available Cloud – Meeting
     </span>
    </em>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.870.1">
       the SLA
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.871.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-74">
    <a id="_idTextAnchor119">
    </a>
    <span class="koboSpan" id="kobo.872.1">
     Preparing the infrastructure code
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.873.1">
     Using
    </span>
    <a id="_idIndexMarker330">
    </a>
    <span class="koboSpan" id="kobo.874.1">
     the same
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.875.1">
      kolla-ansible
     </span>
    </strong>
    <span class="koboSpan" id="kobo.876.1">
     repository, we can customize the setup of different OpenStack services, including the control plane services, in the same way as highlighted in
    </span>
    <a href="B21716_02.xhtml#_idTextAnchor089">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.877.1">
        Chapter 2
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.878.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.879.1">
      Kicking Off the OpenStack Setup – The Right
     </span>
    </em>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.880.1">
       Way (DevSecOps)
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.881.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.882.1">
     As a best practice, use a separate branch before merging to master and then start the deployment into the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.883.1">
      production environment.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-75">
    <a id="_idTextAnchor120">
    </a>
    <span class="koboSpan" id="kobo.884.1">
     Configuring the host groups
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.885.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.886.1">
      kolla-ansible
     </span>
    </strong>
    <span class="koboSpan" id="kobo.887.1">
     infrastructure code defines the target hosts and associated parameters
    </span>
    <a id="_idIndexMarker331">
    </a>
    <span class="koboSpan" id="kobo.888.1">
     such as hostnames and network IP addresses in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.889.1">
      /ansible/inventory
     </span>
    </strong>
    <span class="koboSpan" id="kobo.890.1">
     directory.
    </span>
    <span class="koboSpan" id="kobo.890.2">
     The listing of host groups can be customized based on roles associated with the initial draft.
    </span>
    <span class="koboSpan" id="kobo.890.3">
     The format of an inventory file is straightforward as highlighted in
    </span>
    <a href="B21716_02.xhtml#_idTextAnchor089">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.891.1">
        Chapter 2
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.892.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.893.1">
      Kicking Off the OpenStack Setup – The Right Way (DevSecOps)
     </span>
    </em>
    <span class="koboSpan" id="kobo.894.1">
     .
    </span>
    <span class="koboSpan" id="kobo.894.2">
     The following table defines the different host groups in our next
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.895.1">
      deployment iterations:
     </span>
    </span>
   </p>
   <table class="No-Table-Style _idGenTablePara-1" id="table003-1">
    <colgroup>
     <col/>
     <col/>
    </colgroup>
    <tbody>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <strong class="bold">
         <span class="koboSpan" id="kobo.896.1">
          OpenStack Kolla – Ansible
         </span>
        </strong>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.897.1">
           host groups
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <strong class="bold">
         <span class="koboSpan" id="kobo.898.1">
          OpenStack
         </span>
        </strong>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.899.1">
           node role
          </span>
         </strong>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.900.1">
           control
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.901.1">
         Runs most of the OpenStack control plane, including core service APIs, database, and messaging
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.902.1">
          queue services
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.903.1">
           compute
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.904.1">
         Hosts running the
        </span>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.905.1">
           nova-compute
          </span>
         </strong>
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.906.1">
          service
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.907.1">
           network
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.908.1">
         Dedicated to network nodes running Neutron plugins
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.909.1">
          and agents
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.910.1">
           haproxy
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.911.1">
         Target hosts
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.912.1">
          running HAProxy
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.913.1">
           storage
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.914.1">
         Runs the Cinder
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.915.1">
          volume service
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.916.1">
           monitoring
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.917.1">
         Dedicated host(s) for monitoring OpenStack servers running Prometheus
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.918.1">
          and Grafana
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.919.1">
           logging
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.920.1">
         Runs and processes logs for different
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.921.1">
          OpenStack services
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.922.1">
           deployment
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.923.1">
         Runs the deployment of the infrastructure code using Ansible
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.924.1">
          and Kolla
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.925.1">
           object
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.926.1">
         Runs the Swift object storage
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.927.1">
          server’s instances
         </span>
        </span>
       </p>
      </td>
     </tr>
    </tbody>
   </table>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.928.1">
     Table 3.3 – OpenStack Ansible host groups
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.929.1">
     The inventory file is highly customizable and can be adapted to your needs depending on whether
    </span>
    <a id="_idIndexMarker332">
    </a>
    <span class="koboSpan" id="kobo.930.1">
     you need to accommodate different services in a new role or separate more core services in dedicated hosts.
    </span>
    <span class="koboSpan" id="kobo.930.2">
     Our next step will consider the deployment of a multi-node setup, including one dedicated host for each cloud controller, compute, storage, and network role, respectively.
    </span>
    <span class="koboSpan" id="kobo.930.3">
     This deployment should not be counted as production-ready as each role will be deployed in a single node that does not yet meet the high-availability aspect.
    </span>
    <span class="koboSpan" id="kobo.930.4">
     We will cover high availability and fault tolerance in OpenStack deployment in
    </span>
    <a href="B21716_07.xhtml#_idTextAnchor174">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.931.1">
        Chapter 7
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.932.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.933.1">
      Running a Highly Available Cloud – Meeting
     </span>
    </em>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.934.1">
       the SLA
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.935.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.936.1">
     Starting with the source of truth, the deployer node where the CI/CD chain lives, create a new branch dedicated to a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.937.1">
      staging environment:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.938.1">
$ git branch staging</span></pre>
   <p>
    <span class="koboSpan" id="kobo.939.1">
     Create a new file named
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.940.1">
      multi_packtpub_prod
     </span>
    </strong>
    <span class="koboSpan" id="kobo.941.1">
     in the cloned repository,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.942.1">
      /ansible/inventory
     </span>
    </strong>
    <span class="koboSpan" id="kobo.943.1">
     .
    </span>
    <span class="koboSpan" id="kobo.943.2">
     A simple way to assign different host groups from a default multi-node configuration file can be found in the same directory,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.944.1">
      /ansible/inventory
     </span>
    </strong>
    <span class="koboSpan" id="kobo.945.1">
     ,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.946.1">
      named
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.947.1">
       multinode
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.948.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.949.1">
     The
    </span>
    <a id="_idIndexMarker333">
    </a>
    <span class="koboSpan" id="kobo.950.1">
     configuration for each host group is formatted
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.951.1">
      as follows:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.952.1">
[role_name1]
Hostname01
Hostname02
…
[role_name2]
Hostname03
Hostname04
…</span></pre>
   <p>
    <span class="koboSpan" id="kobo.953.1">
     The inventory file can be customized in different ways by assigning explicitly a single or several OpenStack services to run on specific hosts.
    </span>
    <span class="koboSpan" id="kobo.953.2">
     That can be accomplished by adding the following
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.954.1">
      configuration stanza:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.955.1">
[service_name:children]
Hostname</span></pre>
   <p>
    <span class="koboSpan" id="kobo.956.1">
     For example, the following configuration instructs
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.957.1">
      kolla-ansible
     </span>
    </strong>
    <span class="koboSpan" id="kobo.958.1">
     to install the Swift service on the cloud control node group assigned
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.959.1">
      as control:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.960.1">
[swift:children]
control</span></pre>
   <p>
    <span class="koboSpan" id="kobo.961.1">
     The previous configuration stanza will install and run all Swift components in the control host group.
    </span>
    <span class="koboSpan" id="kobo.961.2">
     With a more granular configuration, it is possible to instruct which component will be installed in which host.
    </span>
    <span class="koboSpan" id="kobo.961.3">
     If none is mentioned, the service will be installed
    </span>
    <a id="_idIndexMarker334">
    </a>
    <span class="koboSpan" id="kobo.962.1">
     in the control host group.
    </span>
    <span class="koboSpan" id="kobo.962.2">
     The next example instructs
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.963.1">
      kolla-ansible
     </span>
    </strong>
    <span class="koboSpan" id="kobo.964.1">
     to install other components rather than
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.965.1">
      swift-proxy-server
     </span>
    </strong>
    <span class="koboSpan" id="kobo.966.1">
     in the host group referenced
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.967.1">
      as
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.968.1">
       object_storage
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.969.1">
      :
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.970.1">
[swift-proxy-server:children]
swift
[swift-account-server:children]
object_storage
[swift-container-server:children]
object_storage
[swift-object-server:children]
object_storage</span></pre>
   <p>
    <span class="koboSpan" id="kobo.971.1">
     For our next iteration, the inventory section pointing to the shared services such as the database caching layer and messaging queue is
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.972.1">
      as follows:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.973.1">
[control]
cc01.os.packtpub
[mariadb:children]
control
[rabbitmq:children]
control
[outward-rabbitmq:children]
control
[memcached:children]
control</span></pre>
   <p>
    <span class="koboSpan" id="kobo.974.1">
     Core control
    </span>
    <a id="_idIndexMarker335">
    </a>
    <span class="koboSpan" id="kobo.975.1">
     plane services will be running on the cloud controller host group,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.976.1">
      as follows:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.977.1">
…
[keystone:children]
control
[glance:children]
control
[nova:children]
control
[placement:children]
control
[cinder:children]
control
[neutron-server:children]
control
[horizon:children]
control
[swift:children]
control
[manila:children]
control
[ceilometer:children]
control</span></pre>
   <p>
    <span class="koboSpan" id="kobo.978.1">
     More
    </span>
    <a id="_idIndexMarker336">
    </a>
    <span class="koboSpan" id="kobo.979.1">
     granular shared and control plane service configurations can be customized per service,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.980.1">
      as follows:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.981.1">
      For the image service, Glance can be configured
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.982.1">
       as follows:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.983.1">
..
</span><span class="koboSpan" id="kobo.983.2">[glance-api:children]
glance</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.984.1">
      All compute components except
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.985.1">
       nova-compute
      </span>
     </strong>
     <span class="koboSpan" id="kobo.986.1">
      can be configured
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.987.1">
       as follows:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.988.1">
[nova-api:children]
nova
[nova-conductor:children]
nova
[nova-super-conductor:children]
nova
[nova-novncproxy:children]
nova
[nova-scheduler:children]
nova
[nova-spicehtml5proxy:children]
nova
[nova-compute-ironic:children]
nova
[nova-serialproxy:children]
nova</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.989.1">
      The Placement service API can be configured
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.990.1">
       as follows:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.991.1">
[placement-api:children]
placement</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.992.1">
      The
     </span>
     <a id="_idIndexMarker337">
     </a>
     <span class="koboSpan" id="kobo.993.1">
      block storage API and volume scheduler service can be configured
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.994.1">
       as follows:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.995.1">
[cinder-api:children]
cinder
[cinder-scheduler:children]
cinder</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.996.1">
      The object storage proxy component can be configured
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.997.1">
       as follows:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.998.1">
[swift-proxy-server:children]
swift</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.999.1">
      The telemetry core and notification components can be configured
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1000.1">
       as follows:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1001.1">
[ceilometer-central:children]
ceilometer
[ceilometer-notification:children]
ceilometer</span></pre>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.1002.1">
     The shared services and control plane sections can be defined in different ways.
    </span>
    <span class="koboSpan" id="kobo.1002.2">
     More services and components would inherit the same configuration once the design of a new project has been drafted to run in the cloud controller nodes.
    </span>
    <span class="koboSpan" id="kobo.1002.3">
     As we are not covering all services in this chapter, we will stick to our second iteration defined earlier and more control plane services will be added throughout the next chapters of the book.
    </span>
    <span class="koboSpan" id="kobo.1002.4">
     The inventory file will be the source of truth that identifies the latest version of the services running in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1003.1">
      the environment.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1004.1">
     The
    </span>
    <a id="_idIndexMarker338">
    </a>
    <span class="koboSpan" id="kobo.1005.1">
     next class of the inventory section defines the compute target nodes and the respective components they will
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1006.1">
      be running:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1007.1">
…
[compute]
cn01.os.packtpub</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1008.1">
     Optionally, as each compute node would require the collection of metrics for further monitoring,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1009.1">
      collectd
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1010.1">
     will run on the compute host group in addition to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1011.1">
      ceilometer-compute
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1012.1">
     and
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1013.1">
       ipmi
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1014.1">
      components:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1015.1">
[collectd:children]
compute
[ceilometer-compute:children]
compute
[ceilometer-ipmi:children]
compute</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1016.1">
     As each compute node would interconnect with other nodes to serve tenant networks, a few Neutron agents, as designed in the previous section, will be running on the compute
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1017.1">
      host group:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1018.1">
[ovn-controller-compute:children]
compute
[neutron-ovn-agent:children]
compute</span></pre>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.1019.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.1020.1">
     OVN will be discussed in detail in
    </span>
    <a href="B21716_05.xhtml#_idTextAnchor146">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1021.1">
        Chapter 5
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.1022.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1023.1">
      OpenStack Networking – Connectivity and Managed Service Options
     </span>
    </em>
    <span class="koboSpan" id="kobo.1024.1">
     , as being the most commonly used networking service in OpenStack within the latest releases,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1025.1">
      including Antelope.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1026.1">
     The
    </span>
    <a id="_idIndexMarker339">
    </a>
    <span class="koboSpan" id="kobo.1027.1">
     OpenStack networking service is designed to run on its own host, except for its API, as part of the cloud control plane.
    </span>
    <span class="koboSpan" id="kobo.1027.2">
     The following code defines the Network node and associated components in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1028.1">
      inventory file:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1029.1">
[network]
net01.os.packtpub
[neutron:children]
network</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1030.1">
     All Neutron services and agents except for its API will run on the network node,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1031.1">
      as follows:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1032.1">
[neutron-dhcp-agent:children]
neutron
[neutron-l3-agent:children]
neutron
[neutron-metadata-agent:children]
neutron
[neutron-ovn-metadata-agent:children]
network
[neutron-bgp-dragent:children]
neutron
[neutron-infoblox-ipam-agent:children]
neutron
[neutron-metering-agent:children]
neutron
[ironic-neutron-agent:children]
neutron
[neutron-ovn-agent:children]
network</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1033.1">
     Additionally, the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1034.1">
      manila-share
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1035.1">
     component will run on the network host group that will use the Neutron plugin to provide network access to the file
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1036.1">
      share resources:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1037.1">
[manila-share:children]
network</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1038.1">
     The
    </span>
    <a id="_idIndexMarker340">
    </a>
    <span class="koboSpan" id="kobo.1039.1">
     OVN controller was configured to run on the compute node as well as in the network host group,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1040.1">
      as follows:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1041.1">
[ovn-controller:children]
ovn-controller-compute
ovn-controller-network</span></pre>
   <p>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1042.1">
      ovn-controller-network
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1043.1">
     inherits the association with network
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1044.1">
      host groups:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1045.1">
[ovn-controller-network:children]
network</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1046.1">
     Note that the OVN mechanism uses its own database that can run on the cloud controller
    </span>
    <a id="_idIndexMarker341">
    </a>
    <span class="koboSpan" id="kobo.1047.1">
     host group.
    </span>
    <span class="koboSpan" id="kobo.1047.2">
     The OVN database itself supports three different schemas that can be running on the same cloud controller host group,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1048.1">
      as follows:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1049.1">
[ovn-database:children]
control
[ovn-northd:children]
ovn-database
[ovn-nb-db:children]
ovn-database
[ovn-sb-db:children]
ovn-database</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1050.1">
     The next stanza of the inventory is the storage layer in which initially, a single storage node will
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1051.1">
      be defined:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1052.1">
[storage]
storage01.os.packtpub</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1053.1">
     The storage node will run the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1054.1">
      Cinder volume:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1055.1">
[cinder-volume:children]
storage</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1056.1">
     The last part of the inventory file includes the deployer host itself, defined
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1057.1">
      as localhost:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1058.1">
[deployment]
localhost       ansible_connection=local</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1059.1">
     Other services can be counted as additional services to install if you count running a custom
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1060.1">
      Zabbix agent
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1061.1">
     , for example, in all nodes or specific scanning tools reporting to a central hub.
    </span>
    <span class="koboSpan" id="kobo.1061.2">
     A simple way to do this is by creating a new stanza referring to all host groups
    </span>
    <a id="_idIndexMarker342">
    </a>
    <span class="koboSpan" id="kobo.1062.1">
     defined in the inventory.
    </span>
    <span class="koboSpan" id="kobo.1062.2">
     For example, the following code section instructs Ansible to install a few tools, such as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1063.1">
      cron
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1064.1">
     , and services to manage and collect
    </span>
    <a id="_idIndexMarker343">
    </a>
    <span class="koboSpan" id="kobo.1065.1">
     logs using
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1066.1">
      fluentd
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1067.1">
     for Kolla containers running our OpenStack services.
    </span>
    <span class="koboSpan" id="kobo.1067.2">
     Optionally,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1068.1">
      kolla-ansible
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1069.1">
     comes with
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1070.1">
      kolla-toolbox
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1071.1">
     to quickly run specific command lines in a Docker container
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1072.1">
      once installed:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1073.1">
[common:children]
control
network
compute
storage
[cron:children]
common
[fluentd:children]
common
[kolla-logs:children]
common
[kolla-toolbox:children]
common</span></pre>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.1074.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.1075.1">
     In a multi-node setup, make sure that the deployer machine can reach all other hosts to run the Ansible playbooks.
    </span>
    <span class="koboSpan" id="kobo.1075.2">
     It is possible to specify in the inventory file how Ansible should interact with each target host.
    </span>
    <span class="koboSpan" id="kobo.1075.3">
     In the current setup, SSH keys have been generated and pushed to each target host to run Ansible against during the deployment.
    </span>
    <span class="koboSpan" id="kobo.1075.4">
     Bear in mind that hostnames should be propagated in
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1076.1">
      /etc/hosts
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1077.1">
     in each node if IP addresses are not used in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1078.1">
      inventory file.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1079.1">
     Save
    </span>
    <a id="_idIndexMarker344">
    </a>
    <span class="koboSpan" id="kobo.1080.1">
     the file, commit it, and push it to the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1081.1">
      created branch:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.1082.1">
$ git add multi_packtpub_stg
$ git commit -m 'Multi Node Inventory - Staging'
$ git push --set-upstream origin staging</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1083.1">
     Once the host mapping and branching configuration are properly done, it is time to dive deep into the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1084.1">
      kolla-ansible
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1085.1">
     code and customize the future OpenStack parameters for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1086.1">
      different services.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-76">
    <a id="_idTextAnchor121">
    </a>
    <span class="koboSpan" id="kobo.1087.1">
     Parameterizing the environment
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1088.1">
     The next key file is the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1089.1">
      globals.yml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1090.1">
     configuration file defined in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1091.1">
      /etc/kolla/
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1092.1">
     directory.
    </span>
    <span class="koboSpan" id="kobo.1092.2">
     This file acts as the central configuration hub for all OpenStack environments.
    </span>
    <span class="koboSpan" id="kobo.1092.3">
     The default
    </span>
    <a id="_idIndexMarker345">
    </a>
    <span class="koboSpan" id="kobo.1093.1">
     file that comes with the community
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1094.1">
      kolla-ansible
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1095.1">
     repository defines most of the OpenStack services configuration for each service option.
    </span>
    <span class="koboSpan" id="kobo.1095.2">
     You can copy and comment out the desired configuration line or generate a new one holding the OpenStack
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1096.1">
      configuration settings.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1097.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1098.1">
      globals.yml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1099.1">
     file in the current iteration includes the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1100.1">
      following configurations:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1101.1">
      Use Ubuntu as the Kolla base
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1102.1">
       container distribution:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1103.1">
kolla_base_distro: "ubuntu"</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1104.1">
      Install the latest stable
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1105.1">
       OpenStack release:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1106.1">
openstack_release: "master"</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1107.1">
      Assign an unused default VIP to one
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1108.1">
       controller interface:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1109.1">
kolla_internal_vip_address: "10.0.0.47"</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1110.1">
      Use KVM as the default
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1111.1">
       hypervisor driver:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1112.1">
nova_compute_virt_type: "kvm"</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1113.1">
      Use the Neutron Open
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1114.1">
       vSwitch plugin:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1115.1">
neutron_plugin_agent: "openvswitch"</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1116.1">
      Enable
     </span>
     <a id="_idIndexMarker346">
     </a>
     <span class="koboSpan" id="kobo.1117.1">
      Neutron
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1118.1">
       provider networks:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1119.1">
enable_neutron_provider_networks: "yes"</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1120.1">
      Assign a network interface for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1121.1">
       API services:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1122.1">
network_interface: "eth0"</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1123.1">
      Assign a network interface for the Neutron
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1124.1">
       external port:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1125.1">
neutron_external_interface: "eth1"</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1126.1">
      Use the local Docker registry as created in
     </span>
     <a href="B21716_02.xhtml#_idTextAnchor089">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.1127.1">
         Chapter 2
        </span>
       </em>
      </span>
     </a>
     <span class="koboSpan" id="kobo.1128.1">
      ,
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1129.1">
       Kicking Off the OpenStack Setup – The Right
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1130.1">
        Way (DevSecOps)
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1131.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1132.1">
docker_registry: "docker-registry:4000"</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1133.1">
      Save the file, commit, and push it to the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1134.1">
       created branch:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1135.1">$ git add multi_packtpub_stg</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1136.1">$ git commit -m 'Multi Node Global Configuration - Staging'</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1137.1">$ git push staging</span></strong></pre>
    </li>
   </ul>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.1138.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.1139.1">
     Some configuration parameters in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1140.1">
      kolla-ansible
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1141.1">
     community repository might be
    </span>
    <a id="_idIndexMarker347">
    </a>
    <span class="koboSpan" id="kobo.1142.1">
     updated from one OpenStack release to another, such as new configuration parameters in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1143.1">
      globals.yml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1144.1">
     file or the repository structure itself.
    </span>
    <span class="koboSpan" id="kobo.1144.2">
     It is highly encouraged to cast an eye on the repository documentation before deploying a specific release.
    </span>
    <span class="koboSpan" id="kobo.1144.3">
     The book uses the latest stable release.
    </span>
    <span class="koboSpan" id="kobo.1144.4">
     Make sure to check the branch name and its relevant tags for the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1145.1">
      first pull.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-77">
    <a id="_idTextAnchor122">
    </a>
    <span class="koboSpan" id="kobo.1146.1">
     Advanced configuration
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1147.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1148.1">
      globals.yml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1149.1">
     file does not provide all granular configuration settings by default.
    </span>
    <span class="koboSpan" id="kobo.1149.2">
     For example, the maximum connections of HAProxy and the maximum amount of memory
    </span>
    <a id="_idIndexMarker348">
    </a>
    <span class="koboSpan" id="kobo.1150.1">
     of a Memcached instance are more specific settings that cannot be directly adjusted in the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1151.1">
       globals.yml
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1152.1">
      file.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1153.1">
     One way of conducting more advanced configuration in an OpenStack production environment is by going through the Ansible playbooks.
    </span>
    <span class="koboSpan" id="kobo.1153.2">
     Keep in mind that the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1154.1">
      globals.yml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1155.1">
     file is a high-level representation on how to deploy an OpenStack environment from one single
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1156.1">
      hub file.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1157.1">
     There are three different levels of configuring an OpenStack deployment using
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1158.1">
      kolla-ansible
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1159.1">
     , in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1160.1">
      following order:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1161.1">
       /etc/kolla/globals.yml
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1162.1">
      : This is the first hub of generic and custom OpenStack, including shared
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1163.1">
       services settings.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1164.1">
       /kolla-ansible/ansible/group_vars/all.yml
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1165.1">
      : This reflects the global and specific settings of the OpenStack services.
     </span>
     <span class="koboSpan" id="kobo.1165.2">
      Once they are edited and running, the settings in the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1166.1">
       all.yml
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1167.1">
      file will be merged with the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1168.1">
       globals.yml
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1169.1">
      file.
     </span>
     <span class="koboSpan" id="kobo.1169.2">
      Settings that are not declared explicitly in the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1170.1">
       globals.yml
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1171.1">
      file will use the default ones
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1172.1">
       in
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1173.1">
        all.yml
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1174.1">
       .
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1175.1">
       Ansible playbooks
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1176.1">
      : Few cases would require the introduction of an advanced configuration in a specific service.
     </span>
     <span class="koboSpan" id="kobo.1176.2">
      Each Ansible playbook should include all available options for a given service or component.
     </span>
     <span class="koboSpan" id="kobo.1176.3">
      Ansible playbooks are located under
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1177.1">
       /kolla-ansible/ansible/roles
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1178.1">
      , where each OpenStack component
     </span>
     <a id="_idIndexMarker349">
     </a>
     <span class="koboSpan" id="kobo.1179.1">
      and shared service available within Antelope and later releases are listed.
     </span>
     <span class="koboSpan" id="kobo.1179.2">
      As highlighted in
     </span>
     <a href="B21716_02.xhtml#_idTextAnchor089">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.1180.1">
         Chapter 2
        </span>
       </em>
      </span>
     </a>
     <span class="koboSpan" id="kobo.1181.1">
      ,
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1182.1">
       Kicking Off the OpenStack Setup – The Right Way (DevSecOps)
      </span>
     </em>
     <span class="koboSpan" id="kobo.1183.1">
      ,in the discussion of how an Ansible playbook is constructed, adjusting a setting for a specific service is straightforward.
     </span>
     <span class="koboSpan" id="kobo.1183.2">
      For example, changing the maximum amount of memory in Memcached can be performed by simply updating the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1184.1">
       memcached_max_memory
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1185.1">
      configuration stanza in the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1186.1">
       main.yml
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1187.1">
      file located under the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1188.1">
       /
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1189.1">
        roles/memcached/defaults/
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1190.1">
       folder.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.1191.1">
     Customizing the control plane configuration is pretty straightforward by simply looking at the Ansible role and playbook for a given OpenStack core service.
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1192.1">
      /kolla-ansible/ansible/roles/
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1193.1">
     includes all sets of OpenStack core services and other projects officially incubated within the latest stable release.
    </span>
    <span class="koboSpan" id="kobo.1193.2">
     Note that there is a direct way of reflecting a playbook setting in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1194.1">
      globals.yml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1195.1">
     or
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1196.1">
       all.yml
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1197.1">
      file.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-78">
    <a id="_idTextAnchor123">
    </a>
    <span class="koboSpan" id="kobo.1198.1">
     Deploying the environment
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1199.1">
     Dedicating a staging environment to run deployments before running in production is one
    </span>
    <a id="_idIndexMarker350">
    </a>
    <span class="koboSpan" id="kobo.1200.1">
     of the development pillars that is most touted in discussions about code and artifact release stability.
    </span>
    <span class="koboSpan" id="kobo.1200.2">
     There is always a temptation to skip a second environment such as staging when deploying code, especially with resource-hungry environments such as OpenStack.
    </span>
    <span class="koboSpan" id="kobo.1200.3">
     Staging can be expensive, but thinking of the outcome provides a boost of confidence to mimic a production environment before merging that code to the master branch.
    </span>
    <span class="koboSpan" id="kobo.1200.4">
     A common solution to the cost challenge if you are not able to afford an exact copy of the production setup is to use a smaller version of the production environment but keep the same
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1201.1">
      design layout.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1202.1">
     In the
    </span>
    <a id="_idIndexMarker351">
    </a>
    <span class="koboSpan" id="kobo.1203.1">
     following snippet, all required steps will be automated through a Jenkins pipeline targeting the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1204.1">
      multi_packtpub_stg
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1205.1">
     branch.
    </span>
    <span class="koboSpan" id="kobo.1205.2">
     To do so, create a new Jenkins file targeting the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1206.1">
      staging branch:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1207.1">
pipeline {
  agent any
  stages {
    stage('Setup Local Environment') {
      steps {
        echo '--RUNNING LOCAL ENVIORNMENT --'
        sh ''' #!/bin/bash 
        sudo apt-get update
        sudo apt-get install \
        python3-dev libffi-dev gcc libssl-dev docker.io -y
        sudo apt install python3-pip -y
        sudo apt install python3.10-venv -y
        sudo python3 -m venv local
        source local/bin/activate
        ''' 
      }
    }
    stage('INSTALLING PIP') {
      steps {
        echo '--INSTALLING PIP --'
        sh ''' #!/bin/bash 
        pip install -U pip
        ''' 
      }
    }
    stage('INSTALLING Ansible') {
      steps {
        echo '--INSTALLING Ansible --'
        sh ''' #!/bin/bash 
        pip install 'ansible-core&gt;=2.16,&lt;2.17.99'
        ''' 
      }
    }  
    
    stage('INSTALLING Kolla Ansible') {
      steps {
        echo '--INSTALLING Kolla Ansible --'
        sh '''#!/bin/bash 
        pip install \
        git+https://git@ci.os/git/openstack_deploy/openstack_deploy
        kolla-ansible install-deps
        ''' 
      }
    } 
    stage('Preparing Infrastructure') {
      steps {
        echo '--Preparing Infrastructure Files Structure --'
        sh ''' #!/bin/bash 
        sudo mkdir -p /etc/kolla
        sudo chown $USER:$USER /etc/kolla
        cp -r /usrlocal/share/kolla-ansible/etc/kolla/* /etc/kolla/ 
        cp -r /usr/local/share/kolla-ansible/ansible/inventory/* \
        /etc/kolla/
        ''' 
      }
    }
    stage('Secrets Setup') {
      steps {
        echo '--Generating OpenStack Services Secrets --'
        sh '''#!/bin/bash 
            kolla-genpwd -p /etc/kolla/passwords.yml
           ''' 
      }
    }
    stage('Boostrap Servers') {
      steps {
        echo '--Running Ansible Kolla Boostrap Server Script --'
        sh '''#!/bin/bash 
             kolla-ansible -i /etc/kolla/multi_packtpub_prod \
             bootstrap-servers
           ''' 
      }
    }
    stage('Infrastructure Pre-Checks') {
      steps {
        echo '--Running Ansible Kolla Prechecks Script --'
        sh '''#!/bin/bash 
            kolla-ansible -i /etc/kolla/multi_packtpub_prod prechecks
           ''' 
      }
    }
    stage('Deploy Infrastructure') {
      steps {
        echo '--Running Ansible Kolla Prechecks Script --'
        sh '''#!/bin/bash 
        kolla-ansible -i /etc/kolla/multi_packtpub_prod deploy
        ''' 
      }
    }
  }
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1208.1">
     Commit
    </span>
    <a id="_idIndexMarker352">
    </a>
    <span class="koboSpan" id="kobo.1209.1">
     and push the created file to the source code repository with the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1210.1">
      new branch:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.1211.1">
$ git add Jenkinsfile
$ git commit -m 'Jenkins Staging Environment Pipeline'
$ git push staging</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1212.1">
     As demonstrated in
    </span>
    <a href="B21716_02.xhtml#_idTextAnchor089">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1213.1">
        Chapter 2
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.1214.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1215.1">
      Kicking Off the OpenStack Setup – The Right Way (DevSecOps)
     </span>
    </em>
    <span class="koboSpan" id="kobo.1216.1">
     , create a new job by selecting
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1217.1">
      New Item
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1218.1">
     from the top-left menu in the Jenkins user interface.
    </span>
    <span class="koboSpan" id="kobo.1218.2">
     Select
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1219.1">
      Pipeline
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1220.1">
     as the type of our job with a desired name for running the staging pipeline.
    </span>
    <span class="koboSpan" id="kobo.1220.2">
     Follow the same steps for the staging pipeline by specifying the path of the Jenkins file from the repository.
    </span>
    <span class="koboSpan" id="kobo.1220.3">
     Different build stages are visible as coded in the pipeline, as shown in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1221.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer051">
     <span class="koboSpan" id="kobo.1222.1">
      <img alt="Figure 3.7 – An OpenStack staging environment deployment" src="image/B21716_03_07.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1223.1">
     Figure 3.7 – An OpenStack staging environment deployment
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1224.1">
     The first build run can take longer to install the required packages and dependencies on the Jenkins server.
    </span>
    <span class="koboSpan" id="kobo.1224.2">
     Automating the deployment pipeline is very handy as orchestrating all steps from one single pipeline file reduces the time to run specific steps manually in case an
    </span>
    <a id="_idIndexMarker353">
    </a>
    <span class="koboSpan" id="kobo.1225.1">
     error occurs in one of the pipeline stages.
    </span>
    <span class="koboSpan" id="kobo.1225.2">
     A Jenkins build can be configured to pull source code on a regular basis (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1226.1">
      cron
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1227.1">
     , for example) or trigger a build when new code is pushed and merged to the development branch.
    </span>
    <span class="koboSpan" id="kobo.1227.2">
     Note that there are multiple ways to achieve more robust deployment pipelines by integrating more unit tests.
    </span>
    <span class="koboSpan" id="kobo.1227.3">
     We have, so far, built an initial deployment pipeline.
    </span>
    <span class="koboSpan" id="kobo.1227.4">
     From it, installing additional services or making changes can be performed from one single place and with more control.
    </span>
    <span class="koboSpan" id="kobo.1227.5">
     Throughout the next chapters, we will stick to the same deployment approach armed with best practices by keeping deployments in small batches, continuous,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1228.1">
      and test-driven.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-79">
    <a id="_idTextAnchor124">
    </a>
    <span class="koboSpan" id="kobo.1229.1">
     Summary
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.1230.1">
     In this chapter, we went through a cornerstone of OpenStack deployment: the control plane.
    </span>
    <span class="koboSpan" id="kobo.1230.2">
     Identifying each component role within the control plane layer supports the preparation of a highly available and scalable orchestration layer that will we cover in more detail in
    </span>
    <a href="B21716_07.xhtml#_idTextAnchor174">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1231.1">
        Chapter 7
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.1232.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1233.1">
      Running a Highly Available Cloud– Meeting the SLA
     </span>
    </em>
    <span class="koboSpan" id="kobo.1234.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1234.2">
     Some of the core services, such as Keystone, Glance, and Placement, were covered in more detail to highlight different options that your next production iteration can support through identity consolidation or an imaging backend, for example.
    </span>
    <span class="koboSpan" id="kobo.1234.3">
     Note that the control plane is not limited only to the deployed services we have explored so far in this chapter.
    </span>
    <span class="koboSpan" id="kobo.1234.4">
     The OpenStack ecosystem is still growing with additional services; hence, more APIs can be part of the control plane.
    </span>
    <span class="koboSpan" id="kobo.1234.5">
     From an architectural perspective, the Designate API can be part of the control plane and run in the same cloud controller, whereas other management components can run on a dedicated host to enhance DNS request performance in a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1235.1">
      large-scale environment.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1236.1">
     Most importantly, regardless of which option you choose, the control plane must be prepared for failure and proven to be scalable, as we learned in this chapter.
    </span>
    <span class="koboSpan" id="kobo.1236.2">
     Adding or removing a service unit within the control plane cluster should not be a disruptive operation.
    </span>
    <span class="koboSpan" id="kobo.1236.3">
     That was a valid reason to adopt a container-based deployment approach for our OpenStack production environment.
    </span>
    <span class="koboSpan" id="kobo.1236.4">
     The chapter extended the first deployment using
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1237.1">
      kolla-ansible
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1238.1">
     by going into more depth on a variety of control plane playbooks with additional possible advanced settings.
    </span>
    <span class="koboSpan" id="kobo.1238.2">
     Although the chapter did not cover the high-availability aspect of the control plane in detail, the design draft should be capable of enforcing the control plane with fault tolerance before exposing the cloud environment
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1239.1">
      for consumption.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1240.1">
     The next chapter will extend our deployment by going through the compute layer.
    </span>
    <span class="koboSpan" id="kobo.1240.2">
     As we have separated our control plane and designed only the compute API and scheduler to be part of the cloud controller, the next step is to dive into the OpenStack compute service and uncover various options for deployment as well as features, including containerization options, within the latest
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1241.1">
      OpenStack releases.
     </span>
    </span>
   </p>
  </div>
 </body></html>