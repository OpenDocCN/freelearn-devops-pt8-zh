<html><head></head><body><div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Securing Workloads Using AWS WAF</h1>
                </header>
            
            <article>
                
<p>In the previous chapter, we learned a lot about how to leverage Amazon Elastic Beanstalk as well as Amazon Elastic File System to build and deploy highly scalable and available applications with the utmost of ease! However, there is one critical aspect that we didn't talk too much about in the previous chapter, and that is, of course, security! "<em>How do I safeguard my applications and workloads against malicious software and threats?</em>" This is exactly the question we will try and answer through a combination of two simple, yet very powerful, AWS services, namely AWS Shield and AWS <strong>Web Application Firewall</strong>, or <strong>WAF</strong>.</p>
<p>Keeping this in mind, let's have a quick look at the various topics that we will be covering in this chapter:</p>
<ul>
<li>Introducing AWS WAF and how it works</li>
<li>Securing our WordPress site by leveraging WAF and using web ACLs</li>
<li>Learning about additional WAF conditions for protection against cross-site scripting and SQL injections</li>
<li>Automated deployment and configuration of AWS WAF using CloudFormation templates</li>
<li>Monitoring AWS WAF using Amazon CloudWatch</li>
<li>A brief introduction to AWS Shield and how it works</li>
<li>Understanding AWS Shield Advanced and how to leverage it</li>
</ul>
<p>There is so much to do, so let's get started right away!</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Introducing AWS Web Application Firewall</h1>
                </header>
            
            <article>
                
<p>Security has always been, and always will be, a key concern for a lot of organizations that run their workloads and applications on the cloud. That is precisely why AWS offers a wide assortment of managed services that you, as a cloud administrator, should leverage in order to protect and safeguard your workloads from any compromises or threats. In this section, we are going to explore one such simple, yet really powerful, service, called AWS WAF, or Web Application Firewall.</p>
<p>AWS WAF is basically a firewall that helps you to protect your internet-facing applications from common web-based threats and exploits. It is basically a service that enables you to specify a set of web security rules or ACLs that can allow or restrict a certain type of web traffic across Amazon CloudFront as well as the <strong>Application Load Balancer</strong> (<strong>ALB</strong>). As of now, WAF can be used to create customized rules that can safeguard your applications against attacks, such as SQL injections, cross-site scripting, <strong>Distributed Denial of Services</strong> (<strong>DDoS</strong>), bad bots, scrapers, and much more! You can easily create new rules and attach them to your existing ACL list as per your requirements, enabling you to respond to and mitigate changing traffic patterns more rapidly.</p>
<p>WAF also comes equipped with a powerful API, by using which you can automate the deployments of ACL rules as well as manage them programmatically. Alternatively, for the UI people out there, WAF provides customization CloudFormation templates which will allow you to get started with a complete WAF-based security solution in less than a few minutes! We will be looking at how to deploy this template for securing our own WordPress application as well a bit later in this chapter.</p>
<div class="packt_infobox">WAF is priced based on the number of ACL rules which you deploy, as well as on the number of web requests that your application receives.</div>
<p>Here is a quick summary of benefits that you can obtain by levering AWS WAF:</p>
<ul>
<li><strong>Enhanced protection</strong>: Apart from your standard VPC and security groups, you can additionally safeguard your applications against commonly occurring web attacks by leveraging WAF's ACL rules.</li>
<li><strong>Advanced traffic filtering</strong>: Unlike your simple NACLs or security groups, WAFs provide you with an ability to define custom rules and conditions based on the characteristics of your incoming web request, such as values present in the headers, origin IP address of the request, whether the request has any SQL code present in it, and so on. Using these conditions, you now have the ability to basically allow, block, or filter traffic based on such preset conditions.</li>
<li><strong>Easy management</strong>: With WAF rules defined and managed in one central location, you can easily reuse and propagate your custom ACLs across multiple CloudFront CDNs as well as Application Load Balancers, and monitor the traffic as well as mitigate any issues, all using the same WAF API or web user interface.</li>
<li><strong>Cost effective security solution</strong>: One of the best parts of leveraging WAF is that there are absolutely no upfront fees or costs associated with it. You simply pay based on the number of rules you create using WAF as well as the amount of traffic your web application receives, and not a penny more!</li>
</ul>
<p>With this basic set of information, let's have a look at how WAF actually works!</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Concepts and terminologies</h1>
                </header>
            
            <article>
                
<p>As discussed briefly, WAF can be enabled over your standard ALBs and over your CloudFront distributions. But before we get started with configuring WAF and its various rules and ACLs, we first need to understand some of its commonly used terms and terminologies:</p>
<ul>
<li><strong>Conditions</strong>: Conditions form the core of your WAF rulesets. These are basically configurable characteristics that you want WAF to monitor in each of your incoming web requests. At the time of writing this book, WAF supports the following list of conditions:
<ul>
<li><strong>IP match</strong>: You can use this condition to check whether the incoming web request originated from a specified black/whitelisted IP addresses or not. You can then plot corresponding actions to be performed against the same based on your requirements, such as not allowing any incoming traffic other that the whitelisted IP range, and so on.  AWS WAF supports <kbd>/8</kbd>, <kbd>/16</kbd>, <kbd>/24</kbd>, <kbd>/32</kbd> CIDR blocks for an IPv4 address.</li>
<li><strong>String and regex match</strong>: A string match or a regex match condition can be used to specify a part of an incoming web request and its corresponding text that you wish to control access to. For example, you can create a match or regex condition that checks the user agent headers and its value against a preset <em>string</em> or <em>expression</em>. If the condition matches, you can opt to either allow or block that particular traffic using WAF rules.</li>
<li><strong>SQL injection match</strong>: You can use this condition to inspect certain parts of your incoming web requests, such as the URI or query string, for any malicious SQL code. If a pattern matches, you can then opt to block all traffic originating from that particular request's IP range.</li>
<li><strong>Cross-site scripting match</strong>: Hackers and exploiters can often embed malicious scripts within web requests that can potentially harm your application. You can leverage the cross-site scripting match condition to inspect your incoming request URI or headers for any such scripts or code, and then opt to block the same using WAF rules.</li>
<li><strong>Geographic match</strong>: You can use this condition to list countries that your web request originated from and accordingly block or allow the same based on your requirements.</li>
<li><strong>Size constraint match</strong>: You can use the size constraint match condition to check the lengths of specified parts of your incoming web requests, such as the query string or the URI. For example, you can create a simple WAF rule to block all requests which have a query string greater than 100 bytes, and so on.</li>
</ul>
</li>
<li><strong>Rules</strong>: With your conditions defined, the next important aspect of configuring WAF are the rules. Rules basically allow you to combine one or more conditions into a logical statement, which can then be used to either allow, block, or count a particular incoming request. Rules are further classified into two categories:
<ul>
<li><strong>Regular rules</strong>: Regular or standard rules, apply one or more conditions to your most recent batch of incoming web requests. For example, a rule to block all incoming traffic from the IP range <kbd>40.40.5.0/24</kbd> or if there is any SQL-like code in the query string of your request, and so on.</li>
<li><strong>Rate-based rules</strong>: Rate-based rules are very much like your regular rules apart from one addition: the rate limit. You can now configure conditions and pass a rate limit along them as well. The rule will only trigger if the conditions match or exceed that particular rate limit which was set.</li>
</ul>
</li>
</ul>
<div style="padding-left: 60px" class="packt_infobox">Rate limits are checked by WAF within a 5-minute window period.</div>
<p style="padding-left: 150px">For example, you may configure a simple condition that blocks all incoming traffic from the IP range <kbd>40.40.5.0/24</kbd> with a rate limit of 10,000. In this case, the rule will only trigger a corresponding action (allow, block, count) if the condition is met and the number of incoming requests in a 5-minute period exceed 10,000 requests. Requests that do not meet both the conditions are simply not compared towards the rate limit and hence will not be blocked by this rule.</p>
<ul>
<li><strong>Web ACLs</strong>: Once the rules are defined, you combine them into one or more web ACLs. Here, you have the ability to define an action for your rule if it gets triggered; for example, allow, block, count, or even perform a default action that gets triggered in case a request doesn't match any of the conditions or rules specified. Web ACLs work on a priority basis, so the rule listed first is the one that gets compared to the incoming request first. This makes it extremely important to know the order in which you create and assign your rules in a web ACL.</li>
</ul>
<p>Here is a simple representation of how conditions, rules, and web ACLs work together in WAF:</p>
<div class="CDPAlignCenter CDPAlign"><img height="1097" width="1473" class=" image-border" src="Images/4ed0bb58-5f5a-4ef5-80ca-4387460aece2.png"/></div>
<p>With the concepts out of the way, let's look at a few simple steps that allow you to set up and configure WAF Web ACLs for safeguarding your web applications.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Getting started with WAF</h1>
                </header>
            
            <article>
                
<p>In this section, we are going to look at a few simple and easy-to-follow steps for getting started with AWS WAF. For demonstration purposes, we will be leveraging the same environments and application that we deployed from our previous chapter here, so, if you haven't gone through the use case, this might be a good time for a quick revisit!</p>
<p>In the previous chapter, we leveraged Elastic Beanstalk as well as Elastic File System services to deploy a scalable and highly available WordPress application over the internet. In this section, we will leverage the same setup and secure it even further by introducing AWS WAF into it. Why use WAF for our WordPress application? Well, the simplest answer is to completely abstract the security checks from the underlying web server instance(s), and instead place the security checks at the point of entry of our application, as depicted in the following diagram:</p>
<div class="CDPAlignCenter CDPAlign"><img height="1214" width="1698" class=" image-border" src="Images/caa43ac4-8f03-4a43-8f5e-d8f132fc09d1.png"/></div>
<p>To get started, you will first need to ensure that your WordPress application has a CloudFront CDN attached to it, or alternatively an Application Load Balancer frontend its requests. This is a crucial step, as without a CloudFront CDN or an Application Load Balancer, WAF will simply not work! In my case, I have configured and deployed a simple CloudFront CDN for my production-grade WordPress application. You can refer to the following step-by-step guide for setting up your own CDN using CloudFront, at <a href="http://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/">http://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/</a>.<a href="http://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/"/></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Creating the web ACL</h1>
                </header>
            
            <article>
                
<p>Once you are done with your CDN, head over to the AWS Management Console and filter out WAF and Shield services using the dashboard, or alternatively, navigate to this URL <a href="https://console.aws.amazon.com/waf/home">https://console.aws.amazon.com/waf/home</a> to bring up the WAF dashboard:</p>
<ol>
<li>Assuming that this is the first time you are configuring WAF, you will be prompted by a welcome screen to either opt for AWS WAF or AWS Shield services. Select the <span class="packt_screen">Go to AWS WAF</span> option. This will redirect you to the WAF dashboard, where we select the <span class="packt_screen">Configure web ACL</span> option to get started.</li>
<li>Selecting the <span class="packt_screen">Configure web ACL</span> option will bring up a <span class="packt_screen">Set up a web access control list (web ACL)</span> wizard that will guide you through your first web ACL setup.</li>
<li>The first page on the wizard basically covers the concepts of conditions, rules, and ACLs, so simply select the <span class="packt_screen">Next</span> option to proceed further.</li>
<li>In the <span class="packt_screen">Name web ACL</span> page, provide a suitable <span class="packt_screen">Web ACL Name</span> for your new ACL. You will notice that the <span class="packt_screen">CloudWatch metric name</span> field gets correspondingly auto-populated with a matching name. You can change the name as per your requirements. This metric name will be later used to monitor our web ACLs using CloudWatch's dashboards.</li>
<li>Moving on, from the <span class="packt_screen">Region</span> drop-down list, select either <span class="packt_screen">Global (CloudFront)</span> or an alternative <span class="packt_screen">Region</span> name, based on whether you want to secure a CDN or an Application Load Balancer. In my case, since I already have a CDN set up, I've opted for the <span class="packt_screen">Global (CloudFront)</span> option.</li>
</ol>
<div class="packt_infobox">WAF for the Application Load Balancer is currently supported only for the following regions: <span>US East (N. Virginia), </span><span>US West (N. California), </span><span>US West (Oregon),  </span><span>EU (Ireland), and  </span><span>Asia Pacific (Tokyo).</span></div>
<ol start="6">
<li>In the <span class="packt_screen">AWS resource to associate</span> field, you can opt to select your CloudFront distribution or your Application Load Balancer using the drop-down list; however, for the sake of simplicity, do not configure this option for the time being. Remember, you can always associate your web ACLs with one or more AWS resources after completing this wizard! Once done, click <span class="packt_screen">Next</span> to proceed:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="341" width="741" class=" image-border" src="Images/10056b82-20c4-4f42-b737-1e5a648b0b0a.png"/></div>
<ol start="7">
<li>With the web ACL named, we move on to the next section where we can configure our conditions. On the <span class="packt_screen">Create conditions</span> page, select an appropriate condition that you wish to configure for your web application. In this scenario, we will be configuring an IP match condition along with a string match condition. The idea here is to only grant access to our WordPress administrator login page (<kbd>wp-login.php</kbd>) from my local laptop's IP, and, conversely, for any other IP that wishes to access the <kbd>wp-login.php</kbd> page, the traffic should get dropped.</li>
</ol>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Creating the conditions</h1>
                </header>
            
            <article>
                
<p>As mentioned earlier, conditions are configurable characteristics that you want WAF to monitor in each of your incoming web requests:</p>
<ol>
<li>To get started with a condition, select the <span class="packt_screen">Create condition</span> option from the <span class="packt_screen">IP match conditions</span> tile.</li>
<li>Here, provide a suitable <span class="packt_screen">Name</span> for your match condition and select the <span class="packt_screen">IPv4</span> option from the <span class="packt_screen">IP Version</span>. Provide your desktop's or laptop's public IP in the <span class="packt_screen">Address</span> field. You can alternatively provide a range of IP addresses here using either of the supported CIDR blocks.</li>
<li>Remember to select the <span class="packt_screen">Add IP address or range</span> option before creating the match condition:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="362" width="588" class=" image-border" src="Images/0f9e052b-010e-4c08-abcb-2288ffb00b84.png"/></div>
<ol start="4">
<li>With the IP match condition created, let's move on to creating the second condition for our ACL as well. For this, select the <span class="packt_screen">Create condition</span> option from the <span class="packt_screen">String and regex match conditions</span> section.</li>
</ol>
<ol start="5">
<li>Once again, we start by providing a suitable <span class="packt_screen">Name</span> for our string match condition, followed by selecting the <span class="packt_screen">Type</span> of string to match with. Here, select the <span class="packt_screen">String match</span> option to begin with.</li>
<li>Next, in the <span class="packt_screen">Part of the request to filter on</span> section, select the appropriate section of your request that you wish to filter, using the match condition. In my case, I have selected the <span class="packt_screen">URI</span> option as we need to match the resource <kbd>wp-login.php</kbd> from the URI. Alternatively, you can also opt to select the following values based on your requirements:</li>
</ol>
<ul>
<li style="list-style-type: none">
<ul>
<li><kbd>Header</kbd>: Used to match a specific request header, such as user-agent.</li>
<li><kbd>HTTPMethod</kbd>: Used to indicate the type of operation the request intends to perform on the origin, such as <kbd>PUT</kbd>, <kbd>GET</kbd>, <kbd>DELETE</kbd>, and so on.</li>
<li><kbd>QueryString</kbd>: Used to define a query string in a URL.</li>
<li><kbd>Body</kbd>: Used to match the body of the request. In this case, WAF only inspects the first 8,192 bytes (8 KB) contained within the request's body. You can alternatively set up a <span class="packt_screen">Size Constraint</span> condition that blocks all requests that are greater than 8 KB in size.</li>
</ul>
</li>
</ul>
<ol start="7">
<li>Next, in the <span class="packt_screen">Match type</span> drop-down list, select the option <span class="packt_screen">Contains</span>, as shown in the following screenshot. The <span class="packt_screen">Contains</span> option means that the string to match can appear anywhere in the request. Alternatively, you can also opt to select from these options, based on your requirement:</li>
</ol>
<ul>
<li style="list-style-type: none">
<ul>
<li><span class="packt_screen">ContainsWord</span>: Used to specify a specific <span class="packt_screen">Value to match</span> in the request</li>
<li><span class="packt_screen">Exactly matches</span>: Used to match the string and the request value exactly</li>
<li><span class="packt_screen">Starts with</span>: Used to check for a matching string at the beginning of a request</li>
<li><span class="packt_screen">Ends with</span>: Used to check for a matching string at the end of the request</li>
</ul>
</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img height="272" width="478" class=" image-border" src="Images/52df0987-8ebe-4b02-94a0-0905f6ed3b40.png"/></div>
<ol start="8">
<li>The <span class="packt_screen">Transformation</span> field is handy when you need to re-format the web request before WAF inspects the same. This can involve <span class="packt_screen">Converting to lowercase</span>, <span class="packt_screen">HTML decoding</span>, <span class="packt_screen">Whitespace normalization</span>, <span class="packt_screen">URL Decode</span>, and so on. For this particular use case, we don't have any particular transformation to perform on the request, and hence I've selected the <span class="packt_screen">None</span> option.</li>
<li>Finally, in the <span class="packt_screen">Value to match</span> field, enter the text (<kbd>wp-login</kbd>) that we want WAF to search for in the web requests. Once completed, remember to click on the <span class="packt_screen">Add filter</span> option before you proceed with the <kbd>Create</kbd> command.</li>
<li>With this step completed, our basic conditions are in place. Alternatively, you can set up other relevant conditions based on your criteria and requirements. Once done, select the <span class="packt_screen">Next</span> option to proceed with the wizard.</li>
</ol>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Creating rules</h1>
                </header>
            
            <article>
                
<p>With your conditions defined, we now move on to the next important aspect of configuring WAF: rules. Rules basically allow you to combine one or more condition, into a logical statement, which can then be used to either allow, block, or count a particular incoming request:</p>
<ol>
<li>In the <span class="packt_screen">Create rules</span> page, you can now merge the conditions we created a while back and assign each rule a corresponding action, such as allow, block, or count. To get started, select the <span class="packt_screen">Create rule</span> option.</li>
</ol>
<ol start="2">
<li>In the <span class="packt_screen">Create rule</span> popup, we will be creating two rules: one rule that will basically allow me to access the WordPress admin login page (<kbd>wp-login.php</kbd>) from my local laptop, and another rule that blocks traffic to the same login page. Let's first create the <span class="packt_screen">Allow traffic</span> rule.</li>
<li>To do so, type in a suitable <span class="packt_screen">Name</span> for your rule. You will notice the corresponding <span class="packt_screen">CloudWatch metric name</span> field auto-populate itself with the same name as well. You can choose to change this name as per your requirements, or leave it to its default value.</li>
<li>Next, in the <span class="packt_screen">Rule type</span> drop-down list, select whether you want this rule to be a <span class="packt_screen">Regular rule</span> or a <span class="packt_screen">Rated rule</span>. For this scenario, I've opted for the <span class="packt_screen">Regular rule</span>, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="230" width="444" class=" image-border" src="Images/fcd78b2e-1bf3-4202-9118-304dee3a97df.png"/></div>
<ol start="5">
<li>Once done, move on to the <span class="packt_screen">Add conditions</span> section, where we can associate our rule with one or more conditions. Start by selecting the appropriate drop-down option to form the following rule:</li>
</ol>
<p class="mce-root"/>
<pre style="padding-left: 60px">When a request: "Does": "Originate from an IP Address in": "&lt;SELECT_YOUR_IP_ADDRESS_MATCH_CONDITION_HERE&gt;"</pre>
<p style="padding-left: 90px">Here's what your new rule should look like once it is properly set up. Click on <span class="packt_screen">Create</span> once completed:</p>
<div class="CDPAlignCenter CDPAlign"><img height="374" width="504" class=" image-border" src="Images/5420d5a5-f35a-48bd-a446-9d1336c1dc26.png"/></div>
<ol start="6">
<li>With your <span class="packt_screen">Allow rule</span> created, we use the same steps once again to create a <span class="packt_screen">Block rule</span> as well. Select the <span class="packt_screen">Create rule</span> option once again, and provide a suitable <span class="packt_screen">Name</span> for your rule. Similar to the previous case, I've opted for a <span class="packt_screen">Regular rule</span> here as well.</li>
<li>Next, in the <span class="packt_screen">Add conditions</span> section, we first add a condition that matches the following statement:</li>
</ol>
<pre style="padding-left: 60px">When a request: "Does not": "Originate from an IP Address in": "&lt;SELECT_YOUR_IP_ADDRESS_MATCH_CONDITION_HERE&gt;"</pre>
<ol start="8">
<li>Next, select the <span class="packt_screen">Add condition</span> option to add the string match condition as well:</li>
</ol>
<pre style="padding-left: 60px">When a request: "Does": "Match at least one of the filters in the string match condition": "&lt;SELECT_YOUR_STRING_MATCH_CONDITION_HERE&gt;"</pre>
<p style="padding-left: 60px">Here's what your rule should look like once both the conditions are added to it:</p>
<div class="CDPAlignCenter CDPAlign"><img height="613" width="587" class=" image-border" src="Images/99faa3d2-619b-4df9-9e89-67950ab0437f.png"/></div>
<ol start="9">
<li>With the conditions in place, select the <span class="packt_screen">Create</span> option to finally create your blocking rule.</li>
</ol>
<ol start="10">
<li>Now that your two rules are created, you should see them both listed in the <span class="packt_screen">Add rules to a web ACL</span> page, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="451" width="625" class=" image-border" src="Images/5b32b5ad-3182-4188-be53-f0e4c75df03d.png"/></div>
<ol start="11">
<li>Here, make sure you order your rules correctly, based on their precedence, by selecting the <span class="packt_screen">Order</span> option as required. You can additionally configure the <span class="packt_screen">Default action</span> for your web ACL as well. This default action will only get triggered if the request does not match any of the conditions mentioned in either the <em>allow or the blocking rules</em>. Once you are confident with your configurations, select the <span class="packt_screen">Review and create</span> option, as shown earlier. And voila! Your basic WAF is now up and running!</li>
</ol>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Assigning a WAF Web ACL to CloudFront distributions</h1>
                </header>
            
            <article>
                
<p>With the web ACL created, you can now easily assign it to one or more CloudFront distributions, as per your requirements. To do so, simply log in to your AWS dashboard and filter the <span class="packt_screen">CloudFront</span> service, or alternatively, navigate to <a href="https://console.aws.amazon.com/cloudfront/home">https://console.aws.amazon.com/cloudfront/home</a> to view the CloudFront dashboard directly:</p>
<ol>
<li>Once logged into the CloudFront dashboard, select the appropriate <span class="packt_screen">Distribution ID</span> for which you wish to enable the <span class="packt_screen">WAF Web ACL</span> rules.</li>
<li>Select the <span class="packt_screen">Edit</span> option from the <span class="packt_screen">General</span> tab to bring up your distribution's configurations and settings.</li>
<li>Here, in the <span class="packt_screen">Edit Distribution</span> page, select your newly created web ACL from the <span class="packt_screen">AWS WAF Web ACL</span> drop-down list, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="233" width="584" class=" image-border" src="Images/5b906b2d-1584-41af-b7e3-92251e32f5ff.png"/></div>
<ol start="4">
<li>Once the ACL is selected, I would also recommend that you enable the logging of your distribution in case you already haven't done that. This is just an added measure of precaution and security that is a must for any production-grade environment that you may be working on. Scroll down on the <span class="packt_screen">Edit Distribution</span> page, and select the <span class="packt_screen">On</span> option adjoining the <span class="packt_screen">Logging</span> field. Provide your logging bucket's name in the <span class="packt_screen">Bucket for Logs</span> field and click on the <span class="packt_screen">Yes, Edit</span> option once the required fields are all filled in.</li>
</ol>
<p>The changes will take a good few minutes to propagate through the CloudFront distribution. You can then move on to testing your WAF once the distribution's <span class="packt_screen">Status</span> has changed to <span class="packt_screen">Enabled</span>.</p>
<p>To test your WAF, simply open a browser and type in the URL of your WordPress application (<kbd>&lt;http://YOUR_CLOUDFRONT_URL&gt;/wp-login.php</kbd>) from your own laptop/desktop. In this case, you should be able to see the <kbd>wp-login.php</kbd> page without any issues whatsoever. However, if you try accessing the same page from a different laptop or machine, you will be thrown the following error on screen:</p>
<div class="CDPAlignCenter CDPAlign"><img height="167" width="422" class=" image-border" src="Images/6cec3fcf-f199-42d9-9bae-941ec3a6ff30.png"/></div>
<p>At this point, your WordPress administrator login page is now protected from all IPs except those that you specified in your Web ACL's allow list! Amazing, isn't it?</p>
<div class="packt_tip">You can create a custom error page using the CloudFront distribution settings and redirect your users to this page rather than showing them the standard <em>error page</em>, as depicted in the preceding screenshot.</div>
<p>With this, we come towards the end of this basic web ACL configuration section. In the next section, we will be looking at how to enhance your basic ACL setup with more conditions, with more emphasis towards SQL injections and cross-site scripting.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Working with SQL injection and cross-site scripting conditions</h1>
                </header>
            
            <article>
                
<p>Besides restricting access to a specific set of IP addresses, WAF additionally provides defense capabilities against more exploitative attacks, such as SQL injections and cross-site scripting. In this section, we will take a closer look at both of these conditions and how you can leverage them for protecting your own applications.</p>
<p>To start off, let's have a closer look at SQL injections. An SQL injection basically consists of the insertion of an SQL query within a request that is made from a client to your application.</p>
<p>SQL injections, if successfully implemented, can read as well as modify sensitive data from the database, and are even capable enough to execute administration operations on your database, such as restoring from a previous backed up file, shutting the database down completely, and much more.</p>
<p>Here's a list of some common conditions and their associated configurations that you can choose to apply in your web ACL rules:</p>
<table class="table">
<tbody>
<tr>
<td>
<p><strong>HTTP request component to match</strong></p>
</td>
<td>
<p><strong>Relevant input transformations to apply</strong></p>
</td>
<td>
<p><strong>Justification</strong></p>
</td>
</tr>
<tr>
<td>
<p><kbd>QUERY_STRING</kbd></p>
</td>
<td>
<p><kbd>URL_DECODE</kbd>,<br/>
<kbd>HTML_ENTITY_DECODE</kbd></p>
</td>
<td>
<p>The most common component to match. Query<br/>
string parameters are frequently used in database lookups.</p>
</td>
</tr>
<tr>
<td>
<p><kbd>URI</kbd></p>
</td>
<td>
<p><kbd>URL_DECODE</kbd>, <kbd>HTML_ENTITY_DECODE</kbd></p>
</td>
<td>
<p>If your application is using friendly or clean URLs, then parameters might appear as part of the URL path segment, and not the query string.</p>
</td>
</tr>
<tr>
<td>
<p><kbd>BODY</kbd></p>
</td>
<td>
<p><kbd>URL_DECODE</kbd>, <kbd>HTML_ENTITY_DECODE</kbd></p>
</td>
<td>
<p>A common component to match if your application accepts form input. AWS WAF only evaluates the first 8 KB of the body content.</p>
</td>
</tr>
<tr>
<td>
<p><strong>HEADER</strong>: <strong>Cookie</strong></p>
</td>
<td>
<p><kbd>URL_DECODE</kbd>, <kbd>HTML_ENTITY</kbd></p>
</td>
<td>
<p>A less common component to match. But, if your application uses cookie-based parameters in database lookups, consider matching on this component as well.</p>
</td>
</tr>
<tr>
<td>
<p><strong>HEADER</strong>: <strong>Authorization</strong></p>
</td>
<td>
<p><kbd>URL_DECODE</kbd>, <kbd>HTML_ENTITY_DECODE _DECODE</kbd></p>
</td>
<td>
<p>A less common component to match. But, if your application uses the value of this header for database validation, consider matching on this component as well.</p>
</td>
</tr>
</tbody>
</table>
<p>To configure your own SQL injection conditions and rules, log in to your WAF dashboard once again by navigating to <a href="https://console.aws.amazon.com/waf/home">https://console.aws.amazon.com/waf/home</a>.<a href="https://console.aws.amazon.com/waf/home"/></p>
<ol>
<li>Next, select the <span class="packt_screen">SQL Injection</span> option from the navigation pane and, within that, select the <span class="packt_screen">Create condition</span> to get started.</li>
<li>In the <span class="packt_screen">Create SQL injection match condition</span> page, start off by providing a <span class="packt_screen">Name</span> for your new condition. You can additionally select whether you want to enable this condition for your CloudFront CDNs (Global) or for your individual Application Load Balancers. In this case, I've opted for the <span class="packt_screen">Global (CloudFront)</span> option, as depicted in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="304" width="655" class=" image-border" src="Images/3ecbae94-ad63-4367-86b4-96ca15afca9c.png"/></div>
<ol start="3">
<li>Next, in the <span class="packt_screen">Filter settings</span> section, select the appropriate <span class="packt_screen">Part of the request to filter on</span> as well as the associated <span class="packt_screen">Transformation</span> section. You can refer to the SQL injection <em>common conditions</em> table, as discussed previously, for the same. Once the values are provided, click on the <span class="packt_screen">Add filter</span> option to complete the process.</li>
</ol>
<p>Now, here's a really handy tip! There will definitely be cases where you will be writing more than one filter for your SQL injection condition based on different parts of the request you wish to filter, such as URI, query string, and so on. In such cases, it is always recommended to create multiple filters within the same SQL injection condition and then attach that one condition to a web ACL rule. The reason? A web request needs only to match one of the filters in the SQL injection match condition for WAF to allow or block the request based on that condition. On the other hand, if you add only one filter per SQL injection match condition, and you create more than one such SQL injection condition, the request has to match all the conditions in order for WAF to allow or block it.</p>
<p>The same can also be applied for protection against cross-site scripting or XSS. Cross-site scripting generally occurs when web applications include user-provided data in web pages that is sent to the browser without proper sanitization. If the data isn't properly validated or escaped, an attacker can use those vectors to embed scripts, inline frames, or other objects into the rendered page. These, in turn, can be used for a variety of malicious purposes, including stealing user credentials by using keyloggers, installing system malware, and much more. The impact of the attack is magnified if that user data persists on the server side in a data store and is then delivered to a larger set of users.</p>
<p>Here's a list of some common conditions and their associated configurations that you can choose to apply in your web ACL rules:</p>
<table class="table">
<tbody>
<tr>
<td>
<p><strong>HTTP request component to match</strong></p>
</td>
<td>
<p><strong>Relevant input transformations to apply</strong></p>
</td>
<td>
<p><strong>Justification</strong></p>
</td>
</tr>
<tr>
<td>
<p><kbd>BODY</kbd></p>
</td>
<td>
<p><kbd>URL_DECODE</kbd>, <kbd>HTML_ENTITY_DECODE</kbd></p>
</td>
<td>
<p>A very common component to match if your application accepts form input. AWS WAF only evaluates the first 8 KB of the body content.</p>
</td>
</tr>
<tr>
<td>
<p><kbd>QUERY_STRING</kbd></p>
</td>
<td>
<p><kbd>URL_DECODE</kbd>, <kbd>HTML_ENTITY_DECODE</kbd></p>
</td>
<td>
<p>Recommended if query string parameters are reflected back into the web page. An example is the current page number in a paginated list.</p>
</td>
</tr>
<tr>
<td>
<p><strong>HEADER</strong>: <strong>Cookie</strong></p>
</td>
<td>
<p><kbd>URL_DECODE</kbd>, <kbd>HTML_ENTITY_DECODE</kbd></p>
</td>
<td>
<p>A common component to match if your application accepts form input. Recommended if your application uses cookie-based parameters that are reflected back on the web page. For example, the name of the user who is currently logged in is stored in a cookie and embedded in the page header. WAF only evaluates the first 8 KB of the body content.</p>
</td>
</tr>
<tr>
<td>
<p><kbd>URI</kbd></p>
</td>
<td>
<p><kbd>URL_DECODE</kbd>, <kbd>HTML_ENTITY_DECODE</kbd></p>
</td>
<td>
<p>Less common, but if your application is using friendly URLs, then parameters might appear as part of the URL path segment, not the query string (they are later rewritten server side). There are similar concerns as with query strings.</p>
</td>
</tr>
</tbody>
</table>
<p>To configure your own cross-site scripting conditions and rules, log in to your WAF dashboard once again by visiting <a href="https://console.aws.amazon.com/waf/home">https://console.aws.amazon.com/waf/home</a>.<a href="https://console.aws.amazon.com/waf/home"/></p>
<ol>
<li>Next, select the <span class="packt_screen">Cross-site scripting</span> option from the navigation pane and, within that, select the <span class="packt_screen">Create condition</span> to get started.</li>
<li>In the <span class="packt_screen">Create cross-site scripting match condition</span> page, start off by providing a <span class="packt_screen">Name</span> for your new condition. You can additionally select whether you want to enable this condition for your CloudFront CDNs (Global) or for your individual Application Load Balancers. In this case, I've opted for the <span class="packt_screen">Global (CloudFront)</span> option for now.</li>
<li>Next, from the <span class="packt_screen">Part of the request to filter on</span> section, select the part of the request you wish WAF to filter on. You can choose between <span class="packt_screen">Header</span>, <span class="packt_screen">HTTP method</span>, <span class="packt_screen">Query string</span>, <span class="packt_screen">URI</span>, and <span class="packt_screen">Body</span> as valid parameters. Note, however, that by selecting the <span class="packt_screen">Header</span> option, you will be provided with an additional field in which you can either select the header from a list of headers or, alternatively, type in the name of the header.</li>
<li>Finally, select the appropriate <span class="packt_screen">Transformation</span> operation you wish WAF to perform over the request before it is actually inspected. Once done, remember to select the <span class="packt_screen">Add filter</span> option before completing the condition's creation process.</li>
</ol>
<p>You now have two additional conditions that you can add to your existing web ACL, or even, go ahead and create a new web ACL. In this way, you can create different filters and conditions based on your requirements and keep attaching them to your web ACL as and when required. But this manual way of setting up rules and conditions can get a bit tricky after some time, especially when you don't have a dedicated security team and need to deploy the ACLs a lot faster into your environment. That's precisely what we are going to cover in the next section.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Automating WAF Web ACL deployments using CloudFormation</h1>
                </header>
            
            <article>
                
<p>Working with web ACLs can be really difficult at times, especially when you have a large, distributed environment and don't necessarily have a dedicated security team to create and manage the rules on a regular basis. Luckily for us, AWS makes things far simpler by providing easy to use and customize CloudFormation templates that can spin up a single web ACL, with all the basic security conditions configured, in a mere matter of minutes! The collective solution is called AWS WAF Security Automations, and, is available free of charge for all to use. All the end user has to do is specify which security feature is required, configure that, and deploy the solution! The rest is completely taken care of by AWS itself!</p>
<p>The architecture of the AWS WAF Security Automation solution is relatively simple, and comprises of a few more AWS services than AWS WAF, such as AWS Lambda, Amazon CloudWatch, Amazon API Gateway, and Amazon S3, as depicted in the diagram later in this section.</p>
<p>At the core of the solution is the WAF service that acts as the central point for making all security-related decisions and filtering. Based on the inputs specified by the user during the CloudFormation template's configuration, the respective solution components get activated accordingly. These components are further explained here:</p>
<ul>
<li><strong>Honeypot for bad bots and scraper protection (A)</strong>: This security component automatically sets up a <em>honeypot</em> to lure and deflect a possible attack on your application. The solution provides you with an API Gateway endpoint that you need to insert into your web application as a trap to detect and lure inbound requests from various bots and scrapers. If a source accesses the trap request, an associated Lambda function intercepts that request, gathers its source IP address, and adds the same to the WAF's web ACL block list.</li>
<li><strong>SQL injection protection (B) and cross-site scripting protection (C)</strong>: Selecting this solution enables the creation of two AWS WAF rules that provide protection against commonly occurring SQL injection or cross-site scripting patterns:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img height="535" width="819" class=" image-border" src="Images/f2e94078-3e32-4445-a4a8-9e5a71901a81.png"/></div>
<ul>
<li><strong>HTTP flood, scanner and probe protection (D)</strong>: Also called <strong>log parsing protection</strong>, this solution comes in handy when you want to analyze your web application's access logs for any abnormalities that can cause a potential threat. This is performed by a dedicated AWS Lambda function that does the parsing of the access logs which get stored in a S3 bucket created by the CloudFormation template itself.</li>
<li><strong>IP address whitelist/blacklist (E)</strong>: Similar to the SQL injection and cross-site scripting solution, WAF creates two rules to allow you to manually enter IP addresses that you wish to either allow or block to your application.</li>
<li><strong>Known-attacker protection (F)</strong>: This solution also leverages a simple Lambda function that monitors certain third-party sites for a list of potential IP addresses to block against threats. The sites include <em>Spamhaus</em> (<a href="https://www.spamhaus.org/drop/">https://www.spamhaus.org/drop/</a>), <em>Proofpoint</em> (<a href="https://rules.emergingthreats.net/fwrules/emerging-Block-IPs.txt">https://rules.emergingthreats.net/fwrules/emerging-Block-IPs.txt</a>), and <em>TOR</em> (<a href="https://check.torproject.org/exit-addresses">https://check.torproject.org/exit-addresses</a>), to name a few.</li>
</ul>
<p>With these basics in mind, let's quickly move on to deploying these solutions using the CloudFormation templates. At the time of writing this book, AWS WAF Security Automations provides two templates for use: one intended for the CloudFront CDN based deployments and the other for the Application Load Balancer. Both of the templates provide a default configuration that consists of a web ACL with eight pre-configured sets of rules that you can always change or extend as required. The following are the links to download the respective templates:</p>
<ul>
<li><strong>CloudFront CDN-based template</strong>: <a href="https://s3.amazonaws.com/solutions-reference/aws-waf-security-automations/latest/aws-waf-security-automations.template">https://s3.amazonaws.com/solutions-reference/aws-waf-security-automations/latest/aws-waf-security-automations.template</a></li>
<li><strong>Application Load Balancer-based template</strong>: <a href="https://s3.amazonaws.com/solutions-reference/aws-waf-security-automations/latest/aws-waf-security-automations-alb.template">https://s3.amazonaws.com/solutions-reference/aws-waf-security-automations/latest/aws-waf-security-automations-alb.template</a></li>
</ul>
<div class="packt_infobox">You can alternatively copy the links and deploy the stacks in CloudFormation.</div>
<p>With the correct template downloaded, we can now move on to configuring and deploying the solution using CloudFormation:</p>
<ol>
<li>To do so, first log in to your CloudFormation dashboard by navigating to <a href="https://console.aws.amazon.com/cloudformation/home">https://console.aws.amazon.com/cloudformation/home</a>. Note that in this case, we will be deploying the CloudFront CDN-based template in the <strong>N.Virginia</strong> region.</li>
<li>In the CloudFormation dashboard, select the option <span class="packt_screen">Create new stack</span> to get started. Here, in the <span class="packt_screen">Select Template</span> page, you can either choose to <em>upload</em> your downloaded template, or simply copy the template's URL in the <span class="packt_screen">Specify an Amazon S3 template URL</span> field, as shown in the following screenshot. Click on <span class="packt_screen">Next</span> to continue with the setup:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" src="Images/c291da88-0b7e-42e9-a831-1fabbb2a0816.png" width="892" height="378"/></div>
<ol start="3">
<li>In the <span class="packt_screen">Specify Details</span> page, you can start off by providing a suitable <span class="packt_screen">Stack name</span> for your CloudFormation stack.</li>
<li>Next, in the <span class="packt_screen">Parameters</span> section, select the <span class="packt_screen">Protection services</span> that you wish to opt for. Remember, these are the same services that we discussed at the beginning of this section. In this case, I've opted for a rather simple setup that involves activating protection against SQL injection, cross-site scripting, and bad bots. You can alternatively select your own protection services, as required.</li>
<li>Moving on, in the <span class="packt_screen">CloudFront Access Log Bucket Name</span> field, provide a unique name for the S3 bucket that will store your Amazon CloudFront's access logs. You can either provide the name of an existing bucket or a new one.</li>
<li>Finally, in the <span class="packt_screen">Advanced Settings</span> section, you can additionally opt to modify a few parameters, such as <span class="packt_screen">Request Threshold</span>, <span class="packt_screen">Error Threshold</span>, and the <span class="packt_screen">WAF Block Period</span>, as per your requirements. These parameters would come in handy especially if you select the <span class="packt_screen">HTTP Flood Protection</span> or the <span class="packt_screen">Activate Scanners &amp; Probes Protection</span>, otherwise, you can leave these values to their defaults, as I have done in my case. Select <span class="packt_screen">Next</span> to continue with the deployment process.</li>
</ol>
<ol start="7">
<li>In the <span class="packt_screen">Options</span> page, you can specify <span class="packt_screen">Tags</span> for the resources that will be created by the CloudFormation template, as well as opt to provide any special <em>IAM Role</em> to allow CloudFormation to create, modify, or delete the resources in the stack. Click on <span class="packt_screen">Next</span> to review the changes made and, finally, go ahead with the stack's creation by selecting the <span class="packt_screen">Create</span> option on the <span class="packt_screen">Review</span> page.</li>
</ol>
<ol start="8">
<li>The stack takes a good few minutes to deploy successfully. Once done, you can verify the status of your stack's completion by checking the <span class="packt_screen">Status</span> column, as depicted in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="315" width="977" class=" image-border" src="Images/1cb087cd-d113-430e-82b3-a96440b2ea05.png"/></div>
<ol start="9">
<li>Additionally, based on your <span class="packt_screen">Protection service</span> selection, you can also verify the additional outputs created by the template for your application, such as the <span class="packt_screen">Honeypot Endpoint</span>, that's actually an Amazon API Gateway endpoint that you need to insert somewhere in your application to capture bots and scrapers. In my case, the template created a Lambda function for bad bots scraping, WAF rules for SQL injections, IP whitelisting, and XSS detection, along with an API Gateway as well.</li>
</ol>
<ol start="10">
<li>With the stack up and running, you can additionally go back to the WAF dashboard and check out the individual rules that the template auto-populated against some of the protection services. In this case, the <em>SQL injection</em> and c<em>ross-site scripting</em> conditions were auto-populated; however, the <em>IP Whitelist</em> and <em>Bad Bot</em> rules still require you to manually provide the IP ranges and addresses to start off with, or allow the Lambda function to inject the IP addresses into the lists at runtime as well. Here is a snapshot of the list of rules created for the SQL injection condition:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="418" width="713" class=" image-border" src="Images/1b6b9c51-d01a-40ce-9bd2-107e28a9e293.png"/></div>
<p>With this we come to the end of this particular section. You can additionally use these templates to spin up newer web ACLs for your Application Load Balancers. Just remember to delete your stack once your testing is completed, to avoid incurring any unnecessary charges. In the next section, we will be briefly looking at how to effectively monitor your WAF rules using a few essential monitoring tools provided by AWS.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Monitoring WAF using CloudWatch</h1>
                </header>
            
            <article>
                
<p>Monitoring of your WAF rules, conditions, as well as your application's web traffic, plays an important part towards identifying and mitigating possible attacks and exploits. AWS provides a wide assortment of tools and services that you, as an administrator, can leverage for the monitoring and reporting of such activities. The following are the list of services briefly explained:</p>
<ul>
<li><strong>AWS WAF dashboard</strong>: Yes, you read it right! AWS WAF also provides a simple monitoring dashboard that lists the total requests made to your application via either the CloudFront CDN or the Application Load Balancer, as well as the number of requests that actually match to your specified rules. To view the dashboard, all you need to do is log in to your AWS WAF, select the <span class="packt_screen">Web ACLs</span> page, and click on the <span class="packt_screen">Requests</span> tab, as shown in the following screenshot:
<div class="CDPAlignCenter CDPAlign"><img style="font-size: 1em" class=" image-border" src="Images/85e92692-509d-46b5-893f-de84f26e7367.png" width="702" height="467"/></div>
</li>
</ul>
<p style="padding-left: 60px">The graph aggregates and displays the requests on a five-minute period basis. You can alternatively open the same graph using Amazon CloudWatch for further analysis.</p>
<ul>
<li><strong>Amazon CloudWatch</strong>: Amazon CloudWatch has been around for some time, and definitely provides various metrics that you can select and configure as a part of a customized requests monitoring dashboard. Here is a list of the supported WAF metrics, with a brief description:
<ul>
<li><kbd>AllowedRequests</kbd>: Captures the number of allowed web requests. The valid dimensions for this metric are <span class="packt_screen">Rule</span> and <span class="packt_screen">WebACL</span>.</li>
<li><kbd>BlockedRequests</kbd>: Captures the number of blocked web requests. The valid dimensions for this metric are <span class="packt_screen">Rule</span><span> and </span><span class="packt_screen">WebACL</span>.</li>
<li><kbd>CountedRequests</kbd>: Typically used to test your web ACLs and rules, this metric provides a count of the web requests that match all of the conditions in a particular rule.</li>
</ul>
</li>
</ul>
<p style="padding-left: 60px">You can use these metrics to monitor your WAF rules, and even configure CloudWatch alarms to trigger and send notifications in case their threshold values are crossed. Based on your requirements, you can additionally take things a step further and configure CloudWatch events that trigger an appropriate Lambda function to mitigate against a possible attack, as we performed during the Security Automations solutions. You can even leverage Amazon CloudWatch to monitor the traffic flowing into the CloudFront CDNs as well as your Application Load Balancers.</p>
<ul>
<li><strong>AWS</strong><strong>CloudTrail</strong>: AWS CloudTrail is yet another service that you can and should leverage for parsing and analyzing your application's access and error logs, as well as logs generated by the AWS services' logs themselves. Here is a sample of few <span class="packt_screen">Log Groups</span>, created automatically by the Security Automations Solution, for capturing WAF traffic flow and events. We will be exploring more on AWS CloudTrail in the next chapter:
<div class="CDPAlignCenter CDPAlign"><img style="text-align: center;color: #333333;font-size: 1em" height="164" width="1040" class=" image-border" src="Images/428e3d3f-8e7c-4bfa-8f83-7ea9382cb4e0.png"/></div>
</li>
</ul>
<p>With this, we come towards the end of yet another chapter, but before we sign off, here's some interesting things that I feel you ought to try out as a part of AWS WAF.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Planning your next steps</h1>
                </header>
            
            <article>
                
<p>Well, we have covered a lot of new features and services in this chapter. However, there are still a few things that I recommend you need to read up on on your own. First up is the AWS Shield service!</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Introduction to AWS Shield</h1>
                </header>
            
            <article>
                
<p>AWS Shield is an extension of AWS WAF, but is targeted to provide security around potential DDoS attacks. It is a fully managed service that provides <span class="packt_screen">Always-on</span> detection and automatic mitigations that minimize application downtime and latency. AWS Shield provides two tiers of services: <strong>Standard</strong> and <strong>Advanced</strong>:</p>
<ul>
<li><strong>AWS Shield Standard</strong>: Provided at no additional costs, this service is enabled on your account and AWS services by default, and is designed to protect your web applications against the most common and frequently occurring DDoS attacks.</li>
<li><strong>AWS Shield Advanced</strong>: Designed for providing a higher level of protection for your web applications, AWS Shield Advanced is intended to work with applications that are currently running on Elastic or Application Load Balancers, Amazon CloudFront, and Amazon Route 53 resources. AWS Shield Advanced also provides near real-time visibility into potential attacks, along with mitigation capabilities as well. To top it all, you also get access to a dedicated 24x7 <strong>DDoS Response Team</strong> (<strong>DRT</strong>) that looks into potential DDoS attacks occurring on your web application, and provides quick resolutions against the same.</li>
</ul>
<div class="packt_infobox">AWS Shield Advanced is priced at $ 3,000 per month.</div>
<p>Here's a brief comparison between the various services offered by AWS Shield Standard and Advanced tiers:</p>
<table class="MsoTableGrid">
<tbody>
<tr>
<td>
<p><strong>Features</strong></p>
</td>
<td>
<p><strong>AWS Shield Standard</strong></p>
</td>
<td>
<p><strong>AWS Shield Advanced</strong></p>
</td>
</tr>
<tr>
<td>
<p>Network flow monitoring</p>
</td>
<td>
<p>Yes</p>
</td>
<td>
<p>Yes</p>
</td>
</tr>
<tr>
<td>
<p>Automated application (layer 7) traffic monitoring</p>
</td>
<td>No</td>
<td>
<p>Yes</p>
</td>
</tr>
<tr>
<td>
<p>Helps protect from common DDoS attacks, such as SYN floods and UDP reflection attacks</p>
</td>
<td>
<p>Yes</p>
</td>
<td>
<p>Yes</p>
</td>
</tr>
<tr>
<td>
<p>Access to additional DDoS mitigation capacity</p>
</td>
<td>No</td>
<td>
<p>Yes</p>
</td>
</tr>
<tr>
<td>
<p>Layer 3/4 attack notification and attack forensic and history reports</p>
</td>
<td>No</td>
<td>
<p>Yes</p>
</td>
</tr>
<tr>
<td>
<p>Incident management during high-severity events</p>
</td>
<td>No</td>
<td>
<p>Yes</p>
</td>
</tr>
<tr>
<td>
<p>Custom mitigations during attacks</p>
</td>
<td>No</td>
<td>
<p>Yes</p>
</td>
</tr>
<tr>
<td>
<p>Post-attack analysis</p>
</td>
<td>No</td>
<td>
<p>Yes</p>
</td>
</tr>
<tr>
<td>
<p>Reimburse related Route 53, CloudFront, and ELB DDoS charges</p>
</td>
<td>No</td>
<td>
<p>Yes</p>
</td>
</tr>
</tbody>
</table>
<p> </p>
<p>To activate AWS Shield Advanced for your environments, simply log in to your AWS WAF dashboard and select the <span class="packt_screen">Protected resources</span> option present under the <span class="packt_screen">AWS Shield</span> section in the navigation pane. Here, click on the <span class="packt_screen">Activate AWS Shield Advanced</span> button to start your Shield Advanced protection plan. Here, you will be asked to select a particular <span class="packt_screen">Resource</span> to protect against DDoS attacks. Select your CloudFront CDN or the Elastic/Application Load Balancer, based on the resource you wish to protect, and provide a suitable <span class="packt_screen">Name</span> for the resources that you are specifying for protection. Finally, remember to select the <span class="packt_screen">Enable</span> checkbox to associate your resources with a web ACL, if you have one created already. Once done, select the <span class="packt_screen">Add DDoS protection</span> option, and voila! You are up and running with AWS Shield Advanced! Simple isn't it?</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>Here's a quick round up of the topics that we have covered so far in this chapter.</p>
<p>We started off by learning and understanding a bit about the Web Application Firewall service and how it works to protect against potential security threats and exploits. We later looked at how to get started with WAF by safeguarding our previously deployed WordPress application against restrictive access by leveraging the IP Match, as well as the string/regex match conditions. We also looked at how to mitigate and safeguard your applications by leveraging advanced WAF conditions in the form of SQL injection and cross-site scripting. Towards the end, we covered how to leverage certain pre-built CloudFormation templates to automate the deployments of our WAF rules and, finally, we concluded the chapter with a brief introduction to AWS Shield and its various tiers.</p>
<p>In the next chapter, we will be continuing on our security journey and will cover two really amazing services as well: AWS CloudTrail and AWS Config, so stay tuned!</p>


            </article>

            
        </section>
    </div>



  </body></html>