<html><head></head><body><div class="chapter" title="Chapter&#xA0;10.&#xA0;Monitoring, Reporting, and Troubleshooting"><div class="titlepage"><div><div><h1 class="title"><a id="ch10"/>Chapter 10. Monitoring, Reporting, and Troubleshooting</h1></div></div></div><div class="blockquote"><table border="0" width="100%" cellspacing="0" cellpadding="0" class="blockquote" summary="Block quote"><tr><td valign="top"> </td><td valign="top"><p><span class="emphasis"><em>"Show me a completely smooth operation and I'll show you someone who's covering mistakes. Real boats rock."</em></span></p></td><td valign="top"> </td></tr><tr><td valign="top"> </td><td colspan="2" align="right" valign="top" style="text-align: center">--<span class="attribution"><span class="emphasis"><em>Frank Herbert, Chapterhouse: Dune</em></span></span></td></tr></table></div><p>In this chapter, we will cover the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Noop: the don't change anything option</li><li class="listitem" style="list-style-type: disc">Logging command output</li><li class="listitem" style="list-style-type: disc">Logging debug messages</li><li class="listitem" style="list-style-type: disc">Generating reports</li><li class="listitem" style="list-style-type: disc">Producing automatic HTML documentation</li><li class="listitem" style="list-style-type: disc">Drawing dependency graphs</li><li class="listitem" style="list-style-type: disc">Understanding Puppet errors</li><li class="listitem" style="list-style-type: disc">Inspecting configuration settings</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec113"/>Introduction</h1></div></div></div><p>We've all had the experience of sitting in an exciting presentation about some new technology and rushing home to play with it. Of course, once you start experimenting with it, you immediately run into problems. What's going wrong? Why doesn't it work? How can I see what's happening under the hood? This chapter will help you answer some of these questions, and give you the tools to solve common Puppet problems. </p><p>We'll also see how to generate useful reports on your Puppet infrastructure and how Puppet can help you monitor and troubleshoot your network as a whole.</p></div></div>
<div class="section" title="Noop &#x2013; the don't change anything option"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec114"/>Noop – the don't change anything option</h1></div></div></div><p>Sometimes your Puppet manifest doesn't do exactly what you expected, or perhaps someone else has checked in changes you didn't know about. Either way, it's good to know exactly what Puppet is going to do before it does it.</p><p>When you are retrofitting Puppet into an existing infrastructure you might not know whether Puppet is going to update a <code class="literal">config</code> file or restart a production service. Any such change could result in unplanned downtime. Also, sometimes manual configuration changes are made on a server that Puppet would overwrite.</p><p>To avoid these problems, you can use Puppet's<a id="id650" class="indexterm"/> noop mode, which means no operation or do nothing. When run with the noop option, Puppet only reports what it would do but doesn't actually do anything. One caveat here is that even during a noop run, pluginsync still runs and any <code class="literal">lib</code> directories in modules will be synced to nodes. This will update external fact definitions and possibly Puppet's types and providers.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec317"/>How to do it...</h2></div></div></div><p>You may run <a id="id651" class="indexterm"/>noop mode when running <code class="literal">puppet agent</code> or <code class="literal">puppet apply</code> by appending the <code class="literal">--noop</code> switch to the command. You may also create a <code class="literal">noop=true</code> line in your <code class="literal">puppet.conf</code> file within the <code class="literal">[agent]</code> or <code class="literal">[main]</code> sections.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a <code class="literal">noop.pp</code> manifest that creates a file as follows:<div class="informalexample"><pre class="programlisting">file {'/tmp/noop':
  content =&gt; 'nothing',
  mode    =&gt; 0644,
}</pre></div></li><li class="listitem">Now run puppet agent with the <code class="literal">noop</code> switch:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>t@mylaptop ~/puppet/manifests $ puppet apply noop.pp --noop</strong></span>
<span class="strong"><strong>Notice: Compiled catalog for mylaptop in environment production in 0.41 seconds</strong></span>
<span class="strong"><strong>Notice: /Stage[main]/Main/File[/tmp/noop]/ensure: current_value absent, should be file (noop)</strong></span>
<span class="strong"><strong>Notice: Class[Main]: Would have triggered 'refresh' from 1 events</strong></span>
<span class="strong"><strong>Notice: Stage[main]: Would have triggered 'refresh' from 1 events</strong></span>
<span class="strong"><strong>Notice: Finished catalog run in 0.02 seconds</strong></span>
</pre></div></li><li class="listitem">Now run without the <code class="literal">noop</code> option to see that the file is created:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>t@mylaptop ~/puppet/manifests $ puppet apply noop.pp</strong></span>
<span class="strong"><strong>Notice: Compiled catalog for mylaptop in environment production in 0.37 seconds</strong></span>
<span class="strong"><strong>Notice: /Stage[main]/Main/File[/tmp/noop]/ensure: defined content as '{md5}3e47b75000b0924b6c9ba5759a7cf15d'</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec318"/>How it works...</h2></div></div></div><p>In the <code class="literal">noop</code> mode, Puppet <a id="id652" class="indexterm"/>does everything it would normally, with the exception of actually making any changes to the machine (the <code class="literal">exec</code> resources, for example, won't run). It tells you what it would have done, and you can compare this with what you expected to happen. If there are any differences, double-check the manifest or the current state of the machine.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note18"/>Note</h3><p>Note that when we ran with <code class="literal">--noop</code>, Puppet warned us that it would have created the <code class="literal">/tmp/noop</code> file. This may or may not be what we want, but it's useful to know in advance. If you are making changes to the code applied to your production servers, it's useful to run puppet agent with the <code class="literal">--noop</code> option to ensure that your changes will not affect the production services.</p></div></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec319"/>There's more...</h2></div></div></div><p>You can also use noop mode as a<a id="id653" class="indexterm"/> simple auditing tool. It will tell you whether any changes have been made to the machine since Puppet last applied its manifest. Some organizations require all config changes to be made with Puppet, which is one way of implementing a change control process. Unauthorized changes to the resources managed by Puppet can be detected using Puppet in noop mode and you can then decide whether to merge the changes back into the Puppet manifest or undo them.</p><p>You can also use the <code class="literal">--debug</code> switch when running puppet agent to see the details of every change Puppet makes during an agent run. This can be helpful when trying to figure out how Puppet is applying certain exec resources or to see in what order things are happening.</p><p>If you are running a master, you can compile the catalog for a node on the master with the <code class="literal">--trace</code> option in addition to <code class="literal">--debug</code>. If the catalog is failing to compile, this method will also fail to compile the catalog (if you have an old definition for the cookbook node that is failing, try commenting it out before running this test). This produces a lot of debugging output. For example, to compile the catalog for our cookbook host on our master and place the results into <code class="literal">/tmp/cookbook.log</code>:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>root@puppet: ~#puppet master --compile cookbook.example.com --debug --trace --logdest /tmp/cookbook.log</strong></span>
<span class="strong"><strong>Debug: Executing '/etc/puppet/cookbook.sh cookbook.example.com'</strong></span>
<span class="strong"><strong>Debug: Using cached facts for cookbook.example.com</strong></span>
<span class="strong"><strong>Info: Caching node for cookbook.example.com</strong></span>
<span class="strong"><strong>Debug: importing '/etc/puppet/environments/production/modules/enc/manifests/init.pp' in environment production</strong></span>
<span class="strong"><strong>Debug: Automatically imported enc from enc into production</strong></span>
<span class="strong"><strong>Notice: Compiled catalog for cookbook.example.com in environment production in 0.09 seconds</strong></span>
<span class="strong"><strong>Info: Caching catalog for cookbook.example.com</strong></span>
<span class="strong"><strong>Debug: Configuring PuppetDB terminuses with config file /etc/puppet/puppetdb.conf</strong></span>
<span class="strong"><strong>Debug: Using cached certificate for ca</strong></span>
<span class="strong"><strong>Debug: Using cached certificate for puppet</strong></span>
<span class="strong"><strong>Debug: Using cached certificate_revocation_list for ca</strong></span>
<span class="strong"><strong>Info: 'replace catalog' command for cookbook.example.com submitted to PuppetDB with UUIDe2a655ca-bd81-4428-b70a-a3a76c5f15d1</strong></span>
<span class="strong"><strong>{</strong></span>
<span class="strong"><strong>  "metadata": {</strong></span>
<span class="strong"><strong>    "api_version": 1</strong></span>
<span class="strong"><strong>  },</strong></span>
<span class="strong"><strong>  "data": {</strong></span>
<span class="strong"><strong>    "edges": [</strong></span>
<span class="strong"><strong>      {</strong></span>
<span class="strong"><strong>        "target": "Class[main]",</strong></span>
<span class="strong"><strong>        "source": "Stage[main]"</strong></span>
<span class="strong"><strong>...</strong></span>
</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note19"/>Note</h3><p>After compiling the <a id="id654" class="indexterm"/>catalog, Puppet will print out the catalog to the command line. The log file (<code class="literal">/tmp/cookbook.log</code>) will have a lot of information on how the catalog was compiled.</p></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec320"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Auditing resources</em></span> recipe in <a class="link" href="ch06.html" title="Chapter 6. Managing Resources and Files">Chapter 6</a>, <span class="emphasis"><em>Managing Resources and Files</em></span></li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Automatic syntax checking with Git hooks</em></span> recipe in <a class="link" href="ch02.html" title="Chapter 2. Puppet Infrastructure">Chapter 2</a>, <span class="emphasis"><em>Puppet Infrastructure</em></span></li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Generating reports</em></span> recipe in this chapter</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Testing your Puppet manifests with rspec-puppet</em></span> recipe in <a class="link" href="ch09.html" title="Chapter 9. External Tools and the Puppet Ecosystem">Chapter 9</a>, <span class="emphasis"><em>External Tools and the Puppet Ecosystem</em></span></li></ul></div></div></div>
<div class="section" title="Logging command output"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec115"/>Logging command output</h1></div></div></div><p>When you use the <code class="literal">exec</code> resources to <a id="id655" class="indexterm"/>run commands on the node, Puppet will give you an error message such as the following if a command returns a non-zero exit status:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Notice: /Stage[main]/Main/Exec[/bin/cat /tmp/missing]/returns: /bin/cat: /tmp/missing: No such file or directory</strong></span>
<span class="strong"><strong>Error: /bin/cat /tmp/missing returned 1 instead of one of [0]</strong></span>
<span class="strong"><strong>Error: /Stage[main]/Main/Exec[/bin/cat /tmp/missing]/returns: change from notrun to 0 failed: /bin/cat /tmp/missing returned 1 instead of one of [0]</strong></span>
</pre></div><p>As you can see, Puppet not only reports that the command failed, but shows its output:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>/bin/cat: /tmp/missing: No such file or directory</strong></span>
</pre></div><p>This is useful to figure out why the command didn't work, but sometimes the command actually succeeds (in that it returns a zero exit status) but still doesn't do what we wanted. In that case, how can you see the command output? You can use the <code class="literal">logoutput</code> attribute.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec321"/>How to do it...</h2></div></div></div><p>Follow these steps in order to log command output:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Define an <code class="literal">exec</code> resource with the <code class="literal">logoutput</code> parameter as shown in the following code snippet:<div class="informalexample"><pre class="programlisting">exec { 'exec with output':
  command   =&gt; '/bin/cat /etc/hostname',
logoutput =&gt; true,
}</pre></div></li><li class="listitem">Run Puppet:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>t@mylaptop ~/puppet/manifests $ puppet apply exec.pp</strong></span>
<span class="strong"><strong>Notice: Compiled catalog for mylaptop in environment production in 0.46 seconds</strong></span>
<span class="strong"><strong>Notice: /Stage[main]/Main/Exec[exec with outout]/returns: mylaptop</strong></span>
<span class="strong"><strong>Notice: /Stage[main]/Main/Exec[exec with outout]/returns: executed successfully</strong></span>
<span class="strong"><strong>Notice: Finished catalog run in 0.06 seconds</strong></span>
</pre></div></li><li class="listitem">As you can see, even though the command succeeds, Puppet prints the output:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>mylaptop</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec322"/>How it works...</h2></div></div></div><p>The <code class="literal">logoutput</code> attribute has three possible settings:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">false</code>: This never <a id="id656" class="indexterm"/>prints the command output</li><li class="listitem" style="list-style-type: disc"><code class="literal">on_failure</code>: This only <a id="id657" class="indexterm"/>prints the output if the command fails (the default setting)</li><li class="listitem" style="list-style-type: disc"><code class="literal">true</code>: This <a id="id658" class="indexterm"/>always <a id="id659" class="indexterm"/>prints the output, whether the command succeeds or fails</li></ul></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec323"/>There's more...</h2></div></div></div><p>You can set the default value of <code class="literal">logoutput</code> to always display command output for all <code class="literal">exec</code> resources by defining the following in your <code class="literal">site.pp</code> file:</p><div class="informalexample"><pre class="programlisting">Exec {
logoutput =&gt; true,</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note20"/>Note</h3><p>
<span class="strong"><strong>Resource defaults</strong></span>: What's <a id="id660" class="indexterm"/>this <a id="id661" class="indexterm"/>Exec syntax? It looks like an <code class="literal">exec</code> resource, but it's not. When you use <code class="literal">Exec</code> with a capital E, you're setting the resource default for exec. You may set the resource default for any resource by capitalizing the first letter of the resource type. Anywhere that Puppet see's that resource within the current scope or a nested subscope, it will apply the defaults you define.</p></div></div><p>If you never want to see the command<a id="id662" class="indexterm"/> output, whether it succeeds or fails, use:</p><div class="informalexample"><pre class="programlisting">logoutput =&gt; false,</pre></div><p>More information is available at <a class="ulink" href="https://docs.puppetlabs.com/references/latest/type.html#exec">https://docs.puppetlabs.com/references/latest/type.html#exec</a>.</p></div></div>
<div class="section" title="Logging debug messages"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec116"/>Logging debug messages</h1></div></div></div><p>It can be very helpful<a id="id663" class="indexterm"/> when debugging problems if you can print out information at a certain point in the manifest. This is a good way to tell, for example, if a variable isn't defined or has an unexpected value. Sometimes it's useful just to know that a particular piece of code has been run. Puppet's <code class="literal">notify</code> resource lets you print out such messages.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec324"/>How to do it...</h2></div></div></div><p>Define a <code class="literal">notify</code> resource in your manifest at the point you want to investigate:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>notify { 'Got this far!': }</strong></span>
</pre></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec325"/>How it works...</h2></div></div></div><p>When this resource is<a id="id664" class="indexterm"/> applied, Puppet will print out the message:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>notice: Got this far!</strong></span>
</pre></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec326"/>There's more...</h2></div></div></div><p>In addition to simple messages, we can output variables within our <code class="literal">notify</code> statements. Additionally, we can treat the <code class="literal">notify</code> calls the same as other resources, having them require or be required by other resources.</p><div class="section" title="Printing out variable values"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec34"/>Printing out variable values</h3></div></div></div><p>You can refer to <a id="id665" class="indexterm"/>variables in the message:</p><div class="informalexample"><pre class="programlisting">notify { "operatingsystem is ${::operatingsystem}": }</pre></div><p>Puppet will interpolate the values in the printout:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Notice: operatingsystem is Fedora</strong></span>
</pre></div><p>The double colon (<code class="literal">::</code>) before the fact name tells Puppet that this is a variable in top scope (accessible to all classes) and not local to the class. For more about how Puppet handles variable scope, see the <a id="id666" class="indexterm"/>Puppet Labs article:</p><p>
<a class="ulink" href="http://docs.puppetlabs.com/guides/scope_and_puppet.html">http://docs.puppetlabs.com/guides/scope_and_puppet.html</a>
</p></div><div class="section" title="Resource ordering"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec35"/>Resource ordering</h3></div></div></div><p>Puppet compiles your manifests into<a id="id667" class="indexterm"/> a catalog; the order in which resources are executed on the client (node) may not be the same as the order of the resources within your source files. When you are using a <code class="literal">notify</code> resource for debugging, you should use resource chaining to ensure that the <code class="literal">notify resource</code> is executed before or after your failing resource.</p><p>For example, if the exec <code class="literal">failing exec</code> is failing, you can chain a <code class="literal">notify resource</code> to run directly before the failed exec resource as shown here:</p><div class="informalexample"><pre class="programlisting">notify{"failed exec on ${hostname}": }-&gt;
exec {'failing exec':
  command   =&gt; "/bin/grep ${hostname} /etc/hosts",
logoutput =&gt; true,
}</pre></div><p>If you don't chain the resource or use a metaparameter such as <code class="literal">before</code> or <code class="literal">require</code>, there is no guarantee your <code class="literal">notify</code> statement will be executed near the other resources you are interested in debugging. More information on <a id="id668" class="indexterm"/>resource ordering can be found at <a class="ulink" href="https://docs.puppetlabs.com/puppet/latest/reference/lang_relationships.html">https://docs.puppetlabs.com/puppet/latest/reference/lang_relationships.html</a>.</p><p>For example, to have your <code class="literal">notify resource</code> run after <code class="literal">'failing exec'</code> in the preceding code snippet, use:</p><div class="informalexample"><pre class="programlisting">notify { 'Resource X has been applied':
  require =&gt; Exec['failing exec'],
}</pre></div><p>Note, however, that in this case the <code class="literal">notify resource</code> will fail to execute since the exec failed. When a resource fails, all the resources that depended on that resource are skipped:</p><div class="informalexample"><pre class="programlisting">notify {'failed exec failed': 
  require =&gt; Exec['failing exec']
}</pre></div><p>When we run Puppet, we see that the <code class="literal">notify resource</code> is skipped:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>t@mylaptop ~/puppet/manifests $ puppet apply fail.pp</strong></span>
<span class="strong"><strong>...</strong></span>
<span class="strong"><strong>Error: /bin/grepmylaptop /etc/hosts returned 1 instead of one of [0]</strong></span>
<span class="strong"><strong>Error: /Stage[main]/Main/Exec[failing exec]/returns: change from notrun to 0 failed: /bin/grepmylaptop /etc/hosts returned 1 instead of one of [0]</strong></span>
<span class="strong"><strong>Notice: /Stage[main]/Main/Notify[failed exec failed]: Dependency Exec[failing exec] has failures: true</strong></span>
<span class="strong"><strong>Warning: /Stage[main]/Main/Notify[failed exec failed]: Skipping because of failed dependencies</strong></span>
<span class="strong"><strong>Notice: Finished catalog run in 0.06 seconds</strong></span>
</pre></div></div></div></div>
<div class="section" title="Generating reports"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec117"/>Generating reports</h1></div></div></div><p>If you're managing a lot of <a id="id669" class="indexterm"/>machines, Puppet's reporting facility can give you some valuable information on what's actually happening out there.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec327"/>How to do it...</h2></div></div></div><p>To enable reports, just add this to a client's <code class="literal">puppet.conf</code>: within the <code class="literal">[main]</code> or <code class="literal">[agent]</code> sections:</p><div class="informalexample"><pre class="programlisting">report = true</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip19"/>Tip</h3><p>In recent versions (greater than 3.0) of Puppet, <code class="literal">report = true</code> is the default setting.</p></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec328"/>How it works...</h2></div></div></div><p>With reporting enabled, Puppet will generate a report file, containing data such as:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Date and time of the run</li><li class="listitem" style="list-style-type: disc">Total time for the run</li><li class="listitem" style="list-style-type: disc">Log messages output during the run</li><li class="listitem" style="list-style-type: disc">List of all the resources in the client's manifest</li><li class="listitem" style="list-style-type: disc">Whether Puppet changed any resources, and how many</li><li class="listitem" style="list-style-type: disc">Whether the run succeeded or failed</li></ul></div><p>By default, these reports <a id="id670" class="indexterm"/>are stored on the node at <code class="literal">/var/lib/puppet/reports</code> in a directory named after the hostname, but you can specify a different destination using the <code class="literal">reportdir</code> option. You can create your own scripts to process these reports (which are in the standard YAML format). When we run puppet agent on <code class="literal">cookbook.example.com</code>, the following file is created on the master:</p><div class="informalexample"><pre class="programlisting">/var/lib/puppet/reports/cookbook.example.com/201411230717.yaml</pre></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec329"/>There's more...</h2></div></div></div><p>If you have more than one master server, you can have all your reports sent to the same server by specifying <code class="literal">report_server</code> in the <code class="literal">[agent]</code> section of <code class="literal">puppet.conf</code>.</p><p>If you just want one report, or you don't want to enable reporting all the time, you can add the <code class="literal">--report</code> switch to the command line when you run Puppet agent manually:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[root@cookbook ~]# puppet agent -t --report</strong></span>
<span class="strong"><strong>Notice: Finished catalog run in 0.34 seconds</strong></span>
</pre></div><p>You won't see any additional output, but a report file will be generated in the <code class="literal">report</code> directory.</p><p>You can also see some overall statistics about a Puppet run by supplying the <code class="literal">--summarize</code> switch:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[root@cookbook ~]# puppet agent -t --report --summarize</strong></span>
<span class="strong"><strong>Notice: Finished catalog run in 0.35 seconds</strong></span>
<span class="strong"><strong>Changes:</strong></span>
<span class="strong"><strong>            Total: 2</strong></span>
<span class="strong"><strong>Events:</strong></span>
<span class="strong"><strong>            Total: 2</strong></span>
<span class="strong"><strong>          Success: 2</strong></span>
<span class="strong"><strong>Resources:</strong></span>
<span class="strong"><strong>            Total: 10</strong></span>
<span class="strong"><strong>          Changed: 2</strong></span>
<span class="strong"><strong>      Out of sync: 2</strong></span>
<span class="strong"><strong>Time:</strong></span>
<span class="strong"><strong>Filebucket: 0.00</strong></span>
<span class="strong"><strong>         Schedule: 0.00</strong></span>
<span class="strong"><strong>           Notify: 0.00</strong></span>
<span class="strong"><strong>Config retrieval: 0.94</strong></span>
<span class="strong"><strong>            Total: 0.95</strong></span>
<span class="strong"><strong>         Last run: 1416727357</strong></span>
<span class="strong"><strong>Version:</strong></span>
<span class="strong"><strong>Config: 1416727291</strong></span>
<span class="strong"><strong>           Puppet: 3.7.3</strong></span>
</pre></div><div class="section" title="Other report types"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec36"/>Other report types</h3></div></div></div><p>Puppet can generate different types of reports with the reports option in the <code class="literal">[main]</code> or <code class="literal">[master]</code> section of <code class="literal">puppet.conf</code> on your Puppet master servers. There are several built-in report types<a id="id671" class="indexterm"/> listed at <a class="ulink" href="https://docs.puppetlabs.com/references/latest/report.html">https://docs.puppetlabs.com/references/latest/report.html</a>. In addition to the built-in report types, there are some community developed reports that are quite useful. The Foreman<a id="id672" class="indexterm"/> (<a class="ulink" href="http://theforeman.org">http://theforeman.org</a>), for example, provides a Foreman report type that you can enable to forward your node reports to the Foreman.</p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec330"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Auditing resources</em></span> recipe in <a class="link" href="ch06.html" title="Chapter 6. Managing Resources and Files">Chapter 6</a>, <span class="emphasis"><em>Managing Resources and Files</em></span></li></ul></div></div></div>
<div class="section" title="Producing automatic HTML documentation"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec118"/>Producing automatic HTML documentation</h1></div></div></div><p>As your manifests get bigger and more complex, it can be helpful to create HTML documentation for your nodes and classes using Puppet's automatic documentation tool, <code class="literal">puppet doc</code>.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec331"/>How to do it...</h2></div></div></div><p>Follow these steps to generate <a id="id673" class="indexterm"/>HTML documentation for your manifest:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>t@mylaptop ~/puppet $ puppet doc --all --outputdir=/tmp/puppet --mode rdoc --modulepath=modules/</strong></span>
</pre></div></li><li class="listitem">This will generate a set of HTML files at <code class="literal">/tmp/puppet</code>. Open the top-level <code class="literal">index.html</code> file with your web browser (<code class="literal">file:///tmp/puppet/index.html</code>), and you'll see something like the following screenshot:<div class="mediaobject"><img src="graphics/B03643_10_01.jpg" alt="How to do it..."/></div></li><li class="listitem">Click the <a id="id674" class="indexterm"/>classes link on the left and select the Apache module, something similar to the following will be displayed:<div class="mediaobject"><img src="graphics/B03643_10_02.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec332"/>How it works...</h2></div></div></div><p>The<code class="literal"> puppet doc</code> command <a id="id675" class="indexterm"/>creates a structured HTML documentation tree similar to that produced by<a id="id676" class="indexterm"/> <span class="strong"><strong>RDoc</strong></span>, the popular Ruby documentation generator. This makes it easier to understand how different parts of the manifest relate to one another.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec333"/>There's more...</h2></div></div></div><p>The <code class="literal">puppet doc</code> command will <a id="id677" class="indexterm"/>generate basic documentation of your manifests <a id="id678" class="indexterm"/>as they stand, but you can include more useful information by adding comments to your manifest files, using the standard RDoc syntax. When we created our base class using puppet module generate, these comments <a id="id679" class="indexterm"/>were created for us:</p><div class="informalexample"><pre class="programlisting"># == Class: base
#
# Full description of class base here.
#
# === Parameters
#
# Document parameters here. #
# [*sample_parameter*]
#   Explanation of what this parameter affects and what it defaults to.
#   e.g. "Specify one or more upstream ntp servers as an array."
#
# === Variables
#
# Here you should define a list of variables that this module would require.
#
# [*sample_variable*]
#   Explanation of how this variable affects the funtion of this class and if
#   it has a default. e.g. "The parameter enc_ntp_servers must be set by the
#   External Node Classifier as a comma separated list of hostnames." (Note,
#   global variables should be avoided in favor of class parameters as
#   of Puppet 2.6.)
#
# === Examples
#
#  class { base:
#    servers =&gt; [ 'pool.ntp.org', 'ntp.local.company.com' ],
#  }
#
# === Authors
#
# Author Name &lt;author@domain.com&gt;
#
# === Copyright
#
# Copyright 2014 Your name here, unless otherwise noted.
#
class base {</pre></div><p>After generating the HTML documentation, we can see the result for the base module as shown in the following<a id="id680" class="indexterm"/> screenshot:</p><div class="mediaobject"><img src="graphics/B03643_10_03.jpg" alt="There's more..."/></div></div></div>
<div class="section" title="Drawing dependency graphs"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec119"/>Drawing dependency graphs</h1></div></div></div><p>Dependencies can<a id="id681" class="indexterm"/> get complicated quickly, and it's easy to end up with a circular dependency (where A depends on B, which depends on A) that will cause Puppet to complain and stop working. Fortunately, Puppet's <code class="literal">--graph</code> option makes it easy to generate a diagram of your resources and the dependencies between them, which can be a big help in fixing such problems.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec334"/>Getting ready</h2></div></div></div><p>Install the <code class="literal">graphviz</code> package to view the diagram files:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>t@mylaptop ~ $ sudo puppet resource package graphviz ensure=installed</strong></span>
<span class="strong"><strong>Notice: /Package[graphviz]/ensure: created</strong></span>
<span class="strong"><strong>package { 'graphviz':</strong></span>
<span class="strong"><strong>  ensure =&gt; '2.34.0-9.fc20',</strong></span>
<span class="strong"><strong>}</strong></span>
</pre></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec335"/>How to do it...</h2></div></div></div><p>Follow these steps to <a id="id682" class="indexterm"/>generate a dependency graph for your manifest:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create the directories for a new <code class="literal">trifecta</code> module:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>ubuntu@cookbook:~/puppet$ mkdir modules/trifecta</strong></span>
<span class="strong"><strong>ubuntu@cookbook:~/puppet$ mkdir modules/trifecta/manifests</strong></span>
<span class="strong"><strong>ubuntu@cookbook:~/puppet$ mkdir modules/trifecta/files</strong></span>
</pre></div></li><li class="listitem">Create the file <code class="literal">modules/trifecta/manifests/init.pp</code> with the following code containing a deliberate circular dependency (can you spot it?):<div class="informalexample"><pre class="programlisting">class trifecta {
  package { 'ntp':
    ensure  =&gt; installed,
    require =&gt; File['/etc/ntp.conf'],
  }

  service { 'ntp':
    ensure  =&gt; running,
    require =&gt; Package['ntp'],
  }

  file { '/etc/ntp.conf':
    source  =&gt; 'puppet:///modules/trifecta/ntp.conf',
    notify  =&gt; Service['ntp'],
    require =&gt; Package['ntp'],
  }
}</pre></div></li><li class="listitem">Create a simple <code class="literal">ntp.conf</code> file:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>t@mylaptop~/puppet $ cd modules/trifecta/files</strong></span>
<span class="strong"><strong>t@mylaptop~/puppet/modules/trifecta/files $ echo "server 127.0.0.1" &gt;ntp.conf</strong></span>
</pre></div></li><li class="listitem">Since we'll be working locally on this problem, create a <code class="literal">trifecta.pp</code> manifest that includes the broken trifecta class:<div class="informalexample"><pre class="programlisting">include trifecta</pre></div></li><li class="listitem">Run Puppet:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>t@mylaptop ~/puppet/manifests $ puppet apply trifecta.pp</strong></span>
<span class="strong"><strong>Notice: Compiled catalog for mylaptop in environment production in 1.32 seconds</strong></span>
<span class="strong"><strong>Error: Could not apply complete catalog: Found 1 dependency cycle:</strong></span>
<span class="strong"><strong>(File[/etc/ntp.conf] =&gt; Package[ntp] =&gt; File[/etc/ntp.conf])</strong></span>
<span class="strong"><strong>Try the '--graph' option and opening the resulting '.dot' file in OmniGraffle or GraphViz</strong></span>
</pre></div></li><li class="listitem">Run <a id="id683" class="indexterm"/>Puppet with the <code class="literal">--graph</code> option as suggested:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>t@mylaptop ~/puppet/manifests $ puppet apply trifecta.pp --graph</strong></span>
<span class="strong"><strong>Notice: Compiled catalog for mylaptop in environment production in 1.26 seconds</strong></span>
<span class="strong"><strong>Error: Could not apply complete catalog: Found 1 dependency cycle:</strong></span>
<span class="strong"><strong>(File[/etc/ntp.conf] =&gt; Package[ntp] =&gt; File[/etc/ntp.conf])</strong></span>
<span class="strong"><strong>Cycle graph written to /home/tuphill/.puppet/var/state/graphs/cycles.dot.</strong></span>
<span class="strong"><strong>Notice: Finished catalog run in 0.03 seconds</strong></span>
</pre></div></li><li class="listitem">Check whether the graph files have been created:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>t@mylaptop ~/puppet/manifests $ cd ~/.puppet/var/state/graphs</strong></span>
<span class="strong"><strong>t@mylaptop ~/.puppet/var/state/graphs $ ls -l</strong></span>
<span class="strong"><strong>total 16</strong></span>
<span class="strong"><strong>-rw-rw-r--. 1 thomasthomas  121 Nov 23 23:11 cycles.dot</strong></span>
<span class="strong"><strong>-rw-rw-r--. 1 thomasthomas 2885 Nov 23 23:11 expanded_relationships.dot</strong></span>
<span class="strong"><strong>-rw-rw-r--. 1 thomasthomas 1557 Nov 23 23:11 relationships.dot</strong></span>
<span class="strong"><strong>-rw-rw-r--. 1 thomasthomas 1680 Nov 23 23:11 resources.dot</strong></span>
</pre></div></li><li class="listitem">Create a graphic using the <code class="literal">dot</code> command as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>ubuntu@cookbook:~/puppet$ dot -Tpng -o relationships.png /var/lib/puppet/state/graphs/relationships.dot</strong></span>
</pre></div></li><li class="listitem">The graphic will look something like the this:<div class="mediaobject"><img src="graphics/B03643_10_04.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec336"/>How it works...</h2></div></div></div><p>When you <a id="id684" class="indexterm"/>run <code class="literal">puppet agent --graph</code> (or enable the <code class="literal">graph</code> option in <code class="literal">puppet.conf</code>), Puppet will generate three graphs in the DOT format (a graphics language):</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">resources.dot</code>: This shows<a id="id685" class="indexterm"/> the hierarchical structure of your classes and resources, but without dependencies</li><li class="listitem" style="list-style-type: disc"><code class="literal">relationships.dot</code>: This <a id="id686" class="indexterm"/>shows the dependencies between resources as arrows, as shown in the preceding image</li><li class="listitem" style="list-style-type: disc"><code class="literal">expanded_relationships.dot</code>: This is a more<a id="id687" class="indexterm"/> detailed version of the relationships graph</li></ul></div><p>The <code class="literal">dot</code> tool (part of the <code class="literal">graphviz</code> package) will convert these to an image format such as PNG for viewing.</p><p>In the relationships graph, each resource in your manifest is shown as a balloon (known as a vertex), with arrowed lines connecting them to indicate the dependencies. You can see that in our example, the dependencies between <code class="literal">File['/etc/ntp.conf']</code> and <code class="literal">Package['ntp']</code> are bidirectional. When Puppet tries to decide where to begin applying these resources, it can start at <code class="literal">File['/etc/ntp.conf']</code> and look for what depends on <code class="literal">File['/etc/ntp.conf']</code> and end up at <code class="literal">Package['ntp']</code>. When Puppet looks for the dependencies </p><p>of <code class="literal">Package['ntp']</code>, it will end up back at <code class="literal">File['/etc/ntp.conf']</code>, forming a circular path. This type of problem is known as a circular dependency problem; Puppet can't decide where to start because the two resources depend on each other.</p><p>To fix the <a id="id688" class="indexterm"/>circular dependency problem, all you need to do is remove one of the dependency lines and break the circle. The following code fixes the problem:</p><div class="informalexample"><pre class="programlisting">class trifecta {
  package { 'ntp':
    ensure  =&gt; installed,
  }

  service { 'ntp':
    ensure  =&gt; running,
    require =&gt; Package['ntp'],
  }

  file { '/etc/ntp.conf':
    source  =&gt; 'puppet:///modules/trifecta/ntp.conf',
    notify  =&gt; Service['ntp'],
    require =&gt; Package['ntp'],
  }
}</pre></div><p>Now when we run <code class="literal">puppet apply</code> or <code class="literal">agent</code> with the <code class="literal">--graph</code> option, the resulting graph does not have any circular paths (cycles):</p><div class="mediaobject"><img src="graphics/B03643_10_05.jpg" alt="How it works..."/></div><p>In this graph <a id="id689" class="indexterm"/>it is easy to see that <span class="strong"><strong>Package[ntp]</strong></span> is the first resource to be applied, then <span class="strong"><strong>File[/etc/ntp.conf]</strong></span>, and finally <span class="strong"><strong>Service[ntp]</strong></span>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip20"/>Tip</h3><p>A graph such as that shown previously is known as a <a id="id690" class="indexterm"/>Directed Acyclic Graph (DAG). Reducing the resources to a DAG ensures that Puppet can calculate the shortest path of all the vertices (resources) in linear time. For<a id="id691" class="indexterm"/> more information on DAGs, look at <a class="ulink" href="http://en.wikipedia.org/wiki/Directed_acyclic_graph">http://en.wikipedia.org/wiki/Directed_acyclic_graph</a>.</p></div></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec337"/>There's more...</h2></div></div></div><p>Resource<a id="id692" class="indexterm"/> and relationship graphs<a id="id693" class="indexterm"/> can be useful even when you don't have a bug to find. If you have a very complex network of classes and resources, for example, studying the resources graph can help you see where to simplify things. Similarly, when dependencies become too complicated to understand from reading the manifest, the graphs can be a useful form of documentation. For instance, a graph will make it readily apparent which resources have the most dependencies and which resources are required by the most other resources. Resources that are required by a large number of other resources will have numerous arrows pointing at them.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec338"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Using run stages</em></span> recipe in <a class="link" href="ch03.html" title="Chapter 3. Writing Better Manifests">Chapter 3</a>, <span class="emphasis"><em>Writing Better Manifests</em></span></li></ul></div></div></div>
<div class="section" title="Understanding Puppet errors"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec120"/>Understanding Puppet errors</h1></div></div></div><p>Puppet's error messages can sometimes be a little confusing. Updated and increasingly helpful error messages are one reason to upgrade your Puppet installation if you are running any version prior to Version 3.</p><p>Here are some of the most <a id="id694" class="indexterm"/>common errors you might encounter, and what to do about them.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec339"/>How to do it...</h2></div></div></div><p>Often the first step is simply to search the Web for the error message text and see what explanations you can find for the error, along with any helpful advice about fixing it. Here are some of the most common puzzling errors, with possible explanations:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Could not retrieve file metadata for XXX: getaddrinfo: Name or service not known</strong></span>
</pre></div><p>Where <code class="literal">XXX</code> is a file resource, you may have accidentally typed <code class="literal">puppet://modules...</code> in a file source instead of <code class="literal">puppet:///modules...</code> (note the triple slash):</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Could not evaluate: Could not retrieve information from environment production source(s) XXX</strong></span>
</pre></div><p>The source file may not be present or may not be in the right location in the Puppet repo:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Error: Could not set 'file' on ensure: No such file or directory XXX</strong></span>
</pre></div><p>The file path may specify a parent directory (or directories) that doesn't exist. You can use separate file resources in Puppet to create these:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>change from absent to file failed: Could not set 'file on ensure: No such file or directory</strong></span>
</pre></div><p>This is often caused by Puppet trying to write a file to a directory that doesn't exist. Check that the directory either exists already or is defined in Puppet, and that the file resource requires the directory (so that the directory is always created first):</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>undefined method 'closed?' for nil:NilClass</strong></span>
</pre></div><p>This unhelpful error message is roughly translated as <span class="emphasis"><em>something went wrong</em></span>. It tends to be a catch-all error caused by many different problems, but you may be able to determine what is wrong from the name of the resource, the class, or the module. One trick is to add the <code class="literal">--debug</code> switch, to get more useful information:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[root@cookbook ~]# puppet agent -t --debug</strong></span>
</pre></div><p>If you check your Git history to see what was touched in the most recent change, this may be another way to identify what's upsetting Puppet:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Could not parse for environment --- "--- production": Syntax error at end of file at line 1</strong></span>
</pre></div><p>This can be caused by mistyping command line options, for example, if you type <code class="literal">puppet -verbose</code> instead of <code class="literal">puppet --verbose</code>. This kind of error can be hard to see:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Duplicate definition: X is already defined in [file] at line Y; cannot redefine at [file] line Y</strong></span>
</pre></div><p>This one has <a id="id695" class="indexterm"/>caused me a bit of puzzlement in the past. Puppet's complaining about a duplicate definition, and normally if you have two resources with the same name, Puppet will helpfully tell you where they are both defined. But in this case, it's indicating the same file and line number for both. How can one resource be a duplicate of itself?</p><p>The answer is, if it's a defined type (a resource created with the <code class="literal">define</code> keyword). If you create two instances of a defined type you'll also have two instances of all the resources contained within the definition, and they need to have distinct names. For example:</p><div class="informalexample"><pre class="programlisting">define check_process() {
  exec { 'is-process-running?':
    command =&gt; "/bin/ps ax |/bin/grep ${name} &gt;/tmp/pslist.${name}.txt",
  }
}

check_process { 'exim': }
check_process { 'nagios': }</pre></div><p>When we run Puppet, the same error is printed twice:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>t@mylaptop ~$ puppet apply duplicate.pp</strong></span>
<span class="strong"><strong>Error: Duplicate declaration: Exec[is-process-running?] is already declared in file duplicate.pp:4; cannot redeclare at duplicate.pp:4 on node cookbook.example.com</strong></span>
<span class="strong"><strong>Error: Duplicate declaration: Exec[is-process-running?] is already declared in file duplicate.pp:4; cannot redeclare at duplicate.pp:4 on node cookbook.example.com</strong></span>
</pre></div><p>Because the <code class="literal">exec</code> resource is named <code class="literal">is-process-running?</code>, if you try to create more than one instance of the definition, Puppet will refuse because the result would be two <code class="literal">exec</code> resources with the same name. The solution is to include the name of the instance (or some other unique value) in the title of each resource:</p><div class="informalexample"><pre class="programlisting">exec { "is-process-${name}-running?":
  command =&gt; "/bin/ps ax |/bin/grep ${name} &gt;/tmp/pslist.${name}.txt",
}</pre></div><p>Every resource must have a unique name, and a good way to ensure this with a definition is to interpolate the <code class="literal">${name}</code> variable in its title. Note that we switched from using single to double quotes in the resource title:</p><div class="informalexample"><pre class="programlisting">"is-process-${name}-running?"</pre></div><p>The double quotes are<a id="id696" class="indexterm"/> required when you want Puppet to interpolate the value of a variable into a string.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec340"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Generating reports</em></span> recipe in this chapter</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Noop: the don't change anything option</em></span> recipe in this chapter</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Logging debug messages</em></span> recipe in this chapter</li></ul></div></div></div>
<div class="section" title="Inspecting configuration settings"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec121"/>Inspecting configuration settings</h1></div></div></div><p>You probably know <a id="id697" class="indexterm"/>that Puppet's configuration settings are stored in <code class="literal">puppet.conf</code>, but there are many parameters, and those that aren't listed in <code class="literal">puppet.conf</code> will take a default value. How can you see the value of any configuration parameter, regardless of whether or not it's explicitly set in <code class="literal">puppet.conf</code>? The answer is to use the <code class="literal">puppet config print</code> command.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec341"/>How to do it...</h2></div></div></div><p>Run the following command. This will produce a lot of output (it may be helpful to pipe it through <code class="literal">less</code> if you'd like to browse the available configuration settings):</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[root@cookbook ~]# puppet config print |head -25</strong></span>
<span class="strong"><strong>report_serialization_format = pson</strong></span>
<span class="strong"><strong>hostcsr = /var/lib/puppet/ssl/csr_cookbook.example.com.pem</strong></span>
<span class="strong"><strong>filetimeout = 15</strong></span>
<span class="strong"><strong>masterhttplog = /var/log/puppet/masterhttp.log</strong></span>
<span class="strong"><strong>pluginsignore = .svn CVS .git</strong></span>
<span class="strong"><strong>ldapclassattrs = puppetclass</strong></span>
<span class="strong"><strong>certdir = /var/lib/puppet/ssl/certs</strong></span>
<span class="strong"><strong>ignoreschedules = false</strong></span>
<span class="strong"><strong>disable_per_environment_manifest = false</strong></span>
<span class="strong"><strong>archive_files = false</strong></span>
<span class="strong"><strong>hiera_config = /etc/puppet/hiera.yaml</strong></span>
<span class="strong"><strong>req_bits = 4096</strong></span>
<span class="strong"><strong>clientyamldir = /var/lib/puppet/client_yaml</strong></span>
<span class="strong"><strong>evaltrace = false</strong></span>
<span class="strong"><strong>module_working_dir = /var/lib/puppet/puppet-module</strong></span>
<span class="strong"><strong>tags = </strong></span>
<span class="strong"><strong>cacrl = /var/lib/puppet/ssl/ca/ca_crl.pem</strong></span>
<span class="strong"><strong>manifest = /etc/puppet/manifests/site.pp</strong></span>
<span class="strong"><strong>inventory_port = 8140</strong></span>
<span class="strong"><strong>ignoreimport = false</strong></span>
<span class="strong"><strong>dbuser = puppet</strong></span>
<span class="strong"><strong>postrun_command = </strong></span>
<span class="strong"><strong>document_all = false</strong></span>
<span class="strong"><strong>splaylimit = 1800</strong></span>
<span class="strong"><strong>certificate_expire_warning = 5184000</strong></span>
</pre></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec342"/>How it works...</h2></div></div></div><p>Running <code class="literal">puppet config print</code> will<a id="id698" class="indexterm"/> output every configuration parameter and its current value (and there are lots of them).</p><p>To see the value for a specific parameter, add it as an argument to <code class="literal">puppet config print</code> command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[root@cookbook ~]# puppet config print modulepath</strong></span>
<span class="strong"><strong>/etc/puppet/modules:/usr/share/puppet/modules</strong></span>
</pre></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec343"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Generating reports</em></span> recipe in this chapter</li></ul></div></div></div></body></html>