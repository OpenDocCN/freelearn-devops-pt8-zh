- en: Monitoring and Troubleshooting Virtual Networking
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 监控和排除虚拟网络问题
- en: In the previous chapter, we covered the second part of the *Deploying and Managing
    Virtual Networks* objective. We've covered how to integrate your on-premises network
    with an Azure virtual network.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们讨论了*部署和管理虚拟网络*目标的第二部分。我们讨论了如何将本地网络与 Azure 虚拟网络集成。
- en: This chapter covers the third part of the *Deploying and Managing Virtual Networks*
    objective by covering how to monitor and troubleshoot virtual networking. In this
    chapter, we are going to focus on how you can monitor your virtual networks using
    **Network Watcher**. You will learn how to manage your virtual network connectivity
    and how you can monitor and troubleshoot on-premises connectivity as well use
    Network Watcher. We will end this chapter by covering how to manage external networking.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章覆盖了*部署和管理虚拟网络*目标的第三部分，涵盖了如何监视和排除虚拟网络的内容。在本章中，我们将重点介绍如何使用**Network Watcher**监视您的虚拟网络。您将学习如何管理虚拟网络连接以及如何监视和排除本地连接，以及如何使用Network
    Watcher。我们将在本章结束时介绍如何管理外部网络。
- en: 'We will look at the following topics in this chapter:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将讨论以下主题：
- en: Network Watcher
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Network Watcher
- en: Network resource monitoring
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网络资源监控
- en: Managing virtual network connectivity
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 管理虚拟网络连接
- en: Monitoring and troubleshooting on-premises connectivity
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 监控和故障排除本地连接
- en: Managing external networking
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 管理外部网络
- en: Network Watcher
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Network Watcher
- en: Azure Network Watcher is a network monitoring solution that provides tools to
    diagnose, monitor, and view metrics and logging for resources in an Azure Virtual
    Network. This includes application gateway traffic, Load Balancers, ExpressRoute circuits,
    and more.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Network Watcher 是一个网络监控解决方案，提供诊断、监视和查看 Azure 虚拟网络中资源的指标和日志，包括应用程序网关流量、负载均衡器、ExpressRoute
    回路等。
- en: 'Azure Network Watcher offers the following capabilities:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Network Watcher 提供以下功能：
- en: '**Monitoring**: Connection monitor is a cloud-based hybrid network monitoring solution
    that can monitor the communication between virtual machines and endpoints. An
    endpoint can be another **Virtual Machine** (**VM**), a URL, an IPv4 address,
    or a **Fully Qualified Domain Name** (**FQDN**). The network communication is
    monitored at regular intervals and information about latency, network topology
    changes, and the reachability between a VM and the endpoint is collected. If an
    endpoint becomes unreachable, Network Watcher will inform the user about the error.
    The reason for this can be a problem with the memory or CPU of a VM, a security
    rule for the VM, or the hop type of a custom route. Latency problems are also
    monitored. The connection monitor will provide the average, minimum, and maximum
    latency observed over time. The monitoring solution is capable of monitoring network
    performance between various points in the network infrastructure and it can generate
    alerts and notifications.'
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**监控**：连接监视器是一种云基础的混合网络监视解决方案，可以监视虚拟机和终端点之间的通信。终端点可以是另一个**虚拟机**（**VM**）、一个URL、一个IPv4地址或者一个**完全限定域名**（**FQDN**）。网络通信会定期监控，收集虚拟机与终端点之间的延迟、网络拓扑变化以及可达性的信息。如果一个终端点变得不可访问，Network
    Watcher 将会通知用户出现错误。导致此问题的原因可能是虚拟机的内存或CPU问题、虚拟机的安全规则或自定义路由的跳数类型。还会监控延迟问题。连接监视器将提供随时间观察到的平均、最小和最大延迟。该监视解决方案能够监视网络基础设施中各个点之间的网络性能，并能生成警报和通知。'
- en: '**Diagnostics**: You can diagnose network traffic filtering for VMs. The VM
    can, for instance, become unable to communicate with other resources because of
    a security rule.'
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**诊断**：您可以诊断虚拟机的网络流量过滤。例如，由于安全规则，虚拟机可能无法与其他资源通信。'
- en: An IP flow can verify and test the communication and informs you as to whether
    the connection has succeeded or failed. An IP flow can tell you which security
    rule allowed or denied the connection and communication. Network Watcher can also
    diagnose network routing problems from a VM. When a virtual network is created,
    there are several default outbound routes created for that VNet as well. Outbound
    traffic from all resources that are deployed in a virtual network are routed based
    on Azure's default routes.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: IP 流可以验证和测试通信，并告知您连接是成功还是失败。IP 流可以告诉您哪个安全规则允许或拒绝了连接和通信。Network Watcher 还可以诊断从虚拟机出现的网络路由问题。创建虚拟网络时，会为该虚拟网络创建几个默认的出站路由。所有部署在虚拟网络中的资源的出站流量都基于
    Azure 的默认路由进行路由。
- en: In cases where you want to override the default routing rules, or create additional
    rules, **next hop** can be used to test the communication between the different
    routes. When the communication fails, you can then change, add, or remove a route
    to resolve the problem.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 在需要覆盖默认路由规则或创建额外规则的情况下，**next hop**可以用于测试不同路由之间的通信。当通信失败时，你可以更改、添加或删除路由来解决问题。
- en: 'Using Azure Network Watcher, you can diagnose outbound connection from a VM.
    You can also diagnose problems with an Azure Virtual Network gateway and connections, capture
    packets to and from a VM, view security rules for a network interface, and determine
    relative latencies between Azure regions and internet service providers:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Azure Network Watcher，你可以诊断虚拟机的出站连接。你还可以诊断Azure虚拟网络网关和连接的问题，捕获虚拟机的进出数据包，查看网络接口的安全规则，并确定Azure区域和互联网服务提供商之间的相对延迟：
- en: '**Metrics**:The network subscription limit feature can provide a summary of
    how many network resources there are deployed in a subscription or region. If
    the limitations of the maximum amount of network resources are met, a summary
    is provided.'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**指标**：网络订阅限制功能可以提供已在订阅或区域中部署的网络资源的摘要。如果达到了最大网络资源数量的限制，将提供一个摘要。'
- en: '**Logs**: **N****etwork Security Groups** (**NSGs**) are responsible for allowing
    or denying the inbound and outbound traffic to a network interface in the virtual
    machine. The NSG flow log feature can log the port, protocol, whether traffic
    is allowed or denied, and can log the source and IP address. These logs can be
    analyzed using several tools, such as the traffic analytics feature and Power
    BI. Traffic analytics can provide rich visualization of the data that is written
    to the NSG flow logs.'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**日志**：**网络安全组**（**NSGs**）负责允许或拒绝虚拟机网络接口的入站和出站流量。NSG流量日志功能可以记录端口、协议、流量是否被允许或拒绝，并记录源和IP地址。这些日志可以使用多种工具进行分析，例如流量分析功能和Power
    BI。流量分析可以提供对写入NSG流量日志的数据的丰富可视化。'
- en: '**Automatic enablement**: Network Watcher will be automatically enabled when
    a new virtual network is created or updated. There is no extra charge for enabling
    Network Watcher inside a subscription.'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**自动启用**：当创建或更新新的虚拟网络时，Network Watcher会自动启用。在订阅中启用Network Watcher没有额外费用。'
- en: In the following sections, we are going to see Network Watcher in action.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的部分中，我们将看到Network Watcher的实际应用。
- en: Network resource monitoring
  id: totrans-21
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 网络资源监控
- en: In this demonstration, we are going to monitor the network on VMs. For this
    demonstration, create three Windows Server 2016 datacenter VMs inside one virtual
    network. We can use these VMs for monitoring.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 在本演示中，我们将监控虚拟机上的网络。为了演示，我们将在同一虚拟网络内创建三个Windows Server 2016数据中心虚拟机。我们可以使用这些虚拟机进行监控。
- en: Before we are able to monitor the network using network resource monitoring,
    we need to install the Network Watcher agent on the three VMs. After that, we
    are going to inspect the network traffic.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们能够通过网络资源监控来监控网络之前，我们需要在三个虚拟机上安装Network Watcher代理。安装后，我们将检查网络流量。
- en: Installing the Network Watcher agent
  id: totrans-24
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装Network Watcher代理
- en: 'To install the Network Watcher agent on a VM in Azure, take the following steps:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 要在Azure中的虚拟机上安装Network Watcher代理，按照以下步骤操作：
- en: Navigate to the Azure portal by opening [https://portal.azure.com/](https://portal.azure.com/).
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过打开[https://portal.azure.com/](https://portal.azure.com/)访问Azure门户。
- en: 'Open the VM settings, and under **Settings**, select **Extensions**, and then click
    the **Add **button:'
  id: totrans-27
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开虚拟机设置，在**设置**下选择**扩展**，然后点击**添加**按钮：
- en: '![](img/58cea88a-047f-4a8f-9a63-84e2ee099e7d.png)'
  id: totrans-28
  prefs: []
  type: TYPE_IMG
  zh: '![](img/58cea88a-047f-4a8f-9a63-84e2ee099e7d.png)'
- en: Adding a VM extension
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 添加虚拟机扩展
- en: 'Add the **Network Watcher Agent for Windows **extension to the VM (extensions
    can be installed on the VM during creation as well), and click **Create**:'
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将**Network Watcher Agent for Windows**扩展添加到虚拟机（扩展也可以在创建虚拟机时安装），然后点击**创建**：
- en: '![](img/a6e6c7fd-705c-4457-bcd9-6c473275ccd9.png)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a6e6c7fd-705c-4457-bcd9-6c473275ccd9.png)'
- en: Adding the Network Watcher Agent for Windows extension
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 添加Network Watcher Agent for Windows扩展
- en: Repeat these steps for the other two VMs as well, and install the agent on it.
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对其他两个虚拟机重复这些步骤，并在其上安装代理。
- en: Now that the **Network Watcher Agent for** **Windows** is installed on all the
    VMs, we can enable it for a specific region.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，**Network Watcher Agent for Windows**已安装在所有虚拟机上，我们可以在特定区域启用它。
- en: Enabling Network Watcher
  id: totrans-35
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 启用Network Watcher
- en: 'To enable Network Watcher in a specific region, take the following steps:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 要在特定区域启用Network Watcher，按照以下步骤操作：
- en: Navigate to the Azure portal by opening [https://portal.azure.com/](https://portal.azure.com/).
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过打开[https://portal.azure.com/](https://portal.azure.com/)来导航到Azure门户。
- en: 'Select **All services**, and in the top menu, type `network watcher`:'
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**所有服务**，然后在顶部菜单中输入`network watcher`：
- en: '![](img/22b497c0-2d94-4133-ad8c-c14a0409d56b.png)'
  id: totrans-39
  prefs: []
  type: TYPE_IMG
  zh: '![](img/22b497c0-2d94-4133-ad8c-c14a0409d56b.png)'
- en: Opening Network Watcher
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 打开Network Watcher
- en: 'In the **Network Watcher** overview page, select the subscription and the region
    where the VMs are created. In my case, this is **East US**. Then click the three
    dots and enable Network Watcher for that region, as follows:'
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**Network Watcher**概览页面中，选择虚拟机创建所在的订阅和区域。在我的例子中，这个区域是**美国东部**。然后点击三个点并为该区域启用Network
    Watcher，如下所示：
- en: '![](img/69133476-2cbc-46c7-bba3-0bed6c717e52.png)'
  id: totrans-42
  prefs: []
  type: TYPE_IMG
  zh: '![](img/69133476-2cbc-46c7-bba3-0bed6c717e52.png)'
- en: Enabling Network Watcher
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 启用Network Watcher
- en: Now that Network Watcher is enabled, we can actually start monitoring the network
    resources.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，Network Watcher已启用，我们可以实际开始监控网络资源。
- en: Monitoring the network connectivity
  id: totrans-45
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 监视网络连接性
- en: 'Network monitoring can be used for monitoring connection reachability, latency,
    and network topology changes. To do this you need to set up a connection monitor
    instance. Take the following steps to set this up:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 网络监视可以用来监控连接可达性、延迟以及网络拓扑变化。为此，您需要设置一个连接监视器实例。请按照以下步骤进行设置：
- en: 'With the Network Watcher resource still open, under **Monitoring**, select **Connection
    monitor**:'
  id: totrans-47
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Network Watcher资源仍然打开的情况下，在**监视**下，选择**连接监视器**：
- en: '![](img/f0a9c865-e6c0-4dc4-a754-9d56f194ed21.png)'
  id: totrans-48
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f0a9c865-e6c0-4dc4-a754-9d56f194ed21.png)'
- en: Connection monitor
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 连接监视器
- en: 'We are going to use the monitor resource for testing the connectivity between
    `VM1` and `VM2`. Therefore, add the following values:'
  id: totrans-50
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将使用监视器资源来测试`VM1`和`VM2`之间的连接性。因此，添加以下值：
- en: '**Name**: `VM1-VM2-Test`.'
  id: totrans-51
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**名称**：`VM1-VM2-Test`。'
- en: '**Subscription**: Select the subscription where the VMs are deployed.'
  id: totrans-52
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**订阅**：选择虚拟机部署所在的订阅。'
- en: '**Source virtual machine**: `VM1`.'
  id: totrans-53
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**源虚拟机**：`VM1`。'
- en: '**Destination ****virtual machine**: `VM2`.'
  id: totrans-54
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**目标虚拟机**：`VM2`。'
- en: '**Port:** `22`:'
  id: totrans-55
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**端口**：`22`：'
- en: '![](img/7f93bb5d-cdf8-43a5-9514-0c0f0f9d5e70.png)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
  zh: '![](img/7f93bb5d-cdf8-43a5-9514-0c0f0f9d5e70.png)'
- en: Connection monitor settings
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 连接监视器设置
- en: Click **Add**.
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**添加**。
- en: We are now able to monitor the network connectivity. In the next section, we
    are going to look at how to manage the connectivity.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以监视网络连接性了。在接下来的部分中，我们将了解如何管理连接性。
- en: Managing virtual network connectivity
  id: totrans-60
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 管理虚拟网络连接性
- en: You can manage your virtual network connectivity from the Azure portal. In the
    upcoming section, we are going to look at the possibilities that the Azure portal
    has to offer to manage the virtual network connectivity.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过Azure门户管理虚拟网络连接性。在接下来的部分中，我们将了解Azure门户提供的管理虚拟网络连接性的各种功能。
- en: Network topology
  id: totrans-62
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 网络拓扑
- en: 'The network topology section in the Azure portal displays an overview of the
    virtual networks inside an Azure subscription and a resource group. To go to the
    network topology section, you have to take the following steps:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: Azure门户中的网络拓扑部分显示了Azure订阅和资源组内虚拟网络的概览。要进入网络拓扑部分，您需要执行以下步骤：
- en: Navigate to the Azure portal by opening [https://portal.azure.com/](https://portal.azure.com/).
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过打开[https://portal.azure.com/](https://portal.azure.com/)来导航到Azure门户。
- en: Select **All** **services**, and, in the top menu, type `network watcher` again.
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**所有**服务，然后在顶部菜单中再次输入`network watcher`。
- en: 'Under **Monitoring**, select **Topology**. In there, you need to select the
    subscription, resource group, and, if relevant, the virtual network, as shown
    in the following screenshot:'
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**监视**下，选择**拓扑**。在此，您需要选择订阅、资源组，并在相关时选择虚拟网络，如下图所示：
- en: '![](img/42812342-75cb-492c-8291-4fc36cae5afb.png)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
  zh: '![](img/42812342-75cb-492c-8291-4fc36cae5afb.png)'
- en: Network topology
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 网络拓扑
- en: You can now drill down into all the components of the network, such as the VNet,
    NIC, VMs, IP address, and more, by clicking on the items in the topology. This
    will take you to the settings of the different resources.
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，您可以通过点击拓扑中的各个项目，深入查看网络的所有组件，如虚拟网络（VNet）、网络接口卡（NIC）、虚拟机（VM）、IP 地址等。这将带您进入不同资源的设置页面。
- en: 'You can download the topology as well, by clicking the **Download topology **button
    in the top menu, as follows:'
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您还可以通过点击顶部菜单中的**下载拓扑**按钮来下载拓扑，如下所示：
- en: '![](img/ab8ac0ee-9308-4af0-9b3c-f879bffabea8.png)'
  id: totrans-71
  prefs: []
  type: TYPE_IMG
  zh: '![](img/ab8ac0ee-9308-4af0-9b3c-f879bffabea8.png)'
- en: Downloading the network topology
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 下载网络拓扑
- en: Besides monitoring the networks in Azure, you can also monitor the on-premises
    connectivity. We are going to look at this in the next section.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 除了监控Azure中的网络外，您还可以监控本地网络连接。我们将在下一部分中查看这一点。
- en: Monitoring and troubleshooting on-premises connectivity
  id: totrans-74
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 监控和故障排除本地连接性
- en: You can monitor your on-premises connectivity using Network Watcher as well.
    It offers two different features for this, **Network Performance Monitor** and
    **VPN Troubleshoot**, which, just like the other features, are accessible from
    the Azure portal.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 您也可以使用网络观察器监控本地连接性。它提供了两种不同的功能，**网络性能监控器**和**VPN故障排除**，这些功能与其他功能一样，都可以从Azure门户访问。
- en: Network Performance Monitor
  id: totrans-76
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 网络性能监控器
- en: '**Network Performance Monitor** is a hybrid network monitoring solution. It
    can monitor network connectivity for on-premises and cloud networks, and between
    various points in your network infrastructure. It can detect issues such as routing
    errors and **blackholing**. The monitoring solution is stored inside Azure Log
    Analytics.'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: '**网络性能监控器**是一个混合网络监控解决方案。它可以监控本地和云网络的连接性，以及网络基础设施中各个点之间的连接。它能够检测路由错误和**黑洞**等问题。监控解决方案存储在Azure日志分析中。'
- en: Network Performance Monitor can create alerts and notifications when network
    performance errors appear and it can localize the source of the problem to a specific
    network device or segment.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 网络性能监控器可以在出现网络性能错误时创建警报和通知，并能够将问题的源定位到特定的网络设备或段。
- en: 'It offers the following capabilities:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 它提供以下功能：
- en: '**Performance monitor**: A performance monitor can monitor the network connectivity
    across cloud deployments and on-premises locations. It can also monitor connectivity
    between multiple data centers, branch offices, multi-tier applications, and microservices.'
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**性能监控器**：性能监控器可以监控跨云部署和本地位置的网络连接。它还可以监控多个数据中心、分支办公室、多层应用程序和微服务之间的连接。'
- en: '**Service connectivity monitor**: You can identify the network bottlenecks
    inside the network infrastructure and detect the exact locations of the issues
    in the network. You can also monitor connectivity between users and services.'
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**服务连接监控器**：您可以识别网络基础设施中的网络瓶颈，并检测网络中问题的确切位置。您还可以监控用户与服务之间的连接。'
- en: '**ExpressRoute monitor**: You can monitor the ExpressRoute connection between
    the on-premises locations and Azure.'
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**ExpressRoute监控**：您可以监控本地位置与Azure之间的ExpressRoute连接。'
- en: Next hop
  id: totrans-83
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 下一跳
- en: You can use the **next hop** feature to specify a source and destination IPv4
    address. The communication between these addresses is then tested, and you will
    get informed about what type of next hop is used to route the traffic. When you
    experience a routing error or problem, you can add, change, or remove a route
    to resolve this.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用**下一跳**功能来指定源和目标IPv4地址。然后测试这些地址之间的通信，并告知您使用了哪种下一跳来路由流量。当遇到路由错误或问题时，您可以添加、修改或删除路由来解决问题。
- en: 'To see this in action, you need to take the following steps:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看此功能，请执行以下步骤：
- en: Navigate to the Azure portal by opening [https://portal.azure.com/](https://portal.azure.com/).
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过打开[https://portal.azure.com/](https://portal.azure.com/)导航到Azure门户。
- en: Select **All** **services**, and in the top menu, type `network watcher`.
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**所有**服务，在顶部菜单中输入`network watcher`。
- en: Under **Network diagnostic tools**, select **Next hop**.
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**网络诊断工具**下，选择**下一跳**。
- en: 'In the settings blade, add the following values:'
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**设置**窗格中，添加以下值：
- en: '**Resource group**: `PacktNetworkWatcher`.'
  id: totrans-90
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**资源组**：`PacktNetworkWatcher`。'
- en: '**Virtual machine**: `VM2`.'
  id: totrans-91
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**虚拟机**：`VM2`。'
- en: '**Network interface**: This is selected automatically.'
  id: totrans-92
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**网络接口**：这会自动选择。'
- en: '**Source IP address**: This is selected automatically as well.'
  id: totrans-93
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**源IP地址**：这也会自动选择。'
- en: '**Destination IP address**: `13.107.21.200` (the Bing server again).'
  id: totrans-94
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**目标IP地址**：`13.107.21.200`（再次是Bing服务器）。'
- en: Select **Next hop**.
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**下一跳**。
- en: 'You will see the following result. In this case, there is no next hop, because
    the connection is going straight to the internet:'
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您将看到以下结果。在这种情况下，没有下一跳，因为连接直接访问互联网：
- en: '![](img/2b5dad95-1998-430a-aa5d-ed1aa419e240.png)'
  id: totrans-97
  prefs: []
  type: TYPE_IMG
  zh: '![](img/2b5dad95-1998-430a-aa5d-ed1aa419e240.png)'
- en: Next hop to internet
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 下一跳到互联网
- en: 'If you change the destination IP address to one of the IP addresses of the
    other VMs, which in my case is `172.18.0.6`, you will see the following result:'
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您将**目标IP地址**更改为其他虚拟机的IP地址，比如`172.18.0.6`，您将看到以下结果：
- en: '![](img/b3421443-cf74-46ac-97f3-7912401fc898.png)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
  zh: '![](img/b3421443-cf74-46ac-97f3-7912401fc898.png)'
- en: Next hop to another VM
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 下一跳到另一台虚拟机
- en: In the next section, we are going to look at how to troubleshoot a VPN connection.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一部分，我们将介绍如何排查VPN连接问题。
- en: VPN troubleshoot
  id: totrans-103
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: VPN故障排除
- en: For the VPN troubleshoot demonstration, we are going to use the VPN connection
    that we created in the previous chapter.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 在VPN故障排除演示中，我们将使用前一章节中创建的VPN连接。
- en: 'You can diagnose the VPN connection by taking the following steps:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过以下步骤诊断VPN连接：
- en: From the **Network Watcher** blade, select **VPN troubleshoot**.
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从**Network Watcher**面板中，选择**VPN故障排除**。
- en: 'In the **Network Watcher -** **VPN troubleshoot** blade, you can diagnose the
    gateway by selecting the subscription, resource group, location, and the following
    checkbox. You also need to select or create a storage account for storing the diagnostic
    information. After selecting the checkbox, you can start the troubleshooting process
    by clicking **Start troubleshooting **in the top menu, as shown in the following
    screenshot:'
  id: totrans-107
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**Network Watcher -** **VPN故障排除**面板中，您可以通过选择订阅、资源组、位置以及以下复选框来诊断网关。您还需要选择或创建一个存储帐户来存储诊断信息。选择复选框后，您可以通过点击顶部菜单中的**开始故障排除**来启动故障排除过程，如下图所示：
- en: '![](img/95450815-68a0-465d-9b6d-2a55803bbd98.png)'
  id: totrans-108
  prefs: []
  type: TYPE_IMG
  zh: '![](img/95450815-68a0-465d-9b6d-2a55803bbd98.png)'
- en: VPN troubleshooting
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: VPN故障排除
- en: 'This will start the troubleshooting process, and, in my case, the VPN connections
    seem unhealthy. You can click on the **Action **tab to see the recommendations:'
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这将启动故障排除过程，在我的情况下，VPN连接似乎不健康。您可以点击**操作**标签查看建议：
- en: '![](img/80580be2-df9f-44f3-bbed-67759e19c8d0.png)'
  id: totrans-111
  prefs: []
  type: TYPE_IMG
  zh: '![](img/80580be2-df9f-44f3-bbed-67759e19c8d0.png)'
- en: Unhealthy VPN connection
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 不健康的VPN连接
- en: You can manage external networking using Azure Network Watcher as well. We will
    cover this in the upcoming section.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以使用Azure Network Watcher管理外部网络。我们将在接下来的部分中介绍这一点。
- en: Managing external networking
  id: totrans-114
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 管理外部网络
- en: Azure Network Watcher offers three features to monitor and troubleshoot external
    networking. Their features are **IP flow verify**, **Effective security rules**,
    and **Connection troubleshoot**, which are going to be covered in the next sections.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Network Watcher提供三种功能来监控和故障排除外部网络。它们的功能包括**IP流验证**、**有效安全规则**和**连接故障排除**，这些将在接下来的章节中介绍。
- en: IP flow verify
  id: totrans-116
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: IP流验证
- en: With **IP flow verify**, you can detect whether a package is allowed or denied
    to or from a network interface of a virtual machine. Included in the information
    are the protocol, the local and remote IP addresses, the direction, and the local
    and remote ports. When a packet is denied, the name of the routing rule that denies
    the packet is returned. You can use this to diagnose connectivity issues from
    or in the on-premises environment and to and from the internet. You can basically
    choose any source or IP address to verify the connectivity.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 使用**IP流验证**，您可以检测是否允许或拒绝来自虚拟机网络接口的包。信息中包括协议、本地和远程IP地址、方向以及本地和远程端口。当一个包被拒绝时，返回拒绝包的路由规则名称。您可以利用这一点诊断从本地环境或外部网络到互联网的连接问题。您基本可以选择任何源或IP地址来验证连接。
- en: To run IP flow verify, you need to enable an instance of Network Watcher in
    the region where you plan to run the tool. This is similar to the demonstration
    covered in the *Enabling Network Watcher* section that appeared earlier in this
    chapter, where we enabled Network Watcher for a particular region.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 要运行IP流验证，您需要在计划运行该工具的区域启用一个Network Watcher实例。这类似于本章前面**启用Network Watcher**部分中的演示，我们在特定区域启用了Network
    Watcher。
- en: Using IP flow verify
  id: totrans-119
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用IP流验证
- en: 'In this demonstration, we are going to use IP flow verify to test the connection
    between two of the VMs that we created in the first demonstration. To use IP flow
    verify, take the following steps:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 在本演示中，我们将使用IP流验证来测试在第一次演示中创建的两台虚拟机之间的连接。要使用IP流验证，请按照以下步骤操作：
- en: Inside the Network Watcher resource blade, under **Network diagnostic tools**,
    select **IP flow verify**.
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Network Watcher资源面板内，选择**网络诊断工具**下的**IP流验证**。
- en: 'In the settings page, add the following settings:'
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在设置页面中，添加以下设置：
- en: '**Resource group**:`PacktNetworkWatcher`.'
  id: totrans-123
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**资源组**：`PacktNetworkWatcher`。'
- en: '**Virtual machine**: `VM1`.'
  id: totrans-124
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**虚拟机**：`VM1`。'
- en: '**Network interface**: This will be filled in automatically after selecting
    the VM.'
  id: totrans-125
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**网络接口**：选择虚拟机后将自动填写。'
- en: '**Protocol**: TCP.'
  id: totrans-126
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**协议**：TCP。'
- en: '**Direction**: Outbound.'
  id: totrans-127
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**方向**：出站。'
- en: '**Local IP address**: This is filled in automatically as well.'
  id: totrans-128
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**本地 IP 地址**：此项也会自动填写。'
- en: '**Local port**: `60000`.'
  id: totrans-129
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**本地端口**：`60000`。'
- en: '**Remote IP address**: `13.107.21.200` (address of Bing).'
  id: totrans-130
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**远程 IP 地址**：`13.107.21.200`（必应的地址）。'
- en: '**Remote port**: `80`.'
  id: totrans-131
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**远程端口**：`80`。'
- en: 'Click the **Check** button:'
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **检查** 按钮：
- en: '![](img/e7dbadcb-4096-4784-ac82-627fd86da20d.png)'
  id: totrans-133
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e7dbadcb-4096-4784-ac82-627fd86da20d.png)'
- en: IP flow verify
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: IP 流量验证
- en: 'The request is executed and the result it will return will be that access is
    allowed, because of the `AllowInternetOutBound` security rule, as shown in the
    following screenshot:'
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 请求执行后，它返回的结果将是允许访问，因为 `AllowInternetOutBound` 安全规则，如下图所示：
- en: '![](img/edd61df8-5850-4d01-8156-2f304757dcbf.png)'
  id: totrans-136
  prefs: []
  type: TYPE_IMG
  zh: '![](img/edd61df8-5850-4d01-8156-2f304757dcbf.png)'
- en: IP flow verify access allowed
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: IP 流量验证访问允许
- en: 'Repeat the previous steps, but change the **Remote IP address** to `172.31.0.100`.
    This will result in access being denied because of the `DefaultOutboundDenyAll` security
    rule:'
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重复前面的步骤，但将 **远程 IP 地址** 改为 `172.31.0.100`。这将导致访问被拒绝，因为 `DefaultOutboundDenyAll`
    安全规则：
- en: '![](img/4f30ce8f-4567-4516-bb04-6d82a616e909.png)'
  id: totrans-139
  prefs: []
  type: TYPE_IMG
  zh: '![](img/4f30ce8f-4567-4516-bb04-6d82a616e909.png)'
- en: IP flow verify access denied
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: IP 流量验证访问被拒绝
- en: 'Lastly, repeat the step again, and this time make the following changes:'
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，再次重复该步骤，这次做出以下更改：
- en: '**Direction**: Inbound'
  id: totrans-142
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**方向**：入站'
- en: '**Local port**:`80`'
  id: totrans-143
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**本地端口**：`80`'
- en: '**Remote port**:`60000`'
  id: totrans-144
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**远程端口**：`60000`'
- en: 'This will result in the following:'
  id: totrans-145
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这将导致以下结果：
- en: '![](img/2188a8e7-f0e8-4652-98fd-6e8b8d2a0e6f.png)'
  id: totrans-146
  prefs: []
  type: TYPE_IMG
  zh: '![](img/2188a8e7-f0e8-4652-98fd-6e8b8d2a0e6f.png)'
- en: Access denied
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 访问被拒绝
- en: We've looked at how to use IP flow verify to test the connection between two
    of the VMs. In the next part, we are going to look at effective security rules.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经查看了如何使用 IP 流量验证来测试两个虚拟机之间的连接。在接下来的部分，我们将讨论有效的安全规则。
- en: Effective security rules
  id: totrans-149
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 有效的安全规则
- en: The **Effective security rules** feature displays all the security rules that
    are applied to the network interface and the subnet where the network interface
    is. It then aggregates both. This will give you a complete overview of all the
    rules that are applied to a network interface, and it will give you the ability
    to change, add, or remove rules.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: '**有效的安全规则** 功能显示所有应用于网络接口及其所在子网的安全规则，并将两者合并。这样，你就能全面了解应用于网络接口的所有规则，并且可以修改、添加或删除规则。'
- en: 'You need to select the right subscription, the resource group, and the VM to
    get the overview of the applied security rules, as shown in the following screenshot:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要选择正确的订阅、资源组和虚拟机，以便查看应用的安全规则，具体请参考下图：
- en: '![](img/62fbfa4b-ef0f-467b-b38e-2b9a1099ea2a.png)'
  id: totrans-152
  prefs: []
  type: TYPE_IMG
  zh: '![](img/62fbfa4b-ef0f-467b-b38e-2b9a1099ea2a.png)'
- en: Effective security rules
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 有效的安全规则
- en: We've now seen an overview of the security rules that are applied to the network
    interface. In the next section, we are going to cover connection troubleshoot.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在已经看到应用于网络接口的安全规则概览。在下一部分，我们将讨论连接故障排除。
- en: Connection troubleshoot
  id: totrans-155
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 连接故障排除
- en: Azure Network Watcher Connection troubleshoot enables you to troubleshoot network
    performance and connectivity issues in Azure. It provides visualization of the
    hop-by-hop path from source to destination, identifying issues that can potentially
    impact your network performance and connectivity.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 网络观察器连接故障排除使你能够排查 Azure 中的网络性能和连接问题。它提供从源到目标的逐跳路径的可视化，帮助识别可能影响网络性能和连接性的潜在问题。
- en: 'Azure Network Watcher connection troubleshoot provides the following features
    and insights:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 网络观察器连接故障排除提供了以下功能和洞察：
- en: A graphical topology view from your source to destination.
  id: totrans-158
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从源到目标的图形化拓扑视图。
- en: It checks the connectivity between the source (VM) and the destination (VM,
    URI, FQDN, IP) address.
  id: totrans-159
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它检查源（虚拟机）和目标（虚拟机、URI、FQDN、IP）地址之间的连接性。
- en: It offers hop-by-hop latency.
  id: totrans-160
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它提供逐跳延迟。
- en: It can identify configuration issues that are impacting reachability.
  id: totrans-161
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它能够识别影响可达性的配置问题。
- en: It provides all possible hop-by-hop paths from the source to the destination.
  id: totrans-162
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它提供从源到目标的所有可能逐跳路径。
- en: It checks latency, such as minimum, maximum, and average latency, between the
    source and destination.
  id: totrans-163
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它检查源和目标之间的延迟，例如最小、最大和平均延迟。
- en: The number of packets dropped during the connection troubleshoot check.
  id: totrans-164
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在连接故障排除检查期间丢弃的包的数量。
- en: Connection troubleshoot requires that the source VM has the **AzureNetworkWatcherExtension**
    VM extension installed. For installing the extension on a Windows VM, you can
    refer to [https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/network-watcher-windows?toc=%2Fazure%2Fnetwork-watcher%2Ftoc.json](https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/network-watcher-windows?toc=%2Fazure%2Fnetwork-watcher%2Ftoc.json), and
    for a Linux VM, you can refer to [https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/network-watcher-linux?toc=%2Fazure%2Fnetwork-watcher%2Ftoc.json](https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/network-watcher-linux?toc=%2Fazure%2Fnetwork-watcher%2Ftoc.json).
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 连接故障排除要求源虚拟机安装**AzureNetworkWatcherExtension**虚拟机扩展。对于 Windows 虚拟机的扩展安装，你可以参考[https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/network-watcher-windows?toc=%2Fazure%2Fnetwork-watcher%2Ftoc.json](https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/network-watcher-windows?toc=%2Fazure%2Fnetwork-watcher%2Ftoc.json)，对于
    Linux 虚拟机，你可以参考[https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/network-watcher-linux?toc=%2Fazure%2Fnetwork-watcher%2Ftoc.json](https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/network-watcher-linux?toc=%2Fazure%2Fnetwork-watcher%2Ftoc.json)。
- en: 'To check network connectivity using **Connection troubleshoot**, you have to
    take the following steps:'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用**连接故障排除**检查网络连接，你需要采取以下步骤：
- en: From the Network Watcher overview blade in the Azure portal, under Network diagnostic
    tools, select **Connection troubleshoot**.
  id: totrans-167
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Azure 门户中的网络观察器概览页面，选择网络诊断工具下的**连接故障排除**。
- en: 'Select a virtual machine and provide an outbound connection, such as the following:'
  id: totrans-168
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择一个虚拟机并提供一个出站连接，如下所示：
- en: '![](img/f1a21e0b-0fa6-4c2d-8942-87b79b1b5035.png)'
  id: totrans-169
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f1a21e0b-0fa6-4c2d-8942-87b79b1b5035.png)'
- en: Selecting source and destination
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 选择源和目标
- en: Click **Check**.
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**检查**。
- en: The agent will automatically be installed on the source machine when you click
    the check button.
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当你点击检查按钮时，代理将自动安装到源机器上。
- en: 'After checking, the results will be displayed:'
  id: totrans-173
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查后，结果将显示：
- en: '![](img/1ce986ca-37b3-4384-91ae-3ab5f787cb52.png)'
  id: totrans-174
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1ce986ca-37b3-4384-91ae-3ab5f787cb52.png)'
- en: Unreachable endpoint
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 无法访问的端点
- en: We have now checked an outbound connection from a VM using **Connection troubleshoot**.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在已经使用**连接故障排除**检查了一个虚拟机的出站连接。
- en: Summary
  id: totrans-177
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we covered the third part of the *Deploying and Managing Virtual
    Networks*objective, by covering how to monitor and troubleshoot your network traffic
    in Azure Network Watcher. We also covered how to monitor and troubleshoot on-premises and
    external network connectivity using Network Watcher.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 本章中，我们覆盖了*部署和管理虚拟网络*目标的第三部分，介绍了如何在 Azure 网络观察器中监控和故障排除网络流量。我们还涵盖了如何使用网络观察器监控和故障排除本地和外部网络连接。
- en: In the next chapter, we are going to continue with the fourth part of this objective,
    by covering how to create and configure Azure security groups and Azure DNS.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将继续目标的第四部分，涵盖如何创建和配置 Azure 安全组和 Azure DNS。
- en: Questions
  id: totrans-180
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: 'Answer the following questions to test your knowledge of the information in
    this chapter. You can find the answers in the *Assessments* section at the end
    of this book:'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 请回答以下问题，测试你对本章内容的理解。你可以在本书最后的*评估*部分找到答案：
- en: 'Azure Network Watcher is only for monitoring and diagnosing network connectivity in
    Azure:'
  id: totrans-182
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Azure 网络观察器仅用于监控和诊断 Azure 中的网络连接：
- en: 'True'
  id: totrans-183
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 正确
- en: 'False'
  id: totrans-184
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 错误
- en: Can you use IP flow verify to verify outbound connections from a VNet in Azure?
  id: totrans-185
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你能使用 IP 流量验证来验证 Azure 中 VNet 的出站连接吗？
- en: 'Yes'
  id: totrans-186
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 是的
- en: 'No'
  id: totrans-187
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 否
- en: Can you use IP flow verify to verify connections between two different VMs inside
    a VNet?
  id: totrans-188
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你能使用 IP 流量验证来验证 VNet 内两个不同虚拟机之间的连接吗？
- en: 'Yes'
  id: totrans-189
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 是的
- en: 'No'
  id: totrans-190
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 否
- en: Further reading
  id: totrans-191
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: 'You can check the following links for more information about the topics that
    are covered in this chapter:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以查看以下链接，获取更多关于本章内容的信息：
- en: '*What is Azure Network Watcher?*: [https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-monitoring-overview](https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-monitoring-overview)'
  id: totrans-193
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*什么是 Azure 网络观察器？*：[https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-monitoring-overview](https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-monitoring-overview)'
- en: '*Quickstart: Diagnose a virtual machine network traffic filter problem using
    the Azure portal*: [https://docs.microsoft.com/en-us/azure/network-watcher/diagnose-vm-network-traffic-filtering-problem](https://docs.microsoft.com/en-us/azure/network-watcher/diagnose-vm-network-traffic-filtering-problem)'
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*快速入门：使用 Azure 门户诊断虚拟机网络流量过滤问题*: [https://docs.microsoft.com/en-us/azure/network-watcher/diagnose-vm-network-traffic-filtering-problem](https://docs.microsoft.com/en-us/azure/network-watcher/diagnose-vm-network-traffic-filtering-problem)'
- en: '*Network Performance Monitor solution in Azure*: [https://docs.microsoft.com/en-us/azure/azure-monitor/insights/network-performance-monitor?toc=%2Fazure%2Fnetwork-watcher%2Ftoc.json](https://docs.microsoft.com/en-us/azure/azure-monitor/insights/network-performance-monitor?toc=%2Fazure%2Fnetwork-watcher%2Ftoc.json)'
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*Azure 网络性能监视器解决方案*: [https://docs.microsoft.com/en-us/azure/azure-monitor/insights/network-performance-monitor?toc=%2Fazure%2Fnetwork-watcher%2Ftoc.json](https://docs.microsoft.com/en-us/azure/azure-monitor/insights/network-performance-monitor?toc=%2Fazure%2Fnetwork-watcher%2Ftoc.json)'
- en: '*Introduction to IP flow verify in Azure Network Watcher*: [https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-ip-flow-verify-overview](https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-ip-flow-verify-overview)'
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*Azure 网络观察器中的 IP 流验证简介*: [https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-ip-flow-verify-overview](https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-ip-flow-verify-overview)'
- en: '*Tutorial: Diagnose a communication problem between networks using the Azure
    portal*: [https://docs.microsoft.com/en-us/azure/network-watcher/diagnose-communication-problem-between-networks](https://docs.microsoft.com/en-us/azure/network-watcher/diagnose-communication-problem-between-networks)'
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*教程：使用 Azure 门户诊断网络之间的通信问题*: [https://docs.microsoft.com/en-us/azure/network-watcher/diagnose-communication-problem-between-networks](https://docs.microsoft.com/en-us/azure/network-watcher/diagnose-communication-problem-between-networks)'
