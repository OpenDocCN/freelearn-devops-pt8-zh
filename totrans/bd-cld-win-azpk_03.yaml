- en: Chapter 3. Installing and Configuring Windows Azure Pack
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In the previous chapter, we covered planning and configuration of Cloud Fabric
    Infrastructure, which is used to host the Cloud Fabric management and tenant workloads.
    Moving ahead, in this chapter we shall cover the installation and configuration
    of Windows Azure Pack websites, APIs, and authentication sites. We shall also
    cover post deployment steps such as customizing portal names and certificates
    as per enterprise and service providers' needs.
  prefs: []
  type: TYPE_NORMAL
- en: 'We will be covering the following topics in this chapter:'
  prefs: []
  type: TYPE_NORMAL
- en: Windows Azure Pack deployment model review
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Installing and configuring Windows Azure Pack
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Installing Windows Azure Pack in a distributed model
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Required firewall ports for WAP components
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Customizing WAP portals' accessibility and certificates summary
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Registering the Service Provider Foundation with WAP
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Windows Azure Pack deployment models review
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In [Chapter 1](part0015_split_000.html#E9OE1-b479cf466c26404ca54119871a9b2715
    "Chapter 1. Know Windows Azure Pack and Its Architecture"), *Know Windows Azure
    Pack and Its Architecture*, we covered the architecture and various deployment
    models for an organization's private cloud and a service provider's cloud needs.
    Let's have a review of possible and recommended deployment models before starting
    actual installation of **Windows Azure Pack** (**WAP**).
  prefs: []
  type: TYPE_NORMAL
- en: '**Express Deployment Architecture**: In Express Deployment Architecture, all
    components of WAP (portals, APIs, and authentication sites) are installed on a
    single Windows Server 2012/Windows Server 2012 R2\. It doesn''t provide any high
    availability and is suitable only for testing, development, and deployments. For
    the purpose of evaluating WAP in this book, we shall be following the Express
    Deployment model.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Distributed Deployment Architecture**: In Distributed Deployment Architecture,
    WAP roles such as Admin/Tenant portals or API''s. authentication sites are deployed
    in a distributed manner involving multiple Windows servers to provide scalability
    and high availability in a secure manner. Distributed Deployment Architecture
    can be customized as per requirement, such as adding a **high availability** (**HA**)
    layer only for particular roles instead of all. This is suitable for production
    deployments.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Installing and configuring Windows Azure Pack
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '**Microsoft Web Platform Installer** (**WEB PI**) is used to install Windows
    Azure Pack components in both Express and Distributed Architectures. Microsoft
    Web Platform is a free tool available, which is used to download and install latest
    components of Microsoft Web platform-related components such as IIS, .NET, web
    development tools, web applications, Windows Azure Pack, and so on. Web PI automatically
    detects the operating system on which it''s executed and displays only compatible
    solutions available for download and installation.'
  prefs: []
  type: TYPE_NORMAL
- en: Before downloading and starting Web Platform installer, we need to ensure that
    Windows Azure Pack installation prerequisites are completed. Let's finish up the
    prerequisites before starting the installation.
  prefs: []
  type: TYPE_NORMAL
- en: WAP installation prerequisite
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: For the purpose of evaluation, we are installing Windows Azure Pack in the Express
    Deployment model. The following hardware and software prerequisites have to be
    met before starting the installation. Please follow [Chapter 1](part0015_split_000.html#E9OE1-b479cf466c26404ca54119871a9b2715
    "Chapter 1. Know Windows Azure Pack and Its Architecture"), *Know Windows Azure
    Pack and Its Architecture*, for details on hardware requirements and for the deployment
    model of Express and Distributed Deployment Architectures.
  prefs: []
  type: TYPE_NORMAL
- en: 'Active Directory user accounts:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Create the following user accounts and groups in Active Directory for Windows
    Azure Pack components authentication:'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '| Account Name | Purpose | Permissions |'
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_TB
- en: '| --- | --- | --- |'
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_TB
- en: '| Wapsvc | Service account for WAP Web Services | Member of local administrator
    group on WAP servers and WAP Admins Group Member |'
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_TB
- en: '| Wapadmin | Administrator account to manage WAP Cloud | Member of local administrator
    group on WAP servers + WAPAdmins Group Member |'
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_TB
- en: '| Wapadmins | WAP Administrators Group | Member of local administrator group
    on WAP servers |'
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_TB
- en: 'Hardware requirements:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Windows Server 2012 R2 VM or physical server
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 8 GB RAM (no dynamic memory)
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 50 GB of available disk space
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Software requirements:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Windows Server 2012 /2012 R2 operating system. All the latest features and support
    are available with Windows Server 2012 R2\. See the feature compatibility guide
    if deploying on Windows Server 2012.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Microsoft Web Platform Installer 5, available at [http://www.microsoft.com/web/downloads/platform.aspx](http://www.microsoft.com/web/downloads/platform.aspx).
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Microsoft .NET Framework 3.5 Service Pack. Install using the server manager
    and add features wizard.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: IIS (Internet Information Service). Component of Windows Server OS. Web Platform
    installer can install it automatically before WAP installation. Add Management
    Console manually later.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Microsoft .NET Framework 4.5 Extended with ASP.NET for Windows 8\. It can be
    installed using the Server Manager's Add Feature wizard. WEB PI can also automatically
    install this before starting WAP installation.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Internet Explorer enhanced security configuration for administrators should
    be disabled. Use Server Manager to disable it.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: Installing .NET Framework 3.5 on Windows Server 2012 or 2012 R2 requires specifying
    an alternate location for .NET files in the Add Roles and Features wizard. Visit
    [https://technet.microsoft.com/en-in/library/dn482071.aspx](https://technet.microsoft.com/en-in/library/dn482071.aspx)
    for more information on this.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Installing Windows Azure Pack: Portal and API Express'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We can start installing Windows Azure Pack after successful completion of the
    prerequisites.
  prefs: []
  type: TYPE_NORMAL
- en: 'Follow the following steps to install WAP Express:'
  prefs: []
  type: TYPE_NORMAL
- en: Log on to the WAP server.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Start Microsoft Web PI (Microsoft Web Platform Installer).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Search **Windows Azure Pack: Portal and API Express**. Web PI will automatically
    detect that it''s running and Windows Server 2012 R2 will display only compatible
    products for download and installation.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Search for **Windows Azure Pack: Portal and API Express**. This will automatically
    download and install all WAP components that are a part of Express Deployment.![Installing
    Windows Azure Pack: Portal and API Express](img/00035.jpeg)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click **Add** to select the highlighted entry for download and installation.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Install** to proceed further.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Web PI wizard will show the prerequisites and optional components that can
    be installed. You may choose to remove extra components such as partner provided
    extensions if you are not planning to use them.![Installing Windows Azure Pack:
    Portal and API Express](img/00036.jpeg)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Remove any extra or not used components and click **I Accept** to proceed further.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select Microsoft updates settings as per your requirement. It is recommended
    to enable Microsoft updates to keep WAP and other components updated with the
    latest features and fixes using the Windows Update Console itself.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Wizard will start downloading and installing WAP components and prerequisites,
    as shown in the following screenshot:![Installing Windows Azure Pack: Portal and
    API Express](img/00037.jpeg)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Successful installation will take you to the **CONFIGURE** page, which provides
    details on configuring the WAP installed components, as shown in the following
    screenshot. WAP creates a site named Windows Azure Pack Configuration Site in
    IIS for configuration and integration of all the WAP components and databases
    during the initial setup. Click on **Continue** to proceed further. Clicking **Continue**
    will also open the configuration site page, which can be configured now or closed
    to configure the settings later.![Installing Windows Azure Pack: Portal and API
    Express](img/00038.jpeg)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Review the installed components summary and finish the wizard. See installation
    logs in case of any errors. Exit the Web PI Console.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Installed components can be verified in the Programs and Features (`appwiz.cpl`)
    management console.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: Microsoft Web PI always contains the latest available version along with updates
    of Windows Azure Pack components.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Configuring Windows Azure Pack Express Deployment
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In the preceding topic, we only installed those WAP components that were not
    ready to be used yet. Now, we need to configure all the WAP components (installed
    on a single server) by integrating with its management database and so on. Windows
    Azure Pack Configuration Site is used to configure the installation. You can open
    WAP Configuration Site by opening IE and its URL, or by using the Start menu icon.
  prefs: []
  type: TYPE_NORMAL
- en: 'Steps to configure a WAP Express installation are as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: Launch Internet Explorer with **Run as administrator**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open Windows Azure Pack Configuration Site accessible at `https://localhost:30101/`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If any SSL warning comes up, click **continue** to this website.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click **configure now** to proceed further.![Configuring Windows Azure Pack
    Express Deployment](img/00039.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Provide the required information in the **Database Server Setup** wizard:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**SERVER NAME**: FQDN of the SQL Server used to the host cloud management database.'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**AUTHENTICATION TYPE**: Windows Authentication or SQL authentication.'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**DATABASE SERVER ADMIN USERNAME** and **DATABASE SERVER ADMIN PASSWORD**:
    The wizard will automatically detect if the username and password is correct before
    proceeding further.'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Configuration Store Passphrase**: WAP uses encryption and decryption to store
    and retrieve secret data from the configuration stored on SQL. This passphrase
    will be used to encrypt and decrypt the data. The same passphrase has to be used
    while configuring all the servers in a Distributed Deployment.'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '![Configuring Windows Azure Pack Express Deployment](img/00040.jpeg)'
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: Select yes or no to participate in the **Customer Experience Improvement Program**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Review the components to be configured and click the checkmark at the bottom
    right-hand side.![Configuring Windows Azure Pack Express Deployment](img/00041.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**WINDOWS AZURE PACK SETUP** will start configuring each role. It will take
    a few minutes for the configuration to finish. Hit **finish** once the configuration
    is completed and is successful for all components.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The configuration is completed. Now you can proceed further to verify the deployment
    and to the next steps.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Log out and login back to the WAP server post completion of the configuration.
    This creates the necessary security permissions to log into portals.
  prefs: []
  type: TYPE_NORMAL
- en: '![Configuring Windows Azure Pack Express Deployment](img/00042.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: Validating a successful deployment
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'After completion of the configuration wizard, it''s good to quickly run some
    tests to verify if deployment and database integration is completed successfully.
    Perform the following checks to verify if deployment is successful:'
  prefs: []
  type: TYPE_NORMAL
- en: Verify if all Internet Information Services (IIS) websites and applications
    are created on the WAP server. Use **Internet Information Services (IIS) Manager**
    to verify this. Install IIS Manager using Server Manager if not installed.![Validating
    a successful deployment](img/00043.jpeg)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Verify if all WAP databases are created on the SQL server specified during setup.
    Use SQL Management Studio to access the SQL Management Server. Access the WAP
    database server and expend databases to see all the databases created on the server:![Validating
    a successful deployment](img/00044.jpeg)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Verify login to the Admin portal and the Tenant portal accessibility. Try logging
    into the Admin portal:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Admin portal URL: `https://WAPServer:30091`'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Tenant portal URL: `https://WAPServer:30081`'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Run Microsoft Best Practice Analyzer for Windows Azure Pack to identify any
    gaps in deployment.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The account used to install WAP components has to be used for logging into the
    Admin portal. Additional co-administrators can be added by adding users in MgmtSvc
    Operators local group on the WAP server.
  prefs: []
  type: TYPE_NORMAL
- en: Microsoft Best Practice Analyzer for Windows Azure Pack can be downloaded and
    installed using Microsoft Web Platform Installer (WebPI).
  prefs: []
  type: TYPE_NORMAL
- en: Installing Windows Azure Pack in a Distributed architecture
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Installation of Windows Azure Pack in a Distributed architecture is similar
    to Express installation. In a Distributed architecture, instead of selecting Windows
    Azure Pack: Portal and API Express, individual components such as Admin site and
    Admin authentication sites are selected and installed on multiple servers.'
  prefs: []
  type: TYPE_NORMAL
- en: '**Microsoft Web Platform Installer** (**Web PI**) is used to select individual
    components and installation of each of them on all the WAP servers. Let''s have
    a look at the steps to deploy WAP in a Distributed architecture.'
  prefs: []
  type: TYPE_NORMAL
- en: Complete the hardware and software prerequisite on all WAP servers (see [Chapter
    1](part0015_split_000.html#E9OE1-b479cf466c26404ca54119871a9b2715 "Chapter 1. Know
    Windows Azure Pack and Its Architecture"), *Know Windows Azure Pack and Its Architecture*,
    for various deployment topologies of WAP in a Distributed architecture, last topic
    for software prerequisites).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Verify required firewall ports allowed in Windows or network firewalls.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Deploy any load balancers (physical or logical) for WAP virtual machines as
    per architecture.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Install and run Microsoft Web Platform Installer on WAP servers in a sequential
    manner.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Follow the given sequence to install and configure WAP components on multiple
    servers:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Install and configure WAP Service Management APIs (Admin API, Tenant API, and
    Tenant Public API)
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Install and configure WAP Management portals (Admin site, Tenant site, and so
    on)
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Install and configure authentication sites (Admin Authentication site and Tenant
    Authentication sites)
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Install and configure other components such as resource providers, and so on
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: During configuration, provide SQL server details and the passphrase. Note down
    the passphrase as it has to be exactly the same while configuring all other components.
    It is a good idea to make a note of it, as there is no way to recover the passphrase
    if lost.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Configure load balancers to distribute traffic and DNS records.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Customize the portal and authentication site's URL and ports for load balanced
    names.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Replace self-signed certificates with trusted SSL certificates for websites.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Test deployment and complete post deployment best practices such as running
    BPA.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Changing portal URLs and ports, and replacing SSL certificates, is covered in
    further topics.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: By default, Windows Azure Pack portals uses HTTPS. If you try to open portals
    on HTTP, it will result in a page cannot be displayed error. To accept HTTP traffic
    for portals, create additional binding in IIS for each website pointing to port
    80 along with the default HTTPS.
  prefs: []
  type: TYPE_NORMAL
- en: Web.Config of each portal already has a rule of redirecting HTTP traffic to
    HTTPS, which comes into action after adding binding for port 80.
  prefs: []
  type: TYPE_NORMAL
- en: Required firewall ports for WAP components
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The following networks ports have to be allowed in networks or any other external
    firewalls to enable communication between WAP components and websites access by
    admins or tenants.
  prefs: []
  type: TYPE_NORMAL
- en: Windows Azure Pack automatically creates rules in Windows firewall (if enabled)
    for these ports. Note that the following list includes only the default ports
    used by WAP components; add other ports if using any customized ports.
  prefs: []
  type: TYPE_NORMAL
- en: '| WAP Service | Port Number | Scope |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| Admin API | 30004 | Any IP required to access Admin API. It is usually cloud
    management IP range. |'
  prefs: []
  type: TYPE_TB
- en: '| Management portal for Admins | 30091 | Any IP required to access admin portal.
    It is usually cloud management IP range. |'
  prefs: []
  type: TYPE_TB
- en: '| Windows authentication site (used for admin portal authentication) | 30072
    | Any IP required to access admin portal. It is usually cloud management IP range.
    |'
  prefs: []
  type: TYPE_TB
- en: '| Configuration site | 30101 | Local WAP components subnet. This will be accessed
    during initial setup. |'
  prefs: []
  type: TYPE_TB
- en: '| Monitoring site | 30020 | Any IP required to access monitoring services.
    It is usually cloud management range. |'
  prefs: []
  type: TYPE_TB
- en: '| MySQL Resource Provider | 30012 | Any IP address using specified service.
    |'
  prefs: []
  type: TYPE_TB
- en: '| SQL Server or MySQL Resource Provider | 30010 | Any IP address using specified
    service. |'
  prefs: []
  type: TYPE_TB
- en: '| Tenant API | 30005 | Any IP address using specified service. |'
  prefs: []
  type: TYPE_TB
- en: '| Tenant public API | 30006 | Any IP address using specified service. Usually
    all Internet IP ranges. |'
  prefs: []
  type: TYPE_TB
- en: '| Management portal for tenants | 30081 | Any IP address using specified service.
    Usually all Internet IP ranges. |'
  prefs: []
  type: TYPE_TB
- en: '| Tenant authentication site | 30071 | Any IP address using specified service.
    Usually all Internet IP ranges. |'
  prefs: []
  type: TYPE_TB
- en: '| Usage | 30022 | Any IP address using specified service. |'
  prefs: []
  type: TYPE_TB
- en: '| WebAppGallery | 30018 | Any IP address using specified service. |'
  prefs: []
  type: TYPE_TB
- en: Customizing WAP portal's accessibility and certificates
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: By default, WAP websites use server hostnames as website URL, default port number,
    and self-signed certificates. In this topic, we will change the website's name,
    that is, URL, default port (such as 30081 to 443 for tenant portal) and SSL certificate
    with internal or public certificates as required. It is recommended to customize
    these portals' configuration for better security and user experience.
  prefs: []
  type: TYPE_NORMAL
- en: Assume a user experience of a tenant portal, also known as a customer portal,
    with complex enough URL and a custom port to add with disturbing security warnings
    of untrusted SSL certificates. Windows Azure Pack provides flexibilities to change
    URLs and ports along with trusted SSL certificates for WAP websites for improved
    security and smooth end user experience.
  prefs: []
  type: TYPE_NORMAL
- en: 'Before getting things into action, let''s understand which websites come into
    the picture for the user logins (Admin or Tenant) WAP portal use claim-based authentication
    mechanism during the login process, as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: The user opens their respective portals such as admin portal or tenant portal
    by entering the WAP server's hostname with the port.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The admin site redirects the webpage to the respective authentication site webpage.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The user enters their credentials with a mechanism such as Windows Authentication/ASP.NET
    Authentication, or ADFS. Upon successful authentication, the user is provided
    with a security access token and redirected to the portal webpage again.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The admin portal webpage accepts the security token of the user and display
    the portal as per services/permissions available with the user.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'As we learned, four websites plays a role in getting a user authenticated and
    getting their personalized portal as per role. In order to provide smooth user
    experience, we need to customize names, ports, and have trusted certificates for
    the following WAP websites:'
  prefs: []
  type: TYPE_NORMAL
- en: Admin management portal
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Admin authentication site
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Tenant management portal
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Tenant authentication site
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: For an organization's private cloud, in most cases all these websites will be
    accessible from inside the organizations only, which makes it feasible to use
    an internal **CA** (**Certification Authority**) provided SSL certificates for
    all websites.
  prefs: []
  type: TYPE_NORMAL
- en: In a service provider scenario, the Tenant portal will be accessible over the
    public Internet; whereas the Admin portal is likely to be accessed inside the
    provider's network only. In such cases, SSL certificates issued by public CA should
    be used for the Tenant management portal and Authentication site, whereas an internal
    CA can be leveraged for the Admin portal and Admin authentication site.
  prefs: []
  type: TYPE_NORMAL
- en: This makes the recommendation clear that internal CA provided SSL certificates
    should be used for portal and authentication sites to be used inside corporate
    LAN, where any public portal or authentication sites should be assigned SSL certificates
    issued by Public trusted CAs.
  prefs: []
  type: TYPE_NORMAL
- en: 'Overall, the following recommendations have to be performed for user accessible
    websites to improve user experience and security:'
  prefs: []
  type: TYPE_NORMAL
- en: Use simpler URLs for Admin and Tenant websites
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Use standard ports such as 443 (HTTPS) to avoid any complexity in URLs
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Use trusted SSL certificates to avoid any SSL related security warnings
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'To implement the preceding recommendations, the following operations have to
    be performed in a WAP Cloud solution:'
  prefs: []
  type: TYPE_NORMAL
- en: Create DNS records for new URLs (in internal DNS and Public DNS servers.)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Generate and import trusted SSL certificates for each website.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Configure website bindings to use new URLs, ports, and certificates.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Update the Windows Azure Pack Configuration database with new URLs and ports.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Configure portal's DNS names
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: By default, WAP management portals and authentication sites use the following
    ports.
  prefs: []
  type: TYPE_NORMAL
- en: 'The following are WAP websites'' default URLs and ports:'
  prefs: []
  type: TYPE_NORMAL
- en: '| Site Name | URL | Port |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| Management Portal for Administrator | `https://WAPServer:30091` | 30091 |'
  prefs: []
  type: TYPE_TB
- en: '| Admin Authentication Site | `https://WAPServer:30072` | 30072 |'
  prefs: []
  type: TYPE_TB
- en: '| Management Portal for Tenants | `https://WAPServer:30081` | 30081 |'
  prefs: []
  type: TYPE_TB
- en: '| Tenant Authentication Site | `https://WAPServer:30071` | 30071 |'
  prefs: []
  type: TYPE_TB
- en: For evaluation purposes, we shall be changing URLs and ports as per the following
    table. Organizations and service providers may choose their own names and ports
    as per their choice.
  prefs: []
  type: TYPE_NORMAL
- en: '| Site Name | URL | Port |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| Management Portal for Administrator | `https://admin.wapcloud.com` | 443
    |'
  prefs: []
  type: TYPE_TB
- en: '| Admin Authentication Site | `https://adminauth.wapcloud.com` | 443 |'
  prefs: []
  type: TYPE_TB
- en: '| Management Portal for Tenants | `https://manage.wapcloud.com` | 443 |'
  prefs: []
  type: TYPE_TB
- en: '| Tenant Authentication Site | `https://manageauth.wapcloud.com` | 443 |'
  prefs: []
  type: TYPE_TB
- en: '"`A`" records and "`PTR`" records need to be created in internal and external
    DNS servers for the preceding names pointing to the WAP server. Changes in Public
    DNS servers are required if any of the services are accessible over the Internet
    like tenant portals and authentication sites.'
  prefs: []
  type: TYPE_NORMAL
- en: 'DNS Manager can be used to create records in the internal DNS server. Use the
    following steps to create the records:'
  prefs: []
  type: TYPE_NORMAL
- en: Open DNS Manager on the DNS server.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Right click on **DNS Zone** and create a new record button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provide the name and IP of portal and WAP server, as follows:![Configure portal's
    DNS names](img/00045.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Create associated pointer (PTR) record**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Create all required records using the same method.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Getting SSL certificates for WAP websites
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Getting SSL certificates for WAP management portals and authentication sites
    is similar to getting SSL for any other websites running on any web server. SSL
    certificates are usually requested and assigned online by any CA authority, or
    offline by creating a certificate request file at the IIS server and then submitting
    a certificate request file to Public CA providers to get the required SSL.
  prefs: []
  type: TYPE_NORMAL
- en: Active Directory Certificate Services, that is, internal Enterprise CA can be
    used to assign certificates for portals accessible inside corporate networks only,
    such as management portals for administrators and so on. For the purpose of evaluation,
    we shall be using internal Windows ADCS Services as a CA to assign certificates
    to the websites.
  prefs: []
  type: TYPE_NORMAL
- en: 'Assuming that you already have an Enterprise CA configured inside your organization
    (Active Directory Certificate Services), the following are the steps required
    to request and assign SSL certificates for WAP websites:'
  prefs: []
  type: TYPE_NORMAL
- en: Log on to WAP server and open IIS Manager.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select Your IIS server name and then **Server Certificates** on the homepage.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The **Server Certificates** window will display all existing self-signed or
    other certificates being used in the IIS server.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click **Request Domain Certificate** in the actions pane.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Providing the **Common Name**, **Organization**, **Organizational Unit**, **City/locality**,
    **State/province** and **Country/region** details as requested, as shown in the
    following screenshot. The **Common name** would be the FQDN of the website it
    is being requested for.![Getting SSL certificates for WAP websites](img/00046.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Specify the CA name and server name where ADCS is running and configured. Assign
    a friendly name for the certificate for easy identification and management.![Getting
    SSL certificates for WAP websites](img/00047.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Clicking on **Finish** will request and import certificates in IIS, as shown
    in the following screenshot:![Getting SSL certificates for WAP websites](img/00048.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Request certificates for all three remaining websites.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'To request the SSL certificate from a Public CA, perform the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Open **IIS Manager** | **IIS Server Home** | **Server Certificates**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click **Create Certificate Request** in the **Actions** pane.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provides the **Common Name**, **Organization**, **Organizational Unit**, **City/locality**,
    **State/province** and **Country/region** details as requested. The **Common name**
    would be the FQDN of the website it is being requested for.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Cryptographer service provider** and **Bit length** as per the Public
    CA.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Specify the file name and location to extract the certificate request file.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Submit this request file to Public CA online or through offline method. CA will
    generate SSL certificates as per details received in the certificate request file.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click **Complete Certificate request** in the **Actions** pane of IIS Manager's
    server certificate menu.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provide file path for the certificate file provided by CA.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The certificate will be added into IIS.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Configuring site binding to use new URL's, port and SSL
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Now, we need to configure WAP websites to use these new names, ports, and SSL
    certificates. Follow these steps to do this:'
  prefs: []
  type: TYPE_NORMAL
- en: Open IIS Manager on the WAP server and browse through the websites.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **MgmtSvc-AdminSite** to select Management portals for the administrator
    site.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Bindings** on the **Actions** pane.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select existing HTTPS binding and click **Edit Bindings**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provide a new **Port** number and **Host name** and select newly created **SSL
    certificate** for the Admin site.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the **Require Server Name Indication** checkbox.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Submit the changes by clicking **OK**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Repeat the preceding steps for the remaining websites.![Configuring site binding
    to use new URL's, port and SSL](img/00049.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'The following are the IIS website names and the corresponding WAP websites:'
  prefs: []
  type: TYPE_NORMAL
- en: '| IIS WebSite Name | WAP component |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| MgmtSvc-AdminSite | Management Portal for Administrators |'
  prefs: []
  type: TYPE_TB
- en: '| MgmtSvc-WindowsAuthSite | Admin Authentication Site |'
  prefs: []
  type: TYPE_TB
- en: '| MgmtSvc-TenantSite | Management Portal for Administrators |'
  prefs: []
  type: TYPE_TB
- en: '| MgmtSvc-AuthSite | Tenant Authentication Site |'
  prefs: []
  type: TYPE_TB
- en: Updating changes in the Windows Azure Pack database
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: All changes performed in the previous steps have to be updated in the Windows
    Azure Pack configuration store to make them effective. Let's update the changes
    made in portal URLs and ports in the WAP Configuration database residing on the
    Management SQL Server.
  prefs: []
  type: TYPE_NORMAL
- en: 'Windows Azure Pack PowerShell will be used to update the changes. We need to
    update the value in the following three configurations in the WAP DB for both
    admin and tenant portals:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Portal FQDN**: Configured by using `Set-MgmtSvcFqdn` in the PowerShell cmdlet,
    this will update FQDN for websites'' portals in the WAP database such as `admin.wapcloud.com`.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Authentication Service Relay**: Configured by using `Set-MgmtSvcRelyingPartySettings`
    in the PowerShell cmdlet, this will update the URL of the authentication site
    in the WAP database. This URL will be used by the portal to redirect when the
    user accesses the portal without any security token.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Authentication Service Redirection**: Configured by using `Set-MgmtSvcIdentityProviderSettings`
    in the PowerShell cmdlet, this updates the redirection URL used by the authentication
    site post user authentication. This URL will be used by the authentication site
    to redirect the user to the admin or tenant portal after authentication.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Sample URLs are given in PowerShell cmdlets next, they need to be replaced
    with actual names for production deployments. Steps for updating new websites''
    URLs and ports in the WAP database are as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: Log into WAP Server as a WAP administrator.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Run Windows PowerShell as an administrator.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Import the Windows Azure Pack PowerShell module by executing the following
    commands:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Update the Admin portal FQDN by issuing the following command in the PowerShell.
    FQDN in this cmdlet is the admin portal''s FQDN:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Update the Admin Authentication site FQDN by issuing the following PowerShell.
    FQDN in this cmdlet is admin authentication site''s FQDN:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Update the Admin Authenticate site redirection changes by issuing the following
    PowerShell. FQDN in this cmdlet is admin authentication site''s FQDN:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Update the Authenticate Service redirection by issuing the following PowerShell.
    FQDN in this cmdlet is admin portal''s FQDN:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Update the Tenant Admin portal FQDN by issuing the following PowerShell. FQDN
    in this cmdlet is the Tenant portal''s FQDN:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Update the Tenant Authentication portal FQDN by issuing the following PowerShell.
    FQDN in this cmdlet is the tenant authentication portal''s FQDN:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Update the Tenant Authenticate redirection site changes by issuing the following
    PowerShell. FQDN in this cmdlet is the tenant authentication site''s FQDN:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Update the tenant Authenticate Service redirection by issuing the following
    PowerShell. FQDN in this cmdlet is the tenant admin portal''s FQDN:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Successful updated configuration will give an output as follows:![Updating changes
    in the Windows Azure Pack database](img/00050.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Verifying portal customizations
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The following steps can be followed to verify if customization made in the
    previous section is effective:'
  prefs: []
  type: TYPE_NORMAL
- en: Verify if portal URLs and port customizations are working fine by logging into
    both tenant and admin portals.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Check SSL certificates of websites by clicking on the SSL button in the web
    browser for the website.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Verify no SSL trust related warnings are displayed during login or accessing
    the portal.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Registering Service Provider Foundation with WAP
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Now that we have our portal ready for Admin and Tenant usage, it's time to integrate
    or make WAP APIs communicate with Fabric prepared in the previous chapter. In
    this section, we will register Service Provider Foundation with Windows Azure
    pack Service Management APIs.
  prefs: []
  type: TYPE_NORMAL
- en: See [Chapter 1](part0015_split_000.html#E9OE1-b479cf466c26404ca54119871a9b2715
    "Chapter 1. Know Windows Azure Pack and Its Architecture"), *Know Windows Azure
    Pack and Its Architecture*, System Centre integration section, to learn more about
    integration between WAP APIs and SPF.
  prefs: []
  type: TYPE_NORMAL
- en: 'Before registering, verify if SPF is deployed and configured properly to ensure
    successful registration:'
  prefs: []
  type: TYPE_NORMAL
- en: There is network reachability on required ports between the WAP server and SPF
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: SPF application pools identity are running as a domain user
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The SPF App Pool identity user has admin permissions on SCVMM and SPF DB
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The local user is created on SPF server for WAP integration. Ensure that this
    local user is added to the SPF Local Groups Server (`SPF_Admin`, `SPF_Provider`,
    `SPF_Usage`, and `SPF_VMM`)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Steps to register SPF Endpoint in WAP are as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: Log into the WAP admin portal using WAP administrator credentials.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select VM clouds. Opening the VM clouds page will give the option to register
    SPF. If not available, click on the Quick Start(![Registering Service Provider
    Foundation with WAP](img/00051.jpeg)) button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Register System Center Service Provider Foundation**.![Registering
    Service Provider Foundation with WAP](img/00052.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Provide the SPF server FQDN and login credentials:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'SPF Server: `https://WAPMGT-SCSPF-01:8090/`'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Use the spflocal account created earlier in [Chapter 2](part0023_split_000.html#LTSU2-b479cf466c26404ca54119871a9b2715
    "Chapter 2. Getting the Cloud Fabric Ready"), *Getting the Cloud Fabric Ready*,
    during SPF installation. Do not provide any domain name or computer name in the
    login name.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '![Registering Service Provider Foundation with WAP](img/00053.jpeg)'
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: The registration task starts by clicking on the checkmark.![Registering Service
    Provider Foundation with WAP](img/00054.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click **OK** once registration is successfully completed:![Registering Service
    Provider Foundation with WAP](img/00055.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now, we can start integrating SCVMM and building IaaS services, which will be
    covered in next chapter.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we learned about installation and configuration of Windows
    Azure Pack in the Express Deployment model and Distributed Deployment model. We
    did an installation and configuration walkthrough of different WAP components.
  prefs: []
  type: TYPE_NORMAL
- en: We also covered customizing portals' URLs, ports, and SSL certificates to provide
    better user experience and to comply with organizations' and cloud providers'
    needs. At the end of this chapter, we customized Admin and Tenant portals accessible
    for users (Admin and Tenant users), waiting to offer cloud services.
  prefs: []
  type: TYPE_NORMAL
- en: In the next chapter, we shall be building IaaS cloud offering catalogues.
  prefs: []
  type: TYPE_NORMAL
