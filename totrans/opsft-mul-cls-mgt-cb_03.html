<html><head></head><body>
		<div id="_idContainer077">
			<h1 id="_idParaDest-58" class="chapter-number"><a id="_idTextAnchor066"/>3</h1>
			<h1 id="_idParaDest-59"><a id="_idTextAnchor067"/>Multi-Tenant Considerations</h1>
			<p>As with almost any software, things get more difficult as you scale in number and size. In the previous chapter, we looked at the most important aspects related to the architecture of an OpenShift cluster. In this chapter, we are going to cover some things you should understand when working with multiple environments on one or <span class="No-Break">more clusters.</span></p>
			<p>In this chapter, we will cover the <span class="No-Break">following topics:</span></p>
			<ul>
				<li>What <span class="No-Break">is multitenancy?</span></li>
				<li>Handling <span class="No-Break">multiple tenants</span></li>
				<li>Multitenancy <span class="No-Break">on OpenShift</span></li>
				<li><span class="No-Break">Multi-tenant strategies</span></li>
			</ul>
			<h1 id="_idParaDest-60"><a id="_idTextAnchor068"/>What is multitenancy?</h1>
			<p><strong class="bold">Multitenancy</strong> is the ability to provide services for multiple users or groups (also known as <strong class="bold">tenants</strong>) using a <a id="_idIndexMarker191"/>single platform instance. A platform architecture can be designed to be single- <span class="No-Break">or multi-tenant:</span></p>
			<ul>
				<li>In a <a id="_idIndexMarker192"/>single-tenant platform architecture, there is no isolation within an instance of the platform. This means that there is no separation in an instance and that, as such, there is no way to isolate objects for users or groups. In this case, to achieve multitenancy, you need to provision a separate platform instance for <span class="No-Break">every tenant.</span></li>
				<li>In a<a id="_idIndexMarker193"/> multi-tenant platform architecture, it is possible to isolate objects and data between different tenants. Therefore, you can protect each tenant's data and objects, thus providing enough privacy and security, even by using a single <span class="No-Break">platform instance.</span></li>
			</ul>
			<p>Depending on<a id="_idIndexMarker194"/> the architectural design and how OpenShift is used, you can have both types of platforms (single- or multi-tenant). In this chapter, you will learn how to define the best way to consider this while designing your <span class="No-Break">OpenShift clusters.</span></p>
			<h1 id="_idParaDest-61"><a id="_idTextAnchor069"/>Handling multiple tenants</h1>
			<p>There are <a id="_idIndexMarker195"/>many different ways to work with multiple tenants on OpenShift, with the most obvious one being to have a single cluster for each tenant. However, this is not always possible or the best option: having dedicated hardware and a platform for every tenant can be costly, difficult to maintain, and not efficient. With shared clusters, multiple workloads from different tenants share the same computing capacity, enabling more efficient <span class="No-Break">computing usage.</span></p>
			<p>OpenShift can provide isolation for objects, computing, network, and other hardware resources for each tenant, ensuring they are isolated from each other. In the next section, we are going to look at the different types of isolation and how to <span class="No-Break">utilize them.</span></p>
			<h2 id="_idParaDest-62"><a id="_idTextAnchor070"/>Multitenancy in OpenShift</h2>
			<p>When it comes to <a id="_idIndexMarker196"/>multitenancy on OpenShift, several objects are involved. The following table shows some important resources that provide multi-tenant capabilities, all of which we are going to cover in <span class="No-Break">this chapter:</span></p>
			<div>
				<div id="_idContainer066" class="IMG---Figure">
					<img src="image/Table_01_new.jpg" alt=""/>
				</div>
			</div>
			<p>The following diagram illustrates how these resources are combined to provide isolation and<a id="_idIndexMarker197"/> <span class="No-Break">enable </span><span class="No-Break"><a id="_idIndexMarker198"/></span><span class="No-Break">multitenancy:</span></p>
			<div>
				<div id="_idContainer067" class="IMG---Figure">
					<img src="image/B18015_03_01.jpg" alt="Figure 3.1 – Multitenancy and isolation "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.1 – Multitenancy and isolation</p>
			<p>Now, let's look at how these objects are used to provide multitenancy capabilities on OpenShift. We are going to use all of them while covering practical examples from <a href="B18015_05.xhtml#_idTextAnchor090"><span class="No-Break"><em class="italic">Chapter 5</em></span></a>, <em class="italic">OpenShift Development</em>, onward, so don't worry about how to use them for now. Instead, focus on understanding how they provide isolation capabilities to <span class="No-Break">enable multitenancy.</span></p>
			<h3>Namespaces</h3>
			<p>Namespaces <a id="_idIndexMarker199"/>provide some level of isolation. Using namespaces, you can define a limited space for <span class="No-Break">the following:</span></p>
			<ul>
				<li><strong class="bold">Kubernetes workloads</strong>: <strong class="bold">P</strong><strong class="bold">ods</strong>, <strong class="bold">Secrets</strong>, <strong class="bold">ConfigMaps</strong>, <strong class="bold">Deployments</strong>, and <span class="No-Break">so on.</span></li>
				<li><strong class="bold">Access control</strong>: Isolate the namespace resource's access by giving the appropriate <strong class="bold">roles</strong> (permissions) to the users <span class="No-Break">or groups.</span></li>
				<li><strong class="bold">Limit resource consumption</strong>: It is possible to limit the number of resources that are consumed by a namespace <span class="No-Break">using </span><span class="No-Break"><strong class="bold">ResourceQuotas</strong></span><span class="No-Break">.</span></li>
			</ul>
			<h3>Role-based access control</h3>
			<p>Permission control<a id="_idIndexMarker200"/> over resources on OpenShift is done<a id="_idIndexMarker201"/> using <strong class="bold">roles</strong> and <strong class="bold">RoleBindings</strong>. <strong class="bold">Roles</strong> are a set<a id="_idIndexMarker202"/> of actions (such as <strong class="source-inline">get</strong>, <strong class="source-inline">list</strong>, <strong class="source-inline">watch</strong>, <strong class="source-inline">create</strong>, <strong class="source-inline">upgrade</strong>, and so on) that are permitted over resources (such as <strong class="bold">Pods</strong>, <strong class="bold">Services</strong>, <strong class="bold">Deployments</strong>, <strong class="bold">J</strong><strong class="bold">obs</strong>, and so on), while <strong class="bold">RoleBindings</strong> (or <strong class="bold">ClusterRoleBinding</strong>) are how you bind a role to a subject (groups, users, <span class="No-Break">or </span><span class="No-Break"><strong class="bold">ServiceAccounts</strong></span><span class="No-Break">).</span></p>
			<p>You are required to use roles and RoleBindings to give users the right permissions to the right namespaces, according to the tenants and the separation logic you want <span class="No-Break">to implement.</span></p>
			<h3>ResourceQuotas</h3>
			<p><strong class="bold">ResourceQuotas</strong> allows<a id="_idIndexMarker203"/> a cluster administrator to <a id="_idIndexMarker204"/>constraint a namespace to a limited set of resources. It can limit computing resources and/or the number of objects. It is a crucial thing to consider when you're using shared clusters to ensure there's a limited capacity for each tenant. Without ResourceQuotas, only one namespace can consume the entire capacity of a worker node, <span class="No-Break">for instance.</span></p>
			<h3>nodeSelectors, taints, and tolerations</h3>
			<p>Through <strong class="bold">nodeSelectors</strong>, you <a id="_idIndexMarker205"/>can dedicate <a id="_idIndexMarker206"/>workers for a specific reason or tenant. With nodeSelectors, it is possible to isolate physical compute resources for each tenant: in a 10-node cluster, you can have, for instance, five nodes for QA and the other five for <a id="_idIndexMarker207"/>development. <strong class="bold">Taints</strong> and <strong class="bold">tolerations</strong> are different ways of <a id="_idIndexMarker208"/>doing this: <a id="_idIndexMarker209"/>while with<a id="_idIndexMarker210"/> nodeSelectors, you instruct a Pod to be scheduled in a defined set of nodes that contain a certain label, with taints, you instruct a worker to <em class="italic">repeal</em> Pods that do not contain a certain toleration to run <span class="No-Break">in it.</span></p>
			<h3>NetworkPolicy</h3>
			<p><strong class="bold">A NetworkPolicy</strong> provides<a id="_idIndexMarker211"/> a standard way to isolate <a id="_idIndexMarker212"/>network traffic between Pods and namespaces. It works like a firewall in which you define ingress and/or egress policies to accept/deny traffic flows between different Pods <span class="No-Break">and namespaces.</span></p>
			<h3>Ingress/router sharding</h3>
			<p>On OpenShift, you <a id="_idIndexMarker213"/>can create multiple<a id="_idIndexMarker214"/> ingress controllers, which will allow you to isolate ingress traffic between <span class="No-Break">different tenants.</span></p>
			<h2 id="_idParaDest-63"><a id="_idTextAnchor071"/>Multi-tenant strategies</h2>
			<p>It is<a id="_idIndexMarker215"/> important to understand that there is no physical isolation when using the multi-tenant objects listed previously – isolation is defined and implemented by the software. However, it is possible to provide a physical level of isolation by using different multi-tenant strategies, as you will see now. The best strategy depends on the requirements you have in your company; some companies care more about having an efficient use of computing resources, while others don't care about spending more resources in favor of the most secure isolation <span class="No-Break">strategy possible.</span></p>
			<p>Some different strategies are <span class="No-Break">as follows:</span></p>
			<ul>
				<li>Dedicated clusters, one for <span class="No-Break">each tenant</span></li>
				<li>A shared cluster with no physical separation <span class="No-Break">of resources</span></li>
				<li>A shared cluster with dedicated <span class="No-Break">worker nodes</span></li>
				<li>A shared cluster with dedicated worker nodes and <span class="No-Break">ingress controllers</span></li>
			</ul>
			<h3>Dedicated clusters</h3>
			<p>As we <a id="_idIndexMarker216"/>have already mentioned, the most <a id="_idIndexMarker217"/>obvious strategy is to have a different cluster for each tenant. The following diagram shows an example of providing services for two tenants (QA <span class="No-Break">and Development):</span></p>
			<div>
				<div id="_idContainer068" class="IMG---Figure">
					<img src="image/B18015_03_02.jpg" alt="Figure 3.2 – Dedicated clusters "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.2 – Dedicated clusters</p>
			<p>The following table contains a <a id="_idIndexMarker218"/>summary of the pros and cons <a id="_idIndexMarker219"/>of this strategy, from our point <span class="No-Break">of view:</span></p>
			<div>
				<div id="_idContainer069" class="IMG---Figure">
					<img src="image/Table_02_new.jpg" alt=""/>
				</div>
			</div>
			<p>This type <a id="_idIndexMarker220"/>of architecture is usually recommended for <a id="_idIndexMarker221"/>companies that have strict requirements for <a id="_idIndexMarker222"/>physically isolated environments and don't want to be dependent on multi-tenant software and processes to <span class="No-Break">provide isolation.</span></p>
			<h3>Shared clusters, no physical separation</h3>
			<p>On the other<a id="_idIndexMarker223"/> hand, you <a id="_idIndexMarker224"/>may decide to have one shared cluster providing services for multiple tenants while using OpenShift objects to enable multitenancy (namespaces, RBAC, ResourceQuotas, and NetworkPolicies). You can see a simple schema of this strategy in the <span class="No-Break">following diagram:</span></p>
			<div>
				<div id="_idContainer070" class="IMG---Figure">
					<img src="image/B18015_03_03.jpg" alt="Figure 3.3 – Shared cluster, no physical separation "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.3 – Shared cluster, no physical separation</p>
			<p>The <a id="_idIndexMarker225"/>following table shows some of <a id="_idIndexMarker226"/>the pros <a id="_idIndexMarker227"/>and cons of <span class="No-Break">this strategy:</span></p>
			<p>This kind of architecture usually works well for non-production environments, in which some incidents <a id="_idIndexMarker228"/>related<a id="_idIndexMarker229"/> to performance degradation, for instance, are <span class="No-Break">sometimes tolerated.</span></p>
			<h3>Shared clusters, dedicated worker nodes</h3>
			<p>If you have to <a id="_idIndexMarker230"/>provide <a id="_idIndexMarker231"/>computing resources that are physically isolated, this may be the right direction to take. In this case, you are going to use the same objects to provide isolation, but you dedicate worker nodes for specific tenants. The following is a <span class="No-Break">simple schema:</span></p>
			<div>
				<div id="_idContainer071" class="IMG---Figure">
					<img src="image/B18015_03_04.jpg" alt="Figure 3.4 – Shared cluster, dedicated worker nodes "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.4 – Shared cluster, dedicated worker nodes</p>
			<p>This <a id="_idIndexMarker232"/>strategy can have the following pros <a id="_idIndexMarker233"/><span class="No-Break">and cons:</span></p>
			<div>
				<div id="_idContainer072" class="IMG---Figure">
					<img src="image/Table_04_new.jpg" alt=""/>
				</div>
			</div>
			<p>This kind <a id="_idIndexMarker234"/>of architecture usually works well for non-production environments, in which some incidents related to performance degradation, for instance, are sometimes tolerated. This architecture also works well for production workloads that don't have requirements for high HTTP(S) throughput and low-latency HTTP(S). The following link provides a capacity baseline for a single OpenShift ingress (<strong class="bold">HAProxy</strong>), for <span class="No-Break">comparison: </span><a href="https://docs.openshift.com/container-platform/latest/scalability_and_performance/routing-optimization.html"><span class="No-Break">https://docs.openshift.com/container-platform/latest/scalability_and_performance/routing-optimization.html</span></a><span class="No-Break">.</span></p>
			<div>
				<div id="_idContainer073" class="IMG---Figure">
					<img src="image/Table_03_new.jpg" alt=""/>
				</div>
			</div>
			<h3>Shared clusters, dedicated worker nodes, and ingress controllers</h3>
			<p>Finally, with<a id="_idIndexMarker235"/> this strategy, you can share a cluster among different tenants by providing a higher<a id="_idIndexMarker236"/> level of isolation. The following diagram shows this <span class="No-Break">cluster's architecture:</span></p>
			<div>
				<div id="_idContainer074" class="IMG---Figure">
					<img src="image/B18015_03_05.jpg" alt="Figure 3.5 – Shared cluster, dedicated worker nodes, and ingress controllers "/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.5 – Shared cluster, dedicated worker nodes, and ingress controllers</p>
			<p>This strategy can <a id="_idIndexMarker237"/>bring<a id="_idIndexMarker238"/> the following pros <span class="No-Break">and cons:</span></p>
			<div>
				<div id="_idContainer075" class="IMG---Figure">
					<img src="image/Table_05_new.jpg" alt=""/>
				</div>
			</div>
			<p>This <a id="_idIndexMarker239"/>kind of architecture usually works well for both production and non-production <a id="_idIndexMarker240"/>environments. If it's well defined and used, it has the same effect as <a id="_idIndexMarker241"/>dedicated clusters. The only difference between this strategy and dedicated clusters is that, in this case, a configuration mistake could lead to an application being deployed in the wrong tenant (by using the incorrect <strong class="bold">nodeSelector</strong> in a namespace, <span class="No-Break">for instance).</span></p>
			<h2 id="_idParaDest-64"><a id="_idTextAnchor072"/>OpenShift multitenancy checklist</h2>
			<p>To conclude<a id="_idIndexMarker242"/> this chapter, we have decided to add some additional items to the checklist we started building in the previous chapter, <span class="No-Break">as follows:</span></p>
			<div>
				<div id="_idContainer076" class="IMG---Figure">
					<img src="image/Table_06_new.jpg" alt=""/>
				</div>
			</div>
			<p>In the <a id="_idIndexMarker243"/>next chapter, you will acquire more knowledge about the personas that are usually related to OpenShift, from C-level to operational level, and what skills are required for each role. You will be able to understand what you should expect from each role and prepare yourself and your team to work well <span class="No-Break">with OpenShift.</span></p>
			<h1 id="_idParaDest-65"><a id="_idTextAnchor073"/>Summary</h1>
			<p>In this chapter, we looked at some of the strategies that provide services for multiple tenants with OpenShift clusters. You now understand that we can have dedicated or shared OpenShift clusters to host tenants. You also saw that with shared clusters, you can provide some level of isolation for each tenant by using namespaces, ResourceQuotas, NetworkPolicies, and other objects to provide multitenancy or even have a physical separation of workers and/or ingress; the best option for your use case depends on the requirements of your organization, workloads, <span class="No-Break">and environments.</span></p>
			<p>However, I need to warn you that in the current hybrid cloud world, you will probably need to work with clusters in different providers and regions, which may lead you to have an increasing number of clusters. But don't worry – as we saw in <a href="B18015_01.xhtml#_idTextAnchor016"><span class="No-Break"><em class="italic">Chapter 1</em></span></a>, <em class="italic">Hybrid Cloud Journey and Strategies</em>, many great tools can help us manage several clusters, such as Red Hat Advanced Cluster Management, Advanced Cluster Security and Quay; we will take a deep dive into these tools by covering practical examples in the last part of this book, which is dedicated only <span class="No-Break">to them.</span></p>
			<p>In the next chapter, we will learn about the personas and skillsets that are usually related to OpenShift, their main duties and responsibilities, and other <span class="No-Break">important factors.</span></p>
			<h1 id="_idParaDest-66"><a id="_idTextAnchor074"/>Further reading</h1>
			<p>If you want to find out more about the concepts that were covered in this chapter, check out the <span class="No-Break">following references:</span></p>
			<ul>
				<li><em class="italic">What is </em><span class="No-Break"><em class="italic">multitenancy?</em></span><span class="No-Break"> </span><a href="https://www.redhat.com/en/topics/cloud-computing/what-is-multitenancy"><span class="No-Break">https://www.redhat.com/en/topics/cloud-computing/what-is-multitenancy</span></a></li>
				<li><em class="italic">Multi-tenant network isolation (OpenShift </em><span class="No-Break"><em class="italic">documentation):</em></span><span class="No-Break"> </span><a href="https://docs.openshift.com/container-platform/4.8/networking/network_policy/multitenant-network-policy.html"><span class="No-Break">https://docs.openshift.com/container-platform/4.8/networking/network_policy/multitenant-network-policy.html</span></a></li>
			</ul>
		</div>
</body></html>