<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Chapter&#xA0;4.&#xA0;Using MySQL with OpenShift Applications"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04" class="calibre1"/>Chapter 4. Using MySQL with OpenShift Applications</h1></div></div></div><p class="calibre6">This chapter presents a number of recipes that show you how to get started with the OpenShift MySQL database cartridge. You will learn how to add and manage the MySQL cartridge, how to take MySQL database backups, and how to use Amazon RDS MySQL support with OpenShift applications. The specific recipes within this chapter are:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Adding a MySQL cartridge to your application</li><li class="listitem">Adding a phpMyAdmin cartridge to your application</li><li class="listitem">Accessing a MySQL database from your local machine</li><li class="listitem">Connecting to a MySQL cartridge from your local machine using MySQL Workbench</li><li class="listitem">Updating the MySQL max connections setting</li><li class="listitem">Updating the MySQL configuration settings</li><li class="listitem">Performing scheduled MySQL database backups</li><li class="listitem">Using an Amazon RDS MySQL DB instance with OpenShift</li></ul></div></div>

<div class="book" title="Chapter&#xA0;4.&#xA0;Using MySQL with OpenShift Applications">
<div class="book" title="Introduction"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch04lvl1sec55" class="calibre1"/>Introduction</h1></div></div></div><p class="calibre6">Every typical web application needs some sort of persistent data storage on the backend. OpenShift supports a number of options to store your data, including several third-party providers that liberate you from having to deal with hardware provisioning and database management. At the time of writing this book, OpenShift officially supports the MySQL, PostgreSQL, and MongoDB data stores. Apart from these supported databases, there are third-party downloadable database cartridges available for data stores, such as Redis and MariaDB. Red Hat does not support downloadable cartridges, so you have to use them at your own risk. This chapter will cover the MySQL cartridge in detail. <a class="calibre1" title="Chapter 5. Using PostgreSQL with OpenShift Applications" href="part0070_split_000.html#page">Chapter 5</a>, <span class="strong"><em class="calibre10">Using PostgreSQL with OpenShift Applications</em></span>, and <a class="calibre1" title="Chapter 6. Using MongoDB and Third-party Database Cartridges with OpenShift Applications" href="part0079_split_000.html#page">Chapter 6</a>, <span class="strong"><em class="calibre10">Using MongoDB and Third-party Database Cartridges with OpenShift Applications,</em></span> will cover the PostgreSQL and MongoDB cartridges respectively.</p><p class="calibre6">This chapter will use the PHP 5.4 application we created in <a class="calibre1" title="Chapter 3. Creating and Managing Applications" href="part0041_split_000.html#page">Chapter 3</a>, <span class="strong"><em class="calibre10">Creating and Managing Applications</em></span>. If you do not have any OpenShift application running, then you can create a new OpenShift application by running the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc create-app myapp php-5.4</strong></span>
</pre></div><p class="calibre6">In the preceding command, we created a nonscalable application, as we have not used the <code class="email">–s</code> option. If the application is nonscalable, then the database cartridges are installed on the same gear as the primary application gear. If you created a scalable application, then the database cartridge is installed on its own gear. This allows a database to use all the available RAM and disk space. We will cover scalable applications in <a class="calibre1" title="Chapter 11. Logging and Scaling Your OpenShift Applications" href="part0131_split_000.html#page">Chapter 11</a>, <span class="strong"><em class="calibre10">Logging and Scaling Your OpenShift Applications</em></span>.</p><p class="calibre6">OpenShift also provides a persistent data directory to store your data. The persistent data directory is not scalable and, hence, should not be used with scalable applications. For scalable applications, you should use a third-party service such as Amazon S3.</p><p class="calibre6">OpenShift supports stock-standard, security-hardened distributions of MySQL, PostgreSQL, and MongoDB databases. If something goes wrong, the OpenShift operation team is available to fix operational issues. Also, as you are using standard versions of databases, you are not locked inside OpenShift and can easily port your data if required. In this chapter, we will cover how to take periodic backups of your database cartridges to make sure you always have your data in case something goes wrong.</p><p class="calibre6">You can also use third-party database services, such as Amazon RDS, if running your database in OpenShift is not possible, or you have already invested in third-party services. Another reason you might like to use a third-party database service is that the OpenShift database cartridges are not scalable. So, for applications where you need horizontally scalable, highly available databases, you can use any of the third-party database services covered in this chapter. This chapter will cover how to use Amazon RDS with OpenShift applications. <a class="calibre1" title="Chapter 5. Using PostgreSQL with OpenShift Applications" href="part0070_split_000.html#page">Chapter 5</a>, <span class="strong"><em class="calibre10">Using PostgreSQL with OpenShift Applications</em></span>, and <a class="calibre1" title="Chapter 6. Using MongoDB and Third-party Database Cartridges with OpenShift Applications" href="part0079_split_000.html#page">Chapter 6</a>, <span class="strong"><em class="calibre10">Using MongoDB and Third-party Database Cartridges with OpenShift Applications</em></span>, will cover third-party PostgreSQL and MongoDB cloud database services.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Adding a MySQL cartridge to your application"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec56" class="calibre1"/>Adding a MySQL cartridge to your application</h1></div></div></div><p class="calibre6">At the time of<a id="id344" class="calibre1"/> this writing, OpenShift supports two versions of the <a id="id345" class="calibre1"/>MySQL database. You can view the supported MySQL versions by running the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridges|grep mysql</strong></span>
<span class="strong"><strong class="calibre7">mysql-5.1           MySQL 5.1                               addon</strong></span>
<span class="strong"><strong class="calibre7">mysql-5.5           MySQL 5.5                               addon</strong></span>
</pre></div></div>

<div class="book" title="Adding a MySQL cartridge to your application">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec219" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To prepare for this recipe, you will need the <code class="email">rhc</code> command-line client installed on your machine. Please refer to the <span class="strong"><em class="calibre10">Installing the OpenShift rhc command-line client</em></span> recipe in <a class="calibre1" title="Chapter 1. Getting Started with OpenShift" href="part0014_split_000.html#page">Chapter 1</a>, <span class="strong"><em class="calibre10">Getting Started with OpenShift</em></span>, for more details. Also, we will use the application created in the <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe in <a class="calibre1" title="Chapter 3. Creating and Managing Applications" href="part0041_split_000.html#page">Chapter 3</a>, <span class="strong"><em class="calibre10">Creating and Managing Applications</em></span>.</p></div></div>

<div class="book" title="Adding a MySQL cartridge to your application">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec220" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Follow these steps to add the<a id="id346" class="calibre1"/> MySQL database cartridge to your <a id="id347" class="calibre1"/>OpenShift application and manage it:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">To add the MySQL 5.5 cartridge to the <code class="email">myapp</code> application, open a new command-line terminal, change the directory to the <code class="email">myapp</code> directory location, and execute the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc add-cartridge -c mysql-5.5 --app myapp</strong></span>
</pre></div></li><li class="listitem" value="2">This will install a new instance of the MySQL database on your application gear. The <code class="email">-c</code> option is used to specify the cartridge name, and the <code class="email">--app</code> option is used to specify the application name. The <code class="email">--app</code> option is not required if you are running the command from within the application directory. The <code class="email">-c</code> option is required, but you can get away from writing <code class="email">-c</code> as the <code class="email">rhc</code> command-line client is intelligent enough to infer that <code class="email">mysql-5.5</code> is the cartridge name. This can be seen in the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridge-add mysql-5.5</strong></span>
</pre></div></li><li class="listitem" value="3">You can view the cartridge details using the <code class="email">rhc show-cartridge</code> command as shown in the following command line:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc show-cartridge mysql</strong></span>
<span class="strong"><strong class="calibre7">Using mysql-5.5 (MySQL 5.5) for 'mysql'</strong></span>
<span class="strong"><strong class="calibre7">mysql-5.5 (MySQL 5.5)</strong></span>
<span class="strong"><strong class="calibre7">---------------------</strong></span>
<span class="strong"><strong class="calibre7">  Gears:          Located with php-5.4</strong></span>
<span class="strong"><strong class="calibre7">  Connection URL: mysql://$OPENSHIFT_MYSQL_DB_HOST:$OPENSHIFT_MYSQL_DB_PORT/</strong></span>
<span class="strong"><strong class="calibre7">  Database Name:  myapp</strong></span>
<span class="strong"><strong class="calibre7">  Password:       lQkran3E1a4K</strong></span>
<span class="strong"><strong class="calibre7">  Username:       adminjL3VBAM</strong></span>
</pre></div></li><li class="listitem" value="4">To stop the MySQL database cartridge, use the <code class="email">stop</code> command as shown in this command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc stop-cartridge mysql</strong></span>
</pre></div></li><li class="listitem" value="5">To restart the MySQL database cartridge, use the <code class="email">restart</code> command as shown in the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc restart-cartridge mysql</strong></span>
</pre></div></li><li class="listitem" value="6">Finally, if you want to remove the MySQL database from your application, you can use the <code class="email">remove</code> command as shown in this command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc remove-cartridge mysql --confirm</strong></span>
</pre></div></li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Adding a MySQL cartridge to your application">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec221" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">When you run <a id="id348" class="calibre1"/>the <code class="email">rhc cartridge-add</code> command, <code class="email">rhc</code> will make <a id="id349" class="calibre1"/>an HTTP POST request to the OpenShift<a id="id350" class="calibre1"/> server. The OpenShift server will receive the request and instantiate a new instance of the MySQL server for your application. After provisioning the MySQL server, the <code class="email">rhc</code> client will show the database details on the command-line terminal as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">Adding mysql-5.5 to application 'myapp' ... done</strong></span>

<span class="strong"><strong class="calibre7">mysql-5.5 (MySQL 5.5)</strong></span>
<span class="strong"><strong class="calibre7">---------------------</strong></span>
<span class="strong"><strong class="calibre7">  Gears:          Located with php-5.4</strong></span>
<span class="strong"><strong class="calibre7">  Connection URL: mysql://$OPENSHIFT_MYSQL_DB_HOST:$OPENSHIFT_MYSQL_DB_PORT/</strong></span>
<span class="strong"><strong class="calibre7">  Database Name:  myapp</strong></span>
<span class="strong"><strong class="calibre7">  Password:       lQkran3E1a4K</strong></span>
<span class="strong"><strong class="calibre7">  Username:       adminjL3VBAM</strong></span>

<span class="strong"><strong class="calibre7">MySQL 5.5 database added.  Please make note of these credentials:</strong></span>

<span class="strong"><strong class="calibre7">       Root User: adminjL3VBAM</strong></span>
<span class="strong"><strong class="calibre7">   Root Password: lQkran3E1a4K</strong></span>
<span class="strong"><strong class="calibre7">   Database Name: myapp</strong></span>

<span class="strong"><strong class="calibre7">Connection URL: mysql://$OPENSHIFT_MYSQL_DB_HOST:$OPENSHIFT_MYSQL_DB_PORT/</strong></span>
</pre></div><p class="calibre6">You can view the MySQL installation by performing SSH into your application gear:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc ssh --app myapp </strong></span>
</pre></div><p class="calibre6">Then run the <code class="email">ls</code> command to view the gear directory structure:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">[myapp-osbook.rhcloud.com 52fb71aa5973caf609000026]\&gt; ls -p</strong></span>
<span class="strong"><strong class="calibre7">app-deployments/  app-root/  git/  mysql/  php/</strong></span>
</pre></div><p class="calibre6">The <code class="email">mysql</code> directory hosts your <code class="email">mysql</code> installation. The MySQL database is not shared with any other OpenShift application or user. It is only for your application, and only your application can access it.</p><p class="calibre6">You can connect to<a id="id351" class="calibre1"/> the <code class="email">mysql</code> directory with your MySQL <a id="id352" class="calibre1"/>database using the <code class="email">mysql</code> command-line client as shown in the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">[myapp-osbook.rhcloud.com 52fb71aa5973caf609000026]\&gt; mysql</strong></span>
<span class="strong"><strong class="calibre7">Welcome to the MySQL monitor.  Commands end with ; or \g.</strong></span>
<span class="strong"><strong class="calibre7">Your MySQL connection id is 3</strong></span>
<span class="strong"><strong class="calibre7">Server version: 5.5.32 MySQL Community Server (GPL)</strong></span>

<span class="strong"><strong class="calibre7">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</strong></span>

<span class="strong"><strong class="calibre7">mysql&gt;</strong></span>
</pre></div><p class="calibre6">Now, you can run SQL commands against your MySQL server. To view all the databases, run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">mysql&gt; SHOW DATABASES;</strong></span>
<span class="strong"><strong class="calibre7">+--------------------+</strong></span>
<span class="strong"><strong class="calibre7">| Database           |</strong></span>
<span class="strong"><strong class="calibre7">+--------------------+</strong></span>
<span class="strong"><strong class="calibre7">| information_schema |</strong></span>
<span class="strong"><strong class="calibre7">| myapp              |</strong></span>
<span class="strong"><strong class="calibre7">| mysql              |</strong></span>
<span class="strong"><strong class="calibre7">| performance_schema |</strong></span>
<span class="strong"><strong class="calibre7">+--------------------+</strong></span>
<span class="strong"><strong class="calibre7">4 rows in set (0.00 sec)</strong></span>
</pre></div><p class="calibre6">The <code class="email">myapp</code> database corresponds to your application database. You can use this database for your application or create a new database using the <code class="email">CREATE DATABASE</code> command. To view the uptime of your MySQL database, try running the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">mysql&gt; SHOW STATUS LIKE 'Uptime';</strong></span>
<span class="strong"><strong class="calibre7">+---------------+-------+</strong></span>
<span class="strong"><strong class="calibre7">| Variable_name | Value |</strong></span>
<span class="strong"><strong class="calibre7">+---------------+-------+</strong></span>
<span class="strong"><strong class="calibre7">| Uptime        | 2573  |</strong></span>
<span class="strong"><strong class="calibre7">+---------------+-------+</strong></span>
<span class="strong"><strong class="calibre7">1 row in set (0.00 sec)</strong></span>
</pre></div><p class="calibre6">The output shows that the MySQL server is up from the last <code class="email">2573</code> seconds.</p><p class="calibre6">You can view all the available <a id="id353" class="calibre1"/>MySQL command-line utilities on the gear by <a id="id354" class="calibre1"/>typing <code class="email">mysql</code> and hitting <span class="strong"><em class="calibre10">Tab</em></span> twice:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">[myapp-osbook.rhcloud.com 52fb71aa5973caf609000026]\&gt; mysql</strong></span>
<span class="strong"><strong class="calibre7">mysql                       mysql_convert_table_format  mysql_fix_privilege_tables  mysqlslap</strong></span>
<span class="strong"><strong class="calibre7">mysqlaccess                 mysqld_multi                mysqlhotcopy  mysqltest</strong></span>
<span class="strong"><strong class="calibre7">mysqladmin                  mysqld_safe                 mysqlimport   mysql_tzinfo_to_sql</strong></span>
<span class="strong"><strong class="calibre7">mysqlbinlog                 mysqldump                   mysql_install_db            mysql_upgrade</strong></span>
<span class="strong"><strong class="calibre7">mysqlbug                    mysqldumpslow               mysql_secure_installation   mysql_waitpid</strong></span>
<span class="strong"><strong class="calibre7">mysqlcheck                  mysql_find_rows             mysql_setpermission         mysql_zap</strong></span>
<span class="strong"><strong class="calibre7">mysql_config                mysql_fix_extensions        mysqlshow</strong></span>
</pre></div></div></div>

<div class="book" title="Adding a MySQL cartridge to your application">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch04lvl2sec222" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre6">You can also add MySQL cartridges <a id="id355" class="calibre1"/>from the <a id="id356" class="calibre1"/>OpenShift web console. Go to <a class="calibre1" href="https://openshift.redhat.com/app/console/applications">https://openshift.redhat.com/app/console/applications</a>, and click on the <code class="email">myapp</code> application for details. On the <code class="email">myapp</code> application details web page, you will see the option to add the MySQL database as shown in the following screenshot. Click on the <span class="strong"><strong class="calibre7">Add MySQL 5.5</strong></span> link to add the MySQL 5.5 cartridge.</p><div class="mediaobject"><img src="../images/00023.jpeg" alt="There's more…" class="calibre8"/></div><p class="calibre9"> </p><p class="calibre6">Next, click on the <span class="strong"><strong class="calibre7">Add Cartridge</strong></span> button to add the MySQL 5.5 cartridge to your application as shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00024.jpeg" alt="There's more…" class="calibre8"/></div><p class="calibre9"> </p><p class="calibre6">After installing the <a id="id357" class="calibre1"/>MySQL cartridge, you will be shown the MySQL database details as follows:</p><div class="mediaobject"><img src="../images/00025.jpeg" alt="There's more…" class="calibre8"/></div><p class="calibre9"> </p></div></div>

<div class="book" title="Adding a MySQL cartridge to your application">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch04lvl2sec223" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe in <a class="calibre1" title="Chapter 3. Creating and Managing Applications" href="part0041_split_000.html#page">Chapter 3</a>, <span class="strong"><em class="calibre10">Creating and Managing Applications</em></span></li><li class="listitem">The <span class="strong"><em class="calibre10">Adding a phpMyAdmin cartridge to your application</em></span> recipe</li><li class="listitem">The Accessing a MySQL database from your local machine recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Adding a phpMyAdmin cartridge to your application"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec57" class="calibre1"/>Adding a phpMyAdmin cartridge to your application</h1></div></div></div><p class="calibre6">phpMyAdmin<a id="id358" class="calibre1"/> (which you <a id="id359" class="calibre1"/>can access at <a class="calibre1" href="http://www.phpmyadmin.net/">http://www.phpmyadmin.net/</a>) is a free, open source, and popular tool written in the PHP programming language to handle the administration of the MySQL database via a web browser. In this recipe, you will learn how to install a phpMyAdmin cartridge to your application.</p></div>

<div class="book" title="Adding a phpMyAdmin cartridge to your application">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec224" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To complete<a id="id360" class="calibre1"/> this recipe, you will need an application <a id="id361" class="calibre1"/>with a MySQL cartridge. Please refer to the <span class="strong"><em class="calibre10">Adding a MySQL cartridge to your application</em></span> recipe in this chapter to learn how to add a MySQL cartridge.</p></div></div>

<div class="book" title="Adding a phpMyAdmin cartridge to your application">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec225" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">This recipe will walk you through all the steps required to add a phpMyAdmin cartridge to the OpenShift application:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">To install the phpMyAdmin cartridge to the <code class="email">myapp</code> application, open a new command-line terminal, change the directory to the <code class="email">myapp</code> directory location, and execute the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc add-cartridge phpmyadmin-4</strong></span>
</pre></div></li><li class="listitem" value="2">Note the username and password returned by the <code class="email">rhc add-cartridge</code> command. You will need the credentials to log in to phpMyAdmin. The phpMyAdmin credentials are the same as your MySQL database credentials, and you can view them anytime by executing the <code class="email">rhc show-app</code> command.</li><li class="listitem" value="3">Log in to phpMyAdmin, accessible at <code class="email">https://myapp-{domain-name}.rhcloud.com/phpmyadmin/</code>, using the credentials you got in step 1.</li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Adding a phpMyAdmin cartridge to your application">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec226" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">When you run <a id="id362" class="calibre1"/>the <code class="email">rhc cartridge-add</code> command, the <code class="email">rhc</code> client makes an HTTP POST request to the OpenShift server. The OpenShift server receives the request and installs the phpMyAdmin cartridge on the application gear. The phpMyAdmin cartridge works with all the supported application types (Java, Python, Node.js, Ruby, Perl, and PHP). You don't need to create PHP applications to use the phpMyAdmin cartridge. OpenShift will start an Apache process to run the phpMyAdmin application.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note17" class="calibre1"/>Note</h3><p class="calibre6">You can only <a id="id363" class="calibre1"/>add a phpMyAdmin cartridge <a id="id364" class="calibre1"/>after you have added a MySQL cartridge to your application. If you try to add the phpMyAdmin cartridge before adding the MySQL cartridge, then you will get an error, <code class="email">Cartridge 'phpmyadmin-4' cannot be added without mysql</code>. The dependency <code class="email">mysql</code> can be satisfied with <code class="email">mysql-5.5</code> or <code class="email">mysql-5.1</code>.</p></div></div></div>

<div class="book" title="Adding a phpMyAdmin cartridge to your application">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch04lvl2sec227" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre6">You can also add the phpMyAdmin cartridge<a id="id365" class="calibre1"/> from the OpenShift web console. Go to <a class="calibre1" href="https://openshift.redhat.com/app/console/applications">https://openshift.redhat.com/app/console/applications</a>, and add the phpMyAdmin cartridge.</p></div></div>

<div class="book" title="Adding a phpMyAdmin cartridge to your application">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch04lvl2sec228" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Adding a MySQL cartridge to your application</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Accessing a MySQL database from your local machine</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Accessing a MySQL database from your local machine"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec58" class="calibre1"/>Accessing a MySQL database from your local machine</h1></div></div></div><p class="calibre6">In the <span class="strong"><em class="calibre10">Adding a MySQL cartridge to your application</em></span> recipe of this chapter, you learned how to access the MySQL<a id="id366" class="calibre1"/> database by performing an SSH <a id="id367" class="calibre1"/>into the application gear. In this recipe, you will learn how to connect with the MySQL database from your local machine.</p></div>

<div class="book" title="Accessing a MySQL database from your local machine">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec229" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To complete this recipe, you will need an application with a MySQL cartridge. Please refer to the <span class="strong"><em class="calibre10">Adding a MySQL cartridge to your application</em></span> recipe to learn how to install a MySQL cartridge. Also, you will need the <code class="email">mysql</code> command-line client on your machine. You can download the MySQL community server<a id="id368" class="calibre1"/> (which includes the <code class="email">mysql</code> command-line client) from the official website at <a class="calibre1" href="http://dev.mysql.com/downloads/mysql/">http://dev.mysql.com/downloads/mysql/</a>.</p></div></div>

<div class="book" title="Accessing a MySQL database from your local machine">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec230" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Follow these steps to access the MySQL cartridge from your local machine:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open a command-line terminal, and change the directory to the <code class="email">myapp</code> application directory. Execute the following command to forward remote ports to the local machine:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc port-forward --app myapp</strong></span>
</pre></div></li><li class="listitem" value="2">The output of the preceding command will list down ports along with services that you could use to connect from your local machine. The output is as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">Service Local               OpenShift</strong></span>
<span class="strong"><strong class="calibre7">------- -------------- ---- -------------------</strong></span>
<span class="strong"><strong class="calibre7">httpd   127.0.0.1:8080  =&gt;  127.12.123.129:8080</strong></span>
<span class="strong"><strong class="calibre7">mysql   127.0.0.1:3306  =&gt;  127.12.123.130:3306</strong></span>
<span class="strong"><strong class="calibre7">Press CTRL-C to terminate port forwarding</strong></span>
</pre></div></li><li class="listitem" value="3">Connect to the <a id="id369" class="calibre1"/>MySQL server from<a id="id370" class="calibre1"/> the local <code class="email">mysql</code> command-line client as shown in the following command. You can get the username and password for the MySQL cartridge using the <code class="email">rhc show-app</code> <a id="id371" class="calibre1"/>or<a id="id372" class="calibre1"/> <code class="email">rhc cartridge-show</code> <code class="email">mysql</code> command. The hostname and port are available in the output of the <code class="email">rhc port-forward</code> command.<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ mysql --user=&lt;user&gt; --password=&lt;password&gt; --host 127.0.0.1 --port 3306</strong></span>
</pre></div></li><li class="listitem" value="4">Once connected to the MySQL server, you can run any valid SQL command as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">mysql&gt; SHOW DATABASES;</strong></span>
<span class="strong"><strong class="calibre7">+--------------------+</strong></span>
<span class="strong"><strong class="calibre7">| Database           |</strong></span>
<span class="strong"><strong class="calibre7">+--------------------+</strong></span>
<span class="strong"><strong class="calibre7">| information_schema |</strong></span>
<span class="strong"><strong class="calibre7">| myapp              |</strong></span>
<span class="strong"><strong class="calibre7">| mysql              |</strong></span>
<span class="strong"><strong class="calibre7">| performance_schema |</strong></span>
<span class="strong"><strong class="calibre7">+--------------------+</strong></span>
<span class="strong"><strong class="calibre7">4 rows in set (0.38 sec)</strong></span>
</pre></div></li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Accessing a MySQL database from your local machine">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec231" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">In step 1, you used the <code class="email">rhc port-forward</code> command<a id="id373" class="calibre1"/> to forward all the remote ports to the local machine. The <code class="email">rhc port-forward</code> command is a wrapper around the SSH port. Forwarding that makes a port on the remote machine available on your local machine. A port on the remote machine, which would otherwise be unavailable to you, can be used just as if it's on your local machine. The following command returns the list of ports that you can connect to from your local machine:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc port-forward --app myapp</strong></span>
<span class="strong"><strong class="calibre7">Checking available ports ... done</strong></span>
<span class="strong"><strong class="calibre7">Forwarding ports ...</strong></span>

<span class="strong"><strong class="calibre7">To connect to a service running on OpenShift, use the Local address</strong></span>

<span class="strong"><strong class="calibre7">Service Local               OpenShift</strong></span>
<span class="strong"><strong class="calibre7">------- -------------- ---- ------------------</strong></span>
<span class="strong"><strong class="calibre7">httpd   127.0.0.1:8080  =&gt;  127.9.255.129:8080</strong></span>
<span class="strong"><strong class="calibre7">mysql   127.0.0.1:3306  =&gt;  127.9.255.130:3306</strong></span>

<span class="strong"><strong class="calibre7">Press CTRL-C to terminate port forwarding</strong></span>
</pre></div><p class="calibre6">As you can see from the preceding output, the MySQL process is available at port <code class="email">3306</code> on the <code class="email">127.0.0.1</code> host.</p><p class="calibre6">In step 2, you<a id="id374" class="calibre1"/> connected to the MySQL server from your <a id="id375" class="calibre1"/>local machine, passing in the username, password, host, and port of the database. After successful connection, you ran a SQL command in step 3.</p><p class="calibre6">To terminate port forwarding, just press <span class="strong"><em class="calibre10">Ctrl</em></span> + <span class="strong"><em class="calibre10">C</em></span> on the command-line terminal where the <code class="email">rhc port-forward</code> command<a id="id376" class="calibre1"/> is running.</p></div></div>

<div class="book" title="Accessing a MySQL database from your local machine">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch04lvl2sec232" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Adding a MySQL cartridge to your application</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Connecting to a MySQL cartridge from your local machine using MySQL Workbench</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Connecting to a MySQL cartridge from your local machine using MySQL Workbench"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec59" class="calibre1"/>Connecting to a MySQL cartridge from your local machine using MySQL Workbench</h1></div></div></div><p class="calibre6">In the <span class="strong"><em class="calibre10">Accessing a MySQL database from your local machine</em></span> recipe, we showed you how to connect to the MySQL<a id="id377" class="calibre1"/> database <a id="id378" class="calibre1"/>from the <code class="email">mysql</code> command line <a id="id379" class="calibre1"/>from your local machine using port forwarding. In this recipe, you will learn how to connect to the MySQL database from MySQL Workbench. MySQL Workbench is a visual database design tool that integrates SQL development, administration, database design, creation, and maintenance into a single integrated development environment for the MySQL database system.</p></div>

<div class="book" title="Connecting to a MySQL cartridge from your local machine using MySQL Workbench">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec233" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To complete this recipe, you will need an application with a MySQL cartridge. Please refer to the <span class="strong"><em class="calibre10">Adding a MySQL cartridge to your application</em></span> recipe of this chapter to learn how to install the MySQL cartridge. Also, you will need MySQL Workbench on your local machine. You can download MySQL Workbench<a id="id380" class="calibre1"/> from the MySQL official website at <a class="calibre1" href="http://dev.mysql.com/downloads/tools/workbench/">http://dev.mysql.com/downloads/tools/workbench/</a>.</p></div></div>

<div class="book" title="Connecting to a MySQL cartridge from your local machine using MySQL Workbench">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec234" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Follow these steps to <a id="id381" class="calibre1"/>connect to the <a id="id382" class="calibre1"/>MySQL cartridge from <a id="id383" class="calibre1"/>MySQL Workbench running on your local machine:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open a command-line terminal, and change the directory to the <code class="email">myapp</code> application directory. Execute the following command to forward the remote ports to the local machine:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc port-forward --app myapp</strong></span>
</pre></div></li><li class="listitem" value="2">Start the MySQL Workbench application, and you will see the following screenshot. Click on the plus button to add a new MySQL connection.<div class="mediaobject"><img src="../images/00026.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="3">Set up a new connection by entering the MySQL database details. You can get the username and password for the MySQL cartridge using the <code class="email">rhc show-app</code> or <code class="email">rhc cartridge-show</code> <code class="email">mysql</code> command. The hostname and port are available in the output of the <code class="email">rhc port-forward</code> command. The following screenshot shows the <span class="strong"><strong class="calibre7">Setup New Connection</strong></span> page:<div class="mediaobject"><img src="../images/00027.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="4">Next, test the <a id="id384" class="calibre1"/>connection<a id="id385" class="calibre1"/> by clicking on the <span class="strong"><strong class="calibre7">Test Connection</strong></span> button. After <a id="id386" class="calibre1"/>successful connection, you will see the following dialog box with the message <span class="strong"><strong class="calibre7">Connection parameters are correct</strong></span>:<div class="mediaobject"><img src="../images/00028.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="5">Connect to the<a id="id387" class="calibre1"/> MySQL <a id="id388" class="calibre1"/>cartridge by clicking on the <span class="strong"><strong class="calibre7">OK</strong></span> button. You will see the new<a id="id389" class="calibre1"/> connection listed on the MySQL Workbench screen shown in the following screenshot. Click on the connection to open SQL Editor.<div class="mediaobject"><img src="../images/00029.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="6">Now you can run any legitimate SQL query from within SQL Editor as shown in the following screenshot:<div class="mediaobject"><img src="../images/00030.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Connecting to a MySQL cartridge from your local machine using MySQL Workbench">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec235" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">In step 1, you used<a id="id390" class="calibre1"/> the <code class="email">rhc port-forward</code> command<a id="id391" class="calibre1"/> to forward all the<a id="id392" class="calibre1"/> remote ports to the local machine. This <a id="id393" class="calibre1"/>makes it possible to connect to the MySQL database running inside your application gear. From step 2 through to step 6, you created a new MySQL connection and connected with the MySQL cartridge from within MySQL Workbench. In Step 7, you executed a SQL query using SQL Editor to check whether that connection is getting data from the MySQL cartridge installed in your <code class="email">myapp</code> application.</p></div></div>

<div class="book" title="Connecting to a MySQL cartridge from your local machine using MySQL Workbench">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch04lvl2sec236" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Adding a MySQL cartridge to your application</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Accessing a MySQL database from your local machine</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Updating the MySQL max connections setting"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec60" class="calibre1"/>Updating the MySQL max connections setting</h1></div></div></div><p class="calibre6">The MySQL database will start giving too many connection errors when all the available connections are in use by other clients. In this recipe, you will learn how to update the MySQL cartridge max connections setting.</p></div>

<div class="book" title="Updating the MySQL max connections setting">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec237" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To complete this recipe, you<a id="id394" class="calibre1"/> will need an application with a MySQL cartridge. Please refer to the <span class="strong"><em class="calibre10">Adding a MySQL cartridge to your application</em></span> recipe of this chapter to learn how to install the MySQL cartridge.</p></div></div>

<div class="book" title="Updating the MySQL max connections setting">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec238" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Follow these steps to update the MySQL max connection setting:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">To set the maximum connections to <code class="email">200</code>, open a command-line terminal, and run the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc env-set OPENSHIFT_MYSQL_MAX_CONNECTIONS=200 --app myapp</strong></span>
</pre></div></li><li class="listitem" value="2">After setting the environment variable, you have to restart the MySQL cartridge for changes to take effect using the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridge-restart mysql --app myapp</strong></span>
</pre></div></li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Updating the MySQL max connections setting">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec239" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">The number of connections supported by the MySQL database is controlled by the <code class="email">max_connections</code> system variable. The default value of <code class="email">max_connections</code> is <code class="email">151</code>. You can see the current value by running the following SQL query against your MySQL database. To see <code class="email">max_connections</code> for your OpenShift application, SSH into the application gear, and run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">mysql&gt; show variables like 'max_connections';</strong></span>
<span class="strong"><strong class="calibre7">+-----------------+-------+</strong></span>
<span class="strong"><strong class="calibre7">| Variable_name   | Value |</strong></span>
<span class="strong"><strong class="calibre7">+-----------------+-------+</strong></span>
<span class="strong"><strong class="calibre7">| max_connections | 151   |</strong></span>
<span class="strong"><strong class="calibre7">+-----------------+-------+</strong></span>
</pre></div><p class="calibre6">One way to configure the <code class="email">max_connections</code> system variable is to add <code class="email">max_connections = 200</code> under the <code class="email">[mysqld]</code> section in the <code class="email">my.cnf</code> MySQL configuration file. This solution does not work with OpenShift as the <code class="email">my.cnf</code> file is read-only. To allow users to change the <code class="email">max_connections</code> value, OpenShift provides an environment variable called <code class="email">OPENSHIFT_MYSQL_MAX_CONNECTIONS</code> that can be used to set the <code class="email">max_connections</code> system variable. In step 1, you set the <code class="email">OPENSHIFT_MYSQL_MAX_CONNECTIONS</code> environment variable to <code class="email">200</code>. The MySQL server will not read the new value unless you restart the database. So, in step 2, you restarted the database using the <code class="email">rhc cartridge-restart</code> command. To verify whether the <code class="email">max_connections</code> value is updated, you can run the following SQL command again:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">mysql&gt; show variables like 'max_connections';</strong></span>
<span class="strong"><strong class="calibre7">+-----------------+-------+</strong></span>
<span class="strong"><strong class="calibre7">| Variable_name   | Value |</strong></span>
<span class="strong"><strong class="calibre7">+-----------------+-------+</strong></span>
<span class="strong"><strong class="calibre7">| max_connections | 200   |</strong></span>
<span class="strong"><strong class="calibre7">+-----------------+-------+</strong></span>
</pre></div><p class="calibre6">This is the <a id="id395" class="calibre1"/>recommended way to update the MySQL <code class="email">max_connections</code> system variable value. The only drawback with this approach is that you have to restart the MySQL database, which, depending on the circumstances, may not be the ideal way. Another way you could update the <code class="email">max_connections</code> system variable is by issuing the following SQL command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">mysql&gt; set global max_connections = 200;</strong></span>
</pre></div><p class="calibre6">This will take immediate effect and will not require a restart. However, this value will be lost once the MySQL database is restarted.</p><p class="calibre6">The best solution is to combine the two approaches. Run the <code class="email">set global max_connections = 200;</code> SQL command to make sure <code class="email">max_connections</code> is instantly updated, and then create a new environment variable using the <code class="email">rhc env-set</code> command. This means the next time your MySQL database is started, it will pick the value from the environment variable.</p></div></div>

<div class="book" title="Updating the MySQL max connections setting">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch04lvl2sec240" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Adding a MySQL cartridge to your application</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Updating the MySQL configuration settings</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Updating the MySQL configuration settings"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec61" class="calibre1"/>Updating the MySQL configuration settings</h1></div></div></div><p class="calibre6">The MySQL database stores its <a id="id396" class="calibre1"/>configuration settings in the <code class="email">my.cnf</code> file. This file is located under the <code class="email">conf</code> directory inside the MySQL cartridge installation. As mentioned in the previous recipe, OpenShift does not allow users to update the <code class="email">my.cnf</code> configuration file. The solution is to use a set of environment variables to configure various settings of the MySQL database.</p><p class="calibre6">At the time of writing this book, you could configure the following MySQL settings through the environment variables:</p><div class="informalexample"><table border="1" class="calibre15"><colgroup class="calibre16"><col class="calibre17"/><col class="calibre17"/></colgroup><thead class="calibre18"><tr class="calibre19"><th valign="bottom" class="calibre20">
<p class="calibre21">MySQL setting</p>
</th><th valign="bottom" class="calibre20">
<p class="calibre21">OpenShift environment variable</p>
</th></tr></thead><tbody class="calibre22"><tr class="calibre19"><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">lower_case_table_names</code>
</p>
</td><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">OPENSHIFT_MYSQL_LOWER_CASE_TABLE_NAMES</code>
</p>
</td></tr><tr class="calibre19"><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">default-storage-engine</code>
</p>
</td><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">OPENSHIFT_MYSQL_DEFAULT_STORAGE_ENGINE</code>
</p>
</td></tr><tr class="calibre19"><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">max_connections</code>
</p>
</td><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">OPENSHIFT_MYSQL_MAX_CONNECTIONS</code>
</p>
</td></tr><tr class="calibre19"><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">ft_min_word_len</code>
</p>
</td><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">OPENSHIFT_MYSQL_FT_MIN_WORD_LEN</code>
</p>
</td></tr><tr class="calibre19"><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">ft_max_word_len</code>
</p>
</td><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">OPENSHIFT_MYSQL_FT_MAX_WORD_LEN</code>
</p>
</td></tr><tr class="calibre19"><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">innodb_use_native_aio</code>
</p>
</td><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">OPENSHIFT_MYSQL_AIO</code>
</p>
</td></tr><tr class="calibre19"><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">default-time-zone</code>
</p>
</td><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">OPENSHIFT_MYSQL_TIMEZONE</code>
</p>
</td></tr><tr class="calibre19"><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">table_open_cache</code>
</p>
</td><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">OPENSHIFT_MYSQL_TABLE_OPEN_CACHE</code>
</p>
</td></tr></tbody></table></div></div>

<div class="book" title="Updating the MySQL configuration settings">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec241" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To complete this <a id="id397" class="calibre1"/>recipe, you will need an application with a MySQL cartridge. Please refer to the <span class="strong"><em class="calibre10">Adding a MySQL cartridge to your application</em></span> recipe of this chapter to learn how to add a MySQL cartridge to your application.</p></div></div>

<div class="book" title="Updating the MySQL configuration settings">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec242" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Follow these steps to update the MySQL <code class="email">lower_case_table_names</code> configuration:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">To set the <code class="email">lower_case_table_names</code> setting, you should type the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc env-set OPENSHIFT_MYSQL_LOWER_CASE_TABLE_NAMES=1 --app myapp</strong></span>
</pre></div></li><li class="listitem" value="2">After setting the environment variable, you have to restart the MySQL cartridge for changes to take effect using the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridge-restart mysql --app myapp</strong></span>
</pre></div></li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Updating the MySQL configuration settings">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec243" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">The way it works is that OpenShift provides a set of environment variables that you can set to configure the MySQL configuration settings. After setting the environment variable, you have to restart the MySQL database so that it can use the new configuration value.</p></div></div>

<div class="book" title="Updating the MySQL configuration settings">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch04lvl2sec244" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Adding a MySQL cartridge to your application</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Updating the MySQL max connections setting</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Performing scheduled MySQL database backups"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec62" class="calibre1"/>Performing scheduled MySQL database backups</h1></div></div></div><p class="calibre6">In this recipe, you will learn how to perform a scheduled backup of your MySQL database and upload it to Amazon S3.</p></div>

<div class="book" title="Performing scheduled MySQL database backups">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec245" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To complete this recipe, you <a id="id398" class="calibre1"/>will need an application with a MySQL cartridge. Please refer to the <span class="strong"><em class="calibre10">Adding a MySQL cartridge to your application</em></span> recipe of this chapter to learn how to install the MySQL cartridge. Also, you need to have an <a id="id399" class="calibre1"/>Amazon AWS account. Visit <a class="calibre1" href="http://aws.amazon.com/">http://aws.amazon.com/</a>, and sign up for a new account if you don't have one already.</p></div></div>

<div class="book" title="Performing scheduled MySQL database backups">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec246" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Follow these steps to schedule a daily backup of your MySQL cartridge:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Go to <a class="calibre1" href="https://console.aws.amazon.com/s3/home">https://console.aws.amazon.com/s3/home</a>, and create a new bucket to store your database backups.</li><li class="listitem" value="2">Add a <code class="email">cron</code> cartridge to your application by running the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc add-cartridge cron --app myapp</strong></span>
</pre></div></li><li class="listitem" value="3">SSH into the application gear, and download the <code class="email">s3-bash</code> utility in <code class="email">$OPENSHIFT_DATA_DIR</code>. Then, extract it to the <code class="email">s3-bash</code> directory by running the following commands:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc ssh --app myapp</strong></span>
<span class="strong"><strong class="calibre7">$ cd $OPENSHIFT_DATA_DIR</strong></span>
<span class="strong"><strong class="calibre7">$ wget http://s3-bash.googlecode.com/files/s3-bash.0.02.tar.gz</strong></span>
<span class="strong"><strong class="calibre7">$ mkdir s3-bash</strong></span>
<span class="strong"><strong class="calibre7">$ tar -xf s3-bash.0.02.tar.gz -C s3-bash</strong></span>
</pre></div></li><li class="listitem" value="4">Create a new file called <code class="email">AWSSecretAccessKeyIdFile</code> in the <code class="email">$OPENSHIFT_DATA_DIR/s3-bash</code> directory, and store your Amazon access key secret to it. This is required by <code class="email">s3-bash</code> to communicate with Amazon S3.</li><li class="listitem" value="5">Create a script on your local machine at <code class="email">.openshift/cron/minutely</code> named <code class="email">database_backup.sh</code>, and add the following contents to it:<div class="informalexample"><pre class="programlisting">#!/bin/bash
if [ `date +%H:%M` == "23:50" ]
then
    FILE_NAME=$(date +"%Y%m%d%H%M")
    mysqldump --user $OPENSHIFT_MYSQL_DB_USERNAME -p$OPENSHIFT_MYSQL_DB_PASSWORD --host $OPENSHIFT_MYSQL_DB_HOST $BACKUP_DATABASE_NAME &gt; $OPENSHIFT_DATA_DIR/$FILE_NAME.sql
    echo "Took MySQL Dump" &gt;&gt; $OPENSHIFT_CRON_DIR/log/backup.log
    $OPENSHIFT_DATA_DIR/s3-bash/s3-put -k $AWS_ACCESS_KEY_ID -s $OPENSHIFT_DATA_DIR/s3-bash/AWSSecretAccessKeyIdFile -T $OPENSHIFT_DATA_DIR/$FILE_NAME.sql /$AWS_S3_BUCKET/$FILE_NAME.sql
    echo "Uploaded dump to Amazon S3" &gt;&gt; $OPENSHIFT_CRON_DIR/log/backup.log
    rm -f $OPENSHIFT_DATA_DIR/$FILE_NAME.sql
fi</pre></div></li><li class="listitem" value="6">The <a id="id400" class="calibre1"/>preceding script will run every day at <code class="email">23:50</code> and run the <code class="email">mysqldump</code> command to create the data dump file. The file is then transferred to Amazon S3 using the <code class="email">s3-bash</code> API. Finally, after uploading the file, it deletes the SQL dump file from the application gear.</li><li class="listitem" value="7">Create the following environment variables. Please refer to the Amazon EC2 documentation for detailed steps on how to create access keys and <code class="email">S3 bucket</code>. You then run the following commands:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc env-set AWS_ACCESS_KEY_ID=&lt; Your Amazon ACCESS_KEY_ID&gt;</strong></span>
<span class="strong"><strong class="calibre7">$ rhc env-set BACKUP_DATABASE_NAME=&lt;Database you want to take backup off&gt;</strong></span>
<span class="strong"><strong class="calibre7">$ rhc env-set AWS_S3_BUCKET=&lt;Amazon S3 bucket name &gt;</strong></span>
</pre></div></li><li class="listitem" value="8">Following this, commit the code, and push it to the OpenShift application gear. The scheduled job will run every night at <code class="email">23:50</code> (11:50 pm) to take database backup, and your backup will be uploaded to Amazon S3:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ git commit –am "database backup script added"</strong></span>
<span class="strong"><strong class="calibre7">$ git push</strong></span>
</pre></div></li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Performing scheduled MySQL database backups">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec247" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">In step 1, you created a new Amazon S3 bucket to store your MySQL database backups. Amazon S3 is widely used to store static files and is an ideal choice for this job. Next, in step 2, you added the <code class="email">cron</code> cartridge to your application. The <code class="email">cron</code> cartridge will be used to perform daily backups at a particular time.</p><p class="calibre6">Amazon S3 exposes its REST service, which users can use to perform operations on S3 buckets. Amazon provides many programming languages wrapped around its REST API to make it easy for developers to integrate with their application. As we wanted to keep this recipe language agnostic, we used the Amazon <code class="email">S3-bash</code> wrapper. Amazon does not officially support this wrapper but it works very well nonetheless. In step 3, you downloaded the <code class="email">s3-bash</code> wrapper using the <code class="email">wget</code> utility. The <code class="email">tar.gz</code> file was stored in <code class="email">$OPENSHIFT_DATA_DIR</code>. You then extracted the <code class="email">tar.gz</code> file to the <code class="email">s3-bash</code> directory.</p><p class="calibre6">In step 4, you created a file called <code class="email">AWSSecretAccessKeyIdFile</code> to store the Amazon access key secret. The <code class="email">s3-bash</code> wrapper uses this file for the AWS secret access key ID so that it does not appear in the list of running processes with <code class="email">ps</code>.</p><p class="calibre6">In step 5, you <a id="id401" class="calibre1"/>created a bash script that will be executed every night at 11:50 pm. The script first takes the database backup using the <code class="email">mysqldump</code> command and then uploads the file to Amazon S3. The filename is the current timestamp. Finally, after uploading the backup to S3, the script deletes the backup to save disk space. If your MySQL database is big, then you might want to compress the <code class="email">mysqldump</code> output. You just have to update the <code class="email">mysqldump</code> command in step 5 to the one shown in the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">mysqldump --user $OPENSHIFT_MYSQL_DB_USERNAME -p$OPENSHIFT_MYSQL_DB_PASSWORD --host $OPENSHIFT_MYSQL_DB_HOST $BACKUP_DATABASE_NAME | gzip -9 &gt; $OPENSHIFT_DATA_DIR/$FILE_NAME.gz</strong></span>
</pre></div><p class="calibre6">In the preceding command, we have used <code class="email">gzip</code>, a popular data compression program, to compress the <code class="email">mysqldump</code> output.</p><p class="calibre6">In Step 6, you created three environment variables required by the backup script. Finally, you committed the changes in step 7 and pushed them to the OpenShift application gear.</p></div></div>

<div class="book" title="Performing scheduled MySQL database backups">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch04lvl2sec248" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Adding a MySQL cartridge to your application</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Using an Amazon RDS MySQL DB instance with OpenShift"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec63" class="calibre1"/>Using an Amazon RDS MySQL DB instance with OpenShift</h1></div></div></div><p class="calibre6">
<span class="strong"><strong class="calibre7">Amazon Relational Database Service</strong></span> (<span class="strong"><strong class="calibre7">Amazon RDS</strong></span>)<a id="id402" class="calibre1"/> is a web service that makes it easy for you to set up, operate, and <a id="id403" class="calibre1"/>scale a relational database<a id="id404" class="calibre1"/> on top of Amazon EC2. It provides access to MySQL, Oracle, PostgreSQL, and Microsoft SQL Server database engines. In addition to the standard database features, RDS offers the following functionality:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Automatic database patches</li><li class="listitem">Automated backup</li><li class="listitem">Point-in-time recovery</li><li class="listitem">Vertical scaling of a database instance via a single API call</li></ul></div><p class="calibre6">In this recipe, you will learn how to use the Amazon RDS MySQL database service with your OpenShift applications.</p></div>

<div class="book" title="Using an Amazon RDS MySQL DB instance with OpenShift">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec249" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To complete this recipe, you will need an application with a MySQL cartridge. Please refer to the <span class="strong"><em class="calibre10">Adding a MySQL cartridge to your application</em></span> recipe of this chapter to learn how to install the MySQL cartridge. Also, you need to have an Amazon AWS account. Visit <a class="calibre1" href="http://aws.amazon.com/">http://aws.amazon.com/</a>, and sign up for a new account if you don't have one already.</p></div></div>

<div class="book" title="Using an Amazon RDS MySQL DB instance with OpenShift">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec250" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Follow these steps to learn how to use the Amazon RDS MySQL database with your OpenShift applications:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Go to <a class="calibre1" href="https://console.aws.amazon.com/rds/home">https://console.aws.amazon.com/rds/home</a>, and then click on <span class="strong"><strong class="calibre7">Security Groups</strong></span> as shown in the following screenshot:<div class="mediaobject"><img src="../images/00031.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="2">Click on the <span class="strong"><strong class="calibre7">Create DB Security Group</strong></span> option to create a new security group, and then enter the details for your new security group (as shown in the following screenshot) before clicking on the <span class="strong"><strong class="calibre7">Add</strong></span> button:<div class="mediaobject"><img src="../images/00032.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="3">The new <a id="id405" class="calibre1"/>security group<a id="id406" class="calibre1"/> will be visible in the security group list. Click on the details icon to view the security group details.</li><li class="listitem" value="4">Next, configure the security group to permit ingress from all IPs. After entering the CIDR value <code class="email">0.0.0.0/0</code>, click on the <span class="strong"><strong class="calibre7">Add</strong></span> button as shown in the following screenshot:<div class="mediaobject"><img src="../images/00033.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="5">After a few seconds, the <a id="id407" class="calibre1"/>new <a id="id408" class="calibre1"/>CIDR connection type will be visible under <span class="strong"><strong class="calibre7">Security Group Details</strong></span>:<div class="mediaobject"><img src="../images/00034.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="6">Click on the <span class="strong"><strong class="calibre7">Instances</strong></span> option in the left-hand side navigation bar, and then click on <span class="strong"><strong class="calibre7">Launch DB Instance</strong></span>:<div class="mediaobject"><img src="../images/00035.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="7">Next, you<a id="id409" class="calibre1"/> have to choose <a id="id410" class="calibre1"/>the database engine that you want to work with. Select the <span class="strong"><strong class="calibre7">use MySQL database</strong></span> option.</li><li class="listitem" value="8">Next, you have to choose whether you want to use this database for production or development purposes. We will choose <span class="strong"><strong class="calibre7">No</strong></span>, but for production, it is recommended that you choose <span class="strong"><strong class="calibre7">Yes</strong></span>.</li><li class="listitem" value="9">Then, enter the database details, which will include the MySQL version, database identifier, username, and password to connect to the MySQL database and many others as shown in the following screenshot:<div class="mediaobject"><img src="../images/00036.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="10">On the <span class="strong"><strong class="calibre7">Additional Config</strong></span> page, you have to provide the additional information that RDS needs to launch the MySQL database. You have to specify the database name, port, availability zone, DB security group, and so on. The DB security group is very important as we want to use the security group we created in step 3. Enter the details and click on <span class="strong"><strong class="calibre7">Next Step</strong></span>. Have a look at the following screenshot:<div class="mediaobject"><img src="../images/00037.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="11">Next, on<a id="id411" class="calibre1"/> the <span class="strong"><strong class="calibre7">Management Options</strong></span><a id="id412" class="calibre1"/> page, you can specify the backup and maintenance options for your DB instance as shown in the following screenshot:<div class="mediaobject"><img src="../images/00038.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="12">Finally, you can review the details of your DB instance on the <span class="strong"><strong class="calibre7">Review</strong></span> page.</li><li class="listitem" value="13">The creation and provisioning of the new MySQL DB instance will take a minute or so, and once done, it will be available under the list of DB instances, as you can see in the following screenshot:<div class="mediaobject"><img src="../images/00039.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="14">Before you can connect to the Amazon RDS MySQL DB instance, you should know the details of the newly created instance. The details of the MySQL DB instance can be found by clicking on the details icon in the DB instance list, as you can see in the following screenshot:<div class="mediaobject"><img src="../images/00040.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="15">After <a id="id413" class="calibre1"/>clicking on the <a id="id414" class="calibre1"/>details page icon, you can view the MySQL hostname that you can connect to. The host information is next to <span class="strong"><strong class="calibre7">Endpoint</strong></span>, and it will be a subdomain of <code class="email">*.rds.amazonaws.com</code>, as shown in the following screenshot:<div class="mediaobject"><img src="../images/00041.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="16">To connect to the MySQL DB instance, you will need to have the MySQL command-line client on the gear. Every OpenShift application gear already has the <code class="email">mysql</code> command-line agent installed, so you don't have to do anything. Just SSH into the application gear using the <code class="email">rhc ssh</code> command and then running the following command:<div class="note" title="Note"><h3 class="title2"><a id="tip04" class="calibre1"/>Tip</h3><p class="calibre6">The username and password corresponds to the one you created during step 10.</p></div><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ mysql --host &lt;host_endpoint&gt;.rds.amazonaws.com --port 3306 -u &lt;username&gt; -p&lt;password&gt; &lt;database_name&gt;</strong></span>
</pre></div></li><li class="listitem" value="17">Once<a id="id415" class="calibre1"/> connected, you<a id="id416" class="calibre1"/> can run any SQL command. To check the uptime of your MySQL database, you can run the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">Welcome to the MySQL monitor.  Commands end with ; or \g.</strong></span>
<span class="strong"><strong class="calibre7">Your MySQL connection id is 12</strong></span>
<span class="strong"><strong class="calibre7">Server version: 5.5.33-log Source distribution</strong></span>

<span class="strong"><strong class="calibre7">Copyright (c) 2000, 2011, Oracle and/or its affiliates. All rights reserved.</strong></span>

<span class="strong"><strong class="calibre7">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</strong></span>

<span class="strong"><strong class="calibre7">mysql&gt; SHOW STATUS like 'Uptime';</strong></span>
<span class="strong"><strong class="calibre7">+---------------+-------+</strong></span>
<span class="strong"><strong class="calibre7">| Variable_name | Value |</strong></span>
<span class="strong"><strong class="calibre7">+---------------+-------+</strong></span>
<span class="strong"><strong class="calibre7">| Uptime        | 2227  |</strong></span>
<span class="strong"><strong class="calibre7">+---------------+-------+</strong></span>
<span class="strong"><strong class="calibre7">1 row in set (0.33 sec)</strong></span>

<span class="strong"><strong class="calibre7">mysql&gt;</strong></span>
</pre></div></li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Using an Amazon RDS MySQL DB instance with OpenShift">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec251" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">Every Amazon RDS instance has a firewall that prevents any outside access to it. So, before you can create an Amazon RDS instance, you should create a new DB security group that gives access to an IP range. From step 1 through to step 6, you created a new security group that would allow all the IP addresses to connect to your Amazon MySQL DB instance. The <code class="email">0.0.0.0/0</code> value allows all the IPs to access the database instance. This is important with environments such as OpenShift that do not provide static IPs.</p><p class="calibre6">Step 7 through to step 14 helped you create a new instance of Amazon RDS MySQL DB. You are required to provide details related to your DB instance, and Amazon RDS will provision a DB instance based on the details you entered. By step 14, you had a running MySQL DB instance that you could connect to from the outside world. You can connect to it from your local machine or the OpenShift application gear.</p><p class="calibre6">Step 15 and<a id="id417" class="calibre1"/> step 16 helped you to view <a id="id418" class="calibre1"/>the details of your MySQL DB instance. The most important detail is the hostname on which the MySQL DB instance is hosted. In step 17, you used the details to connect to the Amazon RDS MySQL DB instance using the <code class="email">mysql</code> command-line client. In step 18, you ran a simple SQL query against your database to check its uptime.</p></div></div>

<div class="book" title="Using an Amazon RDS MySQL DB instance with OpenShift">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch04lvl2sec252" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre6">You can make the MySQL database connection<a id="id419" class="calibre1"/> secure by configuring the RDS instance to only accept SSL-encrypted connections from authorized users. To configure SSL, execute the following SQL command. Please replace the username with your MySQL DB instance username:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">mysql&gt; GRANT USAGE ON *.* TO 'username'@'%' REQUIRE SSL;</strong></span>
</pre></div><p class="calibre6">Now, if you quit the connection and try to log in again using the <code class="email">mysql</code> command mentioned in step 5, you will get an access denied error:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">[myapp-osbook.rhcloud.com 530f227e50044604f9000060]\&gt; mysql --host &lt;host_endpoint&gt;.rds.amazonaws.com --port 3306 -u &lt;username&gt; -p&lt;password&gt; &lt;db_name&gt;</strong></span>
<span class="strong"><strong class="calibre7">ERROR 1045 (28000): Access denied for user 'username'@'ip-10-181-217-44.ec2.internal' (using password: YES)</strong></span>
</pre></div><p class="calibre6">To connect to the MySQL DB instance, you have to first download the Amazon RDS CA certificate. Go to <code class="email">$OPENSHIFT_DATA_DIR</code>, and run the following <code class="email">wget</code> command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">[myapp-osbook.rhcloud.com]\&gt; cd $OPENSHIFT_DATA_DIR</strong></span>
<span class="strong"><strong class="calibre7">[myapp-osbook.rhcloud.com data]\&gt; wget https://s3.amazonaws.com/rds-downloads/mysql-ssl-ca-cert.pem</strong></span>
<span class="strong"><strong class="calibre7">Next, connect to RDS instance using mysql command-line as shown below. Please note the use of ssl_ca parameter to reference the public key.</strong></span>
<span class="strong"><strong class="calibre7"> [myapp-osbook.rhcloud.com data]\&gt; mysql --host &lt;host_endpoint&gt;.rds.amazonaws.com --port 3306 -u &lt;username&gt; -p&lt;password&gt; &lt;db_name&gt; --ssl_ca=mysql-ssl-ca-cert.pem </strong></span>
<span class="strong"><strong class="calibre7">Welcome to the MySQL monitor.  Commands end with ; or \g.</strong></span>
<span class="strong"><strong class="calibre7">Your MySQL connection id is 20</strong></span>
<span class="strong"><strong class="calibre7">Server version: 5.5.33-log Source distribution</strong></span>
<span class="strong"><strong class="calibre7">mysql&gt; </strong></span>
</pre></div></div></div>

<div class="book" title="Using an Amazon RDS MySQL DB instance with OpenShift">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch04lvl2sec253" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Adding a MySQL cartridge to your application</em></span> recipe</li></ul></div></div></div></body></html>