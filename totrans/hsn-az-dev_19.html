<html><head></head><body><div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Serving Static Content Using Azure CDN</h1>
                </header>
            
            <article>
                
<p>Hosting many static files, especially when we're developing a highly popular application, is a serious task, which impacts both the performance of our web service, and overall user experience. If we load images, files, or document too slowly, our customers may choose one of our competitors that provides similar features, but performs better. Thanks to cloud services such as Azure <strong>Content Delivery Network</strong> (<strong>CDN</strong>), we're able to handle high-bandwidth content quickly, due to integration with Azure Storage and using components native to Azure.</p>
<p>The following topics will be covered in this chapter:</p>
<ul>
<li>CDNs</li>
<li>Using and configuring Azure CDN</li>
<li>Optimizing serving static content using Azure CDN</li>
<li>Developing applications using Azure CDN</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Technical requirements</h1>
                </header>
            
            <article>
                
<p>To perform exercises from this chapter, you will need the following:</p>
<ul>
<li>An Azure subscription</li>
<li>Visual Studio 2017</li>
</ul>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Azure CDN fundamentals</h1>
                </header>
            
            <article>
                
<p>If you are hosting a popular website that contains many static files, you may wonder what is the best way to optimize serving them to your users. When searching for a solution, you have to take into consideration many different factors; HTTP protocol specification, browser capabilities, your server performance, network latencies, and so on. The whole problem is far from being trivial and requires significant resources to be implemented in the right way. To overcome the listed difficulties, the idea of CDNs was developed. CDN stands for content delivery network, and encapsulates the concept of a complex service that takes care of delivering the content to everyone who browses your website. In this chapter, you will learn about Azure CDN, which is an Azure component that is designed to be a fast and reliable solution for all the <span>listed</span> problems.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Working with CDNs</h1>
                </header>
            
            <article>
                
<p>When a user accesses your website, it has to fetch all the static content that is provided for a specific page. This implies the following actions:</p>
<ul>
<li>A browser has to request all images, files, and scripts that are required by a web page</li>
<li>The requests have to be queued, as there is a limit on how many requests to a single domain a browser can perform</li>
<li>In most cases, a page has to be rendered gradually, as the content is fetched from the server</li>
<li>A server can throttle requests if it is currently overloaded</li>
<li>A browser has to respect all implemented caching mechanisms,of course, if your website tells it how to do it</li>
</ul>
<p>We can describe the whole process as follows:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/ea04f592-be54-481d-b7ec-dadf5a58c75e.png" style="width:35.58em;height:9.42em;" width="465" height="123"/></p>
<p>In the preceding scenario, each request from a <strong>user</strong> is routed directly to the <strong>website</strong>. It then connects with the <strong>server</strong> to fetch the data. Of course, we can imagine the situation where files are hosted by separate servers, as demonstrated in the following diagram:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/107d6d8c-e4fc-4d3a-9494-ab40b7f947e4.png" style="width:33.67em;height:23.75em;" width="469" height="331"/></p>
<p>Such an alternative can improve performance a little bit (as servers will be identified using different domain names), but it complicates maintenance and configuration. What is more, such a setup is not the right solution if you struggle with network latencies (as an additional server will not make a difference). While we are discussing different architectures, you are probably starting to imagine one more setup that may make a difference.</p>
<p>A proxy between a <strong>website</strong> and the <strong>servers</strong> that is responsible for proper caching can be easily scaled up and is highly available, as can be seen in the following diagram:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/009e149c-a9d5-44b1-b5c6-92ef819a5154.png" style="width:37.42em;height:19.67em;" width="637" height="335"/></p>
<p>CDNs are exactly the proxy that we are talking about. They provide the following functionalities:</p>
<ul>
<li>They can be easily scaled up/out if the load exceeds our expectations</li>
<li>They can cache requests, so the end servers are not utilized too much</li>
<li>They respect the cache-control header, so it is easy to provide the <strong>Time-To-Live</strong> (<strong>TTL</strong>) of a resource</li>
<li>They improve the responsiveness of your website by serving content to multiple users simultaneously</li>
</ul>
<p>Later in this chapter, you will learn how to leverage such services by using Azure CDN.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Creating an Azure CDN in the portal</h1>
                </header>
            
            <article>
                
<p>The process of creating an Azure CDN<em> </em>is similar to all the other services that you are working with when reading this book. To get started, you have to click on the <span class="packt_screen">+ Create a resource</span><strong> </strong>button and search for <kbd>Azure CDN</kbd>. From the search results, you have to choose <span class="packt_screen">CDN</span>. This will lead you to a form, where you can enter all required information regarding a new service:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/49c92fc7-949e-4c47-b845-b4f6313ed7cb.png" style="width:45.00em;height:29.17em;" width="647" height="419"/></p>
<p>There are two things worth mentioning here:</p>
<ul>
<li><span class="packt_screen">Pricing tier</span>: Pricing tiers look a little bit different compared with other Azure services, as you no longer have the <span class="packt_screen">Basic</span>, <span class="packt_screen">Standard</span>, and <span class="packt_screen">Premium </span>options to choose from. Here you have to decide which product you will be using—you can select one from the list containing providers such as <span class="packt_screen">Verizon</span>, <span class="packt_screen">Akamai</span>, and <span class="packt_screen">Microsoft</span>. They offer different features, such as dynamic site acceleration, video streaming optimization, and asset pre-loading. The full list can be found in the <em>Further reading</em><strong> </strong>section for this chapter.</li>
</ul>
<ul>
<li><span class="packt_screen">Create a new CDN endpoint now</span>: If you know what your origin (an endpoint that will cache the resources) will be, you can create it right now for the whole service.</li>
</ul>
<p>To quickly check what is available in the particular pricing tier, you can click on the<span class="packt_screen"> View full pricing details</span><strong> </strong>link:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/6503fb1b-0ee6-43c1-96a2-646a36a592e3.png" width="899" height="765"/></p>
<p>As you can see, you are paying for each GB of outbound data transfer, and depending on the selected provider, the price can differ almost five-fold. When you click on the <span class="packt_screen">Create</span><strong> </strong>button, the service creation process will start. Once it finishes, you can access your very own instance of Azure CDN:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/865bb801-e9bd-4252-aa50-4a97c45c8ef6.png" width="1087" height="555"/></p>
<p class="mce-root"/>
<p class="mce-root"/>
<p>If you decided not to create an endpoint along with the service, you will see a similar screen to mine, with the <span class="packt_screen">Endpoints</span><strong> </strong>section empty. Let us click on the <strong><span class="packt_screen">+ Endpoint</span> </strong>button to actually create one. As mentioned before, an endpoint is the element of a CDN that caches the data and serves it for a particular purpose. In the following, you can find an example setup for my first endpoint:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/38aa33f9-6cb8-43d7-8684-4c540570e91e.png" style="width:21.08em;height:37.50em;" width="297" height="528"/></p>
<p>As you can see, I selected <span class="packt_screen">Storage</span><strong> </strong>as the <span class="packt_screen">Origin type</span>. To be able to do so, you have to actually have an instance of Azure Storage<em> </em>in the same resource group as your CDN. You can also select other available types, such as Cloud Service, Web App, or a custom origin. Once you add an endpoint, you will be able to manage it by clicking on it on the <span class="packt_screen">Overview</span><strong> </strong>tab.</p>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Optimization and caching</h1>
                </header>
            
            <article>
                
<p>CDNs are all about optimizing the content and caching it. In that way, they improve the performance of your website and user experience. In the previous section, you learned a little bit about the concept of Content Delivery Networks and configured your instance of Azure CDN<em>. </em>Now we will try to learn some more advanced features, such as compression, caching rules, and optimization. </p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Configuring the endpoint</h1>
                </header>
            
            <article>
                
<p>To access the endpoint configuration, you have to click on it on the <span class="packt_screen">Overview</span><strong> </strong>blade:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/6f8e6885-1639-4785-83b5-3341f66ff858.png" width="852" height="119"/></p>
<p>This will display a new screen, where you can find all information regarding that particular CDN endpoint, such as its hostname, available protocols, and configured rules for content optimization. In fact, the screen looks very similar to the previous one—it just offers some additional options:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/fd9e98d6-d3ca-4cf2-a385-f6e3746a2ab0.png" width="1179" height="576"/></p>
<p>Now we will discuss different features available for an endpoint.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Compression</h1>
                </header>
            
            <article>
                
<p>One of the basic features of CDNs is <span class="packt_screen">compression</span>—they allow you to compress different file types on-the-fly, such as lowering their size and reducing network latency:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/aedfd0f7-a62e-4db5-b879-805416afbc45.png" style="width:36.42em;height:38.83em;" width="673" height="720"/></p>
<p class="mce-root">When you enable it, you can select the MIME types you are interested in. You can also add new ones, if you plan to support any.</p>
<p class="mce-root"/>
<p class="mce-root"/>
<div class="mce-root packt_tip">Remember that a file has to be cached by a CDN to be actually compressed on-the-fly. </div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Caching rules</h1>
                </header>
            
            <article>
                
<p>By default, CDN caches content based on the Cache-Control header you provide. However, you can explicitly define how it should behave if:</p>
<ul>
<li>A header is missing</li>
<li>A query string is introduced</li>
<li>A particular match condition matches</li>
</ul>
<p>Here you can find a basic setup for this feature:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/fd3f71bf-5ce2-48ee-b47e-ff57a87a9203.png" width="1186" height="836"/></p>
<p>As you can see, it gives you a lot of control over the behavior of the service, especially with the <span class="packt_screen">Custom caching rules</span>.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Geo-filtering</h1>
                </header>
            
            <article>
                
<p>Sometimes you need to block specific content for specific countries. Such a feature might be problematic without CDN—you have to control programmatically who can access a given image or a file based on the geo-location. With Azure CDN<em> </em>you can enable it within seconds:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/efd35d78-aa07-46ed-9a1a-66e32a2ebdfd.png" width="1210" height="470"/></p>
<p>On the <span class="packt_screen">Geo-filtering</span><strong> </strong>blade, you can <span class="packt_screen">Configu</span><span class="packt_screen"><span class="packt_screen">r</span>e</span> different rules blocking or allowing access to a folder or a particular file inside CDN for a particular country.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Developing applications with Azure CDN</h1>
                </header>
            
            <article>
                
<p>Azure CDN<em> </em>itself does not give you anything special—it just caches content and takes responsibility for serving it without delays. The important thing, however, is to know how you can use it in your applications. In Azure, integrating Azure CDN<em> </em>with, for example, Azure App Services,<em> </em>is a piece of cake. It only takes a few mouse clicks to get your CDN working with your existing web applications. In the last section of this chapter, you will see what is required to get the integration set up and ready to improve your website's performance.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Configuring Azure App Service with Azure CDN</h1>
                </header>
            
            <article>
                
<p>To configure Azure App Service<em> </em>to work with your instance of Azure CDN, you will have to find the <span class="packt_screen">Networking</span><strong> </strong>blade. This gives you the ability to enable different web app features, including CDN:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/082f68be-3451-4506-8b72-a93bbeebe3ae.png" style="width:39.83em;height:24.17em;" width="663" height="402"/></p>
<p>When you click on <span class="packt_screen">Configure Azure CDN for your app</span>, you will see another screen where you can configure the link between Azure App Service<em> </em>and Azure CDN<em>.</em></p>
<div class="packt_tip">Azure CDN<em> </em>will automatically start caching static files, which can be found in your site. It is a good idea to publish your application at this moment, so you will not have to wait for the process to end later.</div>
<p>In fact, you have two options to proceed now:</p>
<ul>
<li>Use the existing CDN profile (if you performed exercises from the previous section of this chapter, you should have your CDN already created and ready to work)</li>
<li>Create a brand new profile</li>
</ul>
<p>In the following, you can find my configuration (I chose an existing endpoint to speed things up):</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/5f5c8afa-194f-4586-84be-7a4843dc205c.png" style="width:47.58em;height:47.67em;" width="768" height="770"/></p>
<p class="mce-root"/>
<p class="mce-root"/>
<p>Once your endpoint is created, you can check whether it works. To do so, you can check, for example, the sources for your application as I did:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/ce920b0e-96ee-482f-a639-0a84a06b9e0b.png" width="1238" height="424"/></p>
<p>For the purpose of this exercise, I used an example application from the template. As you can see, with the CDN configured, the source of my application is automatically altered—all static content is served using my Azure CDN<em> </em>endpoint instead of my server.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, you learned what CDNs are and how they may help you in achieving better performance and user experience for your web applications. We have configured an Azure CDN<em> </em>instance, and saw how to optimize serving content by compressing it. After reading this chapter, you should be able to filter particular content for particular countries, and be able to develop proper caching rules, so that you can define how your instance will behave.</p>
<p>In the next chapter, which is the last chapter in this book describing Azure services, we will cover one more advanced scenario—distributing load and securing data from outages with Azure Traffic Manager.</p>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Questions</h1>
                </header>
            
            <article>
                
<ol>
<li>What problems does using Azure CDN<em> </em>solve?</li>
<li>What are the available CDN providers for Azure CDN<em>?</em></li>
<li>What is the origin of the CDN?</li>
<li>How does compression work in Azure CDN<em>?</em></li>
<li>What is the default TTL of content stored within Azure CDN?</li>
</ol>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Further reading</h1>
                </header>
            
            <article>
                
<ul>
<li>CDN features: <a href="https://docs.microsoft.com/en-us/azure/cdn/cdn-features">https://docs.microsoft.com/en-us/azure/cdn/cdn-features</a></li>
</ul>


            </article>

            
        </section>
    </div>



  </body></html>