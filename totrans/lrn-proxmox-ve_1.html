<html><head></head><body><div class="chapter" title="Chapter&#xA0;1.&#xA0;Proxmox VE Fundamentals"><div class="titlepage"><div><div><h1 class="title"><a id="ch01"/>Chapter 1. Proxmox VE Fundamentals</h1></div></div></div><p>
<span class="strong"><strong>Proxmox Virtual Environment</strong></span> (<span class="strong"><strong>PVE</strong></span>) is a mature, complete, well-supported, enterprise-class virtualization environment for servers. It is an open source tool—based in the Debian GNU/Linux distribution—that manages containers, virtual machines, storage, virtualized networks, and high-availability clustering through a well-designed, web-based interface or via the command-line interface.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note3"/>Note</h3><p>Developers provided the first stable release of Proxmox VE in 2008; four years and eight point releases later, ZDNet's Ken Hess boldly, but quite sensibly, declared Proxmox VE as <span class="emphasis"><em>Proxmox: The Ultimate Hypervisor</em></span> (<a class="ulink" href="http://www.zdnet.com/article/proxmox-the-ultimate-hypervisor/">http://www.zdnet.com/article/proxmox-the-ultimate-hypervisor/</a>).Four years later, PVE is on version 4.1, in use by at least 90,000 hosts, and more than 500 commercial customers in 140 countries; the web-based administrative interface itself is translated into 19 languages.</p></div></div><p>This chapter explores the fundamental technologies underlying PVE's hypervisor features: <span class="strong"><strong>LXC</strong></span>, <span class="strong"><strong>KVM</strong></span>, and <span class="strong"><strong>QEMU</strong></span>. To do so, we will develop a working understanding of virtual machines, containers, and their appropriate use.</p><p>We will cover the following topics in this chapter:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Proxmox VE in brief</li><li class="listitem" style="list-style-type: disc">Virtualization and containerization with PVE</li><li class="listitem" style="list-style-type: disc">Proxmox VE virtual machines, KVM, and QEMU</li><li class="listitem" style="list-style-type: disc">Containerization with PVE and LXC</li></ul></div><div class="section" title="Proxmox VE in brief"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec8"/>Proxmox VE in brief</h1></div></div></div><p>With Proxmox VE, Proxmox Server Solutions GmbH (<a class="ulink" href="https://www.proxmox.com/en/about">https://www.proxmox.com/en/about</a>) provides us with an enterprise-ready, open source <span class="emphasis"><em>type</em></span> 2<span class="emphasis"><em> Hypervisor</em></span>. Later, you'll find some of the features that make Proxmox VE such a strong enterprise candidate.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The license for Proxmox VE is very deliberately the <span class="emphasis"><em>GNU Affero General Public License (V3)</em></span> (<a class="ulink" href="https://www.gnu.org/licenses/agpl-3.0.html">https://www.gnu.org/licenses/agpl-3.0.html</a>). From among the many free and open source compatible licenses available, this is a significant choice because it is "specifically designed to ensure cooperation with the community in the case of network server software."</li><li class="listitem" style="list-style-type: disc">PVE is primarily administered from an integrated web interface, from the command line locally, or via SSH. Consequently, there is no need for a separate management server and the associated expenditure. In this way, Proxmox VE significantly contrasts with alternative enterprise virtualization solutions by vendors such as VMware.</li><li class="listitem" style="list-style-type: disc">Proxmox VE instances/nodes can be incorporated into PVE clusters, and centrally administered from a unified web interface.</li><li class="listitem" style="list-style-type: disc">Proxmox VE provides for live migration—the movement of a virtual machine or container from one cluster node to another without any disruption of services. This is a rather unique feature of PVE and not common in competing products.</li></ul></div><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><tbody><tr><td>
<p><span class="strong"><strong>Features</strong></span></p>
</td><td>
<p><span class="strong"><strong>Proxmox VE</strong></span></p>
</td><td>
<p><span class="strong"><strong>VMware vSphere</strong></span></p>
</td></tr><tr><td>
<p>
<span class="strong"><strong>Hardware requirements</strong></span>
</p>
</td><td>
<p>Flexible</p>
</td><td>
<p>Strict compliance with HCL</p>
</td></tr><tr><td>
<p>
<span class="strong"><strong>Integrated management interface</strong></span>
</p>
</td><td>
<p>Web- and shell-based (browser and SSH)</p>
</td><td>
<p>No. Requires dedicated management server at additional cost</p>
</td></tr><tr><td>
<p>
<span class="strong"><strong>Simple subscription structure</strong></span>
</p>
</td><td>
<p>Yes; based on number of premium support tickets per year and CPU socket count</p>
</td><td>
<p>No</p>
</td></tr><tr><td>
<p>
<span class="strong"><strong>High availability</strong></span>
</p>
</td><td>
<p>Yes</p>
</td><td>
<p>Yes</p>
</td></tr><tr><td>
<p>
<span class="strong"><strong>VM live migration</strong></span>
</p>
</td><td>
<p>Yes</p>
</td><td>
<p>Yes</p>
</td></tr><tr><td>
<p>
<span class="strong"><strong>Supports containers</strong></span>
</p>
</td><td>
<p>Yes</p>
</td><td>
<p>No</p>
</td></tr><tr><td>
<p>
<span class="strong"><strong>Virtual machine OS support</strong></span>
</p>
</td><td>
<p>Windows and Linux</p>
</td><td>
<p>Windows, Linux, and Unix</p>
</td></tr><tr><td>
<p>
<span class="strong"><strong>Community support</strong></span>
</p>
</td><td>
<p>Yes</p>
</td><td>
<p>No</p>
</td></tr><tr><td>
<p>
<span class="strong"><strong>Live VM snapshots</strong></span>
</p>
</td><td>
<p>Yes</p>
</td><td>
<p>Yes</p>
</td></tr></tbody></table></div><div class="blockquote"><blockquote class="blockquote"><p><span class="emphasis"><em>Contrasting Proxmox VE and VMware vSphere features</em></span></p></blockquote></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note4"/>Note</h3><p>For a complete catalog of features, see the Proxmox VE datasheet at <a class="ulink" href="https://www.proxmox.com/images/download/pve/docs/Proxmox-VE-Datasheet.pdf">https://www.proxmox.com/images/download/pve/docs/Proxmox-VE-Datasheet.pdf</a>.</p></div></div><p>Like its competitors, PVE is a hypervisor: a typical hypervisor is software that creates, runs, configures, and manages virtual machines based on an administrator or engineer's choices.</p><p>PVE is known as a type 2 hypervisor because the virtualization layer is built upon an operating system.</p><p>As a type 2 hypervisor, Proxmox VE is built on the Debian project. Debian is a GNU/Linux distribution renowned for its reliability, commitment to security, and its thriving and dedicated community of contributing developers.</p><p>
</p><div class="mediaobject"><img src="graphics/B01784_01_01.png" alt="Proxmox VE in brief"/><div class="caption"><p>A type 2 hypervisor, such as PVE, runs directly over the operating system. In Proxmox VE's case, the operating system is Debian; since the release of PVE 4.0, the underlying operating system has been Debian "Jessie."</p></div></div><p>
</p><p>By contrast, a Type I Hypervisor (such as VMware's ESXi) runs directly on bare metal without the mediation of an operating system. It has no additional function beyond managing virtualization and the physical hardware.</p><p>
</p><div class="mediaobject"><img src="graphics/B01784_01_02.png" alt="Proxmox VE in brief"/><div class="caption"><p>A type I hypervisor runs directly on hardware, without the mediation of an operating system.</p></div></div><p>
</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note5"/>Note</h3><p>Debian-based GNU/Linux distributions are arguably the most popular GNU/Linux distributions for the desktop.</p><p>One characteristic that distinguishes Debian from competing distributions is its release policy: Debian releases only when its development community can ensure its <span class="emphasis"><em>stability</em></span>, <span class="emphasis"><em>security</em></span>, and <span class="emphasis"><em>usability</em></span>.</p><p>Debian does not distinguish between long-term support releases and regular releases as do some other distributions.</p><p>Instead, all Debian releases receive strong support and critical updates throughout the first year following the next release. (Since 2007, a major release of Debian has been made about every two years. Debian 8, <span class="emphasis"><em>Jessie</em></span>, was released just about on schedule in 2015.</p><p>Proxmox VE's reliance on Debian is thus a testament to its commitment to these values: stability, security, and usability during scheduled releases that favor cutting-edge features.</p></div></div><p>PVE provides its virtualization functionality through three open technologies managed through a unified web-based interface:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">LXC</li><li class="listitem" style="list-style-type: disc">KVM</li><li class="listitem" style="list-style-type: disc">QEMU</li></ul></div><p>To understand how this foundation serves Proxmox VE, we must first be able to clearly understand the relationship between virtualization (or, specifically, <span class="emphasis"><em>hardware virtualization</em></span>) and containerization (<span class="emphasis"><em>OS virtualization</em></span>). As we proceed, their respective use cases should become clear.</p></div></div>
<div class="section" title="Virtualization with Proxmox VE"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec9"/>Virtualization with Proxmox VE</h1></div></div></div><p>It is correct to ultimately understand containerization as a type of virtualization. However, here, we'll look first to conceptually distinguish a virtual machine from a container by focusing on contrasting characteristics.</p><p>Simply put, virtualization is a technique through which we provide fully-functional, computing resources without a demand for the resources' physical organization, locations, or relative proximity.</p><p>Virtualization technology allows us to share and allocate the resources of a physical computer with multiple execution environments. Without context, virtualization is a vague term. It encapsulates the abstraction of such resources as storage, networks, servers, desktop environments, and even applications from their concrete hardware requirements through software implementation solutions called <span class="strong"><strong>hypervisors</strong></span>.</p><p>Virtualization thus affords us more flexibility, more functionality, and a significant positive impact on our budgets which are often realized with merely the resources we have at hand.</p><p>In terms of PVE, virtualization most commonly refers to the abstraction of all aspects of a discrete computing system from its hardware. In this context, virtualization is the creation, in other words, of a virtual machine or VM, with its own operating system and applications.</p><p>A VM may be initially understood as a computer that has the same functionality as a physical machine. Likewise, it may be incorporated and communicated with via a network exactly as a machine with physical hardware would. Put yet another way, from inside a VM, we will experience no difference from which we can distinguish it from a physical computer.</p><p>The virtual machine, moreover, hasn't the physical footprint of its physical counterparts. The hardware it relies on is, in fact, provided by software that borrows from the hardware resources of a host installed on a physical machine (or <span class="strong"><strong>bare metal</strong></span>).</p><p>Nevertheless, the software components of the virtual machine, from the applications to the operating system, are distinctly separated from those of the host machine. This advantage is realized when it comes to allocating physical space for resources.</p><p>For example, we may have a PVE server running a web server, database server, firewall, and log management system—all as discrete virtual machines. Rather than consuming physical space, resources, and labor of maintaining four physical machines, we simply make physical room for the single Proxmox VE server and configure an appropriate virtual LAN as necessary.</p><p>In a white paper entitled <span class="emphasis"><em>Putting Server Virtualization to Work</em></span>, AMD articulates well the benefits of virtualization to businesses and developers (<a class="ulink" href="https://www.amd.com/Documents/32951B_Virtual_WP.pdf">https://www.amd.com/Documents/32951B_Virtual_WP.pdf</a>):</p><p>
<span class="strong"><strong>Top 5 business benefits of virtualization:</strong></span>
</p><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em>Increases server utilization</em></span>
</p><p>
<span class="emphasis"><em>Improves service levels</em></span>
</p><p>
<span class="emphasis"><em>Streamlines manageability and security</em></span>
</p><p>
<span class="emphasis"><em>Decreases hardware costs</em></span>
</p><p>
<span class="emphasis"><em>Reduces facility costs</em></span>
</p></blockquote></div><p>
<span class="strong"><strong>The benefits of virtualization with a development and test environment:</strong></span>
</p><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em>Lowers capital and space requirements</em></span>
</p><p>
<span class="emphasis"><em>Lowers power and cooling costs</em></span>
</p><p>
<span class="emphasis"><em>Increases efficiencies through shorter test cycles</em></span>
</p><p>
<span class="emphasis"><em>Faster time-to-market</em></span>
</p></blockquote></div><p>To these benefits, let's add portability and encapsulation: the unique ability to migrate a live VM from one PVE host to another—without suffering a service outage.</p><p>Proxmox VE makes the creation and control of virtual machines possible through the combined use of two free and open source technologies: <span class="strong"><strong>Kernel-based Virtual Machine</strong></span> (or <span class="strong"><strong>KVM</strong></span>) and (<span class="strong"><strong>Quick Emulator (QEMU</strong></span>). Used together, we refer to this integration of tools as <span class="strong"><strong>KVM-QEMU</strong></span>.</p><div class="section" title="KVM"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec7"/>KVM</h2></div></div></div><p>KVM has been an integral part of the Linux kernel since February 2007. This kernel module allows GNU/Linux users and administrators to take advantage of an architecture's hardware virtualization extensions; for our purposes, these extensions are AMD's <span class="strong"><strong>AMD-V</strong></span> and Intel's<span class="strong"><strong>VT-X</strong></span> for the x86_64 architecture.</p><p>To really make the most of Proxmox VE's feature set, you'll therefore want to install on an x86_64 machine with a CPU that has integrated virtualization extensions. For a full list of AMD and Intel processors supported by KVM, visit Intel at <a class="ulink" href="http://ark.intel.com/Products/VirtualizationTechnology">http://ark.intel.com/Products/VirtualizationTechnology</a> or AMD at <a class="ulink" href="http://support.amd.com/en-us/kb-articles/Pages/GPU120AMDRVICPUsHyperVWin8.aspx">http://support.amd.com/en-us/kb-articles/Pages/GPU120AMDRVICPUsHyperVWin8.aspx</a>.</p></div><div class="section" title="QEMU"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec8"/>QEMU</h2></div></div></div><p>QEMU provides an emulation and virtualization interface that can be scripted or otherwise controlled by a user.</p><p>
</p><div class="mediaobject"><img src="graphics/B01784_01_03.png" alt="QEMU"/><div class="caption"><p>Visualizing the relationship between KVM and QEMU</p></div></div><p>
</p><p>Without Proxmox VE, we could essentially define the hardware, create a virtual disk, and start and stop a virtualized server from the command line using QEMU.</p><p>Alternatively, we could rely on any one of an array of GUI frontends for QEMU (a list of GUIs available for various platforms can be found at <a class="ulink" href="http://wiki.qemu.org/Links#GUI_Front_Ends">http://wiki.qemu.org/Links#GUI_Front_Ends</a>).</p><p>Of course, working with these solutions is productive only if you're interested in what goes on behind the scenes in PVE when virtual machines are defined. Proxmox VE's management of virtual machines, is itself, managing QEMU through its API.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note6"/>Note</h3><p>Managing QEMU from the command line can be tedious. The following is a line from a script that launched Raspbian, a Debian remix intended for the architecture of the Raspberry Pi, on an x86 Intel machine running Ubuntu. When we see how easy it is to manage VMs from Proxmox VE's administrative interfaces, we'll sincerely appreciate that relative simplicity:<code class="literal">qemu-system-arm -kernel kernel-qemu -cpu arm1176 -m 256 -M versatilepb -no-reboot -serial stdio -append "root=/dev/sda2 panic=1" -hda ./$raspbian_img -hdb swap</code>
</p></div></div><p>If you're familiar with QEMU's emulation features, it's perhaps important to note that we can't manage <span class="emphasis"><em>emulation</em></span> through the tools and features Proxmox VE provides—despite its reliance on QEMU. From a bash shell provided by Debian, it's possible. However, the emulation can't be controlled through PVE's administration and management interfaces.</p></div><div class="section" title="OS Virtualization with Proxmox VE"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec9"/>OS Virtualization with Proxmox VE</h2></div></div></div><p>
<span class="strong"><strong>Containers</strong></span> are another type of virtualization. Synonymous with <span class="emphasis"><em>OS virtualization</em></span>, containers have enjoyed a recent renaissance. In contrast to VMs, containers share operating system components, such as libraries and binaries, with the host operating system; a virtual machine does not.</p><p>
</p><div class="mediaobject"><img src="graphics/B01784_01_04.png" alt="OS Virtualization with Proxmox VE"/><div class="caption"><p>Visually contrasting virtual machines with containers</p></div></div><p>
</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip7"/>Tip</h3><p>
<span class="strong"><strong>The container advantage</strong></span></p><p>This arrangement potentially allows a container to run leaner and with fewer hardware resources borrowed from the host. For many authors, pundits, and users, containers also offer a demonstrable advantage in terms of speed and efficiency. (However, it should be noted here that as resources such as RAM and more powerful CPUs become cheaper, this advantage will diminish.)</p></div></div><p>The Proxmox VE container is made possible through LXC from version 4.0 onwards (it's made possible through OpenVZ in previous PVE versions). LXC is the third fundamental technology serving Proxmox VE's ultimate interest. Like KVM and QEMU, LXC (or Linux Containers) is an open source technology. It allows a host to run, and an administrator to manage, multiple operating system instances as isolated containers on a single physical host. Conceptually then, a container very clearly represents a class of virtualization, rather than an opposing concept. Nevertheless, it's helpful to maintain a clear distinction between a virtual machine and a container as we come to terms with PVE.</p><p>The ideal implementation of a Proxmox VE guest is contingent on our distinguishing and choosing between a virtual machine solution and a container solution.</p><p>Since Proxmox VE containers share components with the host operating system which offers advantages in terms of efficiency, this text will guide you through the creation of containers whenever the intended guest can be fully realized with Debian <span class="emphasis"><em>Jessie</em></span> as our hypervisor's operating system without sacrificing features.</p><p>When our intent is a guest running a Microsoft Windows operating system, for example, a Proxmox VE container ceases to be a solution. In such a case, we turn, instead, to creating a virtual machine. We must rely on a VM precisely because the operating system components that Debian can share with a Linux container are not components that a Microsoft Windows operating system can make use of.</p></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Summary</h1></div></div></div><p>In this chapter, we have come to terms with the three open source technologies that provide Proxmox VE's foundational features: containerization and virtualization with LXC, KVM, and QEMU.</p><p>Along the way, we've come to understand that containers, while being a type of virtualization, have characteristics that distinguish them from virtual machines.</p><p>These differences will be crucial as we determine which technology to rely on for a virtual server solution with Proxmox VE.</p><p>The next chapter will guide you through the installation and configuration of your first Proxmox VE server. It will thus introduce Proxmox VE hardware specifications and installation methods. Finally, it will provide a thorough walkthrough of the Proxmox Installer.</p><p>Let's move forward and prepare our first PVE instance, which we will use to host both containers and virtual machines.</p></div></body></html>