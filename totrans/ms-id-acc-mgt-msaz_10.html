<html><head></head><body><div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Using the Azure AD App Proxy and the Web Application Proxy</h1>
                </header>
            
            <article>
                
<p class="mce-root">As the successor to <a href="468509fa-856c-411d-abdb-e9a39c266750.xhtml" target="_blank">Chapter 7</a>, <em>Deploying Solutions on Azure AD and ADFS</em><em>,</em> we dig further into the different features of Azure AD and ADFS. We already published the Kerberos on-premises application to external users. We'll do this with another application in this chapter. Furthermore, we will dive into the functionality of the Azure AD app proxy. Additionally, the first usage examples and the basic functionality of conditional access will be shown in this chapter. We do some more claims operation and task customization in <a href="6b29475f-7917-49bf-91d4-3024835d0278.xhtml" target="_blank">Chapter 10</a>, <em>Exploring Azure AD Identity Service</em><em>s</em>, and provide examples in the code package for the book. With this chapter, you will get all the information for managing the application integration into Azure AD and ADFS. You will also learn to publish applications with the Azure AD or the Web Application Proxy. Additionally, you will be enabled to use conditional access for securing your application access.</p>
<p class="mce-root">This chapter is divided into the following sections:</p>
<ul>
<li>Configuring additional applications for Azure AD and ADFS</li>
<li>Publishing with Windows server and Azure AD Web Application Proxy</li>
<li>Using conditional access</li>
</ul>
<p>Ready to go? We'll start with the configuration of additional applications for Azure AD and ADFS.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Configuring additional applications for Azure AD and ADFS</h1>
                </header>
            
            <article>
                
<p>We will continue the deployment and configuration of more business apps to allow you to test the different authentication mechanisms. For our support, we configure <span class="packt_screen">ServiceNow</span> with <span class="packt_screen">SAML</span> and active user provisioning from Azure AD to <span class="packt_screen">ServiceNow</span>:</p>
<ol>
<li>Navigate to <span class="packt_screen">Azure Active Directory</span> | <span class="packt_screen">Enterprise Applications</span> and add a <span class="packt_screen">New Application</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/81e01e5d-3247-4e91-bdd3-8cf1c0a76aa1.png" style="width:37.17em;height:10.75em;" width="610" height="176"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Adding a new Enterprise application</div>
<ol start="2">
<li>Choose <span class="packt_screen">ServiceNow</span> and add the app from the gallery:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/a965e1f0-698d-4563-90da-194f3854e0aa.png" style="width:48.83em;height:21.83em;" width="698" height="312"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Adding ServiceNow</div>
<ol start="3">
<li>
<p>After adding the application, we will configure <span class="packt_screen">SAML</span> to authenticate our users:</p>
</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/7e30bb59-d3c5-4b40-8211-0a817b85d366.png" width="903" height="530"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Using SAML as an authentication method</div>
<ol start="4">
<li>In the <span class="packt_screen">Basic SAML Configuration</span>, we add our <span class="packt_screen">ServiceNow</span> instance information, as shown in the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/362deb77-a38c-4200-bbf8-3acd73ef0b31.png" style="width:61.83em;height:18.33em;" width="947" height="281"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Configuring the SAML options</div>
<p style="padding-left: 60px">The following URIs need to be used:</p>
<pre style="padding-left: 90px">https://.service-now.com/navpage.do<br/>https://.service-now.com</pre>
<div class="packt_tip"><span>We</span><span> will use the automatic configuration method for this chapter.</span></div>
<ol start="5">
<li>
<p>For the manual configuration tasks, you can download the certificate by using the <span class="packt_screen">Base64</span> option:</p>
</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/19266103-cec9-4d71-8585-0a84a6cce6b1.png" style="width:61.50em;height:19.33em;" width="935" height="294"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Download the signing certificate</div>
<ol start="6">
<li>
<p>Also, for manual configuration tasks, you can copy the following links into a Notepad:</p>
</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/0f0fd45b-c1f9-4420-bf23-29f00a5ba6dc.png" style="width:61.17em;height:16.92em;" width="933" height="258"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Azure AD endpoints overview</div>
<ol start="7">
<li>Next, we will assign our <span class="packt_screen">Service Management Application Access</span> group to the application:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/4c37e157-ba48-4b58-928d-d66216177ab4.png" width="793" height="593"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Assigning users to the application</div>
<ol start="8">
<li>Now, we can start to configure the <span class="packt_screen">ServiceNow</span> instance for Single Sign-On.</li>
</ol>
<ol start="9">
<li>First, we need to activate the <span class="packt_screen">Multi-Provider Single Sign-On Installer</span> plugin:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/23e8dda3-6fd9-4436-8e79-1a2caa9d34c3.png" width="1203" height="589"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Multi-Provider SSO feature in ServiceNow</div>
<ol start="10">
<li>You will find this option in the navigation pane on the left-hand side: <span class="packt_screen">System</span> <span class="packt_screen">Definition</span> | <span class="packt_screen">Plugins.</span></li>
<li>Activate the following plugin:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/8c18543b-1119-4bb2-b4d7-81079f448bbe.png" style="width:45.83em;height:11.83em;" width="782" height="202"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign"><span>Activating the Multi-Provider SSO feature in ServiceNow</span></div>
<ol start="12">
<li>
<p>Click the <span class="packt_screen">Activate</span> button in the dialog:</p>
</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/61d63f97-ae6b-4ddc-825c-6ff4565152ec.png" style="width:44.25em;height:16.67em;" width="584" height="220"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Activation dialog</div>
<ol start="13">
<li>Next, we will configure the plugin under <span class="packt_screen">Multi-Provider SSO</span> | <span class="packt_screen">Administration</span> | <span class="packt_screen">Properties</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/aa9def3a-7279-4bf2-8fdc-0a99565dd7dc.png" style="width:18.75em;height:25.42em;" width="262" height="355"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Configuring the newly installed plugin</div>
<ol start="14">
<li>The following features need to be activated:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/7b3c3c16-ce52-4f3e-a0b5-6a02f70f7dfb.png" style="width:45.50em;height:27.67em;" width="782" height="476"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Activating the custom properties for the provider</div>
<ol start="15">
<li>If you want to use the manual configuration method, you need to use the information in your Notepad.</li>
<li>We use the automatic option for the configuration; it's a little bit of a hidden option!</li>
<li>You will find it under <span class="packt_screen">View step-by-step instructions</span> as shown in the following screenshot, in the SAML configuration section:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/db783d30-f6fa-4b86-a916-b10cd2fa217f.png" style="width:46.00em;height:12.75em;" width="933" height="258"/></p>
<div class="CDPAlignCenter CDPAlign packt_figref">Automatic configuration option for the ServiceNow SSO Provider</div>
<ol start="18">
<li>Click the option and the following dialog appears; enter your <span class="packt_screen">ServiceNow</span> administrative credentials:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/fa6d90ec-b8e7-416c-8b3f-7d40b8cfdecc.png" style="width:31.83em;height:25.17em;" width="525" height="415"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Configuring the SAML connection</div>
<ol start="19">
<li>Click <strong><span class="packt_screen">Configure Now</span></strong>.</li>
<li>Next, we can do additional configuration tasks on the <span class="packt_screen">ServiceNow</span> part.</li>
<li>Navigate to <span class="packt_screen">Multi-Provider SSO</span> | <span class="packt_screen">Identity Providers</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/d5b371d2-8572-4c20-90fc-8dc40c36b050.png" style="width:17.25em;height:10.50em;" width="260" height="159"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Identity Provider configuration</div>
<ol start="22">
<li>You will find the automatically generated <span class="packt_screen">Identity Provider</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/3b9824b0-a37d-4488-ba46-ef39fee9a7cc.png" width="892" height="235"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Start configuring the newly created Azure AD connection in ServiceNow</div>
<ol start="23">
<li>We need to remove the populated Identity Provider's <kbd>SingleLogoutRequest</kbd> URL.</li>
</ol>
<ol start="24">
<li>All the other fields can be left as their defaults:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/ee2b6edf-1bac-4799-9e59-3d3fe32385c1.png" width="1142" height="980"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Configuring the IdP including the Auto Redirect option</div>
<ol start="25">
<li>Very important! Set the <span class="packt_screen">Auto Redirect IdP</span> option, with the expected result:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/dc13d236-ef45-47b3-ba80-9cfdd75b358b.png" style="width:14.42em;height:3.58em;" width="181" height="45"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Auto Redirect IdP option</div>
<ol start="26">
<li>Next, we need to choose the correct certificate for our configuration by navigating to the <span class="packt_screen">X.509</span> section:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/82ab6d4f-a54b-4bc7-8a3c-7d682e000bff.png" width="749" height="486"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Configuring the correct certificate</div>
<ol start="27">
<li><span class="packt_screen">Save</span> the configuration.</li>
</ol>
<p>Now, we have finished the <span class="packt_screen">SAML</span> configuration of <span class="packt_screen">SeviceNow</span> and we will follow up with the user provisioning:</p>
<ol>
<li>Navigate to the <span class="packt_screen">Provisioning</span> section of the <span class="packt_screen">ServiceNow</span> application and change the <span class="packt_screen">Provisioning Mode</span> to <span class="packt_screen">Automatic.</span></li>
<li>Insert the following values:</li>
</ol>
<ul>
<li style="list-style-type: none">
<ul>
<li><span class="packt_screen">Instance Name</span></li>
<li><span><span class="packt_screen">Admin Username</span></span></li>
<li><span><span><span class="packt_screen">Admin Password</span></span></span></li>
<li><span><span class="packt_screen">Notification Email </span>(and check </span><span class="packt_screen"><span>Send an email notification when a failure </span>occurs</span>):</li>
</ul>
</li>
</ul>
<p class="CDPAlignCenter CDPAlign"><img src="Images/4e252785-e34f-4654-840d-beed4ca77ab9.png" width="767" height="539"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Configuring the SCIM provisioning feature</div>
<ol start="3">
<li>Click <span class="packt_screen">Test Connection</span> and you should receive a notification like the following example. The test of the connection is required to save:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/319235ba-d076-41fe-8631-7e49cd81df82.png" style="width:26.25em;height:4.75em;" width="435" height="79"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Connection Test</div>
<ol start="4">
<li>Next, we will take a look into the <strong>synchronization configuration</strong> for users and groups.</li>
<li>Click the <span class="packt_screen">Synchronize Azure Active Directory Users to ServiceNow</span> rule:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/c4514e27-814f-475a-ad45-546eebb71cf8.png" width="772" height="216"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Configuring the Synchronization Rules</div>
<ol start="6">
<li>You will find the active <span class="packt_screen">Attribute Mapping</span>. If you need to handle special considerations, such as if you connect to a filled <span class="packt_screen">ServiceNow</span> instance, you can modify the mappings to fit your needs:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/ed4b2db4-9d59-42cf-a892-5ab425457c02.png" style="width:41.75em;height:50.92em;" width="730" height="890"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Synchronization Rule Settings</div>
<ol start="7">
<li>You will also get an actual overview of the <strong><span class="packt_screen">Synchronization Details</span></strong>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/d69db8e4-39c2-46d8-b6a4-bef3ab47477a.png" style="width:46.25em;height:24.67em;" width="762" height="407"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Synchronization details for monitoring and auditing</div>
<ol start="8">
<li>By clicking on <span class="packt_screen">View the "<span class="packt_screen">Account Provisioning"</span> category in the audit logs for full details</span> you will get the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/9486384c-fe1d-430c-bdef-a36e2340d3e8.png" style="width:30.75em;height:16.25em;" width="507" height="268"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Actual state for the test user</div>
<ol start="9">
<li>Next, we will change to the <span class="packt_screen">Organization</span> | <span class="packt_screen">User</span> section in your <span class="packt_screen">ServiceNow</span> instance.</li>
<li>Search for your test user, in my case <kbd>Don.Hall@inovitdemos.ch</kbd>, and you will see the result of the automatic provisioning:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/679a13e4-f5a2-49fe-a091-17ff4d247048.png" width="1249" height="187"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Verifying the synchronized test user in ServiceNow</div>
<p>The initial synchronization takes longer to perform than subsequent synchronizations, which occur approximately every <strong>40 minutes</strong> as long as the service is running.</p>
<p>The next scenario we want to accomplish is the use of <strong>OpenID Connect</strong> and your on-premises ADFS infrastructure. To follow the authentication flow, use <a href="1f239a9c-c62a-4e40-ab58-ce78cd87e8be.xhtml" target="_blank">Chapter 6</a>, <em>Managing Authentication Protocols</em>.</p>
<p class="mce-root">To configure this scenario on your <strong>YD1APP01</strong> server, we need to copy the <kbd>active-directory-dotnet-webapp-openidconnect</kbd> folder from the code package to your desktop.</p>
<p>We configure your ADFS server (<strong>YD1ADS01</strong>) on your domain controller to get the following expected result at the end, a full working OpenID authenticated application:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/65d23739-b669-4930-8b88-afe0be215f7c.png" width="766" height="639"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Result of the following configuration steps</div>
<p>In the next steps, we will configure the scenario:</p>
<ol start="1">
<li>We start with the creation of a new application group including a <span class="packt_screen">Server application</span> (standalone application):</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/9844338e-7a3e-46c5-abec-92482ff30efe.png" style="width:59.33em;height:38.50em;" width="978" height="634"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Configuring the new application group</div>
<ol start="2">
<li>Next, a <span class="packt_screen">Client Id</span> is generated; copy the ID to a notepad.</li>
</ol>
<ol start="3">
<li>Enter the redirect URI, <kbd>https://localhost:44320/</kbd>, under which the application will run:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/f18e296c-c8b0-446d-a6d6-56f7d39178ef.png" width="479" height="248"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Providing the application properties</div>
<ol start="4">
<li>Click <span class="packt_screen">Next</span> and check <strong><span class="packt_screen">Generate a shared secret box</span></strong>; copy the key to the notepad:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/33487fa4-dddf-4bcd-8e28-7f31f33813d5.png" width="526" height="127"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Generating the shared key</div>
<ol start="5">
<li>Complete the wizard.</li>
<li>Next, we will create the Web API configuration by double-clicking on your new application group.</li>
</ol>
<ol start="7">
<li>Choose <span class="packt_screen">Add application</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/869ca15a-8bd8-4e98-a64b-2835bfe6a42b.png" width="460" height="40"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Web API configuration</div>
<ol start="8">
<li>Use the <span class="packt_screen">Web API</span> option:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/35830923-eab0-42c1-a46d-06659f881c8a.png" width="213" height="132"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Choosing the Web API option</div>
<ol start="9">
<li>Next, add the Identifier for the API: <kbd>https://inovitdemos.ch/OpenIDDemo</kbd><a href="https://inovitdemos.ch/OpenIDDemo">.</a></li>
<li>Click <span class="packt_screen">Next</span> in the <span class="packt_screen">Access Control Policy</span> section and all the other sections to finish the wizard.</li>
<li>For now, we change to the <strong>YD1APP01</strong> server and open our Visual Studio.</li>
<li>Open the Solution file of the demo code: <kbd><span><span>WebApp-OpenIDConnect-DotNet.sln</span></span></kbd>.</li>
<li>Navigate in Solution Explorer to the <kbd>web.config</kbd> file: <span><kbd>WebApp-OpenIDConnect-DotNet.sln</kbd>.</span></li>
<li>Modify the code so that it looks like the following example:
<ul>
<li>Copy your <span class="packt_screen">Client Id</span> from your notepad.</li>
<li>Configure the <kbd>ida:ADFSDiscoveryDoc</kbd> value so that it contains your ADFS FQDN: <kbd>https://login.inovitdemos.ch</kbd>.</li>
<li><span>Verify that the</span> <kbd>ida:PostLogoutRedirectUri</kbd> <span>value contains </span><kbd>https://localhost:44320/</kbd>:</li>
</ul>
</li>
</ol>
<pre style="padding-left: 60px"> &lt;appSettings&gt;<br/> &lt;add key="webpages:Version" value="3.0.0.0" /&gt;<br/> &lt;add key="webpages:Enabled" value="false" /&gt;<br/> &lt;add key="ClientValidationEnabled" value="true" /&gt;<br/> &lt;add key="UnobtrusiveJavaScriptEnabled" value="true" /&gt; <br/> &lt;add key="ida:ClientId" value="<strong>40ef7c28-2172-4e4d-84b5-e9a284b94f75</strong>" /&gt;<br/> <strong>&lt;add key="ida:ADFSDiscoveryDoc" value="https://login.inovitdemos.ch/adfs/.well-known/openid- configuration" /&gt;</strong><br/> &lt;add key="ida:PostLogoutRedirectUri" value="<strong>https://localhost:44320/</strong>" /&gt;<br/>&lt;/appSettings&gt;</pre>
<ol start="15">
<li>Next, navigate to the <em>App_Start</em> section and the <kbd>Startup.Auth.cs</kbd> file.</li>
<li>Directly under the public partial class <kbd>Startup</kbd>, the code needs to look like the following to tweak the OpenID Connect middleware initialization logic:</li>
</ol>
<pre style="padding-left: 60px"><span>private static string clientId = ConfigurationManager.AppSettings["ida:ClientId"];<br/></span> //private static string aadInstance = ConfigurationManager.AppSettings["ida:AADInstance"];<br/> //private static string tenant = ConfigurationManager.AppSettings["ida:Tenant"];<br/>private static string metadataAddress = ConfigurationManager.AppSettings["ida:ADFSDiscoveryDoc"];<br/>private static string postLogoutRedirectUri = ConfigurationManager.AppSettings["ida:PostLogoutRedirectUri"];<br/> //string authority = String.Format(CultureInfo.InvariantCulture, aadInstance, tenant);</pre>
<div class="packt_tip">We don't need the Azure AD configuration, so we comment this part out!</div>
<ol start="17">
<li>Next, we need to modify the OpenID Connect middleware options:</li>
</ol>
<pre style="padding-left: 60px" class="mce-root">app.UseOpenIdConnectAuthentication(<br/>new OpenIdConnectAuthenticationOptions <br/> { <br/> ClientId = clientId, <br/> //Authority = authority, <br/> MetadataAddress = metadataAddress, <br/> RedirectUri = postLogoutRedirectUri, <br/> PostLogoutRedirectUri = postLogoutRedirectUri</pre>
<div class="packt_tip">ADFS does enforce the <kbd>redirect_uri</kbd> in the request. Azure AD doesn't do that.</div>
<ol start="18">
<li>Now, we can verify the app; press <em>F5</em> in Visual Studio. To analyze the traffic, you can use Fiddler. Note that you will be stuck with Fiddler on the authentication part:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/7462f82e-15cc-4200-b32c-beffceb41a7d.png" style="width:29.25em;height:43.00em;" width="473" height="695"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Fiddler result of the authentication</div>
<ol start="19">
<li>Well done, you have configured an application that uses OpenID Connect!</li>
</ol>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Publishing with Windows server and Azure AD Web Application Proxy</h1>
                </header>
            
            <article>
                
<p>The Azure AD Application Proxy is similar to the on-premises Web Application Proxy role, starting in Windows Server 2012 R2. With this service, you can enable external access for on-premises applications. Azure AD Application Proxy requires an Azure AD Basic or an Azure AD Premium subscription. The connection is made directly with Azure and done through a proxy into the private network, with an application proxy agent installed on the on-premises web application server.</p>
<p>Let's run a very common use case to include a Kerberos on-premises application into our Azure AD Access UI, <a href="https://myapps.microsoft.com">https://myapps.microsoft.com</a>. We use our existing application to configure the scenario:</p>
<ol>
<li>Log in to <a href="https://portal.azure.com">https://portal.azure.com</a> and choose the Azure Active Directory blade.</li>
<li>Under Application proxy, we first need to download and install the application proxy agent on our <strong>YD1APP01</strong> server.</li>
</ol>
<p>You don't need to install the agent directly on the application server. It's also possible to use any other server, or also additional agents for redundancy requirements. The agent needs to be installed on a server in the same or a correctly trusted domain/forest to support Kerberos constrained delegation, and the SPN of the application needs to be done on every agent instance. The domain function level needs to be Windows Server 2012 at a minimum. Also, the correct ports need to be accessible from the other server.</p>
<ol start="3">
<li>Download the agent onto the server and start the installation:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/7337b579-2580-4701-9258-4c626c7f9add.png" width="853" height="484"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Configure the Azure AD Application Proxy</div>
<ol start="4">
<li>Agree to the license terms and conditions and click <span class="packt_screen">Next.</span></li>
<li>Next, you need to provide global administrator credentials to register the agent to Azure AD.</li>
<li>Recognize the notification for outbound proxy usage:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/bfbe4775-1b67-4179-8c26-dd2b051277ca.png" style="width:27.42em;height:9.83em;" width="481" height="172"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Installation of the Application Proxy Connector</div>
<ol start="7">
<li>The expected result is an <span class="packt_screen">Active</span> agent:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/5151fa0f-ae04-4793-872f-2ef592bbf510.png" style="width:45.75em;height:8.67em;" width="586" height="111"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Active agents overview</div>
<ol start="8">
<li>Now, we can start to configure our Kerberos-based on-premises application.</li>
<li>First, we create a group that can be assigned to grant access to the portal:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/51f587ac-d3f3-4a23-a1e6-35f0b04cf3c7.png" style="width:21.67em;height:24.67em;" width="393" height="448"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Assigning the needed test group</div>
<ol start="10">
<li>Assign one test user to your group.</li>
</ol>
<div class="packt_infobox">In this example, we use the option that we don't publish the application with an official public FQDN. In that case, we don't need to open any firewall ports and the traffic to the app is working through the connector.</div>
<ol start="11">
<li>Next, we will configure the app proxy configuration:</li>
</ol>
<p class="mce-root CDPAlignCenter CDPAlign"><img src="Images/eacc1379-9a4e-4bda-92c5-9b5975560074.png" style="width:34.08em;height:44.33em;" width="691" height="900"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Configuring the on-premises application properties</div>
<ol start="12">
<li>As you can see, you are able to provide several additional settings to address your needs.</li>
</ol>
<div class="packt_tip">You can find more information about the different options at the following reference: <a href="https://docs.microsoft.com/en-us/azure/active-directory/manage-apps/application-proxy-add-on-premises-application">https://docs.microsoft.com/en-us/azure/active-directory/manage-apps/application-proxy-add-on-premises-application</a>.</div>
<ol start="13">
<li>In the next step, we will configure the <span class="packt_screen">Single-Sign-On</span> options for our application.</li>
<li>Choose the <span class="packt_screen">Windows Integrated Authentication</span> option:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/1dadced9-8df8-485b-ae55-fef1a5e6c2d5.png" width="900" height="706"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Choosing the Windows Integrated Authentication option</div>
<div class="packt_tip">If you need to use Header-based authentication, the integration with PingAccess will be your friend. You can find more information about this integration at the following source: <a href="https://docs.microsoft.com/en-us/azure/active-directory/manage-apps/application-proxy-configure-single-sign-on-with-ping-access">https://docs.microsoft.com/en-us/azure/active-directory/manage-apps/application-proxy-configure-single-sign-on-with-ping-access</a>.</div>
<ol start="15">
<li>Enter your <span class="packt_screen">Internal Application SPN</span> to configure the Kerberos part.</li>
<li>Keep in mind that only Kerberos Constrained Delegation will work:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/270472f1-d7d0-4c7e-bd80-5de075b76dc3.png" width="805" height="360"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Configure the SPN for the App</div>
<ol start="17">
<li>After this configuration, we can test the application with the assigned user in your access group, and you should get a similar result to this:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/6219a02c-09fc-4262-b592-b743fffff0d7.png" width="1455" height="93"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Result of a successful Kerberos authentication on the example app</div>
<div class="packt_quote packt_infobox">This publishing method also allows us to use a public FQDN. This option can be useful if your application sends notification mails with links inside. To realize this use case, you need to change the external URL and provide a public SSL certificate. You can use your wildcard certificate or issue a separate SSL certificate with Let's encrypt.</div>
<ol start="18">
<li>You will find the settings under <span class="packt_screen">Basic Settings</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/77bc56e9-f1c5-4701-bd30-7d0125ff0596.png" width="741" height="170"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Defining the basic app settings</div>
<p>For the certificate, you need to use the following section. Don't forget to create the <span class="packt_screen">CNAME</span> inside your public <span class="packt_screen">DNS</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/170e7ded-8d6f-448e-8404-19357d8c3635.png" width="734" height="188"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">View the DNS configuration options</div>
<p>The next authentication method we can use for cloud or on-premises applications (through Azure AD Web Application Proxy) is the password-based option. We use it for form-based authentication activated applications that use their own identity provider.</p>
<div class="packt_infobox">Your credentials will be securely stored under the user or group object.</div>
<p class="mce-root"/>
<p class="mce-root"/>
<p>In the next steps, we will add a password-based application access:</p>
<ol>
<li>Add a new application and use the <span class="packt_screen">Non-gallery application</span> option.</li>
<li><span>Choose the <span class="packt_screen">Password-based</span> option under the <span class="packt_screen">Single sign-on</span> method:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/5f4f587c-5610-441b-8daf-bfc634589e31.png" style="width:33.83em;height:13.33em;" width="664" height="263"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Choosing a non-gallery application</div>
<ol start="3">
<li>Provide a name for your application and navigate to the <span class="packt_screen">Single-Sign-On</span> configuration:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/60a77d91-9f74-41d1-90ab-42f6485a93a6.png" style="width:20.58em;height:5.58em;" width="371" height="101"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Using the password-based authentication method</div>
<ol start="4">
<li>Provide the <span class="packt_screen">Sign-On URL</span> and detect the sign-in fields of your application.</li>
<li>There are three options to do this configuration:
<ul>
<li>Automatically</li>
<li>Manually</li>
<li>With custom configuration in the Advanced View:</li>
</ul>
</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/55b1b925-8994-4cf8-bd9c-e779700b6eb5.png" style="width:43.08em;height:21.50em;" width="792" height="395"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Detecting the login fields of the application</div>
<ol start="6">
<li>In this example, we used our public DNS provider's login page.</li>
<li>You can view the field labels with any browser and the developer tools to provide the values if the Azure AD mechanism doesn't get the correct values:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/a114233c-6925-457d-afa2-f3fbf760691e.png" style="width:47.08em;height:20.67em;" width="1312" height="576"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Analyzing the code to find the login fields/labels</div>
<ol start="8">
<li>Next, you need to assign the user or group to the application:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/164990f5-a2bd-4b35-b2a8-19430d5a5714.png" width="1168" height="229"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Updating the credentials on the user/group</div>
<div class="packt_tip">You have the option to provide the credentials hidden to the user or group, and the option that the credentials will be saved with the first access.</div>
<ol start="9">
<li>For now, provide the credentials with the <span class="packt_screen">Update Credentials</span> button:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/27d7c21d-3a4b-4a89-b690-a065555768b4.png" style="width:23.08em;height:19.17em;" width="376" height="312"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Update credentials dialog</div>
<ol start="10">
<li>Now, you are ready to test the application with your test user.</li>
</ol>
<div class="packt_tip">Keep in mind that the user needs to have the Access Panel UI extension installed or he will get asked to install it. You can also deploy this extension to all your computers using a group policy or any other software deployment tool. Find out more information about this at <a href="https://docs.microsoft.com/en-us/azure/active-directory/manage-apps/access-panel-extension-problem-installing">https://docs.microsoft.com/en-us/azure/active-directory/manage-apps/access-panel-extension-problem-installing</a></div>
<ol start="11">
<li>To test the same capabilities with your on-premises infrastructure, we provide you with a small challenge. If you don't get it running, send an email to <kbd>support@inovit.ch</kbd> and we will be happy to provide you with the answer.</li>
<li>You need to deploy the test application with the following steps on the <strong>YD1APP01 server</strong>.</li>
<li>Create a DNS entry for the app on your domain controller (<strong>YD1ADS01</strong>), <kbd>forms.inovitdemos.ch</kbd>:</li>
</ol>
<pre style="padding-left: 60px">Add-DnsServerResourceRecord -ZoneName "inovitdemos.ch" -A -Name "forms" -IPv4Address "10.0.0.6"</pre>
<ol start="14">
<li>Create the service account under which the application runs on your app server:</li>
</ol>
<pre style="padding-left: 60px">New-ADUser -Name "svcformsapp" -SamAccountName svcformsapp -UserPrincipalName svcformsapp@inovitdemos.ch -path "OU=Users,OU=AAD,OU=Managed Service Objects,DC=inovitdemos,DC=ch" -AccountPassword (ConvertTo-SecureString "MIA@me1976ch" -AsPlainText -Force) -Description "Forms App Pool Account" -Enabled $True</pre>
<p class="mce-root"/>
<ol start="15">
<li>Connect to your <span class="packt_screen">SQL Server</span> over in the SQL Management Studio on your <strong>YD1APP01:</strong></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/74343ba0-4df5-43fa-99e8-72a944860c8b.png" style="width:36.08em;height:18.08em;" width="469" height="235"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">SQL Connection with the SQL Management Studio</div>
<ol start="16">
<li>Create a login for your service account under <span class="packt_screen">Security</span> | <strong><span class="packt_screen">Logins</span></strong>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/e50054ff-19a1-41cd-9e77-526ab7678708.png" width="1014" height="310"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Configuring the login for the app service account</div>
<ol start="17">
<li>Assign the <span class="packt_screen">dbcreator</span> server role to the user:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/414f5dc7-5813-441f-b0af-143d93ef3bfe.png" width="1007" height="268"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Assigning the dbcreator role to the service account</div>
<ol start="18">
<li>Next, we need to create the website on the server:</li>
</ol>
<pre style="padding-left: 60px">New-Item C:\inetpub\formsroot -type Directory<br/>Import-Module Webadministration<br/>cd IIS:<br/>New-Item 'IIS:\Sites\forms Web Site' -bindings @{protocol="http";bindingInformation=":80:forms.inovitdemos.ch"} -physicalPath 'c:\inetpub\formsroot'</pre>
<ol start="19">
<li>As with the other on-premises demo applications, we will create a HTTPS binding and assign our SSL certificate:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/93701cfd-fcba-48aa-affe-c270d09b22b9.png" style="width:41.75em;height:10.83em;" width="508" height="133"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Configuring the IIS Bindings for the application</div>
<ol start="20">
<li>We also need to create a new app pool for the website and use the service account to run the app:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/f89b3530-2e5e-4761-afb2-bc8d36cc6dac.png" style="width:22.67em;height:20.83em;" width="301" height="277"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Creation of the Application Pool</div>
<ol start="21">
<li>Next, we will assign the newly created application pool to our website under <span class="packt_screen">Advanced settings</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/99cab251-a56e-44e5-a746-0e0d742e1ddf.png" width="657" height="219"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Assigning the newly created app pool</div>
<ol start="22">
<li>The authentication for the page should be configured as shown in the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/4150cc65-48db-485a-88de-9ca7b068b149.png" style="width:54.92em;height:20.08em;" width="779" height="285"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">IIS Authentication configuration</div>
<ol start="23">
<li>The next step is that we need to copy the content of the <kbd>formsapp</kbd> folder from the code package to <kbd>C:\inetpub\formsroot</kbd>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/abb475a9-a764-4570-9822-14060e63f778.png" style="width:54.67em;height:18.67em;" width="624" height="213"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Application Code</div>
<ol start="24">
<li>Before you can run the app, you need to configure the <kbd>web.config</kbd> file to address the <span class="packt_screen">SQL Server</span> instance:</li>
</ol>
<pre style="padding-left: 60px">&lt;add name="DefaultConnection" connectionString="Data Source=<strong>YD1APP01</strong>;Initial Catalog=FormsBasedAuthentication;Integrated Security=True" providerName="System.Data.SqlClient" /&gt;</pre>
<p class="mce-root"/>
<p class="mceNonEditable"/>
<ol start="25">
<li>Now, you can test your application by registering a user and a successful login:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/06942a3a-5eb7-45a8-96ff-68e205148324.png" style="width:56.50em;height:32.42em;" width="1240" height="712"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Successful test of the app</div>
<ol start="26">
<li>Start with your publishing scenario and log in to this website—good luck!</li>
</ol>
<p><span>In the next example, we will use the <strong>Windows Server Web Application Proxy</strong> to publish a</span> Basic authentication-based a<span>pplication to external users:</span></p>
<ol>
<li>First, you need to log in to your <strong>YD1ADS01</strong> to configure the relying party for the Basic demo application.</li>
<li>Navigate to Relying Party Trusts and Add Relying Party Trust.</li>
<li>Choose the non-claims-aware option.</li>
<li>Fill in the following Display Name: <kbd>Basic Demo Web Site</kbd>.</li>
<li class="mce-root">Use <kbd>https://basic.inovitdemos.ch</kbd> (replace it with your domain) as Relying Party Trust Identifier and click <span class="packt_screen">add</span>.</li>
</ol>
<div class="packt_tip">Don't forget to configure the FQDN in your public DNS.</div>
<ol start="6">
<li>Click Next until the wizard is finished.</li>
<li>Log in to your <strong>YD1URA01</strong> server and open the Remote Access Management console.</li>
<li>Click on <span class="packt_screen">Publish</span> in the right-hand Tasks pane:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/ddf7bd84-a212-487e-8489-624a3d2d3235.png" width="999" height="361"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Publishing wizard on the web application proxy</div>
<ol start="9">
<li>Specify the <span class="packt_screen">ADFS preauthentication method</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/6993f66b-3517-407c-bc63-82bb4f440104.png" style="width:45.17em;height:11.25em;" width="578" height="144"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Using the ADFS preauthentication method</div>
<ol start="10">
<li>Choose <span class="packt_screen">HTTP Basic</span> as the type of <span class="packt_screen">preauthentication</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/dadf671f-54b0-4082-af90-b23535bb4d7e.png" style="width:43.33em;height:6.75em;" width="578" height="90"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Using HTTP Basic</div>
<ol start="11">
<li>Choose <span class="packt_screen">Basic Demo Web Site</span> relying party.</li>
<li>Fill in the following publishing values:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/79aeb31a-c0d8-4b6d-b0b5-92c02b408faf.png" width="793" height="454"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Setting the application properties</div>
<ol start="13">
<li>Click <span class="packt_screen">Next</span>, <span class="packt_screen">Publish</span>, and <span class="packt_screen">Close</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/96eb4c63-34b9-4543-8000-3c5ef134367c.png" width="763" height="235"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Final publishing settings</div>
<ol start="14">
<li>Now, you can test your freshly published Basic authentication app.</li>
</ol>
<div class="packt_tip">You will find more practical scenarios for several services, such as the Exchange and Remote Desktop services, at the following sources: <a href="https://docs.microsoft.com/en-us/windows-server/remote/remote-access/web-application-proxy/publishing-applications-using-ad-fs-preauthentication">https://docs.microsoft.com/en-us/windows-server/remote/remote-access/web-application-proxy/publishing-applications-using-ad-fs-preauthentication</a> and <a href="https://docs.microsoft.com/en-us/windows-server/remote/remote-access/web-application-proxy/publishing-applications-using-ad-fs-preauthentication">https://docs.microsoft.com/en-us/windows-server/remote/remote-access/web-application-proxy/publishing-applications-using-ad-fs-preauthentication</a>.</div>
<p>In the next section, we will include the first conditional access options.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Using conditional access</h1>
                </header>
            
            <article>
                
<p>In our first conditional access scenario, we will use the Azure AD functionality to secure <span class="packt_screen">Salesforce</span> access with Azure MFA:</p>
<ol>
<li>Navigate to <a href="https://portal.azure.com">https://portal.azure.com</a> and the Azure AD pane | <span class="packt_screen">Conditional Access</span>.</li>
<li>Click <span class="packt_screen">New policy</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/25391b21-4ca5-4722-b1d4-4332045ba36e.png" width="899" height="327"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Creating a Conditional Access policy</div>
<ol start="3">
<li>Call the new policy <kbd>Salesforce Protection</kbd>.</li>
</ol>
<ol start="4">
<li>Under assignments, go to <span class="packt_screen">Include</span> | <span class="packt_screen">All users</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/b97d6fa1-3880-404d-82a8-f984e6f2dffe.png" style="width:43.92em;height:22.08em;" width="618" height="311"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">User assignment options</div>
<ol start="5">
<li>Under <span class="packt_screen">Cloud apps</span> | <span class="packt_screen">Select apps</span>, choose <span class="packt_screen">Salesforce</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/85fbf159-1b6d-48d1-96b7-47233ba29421.png" style="width:22.67em;height:23.33em;" width="305" height="314"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Selecting the Salesforce app</div>
<ol start="6">
<li>Under <span class="packt_screen">Conditions</span> | choose <span class="packt_screen">Locations</span> | <span class="packt_screen">Yes</span> and Any location:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/6a294d6c-17d5-489b-9526-5a9fe0d70f7b.png" style="width:50.67em;height:22.83em;" width="936" height="422"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Choosing the location attributes</div>
<div class="packt_tip">As you can see, you have many conditions that can be set when you want to fulfill security requirements in the case of additional authentication or access control mechanisms. You can find more information at the following source: <a href="https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/">https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/</a>.</div>
<ol start="7">
<li>Under Access controls, go to <span class="packt_screen">Grant</span>.</li>
</ol>
<ol start="8">
<li>Choose <span class="packt_screen">Grant access</span> | <span class="packt_screen">Require multi-factor authentication</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/10020e08-a352-4eff-9972-20e0ee00b153.png" style="width:22.33em;height:29.92em;" width="307" height="411"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Using MFA for granting the access</div>
<ol start="9">
<li>Enable the policy and click <span class="packt_screen">Create</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/c172525c-79ce-471d-93b7-0eb7c8fbe44a.png" style="width:25.50em;height:8.75em;" width="350" height="120"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Enabling the policy</div>
<ol start="10">
<li>Now, you can test it with a <span class="packt_screen">Salesforce</span> assigned user and Azure MFA will be required.</li>
</ol>
<p>In the second example, we will follow the same scenario with our on-premises ADFS infrastructure:</p>
<ol>
<li>Log in to your ADFS server (<strong>YD1ADS01</strong>) and open the ADFS management console.</li>
<li>We will enable <strong>Azure MFA</strong> for our <strong>Kerberos Demo Web Site.</strong></li>
<li>Right-click on the app and choose <span class="packt_screen">Edit Access Control Policy</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/3b0164aa-5fa2-47de-be4a-5e492982ed76.png" width="1010" height="294"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Configuring Access Control Policies for the app</div>
<ol start="4">
<li>Next, choose <span class="packt_screen">Permit everyone and require MFA</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/eec65966-fc58-4fce-87e8-bcaad5025186.png" style="width:31.75em;height:23.00em;" width="483" height="350"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Enabling the MFA option</div>
<ol start="5">
<li>Apply the settings and navigate to <span class="packt_screen">Authentication</span><span class="packt_screen"> Methods</span>.</li>
<li>Choose <span class="packt_screen">Edit Multi-Factor Authentication Methods</span>.</li>
<li>Go to Additional and choose <span class="packt_screen">Azure MFA</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/0e85a490-2816-45fc-a8b8-efeb3ef83b9d.png" width="767" height="267"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Choosing the Azure MFA method</div>
<ol start="8">
<li>Apply the setting and you are now ready to test the application.</li>
</ol>
<div class="packt_tip">You need to use a registered Azure MFA user to access the application. In the code package for the chapter, you will find additional use cases, including the customization required <span>to modify the login web page to interact with the user.</span></div>
<p>We will include more conditional access use cases and more information about the Azure MFA service in the following chapters:</p>
<ul>
<li>Exploring Azure AD identity services</li>
<li>Developing single-and multi-tenant applications</li>
<li>Configuring Azure information protection solutions</li>
</ul>
<p>This is to show its relevance to specific requirements.</p>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p><span>In this chapter, you have learned to configure different authentication scenarios using Azure AD and ADFS capabilities. There are many </span><span>possible</span><span> </span><span>combinations, and we can't provide all of them in one chapter. We gave you an introduction and some of our practical tips to get started and guide you in your upcoming journey through this technology. Don't worry; we jump more and more into some different scenarios in the next chapters of this book to give you as much help as possible. Also, look at the code package for the book; you will find additional practical examples from our projects.</span></p>
<p><span>In the next chapter, we will explore more Azure AD identity services, such as Azure AD B2B and B2C.</span></p>


            </article>

            
        </section>
    </div>



  </body></html>