- en: Creating Identity Life Cycle Management in Azure
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Handling the identity life cycle in cloud services is a highly requested topic;
    in particular, we are concerned about the handling of guest users in the Azure
    Active Directory, providing access to applications in the cloud and on-premise,
    including the sharing of information in a typical collaboration scenario. Precisely
    for this reason, we will discuss many use cases for handling guest users securely
    in your environment, and we will provide good usability for the users to access
    applications and data. We will also consider some helpful tools and services to
    automate your identity life cycle management. For sure, we can only provide a
    small footprint of ideas and references in this chapter, because there are many
    tasks and ideas to solve.
  prefs: []
  type: TYPE_NORMAL
- en: 'The chapter will be organized into the following sections:'
  prefs: []
  type: TYPE_NORMAL
- en: Lab environment readiness
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Handling the guest user life cycle
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure services for automation
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We will be working practically on different topics, so we will need to prepare
    some prerequisites in our test environment.
  prefs: []
  type: TYPE_NORMAL
- en: Lab environment readiness
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'For this chapter, we will need a configured second Azure AD with some test
    users inside. The users need to be licensed with Office 365 E3 or E5 licenses.
    The tenant and the associated public DNS configuration for the additional custom
    domain need to be done so that the users can send and receive emails. [Chapter
    1](54c375d9-b7d0-4478-8777-33935239254b.xhtml), *Building and Managing Azure Active
    Directory*, provided you with the required technical references to be ready to
    use the lab configuration in this chapter. Testing the functionality with the
    Azure AD application proxy requires that you have finished the steps in [Chapter
    1](54c375d9-b7d0-4478-8777-33935239254b.xhtml), *Building and Managing Azure Active
    Directory,* or in [Chapter 9](0cb2c20e-ca96-41ce-b555-24f63e63b9bf.xhtml), *Deploying
    Additional Applications on Azure AD*; specifically, the Kerberos application publishing.
    We will do the configuration to provide external access to on-premise applications
    for guest users on the **YD1APP01** virtual machine, as described in the following
    diagram:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/279ac108-878d-4a89-ada4-051cfdfc061e.png)'
  prefs: []
  type: TYPE_IMG
- en: Lab environment overview
  prefs: []
  type: TYPE_NORMAL
- en: 'In addition to the infrastructure requirements, we will introduce you to the
    test user sets for the different invitation flows, to get a better understanding
    of all of the related identity life cycle tasks. To be clear which user is based
    on which infrastructure, we have put the following small explanations in place:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Marie Lee**: Create in a hybrid cloud Office 365 partner infrastructure/tenant
    (`inovit.ch`)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Jochen Nickel**: Test user in Google; if you don''t have one, create one
    for your tests (Google)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Jenny Green**: Create in a cloud-only Office 365 partner environment (`yourdomain3.onmicrosoft.com/leano.ch`)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Don Hall**: Internal user and inviter of the `yourdomain1.onmicrosoft.com`
    tenant (`inovitdemos.ch`)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Susi Delgado**: Create an external email account (`identityplus.ch`) without
    Azure AD integration'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'This is summarized in the following diagram:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/eeb67fd8-e157-404e-83b5-d1e6a0835422.png)'
  prefs: []
  type: TYPE_IMG
- en: Test users for the different Azure B2B scenarios
  prefs: []
  type: TYPE_NORMAL
- en: Now that we have prepared our infrastructure and our test user setup, we can
    start to handle the guest user life cycle.
  prefs: []
  type: TYPE_NORMAL
- en: Handling the guest user life cycle
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In the following section, we will work through the different identity life
    cycle tasks for guest users. We will organize this section into specific use cases,
    as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Use Case 1**: Exploring the invitation process with different user types'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Use Case 2**: Using the Azure AD B2B portal'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Use Case 3**: Providing guest user access to on-premise apps'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Now, we will start with the first use case.
  prefs: []
  type: TYPE_NORMAL
- en: Use Case 1 – Exploring the invitation process with different user types
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In the following use case, we will explore the invitation process for different
    user types. We will use our global administrator to invite the following users:'
  prefs: []
  type: TYPE_NORMAL
- en: Maria Lee
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Jochen Nickel
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Jenny Green
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Susi Delgado
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The usernames need to be replaced with your names.
  prefs: []
  type: TYPE_NORMAL
- en: 'With the next steps, we will start the configuration:'
  prefs: []
  type: TYPE_NORMAL
- en: Open the Azure portal, [https://portal.azure.com](https://portal.azure.com),
    as the global administrator, and navigate to the Azure AD blade.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Navigate to Users | All users, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/0a8f53eb-84d5-47b0-936e-d4fbd0f44ebb.png)'
  prefs: []
  type: TYPE_IMG
- en: Guest user creation process in Azure AD portal
  prefs: []
  type: TYPE_NORMAL
- en: Click on New guest user and invite all of the four test guest users, and provide
    a short personal message, like `Welcome to the team!`
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You can also use a bulk import over a CSV file.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'The basic structure of the file needs to be as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '| **Name** | **Invited User EmailAddress** |'
  prefs: []
  type: TYPE_TB
- en: '| Maria Lee | maria.lee@inovit.ch |'
  prefs: []
  type: TYPE_TB
- en: '| Jochen Nickel | jochen.nickel@gmail.com |'
  prefs: []
  type: TYPE_TB
- en: '| Jenny Green | jenny.green@leano.ch |'
  prefs: []
  type: TYPE_TB
- en: '| Susi Delgado | susi.delgado@identityplus.ch |'
  prefs: []
  type: TYPE_TB
- en: Afterward, you can run the following commands.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Connect to your Azure AD tenant, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'Execute the invitation, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'Check the newly created guest users, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'Next, we will accept all of the invitations, in the following order:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Marie Lee
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Jenny Green
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Jochen Nickel
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Susi Delgado
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Log in to every mailbox to accept the invitation (use a different browser or
    InPrivate sessions).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You should receive a message like this on every account:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/903941e4-1c7b-46ce-93b2-ef9501a0e77d.png)'
  prefs: []
  type: TYPE_IMG
- en: Azure AD guest invitation message
  prefs: []
  type: TYPE_NORMAL
- en: 'Click on Get Started as Maria, and you will be redirected to the consent of
    `YOURDOMAIN1.ONMICROSOFT.COM`, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/a351566c-6878-42a6-9309-7bb4db3b79dc.png)'
  prefs: []
  type: TYPE_IMG
- en: Permission consent
  prefs: []
  type: TYPE_NORMAL
- en: This is the default behavior for Azure AD based users, and will be the same
    with **Jenny Green**.
  prefs: []
  type: TYPE_NORMAL
- en: 'Accept the permissions, and you will automatically be signed in to the access
    panel UI of `YOURDOMAIN1`, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/f05d48fc-22e4-44bb-bd0a-86c14346ff9b.png)'
  prefs: []
  type: TYPE_IMG
- en: Azure AD Access Panel UI
  prefs: []
  type: TYPE_NORMAL
- en: With this process, you will have no preassigned applications and groups.
  prefs: []
  type: TYPE_NORMAL
- en: Log out and do the same for Jenny Green, and you will have the same behavior
    experience.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Next, you will do the same with your Gmail account; in my case, it's `jochen.nickel@gmail.com`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You will notice that you are redirected to [https://login.live.com](https://login.live.com),
    and you need to log in with your Gmail account credentials, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/4b62445f-61ea-45d2-b491-5494add790df.png)'
  prefs: []
  type: TYPE_IMG
- en: Login experience of the Gmail account to live.com
  prefs: []
  type: TYPE_NORMAL
- en: This is the typical behavior for Gmail and other federated identity providers
    to Azure AD.
  prefs: []
  type: TYPE_NORMAL
- en: The other steps are the same as for existing Azure AD users.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Log out and run the process for the external non-Azure AD email account (in
    my case, Susi Delgado) as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/1df23a10-749e-41e9-9d51-0ad988390ced.png)'
  prefs: []
  type: TYPE_IMG
- en: Email account behavior for guest invites
  prefs: []
  type: TYPE_NORMAL
- en: 'You will notice that you need to create a Microsoft account, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/cdcce209-6d67-445c-8bc1-d06d176ab320.png)'
  prefs: []
  type: TYPE_IMG
- en: Microsoft account setup
  prefs: []
  type: TYPE_NORMAL
- en: This is the default behavior if the user doesn't exist in any Azure AD.
  prefs: []
  type: TYPE_NORMAL
- en: 'You will see the following link in the address bar: [https://invitations.microsoft.com/signup?tenant=7709ca2b-3be8-4d92-89d7-dc1e274b4d0e](https://invitations.microsoft.com/signup?tenant=7709ca2b-3be8-4d92-89d7-dc1e274b4d0e)'
  prefs: []
  type: TYPE_NORMAL
- en: You will receive a verification email to your account.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Enter the verification code and click on Finish, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/8b945b12-78d0-4fd8-9e4f-dba123dbe465.png)'
  prefs: []
  type: TYPE_IMG
- en: Verification process
  prefs: []
  type: TYPE_NORMAL
- en: Accept the consent that appears. Technically, you are now the owner of your
    own Azure AD tenant.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You can verify this by opening the Azure portal, [https://portal.azure.com](https://portal.azure.com),
    and logging on as Susi Delgado.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Navigate to the Azure AD blade and check the existing users, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/c4702621-4ce1-4452-a00e-dbbc87924657.png)'
  prefs: []
  type: TYPE_IMG
- en: Azure AD user management
  prefs: []
  type: TYPE_NORMAL
- en: 'Check the custom domains, and you will find that your suffix is mentioned as
    Verified, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/2669c947-f19b-4a20-a426-4a352c08f295.png)'
  prefs: []
  type: TYPE_IMG
- en: Custom domain overview
  prefs: []
  type: TYPE_NORMAL
- en: With the following procedure, you can take over the Azure AD tenant [https://docs.microsoft.com/en-us/azure/active-directory/users-groups-roles/domains-admin-takeover](https://docs.microsoft.com/en-us/azure/active-directory/users-groups-roles/domains-admin-takeover)[.](https://bit.ly/2R5wkQr)
  prefs: []
  type: TYPE_NORMAL
- en: 'You will find all guest users with different source types, as shown in the
    following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/3a6fe1a9-8b04-4d4e-9324-ba09f4a069bf.png)'
  prefs: []
  type: TYPE_IMG
- en: Azure AD user management—Guest users only filter
  prefs: []
  type: TYPE_NORMAL
- en: 'To summarize the invitation process up to now: if a user has already managed
    in a partner Azure AD, there is no special behavior, except for accepting the
    invitation and the permission consent. A user from Gmail, or any other federated
    identity provider, will be treated on a special `live.com` directory. Furthermore,
    a user that doesn''t already exist on any Azure AD will be created in an unmanaged
    Azure AD. Be aware that there is no automatic deprovisioning process, and the
    user will have to use an additional credential set.'
  prefs: []
  type: TYPE_NORMAL
- en: 'With the following configuration switch, you can limit users to accessing the
    Azure portal. If you run an Azure AD Privileged Identity Management scenario,
    the following will be not the best option:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/b6ffad54-1e7f-44e8-9bc6-cfd3927bb5cd.png)'
  prefs: []
  type: TYPE_IMG
- en: Option to restrict Azure AD Portal access
  prefs: []
  type: TYPE_NORMAL
- en: 'Furthermore, you should reconfigure the default settings for the external collaboration
    so that guests can''t invite other guests, as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/e1a4868f-5b43-44a6-b0da-96ef5d2650b1.png)'
  prefs: []
  type: TYPE_IMG
- en: Azure AD guest user handling options
  prefs: []
  type: TYPE_NORMAL
- en: 'Another useful tip is how to convert a guest user to an internal member. This
    can be reached with the following cmdlets:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Provide global administrator credentials, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'Convert the user, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 'The next important point is to harden the All users group, if enabled. To do
    this, take the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: 'You will find the setting under the Azure AD blade | Groups | General, as shown
    in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/d882f77b-1108-4cef-82d9-df4268d9bd90.png)'
  prefs: []
  type: TYPE_IMG
- en: All users option
  prefs: []
  type: TYPE_NORMAL
- en: 'Do the following hardening configuration on the All users group:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/4613a692-679e-4cf6-b48b-772ce1d1c015.png)'
  prefs: []
  type: TYPE_IMG
- en: Dynamic group membership rule for the member user type
  prefs: []
  type: TYPE_NORMAL
- en: 'Build another group with dynamic group membership, like All Guest Users, as
    follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/fa633eee-ab8b-4361-b994-b6029fb5bbeb.png)'
  prefs: []
  type: TYPE_IMG
- en: Dynamic Group membership rule for guest users
  prefs: []
  type: TYPE_NORMAL
- en: You can also enable Azure **multi-factor authentication** (**MFA**) for all
    guest users to access the Azure portal, [https://portal.microsoft.com](https://portal.microsoft.com).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Navigate to Conditional Access (Azure AD Premium P2).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Click on New policy, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/0890ff06-6cd5-4073-9e6e-a2e8c2dce282.png)'
  prefs: []
  type: TYPE_IMG
- en: Conditional Access management policies for Salesforce
  prefs: []
  type: TYPE_NORMAL
- en: 'Define a name and choose All guest users, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/06379a10-d9b7-481b-925e-f438ee5846e5.png)'
  prefs: []
  type: TYPE_IMG
- en: Guest user selection
  prefs: []
  type: TYPE_NORMAL
- en: 'Choose the Microsoft Azure Management application, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/6aea908e-3610-4e98-bffe-9cb184050fde.png)'
  prefs: []
  type: TYPE_IMG
- en: Protection of the Azure Portal access
  prefs: []
  type: TYPE_NORMAL
- en: 'Under Access Control, select Require multi-factor authentication, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/2bf63fd1-92b3-473e-acfb-7d1f16f30e33.png)'
  prefs: []
  type: TYPE_IMG
- en: MFA requirement
  prefs: []
  type: TYPE_NORMAL
- en: Enable the policy.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Test the functionality with one of your guest users.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: After working through the first processes, we can extend our solution with the
    Azure AD B2B portal, in order to provide more capabilities.
  prefs: []
  type: TYPE_NORMAL
- en: Using the Azure AD B2B portal and use cases
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The invitation API provides a lot of capabilities to customize the onboarding
    workflow for guest users. You can include processes like self-signup, assigning
    a manager for guest users, an update to the user profile, and an automatic group
    or application assignment to the guest users. We will use the Microsoft sample
    project to demonstrate the different capabilities in your environment. You can
    find the sample project at [https://github.com/Azure/active-directory-dotnet-graphapi-b2bportal-web](https://github.com/Azure/active-directory-dotnet-graphapi-b2bportal-web).
  prefs: []
  type: TYPE_NORMAL
- en: Installation and configuration
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In the beginning, we need to provide two Azure Active Directory applications
    that will be used to delegate the correct permissions to the Azure B2B sample
    portal. To do this, take the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to your Azure portal, [https://portal.azure.com](https://portal.azure.com),
    and the Azure AD blade.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Click on Properties and copy the directory ID to a notepad, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/5773ce23-ab7f-4988-9ab5-90615ccf5b73.png)'
  prefs: []
  type: TYPE_IMG
- en: Getting directory ID
  prefs: []
  type: TYPE_NORMAL
- en: 'Click on App registrations and add a new app, like the following:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/19d7c03d-3f88-4a17-bf87-9d266dd428c8.png)'
  prefs: []
  type: TYPE_IMG
- en: Configuring app properties
  prefs: []
  type: TYPE_NORMAL
- en: Click on Settings on the newly created app.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Navigate to Required permissions.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on Add and select the Microsoft Graph.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Click on Select permissions and enable the following permissions:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Application permissions:'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Read and write directory data
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Read and write all users' full profiles
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Delegated permissions:'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Sign in and read user profile, as follows:'
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](img/302d2d25-95da-4a97-ad88-19d941611329.png)'
  prefs: []
  type: TYPE_IMG
- en: Configuring required permissions
  prefs: []
  type: TYPE_NORMAL
- en: 'After you have added the Microsoft Graph API and configured the permissions,
    click on Grant permissions, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/3dfef32a-8f12-443b-8556-05fa0b4d9ec1.png)'
  prefs: []
  type: TYPE_IMG
- en: Permission granting procedure
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to the Keys section.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provide a key description and choose expires in 2 years.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Click on Save and copy the key value to your notepad, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/c2319a5a-9e74-4a65-a546-52144d37858c.png)'
  prefs: []
  type: TYPE_IMG
- en: Key generation
  prefs: []
  type: TYPE_NORMAL
- en: 'Next, copy the Application ID to your notepad, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/e07b25e8-1c2a-4e2e-a830-753e35651d73.png)'
  prefs: []
  type: TYPE_IMG
- en: App ID gathering
  prefs: []
  type: TYPE_NORMAL
- en: Now, we can create the second app for the pre-authentication.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Use the following values:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/e87da190-8ecb-4c19-af66-2dd9cc3e35e6.png)'
  prefs: []
  type: TYPE_IMG
- en: Pre-auth app configuration
  prefs: []
  type: TYPE_NORMAL
- en: 'Under Settings | Properties, choose Multi-tenanted as Yes, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/6cc188db-6b77-4313-a1be-a98a05c0f80f.png)'
  prefs: []
  type: TYPE_IMG
- en: Multi-tenant option enabled
  prefs: []
  type: TYPE_NORMAL
- en: Click on Required permissions and add the Microsoft Graph API.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Assign the following permissions:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Delegated permissions**: Sign in and read user profile'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Don't forget to press the Grant permissions button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Next, we need to generate an app key, like we did for the first app.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Copy the key value to your notepad.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Copy the Application ID to your notepad.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Click on Manifest, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/33a5e277-d38f-4fb0-b2be-890000b5cd35.png)'
  prefs: []
  type: TYPE_IMG
- en: App manifest configuration options for advanced topics
  prefs: []
  type: TYPE_NORMAL
- en: 'We need to change the oauth2AllowImplicitFlow value to `true`, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/6b8f05ca-7fe2-4365-b0b5-35b7c48f1e78.png)'
  prefs: []
  type: TYPE_IMG
- en: OAuth flow option
  prefs: []
  type: TYPE_NORMAL
- en: Now, we can start to deploy our web application to Azure.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Click on Deploy to Azure, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/fdc4d78e-6c7d-403b-9125-35e3413fa540.png)'
  prefs: []
  type: TYPE_IMG
- en: Example of portal deployment to Azure
  prefs: []
  type: TYPE_NORMAL
- en: 'Use the values from your notepad and fill, them in as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/629eff8c-5db3-4efe-9f6f-ce0d02c6eb3a.png)'
  prefs: []
  type: TYPE_IMG
- en: Azure AD B2B portal deployment options
  prefs: []
  type: TYPE_NORMAL
- en: Wait until the deployment process is done.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Navigate to the App Service section on the Azure portal.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Copy the URL to your B2B Portal application, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/a6d9f07b-0850-4f56-b36e-9ac801568fd3.png)'
  prefs: []
  type: TYPE_IMG
- en: App deployment result
  prefs: []
  type: TYPE_NORMAL
- en: Edit each of your Azure AD apps and change the Homepage and Reply URL.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: All done. Now we can start to use the portal and build some example processes.
  prefs: []
  type: TYPE_NORMAL
- en: Usage of the portal
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The Azure AD B2B portal provides many processes to show the power of the invitation
    API. With the first touch on your brand new site, you need to log in and configure
    the basic parameters. To do this, take the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Open your portal link and log in to the Azure AD B2B portal with your global
    administrator credentials, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/90c6897a-a703-4319-bf0b-02b3ea7e2cf8.png)'
  prefs: []
  type: TYPE_IMG
- en: Azure AD B2B Portal basic configuration
  prefs: []
  type: TYPE_NORMAL
- en: 'In the next configuration steps, you can configure the corporate identity of
    the web page, including the communication templates, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/b825e111-a14d-466e-b097-5c1540940f2e.png)'
  prefs: []
  type: TYPE_IMG
- en: Azure AD B2B example portal site configuration
  prefs: []
  type: TYPE_NORMAL
- en: Enter the site name and the inviting organization, including a short welcome
    message.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Enter the inviter email address and click on Save.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Next, we will create three more user accounts in your partner Azure AD tenant, `yourdomain3.onmicrosoft.com`
    (`leano.ch`).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Assign an **Office 365 E3/E5** license to provide a mailbox for the users.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Just name them as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '`guest.user1@leano.ch`'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '`guest.user2@leano.ch`'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '`guest.user3@leano.ch`'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Now, we can see the capability of providing custom email templates for the invitation
    process.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Click on Admin | Manage Mail Templates, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/1a2f12ed-53b8-4356-80fe-332acf0e1781.png)'
  prefs: []
  type: TYPE_IMG
- en: Admin options
  prefs: []
  type: TYPE_NORMAL
- en: 'A default template is already in place, as demonstrated in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/7a93e974-ba8b-4256-a133-2676757ad9a4.png)'
  prefs: []
  type: TYPE_IMG
- en: Invitation templates configuration
  prefs: []
  type: TYPE_NORMAL
- en: 'Click on + New to create an additional template, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/23cdae9f-fe09-4303-bf76-e6ebbad06779.png)'
  prefs: []
  type: TYPE_IMG
- en: Custom mail templates configuration
  prefs: []
  type: TYPE_NORMAL
- en: If you want to use SMTP, your web app needs to have an SMTP server configured.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on Save.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Next, we will see domain management.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'In this section, you can configure the main process parts, which are as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Defining pre-approved organizations.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Defining the user type, **Guest** or **Member**.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: You can use the predefined mail templates, based on the organization.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'You can put the invited user directly into the required group, as follows:'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](img/eb1d6083-f059-480b-b548-5b9bffcc80b2.png)'
  prefs: []
  type: TYPE_IMG
- en: Automatic group assignment and access management options
  prefs: []
  type: TYPE_NORMAL
- en: Type the `yourdomain3.onmicrosoft` (`leano.ch`) organization domain.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Assign the Kerberos Demo Application Access group to the user.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You will notice that the application can check directly whether the organization
    is based on Azure AD, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/05024f57-cbb9-42e7-82a6-c4823fadd621.png)'
  prefs: []
  type: TYPE_IMG
- en: Suffix verification against Azure AD list
  prefs: []
  type: TYPE_NORMAL
- en: 'Click on Save:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/4f6dd474-b437-4c1e-ae0d-954cb10662f5.png)'
  prefs: []
  type: TYPE_IMG
- en: Pre-approved domain configuration
  prefs: []
  type: TYPE_NORMAL
- en: Now, we can test the functionality with our first guest user.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Open the B2B portal, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/f4677a3a-d3a6-45de-982f-b9347b333073.png)'
  prefs: []
  type: TYPE_IMG
- en: Azure AD B2B example app sign-up page
  prefs: []
  type: TYPE_NORMAL
- en: Sign up with `guest.user1@leano.ch`, and click on Request Access.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You will receive the following message to identify your request:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/9db5e626-5775-4c54-a329-09d7af11e0c1.png)'
  prefs: []
  type: TYPE_IMG
- en: Sign up, including the request ID
  prefs: []
  type: TYPE_NORMAL
- en: Next, log in to the B2B portal as an administrator.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You will see the request from the user, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/6a74187a-0af6-429e-9291-298c3ba972b7.png)'
  prefs: []
  type: TYPE_IMG
- en: Guest approval process
  prefs: []
  type: TYPE_NORMAL
- en: The guest user has not yet been created in the organization.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Approve the request and save, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/7b142681-4b19-4825-afff-cb1e1501c2e6.png)'
  prefs: []
  type: TYPE_IMG
- en: Request approval
  prefs: []
  type: TYPE_NORMAL
- en: Log in to [https://myapps.microsoft.com](https://myapps.microsoft.com) as Guest
    User1.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You should get the notification about the invite, and you can perform the onboarding
    process.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'If a user is invited but didn''t accept the invitation, the guest user will
    be in the following state:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/b0194425-e3b4-4bb3-8963-3757ee0226b3.png)'
  prefs: []
  type: TYPE_IMG
- en: User type and state
  prefs: []
  type: TYPE_NORMAL
- en: The state will be changed after the user accepts.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The following should be the expected result.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'The user is assigned to the app group, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/211c7abe-de04-48d1-82c9-6987d2ea3806.png)'
  prefs: []
  type: TYPE_IMG
- en: Group assignment
  prefs: []
  type: TYPE_NORMAL
- en: 'The user is a member of the organization. Click on his user icon in [https://myapps.microsoft.com](https://myapps.microsoft.com),
    as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/12240265-11ef-4cbc-a569-66ab56827831.png)'
  prefs: []
  type: TYPE_IMG
- en: Organization association
  prefs: []
  type: TYPE_NORMAL
- en: 'If you click on the wheel, you will be able to leave the organization (feature
    related to the General Data Protection Regulations GDPR), as shown in the following
    screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/1a73c80b-b676-45c1-9ccc-6efa681e7e10.png)'
  prefs: []
  type: TYPE_IMG
- en: Leave organization option
  prefs: []
  type: TYPE_NORMAL
- en: 'And, if you change the organization, the Kerberos Demo Web Site application
    should appear, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/46a75375-6bba-4635-ad38-a145b914c7d4.png)'
  prefs: []
  type: TYPE_IMG
- en: Assigned applications on the Azure AD access panel UI
  prefs: []
  type: TYPE_NORMAL
- en: For now, if you click on the application, you will receive an error; we will
    handle this later in this chapter.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You will be a member of the following groups, when you click on Groups, as
    follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/2776a077-24da-49c5-b1c4-21183933d9a2.png)'
  prefs: []
  type: TYPE_IMG
- en: Group assignment self-service and overview
  prefs: []
  type: TYPE_NORMAL
- en: The next process that the B2B portal supports is auto-approval for organizations
    that you know.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'If you decide to delegate the invitation process to an internal or external
    employee over the Azure AD portal or the B2B portal, you can use the Azure AD
    PIM AD Guest Inviter role, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/c6c2fc90-7439-4cee-8f34-08f75bcf521f.png)'
  prefs: []
  type: TYPE_IMG
- en: Delegation of the guest inviter role
  prefs: []
  type: TYPE_NORMAL
- en: During this use case, you have seen the power of the invitation API. You can
    work around it and build your own scenarios.
  prefs: []
  type: TYPE_NORMAL
- en: Special considerations
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this small section, we will take a look at some special parts of the B2B
    process. Let''s start with the scenario that a user gets married and changes their
    name, including the email address and the `userPrincipalName`. Follow these steps:'
  prefs: []
  type: TYPE_NORMAL
- en: To view the result, we will do this for `guest.user1@leano.ch`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Open [https://portal.office.com](https://portal.office.com) on the `yourdomain3.onmicrosoft.com`
    tenant and select the user, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/693e2a12-4b72-423a-99be-b6f97b3bb860.png)'
  prefs: []
  type: TYPE_IMG
- en: Guest user modification options and results
  prefs: []
  type: TYPE_NORMAL
- en: Click on Manage user and call him `jeff.barnes@leano.ch`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Navigate to the Exchange Admin Center, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/fa713cd2-9c7a-4ecf-8db4-3fad09e43b8d.png)'
  prefs: []
  type: TYPE_IMG
- en: Exchange Admin center access
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to Recipients | Mailboxes.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Edit the Guest User1 new Jeff Barnes, with the following expected result:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/c5f9b8b1-0b1e-4e1f-9b8e-4bc80132f818.png)'
  prefs: []
  type: TYPE_IMG
- en: Email address change for the guest user
  prefs: []
  type: TYPE_NORMAL
- en: Go to the Email address.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Change all of the following to Jeff Barnes, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/778ed0fc-06f4-4413-8c57-c2cd629cd86b.png)'
  prefs: []
  type: TYPE_IMG
- en: Changing the user attributes
  prefs: []
  type: TYPE_NORMAL
- en: 'Your user should now look like this in the Azure AD:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/e6cf9ba0-f31c-4039-b935-ef665c63540d.png)'
  prefs: []
  type: TYPE_IMG
- en: Result of changes
  prefs: []
  type: TYPE_NORMAL
- en: Next, we will test the behavior on [https://myapps.microsoft.com](https://myapps.microsoft.com)
    with Jeff Barnes (Guest User1).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Your user should look like this:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/ac99f22a-4341-4765-8991-295c3ab72025.png)'
  prefs: []
  type: TYPE_IMG
- en: Review of the changes in the Azure AD Access Panel UI
  prefs: []
  type: TYPE_NORMAL
- en: Now, change to the `INOVITDEMOS` organization.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You should have the same experience as before, because the mapping in the background
    is done by a GUID.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'However, you should notice, as in the following, that the user is still called
    Guest User1:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/de506cd4-d218-4a17-a0fb-9fda08c6eb35.png)'
  prefs: []
  type: TYPE_IMG
- en: Review of the changes in the Azure AD Access Panel UI (External org)
  prefs: []
  type: TYPE_NORMAL
- en: There is no synchronization job between the two organizations.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You can change the experience for the user by changing his information, as
    follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/c5ec93ae-8be4-41d3-83ee-742089009082.png)'
  prefs: []
  type: TYPE_IMG
- en: Attribute change options
  prefs: []
  type: TYPE_NORMAL
- en: 'There are more things that you should note about guest users, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: They can't get Exchange Online licenses
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: They can't change the tenant in Office 365 (for PIM enabled external supporters,
    for example)
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: You can't leave an organization if your sign in is blocked
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: You can read more about the special considerations at [https://docs.microsoft.com/en-us/azure/active-directory/b2b/user-properties](https://docs.microsoft.com/en-us/azure/active-directory/b2b/user-properties),
    including how you can use access reviews to manage the Azure AD B2B guest users.
  prefs: []
  type: TYPE_NORMAL
- en: On-premise application access for guest users
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this section, we will illustrate how you can provide on-premise application
    access for guest users. We have already published the Kerberos Demo Web App through
    the Azure AD Application Proxy, and you have seen the application in the Azure
    AD Access Panel UI as a guest user.
  prefs: []
  type: TYPE_NORMAL
- en: 'With the integration of the web application proxy and the Azure AD Application
    Proxy, you will receive the following features and capabilities:'
  prefs: []
  type: TYPE_NORMAL
- en: 'End user portal: The Azure Access panel at [https://myapps.microsoft.com](https://myapps.microsoft.com).'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'The Azure AD authentication capabilities are as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Usernames and passwords synced from on-premise AD DS
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Federated login to on-premise or other federation servers
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: MFA
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Customized login screen
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Authorization based on the user or groups
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: SSO to Office 365, thousands of SaaS applications, and all applications integrated
    with Azure AD.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Reports, auditing, and security monitoring are based on big data and machine learning.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: All HTTPS traffic is terminated in the cloud, blocking most HTTP-level attacks.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Unauthenticated traffic is filtered in the cloud, and will not arrive on-premise.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: There are no incoming connections to the corporate network—only outgoing connections
    to the Azure AD application proxy service.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Internet-facing services are always up to date with the latest security patches
    and server upgrades.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: There is login abnormality detection, reporting, and auditing by Azure AD.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Providing SSO experience from Azure AD to on-premise applications.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Connectors use the Azure AD token data to impersonate the end user to the backend
    applications using **Kerberos Constrained Delegation** (**KCD**).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: There is support for any application that uses **Integrated Windows Authentication** (**IWA**),
    such as SharePoint, Outlook Web Access, and Microsoft Dynamics CRM.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: There is no need to change the backend applications.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: There is no need to install agents on backend applications.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: There is no need to expose on-premise applications directly to the internet.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'The following diagram shows the architecture:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/df4d5f64-fbb4-4cc2-82c7-67abdd2158f1.png)'
  prefs: []
  type: TYPE_IMG
- en: Azure AD Application Proxy architecture
  prefs: []
  type: TYPE_NORMAL
- en: In the case of guest user access, the Azure AD application proxy just checks
    that the `userPrincipalName` exists in the on-premise Active Directory.
  prefs: []
  type: TYPE_NORMAL
- en: 'To configure the access for guest users, we will use the following procedure:'
  prefs: []
  type: TYPE_NORMAL
- en: Log in to your Domain Controller **YD1ADS01** as a domain administrator.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Open a PowerShell and connect to your `Azure AD`, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: 'Get all guest users, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: 'The following screenshot shows the output:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/482e44d1-67d0-479c-9038-699cb85fa483.png)'
  prefs: []
  type: TYPE_IMG
- en: All guest users of the tenant
  prefs: []
  type: TYPE_NORMAL
- en: Now, we need to add the `UPN-suffix @yourdomain1.onmicrosoft.onmicrosoft.com`
    to the UPN suffixes of your Active Directory environment.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Use the `domain.msc` console for it; right-click on Active Directory Domains
    and Trusts and choose Properties.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Add your suffix, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/1198793b-8e4f-4c58-92db-2243236c6a91.png)'
  prefs: []
  type: TYPE_IMG
- en: Azure AD suffix to UPN suffix assignment
  prefs: []
  type: TYPE_NORMAL
- en: Next, we need to create our guest user in our local Active Directory.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open the console `dsa.msc` Active Directory Users and Computers.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Create an Organizational Unit called Managed External Business Objects, as
    follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/c19b5772-0731-49d9-9019-b1d43730a368.png)'
  prefs: []
  type: TYPE_IMG
- en: External objects OU in Active Directory
  prefs: []
  type: TYPE_NORMAL
- en: 'Create the user, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '`jenny.green_leano.ch#EXT#`'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '`@181031inovitdemos.onmicrosoft.com`'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '`BG00001`:'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](img/2dd7fd95-c075-4351-a53c-39eca7747af1.png)'
  prefs: []
  type: TYPE_IMG
- en: User properties
  prefs: []
  type: TYPE_NORMAL
- en: You don't need to remember the password, because it's not needed.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The Azure AD will authenticate the user.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Now, assign the user to the **Kerberos Demo Web App Access** group in the Azure
    AD, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/21b6be32-fbc9-4ff1-a86a-3aa53eb6402b.png)'
  prefs: []
  type: TYPE_IMG
- en: App access group members
  prefs: []
  type: TYPE_NORMAL
- en: Now, you can test the solution with Jenny Green at [https://myapps.microsoft.com](https://myapps.microsoft.com).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Change the organization to `INOVITDEMOS`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the Kerberos app.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You should see a successful login, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/908aa962-d4ab-4f21-a527-58ff8143b0de.png)'
  prefs: []
  type: TYPE_IMG
- en: Kerberos example web page for guest users
  prefs: []
  type: TYPE_NORMAL
- en: 'To automate and extend this solution, you can use Microsoft Identity Manager
    2016 or the provided PowerShell solution. You can get information about this approach
    on Azure AD B2B collaboration with **Microsoft Identity Manager **(**MIM**) 2016
    SP1, with Azure application proxy, at the following sources:'
  prefs: []
  type: TYPE_NORMAL
- en: '[https://docs.microsoft.com/en-us/microsoft-identity-manager/microsoft-identity-manager-2016-graph-b2b-scenario#b2b-end-to-end-deployment-example-scenarios](https://docs.microsoft.com/en-us/microsoft-identity-manager/microsoft-identity-manager-2016-graph-b2b-scenario#b2b-end-to-end-deployment-example-scenarios)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[https://www.microsoft.com/en-us/download/details.aspx?id=51495](https://bit.ly/2Cz0yWW)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In this section, we handled various use cases to provide an identity life cycle
    for guest users. In the next part, we will give some tips on how you can get more
    comfortable in your environment.
  prefs: []
  type: TYPE_NORMAL
- en: Azure services for automation
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This year, at Microsoft Ignite, Mark Wahl presented a new feature set. This
    feature set is called Azure AD Identity Governance, which is in private preview.
    I will give you an idea of the public information.
  prefs: []
  type: TYPE_NORMAL
- en: 'Identity is the control panel and merges user experience, business needs, and
    security requirements together. You need to ensure that the correct users get
    the right access to the correct and required resources at any time. Azure AD Identity
    Governance is the set of capabilities for this. They enable you to define access
    policies and monitor your identities. Microsoft is developing a complete suite
    of governance capabilities for Azure AD, including two powerful new features:
    Entitlement management and My Access.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Admins will be able to create policies for resources, such as groups, apps,
    and sites, with the upcoming entitlement management. It will provide the automated
    process of granting access to employees and partners. The My Access portal gives
    employees and partners the possibility to request access to these entitlements,
    including access to request approvals, as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/1b240e3e-f09b-44b4-b7f7-907f9278d5f7.png)'
  prefs: []
  type: TYPE_IMG
- en: Azure Identity Governance Entitlement management options
  prefs: []
  type: TYPE_NORMAL
- en: 'First, the resources must be specified and associated with the entitlement.
    In this example, you see two apps, one user group, and one SharePoint site. You
    can add more resources. As you can see in the following screenshot, roles are
    also included in this concept:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/40813aee-2c45-44de-892f-4cb44ae70060.png)'
  prefs: []
  type: TYPE_IMG
- en: Resource assignment for entitlements
  prefs: []
  type: TYPE_NORMAL
- en: 'With the new features, as shown in the following screenshot, you can define
    entitlement policies to drive your security requirements:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/da404752-f408-48c7-9f5f-0919724a37fc.png)'
  prefs: []
  type: TYPE_IMG
- en: Entitlement policy options
  prefs: []
  type: TYPE_NORMAL
- en: 'Another fact that you should be aware of is the many different Azure features
    that provide you with the capabilities to drive your cloud-based identity and
    access management. We recommend reading the article at [https://bit.ly/2u3LcZG](https://bit.ly/2u3LcZG),
    regarding the following technologies:'
  prefs: []
  type: TYPE_NORMAL
- en: Microsoft Flow
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure Logic Apps
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure Functions
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure App Service WebJobs
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'There are already many examples in the community that show the power of these
    features; some of them are as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: Martina Grom, with provisioning Office 365 groups with Azure functions: [https://blog.atwork.at/post/2017/10/01/Provisioning-an-Office-365-group-with-an-approval-flow-and-Azure-functions-part-2](https://blog.atwork.at/post/2017/10/01/Provisioning-an-Office-365-group-with-an-approval-flow-and-Azure-functions-part-2)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Asish Padhy, with the same topic: [https://asishpadhy.com/2018/05/01/automation-and-creation-of-office-365-groups-using-flow-microsoft-graph-and-azure-function-part-1/](https://asishpadhy.com/2018/05/01/automation-and-creation-of-office-365-groups-using-flow-microsoft-graph-and-azure-function-part-1/)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Microsoft Docs, with Microsoft Graph bindings for Azure Functions: [https://docs.microsoft.com/en-us/azure/azure-functions/functions-bindings-microsoft-graph](https://docs.microsoft.com/en-us/azure/azure-functions/functions-bindings-microsoft-graph)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Microsoft, with an introduction to Azure Functions: [https://docs.microsoft.com/en-us/azure/azure-functions/functions-overview](https://docs.microsoft.com/en-us/azure/azure-functions/functions-overview)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We highly recommend trying to work with these technologies, because they will
    be the future of providing implementation to our customers.
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Working through this chapter, you saw how you can build a rich Azure B2B solution
    with an identity life cycle, including on-premise application access for guests.
    Furthermore, you also had an excellent introduction to the possible use cases
    and gaps. We also provided an overview of the upcoming Identity Governance features
    that Microsoft is developing, and the power that they will bring to the game;
    for example, there is a resource assignment based on roles and associated policies.
  prefs: []
  type: TYPE_NORMAL
- en: In the next chapter, we will deploy single-tenant and multi-tenant applications
    to your environment, and will provide an introduction to these concepts.
  prefs: []
  type: TYPE_NORMAL
