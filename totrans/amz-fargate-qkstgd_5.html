<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Using IAM</h1>
                </header>
            
            <article>
                
<p class="mce-root">Amazon ECS is integrated with, and makes use of, several other AWS services, including Elastic Load Balancing and EC2. ECS makes use of service-linked roles, which are special types of roles associated with a service to provide access to the required AWS services without additional configuration. ECS makes use of the <kbd>AWSServiceRoleForECS</kbd> role to access other AWS services for managing EC2 network interfaces, registering/deregistering instances from a load balancer, and registering targets. A root user does not require any additional configuration to be able to use ECS with Fargate.</p>
<p><strong>Problem: </strong>An IAM user does not have permission to create or modify ECS resources or invoke the ECS API by default. An IAM user also does not have permissions to use the ECS Console or the AWS CLI.</p>
<p><strong>Solution: </strong>An IAM user must be granted permission to create the <kbd>AWSServiceRoleForECS</kbd> role. An IAM policy may be created and associated with an IAM user to grant the requisite permissions to use some of the other AWS services. Some of the AWS services that may be required to run Amazon ECS include:</p>
<ul>
<li>Calls to Amazon ECR to pull Docker images</li>
<li>Calls to CloudWatch Logs to store container logs</li>
</ul>
<p> The <kbd>AmazonECSTaskExecutionRolePolicy</kbd> policy is provided to grant permissions for using the aforementioned ECS services.</p>
<p>Some of the Elastic Load Balancing permissions are not included in the <kbd>AWSServiceRoleForECS</kbd> role and an IAM policy may be required to be added to use Elastic Load Balancing. The <kbd>AmazonEC2ContainerServiceRole</kbd> policy may be used to register/deregister container instances with load balancers. The service auto scaling IAM role (<kbd>ecsAutoscaleRole</kbd>) is required to configure auto scaling. An IAM user must add <kbd>ecsAutoscaleRole</kbd>, which must include the <kbd>AmazonEC2ContainerServiceAutoscaleRole</kbd> policy. To be able to use IAM roles for tasks, the Amazon EC2 Container Service Task Role policy must be added.</p>
<p>The <kbd>AmazonEC2ContainerServiceforEC2Role</kbd> policy is not required with the Fargate launch type, as it is provided for the EC2 launch type only.</p>
<p><span>In this chapter, we will learn about the following:</span></p>
<ul>
<li>Creating an IAM User</li>
<li>Adding a custom policy for Elastic Load Balancing</li>
<li>Logging in as the IAM User</li>
</ul>
<p>The only prerequisite is an AWS account.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating an IAM user</h1>
                </header>
            
            <article>
                
<p>To create an IAM user, log in as the root user and access the IAM Console at <a href="https://console.aws.amazon.com/iam">https://console.aws.amazon.com/iam</a>:</p>
<ul>
<li>Select users in the left-hand menu and click on <span class="packt_screen">Add user</span>, as shown in the following screenshot:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/726b80e5-8c50-43ba-9b6c-bfce325ec8a5.png"/></div>
<ul>
<li>The <span class="packt_screen">Add user</span> wizard gets launched, as shown next. First, specify the <span class="packt_screen">User name</span> (<kbd>dvohra</kbd>).</li>
<li>Select the <span class="packt_screen">AWS Management Console</span> access option, which enables a password that allows the IAM user to log in to the Console:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/5f298732-c3c1-42f8-aa1e-1ea6c0c20ec8.png"/></div>
<ul>
<li>For <span class="packt_screen">Console Password</span>, select the <span class="packt_screen">Custom password</span> option and specify a password in the field provided. Select the <span class="packt_screen">Require password reset</span> option, which requires a user to create a new password at the next login. Users are automatically granted the <kbd>IAMUserChangePassword</kbd> policy, which allows a user to change their password. Click on <span class="packt_screen">Next</span>. </li>
<li>Next, configure permissions. Click on <span class="packt_screen">Attach existing policy directly</span>, as shown here:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/1f932f31-598c-40c1-9c0a-5844dbe829e5.png"/></div>
<ul>
<li>In the <span class="packt_screen">Policy type</span> filter, search for <span class="packt_screen">ECS</span> and select the two policies listed next. <kbd>AmazonECS_FullAccess</kbd> provides administrative access to Amazon ECS resources. <kbd>AmazonECSTaskExecutionRole</kbd> provides access to the other AWS resources that are required by ECS:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/43ac42fa-a6b4-4e05-bf82-12ee8a13e130.png" style="width:44.58em;height:20.83em;"/></div>
<ul>
<li>Search for the <span class="packt_screen">Config</span> in <span class="packt_screen">Policy type</span> filter and select the <span class="packt_screen">AWS Config</span> policies shown next. Click on <span class="packt_screen">Next</span>:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/ff1018ab-a1aa-4842-84a0-2cc50875516f.png" style="width:44.33em;height:20.75em;"/></div>
<p><span>In </span><span class="packt_screen">Review</span><span>, review the </span><span class="packt_screen">Permissions Summary</span><span>, and the </span><span class="packt_screen">IAMUserChangePassword</span><span> </span><span>policy should also be listed. Click on</span><span> </span><span class="packt_screen">Create user</span><span>. An IAM user gets added, as indicated by the</span><span> </span><span class="packt_screen">Success</span><span> </span><span>message. This IAM user gets listed in the users table as shown here. We shall use the IAM user with Amazon Fargate in subsequent chapters:</span></p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/aa0d4a34-2c35-4988-bfb4-34aaaff5f62b.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding a custom policy for Elastic Load Balancing</h1>
                </header>
            
            <article>
                
<p>The ECS policies available and selected do not include some permissions that are required when creating an Elastic Load Balancer for an ECS service. We need to add a custom policy to the IAM user so that the IAM user is able to configure an Elastic Load Balancer. The following custom policy adds all the <kbd>elasticloadbalancing</kbd> permissions:</p>
<pre>{<br/>  "Version": "2012-10-17",<br/>  "Statement":[{<br/>    "Effect": "Allow",<br/>    "Action": ""elasticloadbalancing:*",<br/>    "Resource": "*"<br/>  }]<br/>}</pre>
<p>The custom policy may be added using one of the following options:</p>
<ul>
<li>Create a custom policy prior to creating the user</li>
<li>Add an inline policy after a user has been created</li>
</ul>
<p>We shall discuss the second option: </p>
<ul>
<li>To add the custom policy as an inline policy, click on the IAM user link for IAM user <span class="packt_screen">dvohra</span> (or another user) in the <span class="packt_screen">Users</span> table. The IAM user detail gets displayed.</li>
<li>With the <span class="packt_screen">Permissions</span> tab selected, click on <span class="packt_screen">Add inline policy</span>, as shown in the following screenshot:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/84494607-09cd-4d91-9a06-00bd7e04eeb2.png"/></div>
<ul>
<li>The <span class="packt_screen">Create policy</span> wizard gets started. Select the <span class="packt_screen">JSON</span> tab and copy and paste the custom policy listed earlier, as shown <span>in the following screenshot</span>:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/5c17d330-01ea-40ac-bd39-46a2da756aed.png"/></div>
<ul>
<li>Click on <span class="packt_screen">Review policy</span>. Specify a policy <span class="packt_screen">Name</span>, as shown next.</li>
<li><span>Click on </span><span class="packt_screen">Create policy</span>,<span> as shown in the following screenshot:</span></li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/815e76a1-3c50-446a-8a1a-320490b470bc.png"/></div>
<ul>
<li>The custom policy gets added to the IAM user permissions, as shown <span>in the following screenshot</span>:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/a0c8d8a7-6ab4-4764-bc28-5faef52eda2f.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Logging in as the IAM user</h1>
                </header>
            
            <article>
                
<p>Next, having created an IAM user, log in as the IAM user to use Amazon Fargate:</p>
<ul>
<li>To be able to log in as the IAM user just created, first <span class="packt_screen">Sign Out</span> as the root user:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/66f7b9e2-44c3-4fac-a3ed-560615cb96ab.png"/></div>
<ul>
<li>To sign in to the Console, copy the <span class="packt_screen">Console login link</span> <span class="packt_screen">https://123456789.signin.aws.amazon.com/console</span>, which would be different for different users, as shown here. The link listed is just an example link and cannot be used to log in:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/a0a0dbce-e019-443a-89af-2d88dc32f20e.png" style="width:42.33em;height:21.92em;"/></div>
<ul>
<li>Open a web browser with the Console login link. The Account ID is pre-specified in the login form (not shown in following screenshot). Specify the IAM user name and password and click on <span class="packt_screen">Sign In</span>, as shown in the following screenshot:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/0067302d-2627-4aaa-9274-90e80965b1ad.png" style="width:16.92em;height:19.75em;"/></div>
<ul>
<li>Next, the form to change the password is provided. Because the option to change the password at first login was selected, the IAM user must configure a new password. Click on <span class="packt_screen">Confirm password change</span>. The IAM user gets logged in as shown in the following screenshot.</li>
<li>Select the <span class="packt_screen">Elastic Container Service</span> to create an ECS service, as shown in the following screenshot:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/75db2f4a-5057-4621-b6dd-19278cc31969.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we discussed configuring an IAM user for ECS. The root user does not require any permission configurations and has access to the ECS resources, ECS Console, ECS API, and all the required AWS services. If an IAM user is to be used with ECS, the required IAM policies must be added to the IAM user. To use ECS with Elastic Load Balancing, a custom policy must be added. In the next chapter, we shall discuss using an application load balancer with Fargate.</p>


            </article>

            
        </section>
    </body></html>