<html><head></head><body>
  <div id="_idContainer044">
   <h1 class="chapter-number" id="_idParaDest-45">
    <a id="_idTextAnchor089">
    </a>
    <span class="koboSpan" id="kobo.1.1">
     2
    </span>
   </h1>
   <h1 id="_idParaDest-46">
    <a id="_idTextAnchor090">
    </a>
    <span class="koboSpan" id="kobo.2.1">
     Kicking Off the OpenStack Setup – The Right Way (DevSecOps)
    </span>
   </h1>
   <p class="author-quote">
    <span class="koboSpan" id="kobo.3.1">
     “In the middle of difficulty lies opportunity.”
    </span>
   </p>
   <p class="author-quote">
    <span class="koboSpan" id="kobo.4.1">
     – Albert Einstein
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.5.1">
     The OpenStack ecosystem, as discussed in the previous chapter, presents a vast array of design patterns, coupled with choices of hardware and tools to deploy a robust private cloud setup.
    </span>
    <span class="koboSpan" id="kobo.5.2">
     With the Antelope release, there have been no significant changes to the core architecture system, but a few parts have been updated, with some additions and features.
    </span>
    <span class="koboSpan" id="kobo.5.3">
     But that comes with the cost of increased complexity  when it comes to the deployment and operation stages.
    </span>
    <span class="koboSpan" id="kobo.5.4">
     The good news is that the OpenStack community, since its earliest releases, has created different approaches to avoid an arduous OpenStack operation experience.
    </span>
    <span class="koboSpan" id="kobo.5.5">
     The key mechanism for this task is
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.6.1">
      automation
     </span>
    </em>
    <span class="koboSpan" id="kobo.7.1">
     .
    </span>
    <span class="koboSpan" id="kobo.7.2">
     There is, without a doubt, a high risk of getting into endless troubleshooting if the automation craft is overlooked.
    </span>
    <span class="koboSpan" id="kobo.7.3">
     There are several tools maintained by vendors such as Puppet, Ansible, Chef, and a few others that are used in thousands of production deployments.
    </span>
    <span class="koboSpan" id="kobo.7.4">
     To get an OpenStack setup up and running is not the goal of the journey but, rather, the deployment journey itself.
    </span>
    <span class="koboSpan" id="kobo.7.5">
     That is where we will take advantage of automation and agile tools to bring the OpenStack operation to the next level, by adopting a DevOps path.
    </span>
    <span class="koboSpan" id="kobo.7.6">
     Although that sounds like an amazing step toward a robust deployment process, it is still not complete without incubating security aspects from the early days of the deployment.
    </span>
    <span class="koboSpan" id="kobo.7.7">
     Developing and operating the infrastructure process should be reimagined, from a DevOps picture to a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.8.1">
      DevSecOps one.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.9.1">
     This chapter presents the backbone of the future deployment and operational processes for an OpenStack private cloud setup by covering the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.10.1">
      following topics:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.11.1">
      Revisiting the DevOps philosophy behind the OpenStack deployment
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.12.1">
       life cycle
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.13.1">
      Rethinking DevOps and introducing DevSecOps to see how it fits into
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.14.1">
       our journey
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.15.1">
      Discovering a modern approach to deploying OpenStack
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.16.1">
       in containers
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.17.1">
      Iterating through automation tools and preparing
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.18.1">
       for deployment
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.19.1">
      Running a first iteration of an OpenStack deployment via Continuous Integration/Continuous Delivery (
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.20.1">
       CI/CD) tools
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.21.1">
      Preparing for a large-scale deployment via code and Continuous Integration/Continuous Delivery (
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.22.1">
       CI/CD) pipelines
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.23.1">
      Integrating security checks in each deployment step in an
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.24.1">
       automated fashion
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-47">
    <a id="_idTextAnchor091">
    </a>
    <span class="koboSpan" id="kobo.25.1">
     Removing silos – DevOps
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.26.1">
     The term
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.27.1">
      DevOps
     </span>
    </strong>
    <span class="koboSpan" id="kobo.28.1">
     has been popping up for almost
    </span>
    <a id="_idIndexMarker161">
    </a>
    <span class="koboSpan" id="kobo.29.1">
     a decade, pushing organizations to rethink how to structure their internal teams to achieve what DevOps promises.
    </span>
    <span class="koboSpan" id="kobo.29.2">
     Dozens of definitions of the word
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.30.1">
      DevOps
     </span>
    </em>
    <span class="koboSpan" id="kobo.31.1">
     can be found everywhere, but it can simply be summarized as a
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.32.1">
      silo remover
     </span>
    </em>
    <span class="koboSpan" id="kobo.33.1">
     .
    </span>
    <span class="koboSpan" id="kobo.33.2">
     DevOps comes with the philosophy of bringing the main software product’s direct contributors to the same table, including operations, testers, and developers.
    </span>
    <span class="koboSpan" id="kobo.33.3">
     The aim of this movement is based on a few principles that motivate organizations to implement them practically – knowledge and responsibility sharing, respect, automating everything, monitoring continuously, embracing failure, and designing for reusability.
    </span>
    <span class="koboSpan" id="kobo.33.4">
     However, DevOps has never been a tool or software but, rather, a set of principles that define processes and workflows to boost a company’s productivity.
    </span>
    <span class="koboSpan" id="kobo.33.5">
     What makes this movement shine takes us back to the simple definition –
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.34.1">
      silo remover
     </span>
    </em>
    <span class="koboSpan" id="kobo.35.1">
     .
    </span>
    <span class="koboSpan" id="kobo.35.2">
     As operations and developers are not hindered by the wall sitting between them, more collaboration and knowledge are shared toward the same goal – decreasing the time to market with the highest possible quality and degree of efficiency.
    </span>
    <span class="koboSpan" id="kobo.35.3">
     Without the existence of many tools, reflecting this idea in real life would be more difficult.
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.36.1">
      Continuous Integration
     </span>
    </strong>
    <span class="koboSpan" id="kobo.37.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.38.1">
      CI
     </span>
    </strong>
    <span class="koboSpan" id="kobo.39.1">
     ) and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.40.1">
      Continuous Delivery
     </span>
    </strong>
    <span class="koboSpan" id="kobo.41.1">
     or
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.42.1">
      Deployment
     </span>
    </strong>
    <span class="koboSpan" id="kobo.43.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.44.1">
      CD
     </span>
    </strong>
    <span class="koboSpan" id="kobo.45.1">
     ) tools are examples that have contributed
    </span>
    <a id="_idIndexMarker162">
    </a>
    <span class="koboSpan" id="kobo.46.1">
     immensely
    </span>
    <a id="_idIndexMarker163">
    </a>
    <span class="koboSpan" id="kobo.47.1">
     to reflecting
    </span>
    <a id="_idIndexMarker164">
    </a>
    <span class="koboSpan" id="kobo.48.1">
     that idea.
    </span>
    <span class="koboSpan" id="kobo.48.2">
     Another set of tools that gives more trust to machines than to humans is the concept of
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.49.1">
      automation
     </span>
    </em>
    <span class="koboSpan" id="kobo.50.1">
     .
    </span>
    <span class="koboSpan" id="kobo.50.2">
     CI/CD tools leave all the manual and routine build, testing, and deployment stages to a few pipelines running on a server.
    </span>
    <span class="koboSpan" id="kobo.50.3">
     Meanwhile, teams focus on more interesting tasks with higher business values.
    </span>
    <span class="koboSpan" id="kobo.50.4">
     The rise of the cloud era has brought another giant set of opportunities to accelerate the software
    </span>
    <a id="_idIndexMarker165">
    </a>
    <span class="koboSpan" id="kobo.51.1">
     development cycle with automation –
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.52.1">
      infrastructure automation
     </span>
    </strong>
    <span class="koboSpan" id="kobo.53.1">
     .
    </span>
    <span class="koboSpan" id="kobo.53.2">
     This is one of the areas that OpenStack focuses on with some
    </span>
    <a id="_idIndexMarker166">
    </a>
    <span class="koboSpan" id="kobo.54.1">
     of its services, such as
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.55.1">
      Heat
     </span>
    </strong>
    <span class="koboSpan" id="kobo.56.1">
     .
    </span>
    <span class="koboSpan" id="kobo.56.2">
     Treating
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.57.1">
      Infrastructure as Code
     </span>
    </strong>
    <span class="koboSpan" id="kobo.58.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.59.1">
      IaC
     </span>
    </strong>
    <span class="koboSpan" id="kobo.60.1">
     ) inspires the gathered teams, Dev and Ops, to bring
    </span>
    <a id="_idIndexMarker167">
    </a>
    <span class="koboSpan" id="kobo.61.1">
     knowledge from the traditional software development life cycle and apply it at the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.62.1">
      infrastructure level.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.63.1">
     It is no longer a case of
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.64.1">
      that is not my business
     </span>
    </em>
    <span class="koboSpan" id="kobo.65.1">
     but, rather,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.66.1">
      it is my business too
     </span>
    </em>
    <span class="koboSpan" id="kobo.67.1">
     .
    </span>
    <span class="koboSpan" id="kobo.67.2">
     What really matters is focusing
    </span>
    <a id="_idIndexMarker168">
    </a>
    <span class="koboSpan" id="kobo.68.1">
     on the delivery of business products in a reasonably reduced amount of time, getting to market faster, and not missing out on a race with the competition.
    </span>
    <span class="koboSpan" id="kobo.68.2">
     This can be summarized with a DevOps toolchain for different software deployments across the Dev and Ops stages, as shown in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.69.1">
      following diagram:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer024">
     <span class="koboSpan" id="kobo.70.1">
      <img alt="Figure 2.1 – The DevOps toolchain" src="image/B21716_02_01.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.71.1">
     Figure 2.1 – The DevOps toolchain
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.72.1">
     By adopting the same philosophy, we will deploy our OpenStack private cloud.
    </span>
    <span class="koboSpan" id="kobo.72.2">
     But before reaching that stage, we need to acknowledge an important fact – there is no rule of thumb when it comes to applying what DevOps dictates.
    </span>
    <span class="koboSpan" id="kobo.72.3">
     The structure of teams in organizations may differ, and IT disciplines can be in several dedicated pods per function or merged into one.
    </span>
    <span class="koboSpan" id="kobo.72.4">
     The pursuit of
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.73.1">
      DevOps happiness
     </span>
    </em>
    <span class="koboSpan" id="kobo.74.1">
     can be confusing if an organization does not assign and refactor its team’s structure, seek out subject matter experts, have cross-functional team members based on specialized knowledge, and so on.
    </span>
    <span class="koboSpan" id="kobo.74.2">
     Some of these issues have revealed obstacles, due to the gaps left in terms of security and compliance.
    </span>
    <span class="koboSpan" id="kobo.74.3">
     This is what we will uncover
    </span>
    <a id="_idIndexMarker169">
    </a>
    <span class="koboSpan" id="kobo.75.1">
     in the following section before bringing the pieces of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.76.1">
      OpenStack together.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-48">
    <a id="_idTextAnchor092">
    </a>
    <span class="koboSpan" id="kobo.77.1">
     Shifting to the left – DevSecOps
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.78.1">
     The
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.79.1">
      billion-dollar
     </span>
    </em>
    <span class="koboSpan" id="kobo.80.1">
     idea of the DevOps
    </span>
    <a id="_idIndexMarker170">
    </a>
    <span class="koboSpan" id="kobo.81.1">
     philosophy is to bring people
    </span>
    <a id="_idIndexMarker171">
    </a>
    <span class="koboSpan" id="kobo.82.1">
     together – all disciplines, including Ops, Devs, and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.83.1">
      Quality Assurance
     </span>
    </strong>
    <span class="koboSpan" id="kobo.84.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.85.1">
      QA
     </span>
    </strong>
    <span class="koboSpan" id="kobo.86.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.86.2">
     Organizations should make it clear where silos are raised among all product contributors.
    </span>
    <span class="koboSpan" id="kobo.86.3">
     That should include the security discipline in their agile ways of working.
    </span>
    <span class="koboSpan" id="kobo.86.4">
     The
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.87.1">
      2021 State of DevSecOps
     </span>
    </em>
    <span class="koboSpan" id="kobo.88.1">
     study (
    </span>
    <a href="https://www.securitycompass.com/reports/2021-state-of-devsecops/">
     <span class="koboSpan" id="kobo.89.1">
      https://www.securitycompass.com/reports/2021-state-of-devsecops/
     </span>
    </a>
    <span class="koboSpan" id="kobo.90.1">
     ) elaborated by
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.91.1">
      Security Compass
     </span>
    </em>
    <span class="koboSpan" id="kobo.92.1">
     , a cybersecurity consultancy services provider, shows that 75% of responders (IT professionals and DevOps practitioners) agreed that security slows down the processes of product releases, leading to an increase in the time to market.
    </span>
    <span class="koboSpan" id="kobo.92.2">
     That goes against what DevOps was created for.
    </span>
    <span class="koboSpan" id="kobo.92.3">
     Focusing on speed to market might skip the security aspect.
    </span>
    <span class="koboSpan" id="kobo.92.4">
     This
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.93.1">
      sacrifice
     </span>
    </em>
    <span class="koboSpan" id="kobo.94.1">
     has triggered some scary numbers in some large enterprises, where there was an increase in the volume of data breaches or the number of cybersecurity attacks.
    </span>
    <span class="koboSpan" id="kobo.94.2">
     Treating security as something to act upon reactively instead of proactively can cost in terms of budget and time for each security incident.
    </span>
    <span class="koboSpan" id="kobo.94.3">
     There are a few chief reasons that capture the root cause of why cybersecurity and DevOps are left in two different silos – more manual security intervention during the development process and a lack of knowledge of tools.
    </span>
    <span class="koboSpan" id="kobo.94.4">
     Investing in security is required to comply with standards and gain trust.
    </span>
    <span class="koboSpan" id="kobo.94.5">
     Sacrificing that for speed to market will certainly lead to major losses later on.
    </span>
    <span class="koboSpan" id="kobo.94.6">
     That leads us to the next bridge that needs to be built between DevOps and security, forming a DevSecOps alliance.
    </span>
    <span class="koboSpan" id="kobo.94.7">
     In the same way that Dev and Ops merged, security should no longer be considered an afterthought.
    </span>
    <span class="koboSpan" id="kobo.94.8">
     DevOps principles can be inherited to make a security fusion possible.
    </span>
    <span class="koboSpan" id="kobo.94.9">
     That is how DevSecOps has become a new trend.
    </span>
    <span class="koboSpan" id="kobo.94.10">
     Imagine the whole pressure of security eased across each discipline and pointing to the same product goal, armed with automation and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.95.1">
      faster feedback.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.96.1">
     We can sum up the right approach for our future OpenStack deployments – DevOps with security at different stages of the process, as shown in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.97.1">
      following toolchain.
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer025">
     <span class="koboSpan" id="kobo.98.1">
      <img alt="Figure 2.2 – Integrating security into the DevOps toolchain" src="image/B21716_02_02.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.99.1">
     Figure 2.2 – Integrating security into the DevOps toolchain
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.100.1">
     Embracing the deployment
    </span>
    <a id="_idIndexMarker172">
    </a>
    <span class="koboSpan" id="kobo.101.1">
     of a complex environment such as an OpenStack private cloud would require a DevSecOps approach, and a few best practices are covered in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.102.1">
      next section.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-49">
    <a id="_idTextAnchor093">
    </a>
    <span class="koboSpan" id="kobo.103.1">
     Securing the cloud – moving with DevSecOps
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.104.1">
     Adopting DevOps practices
    </span>
    <a id="_idIndexMarker173">
    </a>
    <span class="koboSpan" id="kobo.105.1">
     is definitely a big deal
    </span>
    <a id="_idIndexMarker174">
    </a>
    <span class="koboSpan" id="kobo.106.1">
     to stay competitive in the market, increase productivity, and bring new possibilities for innovation.
    </span>
    <span class="koboSpan" id="kobo.106.2">
     Conversely, with a lack of security, any product will be at risk of losing both trust and failure.
    </span>
    <span class="koboSpan" id="kobo.106.3">
     Hence, the DevOps chain must be enforced with security and compliance insurance.
    </span>
    <span class="koboSpan" id="kobo.106.4">
     One of the fundamental aspects of DevOps is automation and reusability.
    </span>
    <span class="koboSpan" id="kobo.106.5">
     In an infrastructure context, we are not dealing with
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.107.1">
      pets
     </span>
    </em>
    <span class="koboSpan" id="kobo.108.1">
     but with
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.109.1">
      cattle
     </span>
    </em>
    <span class="koboSpan" id="kobo.110.1">
     .
    </span>
    <span class="koboSpan" id="kobo.110.2">
     The
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.111.1">
      pets and cattle
     </span>
    </em>
    <span class="koboSpan" id="kobo.112.1">
     analogy is a famous
    </span>
    <a id="_idIndexMarker175">
    </a>
    <span class="koboSpan" id="kobo.113.1">
     one, with on-prem servers referred to as
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.114.1">
      pets
     </span>
    </em>
    <span class="koboSpan" id="kobo.115.1">
     .
    </span>
    <span class="koboSpan" id="kobo.115.2">
     If there was any change, update, or failure of that pet server, a problem would arise.
    </span>
    <span class="koboSpan" id="kobo.115.3">
     They are the long-lived and indispensable pieces of the infrastructure that should be taken more care of.
    </span>
    <span class="koboSpan" id="kobo.115.4">
     On the other side of the analogy,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.116.1">
      cattle
     </span>
    </em>
    <span class="koboSpan" id="kobo.117.1">
     refer to servers in large on-demand environments such as the cloud.
    </span>
    <span class="koboSpan" id="kobo.117.2">
     A cattle failure should not stop the business from running, and cattle can be replaced
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.118.1">
      immediately
     </span>
    </em>
    <span class="koboSpan" id="kobo.119.1">
     .
    </span>
    <span class="koboSpan" id="kobo.119.2">
     If we adopt the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.120.1">
      cattle
     </span>
    </em>
    <span class="koboSpan" id="kobo.121.1">
     analogy servers in the cloud should be instrumented to keep them immutable.
    </span>
    <span class="koboSpan" id="kobo.121.2">
     That is where IaC comes into play.
    </span>
    <span class="koboSpan" id="kobo.121.3">
     With one single source of truth and a shared pipeline, the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.122.1">
      Sec
     </span>
    </em>
    <span class="koboSpan" id="kobo.123.1">
     part
    </span>
    <a id="_idIndexMarker176">
    </a>
    <span class="koboSpan" id="kobo.124.1">
     becomes much easier
    </span>
    <a id="_idIndexMarker177">
    </a>
    <span class="koboSpan" id="kobo.125.1">
     to merge into the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.126.1">
      DevOps
     </span>
    </em>
    <span class="koboSpan" id="kobo.127.1">
     flow.
    </span>
    <span class="koboSpan" id="kobo.127.2">
     With this capability, moving security from the right to the left becomes
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.128.1">
      more feasible.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-50">
    <a id="_idTextAnchor094">
    </a>
    <span class="koboSpan" id="kobo.129.1">
     DevSecOps and OpenStack
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.130.1">
     The challenge of deploying
    </span>
    <a id="_idIndexMarker178">
    </a>
    <span class="koboSpan" id="kobo.131.1">
     a complex OpenStack ecosystem
    </span>
    <a id="_idIndexMarker179">
    </a>
    <span class="koboSpan" id="kobo.132.1">
     is made easier through DevOps, but what should not be overlooked as a cloud provider is protecting the first layer that runs a user’s workload(s).
    </span>
    <span class="koboSpan" id="kobo.132.2">
     As we will explore in the next part of this section, there are several ways to deploy a complete OpenStack environment from code.
    </span>
    <span class="koboSpan" id="kobo.132.3">
     Emphasizing security before starting to think about the code structure is vital to not miss a DevSecOps opportunity.
    </span>
    <span class="koboSpan" id="kobo.132.4">
     As a rule of thumb, any code designed for an application infrastructure is subject to vulnerabilities.
    </span>
    <span class="koboSpan" id="kobo.132.5">
     Although the different modules of OpenStack services are developed with security in mind, the gazillions of ways of configuring and parameterizing within a specific network architecture should be tested for security anomalies at every stage.
    </span>
    <span class="koboSpan" id="kobo.132.6">
     Before welcoming any workload on top of the OpenStack infrastructure, the cloud itself must be ready with security controls and compliant with
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.133.1">
      major standards.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-51">
    <a id="_idTextAnchor095">
    </a>
    <span class="koboSpan" id="kobo.134.1">
     Coding the cloud
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.135.1">
     One of the biggest challenges
    </span>
    <a id="_idIndexMarker180">
    </a>
    <span class="koboSpan" id="kobo.136.1">
     of dealing with an OpenStack environment is the ways of handling its deployment and daily operations.
    </span>
    <span class="koboSpan" id="kobo.136.2">
     If you consider a manual deployment for even a small environment, then in all likelihood, your OpenStack management processes, including updates, will face difficulties that cannot be avoided.
    </span>
    <span class="koboSpan" id="kobo.136.3">
     That is where DevSecOps practices come in, with the fundamental mantra of IaC.
    </span>
    <span class="koboSpan" id="kobo.136.4">
     A consistent approach is to treat the OpenStack ecosystem as code.
    </span>
    <span class="koboSpan" id="kobo.136.5">
     The good news is that OpenStack code is provided with each stable release and is ready for deployment once configured and customized.
    </span>
    <span class="koboSpan" id="kobo.136.6">
     But before we grasp a technical deployment, we should take into account a few common considerations
    </span>
    <a id="_idIndexMarker181">
    </a>
    <span class="koboSpan" id="kobo.137.1">
     to start building
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.138.1">
      our toolchain:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.139.1">
      Map each OpenStack service as code
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.140.1">
       per module.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.141.1">
      Define target systems to run OpenStack services with one specific role or several roles.
     </span>
     <span class="koboSpan" id="kobo.141.2">
      For example, a compute role is defined with the Nova
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.142.1">
       service deployed.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.143.1">
      Draft the initial configuration for each
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.144.1">
       service (role).
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.145.1">
      Think of roles as reusable code that can be deployed in different
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.146.1">
       target environments.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.147.1">
      Make sure you integrate functional test stages between
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.148.1">
       role setups.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.149.1">
      Consider the integration of security rules and tools from the start.
     </span>
     <span class="koboSpan" id="kobo.149.2">
      Map each nominated tool in each stage of the pipeline, from coding to the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.150.1">
       release phases.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.151.1">
      Avoid
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.152.1">
       Big Bang
      </span>
     </em>
     <span class="koboSpan" id="kobo.153.1">
      coding practices
     </span>
     <a id="_idIndexMarker182">
     </a>
     <span class="koboSpan" id="kobo.154.1">
      and implement smaller changes in an automated continuous
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.155.1">
       deployment fashion.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.156.1">
      Prepare to continuously monitor the following
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.157.1">
       deployment metrics:
      </span>
     </span>
     <ul>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.158.1">
         Deployment frequency
        </span>
       </strong>
       <span class="koboSpan" id="kobo.159.1">
        : How often IaC is
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.160.1">
         deployed (daily/weekly/monthly)
        </span>
       </span>
      </li>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.161.1">
         Change lead time
        </span>
       </strong>
       <span class="koboSpan" id="kobo.162.1">
        : The window of time  starting from the moment code has been committed to the time it is
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.163.1">
         successfully deployed
        </span>
       </span>
      </li>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.164.1">
         Change failure rate
        </span>
       </strong>
       <span class="koboSpan" id="kobo.165.1">
        : The total percentage of committed IaC changes leading to system impairment or outage (including hotfixes
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.166.1">
         and rollbacks)
        </span>
       </span>
      </li>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.167.1">
         Mean Time to Repair
        </span>
       </strong>
       <span class="koboSpan" id="kobo.168.1">
        (
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.169.1">
         MTTR
        </span>
       </strong>
       <span class="koboSpan" id="kobo.170.1">
        ): The time needed to restore service
       </span>
       <a id="_idIndexMarker183">
       </a>
       <span class="koboSpan" id="kobo.171.1">
        outage from the moment
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.172.1">
         it’s impaired
        </span>
       </span>
      </li>
     </ul>
    </li>
    <li>
     <span class="koboSpan" id="kobo.173.1">
      Use a trunk-based development approach to facilitate code monitor changes and increase security
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.174.1">
       visibility integration.
      </span>
     </span>
    </li>
   </ul>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.175.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.176.1">
     Trunk-based software development
    </span>
    <a id="_idIndexMarker184">
    </a>
    <span class="koboSpan" id="kobo.177.1">
     is a coding practice that allows developers to regularly merge changes into a common trunk code base.
    </span>
    <span class="koboSpan" id="kobo.177.2">
     The trunk-based practice dictates more frequent code releases with
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.178.1">
      smaller changes.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.179.1">
     The following section will cover the different tools that will be used to deploy an OpenStack environment in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.180.1">
      DevSecOps style.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-52">
    <a id="_idTextAnchor096">
    </a>
    <span class="koboSpan" id="kobo.181.1">
     Deploying in the cloud
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.182.1">
     Since the first release
    </span>
    <a id="_idIndexMarker185">
    </a>
    <span class="koboSpan" id="kobo.183.1">
     of OpenStack, several deployment tools and wrappers have been developed to assist OpenStack operators with more enhanced, easier ways to set up a fully running OpenStack environment.
    </span>
    <span class="koboSpan" id="kobo.183.2">
     With the rise of system management tools such as Chef, Puppet, SaltStack, and Ansible, the OpenStack community has dedicated different channels to each system management tool to develop different classes and modules through the OpenStack ecosystem evolution.
    </span>
    <span class="koboSpan" id="kobo.183.3">
     Which one of these tools we choose is down to familiarity or the technical requirements of cloud operators.
    </span>
    <span class="koboSpan" id="kobo.183.4">
     In this section, Ansible will be the system management tool
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.184.1">
      we use.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-53">
    <a id="_idTextAnchor097">
    </a>
    <span class="koboSpan" id="kobo.185.1">
     Ansible in a nutshell
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.186.1">
     Like any other system management
    </span>
    <a id="_idIndexMarker186">
    </a>
    <span class="koboSpan" id="kobo.187.1">
     tool, Ansible uses its own glossary and terms to define infrastructure components, modules, relationships, and parameters.
    </span>
    <span class="koboSpan" id="kobo.187.2">
     Conversely, unlike other tools, Ansible comes with a simple architecture setup that makes it a popular choice, and it can be summarized
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.188.1">
      as follows:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.189.1">
      It has the flexibility to handle interdependent complex
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.190.1">
       service modules.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.191.1">
      It uses an agentless transport mechanism to connect and update target systems without the need to install additional packages.
     </span>
     <span class="koboSpan" id="kobo.191.2">
      It exposes only the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.192.1">
       master
      </span>
     </em>
     <span class="koboSpan" id="kobo.193.1">
      server where the Ansible software
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.194.1">
       is running.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.195.1">
      Modules executed on target systems are auto-cleaned
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.196.1">
       once installed.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.197.1">
      It is rich in core automation modules to extend
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.198.1">
       more features.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.199.1">
      The infrastructure collection code written in YAML is organized in Ansible playbooks.
     </span>
     <span class="koboSpan" id="kobo.199.2">
      YAML is easier to learn and master than other languages, such as Ruby
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.200.1">
       for Chef.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.201.1">
      Due to the simplicity of the Ansible architecture, scalability is much simpler to implement compared to other tools that require
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.202.1">
       running agents.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.203.1">
      As a declarative method of programming, it focuses on describing the output of the desired state, rather than diving into how to do it and which steps must be taken to reach
     </span>
     <a id="_idIndexMarker187">
     </a>
     <span class="koboSpan" id="kobo.204.1">
      the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.205.1">
       resulting output.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.206.1">
     When dealing with the complexity of the OpenStack ecosystem, with all its sets of components, subcomponents, and parameter flavors, it is essential to briefly skim the surface of the Ansible
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.207.1">
      terminology :
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.208.1">
       Playbooks
      </span>
     </strong>
     <span class="koboSpan" id="kobo.209.1">
      : These consist of the main configuration
     </span>
     <a id="_idIndexMarker188">
     </a>
     <span class="koboSpan" id="kobo.210.1">
      file(s) that describes a series of actions to run on one or a group of hosts.
     </span>
     <span class="koboSpan" id="kobo.210.2">
      The tasks are written in YAML and executed in order, from top to bottom, to accomplish full deployment or a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.211.1">
       configuration change.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.212.1">
       Roles
      </span>
     </strong>
     <span class="koboSpan" id="kobo.213.1">
      : These present the organizational
     </span>
     <a id="_idIndexMarker189">
     </a>
     <span class="koboSpan" id="kobo.214.1">
      structure of playbooks by collecting different Ansible assets, such as tasks, variables, and modules, to deploy a service on one or a group
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.215.1">
       of hosts.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.216.1">
       Modules
      </span>
     </strong>
     <span class="koboSpan" id="kobo.217.1">
      : These are an abstract representation
     </span>
     <a id="_idIndexMarker190">
     </a>
     <span class="koboSpan" id="kobo.218.1">
      of a specific unit of code functionality.
     </span>
     <span class="koboSpan" id="kobo.218.2">
      Modules can be written and customized to control system resources, files, and services.
     </span>
     <span class="koboSpan" id="kobo.218.3">
      Ansible is shipped with some
     </span>
     <a id="_idIndexMarker191">
     </a>
     <span class="koboSpan" id="kobo.219.1">
      modules referred to as module libraries (core modules) that can be executed via
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.220.1">
       customized playbooks.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.221.1">
       Variables
      </span>
     </strong>
     <span class="koboSpan" id="kobo.222.1">
      : These are dynamic values used in roles
     </span>
     <a id="_idIndexMarker192">
     </a>
     <span class="koboSpan" id="kobo.223.1">
      and playbooks to reflect the desired configuration.
     </span>
     <span class="koboSpan" id="kobo.223.2">
      Similar to programming language variables, Ansible variables enable the propagation of different states across different environments through the same role
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.224.1">
       or playbook.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.225.1">
       Inventory
      </span>
     </strong>
     <span class="koboSpan" id="kobo.226.1">
      : This is a listing of managed hosts
     </span>
     <a id="_idIndexMarker193">
     </a>
     <span class="koboSpan" id="kobo.227.1">
      in the target environment.
     </span>
     <span class="koboSpan" id="kobo.227.2">
      Ansible uses a configuration file in the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.228.1">
       INI
      </span>
     </strong>
     <span class="koboSpan" id="kobo.229.1">
      format, which defines the name and IP of the managed target host.
     </span>
     <span class="koboSpan" id="kobo.229.2">
      Hosts can be declared in inventory files using different patterns by nesting hosts by role, or by specifying a series of hosts via a combination and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.230.1">
       numeric patterns.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.231.1">
     The CI/CD system triggers Ansible to install and run playbooks across target OpenStack nodes defined in its inventory, as depicted in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.232.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer026">
     <span class="koboSpan" id="kobo.233.1">
      <img alt="Figure 2.3 – An OpenStack environment management through Ansible" src="image/B21716_02_03.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.234.1">
     Figure 2.3 – An OpenStack environment management through Ansible
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.235.1">
     Integrating system management
    </span>
    <a id="_idIndexMarker194">
    </a>
    <span class="koboSpan" id="kobo.236.1">
     tools such as Ansible in OpenStack ecosystem life cycle management has introduced a significant change in the way such a complex ecosystem is managed and operated.
    </span>
    <span class="koboSpan" id="kobo.236.2">
     Not surprisingly, the hunger to move quickly to adopt a private cloud setup and maximize the agility of its deployment has led to other challenges.
    </span>
    <span class="koboSpan" id="kobo.236.3">
     That brings us to the root causes of OpenStack-tied dependencies between services.
    </span>
    <span class="koboSpan" id="kobo.236.4">
     Thinking long term, the development of new OpenStack releases and feature integrations in an existing environment presents one of the ultimate challenges for a private cloud operation mission.
    </span>
    <span class="koboSpan" id="kobo.236.5">
     Driving major upgrades has always been a blocker to seamlessly jumping to a new OpenStack release in a running production setup.
    </span>
    <span class="koboSpan" id="kobo.236.6">
     That makes the upgrade case a very cautious operation and puts your
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.237.1">
      Service-Level Agreement
     </span>
    </strong>
    <span class="koboSpan" id="kobo.238.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.239.1">
      SLA
     </span>
    </strong>
    <span class="koboSpan" id="kobo.240.1">
     ) at risk if one or several dependencies
    </span>
    <a id="_idIndexMarker195">
    </a>
    <span class="koboSpan" id="kobo.241.1">
     crash, due to a code compatibility version that has been overlooked.
    </span>
    <span class="koboSpan" id="kobo.241.2">
     Although tests can help to identify such anomalies, a massive number of tests for each component should be in place in advance, and that could be costly in terms of resources and human interactions.
    </span>
    <span class="koboSpan" id="kobo.241.3">
     The other facet of these challenges is the lack of rollback mechanisms.
    </span>
    <span class="koboSpan" id="kobo.241.4">
     Rolling back a change that causes an issue will definitely bring one or several parts of a whole system down, as you wait for your management tools to redeploy, restart the affected services, and test and wait for a complete synchronization between other dependent services to run them again.
    </span>
    <span class="koboSpan" id="kobo.241.5">
     The most common OpenStack deployment options involve bare-metal machines or virtual machines, making such operational tasks heavier to roll, requiring full management of machine images, and it becomes costly when testing in an isolated environment.
    </span>
    <span class="koboSpan" id="kobo.241.6">
     For example, upgrading or updating an OpenStack component version would require all inter-dependent services to be deployed in a different testing environment before propagating the change in the production one.
    </span>
    <span class="koboSpan" id="kobo.241.7">
     Within the latest OpenStack releases, several organizations have been experimenting with the rise of containers for a fully containerized OpenStack
    </span>
    <a id="_idIndexMarker196">
    </a>
    <span class="koboSpan" id="kobo.242.1">
     cloud.
    </span>
    <span class="koboSpan" id="kobo.242.2">
     Let’s unleash the container dilemma in the next section and explore what opportunities are in store for OpenStack deployment
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.243.1">
      and management.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-54">
    <a id="_idTextAnchor098">
    </a>
    <span class="koboSpan" id="kobo.244.1">
     Containerizing the cloud
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.245.1">
     Container technology has been around
    </span>
    <a id="_idIndexMarker197">
    </a>
    <span class="koboSpan" id="kobo.246.1">
     for more than a decade, and companies have started deploying their workloads in containers to take advantage of resource optimization, environment isolation, and portability.
    </span>
    <span class="koboSpan" id="kobo.246.2">
     Running different pieces of your software in lightweight, self-contained, and independent containers brings more flexibility to managing a complex software system.
    </span>
    <span class="koboSpan" id="kobo.246.3">
     Running in an isolated mode, operations such as upgrades and rolling back become much easier and can be performed with
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.247.1">
      more confidence.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.248.1">
     By referring to our infrastructure code, we can see the benefit of the OpenStack software architecture’s modular design, which offers a great deal by taking advantage of container technology, where each module can live in a separate, stateless environment.
    </span>
    <span class="koboSpan" id="kobo.248.2">
     Looking at the current state of container trends, an extended list of container and orchestration engines can be found, such as LXC, Docker, and Kubernetes.
    </span>
    <span class="koboSpan" id="kobo.248.3">
     The OpenStack community did not miss the chance to adopt containerization technology early on, when containers started to become the standard for modern software development.
    </span>
    <span class="koboSpan" id="kobo.248.4">
     Within the Antelope and later releases, we can find several deployment methods based on containers, combined with configuration management tools, as summarized in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.249.1">
      following table:
     </span>
    </span>
   </p>
   <table class="No-Table-Style _idGenTablePara-1" id="table001-2">
    <colgroup>
     <col/>
     <col/>
     <col/>
     <col/>
    </colgroup>
    <tbody>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.250.1">
           Deployment project
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.251.1">
           Container
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.252.1">
           Project
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.253.1">
           Source
          </span>
         </strong>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.254.1">
          OpenStack-Ansible
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.255.1">
          LXC
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.256.1">
          Ansible
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <a href="https://docs.openstack.org/openstack-ansible/latest/">
         <span class="No-Break">
          <span class="koboSpan" id="kobo.257.1">
           https://docs.openstack.org/openstack-ansible/latest/
          </span>
         </span>
        </a>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.258.1">
          Kolla-Ansible
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.259.1">
          Docker
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.260.1">
          Ansible
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <a href="https://docs.openstack.org/kolla-ansible/latest/">
         <span class="No-Break">
          <span class="koboSpan" id="kobo.261.1">
           https://docs.openstack.org/kolla-ansible/latest/
          </span>
         </span>
        </a>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.262.1">
          OpenStack-Helm
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.263.1">
          Docker
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.264.1">
         Kubernetes
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.265.1">
          and Helm
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <a href="https://docs.openstack.org/openstack-helm/latest/">
         <span class="No-Break">
          <span class="koboSpan" id="kobo.266.1">
           https://docs.openstack.org/openstack-helm/latest/
          </span>
         </span>
        </a>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.267.1">
         Triple-O (currently no
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.268.1">
          longer supported)
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.269.1">
          Docker
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.270.1">
          Ansible
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <a href="https://docs.openstack.org/tripleo-ansible/latest/">
         <span class="No-Break">
          <span class="koboSpan" id="kobo.271.1">
           https://docs.openstack.org/tripleo-ansible/latest/
          </span>
         </span>
        </a>
       </p>
      </td>
     </tr>
    </tbody>
   </table>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.272.1">
     Table 2.1 – A list of OpenStack deployment tools running containers
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.273.1">
     The
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.274.1">
      OpenStack-Ansible
     </span>
    </strong>
    <span class="koboSpan" id="kobo.275.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.276.1">
      OSA
     </span>
    </strong>
    <span class="koboSpan" id="kobo.277.1">
     ) project is one of the most
    </span>
    <a id="_idIndexMarker198">
    </a>
    <span class="koboSpan" id="kobo.278.1">
     widespread deployments based on LXC containers.
    </span>
    <span class="koboSpan" id="kobo.278.2">
     The deployment of LXC containers running OpenStack services is orchestrated
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.279.1">
      by Ansible.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.280.1">
     In our next deployment, we will adopt
    </span>
    <a id="_idIndexMarker199">
    </a>
    <span class="koboSpan" id="kobo.281.1">
     another emerging OpenStack project, named
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.282.1">
      Kolla-Ansible
     </span>
    </strong>
    <span class="koboSpan" id="kobo.283.1">
     .
    </span>
    <span class="koboSpan" id="kobo.283.2">
     Similarly to OSA, the Kolla project uses Docker
    </span>
    <a id="_idIndexMarker200">
    </a>
    <span class="koboSpan" id="kobo.284.1">
     as a containerization tool by building a Docker container for each OpenStack service.
    </span>
    <span class="koboSpan" id="kobo.284.2">
     Besides the design differences between LXC and Docker, Kolla extends the parameterization layout, making its containers more configurable, with an array of choices between the base operating system and template engines.
    </span>
    <span class="koboSpan" id="kobo.284.3">
     This is not to mention Docker’s design advantages as a container technology, with the layered nature of its images, versioning, and portability for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.285.1">
      sharing capabilities.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.286.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.287.1">
     Kolla has been integrated officially within the OpenStack subproject since the Liberty release.
    </span>
    <span class="koboSpan" id="kobo.287.2">
     As per the official OpenStack definition of the Kolla project,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.288.1">
      “Kolla’s mission is to provide production-ready containers and deployment tools for operating
     </span>
    </em>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.289.1">
       OpenStack clouds.”
      </span>
     </em>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.290.1">
     Those extra advantages make Docker more suitable for our deployment pipeline, where we will deal with a container service as an artifact that can be easily deployed through different environments, before promoting it to a production environment.
    </span>
    <span class="koboSpan" id="kobo.290.2">
     As depicted in the following high-level schema, for each merged change in the code repository, the CI/CD tool builds an artifact composed of a software package encapsulated in a Docker image.
    </span>
    <span class="koboSpan" id="kobo.290.3">
     The generated image will be committed to a private Docker registry, where Ansible will download it and orchestrate its setup in the designated
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.291.1">
      OpenStack node.
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer027">
     <span class="koboSpan" id="kobo.292.1">
      <img alt="Figure 2.4 – High-level CI/CD pipeline OpenStack deployment" src="image/B21716_02_04.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.293.1">
     Figure 2.4 – High-level CI/CD pipeline OpenStack deployment
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.294.1">
     The other component of the deployment
    </span>
    <a id="_idIndexMarker201">
    </a>
    <span class="koboSpan" id="kobo.295.1">
     tool stack is the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.296.1">
      Jinja2
     </span>
    </strong>
    <span class="koboSpan" id="kobo.297.1">
     templating tool.
    </span>
    <span class="koboSpan" id="kobo.297.2">
     This is mainly used by Docker for the dynamic assignment of variables, based on defined parameters generated by Ansible.
    </span>
    <span class="koboSpan" id="kobo.297.3">
     Jinja2 is designed mainly for Dockerfiles to support full system call interface compatibility for both RPM and DEB
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.298.1">
      container distributions.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.299.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.300.1">
     Jinja2 templating in the Kolla context provides an array of ways of building Docker images of different source distributions, including CentOS, Debian, Fedora, Ubuntu, and RHEL container operating systems that can be parameterized per OpenStack
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.301.1">
      service code.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.302.1">
     As our main motivation is to solve the complexity of dependencies and provide a simpler and more scalable development experience, Kolla is the way to go, and indeed since its official first stable release, several production
    </span>
    <a id="_idIndexMarker202">
    </a>
    <span class="koboSpan" id="kobo.303.1">
     deployments have been performed the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.304.1">
      Kolla way.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-55">
    <a id="_idTextAnchor099">
    </a>
    <span class="koboSpan" id="kobo.305.1">
     Building the picture
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.306.1">
     Treating OpenStack deployment as IaC will help us to inherit and use most of the software tools and processes to deliver code artifacts, ready for deployment, with more confidence.
    </span>
    <span class="koboSpan" id="kobo.306.2">
     Having a robust integration and deployment pipeline is vital to ensure that our software-defined data center does not fail on production day.
    </span>
    <span class="koboSpan" id="kobo.306.3">
     Modern software development techniques involve several tools that increase automation and agility and, hence, faster feedback between
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.307.1">
      each deployment.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.308.1">
     The following tools will be employed for our OpenStack infrastructure
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.309.1">
      code development:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.310.1">
       A version control system
      </span>
     </strong>
     <span class="koboSpan" id="kobo.311.1">
      : GitHub will be our code repository
     </span>
     <a id="_idIndexMarker203">
     </a>
     <span class="koboSpan" id="kobo.312.1">
      for the OpenStack
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.313.1">
       infrastructure code.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.314.1">
       A CI/CD tool
      </span>
     </strong>
     <span class="koboSpan" id="kobo.315.1">
      : Jenkins will be installed on the deployer
     </span>
     <a id="_idIndexMarker204">
     </a>
     <span class="koboSpan" id="kobo.316.1">
      machine and grant extra plugins to build and run
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.317.1">
       deployment pipelines.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.318.1">
       A system management tool
      </span>
     </strong>
     <span class="koboSpan" id="kobo.319.1">
      : The Ansible packages will be installed
     </span>
     <a id="_idIndexMarker205">
     </a>
     <span class="koboSpan" id="kobo.320.1">
      on the deployer machine and provide the OpenStack playbooks to be deployed inside the containers, in tandem
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.321.1">
       with Kolla.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.322.1">
       An image builder
      </span>
     </strong>
     <span class="koboSpan" id="kobo.323.1">
      : Dedicated to OpenStack
     </span>
     <a id="_idIndexMarker206">
     </a>
     <span class="koboSpan" id="kobo.324.1">
      containers, Kolla builds container images running different
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.325.1">
       OpenStack services.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.326.1">
     The Kolla-Ansible project code repository will be our starting point for the first OpenStack deployment, with minimum customization to have a rolling deployment pipeline initially.
    </span>
    <span class="koboSpan" id="kobo.326.2">
     The official latest master stable branch of the project code can be found
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.327.1">
      here:
     </span>
    </span>
    <a href="https://github.com/openstack/kolla-ansible">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.328.1">
       https://github.com/openstack/kolla-ansible
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.329.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.330.1">
     Kolla-Ansible supports both all-in-one as well as multi-node
    </span>
    <a id="_idIndexMarker207">
    </a>
    <span class="koboSpan" id="kobo.331.1">
     OpenStack setups.
    </span>
    <span class="koboSpan" id="kobo.331.2">
     As we’re aiming for a production setup, as discussed in the initial design draft in
    </span>
    <a href="B21716_01.xhtml#_idTextAnchor014">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.332.1">
        Chapter 1
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.333.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.334.1">
      Revisiting OpenStack –Design Considerations
     </span>
    </em>
    <span class="koboSpan" id="kobo.335.1">
     , we will make sure our initial draft is the first deployment iteration ready
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.336.1">
      for deployment.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-56">
    <a id="_idTextAnchor100">
    </a>
    <span class="koboSpan" id="kobo.337.1">
     Setting up a development environment
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.338.1">
     Setting up a development environment
    </span>
    <a id="_idIndexMarker208">
    </a>
    <span class="koboSpan" id="kobo.339.1">
     mimicking a production one is highly recommended to ensure faster feedback during the development stages, as well as to fix any anomalies in code before promoting it to a production setup.
    </span>
    <span class="koboSpan" id="kobo.339.2">
     Although running services in a container increases the flexibility of rolling back if issues are detected after deployment into production, a best practice is to act proactively by running service containers in an isolated environment through different deployment and testing stages.
    </span>
    <span class="koboSpan" id="kobo.339.3">
     Upon successful deployment in the test environment, services’ containers will be promoted and tagged as production-ready
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.340.1">
      for deployment.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.341.1">
     Depending on how many physical machines will be invested in your development environments, the DevSecOps team will require an isolated environment for each member to run tests, before committing their changes to a main development branch that targets deployment in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.342.1">
      development environment.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-57">
    <a id="_idTextAnchor101">
    </a>
    <span class="koboSpan" id="kobo.343.1">
     Preparing the local environment
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.344.1">
     Vagrant is a revolutionary tool
    </span>
    <a id="_idIndexMarker209">
    </a>
    <span class="koboSpan" id="kobo.345.1">
     created by HashiCorp that can create, modify, and manage visualized environments through simple Vagrant command lines.
    </span>
    <span class="koboSpan" id="kobo.345.2">
     The other exciting part of Vagrant is managing a local development environment through it.
    </span>
    <span class="koboSpan" id="kobo.345.3">
     Vagrant configuration is highly customizable and supports a variety of local hypervisors to run virtual machines, such as VirtualBox, HyperV,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.346.1">
      and VMware.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.347.1">
     Our next setup will consider a local VirtualBox environment, depending on your development operating system machine; most Linux, Mac, and Windows distributions are supported
    </span>
    <a id="_idIndexMarker210">
    </a>
    <span class="koboSpan" id="kobo.348.1">
     and can be found
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.349.1">
      here:
     </span>
    </span>
    <a href="https://www.virtualbox.org/wiki/Downloads">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.350.1">
       https://www.virtualbox.org/wiki/Downloads
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.351.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.352.1">
     Once VirtualBox is installed, download the base image where the OpenStack environment will run.
    </span>
    <span class="koboSpan" id="kobo.352.2">
     A good practice for VirtualBox development in Vagrant is to use the same operating system distribution for both the development and production environments.
    </span>
    <span class="koboSpan" id="kobo.352.3">
     The chosen operating system in the next setup is Ubuntu
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.353.1">
      22.04 LTS
     </span>
    </strong>
    <span class="koboSpan" id="kobo.354.1">
     .
    </span>
    <span class="koboSpan" id="kobo.354.2">
     In the following wizard, we will go through the different steps to prepare the Vagrant file before starting to deploy a local
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.355.1">
      OpenStack environment:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.356.1">
      Generate a Vagrant file by firing the following
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.357.1">
       command line:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.358.1"># vagrant init</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.359.1">
      Modify the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.360.1">
       box
      </span>
     </strong>
     <span class="koboSpan" id="kobo.361.1">
      stanza configuration section by providing the operating
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.362.1">
       system image:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.363.1">
Vagrant.configure("2") do |config|
  config.vm.box = "generic/ubuntu2204"
end</span></pre>
    </li>
   </ol>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.364.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.365.1">
     Vagrant boxes can be created locally by backing up an image of any operating system, using tools such as
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.366.1">
      Packer
     </span>
    </strong>
    <span class="koboSpan" id="kobo.367.1">
     .
    </span>
    <span class="koboSpan" id="kobo.367.2">
     Vagrant boxes can be shared and tagged with the version in the Vagrant
    </span>
    <a id="_idIndexMarker211">
    </a>
    <span class="koboSpan" id="kobo.368.1">
     cloud repository, as detailed
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.369.1">
      here:
     </span>
    </span>
    <a href="https://developer.hashicorp.com/vagrant/vagrant-cloud/boxes/create">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.370.1">
       https://developer.hashicorp.com/vagrant/vagrant-cloud/boxes/create
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.371.1">
      .
     </span>
    </span>
   </p>
   <ol>
    <li value="3">
     <span class="koboSpan" id="kobo.372.1">
      The local development machine
     </span>
     <a id="_idIndexMarker212">
     </a>
     <span class="koboSpan" id="kobo.373.1">
      should have a minimum of hardware specs, such as RAM and CPU, to accommodate a minimal setup of an OpenStack environment, as depicted in the following Vagrant
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.374.1">
       configuration section:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.375.1">
config.vm.provider :virtualbox do |vb|
   vb.memory = 8096
   vb.cpus  = 4
end</span></pre>
    </li>
   </ol>
   <ol>
    <li value="4">
     <span class="koboSpan" id="kobo.376.1">
      Set the virtual disk space to a minimum of 50 GB in the new
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.377.1">
       box
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.378.1">
       stanza line:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.379.1">
Vagrant.configure("2") do |config|
 ….
</span><span class="koboSpan" id="kobo.379.2">   config.disksize.size = "55GB"</span></pre>
    </li>
   </ol>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.380.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.381.1">
     Make sure to have the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.382.1">
      vagrant-disksize
     </span>
    </strong>
    <span class="koboSpan" id="kobo.383.1">
     plugin installed by running the following command line –
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.384.1">
      vagrant plugin
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.385.1">
       install vagrant-disksize
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.386.1">
      .
     </span>
    </span>
   </p>
   <ol>
    <li value="5">
     <span class="koboSpan" id="kobo.387.1">
      Optionally, add a synced folder to sync the OpenStack infrastructure code on the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.388.1">
       development machine:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.389.1">
Vagrant.configure("2") do |config|
  ….
</span><span class="koboSpan" id="kobo.389.2">    config.vm.synced_folder(
       "openstack_deploy/", "/openstack_deploy/"
    )</span></pre>
    </li>
   </ol>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.390.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.391.1">
     Make sure the synced folder in the local machine exists by creating the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.392.1">
       openstack_deploy
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.393.1">
      folder.
     </span>
    </span>
   </p>
   <ol>
    <li value="6">
     <span class="koboSpan" id="kobo.394.1">
      Networking can be configured to forward port access to specific services from the development machine to the guest box.
     </span>
     <span class="koboSpan" id="kobo.394.2">
      Accessing OpenStack Horizon, for example, would require port forwarding on port
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.395.1">
       80
      </span>
     </strong>
     <span class="koboSpan" id="kobo.396.1">
      from the guest machine, which can be adjusted
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.397.1">
       as follows:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.398.1">
Vagrant.configure("2") do |config|
...
</span><span class="koboSpan" id="kobo.398.2">   config.vm.network :forwarded_port, guest: 80, host: 80</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.399.1">
      Start the Vagrant box by firing the following
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.400.1">
       command line:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.401.1"># vagrant up --provider virtualbox</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.402.1">
      Once started without errors, the Vagrant box
     </span>
     <a id="_idIndexMarker213">
     </a>
     <span class="koboSpan" id="kobo.403.1">
      is ready for access.
     </span>
     <span class="koboSpan" id="kobo.403.2">
      The default login uses a Vagrant user that can be elevated to root to proceed with the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.404.1">
       next setup:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.405.1"># vagrant ssh</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.406.1"># sudo -i</span></strong></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.407.1">
     Once the Vagrant box
    </span>
    <a id="_idIndexMarker214">
    </a>
    <span class="koboSpan" id="kobo.408.1">
     is up and running, you should be able to start installing the required packages to deploy an all-in-one
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.409.1">
      OpenStack environment.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-58">
    <a id="_idTextAnchor102">
    </a>
    <span class="koboSpan" id="kobo.410.1">
     Running the local cloud
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.411.1">
     The Kolla-Ansible project code
    </span>
    <a id="_idIndexMarker215">
    </a>
    <span class="koboSpan" id="kobo.412.1">
     includes different ways of installing OpenStack in all-in-one or multi-nodes.
    </span>
    <span class="koboSpan" id="kobo.412.2">
     As part of the infrastructure code process, we will adjust a few settings to run an all-in-one mode on the development machine.
    </span>
    <span class="koboSpan" id="kobo.412.3">
     But first, we need to install the Git package on our local
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.413.1">
      development host:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.414.1">
$ apt-get install git</span></pre>
   <p>
    <span class="koboSpan" id="kobo.415.1">
     Clone the OpenStack-Kolla repository to the designated local folder setup created in the previous section.
    </span>
    <span class="koboSpan" id="kobo.415.2">
     The Vagrant configuration file will make any changes to the local folder,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.416.1">
      openstack_deploy/
     </span>
    </strong>
    <span class="koboSpan" id="kobo.417.1">
     , visible to the guest box.
    </span>
    <span class="koboSpan" id="kobo.417.2">
     Ideally, cloning the repositories should be done from your local Git server of choice.
    </span>
    <span class="koboSpan" id="kobo.417.3">
     In this example, a private Git repository is used (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.418.1">
      ci.os
     </span>
    </strong>
    <span class="koboSpan" id="kobo.419.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.419.2">
     The following command clones the local repository running on the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.420.1">
      CI/CD instance:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.421.1">
$ git clone https://git@ci.os/git/openstack_deploy/openstack_deploy</span></pre>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.422.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.423.1">
     Here is a simple guide to optionally set up a local Git server running NGINX on the latest version of Ubuntu:
    </span>
    <a href="https://www.howtoforge.com/tutorial/ubuntu-git-server-installation/">
     <span class="koboSpan" id="kobo.424.1">
      https://www.howtoforge.com/tutorial/ubuntu-git-server-installation/
     </span>
    </a>
    <span class="koboSpan" id="kobo.425.1">
     .
    </span>
    <span class="koboSpan" id="kobo.425.2">
     The local Git server uses the latest stable master branch, cloned locally from the Kolla-Ansible
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.426.1">
      repository:
     </span>
    </span>
    <a href="https://github.com/openstack/kolla-ansible.git">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.427.1">
       https://github.com/openstack/kolla-ansible.git
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.428.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.429.1">
     Optionally, create your development branch from the master to track local changes before pushing them to the next
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.430.1">
      development branch:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.431.1">
$ git checkout -b local_dev_branch</span></pre>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.432.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.433.1">
     Ideally, pushed changes should be made in a dedicated development branch of your choice before propagating them to the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.434.1">
      master branch.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.435.1">
     Log in to your Vagrant box and proceed to install environment dependencies and create a virtual environment.
    </span>
    <span class="koboSpan" id="kobo.435.2">
     Make sure to change the path of your environment on the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.436.1">
      guest host:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.437.1">
# apt-get update
# apt-get install python3-dev libffi-dev gcc libssl-dev
# apt install python3-pip
# apt install python3-virtualenv
# python3 -m venv local
# source local/bin/activate
(local)# pip install -U pip</span></pre>
   <p>
    <span class="koboSpan" id="kobo.438.1">
     Install Ansible.
    </span>
    <span class="koboSpan" id="kobo.438.2">
     Make sure a minimum version of 2.16
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.439.1">
      is installed:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.440.1">
# pip install  'ansible-core&gt;=2.16,&lt;2.17.99'</span></pre>
   <p>
    <span class="koboSpan" id="kobo.441.1">
     Install the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.442.1">
       kolla-ansible
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.443.1">
      runtime:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.444.1">
#  pip install git+https://opendev.org/openstack/kolla-ansible@master</span></pre>
   <p>
    <span class="koboSpan" id="kobo.445.1">
     Since OpenStack Yoga, a few additional dependencies need to be installed, which can be solved by running the following
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.446.1">
      command line:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.447.1">
# kolla-ansible install-deps</span></pre>
   <p>
    <span class="koboSpan" id="kobo.448.1">
     The Kolla-Ansible repository
    </span>
    <a id="_idIndexMarker216">
    </a>
    <span class="koboSpan" id="kobo.449.1">
     comes with two essential files that we will edit to run our local deployment –
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.450.1">
      globals.yml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.451.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.452.1">
      passwords.yml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.453.1">
     .
    </span>
    <span class="koboSpan" id="kobo.453.2">
     Copy the files to a directory of your choice, which can be created, and make sure that the running guest user owns
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.454.1">
      the files:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.455.1">
# mkdir -p /etc/kolla
# chown $USER:$USER /etc/kolla
# cp -r /local/share/kolla-ansible/etc_examples/kolla/* /etc/kolla</span></pre>
   <p>
    <span class="koboSpan" id="kobo.456.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.457.1">
      globals.yml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.458.1">
     file includes several settings and adjustable configurations for different OpenStack control plane services, as well as shared ones.
    </span>
    <span class="koboSpan" id="kobo.458.2">
     As part of our minimal test environment, we will edit the following settings to the copied
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.459.1">
      globals.yml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.460.1">
     file under the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.461.1">
      /
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.462.1">
       etc/
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.463.1">
       kolla/
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.464.1">
      folder:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.465.1">
      Use Ubuntu to run as the base Linux distribution for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.466.1">
       the containers:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.467.1">kolla_base_distro: "ubuntu"</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.468.1">
      Ensure that HAProxy is out of the scope of our initial setup in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.469.1">
       test environment:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.470.1">enable_haproxy : "no"</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.471.1">
      Select the network interface name to be assigned for all types of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.472.1">
       OpenStack networks:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.473.1">network_interface: "eth0"</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.474.1">
      Dedicate a second interface for the Neutron
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.475.1">
       external network:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.476.1">neutron_external_interface: "eth1"</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.477.1">
      Assign a Keepalived floating IP, which should be reserved as a virtual IP for HA:
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.478.1">kolla_internal_vip_address: 172.28.128.47</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.479.1">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.480.1">
       passwords.yml
      </span>
     </strong>
     <span class="koboSpan" id="kobo.481.1">
      file centralizes all the OpenStack purposes and other services’ passwords.
     </span>
     <span class="koboSpan" id="kobo.481.2">
      To generate random password sets in one command instead of running them manually for each, Kolla comes with a simple command tool that generates passwords, which will be used during the deployment,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.482.1">
       as follows:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.483.1">
# kolla-genpwd  -p /etc/kolla/passwords.yml</span></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.484.1">
       Make sure that the generated passwords
      </span>
      <a id="_idIndexMarker217">
      </a>
      <span class="koboSpan" id="kobo.485.1">
       are saved in the
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.486.1">
        passwords.yml
       </span>
      </strong>
      <span class="koboSpan" id="kobo.487.1">
       file under your
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.488.1">
        custom directory.
       </span>
      </span>
     </p>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.489.1">
     The other crucial file is under the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.490.1">
      inventory
     </span>
    </strong>
    <span class="koboSpan" id="kobo.491.1">
     folder, which describes and instructs Kolla-Ansible on which hosts will be the target to apply the configuration.
    </span>
    <span class="koboSpan" id="kobo.491.2">
     Inventory files are defined with the Ansible host group format and can be customized, based on the available hosts and assigned roles.
    </span>
    <span class="koboSpan" id="kobo.491.3">
     The default available files are designed to run inventories for all-in-one and multi-hosts.
    </span>
    <span class="koboSpan" id="kobo.491.4">
     To run a clean host target setup, make a copy of the files under the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.492.1">
       inventory
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.493.1">
      directory:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.494.1">
# cp -r  /local/share/kolla-ansible/ansible/inventory/*  /etc/kolla/</span></pre>
   <p>
    <span class="koboSpan" id="kobo.495.1">
     The all-in-one Ansible inventory file will not require any changes for our development setup purposes.
    </span>
    <span class="koboSpan" id="kobo.495.2">
     The format of the file is straightforward, where each host role section describes the name of the host or IP address.
    </span>
    <span class="koboSpan" id="kobo.495.3">
     For the local test environment, all host roles will be configured with
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.496.1">
      localhost
     </span>
    </strong>
    <span class="koboSpan" id="kobo.497.1">
     , as shown in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.498.1">
      following snippet:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.499.1">
[control]
localhost       ansible_connection=local
[network]
localhost       ansible_connection=local
[compute]
localhost       ansible_connection=local
[storage]
localhost       ansible_connection=local
….</span></pre>
   <p>
    <span class="koboSpan" id="kobo.500.1">
     Fire the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.501.1">
      kolla-ansible
     </span>
    </strong>
    <span class="koboSpan" id="kobo.502.1">
     command line to install the bootstrap
    </span>
    <a id="_idIndexMarker218">
    </a>
    <span class="koboSpan" id="kobo.503.1">
     servers.
    </span>
    <span class="koboSpan" id="kobo.503.2">
     The command will run the Ansible playbook against each host-assigned role in the inventory file.
    </span>
    <span class="koboSpan" id="kobo.503.3">
     So far, all roles are gathered in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.504.1">
      same localhost:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.505.1">
# kolla-ansible -i /etc/kolla/all-in-one bootstrap-servers</span></pre>
   <p>
    <span class="koboSpan" id="kobo.506.1">
     The following is
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.507.1">
      the output:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer028">
     <span class="koboSpan" id="kobo.508.1">
      <img alt="Figure 2.5 – The kolla-ansible bootstrap servers’ output" src="image/B21716_02_05.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.509.1">
     Figure 2.5 – The kolla-ansible bootstrap servers’ output
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.510.1">
     Optionally, run a few deployment checks
    </span>
    <a id="_idIndexMarker219">
    </a>
    <span class="koboSpan" id="kobo.511.1">
     to closely monitor the bootstrapping process and detect
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.512.1">
      possible failures:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.513.1">
# kolla-ansible -i /etc/kolla/all-in-one prechecks</span></pre>
   <p>
    <span class="koboSpan" id="kobo.514.1">
     Here’s
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.515.1">
      the output:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer029">
     <span class="koboSpan" id="kobo.516.1">
      <img alt="Figure 2.6 – The kolla-ansible prechecks’ output" src="image/B21716_02_06.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.517.1">
     Figure 2.6 – The kolla-ansible prechecks’ output
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.518.1">
     Once the bootstrapping process is finished without any detected failures, perform the deployment of the OpenStack environment, which will take a long time to create all the containers’ services and chain
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.519.1">
      them together:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.520.1">
# kolla-ansible -i  /etc/kolla/all-in-one deploy</span></pre>
   <p>
    <span class="koboSpan" id="kobo.521.1">
     Here’s
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.522.1">
      the output:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer030">
     <span class="koboSpan" id="kobo.523.1">
      <img alt="Figure 2.7 – The kolla-ansible deployment output" src="image/B21716_02_07.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.524.1">
     Figure 2.7 – The kolla-ansible deployment output
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.525.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.526.1">
     The Ansible deployment will apply the playbooks and OpenStack roles using container images from the default OpenStack Docker repository.
    </span>
    <span class="koboSpan" id="kobo.526.2">
     For the next development stage, make sure to build and push further images to a local repository.
    </span>
    <span class="koboSpan" id="kobo.526.3">
     The next sections and chapters will discuss how to build local container images for different services and manage
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.527.1">
      them locally.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.528.1">
     The deployment of the minimal setup
    </span>
    <a id="_idIndexMarker220">
    </a>
    <span class="koboSpan" id="kobo.529.1">
     of the OpenStack containers should result in zero failures by the end of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.530.1">
      kolla-ansible deploy
     </span>
    </strong>
    <span class="koboSpan" id="kobo.531.1">
     command line.
    </span>
    <span class="koboSpan" id="kobo.531.2">
     The following Docker command line lists all the running containers deployed in the previous step that should be noted as healthy.
    </span>
    <span class="koboSpan" id="kobo.531.3">
     Some containers will still be in the process of communicating with other system services, which will take a few minutes, before starting to evaluate the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.532.1">
      OpenStack services:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.533.1">
# docker ps</span></pre>
   <p>
    <span class="koboSpan" id="kobo.534.1">
     Here’s
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.535.1">
      the output:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer031">
     <span class="koboSpan" id="kobo.536.1">
      <img alt="Figure 2.8 – A list of the running OpenStack service containers" src="image/B21716_02_08.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.537.1">
     Figure 2.8 – A list of the running OpenStack service containers
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.538.1">
     Let’s try to see OpenStack running in containers
    </span>
    <a id="_idIndexMarker221">
    </a>
    <span class="koboSpan" id="kobo.539.1">
     by firing a client test command.
    </span>
    <span class="koboSpan" id="kobo.539.2">
     To fire a quick test, install the OpenStack
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.540.1">
      client package:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.541.1">
 # pip install python openstackclient</span></pre>
   <p>
    <span class="koboSpan" id="kobo.542.1">
     To interact with OpenStack API services, admin credentials are required, which can be generated by the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.543.1">
      kolla-ansible post deploy
     </span>
    </strong>
    <span class="koboSpan" id="kobo.544.1">
     command,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.545.1">
      as follows:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.546.1">
# kolla-ansible post-deploy</span></pre>
   <p>
    <span class="koboSpan" id="kobo.547.1">
     Here’s
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.548.1">
      the result:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer032">
     <span class="koboSpan" id="kobo.549.1">
      <img alt="Figure 2.9 – The kolla-ansible OpenStack post-deployment output" src="image/B21716_02_09.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.550.1">
     Figure 2.9 – The kolla-ansible OpenStack post-deployment output
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.551.1">
     The previous command will generate the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.552.1">
      cloud.yaml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.553.1">
     file, which contains different OpenStack admin credentials to interact with OpenStack services via the client command line.
    </span>
    <span class="koboSpan" id="kobo.553.2">
     The content of the file variables can be populated by exporting the path of the generated
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.554.1">
      cloud.yaml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.555.1">
     file,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.556.1">
      as follows:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.557.1">
# export OS_CLIENT_CONFIG_FILE=/etc/kolla/cloud.yaml</span></pre>
   <p>
    <span class="koboSpan" id="kobo.558.1">
     Validate the running OpenStack environment by listing, for example, the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.559.1">
       nova
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.560.1">
      host:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.561.1">
# openstack hypervisor list</span></pre>
   <p>
    <span class="koboSpan" id="kobo.562.1">
     Here’s
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.563.1">
      the output:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer033">
     <span class="koboSpan" id="kobo.564.1">
      <img alt="Figure 2.10 – The OpenStack host list output" src="image/B21716_02_10.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.565.1">
     Figure 2.10 – The OpenStack host list output
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.566.1">
     OpenStack services can be managed
    </span>
    <a id="_idIndexMarker222">
    </a>
    <span class="koboSpan" id="kobo.567.1">
     easily through the Docker container command-line interface.
    </span>
    <span class="koboSpan" id="kobo.567.2">
     For example, Keystone container service logs can be viewed by running the following
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.568.1">
      command line:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.569.1">
# docker logs keystone</span></pre>
   <p>
    <span class="koboSpan" id="kobo.570.1">
     The other option to inspect an OpenStack service container and report back container information, such as IP address and networking settings, can be performed by using the generic
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.571.1">
      docker inspect
     </span>
    </strong>
    <span class="koboSpan" id="kobo.572.1">
     command line,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.573.1">
      as follows:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.574.1">
# docker inspect keystone</span></pre>
   <p>
    <span class="koboSpan" id="kobo.575.1">
     Despite the flexibility of the usage of containers and the simplicity of destroying and building new ones in almost no time, in some cases, you might need to investigate a defined OpenStack service issue or configuration via shell access,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.576.1">
      as follows:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.577.1">
# docker exec --it nova /bin/bash</span></pre>
   <p>
    <span class="koboSpan" id="kobo.578.1">
     An all-in-one setup helps to develop and test code locally.
    </span>
    <span class="koboSpan" id="kobo.578.2">
     Larger environments, including staging and production, would require an extended setup, which will be detailed in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.579.1">
      next section.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-59">
    <a id="_idTextAnchor103">
    </a>
    <span class="koboSpan" id="kobo.580.1">
     Extending the deployment
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.581.1">
     Expanding on our initial physical
    </span>
    <a id="_idIndexMarker223">
    </a>
    <span class="koboSpan" id="kobo.582.1">
     design, discussed in
    </span>
    <a href="B21716_01.xhtml#_idTextAnchor014">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.583.1">
        Chapter 1
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.584.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.585.1">
      Revisiting OpenStack – Design Considerations
     </span>
    </em>
    <span class="koboSpan" id="kobo.586.1">
     , will require the evaluation of different hardware specifications and options for the chosen design.
    </span>
    <span class="koboSpan" id="kobo.586.2">
     As we have narrowed down the methods of deployment and the different sets of tools to build our first production iteration, we will start splitting the roles of OpenStack components across different physical systems.
    </span>
    <span class="koboSpan" id="kobo.586.3">
     Unlike a testing environment, a production environment should follow a well-architected design pattern, based on the isolation of services, fault tolerance, scalability, and redundancy on each layer.
    </span>
    <span class="koboSpan" id="kobo.586.4">
     We will deep-dive into the extension of those architectural aspects in
    </span>
    <a href="B21716_03.xhtml#_idTextAnchor108">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.587.1">
        Chapter 3
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.588.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.589.1">
      OpenStack Control Plane – Shared Services
     </span>
    </em>
    <span class="koboSpan" id="kobo.590.1">
     , and
    </span>
    <a href="B21716_07.xhtml#_idTextAnchor174">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.591.1">
        Chapter 7
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.592.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.593.1">
      Running a Highly Available Cloud – Meeting
     </span>
    </em>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.594.1">
       the SLA
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.595.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.596.1">
     Our deployment pipeline will be the source of truth to deploy any environment if you consider going through a minimal all-in-one setup testing environment to a staging one, mimicking the production that will be promoted to production if all stages of the pipeline tests, including security ones, are executed with
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.597.1">
      0 errors.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.598.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.599.1">
     Make sure to not introduce any user production workloads before getting a minimum level of redundancy in each control and data plane across your OpenStack environment.
    </span>
    <span class="koboSpan" id="kobo.599.2">
     More details on extending to a highly available setup will be discussed in
    </span>
    <a href="B21716_07.xhtml#_idTextAnchor174">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.600.1">
        Chapter 7
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.601.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.602.1">
      Running a Highly Available Cloud – Meeting
     </span>
    </em>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.603.1">
       the SLA
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.604.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.605.1">
     The deployment expansion for the environment should take an incremental approach by splitting the roles whenever feasible, and you should take into consideration that some services can be optionally separated on their own physical servers.
    </span>
    <span class="koboSpan" id="kobo.605.2">
     A good practice is to start splitting additional roles in the physical layout once the core services are rolling and after gaining more operational expertise for each iteration.
    </span>
    <span class="koboSpan" id="kobo.605.3">
     As the deployment pipeline feeds back the state of each new deployment, more technical decisions will need to be made to introduce improvements to the physical infrastructure layout, and you can choose which services can be moved to their own server in the next iteration.
    </span>
    <span class="koboSpan" id="kobo.605.4">
     To safely start the deployment journey, we will need to install and configure our deployer before proceeding with
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.606.1">
      infrastructure deployment.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-60">
    <a id="_idTextAnchor104">
    </a>
    <span class="koboSpan" id="kobo.607.1">
     Installing the deployer
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.608.1">
     Our deployer host will be installed
    </span>
    <a id="_idIndexMarker224">
    </a>
    <span class="koboSpan" id="kobo.609.1">
     with the following software and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.610.1">
      hardware settings:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.611.1">
        Software
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.612.1">
       :
      </span>
     </span>
     <ul>
      <li>
       <span class="koboSpan" id="kobo.613.1">
        Jenkins
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.614.1">
         version 2.414.1
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.615.1">
        Docker version 1.12.6
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.616.1">
         or greater
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.617.1">
        Ansible 2.3.1
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.618.1">
         or greater
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.619.1">
        Docker Python 1.10.0
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.620.1">
         or greater
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.621.1">
        Kolla-Ansible 16.1.0-16 – an OpenStack Antelope release
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.622.1">
         or later
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.623.1">
        Git
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.624.1">
         version control
        </span>
       </span>
      </li>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.625.1">
         Operating system
        </span>
       </strong>
       <span class="koboSpan" id="kobo.626.1">
        : Ubuntu
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.627.1">
         22.04 LTS
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.628.1">
        pip and Python dependencies
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.629.1">
         including
        </span>
       </span>
       <span class="No-Break">
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.630.1">
          python-dev
         </span>
        </strong>
       </span>
      </li>
     </ul>
    </li>
    <li>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.631.1">
        Hardware
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.632.1">
       :
      </span>
     </span>
     <ul>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.633.1">
         CPU
        </span>
       </strong>
       <span class="koboSpan" id="kobo.634.1">
        : At least 4 CPU cores and 64
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.635.1">
         bits x86
        </span>
       </span>
      </li>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.636.1">
         Memory
        </span>
       </strong>
       <span class="koboSpan" id="kobo.637.1">
        : At least 4 GB
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.638.1">
         of RAM
        </span>
       </span>
      </li>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.639.1">
         Disk space
        </span>
       </strong>
       <span class="koboSpan" id="kobo.640.1">
        : At least 50 GB of free
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.641.1">
         disk space
        </span>
       </span>
      </li>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.642.1">
         Network
        </span>
       </strong>
       <span class="koboSpan" id="kobo.643.1">
        : At least two
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.644.1">
         network interfaces
        </span>
       </span>
      </li>
     </ul>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.645.1">
     Start by installing Jenkins, by updating your local system and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.646.1">
      Java runtime:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.647.1">
$ sudo apt-get update
$ sudo apt install openjdk-11-jdk</span></pre>
   <p>
    <span class="koboSpan" id="kobo.648.1">
     Add the required GPG key for the Jenkins
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.649.1">
      repository files:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.650.1">
$ curl -fsSL https://pkg.jenkins.io/debian-stable/jenkins.io-2023.key | sudo tee /usr/share/keyrings/jenkins-keyring.asc &gt; /dev/null</span></pre>
   <p>
    <span class="koboSpan" id="kobo.651.1">
     The following command will address the local system repository to download a recent version
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.652.1">
      of Jenkins:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.653.1">
$ echo deb [signed-by=/usr/share/keyrings/jenkins-keyring.asc]
https://pkg.jenkins.io/debian-stable binary/ | sudo tee 
/etc/apt/sources.list.d/jenkins.list &gt; /dev/null</span></pre>
   <p>
    <span class="koboSpan" id="kobo.654.1">
     Run an update of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.655.1">
      apt
     </span>
    </strong>
    <span class="koboSpan" id="kobo.656.1">
     package list and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.657.1">
      install Jenkins:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.658.1">
$ sudo apt update
$ sudo apt install jenkins</span></pre>
   <p>
    <span class="koboSpan" id="kobo.659.1">
     Make sure Jenkins is running by firing the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.660.1">
      following command:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.661.1">
$ sudo systemctl status jenkins</span></pre>
   <p>
    <span class="koboSpan" id="kobo.662.1">
     If the Jenkins daemon is not running, issue the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.663.1">
      start
     </span>
    </strong>
    <span class="koboSpan" id="kobo.664.1">
     command to launch
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.665.1">
      its process:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.666.1">
$ sudo systemctl start jenkins</span></pre>
   <p>
    <span class="koboSpan" id="kobo.667.1">
     Once the Jenkins service
    </span>
    <a id="_idIndexMarker225">
    </a>
    <span class="koboSpan" id="kobo.668.1">
     is up and running, point to the CI/CD server address in a browser on the default
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.669.1">
      8080
     </span>
    </strong>
    <span class="koboSpan" id="kobo.670.1">
     port to access the user interface, and then proceed with the preliminary setup of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.671.1">
      the server:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer034">
     <span class="koboSpan" id="kobo.672.1">
      <img alt="Figure 2.11 – Jenkins home page" src="image/B21716_02_11.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.673.1">
     Figure 2.11 – Jenkins home page
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.674.1">
     First, we will need to add a few plugins before building
    </span>
    <a id="_idIndexMarker226">
    </a>
    <span class="koboSpan" id="kobo.675.1">
     the pipeline, starting with
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.676.1">
      Git SCM
     </span>
    </strong>
    <span class="koboSpan" id="kobo.677.1">
     plugins.
    </span>
    <span class="koboSpan" id="kobo.677.2">
     To do this, click on
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.678.1">
      Manage Jenkins
     </span>
    </strong>
    <span class="koboSpan" id="kobo.679.1">
     on the upper-left corner tab.
    </span>
    <span class="koboSpan" id="kobo.679.2">
     Type
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.680.1">
      git
     </span>
    </strong>
    <span class="koboSpan" id="kobo.681.1">
     in the search bar on the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.682.1">
      Available Plugin
     </span>
    </strong>
    <span class="koboSpan" id="kobo.683.1">
     tab and click
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.684.1">
      Install
     </span>
    </strong>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.685.1">
       without restart
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.686.1">
      :
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer035">
     <span class="koboSpan" id="kobo.687.1">
      <img alt="Figure 2.12 – Jenkins’ Git SCM plugin setup" src="image/B21716_02_12.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.688.1">
     Figure 2.12 – Jenkins’ Git SCM plugin setup
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.689.1">
     Once Jenkins and its required plugins
    </span>
    <a id="_idIndexMarker227">
    </a>
    <span class="koboSpan" id="kobo.690.1">
     are installed, we can move forward by setting up the CI/CD pipeline and different stages for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.691.1">
      future deployment.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-61">
    <a id="_idTextAnchor105">
    </a>
    <span class="koboSpan" id="kobo.692.1">
     Actioning the deployer
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.693.1">
     Our Jenkins file can be checked
    </span>
    <a id="_idIndexMarker228">
    </a>
    <span class="koboSpan" id="kobo.694.1">
     into the repository.
    </span>
    <span class="koboSpan" id="kobo.694.2">
     The SCM pipeline will run the job definition with the configured path.
    </span>
    <span class="koboSpan" id="kobo.694.3">
     The Jenkins pipeline definition can be summarized in high level in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.695.1">
      following steps:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.696.1">
      Create a local test environment on the destination
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.697.1">
       testing host.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.698.1">
      Check out the repository from a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.699.1">
       defined branch.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.700.1">
      Install the required testing packages, including
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.701.1">
       kolla-
      </span>
     </strong>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.702.1">
       ansible
      </span>
     </strong>
     <span class="koboSpan" id="kobo.703.1">
      and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.704.1">
       Docker runtimes.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.705.1">
      Initialize the bootstrap
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.706.1">
       server script.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.707.1">
      Run Kolla prechecks on the bootstrapped
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.708.1">
       testing environment.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.709.1">
      Deploy the OpenStack
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.710.1">
       testing environment.
      </span>
     </span>
    </li>
   </ol>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.711.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.712.1">
     Depending on the target environments you plan to run through the CI/CD pipeline, make sure to adjust the configuration layout of the main
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.713.1">
      globals.yml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.714.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.715.1">
      inventory.yml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.716.1">
     files separately in each environment.
    </span>
    <span class="koboSpan" id="kobo.716.2">
     Each environment should run with a dedicated Jenkins
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.717.1">
      pipeline file.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.718.1">
     The next step is to create
    </span>
    <a id="_idIndexMarker229">
    </a>
    <span class="koboSpan" id="kobo.719.1">
     our first pipeline for the testing environment.
    </span>
    <span class="koboSpan" id="kobo.719.2">
     Jenkins provides different options to create the job pipeline definition, either via the user interface wizard or by simply creating a Jenkins file that can live in the main directory of the OpenStack infrastructure as a code repository.
    </span>
    <span class="koboSpan" id="kobo.719.3">
     For this purpose, our first job definition will follow the SCM method.
    </span>
    <span class="koboSpan" id="kobo.719.4">
     The following snippets define the Jenkins deployment pipeline, starting with the first stage, where a virtual Python environment will be sourced to run each build in its own
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.720.1">
      local environment:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.721.1">
pipeline {
  agent any
  stages {
    stage('Setup Local Environment') {
      steps {
        echo '--RUNNING LOCAL ENVIORNMENT --'
        sh ''' #!/bin/bash 
        sudo apt-get update
        sudo apt-get install \ 
        python3-dev libffi-dev gcc libssl-dev docker.io -y
        sudo apt install python3-pip -y
        sudo apt install python3.10-venv -y
        sudo python3 -m venv local
        source local/bin/activate
        ''' 
      }
    }</span></pre>
   <p>
    <span class="koboSpan" id="kobo.722.1">
     The next stage will install all required dependencies, including
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.723.1">
      pip
     </span>
    </strong>
    <span class="koboSpan" id="kobo.724.1">
     , the Ansible runtime, and the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.725.1">
       kolla-ansible
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.726.1">
      package:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.727.1">
    stage('INSTALLING PIP') {
      steps {
        echo '--INSTALLING PIP --'
        sh ''' #!/bin/bash 
        pip install -U pip
        ''' 
      }
    }
    stage('INSTALLING Ansible') {
      steps {
        echo '--INSTALLING Ansible --'
        sh ''' #!/bin/bash 
        pip install 'ansible-core&gt;=2.16,&lt;2.17.99'
        ''' 
      }
    }
    stage('INSTALLING Kolla Ansible') {
      steps {
        echo '--INSTALLING Kolla Ansible --'
        sh '''#!/bin/bash 
        pip install \
        git+https://opendev.org/openstack/kolla-ansible@master
        kolla-ansible install-deps
        ''' 
      }
    }</span></pre>
   <p>
    <span class="koboSpan" id="kobo.728.1">
     Once all the required packages
    </span>
    <a id="_idIndexMarker230">
    </a>
    <span class="koboSpan" id="kobo.729.1">
     are installed locally, the next stage will define the file structure of the infrastructure code under the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.730.1">
      /etc/kolla
     </span>
    </strong>
    <span class="koboSpan" id="kobo.731.1">
     directory and set a few parameters in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.732.1">
      globals.yml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.733.1">
     file, such as the network interface and the type of distribution Kolla
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.734.1">
      will use:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.735.1">
    stage('Preparing Infrastructure') {
      steps {
        echo '--Preparing Infrastructure Files Structure --'
        sh ''' #!/bin/bash 
        sudo mkdir -p /etc/kolla
        sudo chown $USER:$USER /etc/kolla
        cp -r /usr/local/share/kolla-ansible/etc_examples/kolla/* \
        /etc/kolla/
        cp -r /usr/local/share/kolla-ansible/ansible/inventory/* \
        /etc/kolla/
        sed -i 's/^#kolla_base_distro:.ls*/kolla_base_distro: \
        "ubuntu"/g' /etc/kolla/globals.yml
        sed -i 's/^#enable_haproxy:.*/enable_haproxy: \
        "no"/g' /etc/ kolla/globals.yml
        sed -i 's/^#network_interface:.*/network_interface: \
        "eth0"/g' /etc/kolla/globals.yml
        sed -i 's/^#neutron_external_interface:.*/neutron_external\
        _interface: "eth1"/g' /etc/kolla/globals.yml
        sed -i 's/^#kolla_internal_vip_address:.*/kolla_internal\
        _vip_address: "10.0.2.15"/g' /etc/kolla/globals.yml
        '''
      }
    }</span></pre>
   <p>
    <span class="koboSpan" id="kobo.736.1">
     The next step will generate different secrets for all OpenStack services in their configurations.
    </span>
    <span class="koboSpan" id="kobo.736.2">
     The secret file will inject
    </span>
    <a id="_idIndexMarker231">
    </a>
    <span class="koboSpan" id="kobo.737.1">
     each secret for each service during the OpenStack
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.738.1">
      service installation:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.739.1">
    stage('Secrets Setup') {
      steps {
        echo '--Generating OpenStack Services Secrets --'
        sh '''#!/bin/bash 
            kolla-genpwd -p /etc/kolla/passwords.yml
           ''' 
      }
    }</span></pre>
   <p>
    <span class="koboSpan" id="kobo.740.1">
     Next, the pipeline will instruct Jenkins to prepare the container scripts for booting, including the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.741.1">
      system configuration:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.742.1">
    stage('Boostrap Servers') {
      steps {
        echo '--Running Ansible Kolla Boostrap Server Script --'
        sh '''#!/bin/bash 
             kolla-ansible -i /etc/kolla/all-in-one bootstrap-servers
           ''' 
      }
    }</span></pre>
   <p>
    <span class="koboSpan" id="kobo.743.1">
     The next stage will run a precheck task to make sure that the bootstrap step was performed
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.744.1">
      without issues:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.745.1">
    stage('Infrastructure Pre-Checks') {
      steps {
        echo '--Running Ansible Kolla Prechecks Script --'
        sh '''#!/bin/bash 
            kolla-ansible -i /etc/kolla/all-in-one prechecks
           ''' 
      }
    }</span></pre>
   <p>
    <span class="koboSpan" id="kobo.746.1">
     The final stage is to deploy
    </span>
    <a id="_idIndexMarker232">
    </a>
    <span class="koboSpan" id="kobo.747.1">
     the services, pull the images, and run the services
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.748.1">
      in containers:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.749.1">
    stage('Deploy Infrastructure') {
      steps {
        echo '--Running Ansible Kolla Prechecks Script --'
        sh '''#!/bin/bash 
        kolla-ansible -i /etc/kolla/all-in-one deploy
        ''' 
      }
    }
  }
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.750.1">
     Make sure to have a new
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.751.1">
      testing branch:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.752.1">
$ git branch test</span></pre>
   <p>
    <span class="koboSpan" id="kobo.753.1">
     Commit and push the created file to the source code repository with the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.754.1">
      new branch:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.755.1">
$ git add Jenkinsfile
$ git commit -m 'Initial Test Environment Pipeline'
$ git push --set-upstream origin test</span></pre>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.756.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.757.1">
     Using the Jenkins file the SCM way enables us to treat the pipeline definition as code.
    </span>
    <span class="koboSpan" id="kobo.757.2">
     Make sure that all changes and updates for any job definition go through the pipeline code.
    </span>
    <span class="koboSpan" id="kobo.757.3">
     The pipeline file is written in Groovy syntax.
    </span>
    <span class="koboSpan" id="kobo.757.4">
     A recommendation is to use an IDE to highlight the Jenkins file code format in the same way as for YAML.
    </span>
    <span class="koboSpan" id="kobo.757.5">
     If your IDE does not highlight the Groovy syntax, add
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.758.1">
      #!/usr/bin/env groovy
     </span>
    </strong>
    <span class="koboSpan" id="kobo.759.1">
     to the top of the pipeline
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.760.1">
      Jenkins file.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.761.1">
     From the Jenkins user
    </span>
    <a id="_idIndexMarker233">
    </a>
    <span class="koboSpan" id="kobo.762.1">
     interface, select
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.763.1">
      New Item
     </span>
    </strong>
    <span class="koboSpan" id="kobo.764.1">
     from the top-left menu.
    </span>
    <span class="koboSpan" id="kobo.764.2">
     Select
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.765.1">
      Pipeline
     </span>
    </strong>
    <span class="koboSpan" id="kobo.766.1">
     as the type of job, with the desired name to run the test pipeline.
    </span>
    <span class="koboSpan" id="kobo.766.2">
     The next wizard creates a pipeline item,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.767.1">
      named
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.768.1">
       openstack-dev
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.769.1">
      :
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer036">
     <span class="koboSpan" id="kobo.770.1">
      <img alt="Figure 2.13 – Jenkins pipeline creation" src="image/B21716_02_13.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.771.1">
     Figure 2.13 – Jenkins pipeline creation
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.772.1">
     Select the pipeline script from SCM in the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.773.1">
      Configure
     </span>
    </strong>
    <span class="koboSpan" id="kobo.774.1">
     tab and Git by specifying the repository URL.
    </span>
    <span class="koboSpan" id="kobo.774.2">
     Make sure to configure the script of the Jenkins file in the repository
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.775.1">
      directory path:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer037">
     <span class="koboSpan" id="kobo.776.1">
      <img alt="Figure 2.14 – The Jenkins pipeline SCM job definition" src="image/B21716_02_14.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.777.1">
     Figure 2.14 – The Jenkins pipeline SCM job definition
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.778.1">
     Our first deployment setup for the testing environment
    </span>
    <a id="_idIndexMarker234">
    </a>
    <span class="koboSpan" id="kobo.779.1">
     is ready to go.
    </span>
    <span class="koboSpan" id="kobo.779.2">
     All that is left is to push the button.
    </span>
    <span class="koboSpan" id="kobo.779.3">
     Click on
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.780.1">
      Build Now
     </span>
    </strong>
    <span class="koboSpan" id="kobo.781.1">
     on the left-hand side of the newly created job definition in Jenkins, where the different stages declared in the pipeline code will
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.782.1">
      be visible:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer038">
     <span class="koboSpan" id="kobo.783.1">
      <img alt="Figure 2.15 – The Jenkins OpenStack test deployment pipeline" src="image/B21716_02_15.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.784.1">
     Figure 2.15 – The Jenkins OpenStack test deployment pipeline
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.785.1">
     Jenkins jobs that are running
    </span>
    <a id="_idIndexMarker235">
    </a>
    <span class="koboSpan" id="kobo.786.1">
     can be monitored by clicking on the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.787.1">
      Console Output
     </span>
    </strong>
    <span class="koboSpan" id="kobo.788.1">
     tab, where each stage defined in the pipeline file is reported to support further debugging and troubleshooting when possible
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.789.1">
      errors occur:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer039">
     <span class="koboSpan" id="kobo.790.1">
      <img alt="Figure 2.16 – Jenkins OpenStack test deployment output" src="image/B21716_02_16.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.791.1">
     Figure 2.16 – Jenkins OpenStack test deployment output
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.792.1">
     The Jenkins console output is very handy for troubleshooting any possible issues that could occur during the Ansible run.
    </span>
    <span class="koboSpan" id="kobo.792.2">
     Make sure the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.793.1">
      failed
     </span>
    </strong>
    <span class="koboSpan" id="kobo.794.1">
     status is
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.795.1">
      0
     </span>
    </strong>
    <span class="koboSpan" id="kobo.796.1">
     .
    </span>
    <span class="koboSpan" id="kobo.796.2">
     When the deployment status ends with the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.797.1">
      SUCCESS
     </span>
    </strong>
    <span class="koboSpan" id="kobo.798.1">
     value, we can enforce the pipeline with additional
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.799.1">
      security checks.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-62">
    <a id="_idTextAnchor106">
    </a>
    <span class="koboSpan" id="kobo.800.1">
     Deploying with security
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.801.1">
     As we emphasized
    </span>
    <a id="_idIndexMarker236">
    </a>
    <span class="koboSpan" id="kobo.802.1">
     at the start of this chapter, security should be considered in the early steps of building and deployment projects.
    </span>
    <span class="koboSpan" id="kobo.802.2">
     That is what has been defined as a
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.803.1">
      shift to the left
     </span>
    </em>
    <span class="koboSpan" id="kobo.804.1">
     .
    </span>
    <span class="koboSpan" id="kobo.804.2">
     The craft of automating security checks should be learned in testing environments to report any potential vulnerabilities before promoting the infrastructure to a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.805.1">
      production environment.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.806.1">
     Our first security enforcement will be conducted by installing an additional Jenkins plugin, which will be an interesting asset to our DevSecOps pipeline.
    </span>
    <span class="koboSpan" id="kobo.806.2">
     As we are dealing with containers as the main artifacts, we will install a container inspection plugin to perform security scans on the built containers at a later stage.
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.807.1">
      Anchore
     </span>
    </strong>
    <span class="koboSpan" id="kobo.808.1">
     is one of the most widely used container
    </span>
    <a id="_idIndexMarker237">
    </a>
    <span class="koboSpan" id="kobo.809.1">
     vulnerability-scanning platforms, providing seamless integration with CI/CD tools, source code, and even container registries for both Docker and Kubernetes.
    </span>
    <span class="koboSpan" id="kobo.809.2">
     The Anchore plugin exists for Jenkins and can be installed straightforwardly in the same way we installed the Git plugin.
    </span>
    <span class="koboSpan" id="kobo.809.3">
     On the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.810.1">
      Available plugins
     </span>
    </strong>
    <span class="koboSpan" id="kobo.811.1">
     tab, search
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.812.1">
      for
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.813.1">
       anchore
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.814.1">
      :
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer040">
     <span class="koboSpan" id="kobo.815.1">
      <img alt="Figure 2.17 – Searching for the Jenkins Anchore plugin" src="image/B21716_02_17.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.816.1">
     Figure 2.17 – Searching for the Jenkins Anchore plugin
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.817.1">
     Select the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.818.1">
      Anchore Container Image Scanner
     </span>
    </strong>
    <span class="koboSpan" id="kobo.819.1">
     plugin and click on
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.820.1">
      Install
     </span>
    </strong>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.821.1">
       without restart
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.822.1">
      :
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer041">
     <span class="koboSpan" id="kobo.823.1">
      <img alt="Figure 2.18 – The Jenkins Anchore plugin setup" src="image/B21716_02_18.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.824.1">
     Figure 2.18 – The Jenkins Anchore plugin setup
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.825.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.826.1">
     More details
    </span>
    <a id="_idIndexMarker238">
    </a>
    <span class="koboSpan" id="kobo.827.1">
     about the Anchore platform can be found
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.828.1">
      here:
     </span>
    </span>
    <a href="https://anchore.com/container-vulnerability-scanning/">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.829.1">
       https://anchore.com/container-vulnerability-scanning/
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.830.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.831.1">
     Once the plugin is installed, we need to adjust our settings
    </span>
    <a id="_idIndexMarker239">
    </a>
    <span class="koboSpan" id="kobo.832.1">
     to instruct our deployer to use a Docker repository at a specific address and port.
    </span>
    <span class="koboSpan" id="kobo.832.2">
     For this example, the image registry will be deployed in the deployer host, named
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.833.1">
      master_registry
     </span>
    </strong>
    <span class="koboSpan" id="kobo.834.1">
     , by running the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.835.1">
      following command:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.836.1">
$ sudo python3 -m pip install kolla
$  docker run -d \
   --network host \
   --name master_registry \
   --restart=always \
   -e REGISTRY_HTTP_ADDR=0.0.0.0:4000 \
   -v registry:/var/lib/registry \
   registry:2</span></pre>
   <p>
    <span class="koboSpan" id="kobo.837.1">
     Make sure to update the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.838.1">
      globals.yml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.839.1">
     file to use the local Docker registry by editing the following
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.840.1">
      configuration lines:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.841.1">
…
docker_registry: 10.0.2.15:4000
docker_registry_insecure: yes
...</span></pre>
   <p>
    <span class="koboSpan" id="kobo.842.1">
     Commit and push your changes to the main infrastructure code repository so that our CI/CD will point to the local registry in later image
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.843.1">
      build steps:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.844.1">
$ git commit -m 'Docker registry global setting'
$ git push</span></pre>
   <p>
    <span class="koboSpan" id="kobo.845.1">
     Before getting the image build pipeline
    </span>
    <a id="_idIndexMarker240">
    </a>
    <span class="koboSpan" id="kobo.846.1">
     running, we will install the Anchore engine to run the container inspection later.
    </span>
    <span class="koboSpan" id="kobo.846.2">
     The Anchore open source version comes as a Docker image that can run standalone.
    </span>
    <span class="koboSpan" id="kobo.846.3">
     Proceed by downloading the Anchore engine
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.847.1">
      docker-compose
     </span>
    </strong>
    <span class="koboSpan" id="kobo.848.1">
     file,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.849.1">
      as follows:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.850.1">
$ curl https://engine.anchore.io/docs/quickstart/docker-compose.yaml &gt; docker-compose.yaml</span></pre>
   <p>
    <span class="koboSpan" id="kobo.851.1">
     Optionally, reset the admin password defined by the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.852.1">
      ANCHORE_ADMIN_PASSWORD
     </span>
    </strong>
    <span class="koboSpan" id="kobo.853.1">
     configuration line in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.854.1">
      docker-compose.yaml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.855.1">
     file.
    </span>
    <span class="koboSpan" id="kobo.855.2">
     That will be needed for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.856.1">
      later steps.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.857.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.858.1">
     For permanent access to the Anchore engine interface, export the Anchore endpoint, username, and password to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.859.1">
      ANCHORE_CLI_URL
     </span>
    </strong>
    <span class="koboSpan" id="kobo.860.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.861.1">
      ANCHORE_CLI_USER
     </span>
    </strong>
    <span class="koboSpan" id="kobo.862.1">
     , and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.863.1">
      ANCHORE_CLI_PASS
     </span>
    </strong>
    <span class="koboSpan" id="kobo.864.1">
     environment variables, respectively.
    </span>
    <span class="koboSpan" id="kobo.864.2">
     If the variables are not populated within the operating system, you will need to export them in each run of the CI/CD
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.865.1">
      pipeline execution.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.866.1">
     Now, let’s create and run the Anchore engine
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.867.1">
      Docker container:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.868.1">
$ sudo apt install docker-compose
$ docker-compose up –d</span></pre>
   <p>
    <span class="koboSpan" id="kobo.869.1">
     The Anchore CLI is very handy to interact with the engine and can be installed
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.870.1">
      as follows:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.871.1">
$ git clone https://github.com/anchore/anchore-cli
$ cd anchore-cli
$ pip install --user --upgrade .</span></pre>
   <p>
    <span class="koboSpan" id="kobo.872.1">
     On the Jenkins dashboard, configure the installed Anchore plugin by pointing to
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.873.1">
      Manage Jenkins
     </span>
    </strong>
    <span class="koboSpan" id="kobo.874.1">
     and clicking on
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.875.1">
      System
     </span>
    </strong>
    <span class="koboSpan" id="kobo.876.1">
     .
    </span>
    <span class="koboSpan" id="kobo.876.2">
     Provide the engine
    </span>
    <a id="_idIndexMarker241">
    </a>
    <span class="koboSpan" id="kobo.877.1">
     username of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.878.1">
      admin
     </span>
    </strong>
    <span class="koboSpan" id="kobo.879.1">
     , the password, and the engine URL defined in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.880.1">
      docker-compose.yaml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.881.1">
     file for the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.882.1">
      Anchore engine:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer042">
     <span class="koboSpan" id="kobo.883.1">
      <img alt="Figure 2.19 – The Jenkins Anchore engine configuration" src="image/B21716_02_19.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.884.1">
     Figure 2.19 – The Jenkins Anchore engine configuration
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.885.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.886.1">
     The Anchore engine open source project is not maintained anymore but is still available on GitHub and Docker Hub for evaluation, along with its Jenkins plugin.
    </span>
    <span class="koboSpan" id="kobo.886.2">
     An enterprise edition has replaced the open source version.
    </span>
    <span class="koboSpan" id="kobo.886.3">
     More info on the open source Anchore engine can be found here:
    </span>
    <a href="https://github.com/anchore/anchore-engine">
     <span class="koboSpan" id="kobo.887.1">
      https://github.com/anchore/anchore-engine
     </span>
    </a>
    <span class="koboSpan" id="kobo.888.1">
     .
    </span>
    <span class="koboSpan" id="kobo.888.2">
     Other similar container security inspection solutions can be found at
    </span>
    <a href="https://github.com/anchore/syft">
     <span class="koboSpan" id="kobo.889.1">
      https://github.com/anchore/syft
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.890.1">
      and
     </span>
    </span>
    <a href="https://github.com/anchore/grype">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.891.1">
       https://github.com/anchore/grype
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.892.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.893.1">
     Building images and pushing them to the local registry can be automated by optionally using a dedicated pipeline, with the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.894.1">
      following steps:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.895.1">
      Build an OpenStack service Docker image
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.896.1">
       using Kolla.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.897.1">
      Run an Anchore security check on the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.898.1">
       pushed image.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.899.1">
      Push the created OpenStack service Docker image using Kolla if no specific vulnerabilities have been detected
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.900.1">
       by Anchore.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.901.1">
     Our image pipeline script is structured in three stages – build images, Anchore security scans, and push images – if the vulnerability
    </span>
    <a id="_idIndexMarker242">
    </a>
    <span class="koboSpan" id="kobo.902.1">
     scans are successful.
    </span>
    <span class="koboSpan" id="kobo.902.2">
     This can be depicted
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.903.1">
      as follows:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.904.1">
 pipeline {
    agent any
    stages {
        stage('Build Images') {
            steps {
                echo '-- KOLLA BUILD OPENSTACK SERVICES IMAGES --'
                sh '''#!/bin/bash
                kolla-build -b ubuntu
                '''
            }
        }
        stage('Anchore Security Scan') {
            steps {
                echo '--RUNNING LOCAL ENVIRONMENT --'
                sh '''#!/bin/bash
                anchore-cli registry add 10.0.2.15:4000
                anchore-cli image add master_registry:latest
                '''
            }
        }
        stage('Push Images') {
            steps {
                echo '--RUNNING LOCAL ENVIRONMENT --'
                sh '''#!/bin/bash
                kolla-build --registry 10.0.2.15:4000 --push
                '''
            }
        }
    }
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.905.1">
     Save the pipeline script in Jenkins
    </span>
    <a id="_idIndexMarker243">
    </a>
    <span class="koboSpan" id="kobo.906.1">
     and run the pipeline from the new
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.907.1">
      job definition:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer043">
     <span class="koboSpan" id="kobo.908.1">
      <img alt="Figure 2.20 – Running the OpenStack inspection image pipeline" src="image/B21716_02_20.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.909.1">
     Figure 2.20 – Running the OpenStack inspection image pipeline
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.910.1">
     Running the OpenStack security scan image pipeline will generate a useful vulnerability assessment and trigger a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.911.1">
      stop
     </span>
    </strong>
    <span class="koboSpan" id="kobo.912.1">
     action so that the pipeline will fail.
    </span>
    <span class="koboSpan" id="kobo.912.2">
     Anchore reports the cause of the failure from the previous run, which did not comply with the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.913.1">
      engine policy.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.914.1">
     Automating the OpenStack deployment
    </span>
    <a id="_idIndexMarker244">
    </a>
    <span class="koboSpan" id="kobo.915.1">
     by starting with a development environment helps to deliver a higher code quality empowered by security guardrails.
    </span>
    <span class="koboSpan" id="kobo.915.2">
     Cloud operators will learn about possible issues during the cloud infrastructure deployment and master how to solve them earlier.
    </span>
    <span class="koboSpan" id="kobo.915.3">
     It goes hand in hand with security and anomaly detection practices, which should support the move to production with
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.916.1">
      more confidence.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-63">
    <a id="_idTextAnchor107">
    </a>
    <span class="koboSpan" id="kobo.917.1">
     Summary
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.918.1">
     This chapter has been a quite milestone in defining the right way and best practices to run a complete OpenStack deployment in a DevSecOps style.
    </span>
    <span class="koboSpan" id="kobo.918.2">
     Inheriting modern, agile software development practices in infrastructure management is considered a great opportunity for cloud operators, and hence for DevSecOps, to focus on infrastructure improvement and extension, rather than being blocked by traditional, manual operations tasks.
    </span>
    <span class="koboSpan" id="kobo.918.3">
     The OpenStack ecosystem, with the latest additional services and functions, can be cumbersome to manage if no proper agile methods are considered from the start of the journey.
    </span>
    <span class="koboSpan" id="kobo.918.4">
     This chapter has highlighted security fusion from day one.
    </span>
    <span class="koboSpan" id="kobo.918.5">
     Silos should no longer exist between infrastructure and security duties.
    </span>
    <span class="koboSpan" id="kobo.918.6">
     Undoubtedly, that is a game changer toward a successful deployment experience, armed with security and automation.
    </span>
    <span class="koboSpan" id="kobo.918.7">
     As we have built a solid draft together with the right tooling and processes, we will take our momentum to the next chapter to extend our production design and deployment, cover OpenStack clustering, define its various services’ roles, and deploy them in a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.919.1">
      DevSecOps way.
     </span>
    </span>
   </p>
  </div>
 </body></html>