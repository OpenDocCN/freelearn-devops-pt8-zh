<html><head></head><body>
<div id="_idContainer286" class="calibre2">
<h1 class="chapter-number" id="_idParaDest-148"><a id="_idTextAnchor809" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1.1">5</span></h1>
<h1 id="_idParaDest-149" class="calibre5"><a id="_idTextAnchor810" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.2.1">Building Your Own  Structured Templates</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.3.1">It’s time to start one of the most important tasks in Zabbix: building structured templates. </span><span class="kobospan" id="kobo.3.2">A good Zabbix setup relies heavily on templating, and there is a huge difference between a good and a bad template. </span><span class="kobospan" id="kobo.3.3">So, if you’re new to Zabbix or you haven’t started building your own templates yet, then pay close attention to </span><span><span class="kobospan" id="kobo.4.1">this chapter.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.5.1">In this chapter, we will go over how to set up your templates, and how to fill them with the right </span><a id="_idIndexMarker337" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.6.1">items and triggers. </span><span class="kobospan" id="kobo.6.2">Also, it is important to make use of macros and </span><strong class="bold"><span class="kobospan" id="kobo.7.1">Low-Level Discovery</span></strong><span class="kobospan" id="kobo.8.1"> (</span><strong class="bold"><span class="kobospan" id="kobo.9.1">LLD</span></strong><span class="kobospan" id="kobo.10.1">) in the right way. </span><span class="kobospan" id="kobo.10.2">After following these recipes, you will be more than ready to build solid Zabbix templates with the right format and </span><span><span class="kobospan" id="kobo.11.1">even LLD.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.12.1">In this chapter, we’ll cover the </span><span><span class="kobospan" id="kobo.13.1">following recipes:</span></span></p>
<ul class="calibre14">
<li class="calibre15"><span class="kobospan" id="kobo.14.1">Creating your </span><span><span class="kobospan" id="kobo.15.1">Zabbix template</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.16.1">Setting up </span><span><span class="kobospan" id="kobo.17.1">template-level tags</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.18.1">Creating </span><span><span class="kobospan" id="kobo.19.1">template items</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.20.1">Creating </span><span><span class="kobospan" id="kobo.21.1">template triggers</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.22.1">Setting up different kinds </span><span><span class="kobospan" id="kobo.23.1">of macros</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.24.1">Using LLD </span><span><span class="kobospan" id="kobo.25.1">on templates</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.26.1">Nesting </span><span><span class="kobospan" id="kobo.27.1">Zabbix templates</span></span><a id="_idTextAnchor811" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor812" class="pcalibre calibre6 pcalibre1"/></li>
</ul>
<h1 id="_idParaDest-150" class="calibre5"><a id="_idTextAnchor813" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.28.1">Technical requirements</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.29.1">We will </span><a id="_idIndexMarker338" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.30.1">need our Zabbix server from </span><a href="B19803_04.xhtml#_idTextAnchor601" class="pcalibre calibre6 pcalibre1"><span><em class="italic"><span class="kobospan" id="kobo.31.1">Chapter 4</span></em></span></a><span class="kobospan" id="kobo.32.1">, </span><em class="italic"><span class="kobospan" id="kobo.33.1">Working with Triggers and Alerts</span></em><span class="kobospan" id="kobo.34.1">, to monitor our </span><strong class="bold"><span class="kobospan" id="kobo.35.1">Simple Network Management Protocol</span></strong><span class="kobospan" id="kobo.36.1"> (</span><strong class="bold"><span class="kobospan" id="kobo.37.1">SNMP</span></strong><span class="kobospan" id="kobo.38.1">) host. </span><span class="kobospan" id="kobo.38.2">For the SNMP host, we can use the host we set up in the </span><em class="italic"><span class="kobospan" id="kobo.39.1">Working with SNMP monitoring</span></em><span class="kobospan" id="kobo.40.1"> recipe in </span><a href="B19803_03_split_000.xhtml#_idTextAnchor306" class="pcalibre calibre6 pcalibre1"><span><em class="italic"><span class="kobospan" id="kobo.41.1">Chapter 3</span></em></span></a><span class="kobospan" id="kobo.42.1">, </span><em class="italic"><span class="kobospan" id="kobo.43.1">Setting Up </span></em><span><em class="italic"><span class="kobospan" id="kobo.44.1">Zabbix Monitoring</span><a id="_idTextAnchor814" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor815" class="pcalibre calibre6 pcalibre1"/></em></span><span><span class="kobospan" id="kobo.45.1">.</span></span></p>
<h1 id="_idParaDest-151" class="calibre5"><a id="_idTextAnchor816" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.46.1">Creating your Zabbix template</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.47.1">In this recipe, </span><a id="_idTextAnchor817" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.48.1">we will </span><a id="_idIndexMarker339" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.49.1">start with the basics of creating a Zabbix template. </span><span class="kobospan" id="kobo.49.2">We will go over the structure of Zabbix templating and why we need to pay attention to certain aspects </span><span><span class="kobospan" id="kobo.50.1">of templatin</span><a id="_idTextAnchor818" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor819" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.51.1">g.</span></span></p>
<h2 id="_idParaDest-152" class="calibre7"><a id="_idTextAnchor820" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.52.1">Getting ready</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.53.1">All you will need in this recipe is your </span><span><span class="kobospan" id="kobo.54.1">Zabbix serve</span><a id="_idTextAnchor821" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor822" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.55.1">r.</span></span></p>
<h2 id="_idParaDest-153" class="calibre7"><a id="_idTextAnchor823" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.56.1">How to do it…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.57.1">Now, let’s get started with building our structured </span><span><span class="kobospan" id="kobo.58.1">Zabbix template:</span></span></p>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.59.1">Open your Zabbix frontend and navigate to </span><strong class="bold"><span class="kobospan" id="kobo.60.1">Data collection</span></strong><span class="kobospan" id="kobo.61.1"> | </span><span><strong class="bold"><span class="kobospan" id="kobo.62.1">Templates</span></strong></span><span><span class="kobospan" id="kobo.63.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.64.1">On this page, click the </span><strong class="bold"><span class="kobospan" id="kobo.65.1">Create template</span></strong><span class="kobospan" id="kobo.66.1"> button in the top-right corner. </span><span class="kobospan" id="kobo.66.2">This will take you to the </span><span><span class="kobospan" id="kobo.67.1">following page</span><a id="_idTextAnchor824" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.68.1">:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer238">
<span class="kobospan" id="kobo.69.1"><img alt="Figure 5.1 – The Create template page, empty" src="image/B19803_05_01.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.70.1">Figure 5.1 – The Create template page, empty</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.71.1">At this point, we are going to need to name our template and assign a template group to it. </span><span class="kobospan" id="kobo.71.2">We will be creating an SNMP template to monitor a Linux host. </span><span class="kobospan" id="kobo.71.3">I’ll be using SNMP in the example to show how the templates </span><span><span class="kobospan" id="kobo.72.1">are structured.</span></span></p>
<p class="callout-heading"><span class="kobospan" id="kobo.73.1">Important Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.74.1">Use SNMP to monitor network equipment, custom equipment supporting SNMP, and more. </span><span class="kobospan" id="kobo.74.2">SNMP is very versatile and easy to understand, and it is implemented by a lot of hardware manufacturers. </span><span class="kobospan" id="kobo.74.3">For Linux hosts, I’d still recommend the very powerful Zabbix agent, which we covered in the </span><em class="italic"><span class="kobospan" id="kobo.75.1">Setting up Zabbix agent monitoring</span></em><span class="kobospan" id="kobo.76.1"> recipe in </span><a href="B19803_03_split_000.xhtml#_idTextAnchor306" class="pcalibre calibre6 pcalibre1"><span><em class="italic"><span class="kobospan" id="kobo.77.1">Chapter 3</span></em></span></a><span class="kobospan" id="kobo.78.1">, </span><em class="italic"><span class="kobospan" id="kobo.79.1">Setting Up </span></em><span><em class="italic"><span class="kobospan" id="kobo.80.1">Zabbix Monitoring</span></em></span><span><span class="kobospan" id="kobo.81.1">.</span></span></p>
<ol class="calibre16">
<li value="3" class="calibre15"><span class="kobospan" id="kobo.82.1">Create yo</span><a id="_idTextAnchor825" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.83.1">ur </span><a id="_idIndexMarker340" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.84.1">template with the </span><span><span class="kobospan" id="kobo.85.1">following information</span><a id="_idTextAnchor826" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.86.1">:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer239">
<span class="kobospan" id="kobo.87.1"><img alt="Figure 5.2 – The Create template page filled with information for the SNMP template" src="image/B19803_05_02.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.88.1">Figure 5.2 – The Create template page filled with information for the SNMP template</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.89.1">We will not link any </span><strong class="bold"><span class="kobospan" id="kobo.90.1">Templates</span></strong><span class="kobospan" id="kobo.91.1">, </span><strong class="bold"><span class="kobospan" id="kobo.92.1">Tags</span></strong><span class="kobospan" id="kobo.93.1">, and </span><strong class="bold"><span class="kobospan" id="kobo.94.1">Macros</span></strong><span class="kobospan" id="kobo.95.1"> yet, but we’ll address some of these functionalities later. </span><span class="kobospan" id="kobo.95.2">That’s all there is to creating our template, but there’s nothing in it besides a name, group, and description </span><span><span class="kobospan" id="kobo.96.1">so far</span><a id="_idTextAnchor827" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor828" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.97.1">.</span></span></p>
<h2 id="_idParaDest-154" class="calibre7"><a id="_idTextAnchor829" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.98.1">How it works…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.99.1">There’s not a lot of work involved in creating our first template—it’s quite straightforward. </span><span class="kobospan" id="kobo.99.2">What we need to keep in mind is the right naming </span><span><span class="kobospan" id="kobo.100.1">convention here.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.101.1">Now, you might </span><a id="_idIndexMarker341" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.102.1">think to yourself: </span><em class="italic"><span class="kobospan" id="kobo.103.1">why is naming a template so important?</span></em><span class="kobospan" id="kobo.104.1"> Well, we are going to create a lot of templates when working with Zabbix. </span><span class="kobospan" id="kobo.104.2">For example, this is a small part of the list of </span><span><span class="kobospan" id="kobo.105.1">out-of-the-box templates</span><a id="_idTextAnchor830" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.106.1">:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer240">
<span class="kobospan" id="kobo.107.1"><img alt="Figure 5.3 – Some out-of-the-box templates" src="image/B19803_05_03.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.108.1">Figure 5.3 – Some out-of-the-box templates</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.109.1">As you can see, thi</span><a id="_idTextAnchor831" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.110.1">s is already a large list, and all of these templates follow a singular straightforward naming convention. </span><span class="kobospan" id="kobo.110.2">If you look at the name of the template we have just built ourselves and, for example, the built-in Apache template, they foll</span><a id="_idTextAnchor832" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.111.1">ow the same convention. </span><span class="kobospan" id="kobo.111.2">Breaking down the convention, it looks </span><span><span class="kobospan" id="kobo.112.1">like this:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer241">
<span class="kobospan" id="kobo.113.1"><img alt="Figure 5.4 – Template naming convention explanation" src="image/B19803_05_04.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.114.1">Figure 5.4 – Template naming convention explanation</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.115.1">If we look </span><a id="_idIndexMarker342" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.116.1">at the list and compare it to the naming convention we went over in </span><span><em class="italic"><span class="kobospan" id="kobo.117.1">Figure 5</span></em></span><em class="italic"><span class="kobospan" id="kobo.118.1">.4</span></em><span class="kobospan" id="kobo.119.1">, we can see the </span><span><span class="kobospan" id="kobo.120.1">following pattern:</span></span></p>
<ul class="calibre14">
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.121.1">What are we monitoring?</span></strong><span class="kobospan" id="kobo.122.1">: (Linux) </span><a id="_idTextAnchor833" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.123.1">We name the template—in this case, we’ll call it Linux because the OS we monitor will </span><span><span class="kobospan" id="kobo.124.1">be Linux.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.125.1">Monitoring type</span></strong><span class="kobospan" id="kobo.126.1">: (by SNMP) W</span><a id="_idTextAnchor834" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.127.1">e will add our data collection method at the end of the template as we might monitor the Linux OS in other ways besides SNMP, such as the </span><span><span class="kobospan" id="kobo.128.1">Zabbix agent.</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.129.1">Adhering to the guidelines in this naming convention and thus using the correct template names is our first step in creating the correct structure for our template. </span><span class="kobospan" id="kobo.129.2">This makes it easy to find out which templates we want to use on </span><span><span class="kobospan" id="kobo.130.1">which hosts.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.131.1">In our case, we’ve also added a short custom prefix to make sure we can distinguish our template from others already created in the Zabbix setup. </span><span class="kobospan" id="kobo.131.2">Normally, we can omit this prefix, but for this book, it’s useful. </span><span class="kobospan" id="kobo.131.3">As a best practice, it is recommended to clone the default templates you’d like to use and prefix the template name with your company name or shorthand. </span><span class="kobospan" id="kobo.131.4">We do this to not overwrite the default templates and to ensure we can import the official templates later without overwriting possible changes we made. </span><span class="kobospan" id="kobo.131.5">For example, I would clone </span><em class="italic"><span class="kobospan" id="kobo.132.1">Linux by SNMP</span></em><span class="kobospan" id="kobo.133.1"> and call it </span><em class="italic"><span class="kobospan" id="kobo.134.1">OICTS Linux by SNMP</span></em><span class="kobospan" id="kobo.135.1"> for use in our company, Opensource ICT Solutions. </span><span class="kobospan" id="kobo.135.2">This would also work in a </span><strong class="bold"><span class="kobospan" id="kobo.136.1">Managed Service Provider </span></strong><span class="kobospan" id="kobo.137.1">(</span><strong class="bold"><span class="kobospan" id="kobo.138.1">MSP</span></strong><span class="kobospan" id="kobo.139.1">) environment where we’d like to have a unique template for </span><span><span class="kobospan" id="kobo.140.1">each customer</span><a id="_idTextAnchor835" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor836" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.141.1">.</span></span></p>
<h2 id="_idParaDest-155" class="calibre7"><a id="_idTextAnchor837" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.142.1">There’s more…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.143.1">When building templates, adhere to the Zabbix guidelines. </span><span class="kobospan" id="kobo.143.2">That’s what we will do in this book as well, combined with our experience in creating templates. </span><span class="kobospan" id="kobo.143.3">If you want to learn more abou</span><a id="_idTextAnchor838" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.144.1">t Zabbix templating guidelines, check the following </span><span><span class="kobospan" id="kobo.145.1">URL: </span></span><a href="https://www.zabbix.com/documentation/guidelines/en/thosts" class="pcalibre calibre6 pcalibre1"><span><span class="kobospan" id="kobo.146.1">https://www.zabbix.com/documentation/guidelines/en/thosts</span></span></a><span><span><a id="_idTextAnchor839" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor840" class="pcalibre calibre6 pcalibre1"/></span></span><span><span class="kobospan" id="kobo.147.1">.</span></span></p>
<h1 id="_idParaDest-156" class="calibre5"><a id="_idTextAnchor841" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.148.1">Setting up template-level tags</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.149.1">O</span><a id="_idTextAnchor842" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.150.1">ur next step in setting up our Zabbix template is setting up template-level tags. </span><span class="kobospan" id="kobo.150.2">Tags on the template </span><a id="_idIndexMarker343" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.151.1">level are used to give every single event (problem) created on a host by this template a tag. </span><span class="kobospan" id="kobo.151.2">The tag is then used to filter events in things such as dashboards, actions, and the </span><strong class="bold"><span class="kobospan" id="kobo.152.1">Monitoring</span></strong><span class="kobospan" id="kobo.153.1"> | </span><span><strong class="bold"><span class="kobospan" id="kobo.154.1">Problems</span></strong></span><span><span class="kobospan" id="kobo.155.1"> vie</span><a id="_idTextAnchor843" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor844" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.156.1">w.</span></span></p>
<h2 id="_idParaDest-157" class="calibre7"><a id="_idTextAnchor845" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.157.1">Getting ready</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.158.1">To get started with this recipe, you will need a Zabbix server and a template on that server, preferably the template we created in the </span><span><span class="kobospan" id="kobo.159.1">previous recip</span><a id="_idTextAnchor846" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor847" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.160.1">e.</span></span></p>
<h2 id="_idParaDest-158" class="calibre7"><a id="_idTextAnchor848" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.161.1">How to do it…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.162.1">Creati</span><a id="_idTextAnchor849" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.163.1">ng template-level tags is a way to make sure that only events created by a certain template will get a configured tag. </span><span class="kobospan" id="kobo.163.2">To get started, the first thing you will need to do is navigate to the template and follow </span><span><span class="kobospan" id="kobo.164.1">these steps:</span></span></p>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.165.1">Go to </span><strong class="bold"><span class="kobospan" id="kobo.166.1">Data collection</span></strong><span class="kobospan" id="kobo.167.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.168.1">Templates</span></strong><span class="kobospan" id="kobo.169.1"> and click on our template, which is called </span><strong class="bold"><span class="kobospan" id="kobo.170.1">Custom Linux </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.171.1">by SNMP</span></strong></span><span><span class="kobospan" id="kobo.172.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.173.1">Then, click the </span><strong class="bold"><span class="kobospan" id="kobo.174.1">Tags</span></strong><span class="kobospan" id="kobo.175.1"> tab at the top of the form, and you’ll be taken to </span><span><span class="kobospan" id="kobo.176.1">this tab</span><a id="_idTextAnchor850" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.177.1">:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer242">
<span class="kobospan" id="kobo.178.1"><img alt="Figure 5.5 – Zabbix Tags tab for the SNMP template" src="image/B19803_05_05.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.179.1">Figure 5.5 – Zabbix Tags tab for the SNMP template</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.180.1">Now, the first thing we can do is create some tags to make sure we know all the events from this template will </span><span><span class="kobospan" id="kobo.181.1">be Linux-related.</span></span></p>
<ol class="calibre16">
<li value="3" class="calibre15"><span class="kobospan" id="kobo.182.1">The first tag is already ready to be created. </span><span class="kobospan" id="kobo.182.2">Fill out </span><strong class="bold"><span class="kobospan" id="kobo.183.1">Name</span></strong><span class="kobospan" id="kobo.184.1"> as </span><strong class="source-inline1"><span class="kobospan" id="kobo.185.1">class</span></strong><span class="kobospan" id="kobo.186.1">. </span><span class="kobospan" id="kobo.186.2">Then, in the </span><strong class="bold"><span class="kobospan" id="kobo.187.1">Value</span></strong><span class="kobospan" id="kobo.188.1"> field, type </span><span><span class="kobospan" id="kobo.189.1">in </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.190.1">os</span></strong></span><span><span class="kobospan" id="kobo.191.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.192.1">For the second tag, click the small dotted-underlined </span><strong class="bold"><span class="kobospan" id="kobo.193.1">Add</span></strong><span class="kobospan" id="kobo.194.1"> button and set the </span><strong class="bold"><span class="kobospan" id="kobo.195.1">Name</span></strong><span class="kobospan" id="kobo.196.1"> for the second tag to </span><strong class="source-inline1"><span class="kobospan" id="kobo.197.1">target</span></strong><span class="kobospan" id="kobo.198.1">. </span><span class="kobospan" id="kobo.198.2">Then, in the </span><strong class="bold"><span class="kobospan" id="kobo.199.1">Value</span></strong><span class="kobospan" id="kobo.200.1"> field, type in </span><strong class="source-inline1"><span class="kobospan" id="kobo.201.1">linux</span></strong><span class="kobospan" id="kobo.202.1">. </span><span class="kobospan" id="kobo.202.2">It will look </span><span><span class="kobospan" id="kobo.203.1">like this:</span></span><a id="_idTextAnchor851" class="pcalibre calibre6 pcalibre1"/></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer243">
<span class="kobospan" id="kobo.204.1"><img alt="Figure 5.6 – Zabbix Tags tab filled out for the SNMP template" src="image/B19803_05_06.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.205.1">Figure 5.6 – Zabbix Tags tab filled out for the SNMP template</span></p>
<ol class="calibre16">
<li value="5" class="calibre15"><span class="kobospan" id="kobo.206.1">Do not forget t</span><a id="_idTextAnchor852" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.207.1">o click the blue </span><strong class="bold"><span class="kobospan" id="kobo.208.1">Update</span></strong><span class="kobospan" id="kobo.209.1"> button to save your tag to </span><span><span class="kobospan" id="kobo.210.1">this template.</span></span><a id="_idTextAnchor853" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor854" class="pcalibre calibre6 pcalibre1"/></li>
</ol>
<h2 id="_idParaDest-159" class="calibre7"><a id="_idTextAnchor855" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.211.1">How it works…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.212.1">Now, there’s a</span><a id="_idTextAnchor856" class="pcalibre calibre6 pcalibre1"/> <a id="_idIndexMarker344" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.213.1">lot more to creating tags than it might seem at first through following this recipe. </span><span class="kobospan" id="kobo.213.2">Tags play a key part in keeping your Zabbix environment structured. </span><span class="kobospan" id="kobo.213.3">You will use the template-level tags to filter in a lot of places, such as the </span><strong class="bold"><span class="kobospan" id="kobo.214.1">Monitoring</span></strong><span class="kobospan" id="kobo.215.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.216.1">Problems</span></strong><span class="kobospan" id="kobo.217.1"> window, and with a lot of events created by one host, they will improve readability by making problems easy </span><span><span class="kobospan" id="kobo.218.1">to filter.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.219.1">For example, once we have configured some triggers later in this recipe, when checking the </span><strong class="bold"><span class="kobospan" id="kobo.220.1">Monitoring</span></strong><span class="kobospan" id="kobo.221.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.222.1">Problems</span></strong><span class="kobospan" id="kobo.223.1"> page for our host, we could see something like </span><span><span class="kobospan" id="kobo.224.1">the following:</span></span><a id="_idTextAnchor857" class="pcalibre calibre6 pcalibre1"/></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer244">
<span class="kobospan" id="kobo.225.1"><img alt="Figure 5.7 – Example Monitoring | Problems page for host lar-book-agent_snmp" src="image/B19803_05_07.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.226.1">Figure 5.7 – Example Monitoring | Problems page for host lar-book-agent_snmp</span></p>
<p class="callout-heading"><span class="kobospan" id="kobo.227.1">Note regarding screenshots</span></p>
<p class="callout"><span class="kobospan" id="kobo.228.1">Some screenshots used in the book have been adjusted to fit the margins of the book pages which has resulted in lower readability of the text in the print version. </span><span class="kobospan" id="kobo.228.2">Please refer to the PDF version available here: </span><a href="https://packt.link/free-ebook/978-1-80107-832-0" class="pcalibre calibre6 pcalibre1"><span class="kobospan" id="kobo.229.1">https://packt.link/free-ebook/978-1-80107-832-0</span></a><span class="kobospan" id="kobo.230.1">; to enlarge the image and view the text with </span><span><span class="kobospan" id="kobo.231.1">more clarity.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.232.1">As you can see, the problem we are looking at here is displaying the </span><strong class="bold"><span class="kobospan" id="kobo.233.1">target:linux</span></strong><span class="kobospan" id="kobo.234.1"> and </span><strong class="bold"><span class="kobospan" id="kobo.235.1">class:os</span></strong><span class="kobospan" id="kobo.236.1"> tags at the end of the page. </span><span class="kobospan" id="kobo.236.2">The event was tagged with the template-level tag, and we can now see that it will always carry that tag, allowing us </span><span><span class="kobospan" id="kobo.237.1">to filter.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.238.1">This gives us loads of opportunities because we aren’t limited to template-level tags. </span><span class="kobospan" id="kobo.238.2">We also have host-level tags, item-level tags, and trigger-level tags. </span><span class="kobospan" id="kobo.238.3">We could tag everything from a template with </span><strong class="bold"><span class="kobospan" id="kobo.239.1">target:linux</span></strong><span class="kobospan" id="kobo.240.1"> and </span><strong class="bold"><span class="kobospan" id="kobo.241.1">class:os</span></strong><span class="kobospan" id="kobo.242.1"> or even tag a specific trigger with something </span><span><span class="kobospan" id="kobo.243.1">like </span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.244.1">department:architecture</span></strong></span><span><span class="kobospan" id="kobo.245.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.246.1">We could then, for example, create an action that sends out everything Linux-related to a certain Linux</span><a id="_idTextAnchor858" class="pcalibre calibre6 pcalibre1"/> <a id="_idIndexMarker345" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.247.1">engineering email address or Teams/Slack channel based on the </span><strong class="bold"><span class="kobospan" id="kobo.248.1">class:linux</span></strong><span class="kobospan" id="kobo.249.1"> tag, but only send specific problems with a trigger-level tag such as </span><strong class="source-inline"><span class="kobospan" id="kobo.250.1">department:architecture</span></strong><span class="kobospan" id="kobo.251.1"> to a more specific email address or </span><span><span class="kobospan" id="kobo.252.1">Teams/Slack channel.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.253.1">For more </span><a id="_idIndexMarker346" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.254.1">information regard</span><a id="_idTextAnchor859" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.255.1">ing the tag policy starting from Zabbix 6, check out the </span><span><span class="kobospan" id="kobo.256.1">following link:</span></span></p>
<p class="calibre3"><a href="https://blog.zabbix.com/tags-in-zabbix-6-0-lts-usage-subfilters-and-guidelines/19565/" class="pcalibre calibre6 pcalibre1"><span><span class="kobospan" id="kobo.257.1">https://blog.zabbix.com/tags-in-zabbix-6-0-lts-usage-subfilters-and-guidelines/19565/</span></span></a></p>
<h2 id="_idParaDest-160" class="calibre7"><a id="_idTextAnchor860" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.258.1">See also</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.259.1">In this </span><a id="_idIndexMarker347" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.260.1">chapter, the recipe titled </span><em class="italic"><span class="kobospan" id="kobo.261.1">Using LLD on templates</span></em><span class="kobospan" id="kobo.262.1"> will also explain </span><strong class="bold"><span class="kobospan" id="kobo.263.1">tag prototypes</span></strong><span class="kobospan" id="kobo.264.1">, where we will create tags automatically based on the LLD settings. </span><span class="kobospan" id="kobo.264.2">Tag prototypes are </span><a id="_idTextAnchor861" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.265.1">the recommended way of working with tags when creating discovery and are amazing for keeping templates structured. </span><span class="kobospan" id="kobo.265.2">More about </span><span><span class="kobospan" id="kobo.266.1">that lat</span><a id="_idTextAnchor862" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor863" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.267.1">er.</span></span></p>
<h1 id="_idParaDest-161" class="calibre5"><a id="_idTextAnchor864" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.268.1">Creating template items</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.269.1">Let’s </span><a id="_idTextAnchor865" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.270.1">get started </span><a id="_idIndexMarker348" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.271.1">with finally creating some real template items because, in the end, items are what it is all about in Zabbix. </span><span class="kobospan" id="kobo.271.2">Without items, we don’t have data, and without data, we do not have anything to work with in our </span><span><span class="kobospan" id="kobo.272.1">monitoring sys</span><a id="_idTextAnchor866" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor867" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.273.1">tem.</span></span></p>
<h2 id="_idParaDest-162" class="calibre7"><a id="_idTextAnchor868" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.274.1">Getting ready</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.275.1">Now, moving along, we are going to need our Zabbix server and a host that we can monitor with SNMP. </span><span class="kobospan" id="kobo.275.2">In </span><a href="B19803_03_split_000.xhtml#_idTextAnchor306" class="pcalibre calibre6 pcalibre1"><span><em class="italic"><span class="kobospan" id="kobo.276.1">Chapter 3</span></em></span></a><span class="kobospan" id="kobo.277.1">, </span><em class="italic"><span class="kobospan" id="kobo.278.1">Setting Up Zabbix Monitoring</span></em><span class="kobospan" id="kobo.279.1">, we monitored a host with SNMP, so we will use this host again. </span><span class="kobospan" id="kobo.279.2">We’ll also use the Zabbix template from the </span><span><span class="kobospan" id="kobo.280.1">previous reci</span><a id="_idTextAnchor869" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor870" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.281.1">pes.</span></span></p>
<h2 id="_idParaDest-163" class="calibre7"><a id="_idTextAnchor871" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.282.1">How to do it…</span></h2>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.283.1">First of all, let’s </span><a id="_idIndexMarker349" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.284.1">log in t</span><a id="_idTextAnchor872" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.285.1">o our Zabbix server </span><strong class="bold"><span class="kobospan" id="kobo.286.1">command-line interface</span></strong><span class="kobospan" id="kobo.287.1"> (</span><strong class="bold"><span class="kobospan" id="kobo.288.1">CLI</span></strong><span class="kobospan" id="kobo.289.1">) and enter </span><strong class="source-inline1"><span class="kobospan" id="kobo.290.1">snmpwalk</span></strong><span class="kobospan" id="kobo.291.1">, with the </span><span><span class="kobospan" id="kobo.292.1">following command:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.293.1">snmpwalk -v3 -l authPriv -u snmpv3user -a SHA -A "my_authpass" -x AES -X "my_privpass" 10.16.16.153 .1</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.294.1">Make sure </span><a id="_idIndexMarker350" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.295.1">to change the IP address </span><strong class="source-inline"><span class="kobospan" id="kobo.296.1">10.16.16.153</span></strong><span class="kobospan" id="kobo.297.1"> to your own value. </span><span class="kobospan" id="kobo.297.2">We will receive an answer such </span><span><span class="kobospan" id="kobo.298.1">as </span><a id="_idTextAnchor873" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.299.1">this:</span></span></p></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer245">
<span class="kobospan" id="kobo.300.1"><img alt="Figure 5.8 – snmpwalk reply" src="image/B19803_05_08.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.301.1">Figure 5.8 – snmpwalk reply</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.302.1">Now,</span><a id="_idTextAnchor874" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.303.1"> let’s capture our hostname in our template first, as it is an important item to have. </span><span class="kobospan" id="kobo.303.2">When </span><a id="_idIndexMarker351" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.304.1">working with SNMP, I always like to wor</span><a id="_idTextAnchor875" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.305.1">k with untranslated SNMP </span><strong class="bold"><span class="kobospan" id="kobo.306.1">Object Identifiers</span></strong><span class="kobospan" id="kobo.307.1"> (</span><strong class="bold"><span class="kobospan" id="kobo.308.1">OIDs</span></strong><span class="kobospan" id="kobo.309.1">). </span><span class="kobospan" id="kobo.309.2">For our hostname, this </span><span><span class="kobospan" id="kobo.310.1">is </span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.311.1">.1.3.6.1.2.1.1.5.0</span><a id="_idTextAnchor876" class="pcalibre calibre6 pcalibre1"/></strong></span><span><span class="kobospan" id="kobo.312.1">.</span></span></p>
<ol class="calibre16">
<li value="2" class="calibre15"><span class="kobospan" id="kobo.313.1">If we have an </span><strong class="bold"><span class="kobospan" id="kobo.314.1">Management Information Base</span></strong><span class="kobospan" id="kobo.315.1"> (</span><strong class="bold"><span class="kobospan" id="kobo.316.1">MIB</span></strong><span class="kobospan" id="kobo.317.1">), we can translate this OID to </span><a id="_idIndexMarker352" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.318.1">make sure it is actually the system name. </span><span class="kobospan" id="kobo.318.2">Enter the following command at the Zabbix </span><span><span class="kobospan" id="kobo.319.1">server CLI:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.320.1">snmptranslate .1.3.6.1.2.1.1.5.0</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.321.1">This will return the </span><span><span class="kobospan" id="kobo.322.1">following </span><a id="_idTextAnchor877" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.323.1">reply:</span></span></p></li> </ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer246">
<span class="kobospan" id="kobo.324.1"><img alt="Figure 5.9 – snmptranslate reply" src="image/B19803_05_09.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.325.1">Figure 5.9 – snmptranslate reply</span></p>
<p class="callout-heading"><span class="kobospan" id="kobo.326.1">Tip</span></p>
<p class="callout"><span class="kobospan" id="kobo.327.1">Using </span><strong class="source-inline1"><span class="kobospan" id="kobo.328.1">-On</span></strong><span class="kobospan" id="kobo.329.1"> in your SNMP command makes sure that we are receiving the OIDs instead of the MIB translation. </span><span class="kobospan" id="kobo.329.2">If we want to work the other way around, we can omit the </span><strong class="source-inline1"><span class="kobospan" id="kobo.330.1">-On</span></strong><span class="kobospan" id="kobo.331.1"> in our command and </span><strong class="source-inline1"><span class="kobospan" id="kobo.332.1">snmptranslate</span></strong><span class="kobospan" id="kobo.333.1"> the </span><span><span class="kobospan" id="kobo.334.1">translated OID.</span></span></p>
<ol class="calibre16">
<li value="3" class="calibre15"><span class="kobospan" id="kobo.335.1">N</span><a id="_idTextAnchor878" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.336.1">ow that </span><a id="_idIndexMarker353" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.337.1">we know how to get our hostname, add this to our template. </span><span class="kobospan" id="kobo.337.2">Navigate to </span><strong class="bold"><span class="kobospan" id="kobo.338.1">Data collection</span></strong><span class="kobospan" id="kobo.339.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.340.1">Templates</span></strong><span class="kobospan" id="kobo.341.1"> and select our </span><strong class="bold"><span class="kobospan" id="kobo.342.1">Custom Linux by </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.343.1">SNMP</span></strong></span><span><span class="kobospan" id="kobo.344.1"> template.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.345.1">Here, we will go to </span><strong class="bold"><span class="kobospan" id="kobo.346.1">Items</span></strong><span class="kobospan" id="kobo.347.1">. </span><span class="kobospan" id="kobo.347.2">In the upper-right corner, select </span><strong class="bold"><span class="kobospan" id="kobo.348.1">Create item</span></strong><span class="kobospan" id="kobo.349.1"> to create the </span><span><span class="kobospan" id="kobo.350.1">following</span><a id="_idTextAnchor879" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.351.1"> item:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer247">
<span class="kobospan" id="kobo.352.1"><img alt="Figure 5.10 – Item for sysName SNMP OID" src="image/B19803_05_10.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.353.1">Figure 5.10 – Item for sysName SNMP OID</span></p>
<ol class="calibre16">
<li value="5" class="calibre15"><span class="kobospan" id="kobo.354.1">Make sure to also add an item-level tag. </span><span class="kobospan" id="kobo.354.2">These are important for grouping and filtering items. </span><span class="kobospan" id="kobo.354.3">Click the </span><strong class="bold"><span class="kobospan" id="kobo.355.1">Tags</span></strong><span class="kobospan" id="kobo.356.1"> tab and add </span><span><span class="kobospan" id="kobo.357.1">the follo</span><a id="_idTextAnchor880" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.358.1">wing:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer248">
<span class="kobospan" id="kobo.359.1"><img alt="Figure 5.11 – Item for sysName SNMP OID on the Tags tab" src="image/B19803_05_11.JPG" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.360.1">Figure 5.11 – Item for sysName SNMP OID on the Tags tab</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.361.1">Now</span><a id="_idTextAnchor881" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.362.1"> that </span><a id="_idIndexMarker354" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.363.1">we have our first item, let’s create a host as well and assign this template to </span><span><span class="kobospan" id="kobo.364.1">that host.</span></span></p>
<ol class="calibre16">
<li value="6" class="calibre15"><span class="kobospan" id="kobo.365.1">Navigate to </span><strong class="bold"><span class="kobospan" id="kobo.366.1">Data collection</span></strong><span class="kobospan" id="kobo.367.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.368.1">Hosts</span></strong><span class="kobospan" id="kobo.369.1"> and click </span><strong class="bold"><span class="kobospan" id="kobo.370.1">Create host</span></strong><span class="kobospan" id="kobo.371.1"> in the top-right corner. </span><span class="kobospan" id="kobo.371.2">Create a host with the </span><span><span class="kobospan" id="kobo.372.1">following sett</span><a id="_idTextAnchor882" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.373.1">ings:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer249">
<span class="kobospan" id="kobo.374.1"><img alt="Figure 5.12 – New host with our self-created template" src="image/B19803_05_12.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.375.1">Figure 5.12 – New host with our self-created template</span></p>
<ol class="calibre16">
<li value="7" class="calibre15"><span class="kobospan" id="kobo.376.1">Don’t forget to add the macros to our new host before clicking the </span><strong class="bold"><span class="kobospan" id="kobo.377.1">Add</span></strong><span class="kobospan" id="kobo.378.1"> button. </span><span class="kobospan" id="kobo.378.2">Click on </span><strong class="bold"><span class="kobospan" id="kobo.379.1">Macro</span><a id="_idTextAnchor883" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.380.1">s</span></strong><span class="kobospan" id="kobo.381.1"> and fill in the </span><span><span class="kobospan" id="kobo.382.1">following informat</span><a id="_idTextAnchor884" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.383.1">ion:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer250">
<span class="kobospan" id="kobo.384.1"><img alt="Figure 5.13 – Add macros tab on a host" src="image/B19803_05_13.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.385.1">Figure 5.13 – Add macros tab on a host</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.386.1">Do not forget to set your macros to the type secret text to hide the passwords in </span><span><span class="kobospan" id="kobo.387.1">the frontend.</span></span></p>
<ol class="calibre16">
<li value="8" class="calibre15"><span class="kobospan" id="kobo.388.1">Now, you can click the </span><strong class="bold"><span class="kobospan" id="kobo.389.1">Add</span></strong><span class="kobospan" id="kobo.390.1"> button, and our new host will </span><span><span class="kobospan" id="kobo.391.1">be monito</span><a id="_idTextAnchor885" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor886" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.392.1">red.</span></span></li>
</ol>
<h2 id="_idParaDest-164" class="calibre7"><a id="_idTextAnchor887" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.393.1">How it works…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.394.1">When we </span><a id="_idIndexMarker355" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.395.1">create </span><a id="_idTextAnchor888" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.396.1">items such as this on our template when assigning the template to our hosts, the item will also be created on the host. </span><span class="kobospan" id="kobo.396.2">The great thing about this is that we can assign a template to multiple hosts, meaning we only have to configure the item on the template level once, instead of creating the item on every single host. </span><span class="kobospan" id="kobo.396.3">For instance, our newly created host will show the following </span><span><span class="kobospan" id="kobo.397.1">latest d</span><a id="_idTextAnchor889" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.398.1">ata:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer251">
<span class="kobospan" id="kobo.399.1"><img alt="Figure 5.14 – Monitoring | Latest data for our new host" src="image/B19803_05_14.JPG" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.400.1">Figure 5.14 – Monitoring | Latest data for our new host</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.401.1">The value for this item will then be different for all your monitored hosts, depending on the value received by </span><span><span class="kobospan" id="kobo.402.1">that host.</span></span></p>
<p class="callout-heading"><span class="kobospan" id="kobo.403.1">Important Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.404.1">When creating an SNMP item, keep the following in mind. </span><span class="kobospan" id="kobo.404.2">The </span><strong class="bold"><span class="kobospan" id="kobo.405.1">Item</span></strong><span class="kobospan" id="kobo.406.1"> field SNMP OID always contains the non-translated OID. </span><span class="kobospan" id="kobo.406.2">This is to ensure that we do not actually need MIB files for our templates </span><span><span class="kobospan" id="kobo.407.1">to work.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.408.1">Furthermore</span><a id="_idTextAnchor890" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.409.1">, the item </span><a id="_idIndexMarker356" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.410.1">key will be based on the translated OID. </span><span class="kobospan" id="kobo.410.2">In our case, the translated OID was </span><strong class="source-inline"><span class="kobospan" id="kobo.411.1">sysName</span></strong><span class="kobospan" id="kobo.412.1">, which we then turned into the </span><strong class="source-inline"><span class="kobospan" id="kobo.413.1">sysName</span></strong><span class="kobospan" id="kobo.414.1"> item key. </span><span class="kobospan" id="kobo.414.2">These are general rules that we should all abide by when creating our templates, to make sure they are structured in the same way </span><span><span class="kobospan" id="kobo.415.1">for ever</span><a id="_idTextAnchor891" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor892" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.416.1">yone.</span></span></p>
<h2 id="_idParaDest-165" class="calibre7"><a id="_idTextAnchor893" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.417.1">See also</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.418.1">To learn </span><a id="_idIndexMarker357" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.419.1">more about Zabbix and SNMP OIDs/MIBs, check out this </span><span><span class="kobospan" id="kobo.420.1">blog post:</span></span></p>
<p class="calibre3"><a href="https://blog.zabbix.com/zabbix-snmp-what-you-need-to-know-and-how-to-configure-it/10345/#sn﻿﻿mp-oid" class="pcalibre calibre6 pcalibre1"><span><span class="kobospan" id="kobo.421.1">https://blog.zabbix.com/zabbix-snmp-what-you-need-to-know-and-how-to-configure-it/10345/#sn</span><span id="_idTextAnchor894"/><span id="_idTextAnchor895"/><span class="kobospan" id="kobo.422.1">mp-oid</span></span></a></p>
<h1 id="_idParaDest-166" class="calibre5"><a id="_idTextAnchor896" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.423.1">Creating template triggers</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.424.1">C</span><a id="_idTextAnchor897" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.425.1">reating templated triggers works in roughly the same way as creating templated items or normal </span><a id="_idIndexMarker358" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.426.1">triggers. </span><span class="kobospan" id="kobo.426.2">Let’s go over the process to see how we do it and how to keep </span><span><span class="kobospan" id="kobo.427.1">it stru</span><a id="_idTextAnchor898" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor899" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.428.1">ctured.</span></span></p>
<h2 id="_idParaDest-167" class="calibre7"><a id="_idTextAnchor900" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.429.1">Getting ready</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.430.1">We will need the Zabbix server and the host from the previous recipe for </span><span><span class="kobospan" id="kobo.431.1">this </span><a id="_idTextAnchor901" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor902" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.432.1">recipe.</span></span></p>
<h2 id="_idParaDest-168" class="calibre7"><a id="_idTextAnchor903" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.433.1">How to do it…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.434.1">We have configured one item on our template so far, so let’s create a trigger for </span><span><span class="kobospan" id="kobo.435.1">this item:</span></span></p>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.436.1">Navigate to </span><strong class="bold"><span class="kobospan" id="kobo.437.1">Data collection</span></strong><span class="kobospan" id="kobo.438.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.439.1">Templates</span></strong><span class="kobospan" id="kobo.440.1"> in our Zabbix frontend and select our </span><strong class="bold"><span class="kobospan" id="kobo.441.1">Custom Linux by </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.442.1">SNMP</span></strong></span><span><span class="kobospan" id="kobo.443.1"> template.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.444.1">Now, click </span><strong class="bold"><span class="kobospan" id="kobo.445.1">Triggers</span></strong><span class="kobospan" id="kobo.446.1"> and then </span><strong class="bold"><span class="kobospan" id="kobo.447.1">Create Trigger</span></strong><span class="kobospan" id="kobo.448.1"> in the top-right corner. </span><span class="kobospan" id="kobo.448.2">This will take us to </span><a id="_idIndexMarker359" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.449.1">the next page, where we will enter the </span><span><span class="kobospan" id="kobo.450.1">following infor</span><a id="_idTextAnchor904" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.451.1">mation:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer252">
<span class="kobospan" id="kobo.452.1"><img alt="Figure 5.15 – Create trigger window for the SNMP template" src="image/B19803_05_15.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.453.1">Figure 5.15 – Create trigger window for the SNMP template</span></p>
<ol class="calibre16">
<li value="3" class="calibre15"><span class="kobospan" id="kobo.454.1">As discu</span><a id="_idTextAnchor905" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.455.1">ssed in the previous chapter, for triggers there’s also the </span><strong class="source-inline1"><span class="kobospan" id="kobo.456.1">scope</span></strong><span class="kobospan" id="kobo.457.1"> tag that we need </span><span><span class="kobospan" id="kobo.458.1">t</span><a id="_idTextAnchor906" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.459.1">o add:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer253">
<span class="kobospan" id="kobo.460.1"><img alt="Figure 5.16 – Create trigger window for the SNMP template – tag" src="image/B19803_05_16.JPG" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.461.1">Figure 5.16 – Create trigger window for the SNMP template – tag</span></p>
<ol class="calibre16">
<li value="4" class="calibre15"><span class="kobospan" id="kobo.462.1">Last, but not least, let’s edit the hostname on our host to see if the trigger is working correctly. </span><span class="kobospan" id="kobo.462.2">Change the hostname entry by executing the following command on the Linux </span><span><span class="kobospan" id="kobo.463.1">host CLI:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.464.1">hostnamectl set-hostname lar-book-agent-t</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.465.1">Then, make sure the changes take effect by executing the </span><span><span class="kobospan" id="kobo.466.1">following command:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.467.1">exec bash</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.468.1">systemctl restart</span><a id="_idTextAnchor907" class="pcalibre calibre18 pcalibre1"/><a id="_idTextAnchor908" class="pcalibre calibre18 pcalibre1"/><span class="kobospan1" id="kobo.469.1"> snmpd</span></strong></pre></li> </ol>
<h2 id="_idParaDest-169" class="calibre7"><a id="_idTextAnchor909" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.470.1">How it works…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.471.1">When editi</span><a id="_idTextAnchor910" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.472.1">ng the template, the created trigger will immediately be added to our host named </span><strong class="source-inline"><span class="kobospan" id="kobo.473.1">lar-book-templated_snmp</span></strong><span class="kobospan" id="kobo.474.1">. </span><span class="kobospan" id="kobo.474.2">This is because when we edited the template, the host was </span><a id="_idIndexMarker360" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.475.1">already configured with this template. </span><span class="kobospan" id="kobo.475.2">When we have changed the hostname, the trigger can immediately be triggered after the item is </span><span><span class="kobospan" id="kobo.476.1">polled </span><a id="_idTextAnchor911" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.477.1">again:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer254">
<span class="kobospan" id="kobo.478.1"><img alt="Figure 5.17 – Hostname has changed trigger for host lar-book-templated_snmp" src="image/B19803_05_17.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.479.1">Figure 5.17 – Hostname has changed trigger for host lar-book-templated_snmp</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.480.1">Because we used the </span><strong class="source-inline"><span class="kobospan" id="kobo.481.1">change</span></strong><span class="kobospan" id="kobo.482.1"> function in our trigger, the second time we poll this item the problem will automatically go away again. </span><span class="kobospan" id="kobo.482.2">In our case, this will happen after </span><span><span class="kobospan" id="kobo.483.1">30 minutes.</span></span></p>
<p class="callout-heading"><span class="kobospan" id="kobo.484.1">Important Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.485.1">Like a lot of other Zabbix users, I always like to use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.486.1">{HOST.NAME}</span></strong><span class="kobospan" id="kobo.487.1"> macro in trigger names, but according to Zabbix guidelines, this isn’t recommended. </span><span class="kobospan" id="kobo.487.2">If you prefer this you can still use it, but it’s a lot more useful to use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.488.1">Host</span></strong><span class="kobospan" id="kobo.489.1"> fields throughout the Zabbix frontend and the built-in macros for notifications. </span><span class="kobospan" id="kobo.489.2">This will keep trigger names short and won’t show us </span><span><span class="kobospan" id="kobo.490.1">redundant inform</span><a id="_idTextAnchor912" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor913" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.491.1">ation.</span></span></p>
<h1 id="_idParaDest-170" class="calibre5"><a id="_idTextAnchor914" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.492.1">Setting up different kinds of macros</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.493.1">When </span><a id="_idTextAnchor915" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.494.1">we </span><a id="_idIndexMarker361" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.495.1">are working with templates, a very efficient way to make your templates more useful is through the use of macros. </span><span class="kobospan" id="kobo.495.2">In this recipe, we’ll discover how to use macros to </span><span><span class="kobospan" id="kobo.496.1">d</span><a id="_idTextAnchor916" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor917" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.497.1">o this.</span></span></p>
<h2 id="_idParaDest-171" class="calibre7"><a id="_idTextAnchor918" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.498.1">Getting ready</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.499.1">We are going to need our Zabbix server and our SNMP-monitored host from the previous recipes. </span><span class="kobospan" id="kobo.499.2">We’ll also need our Zabbix template, as created in the </span><span><span class="kobospan" id="kobo.500.1">previous </span><a id="_idTextAnchor919" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor920" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.501.1">recipe.</span></span></p>
<h2 id="_idParaDest-172" class="calibre7"><a id="_idTextAnchor921" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.502.1">How to do it…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.503.1">Now, let’s st</span><a id="_idTextAnchor922" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.504.1">art </span><a id="_idIndexMarker362" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.505.1">with creating some macros on a template level. </span><span class="kobospan" id="kobo.505.2">We’ll be making two different types </span><span><span class="kobospan" id="kobo.506.1">of macros.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.507.1">Defining a user macro</span></h3>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.508.1">First, we’ll </span><a id="_idIndexMarker363" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.509.1">define a </span><a id="_idTextAnchor923" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.510.1">user macro on our template. </span><span class="kobospan" id="kobo.510.2">Navigate to </span><strong class="bold"><span class="kobospan" id="kobo.511.1">Data collection</span></strong><span class="kobospan" id="kobo.512.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.513.1">Templates</span></strong><span class="kobospan" id="kobo.514.1"> and click on our </span><strong class="bold"><span class="kobospan" id="kobo.515.1">Custom Linux by </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.516.1">SNMP</span></strong></span><span><span class="kobospan" id="kobo.517.1"> template.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.518.1">Here, we will </span><a id="_idIndexMarker364" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.519.1">go to </span><strong class="bold"><span class="kobospan" id="kobo.520.1">Macros</span></strong><span class="kobospan" id="kobo.521.1"> and fill in the </span><span><span class="kobospan" id="kobo.522.1">followin</span><a id="_idTextAnchor924" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.523.1">g fields:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer255">
<span class="kobospan" id="kobo.524.1"><img alt="Figure 5.18 – Template-level macros" src="image/B19803_05_18.JPG" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.525.1">Figure 5.18 – Template-level macros</span></p>
<ol class="calibre16">
<li value="3" class="calibre15"><span class="kobospan" id="kobo.526.1">Click on </span><strong class="bold"><span class="kobospan" id="kobo.527.1">Update</span></strong><span class="kobospan" id="kobo.528.1">, and let’s move to </span><strong class="bold"><span class="kobospan" id="kobo.529.1">Trigger</span></strong><span class="kobospan" id="kobo.530.1"> to define a </span><span><span class="kobospan" id="kobo.531.1">new </span><a id="_idTextAnchor925" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.532.1">trigger:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer256">
<span class="kobospan" id="kobo.533.1"><img alt="Figure 5.19 – Trigger creation window for the SNMP template" src="image/B19803_05_19.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.534.1">Figure 5.19 – Trigger creation window for the SNMP template</span></p>
<ol class="calibre16">
<li value="4" class="calibre15"><span class="kobospan" id="kobo.535.1">L</span><a id="_idTextAnchor926" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.536.1">et’s</span><a id="_idTextAnchor927" class="pcalibre calibre6 pcalibre1"/> <a id="_idIndexMarker365" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.537.1">also </span><a id="_idIndexMarker366" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.538.1">add the </span><span><span class="kobospan" id="kobo.539.1">tri</span><a id="_idTextAnchor928" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.540.1">gger tag:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer257">
<span class="kobospan" id="kobo.541.1"><img alt="Figure 5.20 – Trigger creation window for the SNMP template tag tab" src="image/B19803_05_20.JPG" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.542.1">Figure 5.20 – Trigger creation window for the SNMP template tag tab</span></p>
<ol class="calibre16">
<li value="5" class="calibre15"><span class="kobospan" id="kobo.543.1">Now, change the hostname entry by executing the following command on the </span><span><span class="kobospan" id="kobo.544.1">host CLI:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.545.1">hostnamectl set-hostname dev-book-agent</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.546.1">Then, make sure the changes take effect by executing the </span><span><span class="kobospan" id="kobo.547.1">following command:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.548.1">exec bash</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.549.1">systemctl restart snmpd</span></strong></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.550.1">Our trigger should fire, as shown in the </span><span><span class="kobospan" id="kobo.551.1">following scr</span><a id="_idTextAnchor929" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.552.1">eenshot:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer258">
<span class="kobospan" id="kobo.553.1"><img alt="Figure 5.21 – Trigger created problem for a hostname prefix on the lar-book-templated_snmp host" src="image/B19803_05_21.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.554.1">Figure 5.21 – Trigger created problem for a hostname prefix on the lar-book-templated_snmp host</span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.555.1">Using built-in macros</span></h3>
<ol class="calibre16">
<li value="1" class="calibre15"><span class="kobospan" id="kobo.556.1">Now, le</span><a id="_idTextAnchor930" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.557.1">t’s </span><a id="_idIndexMarker367" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.558.1">work on defining a built-i</span><a id="_idTextAnchor931" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.559.1">n macro on our template. </span><span class="kobospan" id="kobo.559.2">Navigate </span><a id="_idIndexMarker368" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.560.1">to </span><strong class="bold"><span class="kobospan" id="kobo.561.1">Data collection</span></strong><span class="kobospan" id="kobo.562.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.563.1">Templates</span></strong><span class="kobospan" id="kobo.564.1"> and click on our </span><strong class="bold"><span class="kobospan" id="kobo.565.1">Custom Linux by </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.566.1">SNMP</span></strong></span><span><span class="kobospan" id="kobo.567.1"> template.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.568.1">Now, click </span><strong class="bold"><span class="kobospan" id="kobo.569.1">Triggers</span></strong><span class="kobospan" id="kobo.570.1"> and, in the top-right corner, click on </span><strong class="bold"><span class="kobospan" id="kobo.571.1">Create trigger</span></strong><span class="kobospan" id="kobo.572.1">. </span><span class="kobospan" id="kobo.572.2">Create a trigger with the </span><span><span class="kobospan" id="kobo.573.1">following </span><a id="_idTextAnchor932" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.574.1">settings:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer259">
<span class="kobospan" id="kobo.575.1"><img alt="Figure 5.22 – Trigger creation window for hostname match" src="image/B19803_05_22.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.576.1">Figure 5.22 – Trigger creation window for hostname match</span></p>
<ol class="calibre16">
<li value="3" class="calibre15"><span class="kobospan" id="kobo.577.1">Let’s also add the </span><span><span class="kobospan" id="kobo.578.1">trig</span><a id="_idTextAnchor933" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.579.1">ger tag:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer260">
<span class="kobospan" id="kobo.580.1"><img alt="Figure 5.23 – Trigger creation window for the SNMP template – ﻿tag" src="image/B19803_05_23.JPG" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.581.1">Figure 5.23 – Trigger creation window for the SNMP template – </span><a id="_idTextAnchor934" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.582.1">tag</span></p>
<ol class="calibre16">
<li value="4" class="calibre15"><span class="kobospan" id="kobo.583.1">T</span><a id="_idTextAnchor935" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.584.1">his will then trigger a problem, </span><span><span class="kobospan" id="kobo.585.1">as ex</span><a id="_idTextAnchor936" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.586.1">pected.</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer261">
<span class="kobospan" id="kobo.587.1"><img alt="Figure 5.24 – Trigger created problem Hostname does no﻿﻿t match" src="image/B19803_05_24.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.588.1">Figure 5.24 – Trigger created problem Hostname does no</span><a id="_idTextAnchor937" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor938" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.589.1">t match</span></p>
<h2 id="_idParaDest-173" class="calibre7"><a id="_idTextAnchor939" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.590.1">How it works…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.591.1">There are </span><a id="_idIndexMarker369" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.592.1">four types of macros: built-in macros, user </span><a id="_idIndexMarker370" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.593.1">macros, expressions macros, and LLD macros. </span><span class="kobospan" id="kobo.593.2">All of these </span><a id="_idIndexMarker371" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.594.1">macros can be used on templates, but also directly </span><a id="_idIndexMarker372" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.595.1">on hosts and various other locations. </span><span class="kobospan" id="kobo.595.2">Macros are useful for creating unique values in places that would otherwise contain </span><span><span class="kobospan" id="kobo.596.1">static information.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.597.1">Let’s discover how </span><span><span class="kobospan" id="kobo.598.1">they work.</span></span></p>
<h3 class="calibre8"><span class="kobospan" id="kobo.599.1">How a user macro wo</span><a id="_idTextAnchor940" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.600.1">rks</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.601.1">Because we want all of our hosts on this template to contain </span><strong class="source-inline"><span class="kobospan" id="kobo.602.1">lar</span></strong><span class="kobospan" id="kobo.603.1"> as a prefix, we create a user macro </span><a id="_idIndexMarker373" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.604.1">at the template level. </span><span class="kobospan" id="kobo.604.2">This way, the user macro that will be used on every host with this template will be </span><span><span class="kobospan" id="kobo.605.1">the same.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.606.1">We then define our user macro in our trigger to use the value, which is </span><strong class="source-inline"><span class="kobospan" id="kobo.607.1">lar-</span></strong><span class="kobospan" id="kobo.608.1"> in this case. </span><span class="kobospan" id="kobo.608.2">We can reuse this user macro in other triggers, items, and more. </span><span class="kobospan" id="kobo.608.3">The great thing is that defining a user macro on a template level isn’t all we can do. </span><span class="kobospan" id="kobo.608.4">We can override template-level user macros by defining a host-level user macro. </span><span class="kobospan" id="kobo.608.5">So, if we want a single host to contain a different prefix, we simply use a host-level macro to override the template-level macro,</span><a id="_idTextAnchor941" class="pcalibre calibre6 pcalibre1"/> <span><span class="kobospan" id="kobo.609.1">like this:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer262">
<span class="kobospan" id="kobo.610.1"><img alt="Figure 5.25 – Host-level macros page" src="image/B19803_05_25.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.611.1">Figure 5.25 – Host-level macros page</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.612.1">If we then look at the inherited and host-level macros screen on our host, we will see </span><span><span class="kobospan" id="kobo.613.1">the </span><a id="_idTextAnchor942" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.614.1">following:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer263">
<span class="kobospan" id="kobo.615.1"><img alt="Figure 5.26 – Inherited and host-level macros page" src="image/B19803_05_26.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.616.1">Figure 5.26 – Inherited and host-level macros page</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.617.1">We see the effective value is now </span><strong class="source-inline"><span class="kobospan" id="kobo.618.1">dev-</span></strong><span class="kobospan" id="kobo.619.1">, not </span><strong class="source-inline"><span class="kobospan" id="kobo.620.1">lar-</span></strong><span class="kobospan" id="kobo.621.1">, which is exactly what we would be expecting to </span><span><span class="kobospan" id="kobo.622.1">happen here.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.623.1">Keep in mind </span><a id="_idIndexMarker374" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.624.1">the syntax always starts with a curly bracket and a dollar sign and ends with a curly bracket. </span><span class="kobospan" id="kobo.624.2">You are allowed to break the text in between with either dots or underscores. </span><span class="kobospan" id="kobo.624.3">Here are </span><span><span class="kobospan" id="kobo.625.1">some examples:</span></span></p>
<ul class="calibre14">
<li class="calibre15"><strong class="source-inline1"><span class="kobospan" id="kobo.626.1">{$</span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.627.1">MACRONAME}</span></strong></span></li>
<li class="calibre15"><strong class="source-inline1"><span class="kobospan" id="kobo.628.1">{$</span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.629.1">MACRO.NAME}</span></strong></span></li>
<li class="calibre15"><strong class="source-inline1"><span class="kobospan" id="kobo.630.1">{$</span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.631.1">MACRO_NAME}</span></strong></span></li>
</ul>
<h3 class="calibre8"><span class="kobospan" id="kobo.632.1">How a built-in macro works</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.633.1">Now, a bui</span><a id="_idTextAnchor943" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.634.1">lt-in macro comes from a predefined list of macros, hardcoded within Zabbix. </span><span class="kobospan" id="kobo.634.2">They are </span><a id="_idIndexMarker375" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.635.1">used to get data from your Zabbix system and put them in items, triggers, and more. </span><span class="kobospan" id="kobo.635.2">This means that the built-in macro used in this case already contains </span><span><span class="kobospan" id="kobo.636.1">a value.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.637.1">In this case, we used </span><strong class="source-inline"><span class="kobospan" id="kobo.638.1">{HOST.HOST}</span></strong><span class="kobospan" id="kobo.639.1">, which is the hostname we defined on our Zabbix host,</span><a id="_idTextAnchor944" class="pcalibre calibre6 pcalibre1"/> <span><span class="kobospan" id="kobo.640.1">like this:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer264">
<span class="kobospan" id="kobo.641.1"><img alt="Figure 5.27 – Zabbix host configuration page for host lar-book-templated_snmp" src="image/B19803_05_27.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.642.1">Figure 5.27 – Zabbix host configuration page for host lar-book-templated_snmp</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.643.1">For every single host, this built-in macro would be different as our </span><strong class="bold"><span class="kobospan" id="kobo.644.1">Host name</span></strong><span class="kobospan" id="kobo.645.1"> value will be unique. </span><span class="kobospan" id="kobo.645.2">This means that our trigger, although defined on a template level, will always be unique as well. </span><span class="kobospan" id="kobo.645.3">This method is a very powerful way to use built-in macros in triggers, as we’ll pull information from Zabbix directly into </span><span><span class="kobospan" id="kobo.646.1">Zabbix again.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.647.1">Keep in mind the </span><a id="_idIndexMarker376" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.648.1">syntax always starts with a curly bracket and ends with a curly bracket. </span><span class="kobospan" id="kobo.648.2">You are allowed to break the text in between with either dots or underscores. </span><span class="kobospan" id="kobo.648.3">Here are </span><span><span class="kobospan" id="kobo.649.1">some examples:</span></span></p>
<ul class="calibre14">
<li class="calibre15"><strong class="source-inline1"><span class="kobospan" id="kobo.650.1">{</span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.651.1">HOST.NAME}</span></strong></span></li>
<li class="calibre15"><strong class="source-inline1"><span class="kobospan" id="kobo.652.1">{</span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.653.1">INVENTORY.L</span><a id="_idTextAnchor945" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor946" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.654.1">OCATION.LAT}</span></strong></span></li>
</ul>
<h2 id="_idParaDest-174" class="calibre7"><a id="_idTextAnchor947" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.655.1">There’s more…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.656.1">A c</span><a id="_idTextAnchor948" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.657.1">omplete list of supported (built-in) macros can be </span><span><span class="kobospan" id="kobo.658.1">found here:</span></span></p>
<p class="calibre3"><a href="https://www.zabbix.com/documentation/current/en/manual/appendix/macros/supported_by_location" class="pcalibre calibre6 pcalibre1"><span><span class="kobospan" id="kobo.659.1">https://www.zabbix.com/documentation/current/en/manual/appendix/macros/supported_by_location</span></span></a></p>
<p class="calibre3"><span class="kobospan" id="kobo.660.1">This list will be updated by Zabbix, just as with every good Zabbix documentation page. </span><span class="kobospan" id="kobo.660.2">This way, you can always use this page as a reference for up-to-date (built-in) macros for building your </span><span><span class="kobospan" id="kobo.661.1">Zabb</span><a id="_idTextAnchor949" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor950" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.662.1">ix elements.</span></span></p>
<h1 id="_idParaDest-175" class="calibre5"><span class="kobospan" id="kobo.663.1">Using LLD on template</span><a id="_idTextAnchor951" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.664.1">s</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.665.1">Now, let’</span><a id="_idTextAnchor952" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.666.1">s </span><a id="_idIndexMarker377" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.667.1">get started on my favorite part of template creation: LLD. </span><span class="kobospan" id="kobo.667.2">I think this is one of the most powerful and most widely used par</span><a id="_idTextAnchor953" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor954" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.668.1">ts </span><span><span class="kobospan" id="kobo.669.1">of Zabbix.</span></span></p>
<h2 id="_idParaDest-176" class="calibre7"><a id="_idTextAnchor955" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.670.1">Getting ready</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.671.1">To get ready for this recipe, you will need your Zabbix server, the SNMP-monitored host from the previous recipes, and our template from the </span><span><span class="kobospan" id="kobo.672.1">previous recipe.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.673.1">Working knowledge of the SNMP tree structure is also recommended. </span><span class="kobospan" id="kobo.673.2">So, make sure to read the </span><em class="italic"><span class="kobospan" id="kobo.674.1">Working with SNMP monitoring</span></em><span class="kobospan" id="kobo.675.1"> recipe in </span><a href="B19803_03_split_000.xhtml#_idTextAnchor306" class="pcalibre calibre6 pcalibre1"><span><em class="italic"><span class="kobospan" id="kobo.676.1">Chapter 3</span></em></span></a><span class="kobospan" id="kobo.677.1">, </span><em class="italic"><span class="kobospan" id="kobo.678.1">Setting Up Zabbix </span></em><span><em class="italic"><span class="kobospan" id="kobo.679.1">Monitoring</span><a id="_idTextAnchor956" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor957" class="pcalibre calibre6 pcalibre1"/></em></span><span><span class="kobospan" id="kobo.680.1">, thoroughly.</span></span></p>
<h2 id="_idParaDest-177" class="calibre7"><a id="_idTextAnchor958" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.681.1">How to do it…</span></h2>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.682.1">Let’s get started by navigating to </span><strong class="bold"><span class="kobospan" id="kobo.683.1">Data collection</span></strong><span class="kobospan" id="kobo.684.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.685.1">Templates</span></strong><span class="kobospan" id="kobo.686.1"> and selecting our </span><strong class="bold"><span class="kobospan" id="kobo.687.1">Custom Linux by </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.688.1">SNMP</span></strong></span><span><span class="kobospan" id="kobo.689.1"> template.</span></span></li>
</ol>
<p class="callout-heading"><span class="kobospan" id="kobo.690.1">Important Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.691.1">First, we will add a value mapping, which we’ll use for multiple item prototypes. </span><span class="kobospan" id="kobo.691.2">Keep in mind that value mappings since Zabbix 6 are no longer global, but template- or host-specific. </span><span class="kobospan" id="kobo.691.3">This is to make sure that the templates and hosts (once exported) are even more independent from the global </span><span><span class="kobospan" id="kobo.692.1">Zabbix sett</span><a id="_idTextAnchor959" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.693.1">ings.</span></span></p>
<ol class="calibre16">
<li value="2" class="calibre15"><span class="kobospan" id="kobo.694.1">Click on </span><a id="_idIndexMarker378" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.695.1">the </span><strong class="bold"><span class="kobospan" id="kobo.696.1">Value </span><a id="_idTextAnchor960" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.697.1">mapping</span></strong><span class="kobospan" id="kobo.698.1"> tab and the dotted </span><strong class="bold"><span class="kobospan" id="kobo.699.1">Add</span></strong><span class="kobospan" id="kobo.700.1"> button. </span><span class="kobospan" id="kobo.700.2">Add </span><span><span class="kobospan" id="kobo.701.1">t</span><a id="_idTextAnchor961" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.702.1">he following:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer265">
<span class="kobospan" id="kobo.703.1"><img alt="Figure 5.28 – Zabbix add Value mapping p﻿age" src="image/B19803_05_28.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.704.1">Figure 5.28 – Zabbix add Value mapping p</span><a id="_idTextAnchor962" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.705.1">age</span></p>
<ol class="calibre16">
<li value="3" class="calibre15"><span class="kobospan" id="kobo.706.1">Make sure to save this change by clicking the bl</span><a id="_idTextAnchor963" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.707.1">ue </span><strong class="bold"><span class="kobospan" id="kobo.708.1">Add</span></strong><span class="kobospan" id="kobo.709.1"> button and then the blue </span><span><strong class="bold"><span class="kobospan" id="kobo.710.1">Update</span></strong></span><span><span class="kobospan" id="kobo.711.1"> button.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.712.1">Now, go back </span><a id="_idIndexMarker379" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.713.1">to the template and go to </span><strong class="bold"><span class="kobospan" id="kobo.714.1">Discovery rules</span></strong><span class="kobospan" id="kobo.715.1">, and in the top-right corner, click </span><strong class="bold"><span class="kobospan" id="kobo.716.1">Create discovery rule</span></strong><span class="kobospan" id="kobo.717.1">. </span><span class="kobospan" id="kobo.717.2">This will take you to the LLD </span><span><span class="kobospan" id="kobo.718.1">c</span><a id="_idTextAnchor964" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.719.1">reation page:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer266">
<span class="kobospan" id="kobo.720.1"><img alt="Figure 5.29 – Zabbix LLD creation page, empty﻿" src="image/B19803_05_29.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.721.1">Figure 5.29 – Zabbix LLD creation page, empty</span><a id="_idTextAnchor965" class="pcalibre calibre6 pcalibre1"/></p>
<p class="calibre3"><span class="kobospan" id="kobo.722.1">Now, we will be maki</span><a id="_idTextAnchor966" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.723.1">ng a discovery rule to discover our interfaces on the Linux host. </span><span class="kobospan" id="kobo.723.2">The Linux SNMP tree for interfaces is at </span><span><span class="kobospan" id="kobo.724.1">OID </span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.725.1">.1.3.6.1.2.1.2</span></strong></span><span><span class="kobospan" id="kobo.726.1">.</span></span></p>
<p class="callout-heading"><span class="kobospan" id="kobo.727.1">Important Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.728.1">Make sure that Linux </span><strong class="source-inline1"><span class="kobospan" id="kobo.729.1">net-snmp</span></strong><span class="kobospan" id="kobo.730.1"> is configured correctly in the </span><strong class="source-inline1"><span class="kobospan" id="kobo.731.1">/etc/ snmp/snmpd.conf</span></strong><span class="kobospan" id="kobo.732.1"> file. </span><span class="kobospan" id="kobo.732.2">It’s important to change the view in this file to show everything from </span><strong class="source-inline1"><span class="kobospan" id="kobo.733.1">.1</span></strong><span class="kobospan" id="kobo.734.1"> and up, like this: </span><strong class="source-inline1"><span class="kobospan" id="kobo.735.1">view systemview </span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.736.1">included .1</span></strong></span></p>
<ol class="calibre16">
<li value="5" class="calibre15"><span class="kobospan" id="kobo.737.1">Now, let’s </span><a id="_idIndexMarker380" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.738.1">continue with creating our LLD rule by adding the following to our LLD </span><span><span class="kobospan" id="kobo.739.1">c</span><a id="_idTextAnchor967" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.740.1">reation page:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer267">
<span class="kobospan" id="kobo.741.1"><img alt="Figure 5.30 – Zabbix LLD creation page filled with our information for network interface di﻿scovery" src="image/B19803_05_30.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.742.1">Figure 5.30 – Zabbix LLD creation page filled with our information for network interface di</span><a id="_idTextAnchor968" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.743.1">scovery</span></p>
<ol class="calibre16">
<li value="6" class="calibre15"><span class="kobospan" id="kobo.744.1">After clicking the </span><strong class="bold"><span class="kobospan" id="kobo.745.1">A</span><a id="_idTextAnchor969" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.746.1">dd</span></strong><span class="kobospan" id="kobo.747.1"> button, we can navigate back to our template at </span><strong class="bold"><span class="kobospan" id="kobo.748.1">Data collection</span></strong><span class="kobospan" id="kobo.749.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.750.1">Templates</span></strong><span class="kobospan" id="kobo.751.1"> and click </span><strong class="bold"><span class="kobospan" id="kobo.752.1">Custom Linux </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.753.1">by SNMP</span></strong></span><span><span class="kobospan" id="kobo.754.1">.</span></span></li>
</ol>
<p class="callout-heading"><span class="kobospan" id="kobo.755.1">Important Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.756.1">We define </span><strong class="bold"><span class="kobospan" id="kobo.757.1">Delete lost resources</span></strong><span class="kobospan" id="kobo.758.1"> as </span><strong class="bold"><span class="kobospan" id="kobo.759.1">immediately</span></strong><span class="kobospan" id="kobo.760.1">; we do this because this is a test template. </span><span class="kobospan" id="kobo.760.2">This option is used by LLD to remove created resources (such as items and triggers) if they are no longer present on our monitored host. </span><span class="kobospan" id="kobo.760.3">Using </span><strong class="bold"><span class="kobospan" id="kobo.761.1">immediately</span></strong><span class="kobospan" id="kobo.762.1"> can lead to lost data because we might get a resource back within a set amount of time, so make sure to adjust this value to your production </span><span><span class="kobospan" id="kobo.763.1">environment’s standard.</span></span></p>
<ol class="calibre16">
<li value="7" class="calibre15"><span class="kobospan" id="kobo.764.1">Go to </span><strong class="bold"><span class="kobospan" id="kobo.765.1">Discovery rules</span></strong><span class="kobospan" id="kobo.766.1"> and click our newly created rule, </span><strong class="bold"><span class="kobospan" id="kobo.767.1">Discover </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.768.1">Network interfaces</span></strong></span><span><span class="kobospan" id="kobo.769.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.770.1">Now, go </span><a id="_idIndexMarker381" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.771.1">to </span><strong class="bold"><span class="kobospan" id="kobo.772.1">Item prototypes</span></strong><span class="kobospan" id="kobo.773.1"> and click </span><strong class="bold"><span class="kobospan" id="kobo.774.1">Create item prototype</span></strong><span class="kobospan" id="kobo.775.1"> in the top-right corner. </span><span class="kobospan" id="kobo.775.2">This will open the </span><strong class="bold"><span class="kobospan" id="kobo.776.1">Item prot</span><a id="_idTextAnchor970" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.777.1">otype</span></strong><span class="kobospan" id="kobo.778.1"> creation popup, as shown in the </span><span><span class="kobospan" id="kobo.779.1">followin</span><a id="_idTextAnchor971" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.780.1">g screenshot:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer268">
<span class="kobospan" id="kobo.781.1"><img alt="Figure 5.31 – Zabbix LLD Item prototype creation page, empty" src="image/B19803_05_31.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.782.1">Figure 5.31 – Zabbix LLD Item prototype creation page, empty</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.783.1">Here, we will create our first prototype for creating items from LLD. </span><span class="kobospan" id="kobo.783.2">This means we have to fill it with the information we want our items </span><span><span class="kobospan" id="kobo.784.1">to contain.</span></span></p>
<ol class="calibre16">
<li value="9" class="calibre15"><span class="kobospan" id="kobo.785.1">Let’s </span><a id="_idIndexMarker382" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.786.1">start by filling in an item prototype for the interface operational statu</span><a id="_idTextAnchor972" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.787.1">s, </span><span><span class="kobospan" id="kobo.788.1">like this:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer269">
<span class="kobospan" id="kobo.789.1"><img alt="Figure 5.32 – Zabbix LLD item prototype creation page filled with our information for the interface’s operational status" src="image/B19803_05_32.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.790.1">Figure 5.32 – Zabbix LLD item prototype creation page filled with our information for the interface’s operational status</span></p>
<ol class="calibre16">
<li value="10" class="calibre15"><span class="kobospan" id="kobo.791.1">On the </span><a id="_idTextAnchor973" class="pcalibre calibre6 pcalibre1"/><strong class="bold"><span class="kobospan" id="kobo.792.1">Tags</span></strong><span class="kobospan" id="kobo.793.1"> tab, mak</span><a id="_idTextAnchor974" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.794.1">e sure to also add a tag prototype</span><a id="_idTextAnchor975" class="pcalibre calibre6 pcalibre1"/> <span><span class="kobospan" id="kobo.795.1">as follows:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer270">
<span class="kobospan" id="kobo.796.1"><img alt="Figure 5.33 – Zabbix LLD item prototype tag creation tab" src="image/B19803_05_33.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.797.1">Figure 5.33 – Zabbix LLD item prototype tag creation tab</span></p>
<p class="callout-heading"><span class="kobospan" id="kobo.798.1">Tip</span></p>
<p class="callout"><span class="kobospan" id="kobo.799.1">In the next step, we’ll create an item that is very similar to the item we just created. </span><span class="kobospan" id="kobo.799.2">It’s super useful to use the </span><strong class="bold"><span class="kobospan" id="kobo.800.1">Clone</span></strong><span class="kobospan" id="kobo.801.1"> button instead of filling in the entire form from </span><span><span class="kobospan" id="kobo.802.1">scratch </span><a id="_idTextAnchor976" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.803.1">again.</span></span></p>
<ol class="calibre16">
<li value="11" class="calibre15"><span class="kobospan" id="kobo.804.1">After </span><a id="_idIndexMarker383" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.805.1">clicking the </span><strong class="bold"><span class="kobospan" id="kobo.806.1">Add</span></strong> <a id="_idTextAnchor977" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.807.1">button, let’s repeat the process and also add the following </span><span><span class="kobospan" id="kobo.808.1">ite</span><a id="_idTextAnchor978" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.809.1">m prototype:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer271">
<span class="kobospan" id="kobo.810.1"><img alt="Figure 5.34 – Zabbix LLD item prototype creation page filled with our information for the interface admin status" src="image/B19803_05_34.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.811.1">Figure 5.34 – Zabbix LLD item prototype creation page filled with our information for the interface admin status</span></p>
<ol class="calibre16">
<li value="12" class="calibre15"><span class="kobospan" id="kobo.812.1">Do not forget th</span><a id="_idTextAnchor979" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.813.1">e </span><span><strong class="bold"><span class="kobospan" id="kobo.814.1">Tags</span></strong></span><span><span class="kobospan" id="kobo.815.1"> tab:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer272">
<span class="kobospan" id="kobo.816.1"><img alt="Figure 5.35 – Zabbix LLD item 2 prototype tag creation tab" src="image/B19803_05_35.JPG" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.817.1">Figure 5.35 – Zabbix LLD item 2 prototype tag creation tab</span></p>
<ol class="calibre16">
<li value="13" class="calibre15"><span class="kobospan" id="kobo.818.1">Now, move </span><a id="_idIndexMarker384" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.819.1">over to the </span><strong class="bold"><span class="kobospan" id="kobo.820.1">Trigger prototype</span></strong><span class="kobospan" id="kobo.821.1"> page, click the </span><strong class="bold"><span class="kobospan" id="kobo.822.1">Create trigg</span><a id="_idTextAnchor980" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.823.1">er</span></strong><span class="kobospan" id="kobo.824.1"> prototype button in </span><a id="_idTextAnchor981" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.825.1">the top-right corner, and create the </span><span><span class="kobospan" id="kobo.826.1">followi</span><a id="_idTextAnchor982" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.827.1">ng trigger:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer273">
<span class="kobospan" id="kobo.828.1"><img alt="Figure 5.36 – Zabbix LLD trigger prototype creation page filled with our information for interface link status" src="image/B19803_05_36.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.829.1">Figure 5.36 – Zabbix LLD trigger prototype creation page filled with our information for interface link status</span></p>
<ol class="calibre16">
<li value="14" class="calibre15"><span class="kobospan" id="kobo.830.1">Last but not least, add the </span><span><span class="kobospan" id="kobo.831.1">tr</span><a id="_idTextAnchor983" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.832.1">igger tag:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer274">
<span class="kobospan" id="kobo.833.1"><img alt="Figure 5.37 – Zabbix LLD trigger prototype creation pag﻿﻿e Tags tab" src="image/B19803_05_37.JPG" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.834.1">Figure 5.37 – Zabbix LLD trigger prototype creation pag</span><a id="_idTextAnchor984" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor985" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.835.1">e Tags tab</span></p>
<h2 id="_idParaDest-178" class="calibre7"><a id="_idTextAnchor986" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.836.1">How it works…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.837.1">L</span><a id="_idTextAnchor987" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.838.1">LD is quite an extensive topic in Zabbix, but by following the steps in this recipe you should be </span><a id="_idIndexMarker385" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.839.1">able to apply what you learn here to almost every form of LLD there is to configure in Zabbix. </span><span class="kobospan" id="kobo.839.2">First of all, let’s look at how </span><span><span class="kobospan" id="kobo.840.1">discovery works.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.841.1">In the discovery rule, we just configured </span><span><span class="kobospan" id="kobo.842.1">the </span><a id="_idTextAnchor988" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.843.1">following:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer275">
<span class="kobospan" id="kobo.844.1"><img alt="Figure 5.38 – Zabbix LLD discovery key and OID for key net.if.discovery" src="image/B19803_05_38.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.845.1">Figure 5.38 – Zabbix LLD discovery key and OID for key net.if.discovery</span></p>
<p class="callout-heading"><span class="kobospan" id="kobo.846.1">Tip</span></p>
<p class="callout"><span class="kobospan" id="kobo.847.1">Zabbix LLD works by using a specific JSON format. </span><span class="kobospan" id="kobo.847.2">When creating discovery rules, we can always go to the discovery rules at the host level and use the </span><strong class="bold"><span class="kobospan" id="kobo.848.1">Test</span></strong><span class="kobospan" id="kobo.849.1"> button. </span><span class="kobospan" id="kobo.849.2">This should then show us what the JSON Zabbix uses </span><span><span class="kobospan" id="kobo.850.1">looks like.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.851.1">W</span><a id="_idTextAnchor989" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.852.1">hat we are basically saying here is that for every interface after OID </span><strong class="source-inline"><span class="kobospan" id="kobo.853.1">.1.3.6.1.2.1.2.2.1.2</span></strong><span class="kobospan" id="kobo.854.1">, we fill in the </span><strong class="source-inline"><span class="kobospan" id="kobo.855.1">{#IFNAME}</span></strong><span class="kobospan" id="kobo.856.1"> LLD macro. </span><span class="kobospan" id="kobo.856.2">In our case, we will end up with the </span><span><span class="kobospan" id="kobo.857.1">following OIDs:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.858.1">
.1.3.6.1.2.1.2.2.1.2.1 = STRING: lo
.1.3.6.1.2.1.2.2.1.2.2 = STRING: ens192</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.859.1">So, we are saving these for use in our prototypes. </span><span class="kobospan" id="kobo.859.2">Now, when we look at what we did to our </span><strong class="bold"><span class="kobospan" id="kobo.860.1">Operational status</span></strong><span class="kobospan" id="kobo.861.1"> prototype, this all </span><span><span class="kobospan" id="kobo.862.1">comes </span><a id="_idTextAnchor990" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.863.1">together:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer276">
<span class="kobospan" id="kobo.864.1"><img alt="Figure 5.39 – Zabbix LLD item prototype name, type, key, and OID" src="image/B19803_05_39.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.865.1">Figure 5.39 – Zabbix LLD item prototype name, type, key, and OID</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.866.1">We are </span><a id="_idIndexMarker386" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.867.1">telling our item prototype to create an item for every single </span><strong class="source-inline"><span class="kobospan" id="kobo.868.1">{#IFNAME}</span></strong><span class="kobospan" id="kobo.869.1"> value using the key defined plus the </span><strong class="source-inline"><span class="kobospan" id="kobo.870.1">{#SNMPINDEX}</span></strong><span class="kobospan" id="kobo.871.1"> LLD macro. </span><strong class="source-inline"><span class="kobospan" id="kobo.872.1">SNMPINDEX</span></strong><span class="kobospan" id="kobo.873.1"> is the last number of our SNMP poll. </span><span class="kobospan" id="kobo.873.2">In this case, we would see </span><span><span class="kobospan" id="kobo.874.1">the following:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.875.1">
.1.3.6.1.2.1.2.2.1.8.1 = INTEGER: up(1)
.1.3.6.1.2.1.2.2.1.8.2 = INTEGER: up(1)</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.876.1">For all the vendors in the world, there’s a set of predefined SNMP rules they should adhere to. </span><span class="kobospan" id="kobo.876.2">Our first interface entry when polling </span><strong class="source-inline"><span class="kobospan" id="kobo.877.1">.1.3.6.1.2.1.2.2.1.2</span></strong><span class="kobospan" id="kobo.878.1"> was the </span><strong class="source-inline"><span class="kobospan" id="kobo.879.1">.1</span></strong><span class="kobospan" id="kobo.880.1"> SNMPINDEX with the value </span><strong class="source-inline"><span class="kobospan" id="kobo.881.1">lo</span></strong><span class="kobospan" id="kobo.882.1">. </span><span class="kobospan" id="kobo.882.2">This means that when polling </span><strong class="source-inline"><span class="kobospan" id="kobo.883.1">.1.3.6.1.2.1.2.2.1.8</span></strong><span class="kobospan" id="kobo.884.1">, the </span><strong class="source-inline"><span class="kobospan" id="kobo.885.1">.1</span></strong><span class="kobospan" id="kobo.886.1"> SNMPINDEX here should still contain a value </span><span><span class="kobospan" id="kobo.887.1">for </span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.888.1">lo</span></strong></span><span><span class="kobospan" id="kobo.889.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.890.1">Zabbix LLD will now create an item with the name </span><strong class="source-inline"><span class="kobospan" id="kobo.891.1">Interface lo: Operational status</span></strong><span class="kobospan" id="kobo.892.1">, which will poll the </span><span><span class="kobospan" id="kobo.893.1">SNMP OID:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.894.1">
.1.3.6.1.2.1.2.2.1.8.1 = INTEGER: up(1)</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.895.1">It will a</span><a id="_idTextAnchor991" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.896.1">lso create an item with the name </span><strong class="source-inline"><span class="kobospan" id="kobo.897.1">Interface ens192: Operational status</span></strong><span class="kobospan" id="kobo.898.1">, which will poll the </span><span><span class="kobospan" id="kobo.899.1">SNMP OID:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.900.1">
.1.3.6.1.2.1.2.2.1.8.2 = INTEGER: up(1)</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.901.1">The </span><a id="_idIndexMarker387" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.902.1">created items will then look </span><a id="_idTextAnchor992" class="pcalibre calibre6 pcalibre1"/><span><span class="kobospan" id="kobo.903.1">like this:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer277">
<span class="kobospan" id="kobo.904.1"><img alt="Figure 5.40 – Zabbix latest data screen for our SNMP-monitored host" src="image/B19803_05_40.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.905.1">Figure 5.40 – Zabbix latest data screen for our SNMP-monitored host</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.906.1">Besides creating these LLD items, we also created an LLD trigger prototype. </span><span class="kobospan" id="kobo.906.2">This works in the same manner as item prototypes. </span><span class="kobospan" id="kobo.906.3">If we check our host triggers, we can see two </span><span><span class="kobospan" id="kobo.907.1">created </span><a id="_idTextAnchor993" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.908.1">triggers:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer278">
<span class="kobospan" id="kobo.909.1"><img alt="Figure 5.41 – Our SNMP-monitored host triggers" src="image/B19803_05_41.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.910.1">Figure 5.41 – Our SNMP-monitored host triggers</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.911.1">These triggers have been created in the same manner as the items and are then filled with the correct items for </span><span><span class="kobospan" id="kobo.912.1">trigge</span><a id="_idTextAnchor994" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.913.1">ring on:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer279">
<span class="kobospan" id="kobo.914.1"><img alt="Figure 5.42 – Our SNMP-monitored host trigger for ens192" src="image/B19803_05_42.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.915.1">Figure 5.42 – Our SNMP-monitored host trigger for ens192</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.916.1">W</span><a id="_idTextAnchor995" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.917.1">e can </span><a id="_idIndexMarker388" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.918.1">see that for the interface operation status, we have an SNMPINDEX of </span><strong class="source-inline"><span class="kobospan" id="kobo.919.1">2</span></strong><span class="kobospan" id="kobo.920.1">, and we have the same for the </span><strong class="source-inline"><span class="kobospan" id="kobo.921.1">Interface ens192: Admin status</span></strong><span class="kobospan" id="kobo.922.1"> item as well. </span><span class="kobospan" id="kobo.922.2">Our trigger will now trigger when the operation status is </span><strong class="source-inline"><span class="kobospan" id="kobo.923.1">0</span></strong><span class="kobospan" id="kobo.924.1"> (</span><em class="italic"><span class="kobospan" id="kobo.925.1">down</span></em><span class="kobospan" id="kobo.926.1">) and our admin status is </span><span><strong class="source-inline"><span class="kobospan" id="kobo.927.1">1</span></strong></span><span><span class="kobospan" id="kobo.928.1"> (</span></span><span><em class="italic"><span class="kobospan" id="kobo.929.1">up</span></em></span><span><span class="kobospan" id="kobo.930.1">).</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.931.1">A neat trigger, to make sure we only have a problem when the admin status is </span><em class="italic"><span class="kobospan" id="kobo.932.1">up</span></em><span class="kobospan" id="kobo.933.1">; after all, we only want our interface down alert when we configure the interface to be </span><span><span class="kobospan" id="kobo.934.1">admin </span></span><span><em class="italic"><span class="kobospan" id="kobo.935.1">up</span></em></span><span><span class="kobospan" id="kobo.936.1">.</span></span></p>
<p class="callout-heading"><span class="kobospan" id="kobo.937.1">Tip</span></p>
<p class="callout"><span class="kobospan" id="kobo.938.1">It’s possible to use discovery filters to only add the interfaces that have admin status </span><em class="italic"><span class="kobospan" id="kobo.939.1">up</span></em><span class="kobospan" id="kobo.940.1"> to our monitoring. </span><span class="kobospan" id="kobo.940.2">This way, we keep our required Zabbix server performance lower and our data cleaner. </span><span class="kobospan" id="kobo.940.3">Consider using discovery filters for use cases such</span><a id="_idTextAnchor996" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor997" class="pcalibre calibre6 pcalibre1"/> <span><span class="kobospan" id="kobo.941.1">as this.</span></span></p>
<h2 id="_idParaDest-179" class="calibre7"><a id="_idTextAnchor998" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.942.1">See also</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.943.1">Discov</span><a id="_idTextAnchor999" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.944.1">ery is an extensive subject and takes a while to master. </span><span class="kobospan" id="kobo.944.2">It’s something that can be used like we did in this chapter with SNMP, but also with the Zabbix agent, and for a lot of other use cases. </span><span class="kobospan" id="kobo.944.3">Once you start working with Zabbix discovery and you keep it structured, that’s when you’ll start building the best templates you’ve </span><span><span class="kobospan" id="kobo.945.1">seen yet.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.946.1">Check out </span><a id="_idIndexMarker389" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.947.1">the followi</span><a id="_idTextAnchor1000" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.948.1">ng link for the Zabbix </span><span><span class="kobospan" id="kobo.949.1">LLD documentation:</span></span></p>
<p class="calibre3"><a href="https://www.zabbix.com/documentation/current/en/manual/discovery/low_level_discovery" class="pcalibre calibre6 pcalibre1"><span><span class="kobospan" id="kobo.950.1">https://www.zabbix.com/documentation/current/en/manual/discovery/low_level_discovery</span></span></a></p>
<h1 id="_idParaDest-180" class="calibre5"><a id="_idTextAnchor1001" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.951.1">Nesting Zabbix templates</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.952.1">Usi</span><a id="_idTextAnchor1002" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.953.1">ng a simple template per device or group of devices is in most cases the best practice way to </span><a id="_idIndexMarker390" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.954.1">create Zabbix templates, but it isn’t the only way. </span><span class="kobospan" id="kobo.954.2">We can also use nested templates to break pieces of them apart and put them back together in the highest template in </span><span><span class="kobospan" id="kobo.955.1">the hierarchy.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.956.1">In this recipe, we’ll go over how to configure th</span><a id="_idTextAnchor1003" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor1004" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.957.1">is </span><span><span class="kobospan" id="kobo.958.1">and why.</span></span></p>
<h2 id="_idParaDest-181" class="calibre7"><a id="_idTextAnchor1005" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.959.1">Getting ready</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.960.1">We are going to need our Zabbix server, our SNMP-monitored host, and the template we created in the </span><span><span class="kobospan" id="kobo.961.1">previ</span><a id="_idTextAnchor1006" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor1007" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.962.1">ous recipe.</span></span></p>
<h2 id="_idParaDest-182" class="calibre7"><a id="_idTextAnchor1008" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.963.1">How to do it…</span></h2>
<ol class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.964.1">Let’s start by navigating to our </span><strong class="bold"><span class="kobospan" id="kobo.965.1">Data collection</span></strong><span class="kobospan" id="kobo.966.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.967.1">Templates</span></strong><span class="kobospan" id="kobo.968.1"> page and clicking the </span><strong class="bold"><span class="kobospan" id="kobo.969.1">Create template</span></strong><span class="kobospan" id="kobo.970.1"> button in the </span><span><span class="kobospan" id="kobo.971.1">top-right corner.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.972.1">We are going to create a new template for monitoring the uptime of our SNMP host. </span><span class="kobospan" id="kobo.972.2">Input the </span><span><span class="kobospan" id="kobo.973.1">following in</span><a id="_idTextAnchor1009" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.974.1">formation:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer280">
<span class="kobospan" id="kobo.975.1"><img alt="Figure 5.43 – New template creation page for uptime with SNMP" src="image/B19803_05_43.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.976.1">Figure 5.43 – New template creation page for uptime with SNMP</span></p>
<ol class="calibre16">
<li value="3" class="calibre15"><span class="kobospan" id="kobo.977.1">N</span><a id="_idTextAnchor1010" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.978.1">ext, we are </span><a id="_idIndexMarker391" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.979.1">going to click the </span><strong class="bold"><span class="kobospan" id="kobo.980.1">Add</span></strong><span class="kobospan" id="kobo.981.1"> button and click our </span><strong class="bold"><span class="kobospan" id="kobo.982.1">Custom Linux uptime by SNMP</span></strong><span class="kobospan" id="kobo.983.1"> template name. </span><span class="kobospan" id="kobo.983.2">This will take us to the template </span><span><span class="kobospan" id="kobo.984.1">editing screen.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.985.1">Click on </span><strong class="bold"><span class="kobospan" id="kobo.986.1">Items</span></strong><span class="kobospan" id="kobo.987.1"> and </span><strong class="bold"><span class="kobospan" id="kobo.988.1">Create item</span></strong><span class="kobospan" id="kobo.989.1"> in the top-right corner. </span><span class="kobospan" id="kobo.989.2">We will create an example item here, </span><a id="_idTextAnchor1011" class="pcalibre calibre6 pcalibre1"/><span><span class="kobospan" id="kobo.990.1">like this:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer281">
<span class="kobospan" id="kobo.991.1"><img alt="Figure 5.44 – A new item on the template creation page called System Uptime" src="image/B19803_05_44.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.992.1">Figure 5.44 – A new item on the template creation page called System Uptime</span></p>
<ol class="calibre16">
<li value="5" class="calibre15"><span class="kobospan" id="kobo.993.1">Do not forget to add a tag, as shown in the screenshot, by going to the </span><a id="_idTextAnchor1012" class="pcalibre calibre6 pcalibre1"/><span><strong class="bold"><span class="kobospan" id="kobo.994.1">Tags</span></strong></span><span><span class="kobospan" id="kobo.995.1"> tab:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer282">
<span class="kobospan" id="kobo.996.1"><img alt="Figure 5.45 – New item on the template creation page, System Uptime, Tags tab" src="image/B19803_05_45.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.997.1">Figure 5.45 – New item on the template creation page, System Uptime, Tags tab</span></p>
<ol class="calibre16">
<li value="6" class="calibre15"><span class="kobospan" id="kobo.998.1">Make sure </span><a id="_idIndexMarker392" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.999.1">to click the blue </span><strong class="bold"><span class="kobospan" id="kobo.1000.1">Add</span></strong><span class="kobospan" id="kobo.1001.1"> button to finish adding </span><span><span class="kobospan" id="kobo.1002.1">this item.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1003.1">Now, let’s navigate to our original template by going back to the </span><strong class="bold"><span class="kobospan" id="kobo.1004.1">Data collection</span></strong><span class="kobospan" id="kobo.1005.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.1006.1">Templates</span></strong><span class="kobospan" id="kobo.1007.1"> page and clicking </span><strong class="bold"><span class="kobospan" id="kobo.1008.1">Custom Linux </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.1009.1">by SNMP</span></strong></span><span><span class="kobospan" id="kobo.1010.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1011.1">On this</span><a id="_idTextAnchor1013" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1012.1"> page, link a template to the current template by adding it in the </span><strong class="bold"><span class="kobospan" id="kobo.1013.1">Templates</span></strong><span class="kobospan" id="kobo.1014.1"> entry field, </span><span><span class="kobospan" id="kobo.1015.1">l</span><a id="_idTextAnchor1014" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1016.1">ike this:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer283">
<span class="kobospan" id="kobo.1017.1"><img alt="Figure 5.46 – Template link page for master SNMP template" src="image/B19803_05_46.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1018.1">Figure 5.46 – Template link page for master SNMP template</span></p>
<ol class="calibre16">
<li value="9" class="calibre15"><span class="kobospan" id="kobo.1019.1">Click on the blue </span><strong class="bold"><span class="kobospan" id="kobo.1020.1">Update</span></strong><span class="kobospan" id="kobo.1021.1"> button to finish linking </span><span><span class="kobospan" id="kobo.1022.1">the template.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.1023.1">Last, but not least, navigate to </span><strong class="bold"><span class="kobospan" id="kobo.1024.1">Data collection</span></strong><span class="kobospan" id="kobo.1025.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.1026.1">Hosts</span></strong><span class="kobospan" id="kobo.1027.1">, click our </span><strong class="source-inline1"><span class="kobospan" id="kobo.1028.1">lar-book- templated_snmp</span></strong><span class="kobospan" id="kobo.1029.1"> SNMP-monitored host, and check out the </span><strong class="bold"><span class="kobospan" id="kobo.1030.1">Items</span></strong><span class="kobospan" id="kobo.1031.1"> page if the item </span><span><span class="kobospan" id="kobo.1032.1">is </span><a id="_idTextAnchor1015" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1033.1">present:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer284">
<span class="kobospan" id="kobo.1034.1"><img alt="Figure 5.47 – Our Hosts | Items page for host lar-book-templated_snmp" src="image/B19803_05_47.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1035.1">Figure 5.47 – Our Hosts | Items page for host lar-book-templated_snmp</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1036.1">The item is present, and it shows it’s actually from another template. </span><span class="kobospan" id="kobo.1036.2">That’s all there is to do to link a template—using these nested templates is easy to work with but harder to keep it structured. </span><span class="kobospan" id="kobo.1036.3">Let’s see how </span><span><span class="kobospan" id="kobo.1037.1">thi</span><a id="_idTextAnchor1016" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor1017" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1038.1">s works.</span></span></p>
<h2 id="_idParaDest-183" class="calibre7"><a id="_idTextAnchor1018" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1039.1">How it works…</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1040.1">Nesting </span><a id="_idIndexMarker393" class="pcalibre calibre6 pcalibre1"/><a id="_idTextAnchor1019" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1041.1">templates have a simple tree structure, just </span><span><span class="kobospan" id="kobo.1042.1">li</span><a id="_idTextAnchor1020" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1043.1">ke this:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer285">
<span class="kobospan" id="kobo.1044.1"><img alt="Figure 5.48 – Template nesting tree structure" src="image/B19803_05_48.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1045.1">Figure 5.48 – Template nesting tree structure</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1046.1">So, we</span><a id="_idTextAnchor1021" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1047.1"> have our Zabbix-monitored host, which in turn has </span><strong class="source-inline"><span class="kobospan" id="kobo.1048.1">Custom Linux by SNMP</span></strong><span class="kobospan" id="kobo.1049.1"> linked as the only template. </span><span class="kobospan" id="kobo.1049.2">Now, because we have a nested template on </span><strong class="source-inline"><span class="kobospan" id="kobo.1050.1">Custom Linux by SNMP</span></strong><span class="kobospan" id="kobo.1051.1"> (which is, of course, </span><strong class="source-inline"><span class="kobospan" id="kobo.1052.1">Custom Linux uptime by SNMP</span></strong><span class="kobospan" id="kobo.1053.1">), the items on that template will also be linked to our </span><span><span class="kobospan" id="kobo.1054.1">Zabbix-monitored host.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1055.1">We can use this for a great deal of cases—one of my favorites is for networking equipment. </span><span class="kobospan" id="kobo.1055.2">If we have a Juniper EX (or Cisco Catalyst) and a Juniper QFX (or Cisco Nexus) series </span><a id="_idIndexMarker394" class="pcalibre calibre6 pcalibre1"/><span class="kobospan" id="kobo.1056.1">switch, both series switches use the same SNMP discovery for interfaces. </span><span class="kobospan" id="kobo.1056.2">So, we can create a template for interfaces and nest it in the main template of the EX or QFX series, which use different SNMP OIDs for </span><span><span class="kobospan" id="kobo.1057.1">other values.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1058.1">This way, we don’t have to write the same discovery rules, items, graphs, and everything else on a template a hundred times. </span><span class="kobospan" id="kobo.1058.2">We can simply do it once and nest the </span><span><span class="kobospan" id="kobo.1059.1">template neatly.</span></span></p>
</div>
</body></html>