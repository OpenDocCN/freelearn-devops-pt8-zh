<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Using an Application Load Balancer</h1>
                </header>
            
            <article>
                
<p>While some Docker containers accept TCP client requests, other Docker containers accept client requests on an HTTP path. As demonstrated in <a href="20fbdcad-0dd7-4066-aafb-1bc74b268b33.xhtml" target="_blank">Chapter 2</a>, <em>Networking,</em> an HTTP request to a Hello World application task could be made on the public IP address exposed by the Hello World task. An ECS service includes built-in internal load balancing to distribute client traffic between the tasks in a service.</p>
<p><strong>Problem :</strong> Each task in an ECS service with Fargate launch is associated with an ENI and a public IP. When an application is scaled up to run multiple tasks, multiple ENIs are created, and each task must be accessed on its public IP address.</p>
<p>Although internal load balancing is provided, no provision is included to balance client traffic externally between the different tasks' IP addresses. A single task could receive an inordinate number of client requests, while another task could receive relatively fewer client requests, or even none, which would result in an imbalance in the routing of the external client load, as illustrated <span>in the following diagram</span>. If the task (or tasks) to which the client load is directed fails, the application fails to serve any client requests. High availability of an ECS hosted application is not provided. E<span>xposing containers directly to the public is not the best security practice.</span></p>
<p><span>It is always recommended to put them behind an ELB to allow network traffic control in terms of security.</span></p>
<p class="CDPAlignCenter"><img src="assets/d390093f-da0e-47f4-b1be-69b68b5641a9.png" style="width:28.08em;height:26.08em;"/></p>
<p><strong>Solution:</strong> With an HTTP protocol application such as the Hello World application, an EC2 <span class="packt_screen">Application Load Balancer</span> may be used to route HTTP client requests to the different tasks in an ECS service. An <span class="packt_screen">Application Load Balancer</span> is an external load balancer that exposes a public DNS, and all client requests are directed to the single public DNS. The <span class="packt_screen">Application Load Balancer</span> balances the client load between the application's tasks, providing the high availability of an ECS-hosted application as a result, as illustrated in the following diagram. Even if one of the tasks were to fail, the <span class="packt_screen">Application Load Balancer</span> would direct the client traffic to tasks that are still available:</p>
<p class="CDPAlignCenter"><img src="assets/44b40f99-41d3-4b35-ac05-a4fca0aa5c55.png" style="width:27.67em;height:25.75em;"/></p>
<p><span>In this chapter, we will learn about the following:</span></p>
<ul>
<li>Creating an application load balancer</li>
<li>Creating a task definition</li>
<li>Creating a service</li>
<li>Configuring an application load balancer</li>
<li>Invoking the Hello World application</li>
<li>Stopping tasks and deleting a load balancer</li>
</ul>
<p>The only prerequisite is having an AWS account.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating an application load balancer</h1>
                </header>
            
            <article>
                
<p class="mce-root">The following procedure is used to configure a Fargate ECS service with an application load Balancer:</p>
<ol>
<li>Create an application load balancer</li>
<li>Create a task definition</li>
</ol>
<ol start="3">
<li>Create a service</li>
<li>Configure the application load balancer with the service</li>
<li>Invoke the service</li>
</ol>
<p class="mce-root">First, we shall create an application load balancer:</p>
<ol>
<li>Open the EC2 Console in a browser by going to <a href="https://console.aws.amazon.com/ec2">https://console.aws.amazon.com/ec2</a>, and select <span class="packt_screen">Load Balancing</span> | <span class="packt_screen">Load Balancers</span>.</li>
<li>Click on <span class="packt_screen">Create Load Balancer</span>, as shown in the following screenshot:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/973a9144-42bb-40de-a7e6-90c0ab1fa7f2.png"/></div>
<ol start="3">
<li>In <span class="packt_screen">Select load balancer type</span>, click on <span class="packt_screen">Create</span> for the <span class="packt_screen">Application Load Balancer</span>, as shown in the following screenshot. An application load balancer is used for <span class="packt_screen">HTTP</span>/<span class="packt_screen">HTTPS</span> request protocols.</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/dff068e8-3c1a-4a32-9d07-ff5f59408871.png" style="text-align: center;font-size: 1em;"/></div>
<ol start="4">
<li>In <span class="packt_screen">Configure Load Balancer</span>, specify a load balancer name (<kbd>hello-world-lb</kbd>) in the <span class="packt_screen">Basic Configuration</span>, as shown <span>in the following screenshot,</span> and select <span class="packt_screen">internet-facing</span> as the <span class="packt_screen">Scheme</span>. Only a-z, A-Z, 0-9, and hyphens may be used in the load balancer name.</li>
<li>Select <span><span class="packt_screen">ipv4</span> as the </span><span class="packt_screen">IP address type</span>.</li>
<li>In the <span class="packt_screen">Listeners</span> <span>section, a listener is configured with <span class="packt_screen">HTTP</span> as the</span> <span class="packt_screen">Load Balancer Protocol</span>,<span class="packt_screen"> </span><span>and</span> <kbd>80</kbd> as the <span><span class="packt_screen">Load Balancer Port</span></span><span>:</span></li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/16cc7e74-e9c7-4bb8-ad43-35eb69fc2f5b.png" style="text-align: center;font-size: 1em;"/></div>
<ol start="7">
<li>Scroll down and choose a VPC. Select at least the availability zones to which the load balancer is going to route traffic. Click on <span class="packt_screen">Next</span>.</li>
<li>The <span class="packt_screen">Configure Security Settings</span> page will then be displayed for an <span class="packt_screen">HTTPS</span> listener. If the load balancer should use an HTTPS protocol listener, that should be configured on the previous screen in the <span class="packt_screen">Listeners</span> section, and the security settings should be configured on the <span class="packt_screen">Configure Security Settings</span> page. Because we are only using an <span class="packt_screen">HTTP</span> listener, we don’t need to configure any security settings. Click on <span class="packt_screen">Next</span>.</li>
<li>Configure <span class="packt_screen">Security Groups</span> for the load balancer. Select <span class="packt_screen">Create a new security group</span> and select the default <span class="packt_screen">Security group name</span>, which is also shown <span>in the following screenshot</span>. </li>
</ol>
<ol start="10">
<li>Select <span class="packt_screen">All traffic</span> as the <span class="packt_screen">Type</span>, a <span class="packt_screen">Protocol</span> of <span class="packt_screen">All</span>, <span class="packt_screen">Port Range</span> of <span class="packt_screen">0-65535</span>, and <span class="packt_screen">Custom</span> as the <span class="packt_screen">Source</span>, with CIDR as default routes for IPv4 and IPv6 (<span class="packt_screen">0.0.0.0/0, ::/0</span>). Click on <span class="packt_screen">Next</span>:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/0c0ee9c3-2793-4c63-b7ba-deea06c3c1f3.png" style="text-align: center;font-size: 1em;width:44.00em;height:19.08em;"/></div>
<ol start="11">
<li>In <span class="packt_screen">Configure Routing</span>, configure a target group to which the load balancer will route requests. The load balancer routes requests only to targets in the configured target group. Select the <span class="packt_screen">New Target group</span> option in <span class="packt_screen">Target group</span>, and specify a <span class="packt_screen">Name</span> (<kbd>hello-world-tg</kbd>), as shown <span>in the following screenshot</span>.</li>
<li>Select <span class="packt_screen">H</span><span class="packt_screen">TTP</span> as the <span class="packt_screen">Protocol</span> and <kbd>80</kbd> as the <span class="packt_screen">Port</span>.</li>
<li>Select <span class="packt_screen">ip</span> as the <span class="packt_screen">Target type</span> and c<span>lick on</span> <span class="packt_screen">Next</span><span>:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/f886e62e-f72b-41f3-89a5-45965be7951b.png" style="text-align: center;font-size: 1em;width:42.58em;height:18.50em;"/></div>
<ol start="14">
<li>With a Target type of ip, targets in the following CIDR blocks may be added: 10.0.0.0/8, 100.64.0.0/10, 172.16<span>.0.0/12, and 192.168.0.0/16.</span></li>
<li> On the <span class="packt_screen">Register Targets</span> screen (shown in the following screenshot), we won’t register targets, as Fargate does that automatically when an ECS service using the application load balancer is created. Click on <span class="packt_screen">Next</span>:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/46bd842b-c8eb-4662-b17e-0656e85e449f.png"/></div>
<ol start="16">
<li>Review the configuration for the application load balancer. Click on <span class="packt_screen">Create</span>, as shown <span>in the following screenshot:</span></li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/0a5d5b6c-e3f4-40cf-a1cb-cbb25a9d54c7.png"/></div>
<ol start="17">
<li>The application load balancer gets created, as indicated by the <span class="packt_screen">Load Balancer Creation Status</span> dialog. Click on <span class="packt_screen">Close</span>.</li>
<li>The <kbd>hello-world-lb</kbd> <span>load balancer is listed in the load balancer table, as shown in the following screenshot. Initially, the status (</span><span class="packt_screen">State</span><span>) is </span><span class="packt_screen">p</span><span class="packt_screen">rovisioning</span><span>. Click on</span> <span class="packt_screen">Refresh</span> <span>to refresh the <span class="packt_screen">State</span>:</span></li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/c9c94960-3f2c-4fe4-bb3a-331f2e0585f7.png" style="text-align: center;font-size: 1em;"/></div>
<ol start="19">
<li>When the load balancer becomes available, its <span class="packt_screen">State</span> becomes <span class="packt_screen">active</span>, as shown <span>in the following screenshot</span>:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/d2507718-ee31-4573-94a0-6274ae68a60f.png"/></div>
<ol start="20">
<li>A target group, <kbd>hello-world-tg</kbd>, gets created, also shown <span>in the following screenshot:</span></li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/62374b77-d17a-47bd-8840-b781e61dbbde.png"/></div>
<ol start="21">
<li>Select the <span class="packt_screen">Targets</span> tab and no targets should initially be listed, as none have been configured yet.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a task definition</h1>
                </header>
            
            <article>
                
<p>In this section, we will create a task definition for a <kbd>hello-world</kbd> application using the <kbd>tutum/hello-world</kbd> Docker image. Another Docker image that exposes a HTTP port may also be used, but not all Docker images may be used. As an unsuitable example, the MySQL database Docker image, <kbd>mysql</kbd>, cannot be used with an application load balancer, as it exposes a TCP port, <kbd>3306</kbd>. For an ECS task that exposes a TCP port, a network load balancer should be used.</p>
<ol>
<li><span>To create a new task definition, select</span> <span><span class="packt_screen">Task Definitions</span></span> <span>in the ECS console, as shown in the following screenshot:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/d52a3938-dd14-4ff1-bc16-15b9b0bb775e.png" style="color: black;font-size: 1em;"/></div>
<ol start="2">
<li>In <span class="packt_screen">Task Definitions</span>, <span>click on</span> <span class="packt_screen">Create new Task Definition</span>, <span>as shown in the following screenshot:</span></li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/5e717e88-aab8-4fd7-9a5d-3e88c7ae3378.png" style="text-align: center;font-size: 1em;"/></div>
<ol start="3">
<li>In <span class="packt_screen">Create new</span> <span class="packt_screen">Task Definition</span>, <span>select</span> <span class="packt_screen">Fargate</span> as the l<span>aunch type compatibility, as</span><span> shown in the following screenshot. </span><span>Scroll down and </span><span>click on</span><span> </span><span class="packt_screen">Next step</span>:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/552c212a-a053-401f-80c8-8854e51ef641.png" style="text-align: center;font-size: 1em;"/></div>
<ol start="4">
<li>In <span class="packt_screen">Configure task and container definitions</span>, specify a <span class="packt_screen">Task Definition Name</span> (<span class="packt_screen">hello-world-task-definition</span>) and select <span class="packt_screen">e</span><span class="packt_screen">csTaskExecutionRole</span> as the <span class="packt_screen">Task Role</span>, as shown <span>in the following screenshot</span>.</li>
</ol>
<ol start="5">
<li>The <span class="packt_screen">Network Mode</span> <span>is</span> <span class="packt_screen">awsvpc</span> <span>for Fargate, and cannot be modified as it is the only one supported, as shown in the following screenshot:</span></li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/73812fd6-33b0-4a51-ba43-6f4ddf1cce7b.png" style="text-align: center;font-size: 1em;"/></div>
<ol start="6">
<li>Select <span class="packt_screen">excsTaskExecutionRole</span> as the <span class="packt_screen">Task execution IAM role</span><span>, </span>as shown <span>in the following screenshot</span>. This role is required to send container logs to CloudWatch:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/c26ff6df-44b3-4674-ba80-d86b030fe13d.png"/></div>
<ol start="7">
<li><span>In</span> <span class="packt_screen">Task size</span><span>, </span><span>select</span> <span><span class="packt_screen">0.5GB</span> as the <span class="packt_screen">Task memory</span>, as shown in the following screenshot. Select</span> <span><span class="packt_screen">0.25 vCPU</span> as the <span class="packt_screen">Task CPU</span>:</span></li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/71b18a7c-9d9d-4c98-9cd1-44f49bf8bd21.png" style="text-align: center;font-size: 1em;"/></div>
<ol start="8">
<li>To add a container definition, click on <span class="packt_screen">Add container</span> in <span class="packt_screen">Container Definitions</span>, as shown in the following screenshot:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/52412e0f-de6c-4c84-8fd6-c0a455247cb1.png"/></div>
<ol start="9">
<li class="mce-root"><span>I</span>n <span class="packt_screen">Add container</span>, specify <span class="packt_screen">Container name</span> (<kbd>hello-world</kbd>), <span class="packt_screen">Image</span> (<kbd>tutum/hello-world</kbd>), and <span class="packt_screen">Memo<span>ry Limits</span></span>, <span>as</span> <span>shown</span><span> in the following screenshot:</span></li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/45081d75-9012-4b03-8811-aa761cd2ed71.png" style="text-align: center;font-size: 1em;"/></div>
<ol start="10">
<li>Set <span class="packt_screen">Container port</span> to <kbd>80</kbd> in <span class="packt_screen">Port mappings</span>, as shown in the following screenshot:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/6a32f944-dbae-4a11-ae59-9e7152e5d223.png"/></div>
<ol start="11">
<li><span>In <span class="packt_screen">Advanced container configuration</span> | <span class="packt_screen">ENVIRONMENT</span>, set <span class="packt_screen">CPU units</span> to <kbd>10</kbd> and check the <span class="packt_screen">Essential</span> checkbox, as shown in the following screenshot, as one container in a task must be essential to the running of a task and the <kbd>hello-world</kbd> </span>conta<span>iner is the only container, it must be configured as</span> <span class="packt_screen">Essential</span>:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/f298811a-e618-42aa-a37d-eefe1fb65ba9.png" style="text-align: center;font-size: 1em;width:44.42em;height:33.58em;"/></div>
<ol start="12">
<li>After configuring all the container definition settings, click on <span class="packt_screen">Add</span> in <span class="packt_screen">Add container</span>. A container definition gets added, as shown <span>in the following screenshot</span>.</li>
<li>Click on <span class="packt_screen">Create</span> to create the task definition, which includes the container definition:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/dff11224-b81b-433d-8379-5c1f21071fd1.png"/></div>
<ol start="14">
<li><span>The task definition gets created, as shown in the </span><span class="packt_screen">Launch Status</span> dialog<span>. Click on</span> <span class="packt_screen">View task definition</span><span>,</span><span> as shown in in the following screenshot:</span></li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/d944c2b3-20ed-4dd3-808a-a267f8c0d301.png"/></div>
<ol start="15">
<li><span>A new task definition</span> <span class="packt_screen">Builder</span> <span>and detailed</span> <span><span class="packt_screen">JSON</span> </span><span>information gets displayed, as shown</span> <span>in the following screenshot</span><span>. </span><span class="packt_screen">Requires compatibilities</span> <span>must be set to </span><span class="packt_screen">FARGATE</span><span>, as shown</span> <span>in the following screenshot:</span></li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/2d5dbc04-8860-47b6-9496-6a7ba6e5c127.png"/></div>
<ol start="16">
<li>Select <span class="packt_screen">Task Definitions</span> <span>from the margin navigation. The task definition gets listed in the </span><span class="packt_screen">Task Definitions</span> table, as shown <span>in the following screenshot:</span></li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/1d533462-0edd-428a-9e08-71aa2d2f37fb.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a service</h1>
                </header>
            
            <article>
                
<p>A service is an implementation of a task definition, and runs tasks. To create a service, a cluster must be selected.</p>
<ol>
<li><span>Click on the</span> <span class="packt_screen">default</span> <span>cluster link, as shown <span>in the following screenshot:</span></span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/3dba1ff5-bba8-414c-aaf1-40db8dd0eaf2.png" style="text-align: center;color: black;font-size: 1em;"/></div>
<ol start="2">
<li><span>Select the</span> <span class="packt_screen">Services</span> <span>tab and click on</span> <span class="packt_screen">Create</span><span>, as shown</span> <span>in the following screenshot:</span></li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/12e091a2-7447-4cb2-b94e-147b3779afc6.png"/></div>
<ol start="3">
<li>In <span class="packt_screen">Configure service</span>, select <span class="packt_screen">FARGATE</span> as the <span class="packt_screen">Launch type</span> and select the <span class="packt_screen">Task definition</span> created earlier.</li>
<li>Select <span class="packt_screen">LATEST </span>as the <span class="packt_screen">Platform version</span>. The default cluster should be listed as selected, because we selected default to start with.</li>
<li>Specify a <span class="packt_screen">Service name</span> (<kbd>hello-world-service</kbd>) and set <span class="packt_screen">Number of tasks</span> to <span class="packt_screen">3</span>, as shown <span>in the following screenshot:</span></li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/25179249-5a50-4793-ba3a-7bf607cfffc7.png"/></div>
<ol start="6">
<li>Leaving the other settings as their defaults, click on <span class="packt_screen">Next</span> step.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring an application load balancer</h1>
                </header>
            
            <article>
                
<p>In this section, we shall configure the application load balancer.</p>
<ol>
<li><span>First, select a</span> <span><span class="packt_screen">Cluster VPC</span></span> <span>and two</span> <span><span class="packt_screen">Subnets</span></span>, <span>as shown in the following screenshot. The VPC should be the same one that the application load balancer was created in. The</span> <span>Security group</span> <span>that gets created is listed.</span> <span class="packt_screen"><span>Auto-assign public IP</span></span> <span>must be set to</span> <span><span class="packt_screen">ENABLED:</span></span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/811daffa-1ddc-4e1a-b1c7-154c0ba5ed69.png" style="color: black;font-size: 1em;"/></div>
<ol start="2">
<li><span>In the</span> <span class="packt_screen">Load balancing</span> <span>section, select</span> <span class="packt_screen">Application Load Balancer</span><span> as the</span> <span class="packt_screen">Load balancer type</span><span>, </span><span>as shown in the following screenshot. Select the</span> <span class="packt_screen">Load balancer name</span> <span>(</span><kbd>hello-world-lb</kbd><span>) created earlier:</span></li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/d6ecf0f3-c4e7-46e7-96a2-19dd509ad2e2.png" style="text-align: center;font-size: 1em;width:44.33em;height:32.08em;"/></div>
<ol start="3">
<li>In <span class="packt_screen">Container to load balance</span>, click on <span class="packt_screen">Add to load balancer</span> for the <span class="packt_screen">Container name:port </span>to be created as <kbd>hello-world:80:80</kbd>, as shown <span>in the following screenshot:</span></li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/40ee216a-07c6-4b6d-9d17-ea1f8ee876a4.png" style="width:44.08em;height:8.92em;"/></div>
<ol start="4">
<li>Additional fields get displayed to configure the container to load balance. Select <span class="packt_screen">80:HTTP</span> as the <span class="packt_screen">Listener port</span><span>, </span>as shown <span>in the following screenshot</span>.</li>
<li>Select <span class="packt_screen">Target group name</span> as <span class="packt_screen">hello-world-tg</span>, which is the target group created when the load balancer was created, as shown <span>in the following screenshot</span>.</li>
<li>In <span class="packt_screen">Service discovery</span>, deselect the checkbox <span class="packt_screen">Enable service discovery integration</span>.</li>
<li>Keep the default settings for the other fields and click on <span class="packt_screen">Next step</span>:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/321d4522-4250-4d88-ae9e-72ba2519cf62.png" style="text-align: center;font-size: 1em;"/></div>
<ol start="8">
<li><span>In</span> <span class="packt_screen">Set Auto Scaling</span> <span>(shown in the following screenshot), auto scaling may optionally be configured, but is not required. Click on</span> <span class="packt_screen">Next step</span> <span>with the default setting of</span> <span class="packt_screen">Do not adjust the service’s desired count</span><span>:</span></li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/445ec4f2-f2d3-47fe-9ad3-a50d89acf62a.png" style="text-align: center;font-size: 1em;width:42.50em;height:15.83em;"/></div>
<ol start="9">
<li>In <span class="packt_screen">Review</span>,<span> click on</span> <span class="packt_screen">Create Service</span>, <span>as shown in the following screenshot:</span></li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/fb4c2981-6cf0-4e5c-8619-b1b16e199cad.png" style="text-align: center;font-size: 1em;width:42.00em;height:29.17em;"/></div>
<ol start="10">
<li><span>As the</span> <span class="packt_screen">Launch Status</span><span> dialog shown </span><span>in the following screenshot</span> <span>indicates, a service gets created:</span></li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/3f53d116-bebe-4180-abbc-96bc48507991.png" style="width:25.83em;height:31.42em;"/></div>
<ol start="11">
<li><span>Initially, some of the tasks could have a status of </span><span class="packt_screen">PENDING</span><span>. Click on the refresh button to refresh the status. After a while, all the tasks should have a status of </span><span class="packt_screen">RUNNING</span><span>, as shown</span> <span>in the following screenshot:</span></li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/064dd117-41b4-42eb-9a6f-a5a4a4b17ed0.png"/></div>
<ol start="12">
<li>The service <span class="packt_screen">Details</span> tab lists the configuration of load balancing, including the <span class="packt_screen">Target Group Name</span>, <span class="packt_screen">Container Name</span>, and <span class="packt_screen">Container Port</span>, as shown <span>in the following screenshot</span>. <span>The service summary </span><span>lists a deployment with a </span><span class="packt_screen">Running count</span><span> of <span class="packt_screen">3</span> for a </span><span class="packt_screen">Desired count</span><span> of <span class="packt_screen">3</span>:</span></li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/1daf227c-4164-4489-81aa-113900bd12e6.png"/></div>
<ol start="13">
<li><span class="packt_screen">Events</span> indicates that the service registered 1 target in the target group, as shown <span>in the following screenshot:</span></li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/09290fb4-f838-4917-9000-41aee8b0d41a.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Invoking the Hello World application</h1>
                </header>
            
            <article>
                
<p>To invoke the <kbd>hello-world</kbd> service in a browser, we will use the public DNS of the application load balancer registered with the service. In the EC2 dashboard, select the <span class="packt_screen">Target Groups</span> | <span class="packt_screen">hello-world</span><span class="packt_screen"><span class="packt_screen">-</span>tg</span> target group, and then select <span class="packt_screen">Targets</span>. Initially, when the target group was created, the <span class="packt_screen">Targets</span> tab did not list any targets. But after creating and configuring the service with the load balancer, the <span class="packt_screen">Targets</span> tab lists the three<span class="packt_screen"> </span>IP addresses for the three tasks in the <span class="packt_screen">hello-world-tg</span> service, as shown <span>in the following screenshot:</span></p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/8996a1da-84b3-4df5-ba54-cac1f364ec6f.png"/></div>
<p>Two of the tasks are in one availability zone and the third is in another availability zone, as shown <span>in the following screenshot:</span></p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/a01b1195-e374-4f23-b59d-36570c27e267.png"/></div>
<ol>
<li>Obtain the <span class="packt_screen">DNS name</span> for the application load balancer from the Load Balancers console, as shown <span>in the following screenshot:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/8684514b-088e-462a-a726-c1af151e71a3.png"/></div>
<ol start="2">
<li>Open the DNS name in a browser to invoke the Hello World application, as shown <span>in the following screenshot:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/8e07a3f8-62b5-4c0f-bf10-8e5444b22577.png" style="width:41.83em;height:23.67em;"/></div>
<p>Invoking the DNS name for the load balancer forwards the request to the target group <span class="packt_screen">hello-world-tg</span>, as indicated in the <span class="packt_screen">Listeners</span> tab of the load balancer, as shown <span>in the following screenshot:</span></p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/da5ac189-530d-4bf6-8d11-f2d199b86d70.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Stopping tasks and deleting a load balancer</h1>
                </header>
            
            <article>
                
<p>The procedure used to stop tasks and delete ECS resources is as follows:</p>
<ol>
<li>Update the service to set Desired count for tasks to 0</li>
<li>Stop the tasks</li>
<li>Delete the service</li>
<li>De-register the task definition revisions</li>
</ol>
<p>To delete the application load balancer, select the application load balancer in the <span class="packt_screen">Load Balancers</span> table and select <span class="packt_screen">Actions</span> | <span class="packt_screen">Delete</span>, as shown <span>in the following screenshot:</span></p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/06028074-4b78-45a3-9b23-f2abcdef9f37.png"/></div>
<p>In the <span class="packt_screen">Delete Load Balancer</span> confirmation dialog, click on <span class="packt_screen">Yes, Delete</span>. The application load balancer gets deleted as shown <span>in the following screenshot:</span></p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/de3fd298-450b-4d67-8602-7c7bf9b45272.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we discussed configuring an ECS service with a Fargate launch type with an application load balancer to balance the HTTP requests for a Hello World service. The application load balancer is designed for HTTP/HTTPS protocol, and cannot be used with TCP protocol. In the next chapter, we will discuss using the Amazon ECS Command Line Interface (CLI).</p>


            </article>

            
        </section>
    </body></html>