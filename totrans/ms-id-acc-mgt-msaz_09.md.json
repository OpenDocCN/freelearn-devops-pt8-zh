["```\n# Install for all users (requires an elevated PowerShell)\nInstall-Module -Name Posh-ACME\n\n# Install for current user\nInstall-Module -Name Posh-ACME -Scope CurrentUser\n```", "```\nNew-PACertificate '*.inovitdemos.ch','certauth.login.inovitdemos.ch' -AcceptTOS -Contact jochen.nickel@inovit.ch\n```", "```\n_acme-challenge.inovitdemos.ch   TXT   15MIN TTL   OtORHpZ1CruSu2Tb-iZ1oSnU7oMOsiT0fMPq8pDDeVM\n_acme-challenge.certauth.login.inovitdemos.ch  TXT  15MIN TTL  5je--CO7tiMYFXdclcFQKu9UwxnbQTVuzV4U8xpIBQs\n```", "```\nGet-PACertificate | fl\n```", "```\nAdd-DnsServerResourceRecord -ZoneName \"inovitdemos.ch\" -A -Name \"login\" -IPv4Address \"10.0.0.4\"\n```", "```\nAdd-DnsServerResourceRecord -ZoneName \"inovitdemos.ch\" -A -Name \"claims\" -IPv4Address \"10.0.0.6\"\nAdd-DnsServerResourceRecord -ZoneName \"inovitdemos.ch\" -A -Name \"kerb\" -IPv4Address \"10.0.0.6\"\nAdd-DnsServerResourceRecord -ZoneName \"inovitdemos.ch\" -A -Name \"basic\" -IPv4Address \"10.0.0.6\"\nAdd-DnsServerResourceRecord -ZoneName \"inovitdemos.ch\" -A -Name \"ntlm\" -IPv4Address \"10.0.0.6\"\n```", "```\nAdd-KdsRootKey -EffectiveTime (Get-Date).AddHours(-10)\nNew-ADServiceAccount svcadfs -DNSHostName login.inovitdemos.ch -ServicePrincipalNames http/login.inovitdemos.ch\n```", "```\n# Get the certificate thumbprint\ngci Cert:\\LocalMachine\\My\\ | fl\n# Install the ADFS Farm with WID\nInstall-WindowsFeature ADFS-Federation -IncludeManagementTools\nInstall-AdfsFarm -CertificateThumbprint 66F1BF8CCD904DF74154A5D24769DE155E874257 -FederationServiceName login.inovitdemos.ch -GroupServiceAccountIdentifier inovitdemos\\svcadfs$ -FederationServiceDisplayName \"INOVITDEMOS Login\"\n# Server restart\nRestart-Computer\n```", "```\nSet-AdfsProperties -EnableIdPInitiatedSignonPage $true\n```", "```\n# Check ADFS Metadata\nhttps://login.inovitdemos.ch/adfs/fs/federationserverservice.asmx\n# Check IDP Sign In\n# Add \"login.inovitdemos.ch\" to the \"Local Intranet\" settings in IE\nhttps://login.inovitdemos.ch/adfs/ls/IdpInitiatedSignon.aspx\n```", "```\nConnect-MsolService\nConvert-MsolDomainToFederated -DomainName inovitdemos.ch -SupportMultipleDomain:$true\n```", "```\n# Get the certificate thumbprint\ngci Cert:\\LocalMachine\\My\\ | fl\n\n# Install Web Application Proxy\nInstall-WindowsFeature Web-Application-Proxy -IncludeManagementTools\n\n# Configure Web Application Proxy\n$creds = Get-Credential\nInstall-WebApplicationProxy -FederationServiceName \"login.inovitdemos.ch\" -FederationServiceTrustCredential $creds -CertificateThumbprint \"66F1BF8CCD904DF74154A5D24769DE155E874257\"\n\n# Server restart\nRestart-Computer\n```", "```\nAdd-WebApplicationProxyApplication -Name \"Federation Services\" -BackendServerUrl \"https://login.inovitdemos.ch/\" -ExternalUrl \"https://login.inovitdemos.ch/\" -ExternalPreauthentication \"PassThrough\" -ExternalCertificateThumbprint \"66F1BF8CCD904DF74154A5D24769DE155E874257\"\n```", "```\nlogin.inovitdemos.ch. CNAME 15 MIN inodemosura01.westeurope.cloudapp.azure.com\nbasic.inovitdemos.ch. CNAME 15 MIN inodemosura01.westeurope.cloudapp.azure.com\nkerb.inovitdemos.ch. CNAME 15 MIN inodemosura01.westeurope.cloudapp.azure.com\nntlm.inovitdemos.ch. CNAME 15 MIN inodemosura01.westeurope.cloudapp.azure.com\nclaims.inovitdemos.ch. CNAME 15 MIN inodemosura01.westeurope.cloudapp.azure.com\n```", "```\nInstall-WindowsFeature NET-Framework-Core,NET-Framework-45-Features,Web-Mgmt-Console,Web-Asp-Net,Web-Asp-Net45,Web-Basic-Auth,Web-Client-Auth,Web-Digest-Auth,Web-Dir-Browsing,Web-Dyn-Compression,Web-Http-Errors,Web-Http-Logging,Web-Http-Redirect,Web-Http-Tracing,Web-ISAPI-Ext,Web-ISAPI-Filter,Web-Lgcy-Mgmt-Console,Web-Metabase,Web-Mgmt-Console,Web-Mgmt-Service,Web-Net-Ext,Web-Net-Ext45,Web-Request-Monitor,Web-Server,Web-Stat-Compression,Web-Static-Content,Web-Windows-Auth,Web-WMI,Windows-Identity-Foundation\n```", "```\nNew-ADOrganizationalUnit -Name \"SQL\" -Path \"OU=Managed Service Objects,DC=INOVITDEMOS,DC=CH\"\nNew-ADOrganizationalUnit -Name \"Users\" -Path \"OU=SQL,OU=Managed Service Objects,DC=INOVITDEMOS,DC=CH\"\n```", "```\n# SQL Database engine service account\nNew-ADUser -Name \"svcsqldb\" -SamAccountName svcsqldb -UserPrincipalName svcsqldb@inovitdemos.ch -path \"OU=Users,OU=SQL,OU=Managed Service Objects,DC=inovitdemos,DC=ch\" -AccountPassword (ConvertTo-SecureString \"YourPassword\" -AsPlainText -Force) -Description \"SQL Database Engine\" -Enabled $True\n\n# SQL Agent service account\nNew-ADUser -Name \"svcsqldbagent\" -SamAccountName svcsqldbagent -UserPrincipalName svcsqldbagent@inovitdemos.ch -path \"OU=Users,OU=SQL,OU=Managed Service Objects,DC=inovitdemos,DC=ch\" -AccountPassword (ConvertTo-SecureString \"YourPassword\" -AsPlainText -Force) -Description \"SQL Database Engine Agent\" -Enabled $True\n```", "```\nNew-Item C:\\inetpub\\basicroot -type Directory\nImport-Module Webadministration\ncd IIS:\nNew-Item 'IIS:\\Sites\\Basic Web Site' -bindings @{protocol=\"http\";bindingInformation=\":80:basic.inovitdemos.ch\"} -physicalPath 'c:\\inetpub\\basicroot'\n```", "```\n.\\deploy-testsite.ps1 -SourcePath\n\"C:\\inovit\\deploy\" -SiteName \"claims Web Site\" -SitePhysicalPath C:\\inetpub\\claimsroot -ADFSServer inodemosads01 -AppFQDN claims.inovitdemos.ch\n```", "```\nNew-ADUser -Name \"svckrbapp\" -SamAccountName svckrbapp -UserPrincipalName svckrbapp@inovitdemos.ch -path \"OU=Users,OU=AAD,OU=Managed Service Objects,DC=inovitdemos,DC=ch\" -AccountPassword (ConvertTo-SecureString \"YourPassword\" -AsPlainText -Force) -Description \"Kerberos App Pool Account\" -Enabled $True\n```", "```\nsetspn -S http/kerb.inovitdemos.ch inovitdemos\\svckrbapp\n```", "```\nInvoke-Command -ComputerName INODEMOSADS01 -ScriptBlock {Get-ADFSCertificate}\n```", "```\n$authzRules = \"=>issue(Type = `\"http://schemas.microsoft.com/authorization/claims/permit`\", Value = `\"true`\"); \"\n$issuanceRules = \"@RuleName = `\"Issue all claims`\"`nx:[]=>issue(claim = x); \"\n$redirectUrl = \"https://adfshelp.microsoft.com/ClaimsXray/TokenResponse\"\n$samlEndpoint = New-AdfsSamlEndpoint -Binding POST -Protocol SAMLAssertionConsumer -Uri $redirectUrl\n\nAdd-ADFSRelyingPartyTrust -Name \"ClaimsXray\" -Identifier \"urn:microsoft:adfs:claimsxray\" -IssuanceAuthorizationRules $authzRules -IssuanceTransformRules $issuanceRules -WSFedEndpoint $redirectUrl -SamlEndpoint $samlEndpoint\n```", "```\nAdd-AdfsClient -Name \"ClaimsXrayClient\" -ClientId \"claimsxrayclient\" -RedirectUri https://adfshelp.microsoft.com/ClaimsXray/TokenResponse\n\nif ([System.Environment]::OSVersion.Version.major -gt 6) { Grant-AdfsApplicationPermission -ServerRoleIdentifier urn:microsoft:adfs:claimsxray -AllowAllRegisteredClients -ScopeNames \"openid\",\"profile\" }\n```", "```\n# Replace the tenant ID to your value\n$certbase64 = New-AdfsAzureMfaTenantCertificate -TenantID 181031inovitdemos.onmicrosoft.com\n```", "```\n# Connect to the MsolService with your global administrator rights\nConnect-MsolService\n\n# Create a new Service Principal Credential the AppPrincipalId is the hardcoded one for Azure MFA\nNew-MsolServicePrincipalCredential -AppPrincipalId 981f26a1-7f43-403b-a875-f8b09b8cd720 -Type asymmetric -Usage verify -Value $certBase64\n```", "```\nSet-AdfsAzureMfaTenant -TenantId 181031inovitdemos.onmicrosoft.com -ClientId 981f26a1-7f43-403b-a875-f8b09b8cd720\n\nRestart-Service adfssrv\n```"]