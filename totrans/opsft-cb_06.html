<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Chapter&#xA0;6.&#xA0;Using MongoDB and Third-party Database Cartridges with OpenShift Applications"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch06" class="calibre1"/>Chapter 6. Using MongoDB and Third-party Database Cartridges with OpenShift Applications</h1></div></div></div><p class="calibre6">This chapter presents a number of recipes that show you how to get started with the OpenShift MongoDB cartridge. We will also look at how you can use downloadable cartridges for <a id="id484" class="calibre1"/>MariaDB and <span class="strong"><strong class="calibre7">Remote Dictionary Server</strong></span> (<span class="strong"><strong class="calibre7">Redis</strong></span>). The specific recipes within this chapter are:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Adding a MongoDB cartridge to your application</li><li class="listitem">Adding a RockMongo cartridge to your application</li><li class="listitem">Accessing a MongoDB cartridge from your local machine</li><li class="listitem">Connecting to a MongoDB cartridge using Robomongo from your local machine</li><li class="listitem">Enabling the MongoDB cartridge REST interface</li><li class="listitem">Performing scheduled MongoDB database backups</li><li class="listitem">Using MongoLab MongoDB-as-a-Service with OpenShift</li><li class="listitem">Adding a MariaDB cartridge to your application</li><li class="listitem">Adding a Redis cartridge to your application</li></ul></div></div>

<div class="book" title="Chapter&#xA0;6.&#xA0;Using MongoDB and Third-party Database Cartridges with OpenShift Applications">
<div class="book" title="Introduction"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch06lvl1sec73" class="calibre1"/>Introduction</h1></div></div></div><p class="calibre6">MongoDB<a id="id485" class="calibre1"/> is a popular and open source document-oriented NoSQL data store. It is designed for scalability and stores complex object graphs in a single document. It has support for dynamic queries, secondary indexes, fast atomic updates, aggregation, and inbuilt support for replication and sharding.</p><p class="calibre6">This chapter will use the PHP 5.4 application we created in <a class="calibre1" title="Chapter 3. Creating and Managing Applications" href="part0041_split_000.html#page">Chapter 3</a>, <span class="strong"><em class="calibre10">Creating and Managing Applications</em></span>. If you do not have any OpenShift application running, then you can create a new OpenShift application by running the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc create-app myapp php-5.4</strong></span>
</pre></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Adding a MongoDB cartridge to your application"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec74" class="calibre1"/>Adding a MongoDB cartridge to your application</h1></div></div></div><p class="calibre6">In this recipe, you will learn<a id="id486" class="calibre1"/> how to add a MongoDB cartridge to your <a id="id487" class="calibre1"/>OpenShift application. MongoDB is a document-oriented, horizontally scalable, and NoSQL data store.</p></div>

<div class="book" title="Adding a MongoDB cartridge to your application">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch06lvl2sec288" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To step through this recipe, you will need the <code class="email">rhc</code> command-line client installed on your machine. Refer to the <span class="strong"><em class="calibre10">Installing the OpenShift rhc command-line client</em></span> recipe in <a class="calibre1" title="Chapter 1. Getting Started with OpenShift" href="part0014_split_000.html#page">Chapter 1</a>, <span class="strong"><em class="calibre10">Getting Started with OpenShift</em></span> for details. Also, we will use the application created in the <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe in <a class="calibre1" title="Chapter 3. Creating and Managing Applications" href="part0041_split_000.html#page">Chapter 3</a>, <span class="strong"><em class="calibre10">Creating and Managing Applications</em></span>.</p></div></div>

<div class="book" title="Adding a MongoDB cartridge to your application">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch06lvl2sec289" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">To install the MongoDB cartridge to the <code class="email">myapp</code> application, use the following steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open a new command-line terminal, then change the directory to the <code class="email">myapp</code> directory location and execute the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridge-add c mongodb-2.4 --app myapp</strong></span>
</pre></div><p class="calibre14">This will install a new instance of MongoDB on your application gear. The <code class="email">-c</code> option is used to specify the cartridge name and the <code class="email">--app</code> option is used to specify the application name.</p></li><li class="listitem" value="2">You can view the cartridge details using the <code class="email">rhc show-cartridge</code> command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc show-cartridge mongodb --app myapp</strong></span>
<span class="strong"><strong class="calibre7">Using mongodb-2.4 (MongoDB 2.4) for 'mongodb'</strong></span>
<span class="strong"><strong class="calibre7">mongodb-2.4 (MongoDB 2.4)</strong></span>
<span class="strong"><strong class="calibre7">-------------------------</strong></span>
<span class="strong"><strong class="calibre7">  Gears:          Located with php-5.4</strong></span>
<span class="strong"><strong class="calibre7">  Connection URL: mongodb://$OPENSHIFT_MONGODB_DB_HOST:$OPENSHIFT_MONGODB_DB_PORT/</strong></span>
<span class="strong"><strong class="calibre7">  Database Name:  myapp</strong></span>
<span class="strong"><strong class="calibre7">  Password:       DSdIxMVY8kd4</strong></span>
<span class="strong"><strong class="calibre7">  Username:       admin</strong></span>
</pre></div></li><li class="listitem" value="3">You can also stop the MongoDB server using the <code class="email">stop</code> command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc stop-cartridge mongodb</strong></span>
</pre></div><p class="calibre14">You can restart the MongoDB server using the <code class="email">restart</code> command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridge-restart mongodb</strong></span>
</pre></div></li><li class="listitem" value="4">If you want to remove the MongoDB server from your application, you can use the <code class="email">remove</code> command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridge-remove mongodb –-confirm</strong></span>
</pre></div></li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Adding a MongoDB cartridge to your application">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch06lvl2sec290" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">When you run <a id="id488" class="calibre1"/>the <code class="email">rhc add-cartridge</code> command, <code class="email">rhc</code> will<a id="id489" class="calibre1"/> make an HTTP POST request to the <a id="id490" class="calibre1"/>OpenShift server. The OpenShift server will receive the request and instantiate a new instance of the MongoDB database for your application. After provisioning the MongoDB database, the <code class="email">rhc</code> client will show the database details on the command-line terminal.</p><p class="calibre6">You can view the MongoDB installation by performing an SSH into your application gear:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc ssh --app myapp </strong></span>
</pre></div><p class="calibre6">Then, run the <code class="email">ls</code> command to view the gear directory structure and you will see the <code class="email">mongodb</code> directory:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">[myapp-osbook.rhcloud.com 52fb71aa5973caf609000026]\&gt; ls -p</strong></span>
<span class="strong"><strong class="calibre7">app-deployments/  app-root/  git/  mongodb/  php/</strong></span>
</pre></div><p class="calibre6">The <code class="email">mongodb</code> directory is your <code class="email">mongodb</code> installation, and it is not shared with any other OpenShift application or user. It is only for your application, and only your application can access it.</p><p class="calibre6">You can also connect with your MongoDB database by using the <code class="email">mongo</code> command-line client, as shown in the following command. The <span class="strong"><em class="calibre10">Accessing a MongoDB cartridge from your local machine</em></span> recipe will cover how to connect with MongoDB from your local machine:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">[myapp-osbook.rhcloud.com 52fb71aa5973caf609000026]\&gt; mongo</strong></span>
<span class="strong"><strong class="calibre7">MongoDB shell version: 2.4.6</strong></span>
<span class="strong"><strong class="calibre7">connecting to: 127.2.34.2:27017/admin</strong></span>
<span class="strong"><strong class="calibre7">Welcome to the MongoDB shell.</strong></span>
<span class="strong"><strong class="calibre7">For interactive help, type "help".</strong></span>
<span class="strong"><strong class="calibre7">For more comprehensive documentation, see</strong></span>
<span class="strong"><strong class="calibre7">  http://docs.mongodb.org/</strong></span>
<span class="strong"><strong class="calibre7">Questions? Try the support group</strong></span>
<span class="strong"><strong class="calibre7">  http://groups.google.com/group/mongodb-user</strong></span>
<span class="strong"><strong class="calibre7">&gt;</strong></span>
</pre></div><p class="calibre6">Now, you can run commands against your MongoDB database. To view all the databases, run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">&gt; show databases;</strong></span>
<span class="strong"><strong class="calibre7">admin  0.03125GB</strong></span>
<span class="strong"><strong class="calibre7">local  0.03125GB</strong></span>
<span class="strong"><strong class="calibre7">myapp  0.03125GB</strong></span>
</pre></div><p class="calibre6">The <code class="email">myapp</code> database corresponds to your application database.</p><p class="calibre6">You can view all the <a id="id491" class="calibre1"/>MongoDB command-line utilities<a id="id492" class="calibre1"/> available on the gear by typing in <code class="email">mongo</code> and hitting <span class="strong"><em class="calibre10">Tab</em></span> twice:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">[myapp-osbook.rhcloud.com 52fb71aa5973caf609000026]\&gt; mongo</strong></span>
<span class="strong"><strong class="calibre7">mongo          mongod         mongoexport    mongoimport    mongoperf mongos         mongostat      </strong></span>
<span class="strong"><strong class="calibre7">mongo_console  mongodump      mongofiles     mongooplog     mongorestore   mongosniff     mongotop</strong></span>
</pre></div></div></div>

<div class="book" title="Adding a MongoDB cartridge to your application">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch06lvl2sec291" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre6">You can also add a MongoDB database from the <a id="id493" class="calibre1"/>OpenShift web console. Go to <a class="calibre1" href="https://openshift.redhat.com/app/console/applications">https://openshift.redhat.com/app/console/applications</a>, and click on the <span class="strong"><strong class="calibre7">myapp</strong></span> application for details. On the <code class="email">myapp</code> application's details web page, you will see an option to add a MongoDB database. Click on the <span class="strong"><strong class="calibre7">Add MongoDB 2.4</strong></span> option to add a MongoDB 2.4 cartridge.</p></div></div>

<div class="book" title="Adding a MongoDB cartridge to your application">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch06lvl2sec292" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Adding a RockMongo cartridge to your application</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Adding a RockMongo cartridge to your application"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec75" class="calibre1"/>Adding a RockMongo cartridge to your application</h1></div></div></div><p class="calibre6">RockMongo (<a class="calibre1" href="http://rockmongo.com/">http://rockmongo.com/</a>) is a<a id="id494" class="calibre1"/> free, open source, and popular tool <a id="id495" class="calibre1"/>written in the PHP programming language to handle the administration of the MongoDB database via a web browser. As a web application, RockMongo makes it easy to administer the MongoDB server without any installation on your local machine. In this recipe, you will learn how to install a RockMongo cartridge on your application.</p></div>

<div class="book" title="Adding a RockMongo cartridge to your application">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch06lvl2sec293" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To complete this recipe, you will need an application with a MongoDB cartridge. Refer to the <span class="strong"><em class="calibre10">Adding a MongoDB cartridge to your application</em></span> recipe to learn how to install a MongoDB cartridge.</p></div></div>

<div class="book" title="Adding a RockMongo cartridge to your application">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch06lvl2sec294" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">The steps<a id="id496" class="calibre1"/> needed to add the RockMongo cartridge are as <a id="id497" class="calibre1"/>follows:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">To install the RockMongo cartridge on the <code class="email">myapp</code> application, open a new command-line terminal, then change the directory to the <code class="email">myapp</code> directory location and execute the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc add-cartridge rockmongo --app myapp</strong></span>
</pre></div></li><li class="listitem" value="2">Note the username and password returned by the <code class="email">rhc cartridge-add</code> command. You will need these to log in to RockMongo. The RockMongo credentials are the same as your MongoDB database credentials, and you can view them anytime by executing the <code class="email">rhc show-app</code> or <code class="email">rhc cartridge-show mongodb-2.4</code> command.</li><li class="listitem" value="3">Log in to RockMongo (<code class="email">https://myapp-{domain-name}.rhcloud.com/rockmongo/</code>) using the credentials from step 1.</li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Adding a RockMongo cartridge to your application">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch06lvl2sec295" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">When you run <a id="id498" class="calibre1"/>the <code class="email">rhc add-cartridge</code> command, the <code class="email">rhc</code> client makes an HTTP POST request to the OpenShift server. The OpenShift server receives the request and installs the RockMongo cartridge on the application gear. The RockMongo cartridge works with all the supported application types (Java, Python, Node.js, Ruby, Perl, and PHP). You don't need to create PHP applications in order to use the RockMongo cartridge. OpenShift will start an Apache process to run the RockMongo application.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note18" class="calibre1"/>Note</h3><p class="calibre6">You can only add the RockMongo cartridge after you have added a MongoDB cartridge to your application. If you try to add RockMongo before adding a MongoDB cartridge, then you will receive the <code class="email">Cartridge 'rockmongo-1.1' can not be added without mongodb</code> error.</p></div></div></div>

<div class="book" title="Adding a RockMongo cartridge to your application">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch06lvl2sec296" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre6">You can also add a RockMongo cartridge <a id="id499" class="calibre1"/>from the OpenShift web console. Go to <a class="calibre1" href="https://openshift.redhat.com/app/console/applications">https://openshift.redhat.com/app/console/applications</a> and click on the <code class="email">myapp</code> application. To install a RockMongo cartridge, click on the <span class="strong"><strong class="calibre7">Add RockMongo 1.1</strong></span> web link.</p></div></div>

<div class="book" title="Adding a RockMongo cartridge to your application">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch06lvl2sec297" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Accessing a MongoDB cartridge from your local machine</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Connecting to a MongoDB cartridge using Robomongo from your local machine</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Accessing a MongoDB cartridge from your local machine"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec76" class="calibre1"/>Accessing a MongoDB cartridge from your local machine</h1></div></div></div><p class="calibre6">In the <span class="strong"><em class="calibre10">Adding a MongoDB cartridge to your application</em></span> recipe, you learned how to access a MongoDB database by performing an SSH into the application gear. In this recipe, you will learn how to connect with the MongoDB database from your local machine.</p></div>

<div class="book" title="Accessing a MongoDB cartridge from your local machine">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch06lvl2sec298" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To complete this recipe, you <a id="id500" class="calibre1"/>will need an application with a<a id="id501" class="calibre1"/> MongoDB cartridge. Refer to the <span class="strong"><em class="calibre10">Adding a MongoDB cartridge to your application</em></span> recipe in this chapter to learn how to add a MongoDB cartridge. Also, you will need the <code class="email">mongo</code> command-line client on your machine. You can download the MongoDB database<a id="id502" class="calibre1"/> from the official website at <a class="calibre1" href="http://www.mongodb.org/downloads/">http://www.mongodb.org/downloads/</a>.</p></div></div>

<div class="book" title="Accessing a MongoDB cartridge from your local machine">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch06lvl2sec299" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Perform the following steps to connect to a MongoDB cartridge from your local machine:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open a command-line terminal and change the directory to the <code class="email">myapp</code> application directory. Execute the following command to forward remote ports to the local machine:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc port-forward --app myapp</strong></span>
<span class="strong"><strong class="calibre7">Checking available ports ... done</strong></span>
<span class="strong"><strong class="calibre7">Forwarding ports ...</strong></span>
<span class="strong"><strong class="calibre7">Address already in use - bind(2) while forwarding port 8080. Trying local port 8081</strong></span>

<span class="strong"><strong class="calibre7">To connect to a service running on OpenShift, use the Local address</strong></span>

<span class="strong"><strong class="calibre7">Service Local                OpenShift</strong></span>
<span class="strong"><strong class="calibre7">------- --------------- ---- ----------------</strong></span>
<span class="strong"><strong class="calibre7">httpd   127.0.0.1:8080   =&gt;  127.2.34.1:8080</strong></span>
<span class="strong"><strong class="calibre7">httpd   127.0.0.1:8081   =&gt;  127.2.34.3:8080</strong></span>
<span class="strong"><strong class="calibre7">mongodb 127.0.0.1:27017  =&gt;  127.2.34.2:27017</strong></span>

<span class="strong"><strong class="calibre7">Press CTRL-C to terminate port forwarding</strong></span>
</pre></div></li><li class="listitem" value="2">Open another command-line terminal and connect to the MongoDB database from the <code class="email">mongo</code> command-line client from your local machine using the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ mongo --username &lt;username&gt; --password &lt;password&gt; &lt;host&gt;:&lt;port&gt;/admin</strong></span>
</pre></div></li><li class="listitem" value="3">Replace <code class="email">&lt;username&gt;</code> <a id="id503" class="calibre1"/>and <code class="email">&lt;password&gt;</code> with<a id="id504" class="calibre1"/> your MongoDB cartridge username and password. The host and port values can be found in the output of the <code class="email">rhc port-forward</code> command. As you can see in step 1, the <code class="email">MongoDB</code> database is available on the <code class="email">127.0.0.1</code> host and <code class="email">27017</code> port number. You can view the username and password by running the <code class="email">rhc show-app</code> or <code class="email">rhc cartridge-show mongodb-2.4</code> command.</li><li class="listitem" value="4">Once connected to the MongoDB database, you can run any legitimate command, as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">&gt; show databases</strong></span>
<span class="strong"><strong class="calibre7">admin  0.03125GB</strong></span>
<span class="strong"><strong class="calibre7">local  0.03125GB</strong></span>
<span class="strong"><strong class="calibre7">myap  (empty)</strong></span>
<span class="strong"><strong class="calibre7">myapp  0.03125GB</strong></span>
<span class="strong"><strong class="calibre7">test  0.03125GB</strong></span>
</pre></div></li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Accessing a MongoDB cartridge from your local machine">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch06lvl2sec300" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">In step 1, you used the <code class="email">rhc port-forward</code> command<a id="id505" class="calibre1"/> to forward all the remote ports to the local machine. The <code class="email">rhc port-forward</code> command is a wrapper around the SSH port forwarding that makes a port on the remote machine available on your local machine. A port on the remote machine, which would otherwise be unavailable to you, can be used as if it's on your local machine. The command returns the list of ports that you can connect from your local machine, as shown in step 1.</p><p class="calibre6">As you can see in the output, the <code class="email">mongod</code> process is available on the <code class="email">27017</code> port and <code class="email">127.0.0.1</code> host.</p><p class="calibre6">In step 2, you connected to the MongoDB database from your local machine, passing in the username, password, host, and port of the database. After a successful connection, you ran a command in step 3.</p><p class="calibre6">To terminate port <a id="id506" class="calibre1"/>forwarding, just press <span class="strong"><em class="calibre10">Ctrl</em></span> + <span class="strong"><em class="calibre10">C</em></span> on<a id="id507" class="calibre1"/> the command-line terminal where the <code class="email">rhc port-forward</code> command is running.</p></div></div>

<div class="book" title="Accessing a MongoDB cartridge from your local machine">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch06lvl2sec301" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Connecting to a MongoDB cartridge using Robomongo from your local machine</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Adding a MongoDB cartridge to your application</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Connecting to a MongoDB cartridge using Robomongo from your local machine"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec77" class="calibre1"/>Connecting to a MongoDB cartridge using Robomongo from your local machine</h1></div></div></div><p class="calibre6">In the <span class="strong"><em class="calibre10">Accessing a MongoDB cartridge from your local machine</em></span> recipe, you learned how to connect to a MongoDB cartridge using the <code class="email">mongo</code> command-line client from your local machine. In this recipe, you will learn how to connect to a MongoDB cartridge using RoboMongo from your local machine. RoboMongo<a id="id508" class="calibre1"/> (<a class="calibre1" href="http://robomongo.org/">http://robomongo.org/</a>) is an<a id="id509" class="calibre1"/> open source, cross-platform MongoDB GUI management tool. We used RoboMongo because it is available across all the operating systems, and you can type in all the commands you type in the mongo shell in RoboMongo. It feels natural to developers who are used to the mongo shell.</p></div>

<div class="book" title="Connecting to a MongoDB cartridge using Robomongo from your local machine">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch06lvl2sec302" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To complete this<a id="id510" class="calibre1"/> recipe, you will need an <a id="id511" class="calibre1"/>application with a MongoDB <a id="id512" class="calibre1"/>cartridge. Refer to the <span class="strong"><em class="calibre10">Adding a MongoDB cartridge to your application</em></span> recipe in this chapter to learn how to add a MongoDB cartridge. Also, you will need the RoboMongo tool installed on your local machine. You can download the RoboMongo<a id="id513" class="calibre1"/> tool from its website at <a class="calibre1" href="http://robomongo.org/">http://robomongo.org/</a>.</p></div></div>

<div class="book" title="Connecting to a MongoDB cartridge using Robomongo from your local machine">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch06lvl2sec303" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Perform the following steps<a id="id514" class="calibre1"/> to connect to <a id="id515" class="calibre1"/>RoboMongo with your <a id="id516" class="calibre1"/>MongoDB cartridge:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open a command-line terminal and change the directory to the <code class="email">myapp</code> application directory. Execute the following command to forward remote ports to the local machine:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc port-forward --app myapp</strong></span>
</pre></div></li><li class="listitem" value="2">Start the RoboMongo application, and you will see the following screenshot. Click on the connect icon in the top-left corner:<div class="mediaobject"><img src="../images/00050.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="3">After clicking on the connect icon, you will see a new window with options to create a new connection. Click on the <span class="strong"><strong class="calibre7">Create</strong></span> link to create a new connection:<div class="mediaobject"><img src="../images/00051.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="4">Set up a new <a id="id517" class="calibre1"/>connection<a id="id518" class="calibre1"/> by entering <a id="id519" class="calibre1"/>the MongoDB database details. The host and port can be found in the output of the <code class="email">rhc port-forward</code> command in step 1, as shown in the following screenshot:<div class="mediaobject"><img src="../images/00052.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="5">Click on the <a id="id520" class="calibre1"/><span class="strong"><strong class="calibre7">Authentication</strong></span> tab to<a id="id521" class="calibre1"/> enter the <a id="id522" class="calibre1"/>username and password required to connect with the MongoDB cartridge. You can view the MongoDB cartridge details using the <code class="email">rhc show-app</code> or <code class="email">rhc cartridge-show mongodb-2.4</code> command. The following screenshot shows the <span class="strong"><strong class="calibre7">Authentication</strong></span> tab details:<div class="mediaobject"><img src="../images/00053.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="6">Click on the <a id="id523" class="calibre1"/><span class="strong"><strong class="calibre7">Save</strong></span> button and you <a id="id524" class="calibre1"/>will see the <a id="id525" class="calibre1"/>new connection listed in the <span class="strong"><strong class="calibre7">MongoDB Connections</strong></span> window:<div class="mediaobject"><img src="../images/00054.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="7">Click on the <span class="strong"><strong class="calibre7">Connect</strong></span> button and you will be connected to the MongoDB cartridge.</li><li class="listitem" value="8">Once connected<a id="id526" class="calibre1"/> to your<a id="id527" class="calibre1"/> MongoDB cartridge, you<a id="id528" class="calibre1"/> can click on any database and view all its collections. When you double-click on a collection, you can see the first 50 documents inside it. The following screenshot shows the documents inside the <code class="email">msgs</code> collection:<div class="mediaobject"><img src="../images/00055.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Connecting to a MongoDB cartridge using Robomongo from your local machine">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch06lvl2sec304" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">In step 1, you <a id="id529" class="calibre1"/>used the <code class="email">rhc port-forward</code> command to <a id="id530" class="calibre1"/>forward all the remote<a id="id531" class="calibre1"/> ports to the local machine. This will make it possible to connect to the MongoDB database running inside your application gear. In steps 2 through 7, you created a new MongoDB connection and connected with the MongoDB cartridge from within RoboMongo. In step 8, you navigated to the <span class="strong"><strong class="calibre7">msgs</strong></span> collection in the <span class="strong"><strong class="calibre7">test</strong></span> database.</p></div></div>

<div class="book" title="Connecting to a MongoDB cartridge using Robomongo from your local machine">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch06lvl2sec305" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Accessing a MongoDB cartridge from your local machine</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Enabling the MongoDB cartridge REST interface</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Enabling the MongoDB cartridge REST interface"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec78" class="calibre1"/>Enabling the MongoDB cartridge REST interface</h1></div></div></div><p class="calibre6">MongoDB exposes a minimal <a id="id532" class="calibre1"/>REST interface that allows users to query collections. The interface does not expose operations to insert, update, or remove documents. In this recipe, you will learn how to enable the MongoDB cartridge REST interface.</p></div>

<div class="book" title="Enabling the MongoDB cartridge REST interface">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch06lvl2sec306" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To complete this recipe, you will need an application with a MongoDB cartridge. Refer to the <span class="strong"><em class="calibre10">Adding a MongoDB cartridge to your application</em></span> recipe in this chapter to learn how to add one.</p></div></div>

<div class="book" title="Enabling the MongoDB cartridge REST interface">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch06lvl2sec307" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Perform the following steps to enable the MongoDB REST interface:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open a new command-line terminal and SSH into the <code class="email">myapp</code> application gear using the <code class="email">ssh</code> command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc ssh --app myapp</strong></span>
</pre></div></li><li class="listitem" value="2">Once inside the application gear, change the directory to <code class="email">mongodb/conf</code> and edit the <code class="email">mongodb.conf</code> file using Vim.</li><li class="listitem" value="3">Now, we need to update the <code class="email">nohttpinterface</code> property value to <code class="email">false</code> so that MongoDB enables the HTTP frontend on the <code class="email">28017</code> port. To enable the REST interface, you have to add a new property, <code class="email">rest</code>, and set its value equal to <code class="email">true</code>, as shown in the following code:<div class="informalexample"><pre class="programlisting">nohttpinterface = false
rest = true</pre></div></li><li class="listitem" value="4">Exit the SSH session and restart the MongoDB cartridge to allow the changes to take effect:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridge-restart –app mongodb-2.4</strong></span>
</pre></div></li><li class="listitem" value="5">Execute the <code class="email">rhc port-forward</code> command on your local machine to enable port forwarding. This will list all the applications that you can connect to from your local machine. The REST interface will be exposed at the <code class="email">28017</code> port:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc port-forward </strong></span>
<span class="strong"><strong class="calibre7">Checking available ports ... done</strong></span>
<span class="strong"><strong class="calibre7">Forwarding ports ...</strong></span>
<span class="strong"><strong class="calibre7">Address already in use - bind(2) while forwarding port 8080. Trying local port 8081</strong></span>

<span class="strong"><strong class="calibre7">To connect to a service running on OpenShift, use the Local address</strong></span>

<span class="strong"><strong class="calibre7">Service Local                OpenShift</strong></span>
<span class="strong"><strong class="calibre7">------- --------------- ---- ----------------</strong></span>
<span class="strong"><strong class="calibre7">httpd   127.0.0.1:8080   =&gt;  127.2.34.1:8080</strong></span>
<span class="strong"><strong class="calibre7">httpd   127.0.0.1:8081   =&gt;  127.2.34.3:8080</strong></span>
<span class="strong"><strong class="calibre7">mongod  127.0.0.1:28017  =&gt;  127.2.34.2:28017</strong></span>
<span class="strong"><strong class="calibre7">mongodb 127.0.0.1:27017  =&gt;  127.2.34.2:27017</strong></span>

<span class="strong"><strong class="calibre7">Press CTRL-C to terminate port forwarding</strong></span>
</pre></div></li><li class="listitem" value="6">Open <code class="email">http://127.0.0.1:28017/</code> in a web browser. You have to authenticate using the MongoDB cartridge credentials. It uses the HTTP basic authentication.</li><li class="listitem" value="7">Then, to view all the documents in the <code class="email">msgs</code> collection in the <code class="email">test</code> document, you can go to <code class="email">http://127.0.0.1:28017/test/msgs/</code>. This will list a JSON document that contains all the messages in the <code class="email">msgs</code> collection.</li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Enabling the MongoDB cartridge REST interface">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch06lvl2sec308" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">By default, MongoDB <a id="id533" class="calibre1"/>disables the REST interface. To enable the REST interface, you have to update the <code class="email">mongodb.conf</code> MongoDB configuration file. In step 3, you updated the <code class="email">mongodb.conf</code> file to enable the REST API. Then, you restarted the MongoDB cartridge in step 4 to reload the configuration. To connect with the REST interface from your local machine, you enabled port forwarding in step 5. The <code class="email">rhc port-forward</code> command lists all the remote services that you can connect to from your local machine. The MongoDB REST interface is available on the <code class="email">28017</code> port. In step 7, you viewed the details of the <code class="email">msgs</code> collection in the <code class="email">test</code> database by opening <code class="email">http://127.0.0.1:28017/test/msgs/</code> in the browser.</p></div></div>

<div class="book" title="Enabling the MongoDB cartridge REST interface">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch06lvl2sec309" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Using MongoLab MongoDB-as-a-Service with OpenShift</em></span> recipe</li><li class="listitem">The <span class="strong"><em class="calibre10">Performing scheduled MongoDB database backups</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Performing scheduled MongoDB database backups"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec79" class="calibre1"/>Performing scheduled MongoDB database backups</h1></div></div></div><p class="calibre6">In this recipe, you will learn <a id="id534" class="calibre1"/>how to perform a scheduled backup of your MongoDB database and upload the backup to Amazon S3.</p></div>

<div class="book" title="Performing scheduled MongoDB database backups">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch06lvl2sec310" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To complete this recipe, you will need an application with a MongoDB cartridge. Refer to the <span class="strong"><em class="calibre10">Adding a MongoDB cartridge to your application</em></span> recipe in this chapter to learn how to install one. Also, you need to have an Amazon AWS account. Go to <a class="calibre1" href="http://aws.amazon.com/">http://aws.amazon.com/</a> and sign up for a new account if you don't have one already.</p></div></div>

<div class="book" title="Performing scheduled MongoDB database backups">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch06lvl2sec311" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Perform the following steps to enable a daily scheduled backup of the MongoDB cartridge:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Go to <a class="calibre1" href="https://console.aws.amazon.com/s3/home">https://console.aws.amazon.com/s3/home</a> and create a new bucket to store your database backups.</li><li class="listitem" value="2">Add the <code class="email">cron</code> cartridge to your application by running the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridge-add cron --app myapp</strong></span>
</pre></div></li><li class="listitem" value="3">SSH into the application gear and download the <code class="email">s3-bash</code> utility in <code class="email">$OPENSHIFT_DATA_DIR</code>. Extract it to the <code class="email">s3-bash</code> directory using the following commands:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc ssh --app myapp</strong></span>
<span class="strong"><strong class="calibre7">$ cd $OPENSHIFT_DATA_DIR</strong></span>
<span class="strong"><strong class="calibre7">$ wget http://s3-bash.googlecode.com/files/s3-bash.0.02.tar.gz</strong></span>
<span class="strong"><strong class="calibre7">$ mkdir s3-bash</strong></span>
<span class="strong"><strong class="calibre7">$ tar -xf s3-bash.0.02.tar.gz -C s3-bash</strong></span>
</pre></div></li><li class="listitem" value="4">Create a new file, <code class="email">AWSSecretAccessKeyIdFile</code>, in the <code class="email">$OPENSHIFT_DATA_DIR/s3-bash</code> directory and store your Amazon secret access key to it. This is required by <code class="email">s3-bash</code> to communicate with Amazon S3.</li><li class="listitem" value="5">Create a script on your local machine in <code class="email">.openshift/cron/minutely/database_backup.sh</code> and add the following content to it:<div class="informalexample"><pre class="programlisting">#!/bin/bash
function load_env {
    [ -z "$1" ] &amp;&amp; return 1
    [ -f "$1" ] || return 0
 
    local key=$(basename $1)
    export $key="$(&lt; $1)"
}
 
for f in ~/.env/mongodb/*
do
  load_env $f
done

set -x
if [ 'date +%H:%M' == "23:50" ]
then
  FILE_NAME=$(date +"%Y%m%d%H%M")
  mongodump --host $OPENSHIFT_MONGODB_DB_HOST --port  $OPENSHIFT_MONGODB_DB_PORT --username $OPENSHIFT_MONGODB_DB_USERNAME --password $OPENSHIFT_MONGODB_DB_PASSWORD --db $OPENSHIFT_APP_NAME --out $OPENSHIFT_DATA_DIR/$FILE_NAME
  cd $OPENSHIFT_DATA_DIR
  zip -r $FILE_NAME.zip $FILE_NAME
  echo "Took MongoDB Dump" &gt;&gt; $OPENSHIFT_CRON_DIR/log/backup.log
  $OPENSHIFT_DATA_DIR/s3-bash/s3-put -k $AWS_ACCESS_KEY_ID -s $OPENSHIFT_DATA_DIR/s3-bash/AWSSecretAccessKeyIdFile -T $OPENSHIFT_DATA_DIR/$FILE_NAME.zip /$AWS_S3_BUCKET/$FILE_NAME.zip
  echo "Uploaded dump to Amazon S3" &gt;&gt; $OPENSHIFT_CRON_DIR/log/backup.log
  rm -f $OPENSHIFT_DATA_DIR/$FILE_NAME.zip
  rm -rf $OPENSHIFT_DATA_DIR/$FILE_NAME
fi</pre></div></li><li class="listitem" value="6">The preceding<a id="id535" class="calibre1"/> script will run every day at 23:50 (11:50 p.m.) and also run the <code class="email">mongodump</code> command to create the database backup file. The file is then transferred to Amazon S3 using the <code class="email">s3-bash</code> API. Finally, after uploading the file, it deletes the database dump file from the application gear.</li><li class="listitem" value="7">Now, we have to set the environment variables so that our script can talk with Amazon S3. If you are not sure <a id="id536" class="calibre1"/>how to access your security credentials, then refer to the documentation at <a class="calibre1" href="http://docs.aws.amazon.com/general/latest/gr/getting-aws-sec-creds.html">http://docs.aws.amazon.com/general/latest/gr/getting-aws-sec-creds.html</a>. We run the following commands:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc env-set AWS_ACCESS_KEY_ID=&lt; Your Amazon ACCESS_KEY_ID&gt;</strong></span>
<span class="strong"><strong class="calibre7">$ rhc env-set AWS_S3_BUCKET=&lt;Amazon S3 bucket name &gt;</strong></span>
</pre></div></li><li class="listitem" value="8">Commit the code and push it to the OpenShift gear. Every night, at 23:50 (11:50 p.m.), database backup will be done and your backup will be uploaded to Amazon S3.</li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Performing scheduled MongoDB database backups">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch06lvl2sec312" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">In step 1, you <a id="id537" class="calibre1"/>created a new Amazon S3 bucket to store your MongoDB database backups. Amazon S3 is widely used to store static files and is an ideal choice for this job. Next, you added the <code class="email">cron</code> cartridge to the application. The <code class="email">cron</code> cartridge will be used to perform daily backups at a particular time.</p><p class="calibre6">Amazon S3 exposes its REST service that users can use to perform operations on S3 buckets. Amazon provides many programming languages wrapped around their REST API to make it easy for developers to integrate with their application. As we wanted to keep this recipe's language agnostic, we used the Amazon S3 bash wrapper. Amazon does not officially support this wrapper, but it works very well. In step 3, you downloaded the <code class="email">s3-bash</code> utility using <code class="email">wget</code>. The <code class="email">tar.gz</code> file was stored in <code class="email">$OPENSHIFT_DATA_DIR</code>. You then extracted the <code class="email">tar.gz</code> file to the <code class="email">s3-bash</code> directory.</p><p class="calibre6">Next, in step 4, you created a file called <code class="email">AWSSecretAccessKeyIdFile</code> to store the Amazon access key secret. The <code class="email">s3-bash</code> wrapper uses a file for the AWS secret access key ID so that it does not appear in the list of running processes with <code class="email">ps</code>.</p><p class="calibre6">In step 5, you created a bash script that will be executed every night at 23:50 (11:50 p.m.). The script first takes the database backup using the <code class="email">mongodump</code> command and then uploads the file to Amazon S3. The filename is the current timestamp. Finally, after uploading the backup to S3, the script deletes the backup to save disk space.</p><p class="calibre6">Step 6 creates two environment variables required by the backup script. Finally, in step 7, you push the code to the application gear.</p></div></div>

<div class="book" title="Performing scheduled MongoDB database backups">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch06lvl2sec313" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Using MongoLab MongoDB-as-a-Service with OpenShift</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Using MongoLab MongoDB-as-a-Service with OpenShift"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec80" class="calibre1"/>Using MongoLab MongoDB-as-a-Service with OpenShift</h1></div></div></div><p class="calibre6">The <a id="id538" class="calibre1"/>MongoLab (<a class="calibre1" href="https://mongolab.com">https://mongolab.com</a>) MongoDB-as-a-Service makes it easy for you to set up, operate, and scale a MongoDB database on top of various cloud providers. In addition to the standard MongoDB features, MongoLab also offers the following functionality:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Running MongoDB on all the major cloud providers, such as Amazon, Google, Rackspace, and so on</li><li class="listitem">Highly available MongoDB</li><li class="listitem">Automated backups</li><li class="listitem">Monitoring support</li></ul></div><p class="calibre6">In this recipe, you <a id="id539" class="calibre1"/>will learn how to use the<a id="id540" class="calibre1"/> MongoLab MongoDB-as-a-Service with your OpenShift applications.</p></div>

<div class="book" title="Using MongoLab MongoDB-as-a-Service with OpenShift">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch06lvl2sec314" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To complete this recipe, you will need an OpenShift application. Also, you need to have a MongoLab account. Go to <a class="calibre1" href="https://mongolab.com/">https://mongolab.com/</a> and sign up for a new account if you don't have one already.</p></div></div>

<div class="book" title="Using MongoLab MongoDB-as-a-Service with OpenShift">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch06lvl2sec315" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">Perform the following steps to connect with the MongoLab MongoDB server from the OpenShift application:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">After you have created a MongoLab account, you will be shown a screen to create your first database. Click on the <span class="strong"><strong class="calibre7">Create new</strong></span> button:<div class="mediaobject"><img src="../images/00056.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="2">Enter the details of your MongoDB instance. In the following screenshot, the database name is <code class="email">myapp</code> and Amazon EC2 is the cloud-hosting provider. We choose the US East coast data center, as this is where the OpenShift Online application instances are located. This helps to minimize the latency between the OpenShift <a id="id541" class="calibre1"/>application <a id="id542" class="calibre1"/>and the database instance:<div class="mediaobject"><img src="../images/00057.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="3">After the database is successfully provisioned, you will see it listed, as shown in the following screenshot:<div class="mediaobject"><img src="../images/00058.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="4">Click on the<a id="id543" class="calibre1"/> <span class="strong"><strong class="calibre7">myapp</strong></span> database<a id="id544" class="calibre1"/> and you will be shown details of the database:<div class="mediaobject"><img src="../images/00059.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="5">Before you can connect with the database, you need to create a database user. Click on the <span class="strong"><strong class="calibre7">Click here</strong></span> link to create a new database user, as shown in the following screenshot:<div class="mediaobject"><img src="../images/00060.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="6">This will <a id="id545" class="calibre1"/>open a pop up, as <a id="id546" class="calibre1"/>shown in the following screenshot, where you have to enter the username and password for the new database user:<div class="mediaobject"><img src="../images/00061.jpeg" alt="How to do it…" class="calibre8"/></div><p class="calibre12"> </p></li><li class="listitem" value="7">After creation, the <a id="id547" class="calibre1"/>database user will be shown on the database details page under the <span class="strong"><strong class="calibre7">Users</strong></span> tab.</li><li class="listitem" value="8">To connect to the <a id="id548" class="calibre1"/>MongoLab MongoDB instance, you will need to have the <code class="email">mongo</code> command-line client on the gear. Every OpenShift application gear already has the <code class="email">mongo</code> command-line client installed, so you don't have to do anything. Just SSH into the application gear using the <code class="email">rhc ssh</code> command and then enter the following command. The username and password corresponds to the one you created during step 6. The host, port, and database name correspond to the information found in step 4:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ mongo --host &lt;host&gt; --port &lt;port&gt; --username &lt;username&gt; --password &lt;password&gt; &lt;database_name&gt;</strong></span>
</pre></div></li><li class="listitem" value="9">Once connected to the MongoLab MongoDB instance, you can run any valid MongoDB command, as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">&gt; show collections</strong></span>
<span class="strong"><strong class="calibre7">system.indexes</strong></span>
<span class="strong"><strong class="calibre7">system.users</strong></span>
<span class="strong"><strong class="calibre7">&gt; db.msgs.insert({msg:"hello"})</strong></span>
<span class="strong"><strong class="calibre7">&gt; </strong></span>
<span class="strong"><strong class="calibre7">&gt; db.msgs.findOne()</strong></span>
<span class="strong"><strong class="calibre7">{ "_id" : ObjectId("5315aa28317c39c58ecd4f04"), "msg" : "hello" }</strong></span>
</pre></div></li></ol><div class="calibre13"/></div></div></div>

<div class="book" title="Using MongoLab MongoDB-as-a-Service with OpenShift">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch06lvl2sec316" class="calibre1"/>How it works…</h2></div></div></div><a id="id549" class="calibre1"/><p class="calibre6">Step 1 through 4 helped you create a new<a id="id550" class="calibre1"/> instance of the MongoLab MongoDB database instance. You are required to provide details related to your database instance, and MongoLab will provision a MongoDB database instance based on the details you entered. From step 5 through step 7, you created a new database user that will allow you to connect to the MongoDB database instance from the outside world.</p><p class="calibre6">In step 8, you used the database details to connect to the MongoDB instance from the OpenShift application gear using the <code class="email">mongo</code> command-line client. Finally, you ran a few Mongo commands on the connected MongoLab MongoDB database instance. To learn how to connect to MongoLab with your PHP code, you can refer to the OpenShift official blog at <a class="calibre1" href="https://www.openshift.com/blogs/getting-started-with-mongodb-mongolab-php-and-openshift">https://www.openshift.com/blogs/getting-started-with-mongodb-mongolab-php-and-openshift</a>.</p></div></div>

<div class="book" title="Using MongoLab MongoDB-as-a-Service with OpenShift">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch06lvl2sec317" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Adding a MongoDB cartridge to your application</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Adding a MariaDB cartridge to your application"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec81" class="calibre1"/>Adding a MariaDB cartridge to your application</h1></div></div></div><p class="calibre6">In this recipe, you will <a id="id551" class="calibre1"/>learn how to add the MariaDB downloadable <a id="id552" class="calibre1"/>cartridge to your OpenShift application. MariaDB (<a class="calibre1" href="https://mariadb.org/">https://mariadb.org/</a>) is a community fork of the MySQL database. It is intended to be a drop-in replacement for the MySQL database.</p></div>

<div class="book" title="Adding a MariaDB cartridge to your application">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch06lvl2sec318" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To step through this recipe, you will need the <code class="email">rhc</code> command-line client installed on your machine. Refer to the <span class="strong"><em class="calibre10">Installing the OpenShift rhc command-line client</em></span> recipe in <a class="calibre1" title="Chapter 1. Getting Started with OpenShift" href="part0014_split_000.html#page">Chapter 1</a>, <span class="strong"><em class="calibre10">Getting Started with OpenShift</em></span> for details. Also, we will use the application created in the <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe in <a class="calibre1" title="Chapter 3. Creating and Managing Applications" href="part0041_split_000.html#page">Chapter 3</a>, <span class="strong"><em class="calibre10">Creating and Managing Applications</em></span>.</p></div></div>

<div class="book" title="Adding a MariaDB cartridge to your application">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch06lvl2sec319" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">To install the <a id="id553" class="calibre1"/>MariaDB 5.5 downloadable<a id="id554" class="calibre1"/> cartridge on the <code class="email">myapp</code> application, open a new command-line terminal, then change the directory to the <code class="email">myapp</code> directory location and execute the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridge-add https://raw.github.com/openshift-cartridges/mariadb-cartridge/master/metadata/manifest.yml --app myapp</strong></span>
</pre></div><p class="calibre6">The preceding command will install a new instance of the MariaDB server on your application gear.</p><p class="calibre6">You can view the cartridge details using the <code class="email">rhc cartridge-s</code>
<code class="email">how</code> command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridge-show mariadb</strong></span>
<span class="strong"><strong class="calibre7">developercorey-mariadb-5.5 (MariaDB 5.5)</strong></span>
<span class="strong"><strong class="calibre7">----------------------------------------</strong></span>
<span class="strong"><strong class="calibre7">  From:           https://raw.github.com/openshift-cartridges/mariadb-cartridge/master/metadata/manifest.yml</strong></span>
<span class="strong"><strong class="calibre7">  Gears:          Located with php-5.4, cron-1.4</strong></span>
<span class="strong"><strong class="calibre7">  Connection URL: mysql://$OPENSHIFT_MARIADB_DB_HOST:$OPENSHIFT_MARIADB_DB_PORT/</strong></span>
<span class="strong"><strong class="calibre7">  Database Name:  myapp</strong></span>
<span class="strong"><strong class="calibre7">  Password:       wPG6vvBy6_L9</strong></span>
<span class="strong"><strong class="calibre7">  Username:       admin7H6WdQN</strong></span>
</pre></div><p class="calibre6">You can also stop the MariaDB server using the <code class="email">stop</code> command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridge-stop mariadb</strong></span>
</pre></div><p class="calibre6">You can restart the MariaDB server using the <code class="email">restart</code> command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridge-restart mariadb</strong></span>
</pre></div><p class="calibre6">If you want to remove the MariaDB server from your application, you can use the <code class="email">remove</code> command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridge-remove mariadb –-confirm</strong></span>
</pre></div></div></div>

<div class="book" title="Adding a MariaDB cartridge to your application">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch06lvl2sec320" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">When you run <a id="id555" class="calibre1"/>the <code class="email">rhc cartridge-add</code> command, <code class="email">rhc</code> will make an HTTP POST request to the OpenShift server. The OpenShift server will receive the request and instantiate a new instance of the MariaDB server for your application using the manifest file. After provisioning the MariaDB server, the <code class="email">rhc</code> client will show the database details on the command-line terminal.</p><p class="calibre6">You can view the MariaDB installation by performing an SSH into your application gear:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc ssh --app myapp </strong></span>
</pre></div><p class="calibre6">Then, run the <code class="email">ls</code> command to view the gear directory structure and you will see the <code class="email">mariadb</code> directory:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">[myapp-osbook.rhcloud.com 52fb71aa5973caf609000026]\&gt; ls -p</strong></span>
<span class="strong"><strong class="calibre7">app-deployments/  app-root/  cron/  git/  mariadb/  php/</strong></span>
</pre></div><p class="calibre6">The <code class="email">mariadb</code> directory <a id="id556" class="calibre1"/>is your <code class="email">mariadb</code> installation, and it <a id="id557" class="calibre1"/>is not shared with any other OpenShift application or user. It is only for your application, and only your application can access it.</p><p class="calibre6">You can also connect with your MariaDB server using the <code class="email">mysql</code> command-line client. We used the <code class="email">mysql</code> client because it is already installed and compatible with MariaDB.</p><p class="calibre6">Now, you can run SQL commands against your MariaDB server. To view all the databases, run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">mysql&gt; SHOW DATABASES;</strong></span>
<span class="strong"><strong class="calibre7">+--------------------+</strong></span>
<span class="strong"><strong class="calibre7">| Database           |</strong></span>
<span class="strong"><strong class="calibre7">+--------------------+</strong></span>
<span class="strong"><strong class="calibre7">| information_schema |</strong></span>
<span class="strong"><strong class="calibre7">| myapp              |</strong></span>
<span class="strong"><strong class="calibre7">| mysql              |</strong></span>
<span class="strong"><strong class="calibre7">+--------------------+</strong></span>
<span class="strong"><strong class="calibre7">3 rows in set (0.00 sec)</strong></span>
</pre></div><p class="calibre6">The <code class="email">myapp</code> database corresponds to your application database.</p></div></div>

<div class="book" title="Adding a MariaDB cartridge to your application">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch06lvl2sec321" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Adding a MongoDB cartridge to your application</em></span> recipe</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Adding a Redis cartridge to your application"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec82" class="calibre1"/>Adding a Redis cartridge to your application</h1></div></div></div><p class="calibre6">In this recipe, you will <a id="id558" class="calibre1"/>learn how to add the Redis downloadable <a id="id559" class="calibre1"/>cartridge to your OpenShift application. Redis is an open source, advanced, NoSQL key value data store, written in the ANSI C programming language. It is an in-memory data store but also writes to the disk for durability.</p></div>

<div class="book" title="Adding a Redis cartridge to your application">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch06lvl2sec322" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre6">To step through this recipe, you will need the <code class="email">rhc</code> command-line client installed on your machine. Refer to the <span class="strong"><em class="calibre10">Installing the OpenShift rhc command-line client</em></span> recipe in <a class="calibre1" title="Chapter 1. Getting Started with OpenShift" href="part0014_split_000.html#page">Chapter 1</a>, <span class="strong"><em class="calibre10">Getting Started with OpenShift</em></span> for details. Also, we will use the application created in the <span class="strong"><em class="calibre10">Creating an OpenShift application using the rhc command-line client</em></span> recipe in <a class="calibre1" title="Chapter 3. Creating and Managing Applications" href="part0041_split_000.html#page">Chapter 3</a>, <span class="strong"><em class="calibre10">Creating and Managing Applications</em></span>.</p></div></div>

<div class="book" title="Adding a Redis cartridge to your application">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch06lvl2sec323" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre6">To install the Redis downloadable cartridge to the <code class="email">myapp</code> application, open a new command-line terminal, then change the directory to the <code class="email">myapp</code> directory location, and execute the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridge-add http://cartreflect-claytondev.rhcloud.com/reflect?github=smarterclayton/openshift-redis-cart --app myapp</strong></span>
</pre></div><p class="calibre6">This will install a<a id="id560" class="calibre1"/> new instance of the Redis server on your application gear.</p><p class="calibre6">You can view the <a id="id561" class="calibre1"/>cartridge details using the <code class="email">rhc cartridge-show</code> command.</p><p class="calibre6">You can also stop the Redis server using the <code class="email">stop</code> command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridge-stop redis</strong></span>
</pre></div><p class="calibre6">You can restart the Redis server using the <code class="email">restart</code> command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridge-restart redis</strong></span>
</pre></div><p class="calibre6">If you want to remove the Redis server from your application, you can use the <code class="email">remove</code> command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc cartridge-remove redis –-confirm</strong></span>
</pre></div></div></div>

<div class="book" title="Adding a Redis cartridge to your application">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch06lvl2sec324" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre6">When you run the <code class="email">rhc cartridge-add</code> command, <code class="email">rhc</code> will make an HTTP POST request to the OpenShift server. The OpenShift server will receive the request and instantiate a new instance of the Redis server for your application using the manifest file. After provisioning the Redis server, the <code class="email">rhc</code> client will show the database details on the command-line terminal, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">Adding http://cartreflect-claytondev.rhcloud.com/reflect?githubgithub=smarterclayton/openshift-redis-cart to application 'myapp' ... done</strong></span>

<span class="strong"><strong class="calibre7">smarterclayton-redis-2.6 (Redis)</strong></span>
<span class="strong"><strong class="calibre7">--------------------------------</strong></span>
<span class="strong"><strong class="calibre7">  From:  http://cartreflect-claytondev.rhcloud.com/reflect?github=smarterclayton/openshift-redis-cart</strong></span>
<span class="strong"><strong class="calibre7">  Gears: Located with php-5.4</strong></span>

<span class="strong"><strong class="calibre7">Redis is now configured with a default password ZTNiMGM0NDI5OGZjMWMxNDlhZmJmNGM4OTk2ZmI5</strong></span>
<span class="strong"><strong class="calibre7">You can configure various Redis scaling and persistence modes by setting</strong></span>
<span class="strong"><strong class="calibre7">environment variables - consult the cartridge README for more info.</strong></span>
</pre></div><p class="calibre6">You can view the Redis installation by performing an SSH into your application gear:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">$ rhc ssh --app myapp </strong></span>
</pre></div><p class="calibre6">Then, run the <code class="email">ls</code> command to view the gear directory structure, and you will see the <code class="email">redis</code> directory:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">[myapp-osbook.rhcloud.com 52fb71aa5973caf609000026]\&gt; ls -p</strong></span>
<span class="strong"><strong class="calibre7">app-deployments/  app-root/  git/  php/  redis/</strong></span>
</pre></div><p class="calibre6">The <code class="email">redis</code> directory<a id="id562" class="calibre1"/> is your <code class="email">redis</code> installation, and it is not<a id="id563" class="calibre1"/> shared with any other OpenShift application or user. It is only for your application, and only your application can access it.</p><p class="calibre6">You can also connect with your Redis server using the <code class="email">redis-cli</code> command-line client:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">[myapp-osbook.rhcloud.com 53121c645973ca7acf000018]\&gt; redis-cli $REDIS_CLI </strong></span>
<span class="strong"><strong class="calibre7">redis 127.2.34.2:16379&gt; </strong></span>
</pre></div><p class="calibre6">Now, you can run commands against your Redis server. To view the details about your Redis installation, you can run the <code class="email">INFO</code> command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">redis 127.2.34.2:16379&gt; INFO</strong></span>
<span class="strong"><strong class="calibre7"># Server</strong></span>
<span class="strong"><strong class="calibre7">redis_version:2.6.13</strong></span>
<span class="strong"><strong class="calibre7">redis_git_sha1:00000000</strong></span>
<span class="strong"><strong class="calibre7">redis_git_dirty:0</strong></span>
<span class="strong"><strong class="calibre7">redis_mode:standalone</strong></span>
<span class="strong"><strong class="calibre7">os:Linux 2.6.32-431.5.1.el6oso.bz844450.x86_64 x86_64</strong></span>
<span class="strong"><strong class="calibre7">arch_bits:64</strong></span>
<span class="strong"><strong class="calibre7">multiplexing_api:epoll</strong></span>
<span class="strong"><strong class="calibre7">tcp_port:16379</strong></span>
<span class="strong"><strong class="calibre7">uptime_in_seconds:874</strong></span>
<span class="strong"><strong class="calibre7">uptime_in_days:0</strong></span>
<span class="strong"><strong class="calibre7">hz:10</strong></span>
<span class="strong"><strong class="calibre7">lru_clock:957695</strong></span>
<span class="strong"><strong class="calibre7">// removed for brevity</strong></span>
</pre></div></div></div>

<div class="book" title="Adding a Redis cartridge to your application">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch06lvl2sec325" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre6">To learn how to use Redis with a <a id="id564" class="calibre1"/>Java application, you can read my blog at <a class="calibre1" href="https://www.openshift.com/blogs/build-cloud-enabled-java-redis-applications-with-spring-on-openshift">https://www.openshift.com/blogs/build-cloud-enabled-java-redis-applications-with-spring-on-openshift</a>.</p></div></div>

<div class="book" title="Adding a Redis cartridge to your application">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch06lvl2sec326" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">Adding a MariaDB cartridge to your application</em></span> recipe</li></ul></div></div></div></body></html>