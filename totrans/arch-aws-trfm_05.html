<html><head></head><body>
<div id="_idContainer031">
<h1 class="chapter-number" id="_idParaDest-80"><a id="_idTextAnchor079"/><span class="koboSpan" id="kobo.1.1">5</span></h1>
<h1 id="_idParaDest-81"><a id="_idTextAnchor080"/><span class="koboSpan" id="kobo.2.1">Planning and Designing Infrastructure Projects in AWS</span></h1>
<p><span class="koboSpan" id="kobo.3.1">In the world of cloud computing, planning and designing infrastructure projects are crucial steps toward achieving the desired outcome. </span><span class="koboSpan" id="kobo.3.2">As the cloud computing environment evolves, it becomes increasingly important to have a proper plan and design in place for your infrastructure. </span><span class="koboSpan" id="kobo.3.3">With the help of Terraform, an infrastructure-as-code tool, you can easily plan and design your infrastructure projects in </span><strong class="bold"><span class="koboSpan" id="kobo.4.1">Amazon Web </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.5.1">Services</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.6.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.7.1">AWS</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.9.1">This chapter will provide you with the necessary knowledge to get started with planning and designing infrastructure projects using Terraform in AWS. </span><span class="koboSpan" id="kobo.9.2">We will discuss the basics of infrastructure project planning, designing your first Terraform template in AWS, understanding AWS Providers and Terraform modules, and implementing best practices with Terraform AWS modules. </span><span class="koboSpan" id="kobo.9.3">By the end of this chapter, you will have a solid foundation for planning and designing your infrastructure projects in AWS </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">using Terraform.</span></span></p>
<p><span class="koboSpan" id="kobo.11.1">In this chapter, we will cover </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">these topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.13.1">Terraform infrastructure project </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">planning basics</span></span></li>
<li><span class="koboSpan" id="kobo.15.1">How to design your first Terraform template </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">in AWS</span></span></li>
<li><span class="koboSpan" id="kobo.17.1">Understanding </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1">AWS Providers</span></span></li>
<li><span class="koboSpan" id="kobo.19.1">Understanding </span><span class="No-Break"><span class="koboSpan" id="kobo.20.1">Terraform modules</span></span></li>
<li><span class="koboSpan" id="kobo.21.1">How to implement best practices with Terraform </span><span class="No-Break"><span class="koboSpan" id="kobo.22.1">AWS modules</span></span></li>
</ul>
<h1 id="_idParaDest-82"><a id="_idTextAnchor081"/><span class="koboSpan" id="kobo.23.1">Terraform infrastructure project planning basics</span></h1>
<p><span class="koboSpan" id="kobo.24.1">As technology advances, more businesses and leaders are</span><a id="_idIndexMarker193"/><span class="koboSpan" id="kobo.25.1"> beginning to adopt </span><strong class="bold"><span class="koboSpan" id="kobo.26.1">infrastructure as code</span></strong><span class="koboSpan" id="kobo.27.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.28.1">IaC</span></strong><span class="koboSpan" id="kobo.29.1">) to manage their IT infrastructure. </span><span class="koboSpan" id="kobo.29.2">With the increasing need for flexibility and security in software development, IaC offers a high-level code solution to automate the provisioning of infrastructure resources. </span><span class="koboSpan" id="kobo.29.3">However, it’s important to understand both the potential </span><a id="_idIndexMarker194"/><span class="koboSpan" id="kobo.30.1">benefits and challenges that come with implementing IaC. </span><span class="koboSpan" id="kobo.30.2">In this chapter, we will explore the basics of planning and designing infrastructure projects in AWS using Terraform, covering important topics such as AWS Providers, Terraform modules, and </span><span class="No-Break"><span class="koboSpan" id="kobo.31.1">best practices.</span></span></p>
<h2 id="_idParaDest-83"><a id="_idTextAnchor082"/><span class="koboSpan" id="kobo.32.1">The speed benefits</span></h2>
<p><span class="koboSpan" id="kobo.33.1">The adoption of cloud computing has brought</span><a id="_idIndexMarker195"/><span class="koboSpan" id="kobo.34.1"> about IaC, which provides significant speed and agility benefits for deploying, modifying, and removing virtual infrastructure services. </span><span class="koboSpan" id="kobo.34.2">With IaC, teams can interact with infrastructure in a programmatic way, allowing for the automation of lifecycle management. </span><span class="koboSpan" id="kobo.34.3">In some cases, automation solutions can also manage non-programmatic, command-line-interface-based devices using </span><span class="No-Break"><span class="koboSpan" id="kobo.35.1">IaC management.</span></span></p>
<h2 id="_idParaDest-84"><a id="_idTextAnchor083"/><span class="koboSpan" id="kobo.36.1">The risk management benefits</span></h2>
<p><span class="koboSpan" id="kobo.37.1">Implementing IaC in </span><a id="_idIndexMarker196"/><span class="koboSpan" id="kobo.38.1">an organization can offer numerous benefits. </span><span class="koboSpan" id="kobo.38.2">One of the primary advantages is the elimination of human error that often occurs during manual infrastructure provisioning and configuration. </span><span class="koboSpan" id="kobo.38.3">By using IaC, an organization can greatly minimize the risks associated with human error and enhance the security of </span><span class="No-Break"><span class="koboSpan" id="kobo.39.1">its infrastructure.</span></span></p>
<h2 id="_idParaDest-85"><a id="_idTextAnchor084"/><span class="koboSpan" id="kobo.40.1">Security, reusability, and governance</span></h2>
<p><span class="koboSpan" id="kobo.41.1">Setting up an IaC </span><a id="_idIndexMarker197"/><span class="koboSpan" id="kobo.42.1">pipeline is crucial for organizations seeking to realize the full potential of this technology. </span><span class="koboSpan" id="kobo.42.2">Proper setup of an IaC pipeline requires considering factors </span><a id="_idIndexMarker198"/><span class="koboSpan" id="kobo.43.1">such as security, reusability, and governance. </span><span class="koboSpan" id="kobo.43.2">It’s essential to implement a complete continuous integration </span><a id="_idIndexMarker199"/><span class="koboSpan" id="kobo.44.1">and continuous deployment pipeline that includes IaC, especially for applications that require frequent updates. </span><span class="koboSpan" id="kobo.44.2">This approach can significantly improve an organization’s speed to market while </span><span class="No-Break"><span class="koboSpan" id="kobo.45.1">reducing costs.</span></span></p>
<h2 id="_idParaDest-86"><a id="_idTextAnchor085"/><span class="koboSpan" id="kobo.46.1">Team skill sets</span></h2>
<p><span class="koboSpan" id="kobo.47.1">When transitioning to an IaC platform, it’s essential to consider the skill sets of the existing staff. </span><span class="koboSpan" id="kobo.47.2">IaC requires a different </span><a id="_idIndexMarker200"/><span class="koboSpan" id="kobo.48.1">set of development skills that may not be present in the current team. </span><span class="koboSpan" id="kobo.48.2">Neglecting to take this into account can result in demotivation and disengagement among the staff, particularly if coding isn’t a skill set that they have or are interested in acquiring. </span><span class="koboSpan" id="kobo.48.3">Therefore, it’s essential to provide training and support to help employees adapt to this new way </span><span class="No-Break"><span class="koboSpan" id="kobo.49.1">of working.</span></span></p>
<h2 id="_idParaDest-87"><a id="_idTextAnchor086"/><span class="koboSpan" id="kobo.50.1">The best candidates for automation</span></h2>
<p><span class="koboSpan" id="kobo.51.1">Determining which infrastructure should be treated as code is a crucial decision. </span><span class="koboSpan" id="kobo.51.2">It’s not worthwhile to automate</span><a id="_idIndexMarker201"/><span class="koboSpan" id="kobo.52.1"> infrastructure that will be deployed only once in the organization’s lifetime, but it is worth automating infrastructure that will be regularly deployed for new applications or services. </span><span class="koboSpan" id="kobo.52.2">It’s important not to get bogged down in automating everything; instead, make sure your IaC efforts provide a return on investment over </span><span class="No-Break"><span class="koboSpan" id="kobo.53.1">traditional approaches.</span></span></p>
<h2 id="_idParaDest-88"><a id="_idTextAnchor087"/><span class="koboSpan" id="kobo.54.1">The types of applications you’ll be running</span></h2>
<p><span class="koboSpan" id="kobo.55.1">Designing the IaC template for an application is critical for its success. </span><span class="koboSpan" id="kobo.55.2">The configuration should be modularized and driven by the configuration management system, and the design process should take</span><a id="_idIndexMarker202"/><span class="koboSpan" id="kobo.56.1"> into account the application that will run on the infrastructure. </span><span class="koboSpan" id="kobo.56.2">For instance, if you are planning to deploy a database, the IaC design considerations will differ based on whether the application is transactional or for </span><span class="No-Break"><span class="koboSpan" id="kobo.57.1">reporting purposes.</span></span></p>
<h2 id="_idParaDest-89"><a id="_idTextAnchor088"/><span class="koboSpan" id="kobo.58.1">The cost of automating too many tasks</span></h2>
<p><span class="koboSpan" id="kobo.59.1">In the quest to improve efficiency, the</span><a id="_idIndexMarker203"/><span class="koboSpan" id="kobo.60.1"> general guideline is to automate any recurring tasks and reserve manual management for exceptional cases. </span><span class="koboSpan" id="kobo.60.2">This approach will help manage the expectations of internal stakeholders and departments effectively. </span><span class="koboSpan" id="kobo.60.3">However, it’s essential to keep a close eye</span><a id="_idIndexMarker204"/><span class="koboSpan" id="kobo.61.1"> on the </span><strong class="bold"><span class="koboSpan" id="kobo.62.1">return on investment</span></strong><span class="koboSpan" id="kobo.63.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.64.1">ROI</span></strong><span class="koboSpan" id="kobo.65.1">) for automation, as automating every infrastructure task can lead to </span><span class="No-Break"><span class="koboSpan" id="kobo.66.1">cost overruns.</span></span></p>
<h2 id="_idParaDest-90"><a id="_idTextAnchor089"/><span class="koboSpan" id="kobo.67.1">The critical nature of the code</span></h2>
<p><span class="koboSpan" id="kobo.68.1">As infrastructure is critical to</span><a id="_idIndexMarker205"/><span class="koboSpan" id="kobo.69.1"> the success of any business, the code used to manage it should be treated with the same level of importance. </span><span class="koboSpan" id="kobo.69.2">This includes having the right processes and backup procedures in place for when issues arise. </span><span class="koboSpan" id="kobo.69.3">Virtual networks, data centers, and servers require a disciplined approach to change management and testing, just like </span><span class="No-Break"><span class="koboSpan" id="kobo.70.1">physical infrastructure.</span></span></p>
<h2 id="_idParaDest-91"><a id="_idTextAnchor090"/><span class="koboSpan" id="kobo.71.1">The need for software expertise</span></h2>
<p><span class="koboSpan" id="kobo.72.1">Collaboration between software </span><a id="_idIndexMarker206"/><span class="koboSpan" id="kobo.73.1">engineers and infrastructure engineers is crucial for successful IaC implementation. </span><span class="koboSpan" id="kobo.73.2">While infrastructure engineers are experts in managing and deploying infrastructure, they may lack knowledge of software development best practices. </span><span class="koboSpan" id="kobo.73.3">By embedding software engineers with the infrastructure team, organizations can bridge this gap and leverage the expertise of both teams to optimize results. </span><span class="koboSpan" id="kobo.73.4">Adopting an inner source model that encourages sharing and collaboration can further support </span><span class="No-Break"><span class="koboSpan" id="kobo.74.1">this effort.</span></span></p>
<h2 id="_idParaDest-92"><a id="_idTextAnchor091"/><span class="koboSpan" id="kobo.75.1">The impact on agility</span></h2>
<p><span class="koboSpan" id="kobo.76.1">Start-ups in the rapid growth stage</span><a id="_idIndexMarker207"/><span class="koboSpan" id="kobo.77.1"> may not be able to prioritize implementing IaC, as it can result in a lack of agility. </span><span class="koboSpan" id="kobo.77.2">While IaC brings many benefits to larger organizations, smaller companies need to balance implementing the necessary IaC and keeping their engineers motivated to think outside the box. </span><span class="koboSpan" id="kobo.77.3">As a technology company, it is important to maintain innovation and original ideas, which can be hindered by overreliance </span><span class="No-Break"><span class="koboSpan" id="kobo.78.1">on IaC.</span></span></p>
<h2 id="_idParaDest-93"><a id="_idTextAnchor092"/><span class="koboSpan" id="kobo.79.1">Integration with existing infrastructure</span></h2>
<p><span class="koboSpan" id="kobo.80.1">Before adopting IaC, businesses must </span><a id="_idIndexMarker208"/><span class="koboSpan" id="kobo.81.1">assess the potential risks and benefits. </span><span class="koboSpan" id="kobo.81.2">Implementing IaC may come with adoption, security, and scalability challenges, such as integrating new frameworks with existing infrastructure. </span><span class="koboSpan" id="kobo.81.3">It requires a considerable amount of planning, time, and collaboration with other teams, including those responsible for security </span><span class="No-Break"><span class="koboSpan" id="kobo.82.1">and compliance.</span></span></p>
<h2 id="_idParaDest-94"><a id="_idTextAnchor093"/><span class="koboSpan" id="kobo.83.1">Goals and available resources</span></h2>
<p><span class="koboSpan" id="kobo.84.1">Introducing IaC into an organization requires careful planning and consideration of the goals for the transition. </span><span class="koboSpan" id="kobo.84.2">While IaC can bring significant benefits, such as reduced human error and increased security, there are also potential adoption, security, and scalability gaps to consider. </span><span class="koboSpan" id="kobo.84.3">It’s</span><a id="_idIndexMarker209"/><span class="koboSpan" id="kobo.85.1"> essential to have a clear plan for integrating new frameworks with existing infrastructure and collaborating with other teams, including security </span><span class="No-Break"><span class="koboSpan" id="kobo.86.1">and compliance.</span></span></p>
<p><span class="koboSpan" id="kobo.87.1">Moreover, it’s crucial to be mindful of the impact on existing tech and personnel resources. </span><span class="koboSpan" id="kobo.87.2">Pushing inexperienced engineers in a new direction can create an unstable organization. </span><span class="koboSpan" id="kobo.87.3">To minimize this risk, IaC should be incorporated as part of modernization efforts, with a focus on upskilling engineers to handle advanced projects. </span><span class="koboSpan" id="kobo.87.4">By doing so, organizations can ensure a smoother and more effective transition to IaC while maximizing its </span><span class="No-Break"><span class="koboSpan" id="kobo.88.1">potential benefits.</span></span></p>
<h2 id="_idParaDest-95"><a id="_idTextAnchor094"/><span class="koboSpan" id="kobo.89.1">The long-term plan</span></h2>
<p><span class="koboSpan" id="kobo.90.1">When implementing IaC, it’s important to plan for the long term. </span><span class="koboSpan" id="kobo.90.2">This includes considering factors such as maintenance, security, and development time. </span><span class="koboSpan" id="kobo.90.3">It’s also important to have an exit plan in place, which </span><a id="_idIndexMarker210"/><span class="koboSpan" id="kobo.91.1">may involve multiple paths depending on various scenarios. </span><span class="koboSpan" id="kobo.91.2">By having a solid plan in place, you can ensure that your investment in IaC will pay off and that you can adapt to any changes or challenges </span><span class="No-Break"><span class="koboSpan" id="kobo.92.1">that arise.</span></span></p>
<h2 id="_idParaDest-96"><a id="_idTextAnchor095"/><span class="koboSpan" id="kobo.93.1">Quality control and security</span></h2>
<p><span class="koboSpan" id="kobo.94.1">Implementing IaC in the eDiscovery space requires a thoughtful and deliberate approach to avoid introducing unintended </span><a id="_idIndexMarker211"/><span class="koboSpan" id="kobo.95.1">vulnerabilities. </span><span class="koboSpan" id="kobo.95.2">While traditional infrastructure deployment plans account for security holes, an IaC approach offers many benefits. </span><span class="koboSpan" id="kobo.95.3">However, to fully realize these benefits, it is essential to establish a comprehensive program that includes quality control and security measures. </span><span class="koboSpan" id="kobo.95.4">This will help ensure the stability and security of </span><span class="No-Break"><span class="koboSpan" id="kobo.96.1">the infrastructure.</span></span></p>
<h1 id="_idParaDest-97"><a id="_idTextAnchor096"/><span class="koboSpan" id="kobo.97.1">How to design your first Terraform template in AWS</span></h1>
<p><span class="koboSpan" id="kobo.98.1">Designing your first Terraform</span><a id="_idIndexMarker212"/><span class="koboSpan" id="kobo.99.1"> template in AWS can be an intimidating task if you’re new to IaC. </span><span class="koboSpan" id="kobo.99.2">However, understanding the fundamentals and best practices can make the process much smoother. </span><span class="koboSpan" id="kobo.99.3">In this section, we will explore the key components of designing a Terraform template, including defining resources, understanding AWS Providers, and utilizing Terraform modules. </span><span class="koboSpan" id="kobo.99.4">We will also cover tips for implementing best practices with Terraform AWS modules, so you can design and deploy reliable and scalable infrastructure in AWS </span><span class="No-Break"><span class="koboSpan" id="kobo.100.1">with confidence.</span></span></p>
<h2 id="_idParaDest-98"><a id="_idTextAnchor097"/><span class="koboSpan" id="kobo.101.1">Authentication with AWS</span></h2>
<p><span class="koboSpan" id="kobo.102.1">To create and manage resources in AWS using Terraform, you first need </span><a id="_idIndexMarker213"/><span class="koboSpan" id="kobo.103.1">to establish a connection between Terraform and AWS. </span><span class="koboSpan" id="kobo.103.2">This connection is authenticated using programmatic API keys, which consist of an access key and a secret key. </span><span class="koboSpan" id="kobo.103.3">These keys are used to access and manage your AWS resources through Terraform. </span><span class="koboSpan" id="kobo.103.4">In this section, we will explore some sample configurations that illustrate how to use API keys to provision your first infrastructure with Terraform </span><span class="No-Break"><span class="koboSpan" id="kobo.104.1">in AWS:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.105.1">
provider "aws" {
  region     = "us-west-2"
  access_key = "my-access-key"
  secret_key = "my-secret-key"
}</span></pre> <p><span class="koboSpan" id="kobo.106.1">To start, we should go and create these access and secret keys for Terraform from your </span><span class="No-Break"><span class="koboSpan" id="kobo.107.1">AWS account.</span></span></p>
<h2 id="_idParaDest-99"><a id="_idTextAnchor098"/><span class="koboSpan" id="kobo.108.1">Setting up programmatic access</span></h2>
<p><span class="koboSpan" id="kobo.109.1">Log in to the AWS Management Console, and then in</span><a id="_idIndexMarker214"/><span class="koboSpan" id="kobo.110.1"> the services, go to IAM, and perform the </span><span class="No-Break"><span class="koboSpan" id="kobo.111.1">following steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.112.1">Add the new user and key in the </span><strong class="bold"><span class="koboSpan" id="kobo.113.1">User </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.114.1">name</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.115.1"> field:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer026">
<span class="koboSpan" id="kobo.116.1"><img alt="Figure 5.1 – Adding user" src="image/B18198_05_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.117.1">Figure 5.1 – Adding user</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.118.1">Select </span><strong class="bold"><span class="koboSpan" id="kobo.119.1">Attach existing policies directly</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.120.1">and </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.121.1">AdmininistratorAccess</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.122.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer027">
<span class="koboSpan" id="kobo.123.1"><img alt="Figure 5.2 – Setting permission﻿s" src="image/B18198_05_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.124.1">Figure 5.2 – Setting permissions</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.125.1">Click </span><strong class="bold"><span class="koboSpan" id="kobo.126.1">Next</span></strong><span class="koboSpan" id="kobo.127.1"> until you </span><a id="_idIndexMarker215"/><span class="koboSpan" id="kobo.128.1">see the </span><span class="No-Break"><span class="koboSpan" id="kobo.129.1">following screen.</span></span></p>
<div>
<span class="koboSpan" id="kobo.130.1"><img alt="Figure 5.3 – Success screen" src="image/B18198_05_03.png"/></span>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.131.1">Figure 5.3 – Success screen</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.132.1">Complete the process and get </span><span class="No-Break"><span class="koboSpan" id="kobo.133.1">your keys.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.134.1">After generating your access key ID and secret access key in the AWS console, it is important to securely store these credentials. </span><span class="koboSpan" id="kobo.134.2">While Terraform allows for the access key and secret key to be hardcoded within the configuration file, this approach is not</span><a id="_idIndexMarker216"/><span class="koboSpan" id="kobo.135.1"> recommended due to security risks. </span><span class="koboSpan" id="kobo.135.2">Instead, it is advised to save these keys as environment variables or as an AWS </span><span class="No-Break"><span class="koboSpan" id="kobo.136.1">config profile.</span></span></p><ul><li><span class="koboSpan" id="kobo.137.1">Set as </span><span class="No-Break"><span class="koboSpan" id="kobo.138.1">environment variables:</span></span></li></ul><p class="list-inset"><span class="koboSpan" id="kobo.139.1">To authenticate with AWS in your terminal or command line, you will need to run specific commands with your access and </span><span class="No-Break"><span class="koboSpan" id="kobo.140.1">secret key.</span></span></p><pre class="source-code"><span class="koboSpan" id="kobo.141.1">
export AWS_ACCESS_KEY_ID=AK************IEVXQ
export AWS_SECRET_ACCESS_KEY=gbaIbK*********************iwN0dGfS</span></pre><ul><li><span class="koboSpan" id="kobo.142.1">Set up as an AWS </span><span class="No-Break"><span class="koboSpan" id="kobo.143.1">config profile:</span></span></li></ul><p class="list-inset"><span class="koboSpan" id="kobo.144.1">To get started, you’ll need to download and set up the </span><span class="No-Break"><span class="koboSpan" id="kobo.145.1">AWS CLI.</span></span></p><p class="list-inset"><span class="koboSpan" id="kobo.146.1">Refer to this guide for instructions on how to install and configure the AWS CLI on </span><span class="No-Break"><span class="koboSpan" id="kobo.147.1">your system:</span></span></p><p class="list-inset"><a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html"><span class="No-Break"><span class="koboSpan" id="kobo.148.1">https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html</span></span></a></p><p class="list-inset"><span class="koboSpan" id="kobo.149.1">After successfully installing AWS CLI, here are the steps for configuring your profile that you can do from </span><span class="No-Break"><span class="koboSpan" id="kobo.150.1">your terminal:</span></span></p><p class="list-inset"><span class="koboSpan" id="kobo.151.1">First, you need to run </span><span class="No-Break"><span class="koboSpan" id="kobo.152.1">the following:</span></span></p><pre class="source-code"><span class="koboSpan" id="kobo.153.1">aws configure</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.154.1">After this, you will be asked to fill in the following information that you have downloaded from the </span><span class="No-Break"><span class="koboSpan" id="kobo.155.1">AWS console:</span></span></p><pre class="source-code"><span class="koboSpan" id="kobo.156.1">AWS Access Key ID [None]: </span><strong class="bold"><span class="koboSpan" id="kobo.157.1">downloaded access key id</span></strong><span class="koboSpan" id="kobo.158.1">
Secret Access Key [None]: </span><strong class="bold"><span class="koboSpan" id="kobo.159.1">downloaded secret access key</span></strong><span class="koboSpan" id="kobo.160.1">
Default region name [None]: </span><strong class="bold"><span class="koboSpan" id="kobo.161.1">us-west-2</span></strong><span class="koboSpan" id="kobo.162.1">
Default output format [None]: </span><strong class="bold"><span class="koboSpan" id="kobo.163.1">json</span></strong></pre></li> <li><span class="koboSpan" id="kobo.164.1">Download and install </span><span class="No-Break"><span class="koboSpan" id="kobo.165.1">Terraform CLI</span></span><p class="list-inset"><span class="koboSpan" id="kobo.166.1">To get started with</span><a id="_idIndexMarker217"/><span class="koboSpan" id="kobo.167.1"> Terraform, you can download the single-file binary and run it without any additional installation. </span><span class="koboSpan" id="kobo.167.2">The installation process is straightforward and can be completed by following the instructions provided on the official </span><span class="No-Break"><span class="koboSpan" id="kobo.168.1">Terraform website.</span></span></p><p class="list-inset"><span class="koboSpan" id="kobo.169.1">Once Terraform is installed, you can start creating your IaC using the </span><span class="No-Break"><span class="koboSpan" id="kobo.170.1">Terraform CLI:</span></span></p><p class="list-inset"><a href="https://developer.hashicorp.com/terraform/tutorials/aws-get-started/install-cli"><span class="No-Break"><span class="koboSpan" id="kobo.171.1">https://developer.hashicorp.com/terraform/tutorials/aws-get-started/install-cli</span></span></a></p></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.172.1">Terraform configuration:</span></span><p class="list-inset"><span class="koboSpan" id="kobo.173.1">Terraform requires a specific file known as the Terraform configuration file as input. </span><span class="koboSpan" id="kobo.173.2">This file is written in </span><strong class="bold"><span class="koboSpan" id="kobo.174.1">HashiCorp Configuration Language</span></strong><span class="koboSpan" id="kobo.175.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.176.1">HCL</span></strong><span class="koboSpan" id="kobo.177.1">), but can also be written </span><span class="No-Break"><span class="koboSpan" id="kobo.178.1">in JSON.</span></span></p><p class="list-inset"><span class="koboSpan" id="kobo.179.1">Here is a sample Terraform configuration file with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.180.1">*.tf</span></strong><span class="koboSpan" id="kobo.181.1"> extension. </span><span class="koboSpan" id="kobo.181.2">This example assumes that the AWS config profile is being used and references the default profile </span><span class="No-Break"><span class="koboSpan" id="kobo.182.1">for authentication:</span></span></p><pre class="source-code"><span class="koboSpan" id="kobo.183.1">
provider "aws" {
  profile    = "default"
  region     = "us-east-1"
}
resource "aws_instance" "example" {
  ami           = "ami-2757f631"
  instance_type = "t2.micro"
}</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.184.1">If you are using the</span><a id="_idIndexMarker218"/><span class="koboSpan" id="kobo.185.1"> environment variables method for authentication, you can remove the profile line from the Provider block in your Terraform </span><span class="No-Break"><span class="koboSpan" id="kobo.186.1">configuration file.</span></span></p><p class="list-inset"><span class="koboSpan" id="kobo.187.1">A Terraform configuration file consists of several elements, known as blocks, including Providers, resources, </span><span class="No-Break"><span class="koboSpan" id="kobo.188.1">and more.</span></span></p><p class="list-inset"><span class="koboSpan" id="kobo.189.1">Here is an example of how the syntax for a Terraform configuration file block </span><span class="No-Break"><span class="koboSpan" id="kobo.190.1">is formatted:</span></span></p><pre class="source-code"><span class="koboSpan" id="kobo.191.1">resource "aws_vpc" "main" {
  cidr_block = var.base_cidr_block
}
 &lt;BLOCK TYPE&gt; "&lt;BLOCK NAME&gt;" "&lt;BLOCK LABEL&gt;" {
  # Block body
  &lt;IDENTIFIER&gt; = &lt;EXPRESSION&gt; # Argument
}</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.192.1">Terraform offers a wide range of </span><strong class="source-inline"><span class="koboSpan" id="kobo.193.1">BLOCK_TYPE</span></strong><span class="koboSpan" id="kobo.194.1"> options, with the primary one being the resource. </span><span class="koboSpan" id="kobo.194.2">The other blocks support building the specified resource. </span><span class="koboSpan" id="kobo.194.3">These blocks include providers, which represent providers such as AWS, Google, </span><span class="No-Break"><span class="koboSpan" id="kobo.195.1">and Azure:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.196.1">providers</span></strong><span class="koboSpan" id="kobo.197.1">: Specifies the name of the Provider, such as AWS, Google, </span><span class="No-Break"><span class="koboSpan" id="kobo.198.1">and Azure</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.199.1">resources</span></strong><span class="koboSpan" id="kobo.200.1">: Specifies a specific resource within the Provider, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.201.1">aws_instance</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.202.1">for AWS</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.203.1">variable</span></strong><span class="koboSpan" id="kobo.204.1">: Declares input variables for the </span><span class="No-Break"><span class="koboSpan" id="kobo.205.1">Terraform configuration</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.206.1">output</span></strong><span class="koboSpan" id="kobo.207.1">: Declares output variables that will be stored in the Terraform </span><span class="No-Break"><span class="koboSpan" id="kobo.208.1">state file</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.209.1">local</span></strong><span class="koboSpan" id="kobo.210.1">: Assigns a value to</span><a id="_idIndexMarker219"/><span class="koboSpan" id="kobo.211.1"> an expression, which can be used as a temporary variable within </span><span class="No-Break"><span class="koboSpan" id="kobo.212.1">a module</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.213.1">module</span></strong><span class="koboSpan" id="kobo.214.1">: A container for multiple resources that are </span><span class="No-Break"><span class="koboSpan" id="kobo.215.1">used together</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.216.1">data</span></strong><span class="koboSpan" id="kobo.217.1">: Collects data from the remote Provider and saves it as a </span><span class="No-Break"><span class="koboSpan" id="kobo.218.1">data source</span></span></li>
</ul>
<h2 id="_idParaDest-100"><a id="_idTextAnchor099"/><span class="koboSpan" id="kobo.219.1">Create your first AWS infrastructure with Terraform</span></h2>
<p><span class="koboSpan" id="kobo.220.1">Here are the steps to practically </span><a id="_idIndexMarker220"/><span class="koboSpan" id="kobo.221.1">apply Terraform and create an </span><span class="No-Break"><span class="koboSpan" id="kobo.222.1">EC2 instance:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.223.1">Create a directory for your </span><a id="_idIndexMarker221"/><span class="koboSpan" id="kobo.224.1">Terraform project and save the following code as a file </span><span class="No-Break"><span class="koboSpan" id="kobo.225.1">named </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.226.1">main.tf</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.227.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.228.1">Initialize the directory using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.229.1">terraform </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.230.1">init</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.231.1"> command.</span></span></li>
<li><span class="koboSpan" id="kobo.232.1">Verify the proposed changes by running the </span><strong class="source-inline"><span class="koboSpan" id="kobo.233.1">terraform </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.234.1">plan</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.235.1"> command.</span></span></li>
<li><span class="koboSpan" id="kobo.236.1">If you are satisfied with the changes that Terraform plans to make, execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.237.1">terraform apply</span></strong><span class="koboSpan" id="kobo.238.1"> to commit and provision the </span><span class="No-Break"><span class="koboSpan" id="kobo.239.1">AWS infrastructure.</span></span></li>
</ol>
<h3><span class="koboSpan" id="kobo.240.1">Step 1 – creating a template file for Terraform AWS infrastructure</span></h3>
<p><span class="koboSpan" id="kobo.241.1">To create an EC2 instance in AWS using Terraform, we first need to create a directory and generate a Terraform configuration file named </span><strong class="source-inline"><span class="koboSpan" id="kobo.242.1">main.tf</span></strong><span class="koboSpan" id="kobo.243.1">. </span><span class="koboSpan" id="kobo.243.2">It’s important to ensure that no other </span><strong class="source-inline"><span class="koboSpan" id="kobo.244.1">*.tf</span></strong><span class="koboSpan" id="kobo.245.1"> files are present</span><a id="_idIndexMarker222"/><span class="koboSpan" id="kobo.246.1"> in the directory, as Terraform considers all files ending with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.247.1">.tf</span></strong><span class="koboSpan" id="kobo.248.1"> extension as part of the </span><span class="No-Break"><span class="koboSpan" id="kobo.249.1">provisioning process.</span></span></p>
<p><span class="koboSpan" id="kobo.250.1">We can copy the following content and save it </span><span class="No-Break"><span class="koboSpan" id="kobo.251.1">as </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.252.1">main.tf</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.253.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.254.1">
provider "aws" {
  profile    = "default"
  region     = "us-east-2"
}
resource "aws_instance" "example" {
  ami           = "ami-0fb653ca2d3203ac1"
  instance_type = "t2.micro"
}</span></pre> <p><span class="koboSpan" id="kobo.255.1">To provision an AWS EC2 instance using Terraform, you need to set the required arguments for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.256.1">aws_instance</span></strong><span class="koboSpan" id="kobo.257.1"> resource. </span><span class="koboSpan" id="kobo.257.2">While there are many different arguments available, for this example, we will only set the two </span><span class="No-Break"><span class="koboSpan" id="kobo.258.1">required arguments:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.259.1">ami</span></strong><span class="koboSpan" id="kobo.260.1">: To launch an EC2 instance with Terraform, you need to specify the </span><strong class="bold"><span class="koboSpan" id="kobo.261.1">Amazon Machine Image </span></strong><span class="koboSpan" id="kobo.262.1">(</span><strong class="bold"><span class="koboSpan" id="kobo.263.1">AMI</span></strong><span class="koboSpan" id="kobo.264.1">) to run on</span><a id="_idIndexMarker223"/><span class="koboSpan" id="kobo.265.1"> the instance. </span><span class="koboSpan" id="kobo.265.2">You can find free and paid AMIs in the AWS Marketplace or create your own using tools such as Packer. </span><span class="koboSpan" id="kobo.265.3">In the code provided, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.266.1">ami</span></strong><span class="koboSpan" id="kobo.267.1"> parameter is set to the ID of an Ubuntu 20.04 AMI in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.268.1">us-east-2</span></strong><span class="koboSpan" id="kobo.269.1"> region, which is free to use. </span><span class="koboSpan" id="kobo.269.2">It’s important to note that AMI IDs are different in every AWS region, so if you change the region parameter to something other than </span><strong class="source-inline"><span class="koboSpan" id="kobo.270.1">us-east-2</span></strong><span class="koboSpan" id="kobo.271.1">, you’ll need to manually look up the corresponding Ubuntu AMI ID for that region and copy it into the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.272.1">ami</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.273.1"> parameter.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.274.1">instance_type</span></strong><span class="koboSpan" id="kobo.275.1">: The EC2 instance type determines the amount of CPU, memory, disk space, and networking capacity available. </span><span class="koboSpan" id="kobo.275.2">Each type offers different specifications, and the example provided uses </span><strong class="source-inline"><span class="koboSpan" id="kobo.276.1">t2.micro</span></strong><span class="koboSpan" id="kobo.277.1">, which offers one virtual CPU and 1 GB of </span><a id="_idIndexMarker224"/><span class="koboSpan" id="kobo.278.1">memory, and is included in the AWS </span><span class="No-Break"><span class="koboSpan" id="kobo.279.1">Free Tier.</span></span></li>
</ul>
<h3><span class="koboSpan" id="kobo.280.1">Step 2 – initialize Terraform</span></h3>
<p><span class="koboSpan" id="kobo.281.1">After saving the </span><strong class="source-inline"><span class="koboSpan" id="kobo.282.1">main.tf</span></strong><span class="koboSpan" id="kobo.283.1"> file in the newly created directory, the next step is to initialize Terraform. </span><span class="koboSpan" id="kobo.283.2">This process is similar to initializing a local repository using </span><strong class="source-inline"><span class="koboSpan" id="kobo.284.1">git</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.285.1">init</span></strong><span class="koboSpan" id="kobo.286.1">. </span><span class="koboSpan" id="kobo.286.2">The purpose of this step is to set up the</span><a id="_idIndexMarker225"/><span class="koboSpan" id="kobo.287.1"> Terraform environment and download any necessary plugins or modules. </span><span class="koboSpan" id="kobo.287.2">To initialize Terraform, open your terminal, navigate to the directory where the </span><strong class="source-inline"><span class="koboSpan" id="kobo.288.1">main.tf</span></strong><span class="koboSpan" id="kobo.289.1"> file is saved, and run the </span><span class="No-Break"><span class="koboSpan" id="kobo.290.1">following command:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.291.1">
terraform init</span></pre> <p><span class="koboSpan" id="kobo.292.1">The response should be similar to the </span><span class="No-Break"><span class="koboSpan" id="kobo.293.1">following output:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.294.1">
Initializing the backend...
</span><span class="koboSpan" id="kobo.294.2">Initializing provider plugins...
</span><span class="koboSpan" id="kobo.294.3">- Checking for available provider plugins...
</span><span class="koboSpan" id="kobo.294.4">- Downloading plugin for provider "aws" (hashicorp/aws) 2.44.0...
</span><span class="koboSpan" id="kobo.294.5">The following providers do not have any version constraints in configuration, so the latest version was installed.
</span><span class="koboSpan" id="kobo.294.6">To prevent automatic upgrades to new major versions that may contain breaking changes, it is recommended to add version = "..." </span><span class="koboSpan" id="kobo.294.7">constraints to the corresponding provider blocks in configuration, with the constraint string suggested below.
</span><span class="koboSpan" id="kobo.294.8">* provider.aws: version = "~&gt; 2.44"
Terraform has been successfully initialized!
</span><span class="koboSpan" id="kobo.294.9">You may now begin working with Terraform. </span><span class="koboSpan" id="kobo.294.10">Try running a "terraform plan" to see any changes that are required for your infrastructure. </span><span class="koboSpan" id="kobo.294.11">All Terraform commands should now work.
</span><span class="koboSpan" id="kobo.294.12">If you ever set or change modules or backend configuration for Terraform rerun this command to reinitialize your working directory. </span><span class="koboSpan" id="kobo.294.13">If you forget, other commands will detect it and remind you to do so if necessary.</span></pre> <p><span class="koboSpan" id="kobo.295.1">When working with Terraform, the code for providers such as AWS, Azure, and GCP are not included in the Terraform binary. </span><span class="koboSpan" id="kobo.295.2">Therefore, when starting with new Terraform code, it’s essential to run the command </span><strong class="source-inline"><span class="koboSpan" id="kobo.296.1">terraform init</span></strong><span class="koboSpan" id="kobo.297.1"> to scan the code, identify which providers are being</span><a id="_idIndexMarker226"/><span class="koboSpan" id="kobo.298.1"> used, and download the corresponding code for them. </span><span class="koboSpan" id="kobo.298.2">By default, this code is downloaded into a </span><strong class="source-inline"><span class="koboSpan" id="kobo.299.1">.terraform</span></strong><span class="koboSpan" id="kobo.300.1"> folder, which serves as Terraform’s scratch directory. </span><span class="koboSpan" id="kobo.300.2">Additionally, Terraform records information about the downloaded Provider code into a </span><strong class="source-inline"><span class="koboSpan" id="kobo.301.1">.terraform.lock.hcl</span></strong><span class="koboSpan" id="kobo.302.1"> file. </span><span class="koboSpan" id="kobo.302.2">It’s important to note that the </span><strong class="source-inline"><span class="koboSpan" id="kobo.303.1">init</span></strong><span class="koboSpan" id="kobo.304.1"> command can be safely executed multiple times and is idempotent. </span><span class="koboSpan" id="kobo.304.2">In later chapters, we will explore further uses for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.305.1">init</span></strong><span class="koboSpan" id="kobo.306.1"> command and </span><strong class="source-inline"><span class="koboSpan" id="kobo.307.1">.</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.308.1">terraform</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.309.1"> folder.</span></span></p>
<h3><span class="koboSpan" id="kobo.310.1">Step 3 – pre-validate/predict the change—a pilot run</span></h3>
<p><span class="koboSpan" id="kobo.311.1">Running the </span><strong class="source-inline"><span class="koboSpan" id="kobo.312.1">terraform plan -out tfplan</span></strong><span class="koboSpan" id="kobo.313.1"> command will provide detailed information about the changes that will be made to your AWS infrastructure. </span><span class="koboSpan" id="kobo.313.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.314.1">-out</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.315.1">tfplan</span></strong><span class="koboSpan" id="kobo.316.1"> flag will save the </span><strong class="source-inline"><span class="koboSpan" id="kobo.317.1">plan</span></strong><span class="koboSpan" id="kobo.318.1"> output to a file named </span><strong class="source-inline"><span class="koboSpan" id="kobo.319.1">tfplan</span></strong><span class="koboSpan" id="kobo.320.1">. </span><span class="koboSpan" id="kobo.320.2">This ensures that the planned changes will be </span><a id="_idIndexMarker227"/><span class="koboSpan" id="kobo.321.1">applied without any modification, and what is seen during the planning phase will be committed. </span><span class="koboSpan" id="kobo.321.2">It is now time to apply the plan by running the </span><strong class="source-inline"><span class="koboSpan" id="kobo.322.1">terraform apply </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.323.1">tfplan</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.324.1"> command:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.325.1">
terraform plan</span></pre> <p><span class="koboSpan" id="kobo.326.1">The output of the previous command should display the changes that Terraform plans to make to your AWS infrastructure. </span><span class="koboSpan" id="kobo.326.2">It should look similar to </span><span class="No-Break"><span class="koboSpan" id="kobo.327.1">the following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.328.1">
(...)
Terraform will perform the following actions:
  # aws_instance.example will be created
  + resource "aws_instance" "example" {
      + ami                          = "ami-0fb653ca2d3203ac1"
      + arn                          = (known after apply)
      + associate_public_ip_address  = (known after apply)
      + availability_zone            = (known after apply)
      + cpu_core_count               = (known after apply)
      + cpu_threads_per_core         = (known after apply)
      + get_password_data            = false
      + host_id                      = (known after apply)
      + id                           = (known after apply)
      + instance_state               = (known after apply)
      + instance_type                = "t2.micro"
      + ipv6_address_count           = (known after apply)
      + ipv6_addresses               = (known after apply)
      + key_name                     = (known after apply)
      (...)
  }
Plan: 1 to add, 0 to change, 0 to destroy.</span></pre> <p><span class="koboSpan" id="kobo.329.1">When you execute the </span><strong class="source-inline"><span class="koboSpan" id="kobo.330.1">terraform plan</span></strong><span class="koboSpan" id="kobo.331.1"> command, Terraform will provide a detailed output of what changes it plans to make to your AWS infrastructure. </span><span class="koboSpan" id="kobo.331.2">It’s a great way to verify the resources that will be created or destroyed and to see whether anything unexpected </span><span class="No-Break"><span class="koboSpan" id="kobo.332.1">will happen.</span></span></p>
<p><span class="koboSpan" id="kobo.333.1">Keep in mind that when</span><a id="_idIndexMarker228"/><span class="koboSpan" id="kobo.334.1"> making modifications to existing resources, Terraform may need to destroy and recreate them. </span><span class="koboSpan" id="kobo.334.2">In such cases, the output will mention that the resource is going to be destroyed. </span><span class="koboSpan" id="kobo.334.3">Make sure to review the output carefully to avoid </span><span class="No-Break"><span class="koboSpan" id="kobo.335.1">unintended results.</span></span></p>
<p><span class="koboSpan" id="kobo.336.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.337.1">plan</span></strong><span class="koboSpan" id="kobo.338.1"> command is an essential tool for verifying your Terraform code before applying it to your infrastructure. </span><span class="koboSpan" id="kobo.338.2">The output of the command is similar to the output of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.339.1">diff</span></strong><span class="koboSpan" id="kobo.340.1"> command in Unix, Linux, and Git. </span><span class="koboSpan" id="kobo.340.2">The output displays a plus sign (</span><strong class="source-inline"><span class="koboSpan" id="kobo.341.1">+</span></strong><span class="koboSpan" id="kobo.342.1">) for resources that will be created, a minus sign (</span><strong class="source-inline"><span class="koboSpan" id="kobo.343.1">-</span></strong><span class="koboSpan" id="kobo.344.1">) for resources that will be deleted, and a tilde sign (</span><strong class="source-inline"><span class="koboSpan" id="kobo.345.1">~</span></strong><span class="koboSpan" id="kobo.346.1">) for resources that will be modified </span><span class="No-Break"><span class="koboSpan" id="kobo.347.1">in place.</span></span></p>
<p><span class="koboSpan" id="kobo.348.1">In the case of the preceding output, Terraform is planning on creating a single EC2 instance and nothing else, which is exactly what you want. </span><span class="koboSpan" id="kobo.348.2">Be sure to monitor the last line of the output every</span><a id="_idIndexMarker229"/><span class="koboSpan" id="kobo.349.1"> time you run the </span><strong class="source-inline"><span class="koboSpan" id="kobo.350.1">plan</span></strong><span class="koboSpan" id="kobo.351.1"> command to ensure that there are no </span><span class="No-Break"><span class="koboSpan" id="kobo.352.1">unintended results:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.353.1">
Plan: 1 to add, 0 to change, 0 to destroy.</span></pre> <h3><span class="koboSpan" id="kobo.354.1">Step 4 – apply the plan with terraform apply</span></h3>
<p><span class="koboSpan" id="kobo.355.1">Now that we have confirmed our </span><a id="_idIndexMarker230"/><span class="koboSpan" id="kobo.356.1">changes with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.357.1">terraform plan</span></strong><span class="koboSpan" id="kobo.358.1"> command, we can move forward and execute the changes using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.359.1">terraform apply</span></strong><span class="koboSpan" id="kobo.360.1"> command. </span><span class="koboSpan" id="kobo.360.2">Unlike </span><strong class="source-inline"><span class="koboSpan" id="kobo.361.1">terraform plan</span></strong><span class="koboSpan" id="kobo.362.1">, which is a dry run, </span><strong class="source-inline"><span class="koboSpan" id="kobo.363.1">terraform apply</span></strong><span class="koboSpan" id="kobo.364.1"> makes real changes to our AWS infrastructure based on the </span><span class="No-Break"><span class="koboSpan" id="kobo.365.1">configuration file.</span></span></p>
<p><span class="koboSpan" id="kobo.366.1">Be sure to double-check the output before entering </span><strong class="source-inline"><span class="koboSpan" id="kobo.367.1">yes</span></strong><span class="koboSpan" id="kobo.368.1"> to apply the changes. </span><span class="koboSpan" id="kobo.368.2">Once you have confirmed the changes, Terraform will begin creating the </span><span class="No-Break"><span class="koboSpan" id="kobo.369.1">infrastructure resources:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.370.1">
terraform apply</span></pre> <p><span class="koboSpan" id="kobo.371.1">The output should be </span><span class="No-Break"><span class="koboSpan" id="kobo.372.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.373.1">
Terraform will perform the following actions:
  # aws_instance.example will be created
  + resource "aws_instance" "example" {
      + ami                          = "ami-0fb653ca2d3203ac1"
      + arn                          = (known after apply)
      + associate_public_ip_address  = (known after apply)
      + availability_zone            = (known after apply)
      + cpu_core_count               = (known after apply)
      + cpu_threads_per_core         = (known after apply)
      + get_password_data            = false
      + host_id                      = (known after apply)
      + id                           = (known after apply)
      + instance_state               = (known after apply)
      + instance_type                = "t2.micro"
      + ipv6_address_count           = (known after apply)
      + ipv6_addresses               = (known after apply)
      + key_name                     = (known after apply)
      (...)
  }
Plan: 1 to add, 0 to change, 0 to destroy.
</span><span class="koboSpan" id="kobo.373.2">Do you want to perform these actions?
</span><span class="koboSpan" id="kobo.373.3">  Terraform will perform the actions described above.
</span><span class="koboSpan" id="kobo.373.4">  Only 'yes' will be accepted to approve.
</span><span class="koboSpan" id="kobo.373.5">  Enter a value:</span></pre> <p><span class="koboSpan" id="kobo.374.1">You’ll observe that the </span><strong class="source-inline"><span class="koboSpan" id="kobo.375.1">apply</span></strong><span class="koboSpan" id="kobo.376.1"> command displays the same plan output and seeks your confirmation on whether </span><a id="_idIndexMarker231"/><span class="koboSpan" id="kobo.377.1">you wish to proceed with said plan. </span><span class="koboSpan" id="kobo.377.2">Although the </span><strong class="source-inline"><span class="koboSpan" id="kobo.378.1">plan</span></strong><span class="koboSpan" id="kobo.379.1"> command is available separately, it’s primarily useful for quick assessments and during code reviews. </span><span class="koboSpan" id="kobo.379.2">Most often, you’ll directly execute the </span><strong class="source-inline"><span class="koboSpan" id="kobo.380.1">apply</span></strong><span class="koboSpan" id="kobo.381.1"> command and review the plan output </span><span class="No-Break"><span class="koboSpan" id="kobo.382.1">it presents.</span></span></p>
<p><span class="koboSpan" id="kobo.383.1">Type </span><strong class="source-inline"><span class="koboSpan" id="kobo.384.1">yes</span></strong><span class="koboSpan" id="kobo.385.1"> and hit </span><em class="italic"><span class="koboSpan" id="kobo.386.1">Enter</span></em><span class="koboSpan" id="kobo.387.1"> to deploy the </span><span class="No-Break"><span class="koboSpan" id="kobo.388.1">EC2 instance:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.389.1">
Do you want to perform these actions?
</span><span class="koboSpan" id="kobo.389.2">  Terraform will perform the actions described above.
</span><span class="koboSpan" id="kobo.389.3">  Only 'yes' will be accepted to approve.
</span><span class="koboSpan" id="kobo.389.4">  Enter a value: yes
aws_instance.example: Creating...
</span><span class="koboSpan" id="kobo.389.5">aws_instance.example: Still creating... </span><span class="koboSpan" id="kobo.389.6">[10s elapsed]
aws_instance.example: Still creating... </span><span class="koboSpan" id="kobo.389.7">[20s elapsed]
aws_instance.example: Still creating... </span><span class="koboSpan" id="kobo.389.8">[30s elapsed]
aws_instance.example: Creation complete after 38s [id=i-07e2a3exxx]
Apply complete! </span><span class="koboSpan" id="kobo.389.9">Resources: 1 added, 0 changed, 0 destroyed.</span></pre> <p><span class="koboSpan" id="kobo.390.1">Congratulations! </span><span class="koboSpan" id="kobo.390.2">You have successfully deployed an EC2 instance in your AWS account using Terraform. </span><span class="koboSpan" id="kobo.390.3">To</span><a id="_idIndexMarker232"/><span class="koboSpan" id="kobo.391.1"> confirm this, go to the EC2 console and check that your instance has </span><span class="No-Break"><span class="koboSpan" id="kobo.392.1">been provisioned.</span></span></p>
<h1 id="_idParaDest-101"><a id="_idTextAnchor100"/><span class="koboSpan" id="kobo.393.1">Understanding AWS Providers</span></h1>
<p><span class="koboSpan" id="kobo.394.1">When working with Terraform to provision infrastructure in AWS, it’s crucial to understand the concept of AWS Providers. </span><span class="koboSpan" id="kobo.394.2">In Terraform, a Provider is responsible for understanding the API interactions with a particular service and exposing the available resources and data</span><a id="_idIndexMarker233"/><span class="koboSpan" id="kobo.395.1"> sources. </span><span class="koboSpan" id="kobo.395.2">AWS is one of the most widely used cloud providers, and Terraform provides a rich set of AWS Provider resources to manage AWS infrastructure. </span><span class="koboSpan" id="kobo.395.3">In this section, we’ll explore what AWS Providers are, how to configure and authenticate them, and best practices for working with AWS Providers </span><span class="No-Break"><span class="koboSpan" id="kobo.396.1">in Terraform.</span></span></p>
<h2 id="_idParaDest-102"><a id="_idTextAnchor101"/><span class="koboSpan" id="kobo.397.1">What are AWS Providers and why are they important in Terraform?</span></h2>
<p><span class="koboSpan" id="kobo.398.1">AWS Providers are plugins that allow Terraform to interact with the AWS API to manage infrastructure resources in AWS. </span><span class="koboSpan" id="kobo.398.2">They </span><a id="_idIndexMarker234"/><span class="koboSpan" id="kobo.399.1">enable Terraform to provision, modify, and delete AWS resources such as EC2 instances, S3 buckets, and VPCs. </span><span class="koboSpan" id="kobo.399.2">Providers are critical components of Terraform, allowing it to automate the provisioning of infrastructure across multiple cloud platforms and on-premises </span><span class="No-Break"><span class="koboSpan" id="kobo.400.1">data centers.</span></span></p>
<h2 id="_idParaDest-103"><a id="_idTextAnchor102"/><span class="koboSpan" id="kobo.401.1">How to configure an AWS Provider in your Terraform code</span></h2>
<p><span class="koboSpan" id="kobo.402.1">Configuring an AWS Provider in Terraform is simple and straightforward. </span><span class="koboSpan" id="kobo.402.2">You just need to specify the AWS Provider </span><a id="_idIndexMarker235"/><span class="koboSpan" id="kobo.403.1">and the region you want to work within your Terraform code. </span><span class="koboSpan" id="kobo.403.2">You can also optionally set your AWS access and secret keys as environment variables or use an AWS </span><span class="No-Break"><span class="koboSpan" id="kobo.404.1">credentials file.</span></span></p>
<p><span class="koboSpan" id="kobo.405.1">Here’s an example of how to configure the AWS Provider in your </span><span class="No-Break"><span class="koboSpan" id="kobo.406.1">Terraform code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.407.1">
provider "aws" {
  region = "us-west-2"
}</span></pre> <p><span class="koboSpan" id="kobo.408.1">In this example, we’re using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.409.1">aws</span></strong><span class="koboSpan" id="kobo.410.1"> Provider and setting the region to </span><strong class="source-inline"><span class="koboSpan" id="kobo.411.1">us-west-2</span></strong><span class="koboSpan" id="kobo.412.1">. </span><span class="koboSpan" id="kobo.412.2">This means that any AWS resources we create with Terraform will be created in the US west (</span><span class="No-Break"><span class="koboSpan" id="kobo.413.1">Oregon) region.</span></span></p>
<p><span class="koboSpan" id="kobo.414.1">Once you have configured the AWS Provider in your Terraform code, you can start creating AWS resources </span><span class="No-Break"><span class="koboSpan" id="kobo.415.1">using Terraform.</span></span></p>
<h2 id="_idParaDest-104"><a id="_idTextAnchor103"/><span class="koboSpan" id="kobo.416.1">Understanding the different versions of the AWS Provider and their compatibility with Terraform</span></h2>
<p><span class="koboSpan" id="kobo.417.1">The AWS Provider for Terraform is versioned separately from Terraform itself. </span><span class="koboSpan" id="kobo.417.2">Each release of the AWS Provider includes new features, bug fixes, and compatibility updates for new AWS services </span><a id="_idIndexMarker236"/><span class="koboSpan" id="kobo.418.1">and features. </span><span class="koboSpan" id="kobo.418.2">It’s important to check the compatibility of the AWS Provider with your version of Terraform </span><span class="No-Break"><span class="koboSpan" id="kobo.419.1">before upgrading.</span></span></p>
<p><span class="koboSpan" id="kobo.420.1">When using a version</span><a id="_idIndexMarker237"/><span class="koboSpan" id="kobo.421.1"> of Terraform that is not compatible with the AWS Provider, you may experience issues such as errors when running Terraform commands or unexpected behavior when </span><span class="No-Break"><span class="koboSpan" id="kobo.422.1">deploying resources.</span></span></p>
<p><span class="koboSpan" id="kobo.423.1">To check the compatibility of the AWS Provider with your version of Terraform, you can refer to the AWS Provider release notes or the Terraform documentation. </span><span class="koboSpan" id="kobo.423.2">In general, it’s recommended to always use the latest version of the AWS Provider that is compatible with your version of Terraform to take advantage of the latest features and </span><span class="No-Break"><span class="koboSpan" id="kobo.424.1">bug fixes.</span></span></p>
<h2 id="_idParaDest-105"><a id="_idTextAnchor104"/><span class="koboSpan" id="kobo.425.1">Best practices for working with AWS Providers in Terraform</span></h2>
<p><span class="koboSpan" id="kobo.426.1">Here are some best practices for</span><a id="_idIndexMarker238"/><span class="koboSpan" id="kobo.427.1"> working with AWS Providers </span><span class="No-Break"><span class="koboSpan" id="kobo.428.1">in Terraform:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.429.1">Keep your AWS Provider version up to date to ensure compatibility with the latest features and </span><span class="No-Break"><span class="koboSpan" id="kobo.430.1">bug fixes.</span></span></li>
<li><span class="koboSpan" id="kobo.431.1">Use separate profiles for each Terraform workspace in order to have different AWS credentials for </span><span class="No-Break"><span class="koboSpan" id="kobo.432.1">different environments.</span></span></li>
<li><span class="koboSpan" id="kobo.433.1">Use AWS IAM roles and policies to restrict access to your resources and use the </span><span class="No-Break"><span class="koboSpan" id="kobo.434.1">least-privilege principle.</span></span></li>
<li><span class="koboSpan" id="kobo.435.1">Use Terraform’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.436.1">plan</span></strong><span class="koboSpan" id="kobo.437.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.438.1">apply</span></strong><span class="koboSpan" id="kobo.439.1"> commands to test changes before deploying them </span><span class="No-Break"><span class="koboSpan" id="kobo.440.1">to production.</span></span></li>
<li><span class="koboSpan" id="kobo.441.1">Use modules to encapsulate and reuse Terraform code, including AWS </span><span class="No-Break"><span class="koboSpan" id="kobo.442.1">Provider configurations.</span></span></li>
<li><span class="koboSpan" id="kobo.443.1">Follow the principle of least configuration, and avoid configuring unnecessary settings in your AWS </span><span class="No-Break"><span class="koboSpan" id="kobo.444.1">Provider block.</span></span></li>
<li><span class="koboSpan" id="kobo.445.1">Use Terraform Cloud or Terraform Enterprise to securely store and manage your AWS credentials, as well as to collaborate with your team on </span><span class="No-Break"><span class="koboSpan" id="kobo.446.1">infrastructure changes.</span></span></li>
</ol>
<h1 id="_idParaDest-106"><a id="_idTextAnchor105"/><span class="koboSpan" id="kobo.447.1">Understanding Terraform modules</span></h1>
<p><span class="koboSpan" id="kobo.448.1">Terraform modules are reusable, encapsulated </span><a id="_idIndexMarker239"/><span class="koboSpan" id="kobo.449.1">packages of Terraform code that allow you to efficiently manage and organize your infrastructure. </span><span class="koboSpan" id="kobo.449.2">They help you to abstract common infrastructure patterns, reduce code duplication, and make it easier to maintain, update, and share your infrastructure code. </span><span class="koboSpan" id="kobo.449.3">In this section, we’ll dive into the details of Terraform modules and learn how to use them effectively to manage </span><span class="No-Break"><span class="koboSpan" id="kobo.450.1">your infrastructure.</span></span></p>
<h2 id="_idParaDest-107"><a id="_idTextAnchor106"/><span class="koboSpan" id="kobo.451.1">What is a Terraform module?</span></h2>
<p><span class="koboSpan" id="kobo.452.1">Terraform modules are powerful features that allow you to encapsulate a group of resources dedicated to one task into a </span><a id="_idIndexMarker240"/><span class="koboSpan" id="kobo.453.1">collection of standard configuration files within a dedicated directory. </span><span class="koboSpan" id="kobo.453.2">This reduces the amount of code needed for similar infrastructure components and makes it easier to manage and reuse configuration code. </span><span class="koboSpan" id="kobo.453.3">When you run Terraform commands from a module directory, it is considered the root module. </span><span class="koboSpan" id="kobo.453.4">In fact, every Terraform configuration is part of a module. </span><span class="koboSpan" id="kobo.453.5">The following is an example of a simple set of Terraform </span><span class="No-Break"><span class="koboSpan" id="kobo.454.1">configuration files:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer028">
<span class="koboSpan" id="kobo.455.1"><img alt="Figure 5.4 – Terraform configuration files" src="image/B18198_05_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.456.1">Figure 5.4 – Terraform configuration files</span></p>
<p><span class="koboSpan" id="kobo.457.1">If you are running Terraform commands from within the </span><strong class="source-inline"><span class="koboSpan" id="kobo.458.1">minimal-module</span></strong><span class="koboSpan" id="kobo.459.1"> directory, the contents of that directory are considered the root module. </span><span class="koboSpan" id="kobo.459.2">This means that the files in this directory define a single module, which could contain one or </span><span class="No-Break"><span class="koboSpan" id="kobo.460.1">more resources.</span></span></p>
<h2 id="_idParaDest-108"><a id="_idTextAnchor107"/><span class="koboSpan" id="kobo.461.1">Using modules</span></h2>
<p><span class="koboSpan" id="kobo.462.1">When working with Terraform, it’s</span><a id="_idIndexMarker241"/><span class="koboSpan" id="kobo.463.1"> important to understand how to organize your code to manage complexity and reuse code across different projects. </span><span class="koboSpan" id="kobo.463.2">One way to achieve this is by using Terraform modules. </span><span class="koboSpan" id="kobo.463.3">A module is essentially a collection of configuration files in a dedicated directory that encapsulates groups of resources dedicated to one task, reducing the amount of code you must develop for similar infrastructure components. </span><span class="koboSpan" id="kobo.463.4">These modules can be called from other directories through module blocks, allowing you to reuse code across different projects. </span><span class="koboSpan" id="kobo.463.5">In this context, a module that is called by another</span><a id="_idIndexMarker242"/><span class="koboSpan" id="kobo.464.1"> configuration is referred to as a </span><span class="No-Break"><span class="koboSpan" id="kobo.465.1">child module.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer029">
<span class="koboSpan" id="kobo.466.1"><img alt="Figure 5.5 –  Child module" src="image/B18198_05_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.467.1">Figure 5.5 –  Child module</span></p>
<h2 id="_idParaDest-109"><a id="_idTextAnchor108"/><span class="koboSpan" id="kobo.468.1">Local and remote modules</span></h2>
<p><span class="koboSpan" id="kobo.469.1">Terraform modules can be loaded from either a local file system or a remote source. </span><span class="koboSpan" id="kobo.469.2">Remote sources supported by</span><a id="_idIndexMarker243"/><span class="koboSpan" id="kobo.470.1"> Terraform include the Terraform Registry, several version control systems, HTTP URLs, and private module registries in Terraform Cloud or </span><span class="No-Break"><span class="koboSpan" id="kobo.471.1">Terraform Enterprise.</span></span></p>
<h2 id="_idParaDest-110"><a id="_idTextAnchor109"/><span class="koboSpan" id="kobo.472.1">Module best practices</span></h2>
<p><span class="koboSpan" id="kobo.473.1">Using Terraform modules is essential for </span><a id="_idIndexMarker244"/><span class="koboSpan" id="kobo.474.1">creating reusable and maintainable infrastructure code. </span><span class="koboSpan" id="kobo.474.2">They provide a way to encapsulate related resources into a single component and can be used to share common patterns and best practices across teams and projects. </span><span class="koboSpan" id="kobo.474.3">To get the most out of modules, it is recommended to follow these </span><span class="No-Break"><span class="koboSpan" id="kobo.475.1">best practices:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.476.1">It is important to follow a naming convention while naming your Terraform Provider </span><strong class="source-inline"><span class="koboSpan" id="kobo.477.1">terraform-&lt;PROVIDER&gt;-&lt;NAME&gt;</span></strong><span class="koboSpan" id="kobo.478.1">. </span><span class="koboSpan" id="kobo.478.2">This convention must be followed if you plan to publish your Provider to the Terraform Cloud or Terraform Enterprise </span><span class="No-Break"><span class="koboSpan" id="kobo.479.1">module registries.</span></span></li>
<li><span class="koboSpan" id="kobo.480.1">Consider using modules when designing and writing your Terraform configuration, even for smaller projects. </span><span class="koboSpan" id="kobo.480.2">Even if you are the only person working on the configuration, the benefits of using modules can save time and effort in the </span><span class="No-Break"><span class="koboSpan" id="kobo.481.1">long run.</span></span></li>
<li><span class="koboSpan" id="kobo.482.1">To organize your code and reduce the burden of maintaining and updating your configuration as your infrastructure grows in complexity, it is recommended to use local modules. </span><span class="koboSpan" id="kobo.482.2">This is beneficial even if you are not using or publishing remote modules. </span><span class="koboSpan" id="kobo.482.3">Therefore, it is best to organize your configuration with modules from </span><span class="No-Break"><span class="koboSpan" id="kobo.483.1">the beginning.</span></span></li>
<li><span class="koboSpan" id="kobo.484.1">Leverage the public Terraform Registry to discover useful modules. </span><span class="koboSpan" id="kobo.484.2">This will help you implement your configuration more efficiently and confidently, as you can rely on the pre-built </span><a id="_idIndexMarker245"/><span class="koboSpan" id="kobo.485.1">modules to implement common infrastructure scenarios instead of building everything </span><span class="No-Break"><span class="koboSpan" id="kobo.486.1">from scratch.</span></span></li>
<li><span class="koboSpan" id="kobo.487.1">Collaboration is a key aspect of infrastructure management, and modules enable teams to work together effectively to create and maintain infrastructure. </span><span class="koboSpan" id="kobo.487.2">To enhance collaboration, you can publish and share modules with your team. </span><span class="koboSpan" id="kobo.487.3">You can publish modules publicly on the Terraform Registry or privately through Terraform Cloud or Terraform Enterprise. </span><span class="koboSpan" id="kobo.487.4">Module users can then reference the published child modules in their root module or deploy no-code ready modules through the Terraform </span><span class="No-Break"><span class="koboSpan" id="kobo.488.1">Cloud UI.</span></span></li>
</ol>
<h2 id="_idParaDest-111"><a id="_idTextAnchor110"/><span class="koboSpan" id="kobo.489.1">What problems do Terraform modules solve?</span></h2>
<p><span class="koboSpan" id="kobo.490.1">When working with Terraform, managing large and complex infrastructure can be a daunting task. </span><span class="koboSpan" id="kobo.490.2">Terraform modules provide a solution to this problem by encapsulating groups of resources and configurations into reusable and shareable components. </span><span class="koboSpan" id="kobo.490.3">In this section, we’ll explore the various problems that Terraform modules solve and how they can benefit your infrastructure </span><a id="_idIndexMarker246"/><span class="No-Break"><span class="koboSpan" id="kobo.491.1">management workflow:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.492.1">Code repetition</span></strong><span class="koboSpan" id="kobo.493.1">: As your Terraform infrastructure grows larger, copying and pasting code becomes inefficient and time-consuming. </span><span class="koboSpan" id="kobo.493.2">When you need to create multiple instances of the same resource, repeating the code is not scalable. </span><span class="koboSpan" id="kobo.493.3">It leads to code repetition, which is not only time-consuming but also increases the chances of human error. </span><span class="koboSpan" id="kobo.493.4">Terraform modules solve this problem by encapsulating groups of resources dedicated to one task and reducing the amount of repetitive code you need </span><span class="No-Break"><span class="koboSpan" id="kobo.494.1">to write.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.495.1">Lack of code clarity</span></strong><span class="koboSpan" id="kobo.496.1">: Copying and pasting code is not only inefficient; it also makes the code base difficult to maintain and understand. </span><span class="koboSpan" id="kobo.496.2">When working with large-scale infrastructure in Terraform, a modular approach can help address this issue. </span><span class="koboSpan" id="kobo.496.3">Using modules dedicated to specific tasks allows for a more organized and readable code base that is easier to maintain </span><span class="No-Break"><span class="koboSpan" id="kobo.497.1">and understand.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.498.1">Lack of compliance</span></strong><span class="koboSpan" id="kobo.499.1">: Creating</span><a id="_idIndexMarker247"/><span class="koboSpan" id="kobo.500.1"> a Terraform module in accordance with best practices ensures that the same pattern is followed whenever it is reused. </span><span class="koboSpan" id="kobo.500.2">Whether it’s for encryption, redundancy, or lifecycle policies, practices configured inside the module will be enforced, eliminating the need to repeat the </span><span class="No-Break"><span class="koboSpan" id="kobo.501.1">process manually.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.502.1">Human error</span></strong><span class="koboSpan" id="kobo.503.1">: Creating a group of resources from scratch or copy-pasting them can lead to errors such as renaming or overwriting something. </span><span class="koboSpan" id="kobo.503.2">Terraform modules provide a solution to this problem by allowing you to create a single module, test it, and reuse it in multiple places. </span><span class="koboSpan" id="kobo.503.3">This approach ensures that all elements are correct and consistent throughout your infrastructure. </span><span class="koboSpan" id="kobo.503.4">By using a single block, it becomes easier to check and test your code. </span><span class="koboSpan" id="kobo.503.5">Terraform modules also provide other benefits, but it’s important not to overuse them. </span><span class="koboSpan" id="kobo.503.6">It’s essential to find the right balance and </span><span class="No-Break"><span class="koboSpan" id="kobo.504.1">maintain it.</span></span></li>
</ul>
<h1 id="_idParaDest-112"><a id="_idTextAnchor111"/><span class="koboSpan" id="kobo.505.1">How to implement best practices with Terraform AWS modules</span></h1>
<p><span class="koboSpan" id="kobo.506.1">When working with AWS infrastructure, it’s</span><a id="_idIndexMarker248"/><span class="koboSpan" id="kobo.507.1"> important to follow best practices to ensure a reliable, scalable, and secure environment. </span><span class="koboSpan" id="kobo.507.2">Terraform AWS modules provide a way to implement these best practices efficiently </span><a id="_idIndexMarker249"/><span class="koboSpan" id="kobo.508.1">and consistently across different environments. </span><span class="koboSpan" id="kobo.508.2">In this section, we will explore some of the best practices for using Terraform AWS modules and how to implement them in your infrastructure. </span><span class="koboSpan" id="kobo.508.3">We’ll cover topics such as module organization, naming conventions, versioning, </span><span class="No-Break"><span class="koboSpan" id="kobo.509.1">and more.</span></span></p>
<h2 id="_idParaDest-113"><a id="_idTextAnchor112"/><span class="koboSpan" id="kobo.510.1">Terraform configurations file separation</span></h2>
<p><span class="koboSpan" id="kobo.511.1">Storing all Terraform code</span><a id="_idIndexMarker250"/><span class="koboSpan" id="kobo.512.1"> in a single file such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.513.1">main.tf</span></strong><span class="koboSpan" id="kobo.514.1"> can make it challenging to read and maintain the code. </span><span class="koboSpan" id="kobo.514.2">A better approach is to split the code across multiple files, each dedicated to a specific purpose or resource. </span><span class="koboSpan" id="kobo.514.3">This</span><a id="_idIndexMarker251"/><span class="koboSpan" id="kobo.515.1"> not only makes the code more organized but also easier to troubleshoot and update in </span><span class="No-Break"><span class="koboSpan" id="kobo.516.1">the future:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.517.1">main.tf</span></strong><span class="koboSpan" id="kobo.518.1">: This file calls modules, locals, and data sources to create all the </span><span class="No-Break"><span class="koboSpan" id="kobo.519.1">necessary resources</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.520.1">variables.tf</span></strong><span class="koboSpan" id="kobo.521.1">: Declarations of variables used in </span><strong class="source-inline"><span class="koboSpan" id="kobo.522.1">main.tf</span></strong><span class="koboSpan" id="kobo.523.1"> are included in </span><span class="No-Break"><span class="koboSpan" id="kobo.524.1">this file</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.525.1">outputs.tf</span></strong><span class="koboSpan" id="kobo.526.1">: This file contains outputs from the resources created </span><span class="No-Break"><span class="koboSpan" id="kobo.527.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.528.1">main.tf</span></strong></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.529.1">versions.tf</span></strong><span class="koboSpan" id="kobo.530.1">: This file specifies version requirements for Terraform </span><span class="No-Break"><span class="koboSpan" id="kobo.531.1">and providers</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.532.1">terraform.tfvars</span></strong><span class="koboSpan" id="kobo.533.1">: This file contains variable values and should not be used </span><span class="No-Break"><span class="koboSpan" id="kobo.534.1">anywhere else</span></span></li>
</ul>
<h2 id="_idParaDest-114"><a id="_idTextAnchor113"/><span class="koboSpan" id="kobo.535.1">Follow a standard module structure</span></h2>
<p><span class="koboSpan" id="kobo.536.1">The standard module structure must be followed for </span><span class="No-Break"><span class="koboSpan" id="kobo.537.1">Terraform modules:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.538.1">It is recommended to group resources based on their shared purpose in separate files such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.539.1">vpc.tf</span></strong><span class="koboSpan" id="kobo.540.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.541.1">instances.tf</span></strong><span class="koboSpan" id="kobo.542.1">, or </span><strong class="source-inline"><span class="koboSpan" id="kobo.543.1">s3.tf</span></strong><span class="koboSpan" id="kobo.544.1"> rather than creating individual files for </span><span class="No-Break"><span class="koboSpan" id="kobo.545.1">each resource</span></span></li>
<li><span class="koboSpan" id="kobo.546.1">Ensure that every module includes a Markdown-formatted </span><strong class="source-inline"><span class="koboSpan" id="kobo.547.1">README.md</span></strong><span class="koboSpan" id="kobo.548.1"> file containing essential documentation about </span><span class="No-Break"><span class="koboSpan" id="kobo.549.1">the module</span></span></li>
</ul>
<h2 id="_idParaDest-115"><a id="_idTextAnchor114"/><span class="koboSpan" id="kobo.550.1">Use opinionated modules to do exactly what you need</span></h2>
<p><span class="koboSpan" id="kobo.551.1">When creating Terraform modules, it’s recommended to make them opinionated for your specific use case, unless </span><a id="_idIndexMarker252"/><span class="koboSpan" id="kobo.552.1">you intend to publish them as open source or for general-purpose use. </span><span class="koboSpan" id="kobo.552.2">You can </span><a id="_idIndexMarker253"/><span class="koboSpan" id="kobo.553.1">make use of existing resources, open source modules, or even create your own. </span><span class="koboSpan" id="kobo.553.2">However, be cautious about creating too many module dependencies, as it can become difficult to maintain and update </span><span class="No-Break"><span class="koboSpan" id="kobo.554.1">your code.</span></span></p>
<h2 id="_idParaDest-116"><a id="_idTextAnchor115"/><span class="koboSpan" id="kobo.555.1">Leverage official open source modules</span></h2>
<p><span class="koboSpan" id="kobo.556.1">Consider using open source modules provided freely by HashiCorp and the platform you are using. </span><span class="koboSpan" id="kobo.556.2">These modules can be used as primitives by modules you create, or they can be used in your deployments as they come if they achieve everything you need. </span><span class="koboSpan" id="kobo.556.3">You just need to ensure you call specific versions of them so your deployments </span><span class="No-Break"><span class="koboSpan" id="kobo.557.1">are consistent.</span></span></p>
<p><span class="koboSpan" id="kobo.558.1">I’ve seen many people who advocate forking open source modules and tweaking them. </span><span class="koboSpan" id="kobo.558.2">I’d be cautious when following that approach for </span><span class="No-Break"><span class="koboSpan" id="kobo.559.1">three reasons:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.560.1">Forking an open source repository and changing it means you are now the maintainer of that module, giving yourself and other members of your team a </span><span class="No-Break"><span class="koboSpan" id="kobo.561.1">higher workload</span></span></li>
<li><span class="koboSpan" id="kobo.562.1">Engineers are likely to be familiar with an open source module, but not your bespoke version of it, hence new staff enrolment would be quicker if you are using </span><span class="No-Break"><span class="koboSpan" id="kobo.563.1">standard modules</span></span></li>
<li><span class="koboSpan" id="kobo.564.1">Open source modules are generally too broad; your in-house modules should be opinionated for your use case to make them simpler to use </span><span class="No-Break"><span class="koboSpan" id="kobo.565.1">and maintain</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.566.1">Forking is sometimes mandatory; some companies such as banks require you to fork modules and keep them in-house, but if you do that, you should consider not changing them at all and just tracking the official version and updating </span><span class="No-Break"><span class="koboSpan" id="kobo.567.1">where possible.</span></span></p>
<p><span class="koboSpan" id="kobo.568.1">That all being said, there may be situations when importing an official module and changing it may suit your needs. </span><span class="koboSpan" id="kobo.568.2">In that case, I recommend you strip it bare of all the features you don’t need and simplify it as much </span><span class="No-Break"><span class="koboSpan" id="kobo.569.1">as possible.</span></span></p>
<p><span class="koboSpan" id="kobo.570.1">Also, in that case, consider using open source modules that are designed to be forked if you can find them. For example, Google Cloud has the cloud foundation fabric modules that are designed just for </span><span class="No-Break"><span class="koboSpan" id="kobo.571.1">this purpose.</span></span></p>
<h2 id="_idParaDest-117"><a id="_idTextAnchor116"/><span class="koboSpan" id="kobo.572.1">Make extensive use of convention over configuration</span></h2>
<p><span class="koboSpan" id="kobo.573.1">Your modules will be</span><a id="_idIndexMarker254"/><span class="koboSpan" id="kobo.574.1"> opinionated to do what you need to</span><a id="_idIndexMarker255"/><span class="koboSpan" id="kobo.575.1"> do; hence you should default as many variables as possible and only require the bare minimum for setup. </span><span class="koboSpan" id="kobo.575.2">This will help keep your deployment code clean and easy to understand and change. </span><span class="koboSpan" id="kobo.575.3">Ideally, you should only need five or six variables at most. </span><span class="koboSpan" id="kobo.575.4">Default everything else if </span><span class="No-Break"><span class="koboSpan" id="kobo.576.1">you can.</span></span></p>
<h2 id="_idParaDest-118"><a id="_idTextAnchor117"/><span class="koboSpan" id="kobo.577.1">Make modules flexible with multiple optional inputs</span></h2>
<p><span class="koboSpan" id="kobo.578.1">You should be able to use your modules with minimal inputs, but that doesn’t mean that they shouldn’t be flexible for changes. </span><span class="koboSpan" id="kobo.578.2">This minimizes the need to have to change code, and it gives you options based on different situations. </span><span class="koboSpan" id="kobo.578.3">That being said, don’t get too bogged down trying to predict every scenario under the sun; start by making things as simple as possible based on your </span><span class="No-Break"><span class="koboSpan" id="kobo.579.1">use case.</span></span></p>
<h2 id="_idParaDest-119"><a id="_idTextAnchor118"/><span class="koboSpan" id="kobo.580.1">Refer to modules by version</span></h2>
<p><span class="koboSpan" id="kobo.581.1">Don’t avoid specifying the version of your modules, as that could break your deployments whenever you make changes to them. </span><span class="koboSpan" id="kobo.581.2">Consider using semantic versioning to update </span><span class="No-Break"><span class="koboSpan" id="kobo.582.1">your modules.</span></span></p>
<h2 id="_idParaDest-120"><a id="_idTextAnchor119"/><span class="koboSpan" id="kobo.583.1">Consider bundling modules together if they serve a common purpose</span></h2>
<p><span class="koboSpan" id="kobo.584.1">At the start of a project, you may consider keeping your modules and deployments in the same repository and refer to them by path. </span><span class="koboSpan" id="kobo.584.2">As your product matures, you may want to move these modules to a separate repository to be able to refer to them by version and maintain </span><span class="No-Break"><span class="koboSpan" id="kobo.585.1">them separately.</span></span></p>
<p><span class="koboSpan" id="kobo.586.1">Having one repository per module is useful if your modules need to be maintained by different teams or if they are common modules used by multiple projects. </span><span class="koboSpan" id="kobo.586.2">However, if you have a set of closely related modules, consider keeping them all in one repository and using them </span><span class="No-Break"><span class="koboSpan" id="kobo.587.1">as submodules.</span></span></p>
<p><span class="koboSpan" id="kobo.588.1">You can still version them in this way and it is much easier to manage them. </span><span class="koboSpan" id="kobo.588.2">Remember that you can always separate the modules later in their own repositories, but always start with the simplest </span><a id="_idIndexMarker256"/><span class="No-Break"><span class="koboSpan" id="kobo.589.1">setup possible.</span></span></p>
<h2 id="_idParaDest-121"><a id="_idTextAnchor120"/><span class="koboSpan" id="kobo.590.1">Consider using variable and naming validation</span></h2>
<p><span class="koboSpan" id="kobo.591.1">Terraform has a relatively new feature where you can validate names with </span><strong class="bold"><span class="koboSpan" id="kobo.592.1">Regular Expressions</span></strong><span class="koboSpan" id="kobo.593.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.594.1">regex</span></strong><span class="koboSpan" id="kobo.595.1">). </span><span class="koboSpan" id="kobo.595.2">This is very useful to avoid naming errors with your platform before you hit </span><strong class="bold"><span class="koboSpan" id="kobo.596.1">Apply</span></strong><span class="koboSpan" id="kobo.597.1">. </span><span class="koboSpan" id="kobo.597.2">You could also enforce the way </span><a id="_idIndexMarker257"/><span class="koboSpan" id="kobo.598.1">your resources are named by concatenating inputs such as labels and prefixes while validating each of them, keeping your platform </span><span class="No-Break"><span class="koboSpan" id="kobo.599.1">naming consistent.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer030">
<span class="koboSpan" id="kobo.600.1"><img alt="Figure 5.6 –  Naming validation" src="image/B18198_05_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.601.1">Figure 5.6 –  Naming validation</span></p>
<h2 id="_idParaDest-122"><a id="_idTextAnchor121"/><span class="koboSpan" id="kobo.602.1">Use locals correctly</span></h2>
<p><span class="koboSpan" id="kobo.603.1">I’ve seen locals in situations where variables would be better suited. </span><span class="koboSpan" id="kobo.603.2">I find locals to be very useful, especially in the </span><span class="No-Break"><span class="koboSpan" id="kobo.604.1">following situations:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.605.1">Using functions on your outputs </span><span class="No-Break"><span class="koboSpan" id="kobo.606.1">and/or inputs</span></span></li>
<li><span class="koboSpan" id="kobo.607.1">Concatenating variables to form names </span><span class="No-Break"><span class="koboSpan" id="kobo.608.1">of resources</span></span></li>
<li><span class="koboSpan" id="kobo.609.1">Using </span><span class="No-Break"><span class="koboSpan" id="kobo.610.1">conditional expressions</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.611.1">You can keep locals in their own file, but I generally recommend keeping them in the same file, close to the code they are </span><span class="No-Break"><span class="koboSpan" id="kobo.612.1">used for.</span></span></p>
<h2 id="_idParaDest-123"><a id="_idTextAnchor122"/><span class="koboSpan" id="kobo.613.1">Keep the code in your module logically separated</span></h2>
<p><span class="koboSpan" id="kobo.614.1">I generally advocate keeping the structure of the files standard to avoid confusion. However, if your module requires over 200 lines of code, not including variables, you should consider </span><a id="_idIndexMarker258"/><span class="koboSpan" id="kobo.615.1">splitting the </span><strong class="source-inline"><span class="koboSpan" id="kobo.616.1">main.tf</span></strong><span class="koboSpan" id="kobo.617.1"> into multiple files according to what they do and keep all related resources and locals within that file. </span><span class="koboSpan" id="kobo.617.2">This makes it easier to modify and read than having </span><a id="_idIndexMarker259"/><span class="koboSpan" id="kobo.618.1">to search through a long </span><strong class="source-inline"><span class="koboSpan" id="kobo.619.1">main.tf</span></strong><span class="koboSpan" id="kobo.620.1"> file—even if that file is separated with </span><span class="No-Break"><span class="koboSpan" id="kobo.621.1">comment lines.</span></span></p>
<h2 id="_idParaDest-124"><a id="_idTextAnchor123"/><span class="koboSpan" id="kobo.622.1">Separate required and optional variables</span></h2>
<p><span class="koboSpan" id="kobo.623.1">To improve the readability of your code, keep required variables at the top and optional variables at the bottom. </span><span class="koboSpan" id="kobo.623.2">Separate them with a comment line in your </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.624.1">variables.tf</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.625.1"> file.</span></span></p>
<h2 id="_idParaDest-125"><a id="_idTextAnchor124"/><span class="koboSpan" id="kobo.626.1">Always have an example folder within your module folder</span></h2>
<p><span class="koboSpan" id="kobo.627.1">An example folder has </span><span class="No-Break"><span class="koboSpan" id="kobo.628.1">two advantages:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.629.1">It gives users an idea of how to use your module in </span><span class="No-Break"><span class="koboSpan" id="kobo.630.1">a deployment</span></span></li>
<li><span class="koboSpan" id="kobo.631.1">You can use it to test your module code before creating a new version </span><span class="No-Break"><span class="koboSpan" id="kobo.632.1">for it</span></span></li>
</ul>
<h1 id="_idParaDest-126"><a id="_idTextAnchor125"/><span class="koboSpan" id="kobo.633.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.634.1">You have successfully learned about Terraform modules and AWS Providers. </span><span class="koboSpan" id="kobo.634.2">These are essential tools that will help you manage and deploy your infrastructure in AWS using Terraform. </span><span class="koboSpan" id="kobo.634.3">Now that you understand how to use modules and providers, the next step is to make decisions for your projects in </span><span class="No-Break"><span class="koboSpan" id="kobo.635.1">AWS Terraform.</span></span></p>
<p><span class="koboSpan" id="kobo.636.1">In the next chapter, you will learn how to make decisions about the architecture, security, and scalability of your projects. </span><span class="koboSpan" id="kobo.636.2">You’ll also explore how to use best practices for cost optimization and how to manage your infrastructure as code. </span><span class="koboSpan" id="kobo.636.3">With these skills, you’ll be able to design and implement robust, efficient, and cost-effective infrastructure for your projects in AWS using Terraform. </span><span class="koboSpan" id="kobo.636.4">So, get ready to take your Terraform skills to the next level and create the best infrastructure for your projects </span><span class="No-Break"><span class="koboSpan" id="kobo.637.1">in AWS.</span></span></p>
</div>
</body></html>