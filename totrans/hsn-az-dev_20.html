<html><head></head><body><div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Distributing Load with Azure Traffic Manager</h1>
                </header>
            
            <article>
                
<p>Sometimes we want to distribute our load depending on the performance of our backends, or maybe route users to different servers while some are under maintenance. This is not an easy task if we don't have a service that will do this seamlessly and quickly. Thanks to <strong>Azure Traffic Manager</strong> we are able to improve the availability of our critical applications, distribute traffic when performing large, complex deployments, or perform maintenance without downtime.</p>
<p>The following topics will be covered in this chapter:</p>
<ul>
<li>Using Azure Traffic Manager</li>
<li>Different routing methods</li>
<li>Endpoint monitoring</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Technical requirements</h1>
                </header>
            
            <article>
                
<p>To perform exercises from this chapter, you will need the following:</p>
<ul>
<li>Access to an Azure subscription</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Azure Traffic Manager fundamentals</h1>
                </header>
            
            <article>
                
<p>Imagine the following situation—you have an application that has to be served globally. To guarantee the best performance for all your customers worldwide, you provision different instances of your service in different regions (one for North America, one for Europe, and one for Africa). There is one problem, however. You have to explicitly tell your customer to access a specific instance of the application—the one that is closest to its location.</p>
<p>While this is, of course, possible (just give it the right URL), the solution is not ideal. For example, what if your client goes for a holiday and spends the following two weeks in Europe instead of in Africa? To overcome such problems, in Azure you can leverage a service named <strong>Azure Traffic Manager</strong>, which takes care of the proper routing of incoming requests and allows you to implement high availability in your application.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Functions of Azure Traffic Manager</h1>
                </header>
            
            <article>
                
<p>You can think of Azure Traffic Manager<em> </em>as a load balancer that works on the DNS level. To understand the concept, please take a look at the following example. By default, if there is no service such as Azure Traffic Manager, your <strong>customer</strong> uses an endpoint URL to send requests from a <strong>client application</strong> to a <strong>server application</strong>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/610c5da1-765c-4941-b370-b65410feaea6.png" style="width:25.83em;height:7.75em;" width="343" height="103"/></p>
<p>If you want to load-balance incoming requests, you have to introduce another element of an architecture that will take care of routing them to the proper backend (and possibly ensure that they are healthy):</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/2203b07b-6c8d-47ed-ba14-079f22c3658c.png" style="width:30.17em;height:21.58em;" width="479" height="343"/></p>
<p>The downside of such a setup is that latency can be introduced. What is more, in that scenario your client connects via a <strong>load balancer</strong> directly, which does not resolve the problem of globally distributing the entry point.</p>
<div class="packt_infobox">The preceding example is a common solution when using a reverse proxy, which acts as a gateway to your system. </div>
<p>The described scenario defines a solution, where load balancing is based on distributing traffic based on TCP/UDP, so it is a significantly lower level than DNS. When using Azure Traffic Manager<em>, </em>the flow of a request is completely different:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/e04cc3dc-d471-42f2-aa52-f5a3bf9b993b.png" style="width:40.17em;height:22.17em;" width="589" height="325"/></p>
<p>The flow can be described as follows:</p>
<ol start="1">
<li>Send a <strong>DNS query</strong> to a <strong>DNS service</strong> to obtain the address of a server</li>
<li>The <strong>DNS service</strong> is configured in such a way that it points to <strong>Azure Traffic Manager</strong><em><em>,</em> </em>instead of pointing to a service directly</li>
<li><strong>Azure Traffic Manager</strong><em> </em>chooses the right endpoint based on the query characteristics and returns a <strong>DNS response</strong> containing the address of the proper server</li>
<li>A client receives a <strong>DNS response</strong> and uses it to connect to the right server</li>
</ol>
<p>In fact, a client has to perform two requests:</p>
<ul>
<li>Obtain the URL of a server</li>
<li>Send the actual request</li>
</ul>
<p>While it may seem like a bit of an overhead, in reality, the impact is imperceptible.</p>
<div class="packt_infobox">Note that the advantage of such a solution is the ability to send requests directly to a server. There is no intermediary service that participates in the communication. </div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Creating Azure Traffic Manager in the Azure portal</h1>
                </header>
            
            <article>
                
<p>To get started with Azure Traffic Manager<em> </em>in the portal, you have to click on the <span class="packt_screen">+ Create a resource</span><strong> </strong>button and search for <kbd>traffic manager</kbd><em>.</em> Then from the search results, select <span class="packt_screen">Traffic Manager profile</span>. You will see a form, where you have to enter all required fields to be able to create a service:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/6d374818-feb0-400e-97d6-170c441b7359.png" style="width:26.33em;height:28.08em;" width="482" height="512"/></p>
<p>While most of them should be self-explanatory, there is one drop-down that will require our focus, <span class="packt_screen">Routing method</span>. Here you have six different methods <span>available</span><span>:</span></p>
<ul>
<li><span class="packt_screen">Performance</span></li>
<li><span class="packt_screen">Weighted</span></li>
<li><span class="packt_screen">Priority</span></li>
<li><span class="packt_screen">Geographic</span></li>
<li><span class="packt_screen">MultiValue</span></li>
<li><span class="packt_screen">Subnet</span></li>
</ul>
<p>Before we describe each and every one, you have to understand what <strong><span class="packt_screen">Routing method</span> </strong>is exactly. Previously I mentioned that Azure Traffic Manager<em> </em>decides to which endpoint a user should be routed. This routing operation may give a different result depending on the selected method. Let's consider the following scenarios:</p>
<ul>
<li>Instances of your application are distributed globally, and you want to route a user to the closest one</li>
<li>Instances of your application offer different performances, and you want to route a user to the one that offers the best user experience</li>
<li>You have a primary region that handles all the traffic, and you want to route a user to secondary ones in case of an outage or temporary issues</li>
<li>You want to distribute traffic evenly, or according to set weights</li>
<li>You want to map user IP addresses to a specific instance</li>
</ul>
<p>Depending on the chosen scenario, a different <strong><span class="packt_screen">Routing method </span></strong>should be chosen. Now I will describe them in detail.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Routing method – performance</h1>
                </header>
            
            <article>
                
<p>When using the performance routing method, a user will be routed to the endpoint that is the "closest" one. It is important to remember here, that the "closest" endpoint may not be the one that is the closest geographically, as this method takes into consideration performance, not distance. Let's assume that internally Azure Traffic Manager<em> </em>stores the following information regarding configured endpoints:</p>
<table style="border-collapse: collapse; width: 100%;" border="1">
<tbody>
<tr>
<td class="CDPAlignCenter CDPAlign"><strong>Endpoint</strong></td>
<td class="CDPAlignCenter CDPAlign"><strong>Region</strong></td>
<td class="CDPAlignCenter CDPAlign"><strong>Latency</strong></td>
</tr>
<tr>
<td>Server A</td>
<td>West Europe</td>
<td><strong>12 ms</strong></td>
</tr>
<tr>
<td>Server B</td>
<td>East US 2</td>
<td>
<p class="mce-root">67 ms</p>
</td>
</tr>
</tbody>
</table>
<p>In the preceding scenario, the endpoint that performs better is <strong>Server A</strong>. When the performance routing method is selected the user will be routed to that server.</p>
<div class="packt_tip packt_infobox">It is important to remember that with the performance method, Azure Traffic Manager checks the latency of a response, taking into consideration the IP address of the DNS server that sent the request. It is not an IP address of a client.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Routing method – weighted</h1>
                </header>
            
            <article>
                
<p>When you want to distribute traffic evenly or based on predefined weights, the weighted routing method is something you are looking for. Using that method, you define weights, which are then taken into consideration when deciding where a request should be routed. Let's take into consideration the following table:</p>
<table style="border-collapse: collapse; width: 100%;" border="1">
<tbody>
<tr>
<td class="CDPAlignCenter CDPAlign"><strong>Endpoint</strong></td>
<td class="CDPAlignCenter CDPAlign"><strong>Weight</strong></td>
<td class="CDPAlignCenter CDPAlign"><strong>Status</strong></td>
</tr>
<tr>
<td>Server A</td>
<td>100</td>
<td><strong>Online</strong></td>
</tr>
<tr>
<td>Server B</td>
<td>100</td>
<td>Degraded</td>
</tr>
<tr>
<td>Server A - staging</td>
<td>5</td>
<td><strong>Online</strong></td>
</tr>
</tbody>
</table>
<p> </p>
<p>In the preceding example, we have three endpoints, one of which is reporting issues. Although both <strong>Server A</strong> and <strong>Server B</strong> have the same weights, as Server B's status is reported as degraded, it will not be considered as a healthy endpoint, and as a result, a user will not be routed to it. There are two servers left that have different weights. In that situation, Azure Traffic Manager<em> </em>will randomly assign a user to an endpoint with the probability determined by the endpoint's weight. If we imagine that there are 105 requests, 100 of them will be routed to <strong>Server A</strong>, and the rest to the <strong>Server A – staging</strong>.</p>
<div class="packt_tip"><span>A </span>Weighted routing method is a great option for A/B testing, where you randomly route users to the new instance of your application containing new features. If they like them, you can change the weight and route the rest of the traffic to that instance.</div>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Routing method – priority</h1>
                </header>
            
            <article>
                
<p>The priority routing method is the most straightforward as it covers a simple scenario where you have a primary region that hosts your application, and you want to ensure that you can easily fail over to the secondary ones in case something is wrong. Let's consider the following scenario:</p>
<table style="border-collapse: collapse; width: 100%;" border="1">
<tbody>
<tr>
<td class="CDPAlignCenter CDPAlign"><strong>Server</strong></td>
<td class="CDPAlignCenter CDPAlign"><strong>Priority</strong></td>
<td class="CDPAlignCenter CDPAlign"><strong>Status</strong></td>
</tr>
<tr>
<td>Server A</td>
<td>1</td>
<td><strong>Online</strong></td>
</tr>
<tr>
<td>Server A - secondary</td>
<td>2</td>
<td>Online</td>
</tr>
</tbody>
</table>
<p> </p>
<p>In the preceding example, all traffic will be routed to Server A for the following reasons:</p>
<ul>
<li>Its priority is set to <kbd>1</kbd></li>
<li>Its status is considered online</li>
</ul>
<p>Now something has happened and the primary replica went down:</p>
<table style="border-collapse: collapse; width: 100%;" border="1">
<tbody>
<tr>
<td class="CDPAlignCenter CDPAlign"><strong>Server</strong></td>
<td class="CDPAlignCenter CDPAlign"><strong>Priority</strong></td>
<td class="CDPAlignCenter CDPAlign"><strong>Status</strong></td>
</tr>
<tr>
<td>Server A</td>
<td>1</td>
<td>Degraded</td>
</tr>
<tr>
<td>Server A - Secondary</td>
<td>2</td>
<td><strong>Online</strong></td>
</tr>
</tbody>
</table>
<p> </p>
<p>Because Server A is considered unhealthy, all traffic will be routed to the secondary instance until the primary one works again.</p>
<div class="packt_infobox">Remember that clients may cache DNS responses, which will extend the period that your endpoint appears unavailable to them.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Routing method – geographic</h1>
                </header>
            
            <article>
                
<p>Sometimes you need to route a user to a specific region, taking into consideration its location. There are multiple reasons to do so, for example:</p>
<ul>
<li>Legal requirements</li>
<li>Content localization</li>
<li>Serving an application from a server that is the closest one taking distance into consideration</li>
</ul>
<div class="packt_tip">Do remember that a region that is closest to a user may not be the best one regarding network latency. Do not overuse this routing method to achieve the best user experience.</div>
<p>When using the <span class="packt_screen">Geographic </span>routing method, you assign regions to configured endpoints:</p>
<div>
<table style="border-collapse: collapse; width: 100%;" border="1">
<tbody>
<tr>
<td class="CDPAlignCenter CDPAlign"><strong>Server</strong></td>
<td class="CDPAlignCenter CDPAlign"><strong>Regions</strong></td>
</tr>
<tr>
<td>Server A</td>
<td>France</td>
</tr>
<tr>
<td>Server B</td>
<td>Asia</td>
</tr>
<tr>
<td>Server C</td>
<td>World</td>
</tr>
</tbody>
</table>
</div>
<p> </p>
<p>Now to route a user to the proper server, Azure Traffic Manager<em> </em>tries to determine its location by reading the IP address of the source DNS server. It starts from state/province (or country/region if the former is not supported), and ends on the World value.</p>
<div class="packt_infobox">When using the <span class="packt_screen">Geographic </span>routing method, Azure Traffic Manager<em> </em>will return an endpoint whether it is healthy or not. It is important to leverage nested profiles, to extend routing methods further, and achieve high availability.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Routing method – MultiValue</h1>
                </header>
            
            <article>
                
<p>The <span class="packt_screen">MultiValue </span>routing method works a little bit differently from other routing methods, as it allows the return of multiple healthy endpoints, and lets the client choose which one should be used. This scenario covers a situation when on the service side you do not know where to route a user, and simultaneously you want to ensure that a user will be routed to a healthy endpoint.</p>
<div class="packt_infobox">To make sure that an endpoint can be returned to a user for this routing method, it has to be set as <span class="packt_screen">External </span>and has an IPv4 or IPv6 address assigned.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Routing method – subnet</h1>
                </header>
            
            <article>
                
<p>The last routing method is the most sophisticated, as it allows you to map specific IP addresses (or a range of IP addresses) to a specific endpoint.</p>
<p class="mce-root"/>
<p class="mce-root"/>
<p>The use cases for that method may vary if, for example:</p>
<ul>
<li>You want to block users using a specific ISP</li>
<li>You want to route users from a corporate network to an internal instance of an application</li>
<li>You have branded your application and want to route users from different corporate networks to a particular branded instance</li>
</ul>
<div class="packt_infobox">Using the <span class="packt_screen">Subnet </span>routing method, make sure you have covered all possible IP addresses, as failing to do so will result in a <kbd>NODATA</kbd> response being returned, resulting in an error being returned to a client.</div>
<p>Once you are satisfied with your choice of a routing method, you can click on the <span class="packt_screen">Create</span><strong> </strong>button to provision a resource in Azure.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Working with Azure Traffic Manager in the Azure Portal</h1>
                </header>
            
            <article>
                
<p>When you access your instance of Azure Traffic Manager, you will see a default screen containing the overview of the service:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/81f6ce7a-3e42-42b7-a24c-edd3e0bccaf3.png" width="1144" height="482"/></p>
<p>As there is <span>currently</span><span> </span><span>no endpoint attached to this particular profile, the list of endpoints displayed </span><span>is</span><span> </span><span>empty. Before we add a new one, let's focus a little bit on other service features.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Configuration</h1>
                </header>
            
            <article>
                
<p>When you access the <span class="packt_screen">Configuration </span>blade, you will see the full configuration of your instance of Azure Traffic Manager:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/5a7b0768-f8e8-458d-979d-ebcf8c115875.png" style="width:34.00em;height:46.42em;" width="551" height="752"/></p>
<p>It contains things such as the <span class="packt_screen">Routing method</span> (by default it displays the one you chose during service creation), <span class="packt_screen">Endpoint monitoring settings</span>, and <span class="packt_screen">Fast endpoint failover settings</span>. From this screen, you basically control how Azure Traffic Manager<em> </em>will behave. For instance, let's assume that each of your endpoints has a custom <kbd>/status</kbd> endpoint that is designed to work with the service. By default, Azure Traffic Manager checks the default endpoint URL (set here as <kbd>/</kbd>), so you will have to change the Path field as follows:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/fabe7bd3-f056-4388-b3a2-fb8180f5da96.png" width="81" height="56"/></p>
<p>The same goes for expected status codes. If your endpoints can return a range of HTTP status codes, and each of them should be considered as a success, you are able to enter the range in the<span class="packt_screen"> Expected Status Code Ranges</span><strong> </strong>field:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/fc2bcf3f-561c-437a-9550-0e9b3f3d9c47.png" width="265" height="56"/></p>
<p>You can experiment here with different settings, so they reflect the real scenario you have to cover.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Real user measurements</h1>
                </header>
            
            <article>
                
<p>When using the performance routing method, Azure Traffic Manager<em> </em>checks where DNS requests originate from, and translates the result to an internal table that reflects different network latencies for different end user networks. While this option is perfectly fine for most use cases, sometimes you want to be able to tell Azure Traffic Manager<em> </em>about real latency. With <span class="packt_screen">Real user measurements</span><strong> </strong>features, you are able to inject JavaScript code in to your client endpoints, to send delays to your endpoints directly to this Azure service.</p>
<p class="mce-root"/>
<p class="mce-root"/>
<p>To do so, go to the <span class="packt_screen">Real user measurements</span><strong> </strong>blade and click on the <strong><span class="packt_screen">Generate key</span> </strong>button:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/8ca84af0-7331-4ec7-8579-58045b9ee2dd.png" width="847" height="379"/></p>
<p>You will see two fields:</p>
<ul>
<li><span class="packt_screen">Key</span>: Stores the generated key</li>
<li><span class="packt_screen">Measurement JavaScript</span>: Holds the script that should be injected into the client application</li>
</ul>
<p>Once you use the generated script, it will start sending additional information to your instance of Azure Traffic Manager<em> </em>regarding latencies and client network, which will improve the accuracy of decisions made by the service.</p>
<div class="packt_infobox">The accuracy improvement is not instant—Azure Traffic Manager has to gather lots of data from different networks to improve the performance.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Endpoints</h1>
                </header>
            
            <article>
                
<p>The main functionality of Azure Traffic Manager<em> </em>is the ability to configure the endpoints it handles. You can access it through the <span class="packt_screen">Endpoints</span><strong> </strong>blade:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/08f08ff4-18f8-43a8-a54d-83f3a2431732.png" style="width:44.67em;height:36.08em;" width="649" height="524"/></p>
<p>To add an endpoint, you have to enter the following values:</p>
<ul>
<li><strong>Type</strong>: You can choose between an <span class="packt_screen">Azure endpoint</span>, <span class="packt_screen">External endpoint</span>, and <span class="packt_screen">Nested endpoint</span>.<strong> </strong>The difference impacts the whole form—with <span class="packt_screen">Azure endpoint</span><strong> </strong>you can choose an Azure service, <span class="packt_screen">External endpoint</span><strong> </strong>requires providing a fully qualified domain name or IP, and when you select <span class="packt_screen">Nested endpoint </span>you can point to another Traffic Manager profile.</li>
<li><strong>Name</strong>: Unique name of an endpoint.</li>
<li><strong>Target resource type/FQDN or IP/Target resource</strong>: Depending on the <span class="packt_screen">Type</span><strong> </strong>value, you will have to select different values to configure an endpoint.</li>
<li><strong>Priority</strong>: Because my routing method is <span class="packt_screen">Priority</span>, I have to enter the correct value for this particular endpoint. If you select another method, you may find other fields here.</li>
</ul>
<p class="mce-root"/>
<p>In the following example, I selected an <span class="packt_screen">Azure endpoint</span><strong> </strong>and pointed the configuration to one of my Azure App Services. I performed the operation twice and added two different endpoints to two instances of my application:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/49a92369-2a0e-455c-8f44-4da10ce2c901.png" width="926" height="445"/></p>
<div class="packt_infobox">Remember that you cannot add to a single Azure Traffic Manager<em> </em>profile service domains that point to the same region.</div>
<p>As you can see, right after adding endpoints, their status is displayed as <span class="packt_screen">Checking endpoint</span>. This means that Azure Traffic Manager<em> </em>tries to gather information regarding their health. If something is wrong, you will see the <span class="packt_screen">Degraded</span><strong> </strong>status:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/2d2960e1-4659-440c-a44f-a807b3f3d056.png" width="933" height="474"/></p>
<p>In my case, the problem was an invalid configuration as I set the <strong><span class="packt_screen">Path</span> </strong>field in the <span class="packt_screen">Configuration</span><strong> </strong>blade to<kbd>/status</kbd>, which turned out to be an invalid value (in my application, as I implemented that endpoint as<kbd> /api/status</kbd>). After correcting the configuration in the primary service, its status was displayed as <span class="packt_screen">Online</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/49040795-c16e-4bd6-baab-3fea58431d35.png" width="931" height="452"/></p>
<p class="mce-root"/>
<p class="mce-root">The last thing to configure is the DNS record on your DNS server to point to your instance of Azure Traffic Manager (by using DNS name,<strong> </strong>which can be found on the <span class="packt_screen">Overview </span>blade).</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Monitoring</h1>
                </header>
            
            <article>
                
<p>Besides routing traffic to a different endpoint, Azure Traffic Manager<em> </em>offers some additional functionalities when it comes to monitoring. Besides the traditional <span class="packt_screen">Metrics </span>blade, there is an extra feature available called <span class="packt_screen">Traffic view</span>, which enables you to monitor. What is more, you can use many different built-in mechanisms (like <kbd>nslookup</kbd><strong> </strong>in Windows OS), to check the current configuration of the service.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Nslookup</h1>
                </header>
            
            <article>
                
<p>To use <kbd>nslookup</kbd>, you have to run the command line in Windows using your administrator account. Once it is loaded, enter the following command:</p>
<pre><strong>nslookup &lt;Traffic-Manager-DNS-name&gt;</strong></pre>
<p>After a moment, it should return a result <span>showing</span> the command resolution:</p>
<pre><strong>DNS request timed out.</strong><br/><strong>    timeout was 2 seconds.</strong><br/><strong>DNS request timed out.</strong><br/><strong>    timeout was 2 seconds.</strong><br/><strong>Non-authoritative answer:</strong><br/><strong>Name: waws-prod-db3-119.cloudapp.net</strong><br/><strong>Address: 40.85.74.227</strong><br/><strong>Aliases: handsonazure.trafficmanager.net</strong><br/><strong>         handsonazure02-eun-appservice.azurewebsites.net</strong><br/><strong>         waws-prod-db3-119.sip.azurewebsites.windows.net</strong></pre>
<p>As you can see, it points to the second instance of my application (<kbd>handsonazure02</kbd> hosted within the North Europe region). The reason why I got this response is that my primary endpoint was considered to be downgraded. Once it went back online, I ran the command once more and got a quite different response:</p>
<pre><strong>Name: waws-prod-am2-229.cloudapp.net</strong><br/><strong>Address: 104.40.250.100</strong><br/><strong>Aliases: handsonazure.trafficmanager.net</strong><br/><strong>         handsonazure01-euw-appservice.azurewebsites.net</strong><br/><strong>         waws-prod-am2-229.sip.azurewebsites.windows.net</strong></pre>
<p class="mce-root"/>
<p>Now it returned the primary server (as expected, by using the <span class="packt_screen">Priority </span>routing method).</p>
<div class="packt_infobox">Remember that you have to wait a fixed amount time before all DNS changes will be propagated. The value can be configured in the <span class="packt_screen">Configuration</span><strong> </strong>blade by changing the <span class="packt_screen">DNS time to live</span><strong> </strong>field.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Traffic view</h1>
                </header>
            
            <article>
                
<p><span class="packt_screen">Traffic view</span><strong> </strong>is an additional monitoring feature that enables you to check how the selected routing method works exactly at the DNS level. It gives you extra helpful information like:</p>
<ul>
<li>Real latency level</li>
<li>Volume of traffic</li>
<li>Users location</li>
</ul>
<div class="packt_infobox">Remember that this feature takes up to 24 hours to propagate and gather all necessary information.</div>
<p>By default, the screen for this functionality looks such as the following:</p>
<div class="CDPAlignCenter CDPAlign"><img src="Images/6c12c64c-c46b-4905-becc-65c35427179b.png" width="1129" height="413"/></div>
<p>Once the information is gathered, you can leverage a graphical representation of collected data, and better understand the behaviour of the selected routing method (and possibly improve it).</p>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>This was the last chapter in this book and explained the basics of one Azure services, Azure Traffic Manager. You have learned the fundamental concepts of traffic distribution and different routing methods that cover many real use cases, which you may well face in your daily work. Now you should understand how this particular Azure service works and what can be achieved by the proper usage of its features, such as configuration, real user measurements, and monitoring. In the next (and, unfortunately, the last) chapter, I will show you some useful tips and tricks for working with the Azure Portal and different cloud components to improve your skills even further.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Questions</h1>
                </header>
            
            <article>
                
<ol>
<li>What are the supported routing methods in Azure Traffic Manager?</li>
<li>How can you use the <span class="packt_screen">R</span><span class="packt_screen">eal user measurements</span><strong> </strong>feature?</li>
<li>Can you link different Azure Traffic Manager<em> </em>profiles?</li>
<li>Is it possible to use an external endpoint?</li>
<li>Does a client connect directly to an endpoint returned by Azure Traffic Manager?</li>
<li>What is the main difference between a gateway and Azure Traffic Manager?</li>
<li>Can Azure Traffic Manager<em> </em>be used to achieve high availability? If so, how?</li>
</ol>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Further reading</h1>
                </header>
            
            <article>
                
<ul>
<li>Disaster recovery with Azure DNS and Traffic Manager: <a href="https://docs.microsoft.com/en-us/azure/networking/disaster-recovery-dns-traffic-manager">https://docs.microsoft.com/en-us/azure/networking/disaster-recovery-dns-traffic-manager</a></li>
<li>How it works: <a href="https://docs.microsoft.com/en-us/azure/traffic-manager/traffic-manager-how-it-works">https://docs.microsoft.com/en-us/azure/traffic-manager/traffic-manager-how-it-works</a></li>
</ul>


            </article>

            
        </section>
    </div>



  </body></html>