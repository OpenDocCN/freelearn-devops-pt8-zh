<html><head></head><body>
		<div>
			<div id="_idContainer029" class="Content">
			</div>
		</div>
		<div id="_idContainer030" class="Content">
			<h1 id="_idParaDest-107">5. <a id="_idTextAnchor164"/>Enabling secure, remote work with Microsoft Azure AD and WVD</h1>
		</div>
		<div id="_idContainer069" class="Content">
			<p>In the previous chapter, we learned that transitioning to the cloud isn't just about moving on-premises resources to the cloud, but it is a journey that involves improving scalability, security, and cloud-based productivity to enable remote collaboration work from anywhere.</p>
			<p>In this chapter, we will address common infrastructure challenges that organizations face when trying to enable remote work, and how Azure core infrastructure components such as networking, identity, security, compute, and storage can empower today's modern digital workspace. In this chapter, we will cover:</p>
			<ul>
				<li>The fundamentals of deploying remote work infrastructure</li>
				<li>Azure Active Directory</li>
				<li>Enabling remote connectivity</li>
				<li>Securing and managing traffic to your workloads</li>
				<li>Enabling remote workers with Windows Virtual Desktop</li>
			</ul>
			<p>We'll begin by talking about the fundamentals of deploying remote work with Azure.</p>
			<h2 id="_idParaDest-108"><a id="_idTextAnchor165"/>The fundamentals of deploying remote work infrastructure</h2>
			<p>Remote working has been an imperative transition for most organizations in the past year and has brought multiple challenges for people who used to work from corporate offices full-time.</p>
			<p>Enabling working from home is the key to helping people stay connected across an organization and with partners and customers. By leveraging <strong class="bold">Azure Active Directory</strong> (<strong class="bold">Azure AD</strong>), not only will you be able to enable remote working but you will also be able to allow users to securely access the applications they need from outside the corporate network.</p>
			<p>It is important to have a strong identity foundation in the cloud, and Azure AD is the key component to empower users working remotely. Azure AD is a cloud-based offering from Microsoft that provides identity and access management capabilities. This means that Azure AD can span across different environments, allowing employees access to resources that can be located in their actual on-premises datacenter or cloud-based applications.</p>
			<p>Azure AD is the largest cloud-based identity service provided in the world, with over 200,000 organizations and more than 30 billion daily authentication requests. Azure AD also helps you detect and remediate security threats. One of the main challenges for organizations looking to use identity and access management services includes the onboarding process.</p>
			<p>Let's take a quick look at the key components and configurations that can help you securely enable application access.</p>
			<h2 id="_idParaDest-109"><a id="_idTextAnchor166"/>Azure Active Directory</h2>
			<p>Before we review Azure AD's capabilities for enabling remote work, it is important to understand that Azure AD is a cloud-based service for identity and access management. Therefore, it is suitable for different types of users, such as:</p>
			<ul>
				<li>IT admins looking to control access to applications while protecting user identities and credentials to meet governance requirements.</li>
				<li>App developers who can use Azure AD's capabilities and integration with Azure AD APIs to provide personalized app experiences.</li>
				<li>Subscribers to multiple services such as Microsoft 365, Dynamics 365, or Microsoft Azure.</li>
			</ul>
			<p>There are some considerations that you should take into account when choosing Azure AD, which we will cover next.</p>
			<h3 id="_idParaDest-110"><a id="_idTextAnchor167"/>Plan your environment</h3>
			<p>Prior to performing any deployment for Azure AD, we need to ensure that we have the right licensing model that will allow us to properly configure Azure AD with the features needed for our organization. There are three main Azure AD licensing tiers: </p>
			<ul>
				<li>Azure AD Free</li>
				<li>Azure AD Premium P1</li>
				<li>Azure AD Premium P2</li>
			</ul>
			<p>Starting with <strong class="bold">Azure AD Free</strong>, this tier will provide you with some basic features such as user and group management, on-premises directory synchronization, self-service password change for cloud users, and single sign-on across cloud platforms like Azure, Microsoft 365, and third-party SaaS solutions, as seen in <em class="italics">Figure 5.1</em>:</p>
			<div>
				<div id="_idContainer031" class="IMG---Figure">
					<img src="image/B17153_05_01.jpg" alt="A representation of the Azure AD free tierworkflow"/>
				</div>
			</div>
			<p class="figure">Figure 5.1: Azure AD</p>
			<p>If you're looking to allow users that are part of your organization access across both on-premises and cloud resources, then <strong class="bold">Azure AD Premium P1</strong> could fit your organization's primary needs. This tier supports dynamic groups and self-service group management, and it enables Microsoft Identity Manager and cloud write-back capabilities to allow your on-premises users to perform a self-service password reset, as shown in <em class="italics">Figure 5.2</em>:</p>
			<div>
				<div id="_idContainer032" class="IMG---Figure">
					<img src="image/B17153_05_02.jpg" alt="A representation of the Azure AD hybrid environment"/>
				</div>
			</div>
			<p class="figure">Figure 5.2: Azure AD hybrid environment</p>
			<p><strong class="bold">Azure AD Premium P2</strong> is the ideal tier if your organization is looking to take advantage of advanced security capabilities such as risk-based access policies based on Azure AD identity protection, which can detect malicious activities by using cloud-scale machine learning algorithms, as shown in <em class="italics">Figure 5.3</em>:</p>
			<p class="figure"> </p>
			<div>
				<div id="_idContainer033" class="IMG---Figure">
					<img src="image/B17153_05_03.jpg" alt="A representation of Azure AD Conditional Access"/>
				</div>
			</div>
			<p class="figure">Figure 5.3: Azure AD conditional access</p>
			<p>When your organization signs up for a Microsoft service such as Azure, Microsoft Intune, or Microsoft 365, it will be entitled to a dedicated Azure AD service instance called a tenant. A tenant represents an organization. </p>
			<p>You can leverage the creation of your Azure AD tenant using the Azure portal, in which you can configure and do all the administrative tasks related to Azure AD. In addition, you can make use of the Microsoft Graph API to access Azure AD resources.</p>
			<p>Now that we have gone through the various scenarios and licensing models available for Azure AD, we will proceed to review the configuration of the actual deployment of the Azure AD tenant.</p>
			<h3 id="_idParaDest-111"><a id="_idTextAnchor168"/>Configuring Azure AD and hybrid environments</h3>
			<p>While you might be familiar with most of the <strong class="bold">Active Directory Domain Services</strong> (<strong class="bold">AD DS</strong>) capabilities, it is important to highlight that Azure AD and AD DS have some similarities and differences, and it is worth performing a quick review to better understand the scope of each product. The following table summarizes some of the core differences:</p>
			<div>
				<div id="_idContainer034" class="IMG---Figure">
					<img src="image/B17153_Table_05_01.jpg" alt="Comparison between Azure Active Directory and Active Directory Domain Services"/>
				</div>
			</div>
			<p class="figure">Table 5.1: Comparison between AD DS and Azure AD</p>
			<p>Azure AD managed identities can be used if your organization has Linux workloads and needs to provide secure access and communication to those resources.</p>
			<p>In order to start working with Azure AD, you are required to use a tenant, which usually represents an organization. It is possible to start working with an existing tenant, or you can create a new Azure AD tenant.</p>
			<p>When you create an Azure subscription, it will have a trust relationship with Azure AD to authenticate users, services, and devices. Your organization can have multiple Azure subscriptions, establish a trust relationship with an instance of Azure AD, and leverage a security principal to provide access to the resources that are secured by the Azure AD tenant.</p>
			<p>Based on the types of users your application is going to authenticate, there are two main types of environments that can be created:</p>
			<ul>
				<li>Azure AD accounts (or Microsoft accounts)</li>
				<li>Azure AD B2C accounts</li>
			</ul>
			<p>The Azure AD accounts, or Microsoft accounts, refer to accounts such as outlook.com and live.com or work- and school-related accounts. The Azure AD B2C accounts refer to using local or social accounts such as your social identity for Facebook or Twitter, among other identities, to get single sign-on access to your applications and APIs.</p>
			<h3>Creating your Azure AD tenant</h3>
			<p>The creation of a new Azure AD tenant can be done through the Azure portal. Once you have your Azure subscription ready to use, the next step is to go to the Azure portal, then select the <span class="P---Screen-Text">Azure Active Directory</span> option, as shown in <em class="italics">Figure 5.4</em>:</p>
			<div>
				<div id="_idContainer035" class="IMG---Figure">
					<img src="image/B17153_05_04.jpg" alt="Selecting the Azure Active Directory option in the Azure portal"/>
				</div>
			</div>
			<p class="figure">Figure 5.4: Azure AD in the Azure portal</p>
			<p>On the overview page, click on <span class="P---Screen-Text">Create a tenant</span>, as shown in <em class="italics">Figure 5.5</em>: </p>
			<div>
				<div id="_idContainer036" class="IMG---Figure">
					<img src="image/B17153_05_05.jpg" alt="Clicking the Create a tenant button in the Overview pane"/>
				</div>
			</div>
			<p class="figure">Figure 5.5: Create a tenant</p>
			<p>Then, on the <span class="P---Screen-Text">Basics</span> pane, you can choose the type of tenant you want to create. Select <span class="P---Screen-Text">Azure Active Directory</span> or <span class="P---Screen-Text">Azure Active Directory</span> (<span class="P---Screen-Text">B2C</span>), as shown in <em class="italics">Figure 5.6</em>:</p>
			<div>
				<div id="_idContainer037" class="IMG---Figure">
					<img src="image/B17153_05_06.jpg" alt="Selecting the AzureAD tenant type"/>
				</div>
			</div>
			<p class="figure">Figure 5.6: Azure AD tenant type</p>
			<p>In the <span class="P---Screen-Text">Configuration</span> pane, you can provide a name for the organization and the initial domain name you want to use, as shown in <em class="italics">Figure 5.7</em>:</p>
			<div>
				<div id="_idContainer038" class="IMG---Figure">
					<img src="image/B17153_05_07.jpg" alt="Providing the organization and the initial domain names under the Configuration tab"/>
				</div>
			</div>
			<p class="figure">Figure 5.7: Azure AD configuration</p>
			<p>Next, Azure is going to validate your deployment. Once it is complete, click on <span class="P---Screen-Text">Create</span>, as shown in <em class="italics">Figure 5.8</em>:</p>
			<div>
				<div id="_idContainer039" class="IMG---Figure">
					<img src="image/B17153_05_08.jpg" alt="Reviewing and validating the configurations for the Azure AD tenant"/>
				</div>
			</div>
			<p class="figure">Figure 5.8: Creating the Azure AD tenant</p>
			<p>You should see a notification in the Azure portal related to the creation of the Azure AD tenant, as shown here:</p>
			<div>
				<div id="_idContainer040" class="IMG---Figure">
					<img src="image/B17153_05_09.jpg" alt="Notification showing tenant creation in progress"/>
				</div>
			</div>
			<p class="figure">Figure 5.9: Tenant creation in progress</p>
			<p>In just a few minutes, your new Azure AD tenant should be ready. You will see the notification in the Azure portal, as shown in <em class="italics">Figure 5.10</em>:</p>
			<div>
				<div id="_idContainer041" class="IMG---Figure">
					<img src="image/B17153_05_10.jpg" alt="Notification confirmingthe successful creation of the Azure ADtenant"/>
				</div>
			</div>
			<p class="figure">Figure 5.10 Azure AD tenant creation successful</p>
			<p>Click on the notification to be redirected to your new tenant page, as shown in <em class="italics">Figure 5.11</em>:</p>
			<div>
				<div id="_idContainer042" class="IMG---Figure">
					<img src="image/B17153_05_11.jpg" alt="Clicking on the notification to open the new tenant page"/>
				</div>
			</div>
			<p class="figure">Figure 5.11: Azure AD tenant</p>
			<p>For hybrid environments, it is recommended that you use Azure AD Connect to achieve hybrid identity integration, as it provides the features required to synchronize users on-premises with Azure AD, but also allows users to use the same password on-premises and in the cloud without the need for the additional infrastructure of a federated environment.</p>
			<p>Although federation is an optional configuration, Azure AD Connect can be helpful for hybrid configurations that are using an on-premises <strong class="bold">Active Directory Federation Services</strong> (<strong class="bold">AD FS</strong>) infrastructure.</p>
			<h3>Preparing the infrastructure for Windows Virtual Desktop</h3>
			<p>Whether your organization already has Active Directory on-premises or is just starting with Azure AD, it is possible to enable remote working through a hybrid environment and take advantage of the <strong class="bold">Azure Resource Manager</strong> (<strong class="bold">ARM</strong>) templates to simplify the creation of your cloud environment. The ARM template shown in <em class="italics">Figure 5.12</em> will assist you with the deployment of a virtual machine with Active Directory and Azure AD Connect installed:</p>
			<div>
				<div id="_idContainer043" class="IMG---Figure">
					<img src="image/B17153_05_12.jpg" alt="Depicting the relationship between different ARM template components"/>
				</div>
			</div>
			<p class="figure">Figure 5.12: ARM template components</p>
			<p>This ARM template will provision the following resources:</p>
			<ul>
				<li>One virtual network</li>
				<li>One subnet</li>
				<li>One <strong class="bold">Network Security Group</strong> (<strong class="bold">NSG</strong>):<ul><li>Permits AD traffic, permits <strong class="bold">Remote Desktop Protocol</strong> (<strong class="bold">RDP</strong>) incoming traffic, and restricts <strong class="bold">Demilitarized Zone</strong> (<strong class="bold">DMZ</strong>) access</li></ul></li>
				<li>DNS configured to point to the domain controller</li>
				<li>One virtual machine:<ul><li>AD DS is installed and configured.</li><li>Test users are created in the domain.</li><li>Azure AD Connect is installed and ready for configuration.</li></ul></li>
				<li>One public IP address assigned for remote administration via RDP</li>
			</ul>
			<p>Once the ARM template is deployed, the status will change to <strong class="bold">complete</strong>. At this point, the domain controller is ready for RDP connectivity.</p>
			<h4>Note</h4>
			<p class="callout">You can also try different ARM templates based on your needs and pull them from the Azure Quickstart templates, such as: </p>
			<p class="callout">active directory new domain HA 2 DC zones: <a href="https://github.com/Azure/azure-quickstart-templates/tree/master/active-directory-new-domain-ha-2-dc-zones">https://github.com/Azure/azure-quickstart-templates/tree/master/active-directory-new-domain-ha-2-dc-zones</a></p>
			<p class="callout">active-directory-new-domain-module-use: <a href="https://github.com/Azure/azure-quickstart-templates/tree/master/active-directory-new-domain-module-use">https://github.com/Azure/azure-quickstart-templates/tree/master/active-directory-new-domain-module-use</a></p>
			<p class="callout">active-directory-new-domain: <a href="https://github.com/Azure/azure-quickstart-templates/tree/master/active-directory-new-domain">https://github.com/Azure/azure-quickstart-templates/tree/master/active-directory-new-domain</a></p>
			<p>Now we can proceed to configuring Azure AD Connect with AD DS. You can connect to the Azure virtual machine recently provisioned to install Azure AD Connect using this link: <a href="https://www.microsoft.com/download/confirmation.aspx?id=47594">https://www.microsoft.com/download/confirmation.aspx?id=47594</a></p>
			<h3>Configuring Azure AD Connect with AD DS </h3>
			<p>As mentioned previously, Azure AD Connect will help you achieve hybrid identity integration as it provides features to synchronize users on-premises.</p>
			<p>The next step in the process is to connect to the domain controller and configure Azure AD Connect. If your organization has a single-forest topology, then you can use the <strong class="bold">Express Settings</strong>. </p>
			<p>You can find more details on the installation of Azure AD Connect here: <a href="https://docs.microsoft.com/azure/active-directory/hybrid/how-to-connect-install-custom">https://docs.microsoft.com/azure/active-directory/hybrid/how-to-connect-install-custom</a>.</p>
			<p>The following figure shows the Azure AD Connect wizard:</p>
			<div>
				<div id="_idContainer044" class="IMG---Figure">
					<img src="image/B17153_05_13.jpg" alt="Azure AD Connect wizard"/>
				</div>
			</div>
			<p class="figure">Figure 5.13: Azure AD Connect wizard</p>
			<p>At this point, we have reviewed Azure AD Connect with AD DS in order to synchronize with Azure AD. Once your organization has Azure AD properly configured, it is important to protect employees' identities with stronger authentication mechanisms and minimize potential identity attacks.</p>
			<h3 id="_idParaDest-112"><a id="_idTextAnchor169"/>Secure your identity infrastructure</h3>
			<p>We live in a world where passwords are no longer good enough and the majority of attacks happen to be related to password weaknesses and data breaches, most of them involving phishing. It is important to protect your identity with stronger authentication mechanisms. Azure AD <strong class="bold">Multi-Factor Authentication</strong> (<strong class="bold">MFA</strong>) is one of them—let's have a look.</p>
			<h3>Azure AD Multi-Factor Authentication</h3>
			<p>Strong authentication using Azure AD can prevent up to 99.9% of identity attacks. As you develop your strategy for strengthening your credentials, you should deploy the most secure, usable, and cost-effective methods for your organization and your users. One of the main benefits of using Azure AD is the support for MFA, which requires the use of at least two verification methods. This way, Azure AD MFA helps secure access to data and applications. </p>
			<p>Azure AD MFA capabilities are available and licensed in different ways. You can refer to the documentation for more details: <a href="https://docs.microsoft.com/azure/active-directory/authentication/howto-mfa-mfasettings">https://docs.microsoft.com/azure/active-directory/authentication/howto-mfa-mfasettings</a>.</p>
			<p>Azure AD MFA requires at least two of the following authentication methods:</p>
			<ul>
				<li>Something you know—a username and password is the most common way a user would provide credentials.</li>
				<li>Something you have—this could be a trusted device such as your phone or a hardware key.</li>
				<li>Something you are—such as a fingerprint or face scan.</li>
			</ul>
			<p>As an administrator, it is possible to define what forms of secondary authentication can be used.</p>
			<h3>Azure AD Identity Protection</h3>
			<p>Implementing a user risk security policy using Azure AD Identity Protection can help you to identify potential risks and take manual actions for each of them if needed. There are different risk detection types that you can identify and, as an administrator, you can use key reports for your investigations. Azure AD Premium P2 edition or an EMS E5 subscription is needed to use Azure AD Identity Protection.</p>
			<p>There are primarily two risk policies that can be enabled in Azure AD: <strong class="bold">sign-in risk policy</strong> and <strong class="bold">user risk policy</strong>. While both policies work to automate the response to risk detection in your environment, it is worth understanding the difference between them:</p>
			<ul>
				<li>A sign-in risk policy is an automated response that you can configure for a specific sign-in risk level and block access to resources, requiring the user to pass MFA to prove their identity in order to gain access to a specific resource. When configuring a sign-in risk policy, you need to set the users and groups that it applies to.</li>
				<li>On the other hand, an IT administrator can customize the login experience based on the user's previous risky logins with a user risk policy. A user risk policy is also an automated response that remediates users when they meet a specific risk level or there's a high probability that their credentials have been compromised. This policy will allow you to block access to the resources or require the user to reset their password to keep their identity safe.</li>
			</ul>
			<p>Here's a reference for you to configure risk policies: <a href="https://docs.microsoft.com/azure/active-directory/identity-protection/howto-identity-protection-configure-risk-policies">https://docs.microsoft.com/azure/active-directory/identity-protection/howto-identity-protection-configure-risk-policies</a>.</p>
			<h3>Privileged Identity Management</h3>
			<p><strong class="bold">Privileged Identity Management</strong> (<strong class="bold">PIM</strong>) is useful for those organizations who are moving to (if not already in) the cloud and are looking to minimize risks, particularly when it comes to privileged accounts assigned to roles in the organization. We are referring to accounts that can access a lot of resources and data.</p>
			<p>PIM is a service in Azure AD that helps you reduce these risks by enforcing <strong class="bold">Just in Time</strong> (<strong class="bold">JIT</strong>) and <strong class="bold">Just Enough Access</strong> (<strong class="bold">JEA</strong>) for these accounts.</p>
			<p>PIM forces administrators in the organization who need to use administrative privileges to elevate their privilege in order to use it, so it requires approval to activate privileged rules and enforces MFA.</p>
			<p>You can follow these steps to configure PIM for your organization: <a href="https://docs.microsoft.com/azure/active-directory/privileged-identity-management/pim-security-wizard">https://docs.microsoft.com/azure/active-directory/privileged-identity-management/pim-security-wizard</a>.</p>
			<h3>Azure AD Application Proxy</h3>
			<p>The security experience in Azure AD provides you with a one-stop shop for all identity security capabilities. By using Azure AD Application Proxy, you can enable remote work access to on-premises resources. This means that Azure AD Application Proxy allows you to publish on-premises applications to users outside the corporate network, while extending Azure AD capabilities as a central management point for all the applications in the organization.</p>
			<p>This brings some benefits, such as MFA and Conditional Access. More importantly, it avoids the limitations of traditional solutions such as VPNs, as there's no need to open access to the entire network. Azure AD Application Proxy allows you to control what resources should be accessible and works across many devices, including mobile and desktop.</p>
			<p>An organization can have a corporate network with multiple applications across departments within the DMZ with multiple segments, as well as users outside the network who need to get access to these resources in the corporate network.</p>
			<p>In order to enable Azure AD Application Proxy, you first have to install local agents in the network, which are called <strong class="bold">connectors</strong>.</p>
			<p>These connectors are agents that are executed on a Windows Server machine in your corporate network and are responsible for the communication between your on-premises application and Azure AD Application Proxy.</p>
			<p>The connectors can also be integrated with the on-premises Active Directory depending on the single sign-on mechanism that you need. It is important to note that Azure AD Application Proxy requires the Azure AD Premium P1 or P2 license:</p>
			<div>
				<div id="_idContainer045" class="IMG---Figure">
					<img src="image/B17153_05_14.jpg" alt="Azure AD Application Proxy workflow"/>
				</div>
			</div>
			<p class="figure">Figure 5.14: Azure AD Application Proxy workflow</p>
			<p>The Azure AD Application Proxy workflow, as seen in <em class="italics">Figure 5.14</em>, is as follows:</p>
			<ol>
				<li>Your organization can have a public-facing application through an endpoint that can be a URL.</li>
				<li>External users can connect to the application using that URL.</li>
				<li>External users will be redirected to a cloud service; the identity provider, which is Azure AD, will authenticate the user using MFA, Conditional Access, or any other method.</li>
				<li>Once authenticated, Azure AD will send the token to the user's client device.</li>
				<li>Then, Azure AD will send the token to the Azure AD Application Proxy service, and the user will be re-directed to the on-premises application using the Application Proxy connector.</li>
				<li>The Azure AD Application Proxy connector will perform additional authentication on behalf of the user if single sign-on is configured.</li>
				<li>Lastly, the connector sends the request to the on-premises application, and the response is sent back to the user through the connector and Azure AD Application Proxy service.</li>
			</ol>
			<p>As you can see, Azure AD Application Proxy can be used for your on-premises applications that need to be accessed from outside the corporate network.</p>
			<h3>Azure AD Conditional Access</h3>
			<p>To enable remote work for users trying to reach applications both on-premises and in the cloud, administrators need to ensure the right people get the right permissions to access the resources. Conditional Access is a premium feature in Azure AD that addresses these challenges by providing a mechanism to control access to the resources based on policies.</p>
			<p>Using Azure AD Conditional Access, you as an administrator can easily protect your organization's assets and apply the right access controls through policies that can be configured based on some common signals, such as device, application, IP location, and user or group membership.</p>
			<p>Examples of Azure AD Conditional Access include:</p>
			<ul>
				<li><strong class="bold">Location</strong>: Users accessing a resource when they're off the corporate network should be required to use MFA.</li>
				<li><strong class="bold">Device platform</strong>: Define a policy for each device platform that blocks access. For instance, allow only iOS devices but not Android.</li>
				<li><strong class="bold">Cloud apps</strong>: Requires that apps which use sensitive information are blocked if Azure AD detects a risky sign-in.</li>
			</ul>
			<p>This ends our detailed look at Azure AD. Let's move on to the other ways Azure can help you to enable remote connectivity.</p>
			<h2 id="_idParaDest-113"><a id="_idTextAnchor170"/>Enabling remote connectivity</h2>
			<p>When it comes to connectivity, Azure Virtual Network is the fundamental building block to extend your connectivity to Azure and provide the best application experience and connectivity across the organization, partners, and customers. Azure provides a variety of networking capabilities to provide connectivity and enable remote work in a secure manner.</p>
			<p>These networking capabilities include several Azure networking services. There are three main services that enable remote work: Azure Virtual WAN, Azure VPN, and ExpressRoute. </p>
			<h3 id="_idParaDest-114"><a id="_idTextAnchor171"/>Azure Virtual WAN</h3>
			<p>Azure Virtual WAN provides a unified framework for network security and routing capabilities for you to connect and span across different regions. It also allows you to deploy Azure <strong class="bold">Network Virtual Appliances</strong> (<strong class="bold">NVAs</strong>) inside a Virtual WAN hub.</p>
			<p>A Virtual WAN hub is basically a virtual network where you can deploy gateways integrated with ExpressRoute and NVAs. In order to enable remote work, you can use Azure Virtual WAN's capabilities to provide a better connectivity experience for remote users. It can connect multiple branches through Site-to-Site VPNs and remote users through Point-to-Site VPNs.</p>
			<p>When you use Azure Virtual WAN, you can expand the connectivity with multiple hubs to get a fully meshed hub that allows you to achieve an any-to-any connectivity approach. This way, you can connect a remote user to Azure while at the same time interconnecting an ExpressRoute endpoint or a branch behind a Site-to-Site VPN.</p>
			<p>It is important to highlight that every Azure Virtual WAN has a router that controls the routes with all the other gateways in the hub. It also enables network-to-network transit capabilities with up to 50 Gbps in aggregation capacity.</p>
			<p>Azure Virtual WAN comes with built-in security capabilities. You can deploy a hub per region and provision multiple firewalls, which can be managed through Azure Firewall Manager. This way, you can use Azure Firewall Manager to work across subscriptions, regions, and deployments, and create policies to secure all the traffic going through the network.</p>
			<p>Most organizations today are relying on partners and vendors to enable these networking capabilities through hardware or virtual-based appliances. These can be migrated to Azure as you have the ability to deploy an NVA through the Azure Marketplace and integrate it inside the Virtual WAN hub. Also, there are BGP capabilities built in to enable transit routing across multiple networks and exchange routes that inform on-premises devices and Azure VPN gateways about whether they are reachable or not:</p>
			<div>
				<div id="_idContainer046" class="IMG---Figure">
					<img src="image/B17153_05_15.jpg" alt="An overview of Azure networking services"/>
				</div>
			</div>
			<p class="figure">Figure 5.15: Azure networking</p>
			<p>You can provision multiple virtual networks in Azure across multiple regions, providing remote workers with a Point-to-Site VPN connection or a Site-to-Site connection for your VPN gateway connection from your on-premises network to the virtual network. This is shown in <em class="italics">Figure 5.15</em>.</p>
			<h3 id="_idParaDest-115"><a id="_idTextAnchor172"/>Azure VPN</h3>
			<p>An Azure VPN gateway enables you to send encrypted traffic across on-premises locations and Azure virtual networks over the internet or between other virtual networks. It is possible to have multiple connections to the same VPN gateway; however, you can only have a single VPN connection per virtual network.</p>
			<p>Before provisioning a specific type of VPN gateway, we need to understand the configurations available for VPN gateway connections and evaluate which one is the best fit for your organization. Azure provides multiple connection topologies that you can choose from to meet your organization's needs: <strong class="bold">Site-to-Site</strong> (<strong class="bold">S2S</strong>), multi-site, <strong class="bold">Point-to-Site</strong> (<strong class="bold">P2S</strong>), and ExpressRoute.</p>
			<p>Let's discuss each of them in turn.</p>
			<h3>Site-to-Site and Multi-Site</h3>
			<p>Site-to-Site VPN gateway is the best fit for your organization if you're looking to achieve hybrid configurations between your on-premises location and virtual networks. S2S is a connection over an IPsec/IKE (IKEv1 or IKEv2) VPN tunnel, which means that in order to deploy this type of connection you will need a VPN device located in your on-premises datacenter and a public IP address assigned to it. The following figure shows an S2S VPN connectivity schema:</p>
			<div>
				<div id="_idContainer047" class="IMG---Figure">
					<img src="image/B17153_05_16.jpg" alt="An example of a Site-to-Site VPN connection"/>
				</div>
			</div>
			<p class="figure">Figure 5.16: Site-to-Site VPN</p>
			<p>If your organization has multiple on-premises locations, it is possible to connect branches to the same virtual network using a multi-site connection approach through a route-based VPN. Bear in mind that virtual networks can only have a single VPN gateway; all the connections going through the same VPN gateway will share the available bandwidth:</p>
			<div>
				<div id="_idContainer048" class="IMG---Figure">
					<img src="image/B17153_05_17.jpg" alt="An example of a Multi-Site VPN connection"/>
				</div>
			</div>
			<p class="figure">Figure 5.17: Multi-site VPN</p>
			<p>In addition, you can configure a network-to-network connection and combine it with a multi-site configuration as seen in <em class="italics">Figure 5.17</em>. You can establish connectivity with multiple virtual networks in the same or different subscriptions, regions, and deployment models.</p>
			<h3>Point-to-Site VPN</h3>
			<p>If you're looking to give remote users access to resources in Azure, you can utilize P2S VPN gateway connections. In this deployment mode, there's no need for a VPN device on-premises; instead, the connection is directly established from the client device as seen in <em class="italics">Figure 5.18</em>:</p>
			<div>
				<div id="_idContainer049" class="IMG---Figure">
					<img src="image/B17153_05_18.jpg" alt="An example of a Point-to-Site VPN connection"/>
				</div>
			</div>
			<p class="figure">Figure 5.18: Point-to-Site VPN</p>
			<p>This type of connection is cost-effective if you want to allow a few remote users to access resources in the cloud through a virtual network. </p>
			<h3>ExpressRoute</h3>
			<p>As is very often heard in the field, ExpressRoute is your <strong class="bold">Ethernet cable to Azure</strong>. It provides connectivity between your on-premises location and Azure using a private connection through a partner known as the <strong class="bold">connection provider</strong>. ExpressRoute offers Layer 3 connectivity, which supports any-to-any network connections, point-to-point Ethernet connections, or a virtual cross-connection.</p>
			<p>Based on your organization's needs and the connectivity provider, you can choose how you want to create a connection to the cloud. There are four ways to create a connection: </p>
			<ul>
				<li><strong class="bold">CloudExchange co-location</strong>: If your datacenter is co-located in a facility with a cloud exchange, you can leverage Layer 2 cross-connections, or managed Layer 3 cross-connections through the provider's Ethernet exchange to connect your infrastructure and Azure.</li>
				<li><strong class="bold">Point-to-point Ethernet connection</strong>: On this model, you can connect your datacenter to Azure through Ethernet providers that offer Layer 2 connections, or managed Layer 3 connections and build your private connection using point-to-point Ethernet links.</li>
				<li><strong class="bold">Any-to-Any (IPVPN) connection</strong>: You can enable WAN connectivity between Azure and branch offices or datacenters, usually offered as a managed Layer 3 connectivity.</li>
				<li><strong class="bold">ExpressRoute Direct</strong>: You can plug into Microsoft's global network and achieve an Active/Active connectivity at scale to cover different needs such as massive data ingestion into Azure services or connectivity isolation.</li>
			</ul>
			<p>ExpressRoute circuits, as in <em class="italics">Figure 5.19</em>, provide a wide range of bandwidth, from 50 Mbps up to 10Gbps, and dynamic scaling without downtime:</p>
			<div>
				<div id="_idContainer050" class="IMG---Figure">
					<img src="image/B17153_05_19.jpg" alt="ExpressRoute connectivity model"/>
				</div>
			</div>
			<p class="figure">Figure 5.19: ExpressRoute</p>
			<p>In addition, it is possible to have an ExpressRoute circuit and an S2S connection at the same time. Although they can coexist, it requires two virtual network gateways for the same virtual network, one using the gateway type VPN, and the other using the gateway type ExpressRoute.</p>
			<p>With your connections to Azure established, let's look at how you can secure and manage the traffic to your cloud-based applications.</p>
			<h2 id="_idParaDest-116"><a id="_idTextAnchor173"/>Securing and managing traffic to your workloads</h2>
			<p>Security is a shared responsibility between Microsoft, partners, and customers. Azure provides security controls and services to protect identity, network, and data resources.</p>
			<p>In the previous section <em class="italics">Azure Active Directory</em>, we reviewed how you can leverage identity and management features available with Azure AD to ensure secure access to data and resources. Protecting the infrastructure and workloads for remote access on a daily basis is a critical task and Microsoft provides enterprise-grade solutions to secure the traffic to your applications, whether they are delivered through Azure or from an on-premises location.</p>
			<p>Azure can help protect your cloud infrastructure by using network security controls to manage traffic, configuring access rules, extending connectivity to your on-premises resources, and protecting your virtual network.</p>
			<p>One of the principal services that you can use to protect web applications is <strong class="bold">Azure Web Application Firewall</strong> (<strong class="bold">WAF</strong>), shown in <em class="italics">Figure 5.20</em>:</p>
			<div>
				<div id="_idContainer051" class="IMG---Figure">
					<img src="image/B17153_05_20.jpg" alt="Azure WAF overview"/>
				</div>
			</div>
			<p class="figure">Figure 5.20: Azure WAF</p>
			<p>Azure WAF is compliant with various compliance standards, including but not limited to PCI-DSS, HIPAA, SOC, ISO, and CDSA. A complete list of compliance offerings can be found here: <a href="https://docs.microsoft.com/azure/compliance/">https://docs.microsoft.com/azure/compliance/</a>.</p>
			<h3 id="_idParaDest-117"><a id="_idTextAnchor174"/>Application Gateway with WAF</h3>
			<p>Your organization may be running applications in the cloud or on-premises, with remote users trying to reach those workloads. Application Gateway is a key <strong class="bold">Platform as a Service</strong> (<strong class="bold">PaaS</strong>) component that can facilitate this. It is a lightweight <strong class="bold">Application Delivery Controller</strong> (<strong class="bold">ADC</strong>) that provides support for SSL termination, session affinity, and content-based routing. This set of capabilities makes Application Gateway a flexible service. It can be deployed, along with Azure WAF or Azure Front Door, to improve scaling capabilities and protect your applications on-premises or in the cloud against OWASP and other vulnerabilities, without the need for additional configurations.</p>
			<p>Both Application Gateway and Azure WAF are PaaS managed services, so you can save some time and provide the right protection for your applications while Azure takes care of the underlying infrastructure, as shown in the following figure:</p>
			<div>
				<div id="_idContainer052" class="IMG---Figure">
					<img src="image/B17153_05_21.jpg" alt="Azure App Gateway with the Azure WAF model"/>
				</div>
			</div>
			<p class="figure">Figure 5.21: Azure Application Gateway and Azure WAF</p>
			<p>The key benefits of Azure WAF include:</p>
			<ul>
				<li>Preconfigured protection against the OWASP Top 10 attacks.</li>
				<li>Bot protection.</li>
				<li>A custom rules engine (geo-filtering, IP restriction, HTTP parameter filtering, and size restriction).</li>
				<li>Logs and metrics for detection and alerts.</li>
			</ul>
			<p>Another common use case is integration with Azure Front Door, which provides a global application acceleration and delivery service in Azure, in addition to regional load balancing for web applications.</p>
			<p>A key benefit of using Azure Front Door with Azure WAF is the ability to detect and prevent attacks against your web applications before they reach the virtual network. You can stop malicious attacks close to the sources before they enter your virtual network and create rate limits or request thresholds to protect your application against floods. We can see how this works in <em class="italics">Figure 5.22</em>:</p>
			<div>
				<div id="_idContainer053" class="IMG---Figure">
					<img src="image/B17153_05_22.jpg" alt="Azure Front Door with Azure WAF overview"/>
				</div>
			</div>
			<p class="figure">Figure 5.22: Azure Front Door and Azure WAF</p>
			<p>This can allow you to publish and secure your web applications whether they are hosted on-premises or in the cloud.</p>
			<h3 id="_idParaDest-118"><a id="_idTextAnchor175"/>Azure Firewall</h3>
			<p>The next security control at the perimeter that your organization can use to protect your virtual network resources is Azure Firewall. Azure Firewall allows you to create, enforce, and log applications and network connectivity policies from Layer 3 up to Layer 7 of the OSI model and span across subscriptions and virtual networks.</p>
			<p>Azure Firewall is critical when considering remote work as it can provide protection for your Windows Virtual Desktop infrastructure deployments on Azure, along with threat intelligence so remote users can properly access their virtual desktops. It is recommended that you use <strong class="bold">Fully Qualified Domain Names</strong> (<strong class="bold">FQDNs</strong>) when using Windows Virtual Desktop to simplify access. Azure Firewall provides a simplified integration for Windows Virtual Desktop by enabling filtering capabilities for outbound traffic, as shown in <em class="italics">Figure 5.23</em>:</p>
			<div>
				<div id="_idContainer054" class="IMG---Figure">
					<img src="image/B17153_05_23.jpg" alt="An overview of Azure Firewall"/>
				</div>
			</div>
			<p class="figure">Figure 5.23: Azure Firewall</p>
			<p>It is important to note that Azure Firewall is a fully cloud-based managed service and Azure takes care of the underlying infrastructure.</p>
			<h3 id="_idParaDest-119"><a id="_idTextAnchor176"/>Azure Load Balancer and cross-region load balancing</h3>
			<p>Very often, organizations struggle with cloud-based workloads when there's an increase in application traffic and want to provide a better customer experience. Azure provides built-in load balancing capabilities for cloud resources so you can create highly available and scalable web applications.</p>
			<p>The main component for achieving high availability is Azure Load Balancer, as seen in <em class="italics">Figure 5.24</em>. It operates at Layer 4 of the OSI model and represents a single point of contact for clients. Azure Load Balancer is optimized for cloud workloads to distribute inbound traffic to back-end pool instances. </p>
			<p>Azure Load Balancer can be public facing, so it can load balance internet traffic to your applications living in Azure, or it can be internally facing, where private IPs are needed on the front-end side only:</p>
			<div>
				<div id="_idContainer055" class="IMG---Figure">
					<img src="image/B17153_05_24.jpg" alt="Azure Load Balancer schema"/>
				</div>
			</div>
			<p class="figure">Figure 5.24: Azure Load Balancer</p>
			<p>You will find two main Azure Load Balancer profiles, Basic and Standard. Previously, you were only able to add network interfaces associated to virtual machines or virtual machine scale sets in the back-end pool of a load balancer. However, due to recent improvements that allow load balancing across IP addresses, you are now able to load balance resources living in Azure via private IPv4 or IPv6 addresses through the Standard profile, which extends the capability for load balancing across containers.</p>
			<p>In the past, Azure Load Balancer was able to load balance only in a given region. Now, you can use Azure Load Balancer for cross-region load balancing to distribute inbound traffic and enable geo-redundant high-availability scenarios:</p>
			<div>
				<div id="_idContainer056" class="IMG---Figure">
					<img src="image/B17153_05_25.jpg" alt="Cross-region load balancer overview"/>
				</div>
			</div>
			<p class="figure">Figure 5.25: Cross-region load balancer</p>
			<p>It is possible to build cross-regional capabilities on top of an existing load balancer solution, and a huge benefit is the ability to use a static front-end IP configuration.</p>
			<h3 id="_idParaDest-120"><a id="_idTextAnchor177"/>Azure Bastion and Just-in-Time (JIT) access</h3>
			<p>Sometimes organizations need to provide remote access to resources in Azure and want to provide a secure way to connect to these resources without the need of having a VPN connection or assigning public IPs to a virtual machine.</p>
			<p>Azure Bastion enables you to manage your resources in a secure manner by providing RDP/SSH connectivity to virtual machines deployed within a virtual network, without needing public IPs directly from the Azure portal:</p>
			<div>
				<div id="_idContainer057" class="IMG---Figure">
					<img src="image/B17153_05_26.jpg" alt="An overview of Azure Bastion"/>
				</div>
			</div>
			<p class="figure">Figure 5.26: Azure Bastion</p>
			<p>Azure Bastion is a managed solution and, in the back-end, a virtual machine scale set that is deployed within your virtual network so that remote users can connect via RDP/SSH with no exposure to public IPs. This means it also has the capability to scale as needed depending on the number of concurrent sessions.</p>
			<p>Along with protection and connectivity capabilities, Azure Security Center can be used to implement JIT access, which enables you to lock down inbound traffic to your virtual machines to reduce exposure to attacks and easily audit access to the virtual machine.</p>
			<p>JIT access can also be used with Azure Firewall to reduce exposure to network volumetric attacks by creating policies to define the ports that you want to protect, for instance, to set how long they should remain open for, and filtering the IPs that should have access to the virtual machine.</p>
			<p>Now that we have discussed the main services that can enable your organization to better secure and manage traffic to your applications, let's take a look at the final piece: enabling remote work through the Azure Windows Virtual Desktop infrastructure.</p>
			<h2 id="_idParaDest-121"><a id="_idTextAnchor178"/>Enabling remote work with Windows Virtual Desktop</h2>
			<p>In the past few months, we all have experienced an impact on how we collaborate with colleagues within our organizations, as well as partners and customers. Companies of all sizes have invested in the adoption of collaboration tools that can enable remote work and provide the best experience for employees to keep connected during business disruption and improve productivity. </p>
			<p><strong class="bold">Virtual Desktop Infrastructure</strong> (<strong class="bold">VDI</strong>) is a virtualization solution that provides a desktop environment for remote users as if they were working on their local computer. Windows Virtual Desktop makes remote work possible while providing the best experience to maintain the underlying infrastructure, and it can even be built in minutes. </p>
			<p>Windows Virtual Desktop supports a variety of operating systems, including Windows 10 Enterprise, Windows 10 Enterprise multi-session, Windows 7 Enterprise, and Windows Server 2012 R2, 2016, and 2019. Depending on your organization's needs, you can make use of a specific licensing model such as Microsoft 365 E3, E5, A3, A5, or F3; Business Premium; Windows E3, E5, A3, or A5; or RDS client access licenses. <em class="italics">Figure 5.27</em> demonstrates how Windows Virtual Desktop works:</p>
			<div>
				<div id="_idContainer058" class="IMG---Figure">
					<img src="image/B17153_05_27.jpg" alt="Windows Virtual Desktop architecture"/>
				</div>
			</div>
			<p class="figure">Figure 5.27: Windows Virtual Desktop architecture </p>
			<ul>
				<li>On the left, the endpoints are usually in the on-premises network and can extend connectivity through S2S or Express Route, and Azure AD Connect can integrate the on-premises AD DS with Azure AD.</li>
				<li>Your organization can manage AD DS, Azure AD, Azure subscriptions, virtual networks, storage, and the Windows Virtual Desktop host pools and workspaces.</li>
				<li>Microsoft manages the Windows Virtual Desktop control plane, which handles web access, gateway, broker, diagnostics, and extensibility components such as REST APIs.</li>
			</ul>
			<p>In order for your organization to utilize Windows Virtual Desktop, you need Azure AD, a Windows Server Active Directory instance in sync with Azure AD, and an Azure subscription. The virtual machines for Windows Virtual Desktop can be standard domain-joined or hybrid AD-joined.</p>
			<p>The new ARM-based experience for Windows Virtual Desktop makes it easier to manage your environment. It includes a new integrated monitoring UI with Log Analytics and management UI through the Azure portal. It also enables you to manage your environment using the Azure PowerShell module for Windows Virtual Desktop.</p>
			<p>The ARM-based experience also provides better admin access control as it leverages Azure <strong class="bold">Role-Based Access Control</strong> (<strong class="bold">RBAC</strong>) with built-in custom roles. You can also publish applications and manage access through Azure AD user groups and individual users. In addition, you are now able to specify the geography you prefer for storage.</p>
			<p>The following diagram provides you with a high-level overview of the Windows Virtual Desktop architecture:</p>
			<div>
				<div id="_idContainer059" class="IMG---Figure">
					<img src="image/B17153_05_28.jpg" alt="A high-level overview of the Windows Virtual Desktop architecture"/>
				</div>
			</div>
			<p class="figure">Figure 5.28: Windows Virtual Desktop structure</p>
			<p>Through the Azure portal, you will have a seamless experience managing your Windows Virtual Desktop deployment, including host pools, application groups, workspaces, and users:</p>
			<p class="figure"> </p>
			<div>
				<div id="_idContainer060" class="IMG---Figure">
					<img src="image/B17153_05_29.jpg" alt="Managing Windows Virtual Desktop through the Azure portal"/>
				</div>
			</div>
			<p class="figure"> Figure 5.29: Managing Windows Virtual Desktop through the Azure portal</p>
			<p>You can use ARM capabilities to provision Windows Virtual Desktop. You need to register the <strong class="inline">Microsoft.DesktopVirtualization</strong> resource provider, then create the host pools as needed, including the specification of the virtual machine details, and provide the parameters for the Azure virtual network. After this, you can proceed to create the application groups and add Azure AD users or user groups to them. Finally, you configure your Windows Virtual Desktop workspace and then install the Windows Virtual Desktop client for Windows on the client device.</p>
			<p>There's a learning path on Microsoft Learn on how to deliver remote desktops and apps from Azure with Windows Virtual Desktop: <a href="https://docs.microsoft.com/learn/paths/m365-wvd/">https://docs.microsoft.com/learn/paths/m365-wvd/</a>.</p>
			<p>Also, you can leverage the ARM templates to automate the deployment process of your Windows Virtual Desktop environment: <a href="https://github.com/Azure/RDS-Templates/">https://github.com/Azure/RDS-Templates/</a>.</p>
			<h3>Components you can manage in Windows Virtual Desktop</h3>
			<p>The following table compares the resources that Microsoft manages in Windows Virtual Desktop and the ones that you can take care of:</p>
			<div>
				<div id="_idContainer061" class="IMG---Figure">
					<img src="image/B17153_Table_05_02.jpg" alt="Responsibilities for the management of resources"/>
				</div>
			</div>
			<p class="figure">Table 5.2: Responsibilities for the management of resources</p>
			<p>These are the components managed by Microsoft:</p>
			<ul>
				<li><strong class="bold">Web access</strong>: Through this service, users are able to access their desktops using an HTML5-compatible web browser.</li>
				<li><strong class="bold">Gateway</strong>: This service enables remote users to establish a connection with Windows Virtual Desktop apps and desktops from any device that can execute the Windows Virtual Desktop client.</li>
				<li><strong class="bold">Connection broker</strong>: This service manages user connections and provides load balancing capabilities.</li>
				<li><strong class="bold">Diagnostics</strong>: This is an event-based aggregator to identify potential failures of the components.</li>
				<li><strong class="bold">Extensibility components</strong>: This includes third-party tools and additional extensions that can be enabled for Windows Virtual Desktop.</li>
			</ul>
			<p>These are the components you manage:</p>
			<ul>
				<li><strong class="bold">Azure virtual networks</strong>: You can configure the network topology as needed to provide access to desktops and applications based on your organization's policies.</li>
				<li><strong class="bold">Azure AD</strong>: While this is a pre-requisite for using Windows Virtual Desktop, you can manage Azure AD integration and security features to keep your environment compliant.</li>
				<li><strong class="bold">AD DS</strong>: This is a pre-requisite for enabling Windows Virtual Desktop that includes synchronization with Azure AD. You can also leverage Azure AD Connect to associate AD DS with Azure AD.</li>
				<li><strong class="bold">Windows Virtual Desktop session hosts</strong>: You can run a variety of operating systems, including Windows 10 Enterprise; Windows 10 Enterprise multi-session; Windows 7 Enterprise; Windows Server 2012 R2, 2016, and 2019; and also custom Windows images.</li>
				<li><strong class="bold">Windows Virtual Desktop workspace</strong>: This is a workspace for managing and publishing host pool resources.</li>
			</ul>
			<h3>Sizing your Windows Virtual Desktop environment</h3>
			<p>In the past, sizing your Windows Virtual Desktop environment was a bit of a challenge due to the availability of only some basic guidance. Now you can utilize the Windows Virtual Desktop Experience Estimator, a tool that can help you to find the right size for your environment for your organization's needs.</p>
			<p>The Windows Virtual Desktop Experience Estimator is available at <a href="https://azure.microsoft.com/services/virtual-desktop/assessment/">https://azure.microsoft.com/services/virtual-desktop/assessment/</a>.</p>
			<p>Initially, you will find a table that shows the region with the lowest round trip time from your current location and also provides a reference to the size of the virtual machines and network services needed for your implementation:</p>
			<div>
				<div id="_idContainer062" class="IMG---Figure">
					<img src="image/B17153_Table_05_03.jpg" alt="Round trip times for different Azure regions"/>
				</div>
			</div>
			<p class="figure"> Table 5.3: Round trip times for different Azure regions</p>
			<p>Based on your current location, you can choose a preferred region to provide a better user experience. Bear in mind that there are also additional components that might impact your deployment, such as network conditions, end user devices, and the configuration of the virtual machines.</p>
			<h3 id="_idParaDest-122"><a id="_idTextAnchor179"/>Network guidelines </h3>
			<p>As we have already discussed, networking components are critical to enabling remote work. Bandwidth is one of the key metrics that you should look at when sizing your environment as it will impact the user experience. The following table demonstrates some recommendations based on different types of workloads and can be found at <a href="https://docs.microsoft.com/windows-server/remote/remote-desktop-services/network-guidance">https://docs.microsoft.com/windows-server/remote/remote-desktop-services/network-guidance</a>: </p>
			<div>
				<div id="_idContainer063" class="IMG---Figure">
					<img src="image/B17153_Table_05_04.jpg" alt="Recommended bandwidth for different workload types"/>
				</div>
			</div>
			<p class="figure">Table 5.4: Recommended bandwidth for different workload types</p>
			<p>The display resolution is another form factor along with the bandwidth. The following table shows the recommended bandwidth for an optimal user experience:</p>
			<div>
				<div id="_idContainer064" class="IMG---Figure">
					<img src="image/B17153_Table_05_05.jpg" alt="Recommended bandwidth for different display resolutions at 30fps"/>
				</div>
			</div>
			<p class="figure">Table 5.5: Recommended bandwidth for different display resolutions at 30 fps</p>
			<p>With regard to the virtual machines for your Windows Virtual Desktop environment, Microsoft provides examples of different workload types to properly size the virtual machines that you need for your environment:</p>
			<div>
				<div id="_idContainer065" class="IMG---Figure">
					<img src="image/B17153_Table_05_06.jpg" alt="Examples of different workload types"/>
				</div>
			</div>
			<p class="figure">Table 5.6: Examples of different workload types</p>
			<p>In addition, an example of a metric that you should take into consideration based on the workloads is the number of users reaching the same application at the same time. That said, you can consider the multi-session or single-session recommendations based on your organization's needs.</p>
			<p>Microsoft provides a virtual machine size based on the maximum suggested number of users per <strong class="bold">virtual CPU</strong> (<strong class="bold">vCPU</strong>) and examples of Azure instances that match the minimum virtual machine configuration:</p>
			<div>
				<div id="_idContainer066" class="IMG---Figure">
					<img src="image/B17153_Table_05_07.jpg" alt="Multi-sessionrecommendations"/>
				</div>
			</div>
			<p class="figure">Table 5.7: Multi-session recommendations</p>
			<p>As a general recommendation, it is a good idea to use Premium SSD disks for critical workloads and consider GPUs if you plan to run graphics-intensive programs on your virtual machines. </p>
			<h3 id="_idParaDest-123"><a id="_idTextAnchor180"/>Managing user profiles with Azure Files and NetApp Files</h3>
			<p>While Azure offers a wide range of storage solutions, FSLogix profile containers are one of the recommended user profile solutions for a Windows Virtual Desktop service as they are designed to roam profiles in non-persistent remote computing environments.</p>
			<p>When a user performs a sign-in, a container is dynamically attached to the computing environment. You can also create profile containers using Azure NetApp Files to quickly provision SMB volumes for Windows Virtual Desktop.</p>
			<p>The following table provides a comparison between the different solutions available for Windows Virtual Desktop FSLogix profile container user profiles:</p>
			<div>
				<div id="_idContainer067" class="IMG---Figure">
					<img src="image/B17153_Table_05_08.jpg" alt="Comparison between different WVDFSLogix profile container user profiles"/>
				</div>
			</div>
			<p class="figure">Table 5.8: Windows Virtual Desktop FSLogix profile container user profiles</p>
			<p>To look up the regional availability details for Azure NetApp Files and other products, visit <a href="https://azure.microsoft.com/global-infrastructure/services/">https://azure.microsoft.com/global-infrastructure/services/</a>.</p>
			<p>The following table provides a comparison of the storage solutions Azure Storage offers for Windows Virtual Desktop that are supported on Azure with FSLogix profile container user profiles:</p>
			<div>
				<div id="_idContainer068" class="IMG---Figure">
					<img src="image/B17153_Table_05_09.jpg" alt="Storage solutions for Windows Virtual Desktop supported on Azure with FSLogix profile container user profiles"/>
				</div>
			</div>
			<p class="figure">Table 5.9: Storage solutions Azure Storage offers for Windows Virtual Desktop</p>
			<p>Here are some relevant links to further information:</p>
			<ol>
				<li value="1">Microsoft compliance offerings: <a href="https://docs.microsoft.com/compliance/regulatory/offering-home">https://docs.microsoft.com/compliance/regulatory/offering-home</a></li>
				<li>Azure Files integration with AD: <a href="https://docs.microsoft.com/azure/storage/files/storage-files-active-directory-overview">https://docs.microsoft.com/azure/storage/files/storage-files-active-directory-overview</a></li>
				<li>Azure NetApp Files integration with AD: <a href="https://docs.microsoft.com/azure/azure-netapp-files/azure-netapp-files-faqs#does-azure-netapp-files-support-azure-active-directory">https://docs.microsoft.com/azure/azure-netapp-files/azure-netapp-files-faqs#does-azure-netapp-files-support-azure-active-directory</a></li>
			</ol>
			<h3 id="_idParaDest-124"><a id="_idTextAnchor181"/>Azure Monitor for Windows Virtual Desktop</h3>
			<p>It is important for you to minimize the risk of failures in the Windows Virtual Desktop environment. Azure provides native integration with Azure Monitor to quickly identify issues through a single dashboard.</p>
			<p>You can review the following activity logs:</p>
			<ul>
				<li>Management activities</li>
				<li>Connections</li>
				<li>Host registration</li>
				<li>Errors</li>
				<li>Checkpoints</li>
			</ul>
			<p>In order to monitor your Windows Virtual Desktop environment, you need to create a Log Analytics workspace via the Azure portal or PowerShell and then connect the virtual machines to Azure Monitor.</p>
			<p>Once you have onboarded your Windows Virtual Desktop into Log Analytics, you will be able to run custom queries using <strong class="bold">Kusto Query Language</strong> (<strong class="bold">KQL</strong>) to analyze the health of your Windows Virtual Desktop environment. A simple use case could be if there's a need to find session duration by the user, as shown in the following code:</p>
			<p class="snippet">let Events = WVDConnections | where UserName == "userupn" ;</p>
			<p class="snippet">Events</p>
			<p class="snippet">| where State == "Connected"</p>
			<p class="snippet">| project CorrelationId , UserName, ResourceAlias , StartTime=TimeGenerated</p>
			<p class="snippet">| join (Events</p>
			<p class="snippet">| where State == "Completed"</p>
			<p class="snippet">| project EndTime=TimeGenerated, CorrelationId)</p>
			<p class="snippet">on CorrelationId</p>
			<p class="snippet">| project Duration = EndTime - StartTime, ResourceAlias</p>
			<p class="snippet">| sort by Duration asc</p>
			<p>In this code, we are using a <strong class="inline">let</strong> statement for the <strong class="inline">Event</strong> instance called <strong class="inline">WVDConnections</strong> and filtering tables for rows that match the users with a <strong class="inline">connected</strong> state. Then, as good practice, we use <strong class="inline">project</strong> to select just the columns we need before performing the <strong class="inline">join</strong>. We pull events with the first <strong class="inline">EventType</strong> and with the second <strong class="inline">EventType</strong> and then join the two sets on <strong class="inline">CorrelationId</strong>.</p>
			<p>After this, we rename the timestamp column and sort the results in ascending order.</p>
			<p>You can use Azure Monitor workbooks to create custom visualizations of your Windows Virtual Desktop performance. You can find an example of a workbook for Windows Virtual Desktop here: <a href="https://github.com/wvdcommunity/AzureMonitor/blob/master/WVD-ARM-monitoring-workbook.json">https://github.com/wvdcommunity/AzureMonitor/blob/master/WVD-ARM-monitoring-workbook.json</a>.</p>
			<h3 id="_idParaDest-125"><a id="_idTextAnchor182"/>Windows Virtual Desktop partner integrations </h3>
			<p>Microsoft partners are a key component in order to fully enable an organization's remote work capabilities; there are Windows Virtual Desktop partner integrations with Citrix and VMware. </p>
			<p>Citrix extended its Virtual Apps and Desktops offering to Azure, which can be consumed as a managed service and is available through the Azure Marketplace. This is a combination of new technology and new entitlements. It supports a multi-session Windows 10 experience and, if you have the appropriate RDS license, you can use Windows Server. It also supports persistent and non-persistent single-session or multi-session experiences.</p>
			<p>You can read more about Virtual Apps and Desktops for Azure here: <a href="https://azure.microsoft.com/services/virtual-desktop/citrix-virtual-apps-desktops-for-azure/">https://azure.microsoft.com/services/virtual-desktop/citrix-virtual-apps-desktops-for-azure/</a>.</p>
			<p>VMware is an approved Windows Virtual Desktop provider that simplifies the deployment of hybrid Windows Virtual Desktop environments through its Horizon Control Plane to enable a single management interface for both on-premises and cloud-based deployments.</p>
			<p>Customers can leverage Windows 10 multi-sessions and the platform is available via the Horizon Universal License, which includes the ability to deploy VMware Horizon on any supported platform:</p>
			<ul>
				<li>You can read more about VMware Horizon Cloud on Microsoft Azure here: <a href="https://azuremarketplace.microsoft.com/marketplace/apps/vmware-inc.hc-azure ">https://azuremarketplace.microsoft.com/marketplace/apps/vmware-inc.hc-azure</a></li>
				<li>Quickstart Guide for Windows Virtual Desktop: <a href="https://azure.microsoft.com/resources/quickstart-guide-to-windows-virtual-desktop/">https://azure.microsoft.com/resources/quickstart-guide-to-windows-virtual-desktop/</a></li>
				<li>Windows Virtual Desktop Migration Guide for RDS: <a href="https://azure.microsoft.com/resources/windows-virtual-desktop-migration-guide-for-remote-desktop-services/">https://azure.microsoft.com/resources/windows-virtual-desktop-migration-guide-for-remote-desktop-services/</a></li>
			</ul>
			<h2 id="_idParaDest-126"><a id="_idTextAnchor183"/>Summary</h2>
			<p>In this chapter, we reviewed common infrastructure-related challenges that organizations face when trying to enable remote work, and how Azure AD can help your organization keep its employees' identities and resources protected. We also learned how you can use Azure networking components to enable connectivity and secure access to your organization's workloads both on-premises and in the cloud. Lastly, we reviewed how you can provide a better end user experience through Windows Virtual Desktop and saw guidance on the sizing and configuration of your environment.</p>
			<p>The next chapter will provide you with a security baseline and recommendations on how you can use the security services available to your organization so that you can apply standard security control frameworks to your Azure deployments and enforce governance across all your resources.</p>
		</div>
	</body></html>