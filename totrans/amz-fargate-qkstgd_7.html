<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Using Amazon ECS CLI</h1>
                </header>
            
            <article>
                
<p>Amazon ECS <strong>Command Line Interface</strong> (<strong>CLI</strong>) is a command-line tool used to create, update, and monitor ECS clusters and tasks. Amazon ECS CLI supports the Fargate launch type. To create a container application with ECS CLI, Docker Compose (v1 or v2) is required. In this chapter, we shall use ECS CLI to launch an ECS cluster of the Fargate launch type in Windows PowerShell.</p>
<p><span>In this chapter, we will learn about the following:</span></p>
<ul>
<li>Setting up the environment</li>
<li>Installing ECS CLI</li>
<li>Installing AWS Tools for Windows PowerShell</li>
<li>Configuring ECS CLI</li>
<li>Setting up prerequisites for Fargate</li>
<li>Registering the task execution policy</li>
<li>Creating an ECS cluster</li>
<li>Creating a security group</li>
<li>Granting security group ingress</li>
<li>Creating a compose file</li>
<li>Configuring ECS specific parameters</li>
<li>Deploying the compose file to the cluster</li>
<li>Listing the running containers on the cluster</li>
<li>Listing the container logs</li>
<li>Scaling the tasks on the cluster</li>
<li>Accessing the WordPress service</li>
<li>Deleting the service and the cluster</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Setting up the environment</h1>
                </header>
            
            <article>
                
<p>If PowerShell is not already installed, download and install PowerShell 3.0 or a later version. Windows Management Framework 3.0 includes PowerShell 3.0:</p>
<ol>
<li><span>Log in to PowerShell as an Administrator for which right-click on PowerShell application, and select </span><span class="packt_screen">Run as administrator</span></li>
<li><span> </span>Verify that the version is 3.0 with the <kbd>get-host</kbd> command</li>
<li>Enable script execution with the following command, which allows all user-created scripts to run, and all scripts downloaded from the internet would need to be signed:</li>
</ol>
<pre><strong>      Set-ExecutionPolicy RemoteSigned</strong></pre>
<p>We also need to obtain the AWS Security credentials represented with an <span class="packt_screen">Access Key</span>, which consists of an <span class="packt_screen">Access Key ID</span> and <span class="packt_screen">Secret Access Key</span>:</p>
<ol>
<li>To obtain the security credentials, select <span class="packt_screen">My Security Credentials</span> from the account dropdown.</li>
<li>In the confirmation dialog, click on <span class="packt_screen">Continue to Security Credentials</span>.</li>
<li>The <span class="packt_screen">Your Security Credentials</span> page is displayed; select <span class="packt_screen">Access keys</span>. Security credentials only display the <span class="packt_screen">Access Key ID</span> and not the <span class="packt_screen">Secret Access Key</span>. Unless the Access Key ID and the Secret Access Key were recorded earlier, create a new access key with <span class="packt_screen">Create New Access Key</span>.</li>
<li>A <span class="packt_screen">Create Access Key</span> dialog indicates that the access key has been created.</li>
<li>Click on the <span class="packt_screen">Show Access Key</span> link.</li>
<li>Copy the <span class="packt_screen">Access Key ID</span> and <span class="packt_screen">Secret Access Key</span>. Set the environment variables <kbd>AWS_ACCESS_KEY_ID</kbd> and <kbd>AWS_SECRET_KEY</kbd>.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing ECS CLI</h1>
                </header>
            
            <article>
                
<p>To install ECS CLI on PowerShell, first run PowerShell as an administrator by right-clicking on Windows PowerShell and selecting <span class="packt_screen">Run as administrator</span>:</p>
<ol>
<li>Subsequently, run the following command to create a new item of type directory at the specified path:</li>
</ol>
<pre style="padding-left: 90px"><strong>New-Item -ItemType "directory" -Path "C:\Program Files\Amazon\ECSCLI"</strong></pre>
<ol start="2">
<li>Download and install ecs-cli <kbd>ecs-cli-windows-amd64-latest.exe</kbd> to application <kbd>ecs-cli.exe</kbd> in directory <kbd>C:\Program Files\Amazon\ECSCLI\</kbd>.</li>
</ol>
<pre style="padding-left: 90px"><strong>Invoke-WebRequest -OutFile ‘C:\Program Files\Amazon\ECSCLI\ecs-cli.exe’ https://s3.amazonaws.com/amazon-ecs-cli/ecs-cli-windows-amd64-latest.exe</strong></pre>
<ol start="3">
<li>Add <kbd>C:\Program Files\Amazon\ECSCLI</kbd> to the <kbd>PATH</kbd> environment variable. Output the <kbd>ecs-cli</kbd> version:</li>
</ol>
<pre style="padding-left: 90px"><strong>ecs-cli --version</strong></pre>
<p>The preceding commands run in PowerShell, as shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/c56eaf03-de53-4f44-8bb4-67a778b0f6c8.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing AWS Tools for Windows PowerShell</h1>
                </header>
            
            <article>
                
<p>Next, install AWS Tools for Windows PowerShell, which is used to manage AWS services, including ECS from PowerShell:</p>
<ol>
<li>Download the MSI Installer file (<kbd>AWSToolsAndSDKForNet_sdk-3.3.231.0_ps-3.3.225.1_tk-1.14.0.1</kbd>) for AWS Tools for Windows PowerShell from <a href="https://aws.amazon.com/powershell/">https://aws.amazon.com/powershell/</a>.</li>
<li>Double-click on the MSI Installer to launch the <span class="packt_screen">AWS Tools for Windows Setup</span> wizard. Click on <span class="packt_screen">Next</span> in the Welcome screen.</li>
<li>In <span class="packt_screen">End-User License Agreement</span>, accept the agreement and click on <span class="packt_screen">Next</span>.</li>
<li>In <span class="packt_screen">Custom Setup</span>, select the default installation <span class="packt_screen">Location</span> and click on <span class="packt_screen">Next</span>.</li>
<li>In <span class="packt_screen">Read to install AWS Tools for Windows</span>, click on <span class="packt_screen">Install</span>. AWS Tools for Windows starts to get installed.</li>
<li>When the AWS Tools for Windows installation has completed, click on <span class="packt_screen">Finish.</span></li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring ECS CLI</h1>
                </header>
            
            <article>
                
<p>Configuring the ECS CLI involves the following two configurations:</p>
<ul>
<li>Configure an ECS cluster with the Fargate launch type</li>
<li>Configure an ECS CLI profile</li>
</ul>
<p>Next, we shall discuss each of these configurations. The syntax to configure a cluster is as follows:</p>
<pre><strong>ecs-cli configure --cluster cluster_name --default-launch-type launch_type --region region_name --config-name configuration_name</strong></pre>
<p>The different command parameters in the <kbd>ecs-cli</kbd> configure command are discussed in this table:</p>
<table border="1" style="border-collapse: collapse;width: 100%">
<tbody>
<tr>
<td>
<p><strong>Command parameter</strong></p>
</td>
<td>
<p><strong>Description</strong></p>
</td>
<td>
<p><strong>Value to set</strong></p>
</td>
</tr>
<tr>
<td>
<p><kbd>--cluster</kbd></p>
</td>
<td>
<p>Name of an existing ECS cluster or a new cluster to create</p>
</td>
<td>
<p><kbd>hello-world</kbd></p>
</td>
</tr>
<tr>
<td>
<p><kbd>--region</kbd></p>
</td>
<td>
<p>AWS region</p>
</td>
<td>
<p><kbd>us-east-1</kbd></p>
</td>
</tr>
<tr>
<td>
<p><kbd>--default-launch-type</kbd></p>
</td>
<td>
<p>Launch type</p>
</td>
<td>
<p><kbd>FARGATE</kbd></p>
</td>
</tr>
<tr>
<td>
<p><kbd>--config-name</kbd></p>
</td>
<td>
<p>Configuration name</p>
</td>
<td>
<p><kbd>hello-world</kbd></p>
</td>
</tr>
</tbody>
</table>
<p> </p>
<ol>
<li>Run the following command in PowerShell to configure an ECS cluster:</li>
</ol>
<pre><strong>      ecs-cli configure --cluster hello-world --region us-east-1 --default-<br/>      launch-type FARGATE --config-name hello-world</strong></pre>
<ol start="2">
<li>Create a directory, <kbd>C:\PowerShell</kbd>, for PowerShell and run the preceding command from the directory. As the command output indicates, the ECS CLI cluster configuration <kbd>hello-world</kbd> gets saved:</li>
</ol>
<pre><strong>      PS C:\PowerShell&gt;</strong><br/><strong>      PS C:\PowerShell&gt; ecs-cli configure --cluster hello-world --region<br/>      us-east-1 --default-launch-type FARGATE --config-name hello-world<br/>      time="2018-01-09T15:26:52-08:00" level=info msg="Saved ECS CLI <br/>      cluster configuration hello-world."</strong><br/><strong>      PS C:\PowerShell&gt;</strong></pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Setting up a CLI profile</h1>
                </header>
            
            <article>
                
<p>The command syntax to configure an ECS CLI profile is as follows:</p>
<pre><strong>ecs-cli configure profile --profile-name profile_name --access-key $AWS_ACCESS_KEY_ID --secret-key $AWS_SECRET_ACCESS_KEY</strong></pre>
<p>The different command parameters in the <kbd>ecs-cli</kbd> configure profile command are discussed in this table:</p>
<table border="1" style="border-collapse: collapse;width: 100%">
<tbody>
<tr>
<td>
<p><strong>Command parameter</strong></p>
</td>
<td>
<p><strong>Description</strong></p>
</td>
<td>
<p><strong>Value to set</strong></p>
</td>
</tr>
<tr>
<td>
<p><kbd>--profile</kbd></p>
</td>
<td>
<p>Name of an existing ECS cluster or a new cluster to create</p>
</td>
<td>
<p><kbd>hello-world</kbd></p>
</td>
</tr>
<tr>
<td>
<p><kbd>--access-key</kbd></p>
</td>
<td>
<p>AWS access key ID</p>
</td>
<td>
<p>Value would be different for different users</p>
</td>
</tr>
<tr>
<td>
<p><kbd>--secret-key</kbd></p>
</td>
<td>
<p>Secret access key</p>
</td>
<td>
<p>Value would be different for different users</p>
</td>
</tr>
</tbody>
</table>
<p> </p>
<ol>
<li>Create an ECS CLI profile, <kbd>hello-world</kbd>, in which the variables need to be substituted with the <kbd>AWS Access Key ID</kbd> and <kbd>Secret Access Key</kbd>, which would be different for different users:</li>
</ol>
<pre style="padding-left: 30px"><strong>      ecs-cli configure profile --access-key $AWS_ACCESS_KEY_ID --<br/>      secret-key $AWS_SECRET_ACCESS_KEY --profile-name hello-world</strong></pre>
<ol start="2">
<li>As the output from the command indicates, an ECS CLI profile gets saved:</li>
</ol>
<pre><strong>      PS C:\PowerShell&gt; ecs-cli configure profile --access-key Abcdef --<br/>      secret-key D+d+KidQel/myUXJi/hJjtk --profile-name hello-world <br/>      time="2018-01-09T15:46:15-08:00" level=info msg="Saved ECS CLI <br/>      profile configuration hello-world."</strong></pre>
<ol start="3">
<li>As an alternative to creating a <kbd>hello-world</kbd> profile (or some other profile name), a default ECS profile may be created using the <kbd>-StoreAs</kbd> default parameter:</li>
</ol>
<pre><strong>      PS C:\PowerShell&gt; Set-AWSCredential -AccessKey AKIAJ4DECNW6BFYN5PNA -<br/>      SecretKey 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 -StoreAs default</strong></pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Setting up prerequisites for Fargate</h1>
                </header>
            
            <article>
                
<p>In addition to configuring an ECS CLI profile, we need to set up the following prerequisites to create an ECS cluster with the FARGATE launch type:</p>
<ul>
<li>Create a task execution role</li>
<li>Register the task execution policy</li>
<li>Create the task execution role</li>
</ul>
<p>A task execution role is required to be created for a Fargate task to be able to download a Docker image and send and save container logs in CloudWatch. Create an IAM policy, <kbd>execution-assume-role.json</kbd>, in the <kbd>C:\PowerShell\</kbd> directory, and copy and save the following JSON listing to the policy file:</p>
<pre>{<br/>  "Version": "2012-10-17",<br/>  "Statement": [<br/>    {<br/>      "Sid": "",<br/>      "Effect": "Allow",<br/>      "Principal": {<br/>        "Service": "ecs-tasks.amazonaws.com"<br/>      },<br/>      "Action": "sts:AssumeRole"<br/>    }<br/>  ]<br/>}</pre>
<p>Create the task execution role with the following command in PowerShell:</p>
<pre><strong>New-IAMRole -RoleName ecsExecutionRole -AssumeRolePolicyDocument (Get-Content -Raw C:\PowerShell\execution-assume-role.json)</strong></pre>
<p>As the output from the command indicates, a task execution role gets created:</p>
<pre><strong>PS C:\PowerShell&gt; New-IAMRole -RoleName ecsExecutionRole -AssumeRolePolicyDocument (Get-Content -Raw C:\PowerShell\execution-assume-role.json)<br/></strong><strong>Path    RoleName         RoleId                 CreateDate   Description<br/></strong><strong>----    --------         ------                 ----------   -----------<br/></strong><strong>/      ecsExecutionRole  AROAIRRZ5LMXLR6QPZQJC  1/9/2018 3:07:16 PM</strong></pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Registering the task execution policy</h1>
                </header>
            
            <article>
                
<p>Next, register the task execution policy with the following command in PowerShell:</p>
<pre><strong>Register-IAMRolePolicy -RoleName ecsExecutionRole -PolicyArn arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy</strong></pre>
<p>The preceding command does not generate any output, and the task execution policy gets registered.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating an ECS cluster</h1>
                </header>
            
            <article>
                
<p>Having configured the prerequisites, next we shall create an ECS Fargate cluster. Run the following command in PowerShell to create a cluster:</p>
<pre><strong>esc-cli up</strong></pre>
<p>As the command output indicates, a cluster gets created using the cluster configuration set up earlier. A VPC and two subnets also get created:</p>
<pre><strong>PS C:\PowerShell&gt; ecs-cli up</strong><br/><strong>←[36mINFO←[0m[0002] Created cluster ←[36mcluster←[0m=hello-world ←[36mregion←[0m=us-east-1<br/></strong><strong>←[36mINFO←[0m[0003] Waiting for your cluster resources to be created...</strong><br/><strong>←[36mINFO←[0m[0004] Cloudformation stack status ←[36mstackStatus←[0m=CREATE_IN_PROGRESS</strong><br/><strong>←[36mINFO←[0m[0065] Cloudformation stack status ←[36mstackStatus←[0m=CREATE_IN_PROGRESS</strong><br/><strong> VPC created: vpc-6e021915</strong><br/><strong> Subnet created: subnet-2c02dd4b</strong><br/><strong> Subnet created: subnet-f2d50bdc</strong><br/><strong> Cluster creation succeeded.</strong><br/><strong> PS C:\PowerShell&gt;</strong></pre>
<p>Access the ECS Console in a web browser and the <kbd>hello-world</kbd> cluster gets listed, as shown here:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/c515467a-8a5e-4310-8a96-3e0d9820aa45.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a security group</h1>
                </header>
            
            <article>
                
<p>Next, create a S<span>ecurity group</span><span> using the VPC created in the previous section on creating a cluster. The AWS region is required to be specified in the following command, if not configured in persisted/shell defaults:</span></p>
<pre><strong>$groupid = New-EC2SecurityGroup -VpcId "<span>vpc-6e021915</span>" -Region "us-east-1" -GroupName "hello-worldPSSecurityGroup" -GroupDescription "EC2-VPC from PowerShell"</strong></pre>
<p>List the EC2 security group with the following <kbd>Get-EC2SecurityGroup</kbd> command:</p>
<pre><strong>Get-EC2SecurityGroup -Region "us-east-1" -GroupId $groupid</strong></pre>
<p>The EC2 security group gets listed, as shown here:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/15a18143-b901-4d47-ad26-8b38ae6bce87.png"/></div>
<p>If required, the EC2 security group may be removed with the following command:</p>
<pre><strong>Remove-EC2SecurityGroup -Region "us-east-1" $groupid</strong></pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Granting security group Ingress</h1>
                </header>
            
            <article>
                
<p>Next, add a security group rule to allow inbound access on port <kbd>80</kbd> with the <kbd>Grant-EC2SecurityGroupIngress</kbd> <span>cmdlet,</span><span> </span><span>using the following commands run in the sequence listed:</span></p>
<pre><strong>$ip1 = new-object Amazon.EC2.Model.IpPermission</strong><br/><strong>$ip1.IpProtocol = "tcp"</strong><br/><strong>$ip1.FromPort = 80</strong><br/><strong>$ip1.ToPort = 80</strong><br/><strong>$ip1.IpRanges.Add("0.0.0.0/0")<br/></strong><strong>Grant-EC2SecurityGroupIngress -GroupId $groupid -Region "us-east-1" -IpPermissions @($ip1)</strong></pre>
<p>Subsequently, run the <kbd>Get-EC2SecurityGroup</kbd> cmdlet again and, as the output here indicates, the Ingress permissions get set on the EC2 security group:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/497f57e0-9984-419c-a153-97895e1aef83.png"/></div>
<p>We shall be creating an ECS task for WordPress only, but if a MySQL database is also to be configured in the same task, we would also need to add an ingress rule for port <kbd>3306</kbd>, which is exposed by the MySQL database. Run the following commands in the sequence listed to add ingress for port <kbd>3306</kbd>:</p>
<pre class="mce-root"><strong>$ip2 = new-object Amazon.EC2.Model.IpPermission</strong><br/><strong>$ip2.IpProtocol = "tcp"</strong><br/><strong>$ip2.FromPort = 3306</strong><br/><strong>$ip2.ToPort = 3306</strong><br/><strong>$ip2.IpRanges.Add("0.0.0.0/0")</strong><br/><strong>Grant-EC2SecurityGroupIngress -GroupId $groupid -Region "us-east-1" -IpPermissions @($ip2)</strong></pre>
<p>Subsequently, run the <kbd>Get-EC2SecurityGroup</kbd> command. As the output here shows, ingress for port <kbd>3306</kbd> also gets added:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/4369591a-a470-4e9a-9bd0-9376ba10c7ce.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a compose file</h1>
                </header>
            
            <article>
                
<p>ECS CLI supports Docker compose versions 1 and 2, and we have used version 2 for the example compose file for WordPress. Create a <kbd>docker-compose.yml</kbd> <span>file</span><span> </span><span>in the</span> <kbd>C:/PowerShell</kbd> <span>directory, and copy the following listing to the file:</span></p>
<pre>version: '2'<br/>services:wordpress:<br/>    image: wordpress<br/>    ports:<br/>      - "80:80"<br/>    logging:<br/>      driver: awslogs<br/>      options:<br/>        awslogs-group: hello-world<br/>        awslogs-region: us-east-1<br/>        awslogs-stream-prefix: wordpress</pre>
<p>The Docker compose file specifies a <kbd>wordpress</kbd> service based on the <kbd>wordpress</kbd><span> </span><span>Docker image </span><span>and exposes port <kbd>80</kbd>. CloudWatch logging is configured using the</span> <kbd>awslogs</kbd> <span>driver, which is the only supported driver for the Fargate launch type.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring ECS specific parameters</h1>
                </header>
            
            <article>
                
<p>We also need to create an <strong>ECS specific parameters</strong> file, <kbd>ecs-params.yml</kbd>, which defines resource (CPU and memory) settings for the task to create in addition to setting the Network Mode as <kbd>awsvpc</kbd>, which is the only supported Network Mode for the Fargate launch type. The run parameters include the network configuration for subnets, security groups, and setting the <kbd>Assign public IP</kbd> option for the task to <kbd>ENABLED</kbd>. The subnets are obtained from the output of the <kbd>ecs-cli up</kbd> command. The security group is obtained from the output of the <kbd><span>Get-EC2SecurityGroup -Region "us-east-1" -GroupId $groupid</span></kbd><span> command, as </span>listed earlier:</p>
<pre>version: 1<br/>task_definition:<br/>  task_execution_role: ecsExecutionRole<br/>  ecs_network_mode: awsvpc<br/>  task_size:<br/>    mem_limit: 0.5GB<br/>    cpu_limit: 256<br/>run_params:<br/>  network_configuration:<br/>    awsvpc_configuration:<br/>      subnets:<br/>        - "subnet-2c02dd4b"<br/>        - "subnet-f2d50bdc"<br/>      security_groups:<br/>        - "sg-8c7dafc7"<br/>      assign_public_ip: ENABLED</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Deploying the compose file to the cluster</h1>
                </header>
            
            <article>
                
<p>The <kbd>ecs-cli compose service up</kbd> command deploys a Docker compose file to a cluster. The command may optionally be parameterized with the command options discussed in this table:</p>
<table border="1" style="border-collapse: collapse;width: 100%">
<tbody>
<tr>
<td>
<p><strong>Parameter</strong></p>
</td>
<td>
<p><strong>Description</strong></p>
</td>
<td>
<p><strong>Default value</strong></p>
</td>
</tr>
<tr>
<td>
<p><kbd>--project-name</kbd></p>
</td>
<td>
<p>Project name</p>
</td>
<td>
<p>The current directory</p>
</td>
</tr>
<tr>
<td>
<p><kbd>--ecs-params</kbd></p>
</td>
<td>
<p>ECS params file to use</p>
</td>
<td>
<p>The <kbd>ecs-params.yml</kbd> in the current directory</p>
</td>
</tr>
<tr>
<td>
<p><kbd>--create-log-groups</kbd></p>
</td>
<td>
<p>Creates CloudWatch Log groups for container logs</p>
</td>
<td>
<p> </p>
</td>
</tr>
<tr>
<td>
<p><kbd>--file</kbd></p>
</td>
<td>
<p>Docker compose file</p>
</td>
<td>
<p>The <kbd>docker-compose.yml</kbd> file in the current directory</p>
</td>
</tr>
</tbody>
</table>
<p> </p>
<p>Run the following command in which the <kbd>--project-name</kbd> and <kbd>--create-log-groups</kbd> options are used. We don’t need to use the other options, as the required files are in the current directory:</p>
<pre><strong>ecs-cli compose --project-name hello-world service up --create-log-groups</strong></pre>
<p>The Docker compose file gets deployed on the <kbd>hello-world</kbd><span> </span><span>cluster</span><span>. The output from the command is shown</span> <span>here:</span></p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/b6142489-39f8-4469-b257-0c1d7c2bb37d.png"/></div>
<p>The <kbd>hello-world</kbd> cluster lists one running task, as shown here:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/aaac7d42-ef41-4d3c-bec3-9a5f8e52e863.png"/></div>
<p>Click on the <kbd>hello-world</kbd> cluster link to display its details. The service created is listed in the <span class="packt_screen">Services</span> tab. Click on the service link as shown here to list the details:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/ea9cdc91-87ff-4676-82ce-7ea9e107cffc.png"/></div>
<p>The service <span class="packt_screen">Details</span>, which include the name of the <span class="packt_screen">Cluster</span> name, <span class="packt_screen">Status</span>, <span class="packt_screen">Task definition</span>, <span class="packt_screen">Launch type</span>, <span class="packt_screen">Platform version</span>, <span class="packt_screen">Desired count</span>, <span class="packt_screen">Pending count</span>, and <span class="packt_screen">Running count</span> get displayed, as shown here:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/3ad86abb-a2f9-429b-9d48-23faa595e7c9.png" style="width:43.25em;height:26.08em;"/></div>
<p>To find the task details, select the <span class="packt_screen">Tasks</span> tab and click on the task link as shown here:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/3bb4f32d-30a1-4b46-aac2-eb383fc490a9.png" style="width:44.42em;height:26.08em;"/></div>
<p>The task details get displayed, as shown in the following screenshot. The <span class="packt_screen">Public IP</span> at which the task may be accessed is also listed:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/b41d6f20-e96c-4347-9e62-0bd36b9c7b69.png" style="width:41.17em;height:25.00em;"/></div>
<p>Scroll down for the <span class="packt_screen">Containers</span>. The <kbd>wordpress</kbd> container gets listed, as shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/fe723d13-e502-4e92-9a03-31f0609c7c65.png" style="width:40.33em;height:21.50em;"/></div>
<p>Because we configured logs, <span class="packt_screen">Log Configuration</span> is displayed in the container details, as shown here:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/bad4a640-9e11-4f1f-be41-dea8bcd09db0.png" style="width:26.58em;height:13.08em;"/></div>
<p>Click on the <span class="packt_screen"><span class="packt_screen">View logs</span> in CloudWatch</span> link to display the CloudWatch logs, as shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/4b585343-785d-431b-b66d-257ebf0a51ae.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Listing the running containers on the cluster</h1>
                </header>
            
            <article>
                
<p>To list the running containers on the cluster, run the following command:</p>
<pre><strong>ecs-cli compose --project-name hello-world service ps</strong></pre>
<p>The one Docker container gets listed as shown in the following screenshot. The container's State, Ports, and Task Definition also get listed:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/ce4c5985-0408-426b-9a13-0f78997e057a.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Listing the container logs</h1>
                </header>
            
            <article>
                
<p>To list the container logs, copy the task ID (the task ID is the container name <kbd>substring</kbd> before the <kbd>/</kbd>) from the container name, and run the following command:</p>
<pre><strong>ecs-cli logs --task-id 0c23d765-88c5-46cd-a317-9db243590c89 –follow</strong></pre>
<p>The container logs get displayed as shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/a8a7e459-fc38-4ccf-aaf1-c2cbdb472190.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Scaling the tasks on the cluster</h1>
                </header>
            
            <article>
                
<p>To scale the cluster to two tasks, as an example, run the following command:</p>
<pre><strong>ecs-cli compose --project-name hello-world service scale 2</strong></pre>
<p>As the output here indicates, the <kbd>desiredCount</kbd> and <kbd>runningCount</kbd> get set to <kbd>2</kbd>:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/1f876b9b-f14c-4466-9394-b4f9842bf202.png"/></div>
<p>Subsequently, list the running tasks:</p>
<pre><strong>ecs-cli compose --project-name hello-world service ps</strong></pre>
<p>Two tasks get listed, as shown here:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/c87aaa2e-d6c8-4468-8315-a5d0874bf336.png"/></div>
<p>The <span class="packt_screen">Running tasks</span> in the <kbd>hello-world</kbd> cluster are also listed as <span class="packt_screen">2</span>, as shown in the following screenshot. Click on the <kbd>hello-world</kbd> cluster link:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/425c71b8-0787-4812-8a79-33e591f5aec8.png"/></div>
<p>Select the <span class="packt_screen">Tasks</span> tab and two tasks get listed, as shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/f0940f4a-a263-464b-bf74-3d66958b76e6.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Accessing the WordPress service</h1>
                </header>
            
            <article>
                
<p>To access the WordPress service, open the public IP of one of the tasks in a web browser. Select a language and click on <span class="packt_screen">Continue</span>. The welcome page for the WordPress application gets displayed as shown in the following screenshot. Click on the <span class="packt_screen">Let’s go!</span> button:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/9946534d-7ee8-4480-b98d-526478eae154.png"/></div>
<p>Specify the database connection details and click on <span class="packt_screen">Submit</span> to access the WordPress dashboard. The connection details shown below may need to be modified from the default settings.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Deleting the service and the cluster</h1>
                </header>
            
            <article>
                
<p>To delete the service and the associated tasks, run the following command:</p>
<pre><strong>ecs-cli compose --project-name hello-world service down</strong></pre>
<p>As the output shown here indicates, the running count and desired count for the tasks gets set to <span class="packt_screen">0</span>, and the <kbd>hello-world</kbd> service gets deleted. The service has to be scaled down to <span class="packt_screen">0</span> before deleting the service:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/f0ae1964-d83d-4ec7-977d-ed11bcd95371.png"/></div>
<p>Delete the cluster with the following command:</p>
<pre><strong>ecs-cli down –force</strong></pre>
<p>Select <span class="packt_screen">y</span> at the command prompt <span class="packt_screen">Are you sure you want to delete your cluster?.</span> The <kbd>hello-world</kbd> cluster and all associated resources get deleted<span>.</span> If the cluster does not get deleted due to timeout, or due to some of the resources not getting deleted as shown in the following screenshot, run the preceding command again: </p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/c36c429e-3a31-466f-adef-ac604a1973bf.png"/></div>
<p>Alternatively, delete the <span class="packt_screen">CloudFormation</span> stack associated with the cluster directly by selecting <span class="packt_screen">Actions</span> | <span class="packt_screen">Delete Stack</span> in the AWS <span class="packt_screen">CloudFormation</span> console, as shown in the following screenshot: </p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/8e6777d6-0dc1-484f-bae7-6d0a2fab2c97.png"/></div>
<p>In the <span class="packt_screen">Delete Stack</span> confirmation dialog, select the stack resources not yet deleted and click on <span class="packt_screen">Yes, Delete</span>, as shown here: </p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/3782e02a-e3e1-4ba9-8a30-c8cb7a2fef1b.png" style="width:30.00em;height:26.17em;"/></div>
<p>Run the <kbd>ecs-cli down -force</kbd> command again after deleting the <span class="packt_screen">CloudFormation</span> stack directly and the cluster should get deleted, as shown here: </p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/49983bd6-8709-4165-aad0-a251b9561884.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we discussed using the ECS CLI to create a cluster of the launch type Fargate. Subsequently, we deployed a Docker compose file on the cluster to run a task for the Docker <kbd>wordpress</kbd><span> </span><span>image</span><span>. We discussed listing logs and running containers, and also demonstrated scaling the service.<br/></span><span>This chapter brings to a conclusion the Amazon Fargate Quick Start guide. Amazon Fargate is a launch type for the Amazon <strong>Elastic Container Service</strong> (<strong>ECS</strong>). </span><span>At the time of writing, there is no native AWS integration between Amazon <strong>Elastic Kubernetes Service</strong> (<strong>EKS</strong>) and AWS Fargate</span><span>. </span></p>


            </article>

            
        </section>
    </body></html>