- en: Deploying Additional Applications on Azure AD
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在Azure AD上部署其他应用程序
- en: Providing the correct authentication to your application is essential, particularly
    if you want to allow authentication only to users from your **Azure Active Directory**
    (**Azure AD**), or from any other Azure AD. Azure AD provides two concepts to
    give your users the required authentication.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 为你的应用程序提供正确的身份验证至关重要，尤其是当你只希望允许来自**Azure Active Directory**（**Azure AD**）的用户或任何其他Azure
    AD的用户进行身份验证时。Azure AD提供了两个概念来为你的用户提供所需的身份验证。
- en: In this chapter, we'll introduce you to the idea of single-tenant and multi-tenant
    applications and what's different between them. Furthermore, we'll discuss roles
    and claims in a single-tenant app that we move to a multi-tenant app, and you
    can test the transition between the two models. We'll also deploy a multi-tenant
    app that uses OpenID Connect. In all the different labs, you'll learn what you
    need from an application vendor to integrate the application into your environment.
    You'll be able to ask the right questions and take your deployment in the right
    direction.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将向你介绍单租户和多租户应用程序的概念以及它们之间的不同之处。此外，我们将讨论在将单租户应用程序迁移到多租户应用程序时，角色和声明的不同，你可以测试这两种模型之间的过渡。我们还将部署一个使用OpenID
    Connect的多租户应用程序。在所有不同的实验中，你将学习到你需要的知识，以便从应用程序供应商那里获取信息，将应用程序集成到你的环境中。你将能够提出正确的问题，并将部署引导到正确的方向。
- en: 'We''ll divide the chapter into the following sections:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将把本章分为以下几个部分：
- en: Preparing your lab environment
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 准备你的实验环境
- en: What defines a single- and multi-tenant application
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 定义单租户和多租户应用程序的标准
- en: Deploying a single-tenant application, including roles and claims
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 部署单租户应用程序，包括角色和声明
- en: Moving the single-tenant app to a multi-tenant scenario
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将单租户应用程序迁移到多租户场景
- en: Deploying a multi-tenant app with OpenID Connect
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用OpenID Connect部署多租户应用程序
- en: As usual, we'll do a lot of practical tasks. Let's organize the prerequisites
    to handle the labs in your demo environment.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 和往常一样，我们将做很多实际操作。让我们整理一下在演示环境中处理实验所需的前置条件。
- en: Preparing your lab environment
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备你的实验环境
- en: 'In this chapter, you can use any machine that has Visual Studio installed.
    In our case, we installed it on the **YD1APP01** server. This should be your perfect
    development environment. You will use **Azure AD1: yourdomain1.onmicrosoft.com** during
    this lab, and one test guest user from another tenant and a test user from any
    other Azure AD to test multi-tenant applications. Furthermore, you will need to
    use the code examples from the code package to use it in your Visual Studio to
    configure and run the applications:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: '在本章中，你可以使用任何安装了Visual Studio的机器。在我们的案例中，我们将其安装在**YD1APP01**服务器上。这应该是你的完美开发环境。在本实验中，你将使用**Azure
    AD1: yourdomain1.onmicrosoft.com**，并使用来自另一个租户的一个测试来宾用户和来自任何其他Azure AD的测试用户来测试多租户应用程序。此外，你还需要使用代码包中的代码示例，并将其用于Visual
    Studio中配置和运行应用程序：'
- en: '![](img/321ae050-3c23-482d-b159-b3ec9dee23a6.png)'
  id: totrans-12
  prefs: []
  type: TYPE_IMG
  zh: '![](img/321ae050-3c23-482d-b159-b3ec9dee23a6.png)'
- en: Lab environment overview
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 实验环境概览
- en: After preparing our lab environment, we can directly jump into the first section
    of the chapter, which describes single- and multi-tenant applications.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 在准备好我们的实验环境后，我们可以直接进入本章的第一部分，该部分描述了单租户和多租户应用程序。
- en: What defines single- and multi-tenant applications
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 定义单租户和多租户应用程序的标准
- en: 'On the face of it, there''s a simple explanation of what a single-tenant or
    a multi-tenant application is. We can say that single-tenant apps are only available
    in the tenant they were registered. On the other hand, multi-tenant apps are available
    to users in both your home tenant and in other tenants:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 表面上看，单租户和多租户应用程序有一个简单的解释。我们可以说，单租户应用程序仅在它们注册的租户中可用。另一方面，多租户应用程序可以在你的本地租户以及其他租户的用户中使用：
- en: Single-tenant applications are primarily used if you want to isolate your application
    from everyone and provide access only to your internal users
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 单租户应用程序主要用于当你希望将应用程序与外部隔离，并仅向内部用户提供访问权限时。
- en: Multi-tenant applications are used when you want to provide the app to your
    internal staff, guest users, and Microsoft personal account users in a collaboration
    scenario, for example
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 多租户应用程序用于当你希望将应用程序提供给内部员工、来宾用户以及在协作场景下的微软个人账户用户时，例如。
- en: We highly recommend reviewing [https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-convert-app-to-be-multi-tenant](https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-convert-app-to-be-multi-tenant) to
    find the differences between the endpoints that are used in both scenarios.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 我们强烈建议查看 [https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-convert-app-to-be-multi-tenant](https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-convert-app-to-be-multi-tenant)
    以了解在两种场景中使用的端点之间的差异。
- en: Deploying a single-tenant application including roles and claims
  id: totrans-20
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 部署包含角色和声明的单租户应用程序
- en: In this section, we'll deploy Microsoft's sample, `WebApp-RoleClaims-DotNet.sln`,
    as a single-tenant configuration. We start with this setting and move the application
    to a multi-tenant application in the next part. The tracker app provides the following
    application roles, which we can use to test the role/claims topic. First, we can
    use the admin role to perform all actions. With the writer role, you're empowered
    to create tasks in the application. To change the status of a task, you can assign
    the approver role. To view the tasks and their associated states, we can map the
    observer role.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将以单租户配置部署 Microsoft 的示例，`WebApp-RoleClaims-DotNet.sln`。我们从这个设置开始，然后在下一部分将应用程序迁移到多租户应用程序。该追踪应用程序提供了以下应用角色，我们可以用来测试角色/声明主题。首先，我们可以使用管理员角色执行所有操作。使用编写者角色，你可以在应用程序中创建任务。要更改任务的状态，可以分配批准者角色。要查看任务及其相关状态，我们可以映射观察者角色。
- en: 'With the following steps, we''ll configure Azure AD for our application:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 通过以下步骤，我们将为我们的应用程序配置 Azure AD：
- en: Open the Azure portal: [https://portal.azure.com](https://portal.azure.com).
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开 Azure 门户：[https://portal.azure.com](https://portal.azure.com)。
- en: Navigate to the Azure AD blade.
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到 Azure AD 切换板。
- en: Click App registrations.
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击应用注册。
- en: 'Create +New application registration:'
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建 + 新应用注册：
- en: '![](img/3f10a3df-0769-4df3-8350-4503999fe439.png)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
  zh: '![](img/3f10a3df-0769-4df3-8350-4503999fe439.png)'
- en: New app registration
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 新应用程序注册
- en: Provide a name.
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供名称。
- en: 'Add the Sign-on URL, `https://localhost:44322/`:'
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加登录 URL，`https://localhost:44322/`：
- en: '![](img/274b99c5-148c-4a79-aebe-5f5710fd5145.png)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
  zh: '![](img/274b99c5-148c-4a79-aebe-5f5710fd5145.png)'
- en: App settings dialog
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 应用设置对话框
- en: 'Provide the App ID URI in the format `https://181031inovitdemos.onmicrosoft.com/trackerapp`:'
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供应用程序 ID URI，格式为 `https://181031inovitdemos.onmicrosoft.com/trackerapp`：
- en: '![](img/4fca9888-4de1-4769-9ede-1d97fe7cd514.png)'
  id: totrans-34
  prefs: []
  type: TYPE_IMG
  zh: '![](img/4fca9888-4de1-4769-9ede-1d97fe7cd514.png)'
- en: Additional app settings dialog
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 额外应用设置对话框
- en: Provide the Logout URL, `https://localhost:44322/Account/EndSession`.
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供登出 URL，`https://localhost:44322/Account/EndSession`。
- en: 'Leave the other settings as the defaults:'
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将其他设置保持为默认：
- en: '![](img/9f925c98-ff94-432a-8f05-d1db1cce812c.png)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
  zh: '![](img/9f925c98-ff94-432a-8f05-d1db1cce812c.png)'
- en: Logout URL configuration
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 登出 URL 配置
- en: 'Check the Reply URLs; they need to look like the following figure:'
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查回复 URL；它们应该像下图一样：
- en: '![](img/3470ac25-8ff0-4f14-afaa-2d5e0062f70b.png)'
  id: totrans-41
  prefs: []
  type: TYPE_IMG
  zh: '![](img/3470ac25-8ff0-4f14-afaa-2d5e0062f70b.png)'
- en: Reply URL configuration
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 回复 URL 配置
- en: 'Under Required permissions, click Add:'
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在所需权限下，点击添加：
- en: '![](img/b9e65e6f-fee7-4614-98d0-45f2154ced9f.png)'
  id: totrans-44
  prefs: []
  type: TYPE_IMG
  zh: '![](img/b9e65e6f-fee7-4614-98d0-45f2154ced9f.png)'
- en: Permission configuration
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 权限配置
- en: 'Select the Microsoft Graph API:'
  id: totrans-46
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择 Microsoft Graph API：
- en: '![](img/f3e3880a-5283-43fc-95e3-337cfdc0ab49.png)'
  id: totrans-47
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f3e3880a-5283-43fc-95e3-337cfdc0ab49.png)'
- en: Choosing the Microsoft Graph API
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 选择 Microsoft Graph API
- en: 'Select the following permissions:'
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择以下权限：
- en: Sign in and read user profile
  id: totrans-50
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 登录并读取用户资料
- en: Read directory data
  id: totrans-51
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 阅读目录数据
- en: You can use the Microsoft Graph permission reference [https://docs.microsoft.com/en-us/graph/permissions-reference](https://docs.microsoft.com/en-us/graph/permissions-reference) to
    learn more about this topic.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用 Microsoft Graph 权限参考文档 [https://docs.microsoft.com/en-us/graph/permissions-reference](https://docs.microsoft.com/en-us/graph/permissions-reference)
    来了解更多关于此主题的信息。
- en: 'The selected permissions should look like the following screenshot:'
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选中的权限应如下所示：
- en: '![](img/993ae024-549e-4cc1-96ab-63068e0f2a5a.png)'
  id: totrans-54
  prefs: []
  type: TYPE_IMG
  zh: '![](img/993ae024-549e-4cc1-96ab-63068e0f2a5a.png)'
- en: Assigning the two needed scopes
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 分配所需的两个范围
- en: Save and click Grant Permissions.
  id: totrans-56
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存并点击授予权限。
- en: 'Open the Manifest of the application:'
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开应用程序的清单：
- en: '![](img/5e3e52c9-7fef-4ced-92ce-b553ce48eabb.png)'
  id: totrans-58
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5e3e52c9-7fef-4ced-92ce-b553ce48eabb.png)'
- en: Configuring the Manifest
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 配置清单
- en: Configure the roles of the following figure in the `appRoles` section with the
    configuration code of the code package.
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 `appRoles` 部分配置下图中的角色，并使用代码包的配置代码。
- en: 'The result in your manifest should look like this:'
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 清单中的结果应如下所示：
- en: '![](img/a5da5ced-2d13-41f7-8c48-8bcb825ee0c6.png)'
  id: totrans-62
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a5da5ced-2d13-41f7-8c48-8bcb825ee0c6.png)'
- en: Adding the app roles
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 添加应用角色
- en: Save the manifest.
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存清单。
- en: Copy the app ID to Notepad.
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将应用程序 ID 复制到记事本中。
- en: Navigate to your Azure AD tenant's Properties.
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到 Azure AD 租户的属性页面。
- en: 'Copy the Directory ID to Notepad:'
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将目录 ID 复制到记事本：
- en: '![](img/48e45e78-417a-4e42-a631-614b3af06e1e.png)'
  id: totrans-68
  prefs: []
  type: TYPE_IMG
  zh: '![](img/48e45e78-417a-4e42-a631-614b3af06e1e.png)'
- en: Getting the Directory ID
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 获取目录 ID
- en: Open your Visual Studio and the solution file from the code package named `WebApp-RoleClaims-DotNet.sln`.
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开 Visual Studio 并加载名为 `WebApp-RoleClaims-DotNet.sln` 的解决方案文件。
- en: 'Open the `web.config` file of the solution and do the following:'
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开解决方案的 `web.config` 文件并进行以下操作：
- en: Enter the app ID on the `ida:ClientId` value
  id: totrans-72
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在 `ida:ClientId` 值中输入应用程序 ID
- en: Enter the Directory ID on the `ida:TenantId` value
  id: totrans-73
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在 `ida:TenantId` 值中输入目录 ID
- en: 'The following result is expected:'
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 预期的结果如下：
- en: '![](img/22631920-bbad-4e8e-a429-c1e6d02731e6.png)'
  id: totrans-75
  prefs: []
  type: TYPE_IMG
  zh: '![](img/22631920-bbad-4e8e-a429-c1e6d02731e6.png)'
- en: Modifying the web.config file
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 修改 `web.config` 文件
- en: Press *F5* in Visual Studio to build and run the application.
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Visual Studio 中按 *F5* 来构建并运行应用程序。
- en: 'Sign in as Don Hall:'
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以 Don Hall 用户登录：
- en: '![](img/ea70e42f-22a3-452c-bb09-33b32b7a9642.png)'
  id: totrans-79
  prefs: []
  type: TYPE_IMG
  zh: '![](img/ea70e42f-22a3-452c-bb09-33b32b7a9642.png)'
- en: Testing sign-in functionality
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 测试登录功能
- en: Consent to application.
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 同意应用程序授权。
- en: 'Click Accept:'
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击接受：
- en: '![](img/fd545083-2507-40fa-87c6-defb7d36b5f8.png)'
  id: totrans-83
  prefs: []
  type: TYPE_IMG
  zh: '![](img/fd545083-2507-40fa-87c6-defb7d36b5f8.png)'
- en: OAuth consent
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: OAuth 授权
- en: 'Go back to Visual Studio and review the role implementation in the `TaskController.cs`
    file:'
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 返回 Visual Studio 并检查 `TaskController.cs` 文件中的角色实现：
- en: '![](img/96278c91-08e9-48c6-8492-8eee967bd5d0.png)'
  id: totrans-86
  prefs: []
  type: TYPE_IMG
  zh: '![](img/96278c91-08e9-48c6-8492-8eee967bd5d0.png)'
- en: Reviewing the role implementation in the code
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 审查代码中的角色实现
- en: Don Hall will be signed in.
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Don Hall 将成功登录。
- en: 'Click About to view the actual roles; no roles are assigned:'
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“关于”以查看实际的角色；没有角色被分配：
- en: '![](img/e180636a-415d-425a-aa9b-67aae44f8cfa.png)'
  id: totrans-90
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e180636a-415d-425a-aa9b-67aae44f8cfa.png)'
- en: Viewing the actual app roles
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 查看实际的应用程序角色
- en: Go back to your application and assign roles to several test users.
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 返回到应用程序并为多个测试用户分配角色。
- en: 'Click Add user:'
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击添加用户：
- en: '![](img/7dfc7226-0619-4db6-93dc-ef84baa60037.png)'
  id: totrans-94
  prefs: []
  type: TYPE_IMG
  zh: '![](img/7dfc7226-0619-4db6-93dc-ef84baa60037.png)'
- en: Assigning users and groups
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 分配用户和组
- en: 'Assign the role you want to test:'
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 分配你想要测试的角色：
- en: '![](img/e53bbc8f-8210-437b-b448-91fe5d9c0749.png)'
  id: totrans-97
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e53bbc8f-8210-437b-b448-91fe5d9c0749.png)'
- en: Select the appropriate role
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 选择合适的角色
- en: 'In my case, I used two accounts, as you can see in the following screenshot:'
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在我的例子中，我使用了两个帐户，如下图所示：
- en: '![](img/a4efd321-9742-47ec-8d31-59255d8ffe86.png)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a4efd321-9742-47ec-8d31-59255d8ffe86.png)'
- en: Role assignment result
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 角色分配结果
- en: 'Try to sign in with your users; I started with Ye Xu (Admin role assigned):'
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 尝试用你的用户登录；我从 Ye Xu（分配了管理员角色）开始：
- en: '![](img/48f7c0ec-df67-4d9a-9a97-1a58b63c7b22.png)'
  id: totrans-103
  prefs: []
  type: TYPE_IMG
  zh: '![](img/48f7c0ec-df67-4d9a-9a97-1a58b63c7b22.png)'
- en: Testing sign-in functionality
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 测试登录功能
- en: 'Accept the user consent:'
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接受用户授权：
- en: '![](img/1cd1d7a4-48e3-4315-a1e8-7ed31bf35625.png)'
  id: totrans-106
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1cd1d7a4-48e3-4315-a1e8-7ed31bf35625.png)'
- en: Checking and approving the OAuth consent
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 检查并批准 OAuth 授权
- en: 'Click About to view the assigned role. We can see Ye Xu has the Admin role
    assigned:'
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“关于”以查看分配的角色。我们可以看到 Ye Xu 已分配了管理员角色：
- en: '![](img/3c09d085-339c-4df8-9b2b-38919f191073.png)'
  id: totrans-109
  prefs: []
  type: TYPE_IMG
  zh: '![](img/3c09d085-339c-4df8-9b2b-38919f191073.png)'
- en: Check your current role
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 检查当前角色
- en: 'Try the user with a different role, in my case Dan Jump (Writer role assigned):'
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 尝试一个不同角色的用户，在我的例子中是 Dan Jump（已分配 Writer 角色）：
- en: '![](img/cda0ddcf-0ce4-4939-8fe6-1a0473409cd4.png)'
  id: totrans-112
  prefs: []
  type: TYPE_IMG
  zh: '![](img/cda0ddcf-0ce4-4939-8fe6-1a0473409cd4.png)'
- en: Testing with the second test user
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 使用第二个测试用户进行测试
- en: 'Accept the consent:'
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接受授权：
- en: '![](img/7b1e8a0f-9c0f-47d7-8dce-66d39b134d7f.png)'
  id: totrans-115
  prefs: []
  type: TYPE_IMG
  zh: '![](img/7b1e8a0f-9c0f-47d7-8dce-66d39b134d7f.png)'
- en: Checking and approving the OAuth consent
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 检查并批准 OAuth 授权
- en: 'You will see the `Writer` role is correctly assigned:'
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你将看到`Writer`角色已正确分配：
- en: '![](img/958dec4a-c3b9-48de-ac19-618d0a8c7426.png)'
  id: totrans-118
  prefs: []
  type: TYPE_IMG
  zh: '![](img/958dec4a-c3b9-48de-ac19-618d0a8c7426.png)'
- en: View your current role
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 查看当前角色
- en: 'Try to sign in with a user that''s not part of the organization (one from another
    Azure AD):'
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 尝试用一个不在组织中的用户登录（来自另一个 Azure AD 的用户）：
- en: '![](img/6dd9e320-8a99-4995-9fdc-7c0812330afc.png)'
  id: totrans-121
  prefs: []
  type: TYPE_IMG
  zh: '![](img/6dd9e320-8a99-4995-9fdc-7c0812330afc.png)'
- en: Test with a guest user account
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 使用访客用户帐户进行测试
- en: 'Remember, we''re using a single-tenant configuration at the moment. The user
    gets an error message and can''t sign in:'
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 请记住，我们当前使用的是单租户配置。用户会收到错误信息，无法登录：
- en: '![](img/9c3f2d69-af11-455e-9910-adc0e578cd81.png)'
  id: totrans-124
  prefs: []
  type: TYPE_IMG
  zh: '![](img/9c3f2d69-af11-455e-9910-adc0e578cd81.png)'
- en: Review the error messages
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 查看错误信息
- en: Our demo app is running and working with role assignments for users of our own
    Azure AD tenant. Other users from other Azure AD tenants can't access the application
    right now.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的演示应用程序正在运行，并且为我们自己 Azure AD 租户的用户分配了角色。来自其他 Azure AD 租户的用户目前无法访问该应用程序。
- en: 'We highly recommend working through the following guidance to customize claims
    in Azure AD for other protocols, such as SAML:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 我们强烈建议按照以下指导，定制 Azure AD 中的声明，以支持其他协议，如 SAML：
- en: Enterprise role app management: [https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-enterprise-app-role-management](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-enterprise-app-role-management)
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 企业角色应用程序管理：[https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-enterprise-app-role-management](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-enterprise-app-role-management)
- en: SAML claims customization: [https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-saml-claims-customization](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-saml-claims-customization)
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SAML 声明自定义：[https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-saml-claims-customization](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-saml-claims-customization)
- en: Claims mapping: [https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-claims-mapping](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-claims-mapping)
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 声明映射：[https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-claims-mapping](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-claims-mapping)
- en: 'Configuring optional claims: [https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-optional-claims](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-optional-claims)'
  id: totrans-131
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置可选声明：[https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-optional-claims](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-optional-claims)
- en: Next, we'll move the app to a multi-tenant configuration.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将把应用程序迁移到多租户配置。
- en: Moving the single-tenant app to a multi-tenant scenario
  id: totrans-133
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将单租户应用程序迁移到多租户场景
- en: 'In this section, we''ll reconfigure the application to work as a multi-tenant
    application that you can use from other Azure AD tenants or a Microsoft personal
    account. With the following configuration we migrate the application:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将重新配置应用程序，使其作为多租户应用程序，您可以从其他 Azure AD 租户或 Microsoft 个人账户中使用。通过以下配置，我们将应用程序迁移：
- en: 'Open the `Startup.cs` file in your solution:'
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开解决方案中的 `Startup.cs` 文件：
- en: Comment the `ConfigureAuth(app)` line
  id: totrans-136
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 注释掉 `ConfigureAuth(app)` 这一行
- en: 'Uncomment the `ConfigureMultitenantAuth(app)` line:'
  id: totrans-137
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 取消注释 `ConfigureMultitenantAuth(app)` 这一行：
- en: '![](img/78eb8bf8-85e9-4657-867f-3ab6b683b34d.png)'
  id: totrans-138
  prefs: []
  type: TYPE_IMG
  zh: '![](img/78eb8bf8-85e9-4657-867f-3ab6b683b34d.png)'
- en: Modifying the code for multi-tenant usage
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 修改代码以支持多租户使用
- en: 'Change the `ida:TenantId` value to our Azure AD domain name:'
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将 `ida:TenantId` 值更改为我们的 Azure AD 域名：
- en: '![](img/3e5c9f7d-fdf8-455c-8eb5-d51a164c3c3d.png)'
  id: totrans-141
  prefs: []
  type: TYPE_IMG
  zh: '![](img/3e5c9f7d-fdf8-455c-8eb5-d51a164c3c3d.png)'
- en: Changing the tenant ID
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 更改租户 ID
- en: Press *F5* in Visual Studio to build and run the app.
  id: totrans-143
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Visual Studio 中按 *F5* 以构建并运行应用程序。
- en: 'A new app will be available in Azure AD, but the users don''t have roles assigned:'
  id: totrans-144
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Azure AD 中将会有一个新应用程序，但用户尚未分配角色：
- en: '![](img/23b9da50-8496-4a1e-8c41-22ddcf322104.png)'
  id: totrans-145
  prefs: []
  type: TYPE_IMG
  zh: '![](img/23b9da50-8496-4a1e-8c41-22ddcf322104.png)'
- en: Check the role assignment for the newly created app
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 检查新创建应用程序的角色分配
- en: 'Reassign the roles to the users:'
  id: totrans-147
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将角色重新分配给用户：
- en: '![](img/d5ff0940-45f2-4223-91e5-d84593f6c204.png)'
  id: totrans-148
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d5ff0940-45f2-4223-91e5-d84593f6c204.png)'
- en: Reassign roles
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 重新分配角色
- en: Test logging in with your users and check the application.
  id: totrans-150
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 测试使用您的用户登录并检查应用程序。
- en: Test logging in with a user from another Azure AD or a Microsoft personal account.
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 测试使用来自另一个 Azure AD 或 Microsoft 个人账户的用户进行登录。
- en: 'You should be able to log in:'
  id: totrans-152
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您应该能够登录：
- en: '![](img/3278717c-6c88-48d1-a3cc-3651651a50dc.png)'
  id: totrans-153
  prefs: []
  type: TYPE_IMG
  zh: '![](img/3278717c-6c88-48d1-a3cc-3651651a50dc.png)'
- en: Check the login with the guest user account
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 检查使用访客用户账户进行登录
- en: You can find more information about this process at [https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-convert-app-to-be-multi-tenant](https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-convert-app-to-be-multi-tenant)[.](https://bit.ly/2zuyOT6)
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在 [https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-convert-app-to-be-multi-tenant](https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-convert-app-to-be-multi-tenant)[.]（https://bit.ly/2zuyOT6）获取有关此过程的更多信息。
- en: In this section, we reconfigured the application to work as a multi-tenant app
    and we were victorious! Just note that you need to invite the Microsoft personal
    account as a guest user to work with your app. Next, we'll deploy another multi-tenant
    app with OpenID Connect to show you another implementation.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一部分，我们重新配置了应用程序，使其作为多租户应用程序正常工作，并且取得了成功！只需注意，你需要邀请 Microsoft 个人帐户作为访客用户，才能与你的应用程序一起使用。接下来，我们将部署另一个使用
    OpenID Connect 的多租户应用程序，向你展示另一种实现方式。
- en: Deploying another multi-tenant app with OpenID Connect
  id: totrans-157
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 OpenID Connect 部署另一个多租户应用程序
- en: 'In this section, we''ll install a multi-tenant app that works with OpenID Connect
    as an authentication protocol. Working through this sample will help you to deploy
    the correct app registration inside your Azure AD, and you''ll learn what exactly
    needs to be configured in the application to use your Azure AD as an authentication
    provider:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一部分，我们将安装一个使用 OpenID Connect 作为认证协议的多租户应用程序。通过这个示例，你将学习如何在 Azure AD 内部署正确的应用程序注册，并了解需要在应用程序中配置哪些内容，以使用
    Azure AD 作为认证提供者：
- en: Open the Azure portal: [https://portal.azure.com](https://portal.azure.com).
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开 Azure 门户：[https://portal.azure.com](https://portal.azure.com)。
- en: Navigate to the Azure AD blade.
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到 Azure AD 面板。
- en: Click App registrations.
  id: totrans-161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“应用注册”。
- en: 'Click +New application registration:'
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 + 新建应用程序注册：
- en: '![](img/cc84b054-5081-49b1-a4bc-13e383d82979.png)'
  id: totrans-163
  prefs: []
  type: TYPE_IMG
  zh: '![](img/cc84b054-5081-49b1-a4bc-13e383d82979.png)'
- en: Create a new app registration
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 创建一个新的应用程序注册
- en: 'Provide an application name and the sign-on URL, `https://localhost:44302/`:'
  id: totrans-165
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供应用程序名称和登录 URL，`https://localhost:44302/`：
- en: '![](img/9d14d671-95ca-4446-9798-344b6c7a5444.png)'
  id: totrans-166
  prefs: []
  type: TYPE_IMG
  zh: '![](img/9d14d671-95ca-4446-9798-344b6c7a5444.png)'
- en: Provide the app properties
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 提供应用程序属性
- en: Copy the Application ID to Notepad.
  id: totrans-168
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将应用程序 ID 复制到记事本中。
- en: 'Click Settings:'
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“设置”：
- en: '![](img/a4b7750e-f5df-4ecd-baa3-dc4a11bbe0a7.png)'
  id: totrans-170
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a4b7750e-f5df-4ecd-baa3-dc4a11bbe0a7.png)'
- en: Get the app configuration data
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 获取应用程序配置数据
- en: 'Provide the App ID URI in the format `https://181031inovitdemos.onmicrosoft.com/MTTodoWebApp`:'
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供格式为 `https://181031inovitdemos.onmicrosoft.com/MTTodoWebApp` 的应用程序 ID URI：
- en: '![](img/e0488640-7171-4023-9e4a-ec7a77022380.png)'
  id: totrans-173
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e0488640-7171-4023-9e4a-ec7a77022380.png)'
- en: Adding the App ID URI
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 添加应用程序 ID URI
- en: Provide the Logout URL. The Home page URL should already be filled in.
  id: totrans-175
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供注销 URL。首页 URL 应该已经填写完毕。
- en: Provide the URL in the format `https://localhost:44302/Account/EndSession`.
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供格式为 `https://localhost:44302/Account/EndSession` 的 URL。
- en: 'Click Multi-tenanted: Yes to use the app as a multi-tenant application:'
  id: totrans-177
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“多租户：是”，以将应用程序作为多租户应用程序使用：
- en: '![](img/039b1796-2bf5-4fba-b2e5-49858854508d.png)'
  id: totrans-178
  prefs: []
  type: TYPE_IMG
  zh: '![](img/039b1796-2bf5-4fba-b2e5-49858854508d.png)'
- en: Using the multi-tenant option
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 使用多租户选项
- en: 'Configure the correct permissions for the application. Click Add in the Required
    permissions section:'
  id: totrans-180
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置应用程序的正确权限。点击“添加”在所需权限部分：
- en: '![](img/6a2a2b32-4b82-43cd-95c2-a89b49dbb9b6.png)'
  id: totrans-181
  prefs: []
  type: TYPE_IMG
  zh: '![](img/6a2a2b32-4b82-43cd-95c2-a89b49dbb9b6.png)'
- en: Grant the required permissions
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 授予所需的权限
- en: 'Choose the Microsoft Graph API:'
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择 Microsoft Graph API：
- en: '![](img/66168d5c-2f69-4fcb-8748-cf3a22fa0328.png)'
  id: totrans-184
  prefs: []
  type: TYPE_IMG
  zh: '![](img/66168d5c-2f69-4fcb-8748-cf3a22fa0328.png)'
- en: Use the Microsoft Graph API
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 Microsoft Graph API
- en: 'Assign the Sign in and read user profile permission:'
  id: totrans-186
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 分配“登录并读取用户资料”权限：
- en: '![](img/708cf974-ccc1-4f78-af66-f9b83c8eda46.png)'
  id: totrans-187
  prefs: []
  type: TYPE_IMG
  zh: '![](img/708cf974-ccc1-4f78-af66-f9b83c8eda46.png)'
- en: Scope assignment
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 范围分配
- en: 'Click Grant permissions that you grant the permissions:'
  id: totrans-189
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“授予权限”以授予权限：
- en: '![](img/6f804de4-4aac-46d8-a2ba-b0d95baf60b7.png)'
  id: totrans-190
  prefs: []
  type: TYPE_IMG
  zh: '![](img/6f804de4-4aac-46d8-a2ba-b0d95baf60b7.png)'
- en: Grant permission dialog
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 授权权限对话框
- en: Generate a key and call it `Key1`, with a duration of 2 years.
  id: totrans-192
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 生成一个密钥并命名为 `Key1`，有效期为 2 年。
- en: 'Click Save and copy the generated key value to Notepad:'
  id: totrans-193
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“保存”，并将生成的密钥值复制到记事本中：
- en: '![](img/32a43412-6dab-4ead-a7f2-df0d441e1e7b.png)'
  id: totrans-194
  prefs: []
  type: TYPE_IMG
  zh: '![](img/32a43412-6dab-4ead-a7f2-df0d441e1e7b.png)'
- en: Secret key generation
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 秘钥生成
- en: Provide the Reply URLs.
  id: totrans-196
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供回复 URL。
- en: 'The following values need to be configured:'
  id: totrans-197
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 需要配置以下值：
- en: '`https://localhost:44302/`'
  id: totrans-198
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`https://localhost:44302/`'
- en: '`https://localhost:44302/Onboarding/ProcessCode`'
  id: totrans-199
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`https://localhost:44302/Onboarding/ProcessCode`'
- en: 'Here''s the configuration:'
  id: totrans-200
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这是配置：
- en: '![](img/6b3267b2-57c4-4640-84c7-79a5d8757dad.png)'
  id: totrans-201
  prefs: []
  type: TYPE_IMG
  zh: '![](img/6b3267b2-57c4-4640-84c7-79a5d8757dad.png)'
- en: Reply URLs configuration
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 配置回复 URL
- en: Open Visual Studio and the `WebApp-MultiTenant-OpenIDConnect-DotNet.sln` solution
    file.
  id: totrans-203
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开 Visual Studio 和 `WebApp-MultiTenant-OpenIDConnect-DotNet.sln` 解决方案文件。
- en: Open the `web.config` file of the solution.
  id: totrans-204
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开解决方案的 `web.config` 文件。
- en: Copy the `Key1` value to the `ida:Password` section.
  id: totrans-205
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将 `Key1` 的值复制到 `ida:Password` 部分。
- en: Copy the application ID to the `ida:ClientID` section.
  id: totrans-206
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将应用程序 ID 复制到 `ida:ClientID` 部分。
- en: 'The modified code should look like this:'
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 修改后的代码应如下所示：
- en: '![](img/f2b73cf2-c6de-4531-a8a2-e024fddd7c4f.png)'
  id: totrans-208
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f2b73cf2-c6de-4531-a8a2-e024fddd7c4f.png)'
- en: Code modification result
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 代码修改结果
- en: Test the multi-tenant functionality. Press *F5* in Visual Studio to build the
    solution.
  id: totrans-210
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 测试多租户功能。在 Visual Studio 中按 *F5* 来构建解决方案。
- en: The application should start.
  id: totrans-211
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 应用程序应该已启动。
- en: 'Click Sign Up:'
  id: totrans-212
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击注册：
- en: '![](img/5961567e-117c-415a-9a62-9b8fa84b7396.png)'
  id: totrans-213
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5961567e-117c-415a-9a62-9b8fa84b7396.png)'
- en: App Sign up process
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 应用程序注册过程
- en: Sign Up with the user Don Hall to see the expected behavior.
  id: totrans-215
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用用户 Don Hall 注册以查看预期的行为。
- en: 'You are logged in, as you can see:'
  id: totrans-216
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您已成功登录，如您所见：
- en: '![](img/e9a4b70e-8372-4786-a6a0-2e6f87bd4bd0.png)'
  id: totrans-217
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e9a4b70e-8372-4786-a6a0-2e6f87bd4bd0.png)'
- en: Successfully logging in to the application
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 成功登录到应用程序
- en: 'Create a test item to test the app''s functionality. This isn''t the critical
    part; we focus on the authentication:'
  id: totrans-219
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个测试项以测试应用程序的功能。这里不是关键部分；我们关注的是身份验证：
- en: '![](img/bd78752e-7abe-43c0-b810-f436937115cf.png)'
  id: totrans-220
  prefs: []
  type: TYPE_IMG
  zh: '![](img/bd78752e-7abe-43c0-b810-f436937115cf.png)'
- en: Task creation dialog
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 任务创建对话框
- en: Try to sign up with your an Azure B2B guest user; you'll need to consent as
    a user to the app.
  id: totrans-222
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 尝试使用 Azure B2B 客户用户注册；您需要作为用户对应用程序进行同意。
- en: 'Use the admin consent in the sign-up process:'
  id: totrans-223
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在注册过程中使用管理员同意：
- en: '![](img/3de6857a-a23e-4b0b-b62a-481696cbd27a.png)'
  id: totrans-224
  prefs: []
  type: TYPE_IMG
  zh: '![](img/3de6857a-a23e-4b0b-b62a-481696cbd27a.png)'
- en: Checking and accepting the OAuth consent
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 检查并接受 OAuth 同意
- en: 'Accept the consent, and you should be logged in:'
  id: totrans-226
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接受同意，您应该已成功登录：
- en: '![](img/96ea2bcc-b340-4e27-b113-80739779c5c2.png)'
  id: totrans-227
  prefs: []
  type: TYPE_IMG
  zh: '![](img/96ea2bcc-b340-4e27-b113-80739779c5c2.png)'
- en: Successfully logging in to the application
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 成功登录到应用程序
- en: Test the application with another user from any Azure AD tenant and you'll get
    the same experience.
  id: totrans-229
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用来自任何 Azure AD 租户的另一个用户测试应用程序，您将获得相同的体验。
- en: Well done! We also see with this multi-tenant application and OpenID Connect
    implementation.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 做得好！我们也看到在这个多租户应用程序和 OpenID Connect 实现中。
- en: 'A final tip: configure the Graph Explorer for your tenant to work with the
    Microsoft Graph API, and gather more information about this topic. Visit [https://developer.microsoft.com/en-us/graph/graph-explorer](https://developer.microsoft.com/en-us/graph/graph-explorer)[ and
    log in as a global admin to your Azure AD:](https://developer.microsoft.com/en-us/graph/graph-explorer)'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 最后的提示：配置 Graph Explorer 以便与您的租户一起使用 Microsoft Graph API，并收集更多关于该主题的信息。访问 [https://developer.microsoft.com/en-us/graph/graph-explorer](https://developer.microsoft.com/en-us/graph/graph-explorer)
    并以全局管理员身份登录您的 Azure AD：
- en: '![](img/01411cae-6f9c-4539-af6d-8c2477cbc9fa.png)'
  id: totrans-232
  prefs: []
  type: TYPE_IMG
  zh: '![](img/01411cae-6f9c-4539-af6d-8c2477cbc9fa.png)'
- en: Microsoft Graph Explorer application
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: Microsoft Graph Explorer 应用程序
- en: With all this experience, you can now start analyzing and extending the solutions.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 凭借这些经验，您现在可以开始分析和扩展解决方案。
- en: Summary
  id: totrans-235
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, you learned about single- and multi-tenant applications and
    the differences between them. You handled both application types in your environment.
    Furthermore, you discovered roles and claims in both application types, so now
    you can provide a **role-based access control** (**RBAC**) scenario. With all
    the other applications you've deployed, you now understand the differences between
    the different protocols, such as SAML2.0, OAuth2 with the different flow types,
    and OpenID Connect. You also learned how the **System for Cross-domain Identity
    Management** (**SCIM**) helps you to provision users (synchronizing) from Azure
    AD to the application.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，您了解了单租户和多租户应用程序及其之间的区别。您已在您的环境中处理了这两种应用程序类型。此外，您还发现了这两种应用程序类型中的角色和声明，因此您现在可以提供**基于角色的访问控制**（**RBAC**）场景。通过您部署的所有其他应用程序，您现在了解了不同协议之间的区别，如
    SAML2.0、不同流类型的 OAuth2 和 OpenID Connect。您还学习了**跨域身份管理系统**（**SCIM**）如何帮助您将用户（同步）从
    Azure AD 提供给应用程序。
- en: In the next chapter, you'll learn how to provide a cloud-based identity management
    life cycle. We'll focus on how to provide secure and usable authentication and
    identity management to your users.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，您将学习如何提供基于云的身份管理生命周期。我们将重点讲解如何为您的用户提供安全且易用的身份验证和身份管理。
