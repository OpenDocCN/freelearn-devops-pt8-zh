- en: Managing Security Groups
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 管理安全组
- en: OpenStack Networking provides two different APIs that can be used to implement
    network traffic filters. The first API, known as the Security Group API, provides
    basic traffic filtering at an instance port level. Security group rules are implemented
    within iptables or as Open vSwitch flow rules on a compute node and filter traffic
    entering or leaving Neutron ports attached to instances. The second API, known
    as the Firewall as a Service API (FWaaS), also implements filtering rules at the
    port level, but extends filtering capabilities to router ports and other ports
    besides those belonging to traditional instances.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: OpenStack 网络提供了两种不同的 API，用于实现网络流量过滤器。第一种 API，称为安全组 API，在实例端口级别提供基本的流量过滤。安全组规则在
    iptables 中或作为 Open vSwitch 流规则在计算节点上实现，并过滤进入或离开 Neutron 端口的流量。第二种 API，称为防火墙即服务
    API（FWaaS），也在端口级别实现过滤规则，但它将过滤能力扩展到路由器端口和其他除传统实例端口外的端口。
- en: 'In this chapter, we will focus on security groups and cover some fundamental
    security features of Neutron, including the following:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将重点介绍安全组，并涵盖 Neutron 的一些基本安全功能，包括以下内容：
- en: A brief introduction to iptables
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: iptables 简介
- en: Creating and managing security groups
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建和管理安全组
- en: Demonstrating traffic flow through iptables
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 演示通过 iptables 的流量流动
- en: Configuring port security
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置端口安全
- en: Managing allowed address pairs
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 管理允许的地址对
- en: Due to its experimental status as of the Pike and Queens releases of OpenStack,
    the `openvswitch` firewall driver will not be discussed in this book.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 由于在 Pike 和 Queens 版本的 OpenStack 中仍处于实验阶段，本书将不讨论 `openvswitch` 防火墙驱动。
- en: Security groups in OpenStack
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: OpenStack 中的安全组
- en: A **security group** is a collection of network access rules known as **security
    group rules** that limit the types of traffic an instance can send or receive.
    When an iptables-based driver is used, security group rules are converted to iptables
    rules that are applied on the `compute` nodes hosting the instances. Each OpenStack
    project is provided with a default security group that can be modified by users
    within the project. OpenStack Networking provides an API for creating, modifying,
    applying, and deleting security groups and rules.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: '**安全组** 是一组网络访问规则，称为 **安全组规则**，它限制了实例可以发送或接收的流量类型。当使用基于 iptables 的驱动时，安全组规则会转换为
    iptables 规则，并应用于托管实例的 `compute` 节点。每个 OpenStack 项目都提供了一个默认的安全组，用户可以在该项目中对其进行修改。OpenStack
    网络提供了一个 API，用于创建、修改、应用和删除安全组及规则。'
- en: There are multiple ways to apply security groups to instances. For example,
    one or more instances, usually of similar functionality or role, can be placed
    in a security group. Security group rules can reference IPv4 and IPv6 hosts and
    networks as well as other security groups. Referencing a particular security group
    in a rule, rather than a particular host or network, frees the user from having
    to specify individual network addresses. Neutron will construct the filtering
    rules applied to the host automatically based on information in the database.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 有多种方法可以将安全组应用于实例。例如，可以将一个或多个实例（通常具有相似的功能或角色）放入一个安全组中。安全组规则可以引用 IPv4 和 IPv6 主机以及网络，还可以引用其他安全组。通过在规则中引用特定的安全组，而不是特定的主机或网络，可以使用户免于指定单独的网络地址。Neutron
    会根据数据库中的信息自动构建应用于主机的过滤规则。
- en: 'Rules within a security group are applied at a port level on the compute node,
    as demonstrated in the following diagram:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 安全组中的规则在计算节点的端口级别应用，如下图所示：
- en: '![](img/5b5f4fd1-977e-436e-8886-0290eee0ba6e.png)'
  id: totrans-13
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5b5f4fd1-977e-436e-8886-0290eee0ba6e.png)'
- en: 'In the preceding diagram, ports within the virtual switch belong to one of
    three security groups: WEB, DB, or APP. When a change is made to a security group,
    such as adding or removing rules to the group, corresponding iptables rule changes
    are made automatically on the `compute` nodes.'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的图示中，虚拟交换机中的端口属于三个安全组之一：WEB、DB 或 APP。当安全组发生变化时，例如添加或删除组内规则，`compute` 节点上的相应
    iptables 规则会自动更新。
- en: Some users may use security groups to describe certain types of rules that should
    be applied to a particular instance port. For example, a security group can be
    used to categorize multiple hosts or subnets that are allowed access to a port.
    Multiple security groups can be applied to a port, and all rules defined in those
    groups are applied to the port. Because all traffic is implicitly denied and security
    group rules define only allowed traffic through a port, there is no chance of
    a rule in one security group applied to a port counteracting a rule in another
    security group applied to the same port.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 一些用户可能会使用安全组来描述应该应用于特定实例端口的某些类型的规则。例如，可以使用安全组来分类允许访问某个端口的多个主机或子网。可以将多个安全组应用于一个端口，并且所有在这些组中定义的规则都会应用到该端口。因为所有流量默认被拒绝，而安全组规则仅定义了通过端口的允许流量，所以不存在一个安全组中的规则与另一个安全组中规则相互冲突的情况。
- en: 'The following example demonstrates the use of security groups to categorize
    traffic that is allowed access through a port:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 以下示例演示了使用安全组对允许通过端口访问的流量进行分类：
- en: '![](img/53ad8a1f-cf17-478b-829c-d64f6bcb292a.png)'
  id: totrans-17
  prefs: []
  type: TYPE_IMG
  zh: '![](img/53ad8a1f-cf17-478b-829c-d64f6bcb292a.png)'
- en: When a port is created in Neutron, it is associated with a default security
    group unless a specific security group is specified. The default security group
    drops all ingress traffic and allows all egress traffic from the associated port.
    Rules can be added to, or removed from, the default security group to change its
    behavior. In addition, baseline port security rules are applied to every port
    that prohibit IP, DHCP, and MAC address spoofing. This behavior can be changed
    and will be discussed later on in this chapter.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 当在Neutron中创建一个端口时，除非指定了特定的安全组，否则它会关联到默认的安全组。默认的安全组会丢弃所有入站流量，并允许所有出站流量通过该端口。可以向默认安全组添加或删除规则，以改变其行为。此外，基础的端口安全规则会应用到每个端口，禁止IP、DHCP和MAC地址欺骗。此行为可以更改，稍后在本章中会讨论。
- en: An introduction to iptables
  id: totrans-19
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Iptables介绍
- en: 'Iptables is a firewall built into Linux that allows a system administrator
    to define tables containing chains of rules that determine how network packets
    should be treated. Packets are processed by sequentially traversing rules in chains
    within the following tables:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: Iptables是Linux内置的防火墙，它允许系统管理员定义包含规则链的表，这些规则链决定了如何处理网络数据包。数据包通过在以下表中依次遍历链中的规则来进行处理：
- en: '**Raw**: This is a default table that filters packets before any other table.
    It is mainly used for rules related to connection tracking.'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Raw**：这是一个默认的表，用于在其他任何表之前过滤数据包。它主要用于与连接跟踪相关的规则。'
- en: '**Filter**: This is a default table for filtering packets.'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Filter**：这是一个默认的表，用于过滤数据包。'
- en: '**NAT**: This is a default table used for network address translation.'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**NAT**：这是一个默认的表，用于网络地址转换。'
- en: '**Mangle**: This is a default table used for specialized packet alteration
    and is not used by the Security Group API.'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Mangle**：这是一个默认的表，用于专门的数据包修改，不会被安全组API使用。'
- en: A rule in a chain can cause a jump to another chain, which, in turn, can jump
    to another chain, and so on. This behavior can be repeated to whatever level of
    nesting is desired. If the traffic does not match the rules of a subchain, the
    system recalls the point at which the jump occurred and returns to that point
    for further processing. When iptables is enabled, every network packet arriving
    at or leaving an interface traverses at least one chain.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 链中的规则可以导致跳转到另一个链，而后者又可以跳转到另一个链，如此循环。这种行为可以根据需要重复任意多级的嵌套。如果流量没有匹配子链中的规则，系统会记住跳转发生的地方，并返回该点继续处理。当启用iptables时，每个到达或离开接口的网络数据包至少会经过一个链。
- en: 'There are five default chains, and the origin of the packet determines which
    chain will be initially traversed. The five default chains include the following:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 有五个默认链，数据包的来源决定了最初会经过哪个链。这五个默认链包括：
- en: '**PREROUTING**: Packets will enter this chain before a routing decision is
    made. The PREROUTING chain is used by the raw, mangle, and NAT tables.'
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**PREROUTING**：数据包将在做出路由决策之前进入此链。PREROUTING链由raw、mangle和NAT表使用。'
- en: '**INPUT**: This is used when a packet is going to be locally delivered to the
    host machine. The INPUT chain is used by the mangle and filter tables.'
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**输入**：当数据包要被本地传递到主机时使用。INPUT链由mangle和filter表使用。'
- en: '**FORWARD**: All packets that have been routed and were not for local delivery
    will traverse this chain. The FORWARD chain is used by the mangle and filter tables.'
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**FORWARD**: 所有路由过的并且不用于本地传递的数据包将通过此链路。FORWARD 链路被 mangle 和 filter 表使用。'
- en: '**OUTPUT**: Packets sent from the host machine itself will traverse this chain.
    The OUTPUT chain is used by the raw, mangle, NAT, and filter tables.'
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**OUTPUT**: 主机本身发送的数据包将通过此链路。OUTPUT 链路被 raw、mangle、NAT 和 filter 表使用。'
- en: '**POSTROUTING**: Packets will enter this chain when a routing decision has
    been made. The POSTROUTING chain is used by the mangle and NAT tables.'
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**POSTROUTING**: 路由决策已经做出后，数据包将进入此链路。POSTROUTING 链路被 mangle 和 NAT 表使用。'
- en: Each rule in a chain contains criteria that packets can be matched against.
    The rule may also contain a target, such as another chain, or a verdict, such
    as DROP or ACCEPT. As a packet traverses a chain, each rule is examined. If a
    rule does not match the packet, the packet is passed to the next rule. If a rule
    does match the packet, the rule takes the action indicated by the target or verdict.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 链路中的每条规则包含数据包可以匹配的标准。规则也可以包含目标，如另一个链路，或者结果，如 DROP 或 ACCEPT。当数据包通过链路时，会检查每条规则。如果规则不匹配数据包，则数据包传递到下一条规则。如果规则匹配数据包，则根据目标或结果执行规则指示的操作。
- en: 'Possible verdicts include the following:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 可能的结果包括以下内容：
- en: '**ACCEPT**: The packet is accepted and sent to the application for processing'
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**ACCEPT**: 数据包被接受并发送到应用程序进行处理'
- en: '**DROP**: The packet is dropped silently'
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**DROP**: 数据包被静默丢弃'
- en: '**REJECT**: The packet is dropped and an error message is sent to the sender'
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**REJECT**: 数据包被丢弃并向发送方发送错误消息'
- en: '**LOG**: The packet details are logged'
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**LOG**: 数据包详细信息被记录'
- en: '**DNAT**: This rewrites the destination IP of the packet'
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**DNAT**: 这会重写数据包的目标 IP'
- en: '**SNAT**: This rewrites the source IP of the packet'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**SNAT**: 这会重写数据包的源 IP'
- en: '**RETURN**: Processing returns to the calling chain'
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**RETURN**: 处理返回到调用链路'
- en: 'The ACCEPT, DROP, and REJECT verdicts are often used by the filter table. Common
    rule criteria include the following:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: ACCEPT、DROP 和 REJECT 结果常被 filter 表使用。常见的规则标准包括以下内容：
- en: '`-p <protocol>`: Matches protocols such as TCP, UDP, ICMP, and more'
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-p <protocol>`: 匹配诸如 TCP、UDP、ICMP 等协议'
- en: '`-s <ip_addr>`: Matches source IP address'
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-s <ip_addr>`: 匹配源 IP 地址'
- en: '`-d <ip_addr>`: Matches destination IP address'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-d <ip_addr>`: 匹配目标 IP 地址'
- en: '`--sport`: Matches source port'
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--sport`: 匹配源端口'
- en: '`--dport`: Matches destination port'
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--dport`: 匹配目标端口'
- en: '`-I <interface>`: Matches the interface from which the packet entered'
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-I <interface>`: 匹配数据包进入的接口'
- en: '`-o <interface>`: Matches the interface from which the packet exits'
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-o <interface>`: 匹配数据包退出的接口'
- en: 'Neutron abstracts the implementation of security group rules from users, but
    understanding how it works is important for operators tasked with troubleshooting
    connectivity. For more information on iptables, please visit the following resources:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: Neutron 从用户那里抽象出安全组规则的实现，但了解其工作原理对于负责故障排除的操作员很重要。有关 iptables 的更多信息，请访问以下资源：
- en: '[https://www.booleanworld.com/depth-guide-iptables-linux-firewall/](https://www.booleanworld.com/depth-guide-iptables-linux-firewall/)'
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://www.booleanworld.com/depth-guide-iptables-linux-firewall/](https://www.booleanworld.com/depth-guide-iptables-linux-firewall/)'
- en: '[https://help.ubuntu.com/community/IptablesHowTo](https://help.ubuntu.com/community/IptablesHowTo)'
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://help.ubuntu.com/community/IptablesHowTo](https://help.ubuntu.com/community/IptablesHowTo)'
- en: Using ipset
  id: totrans-52
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 ipset
- en: In OpenStack releases prior to Juno, for every security group referenced in
    a rule that was created, an exponential number of iptables rules were created
    that corresponded to each source and destination pair of addresses and ports.
    This behavior resulted in poor L2 agent performance as well as race conditions
    where virtual machine instances were connected to the virtual bridge but were
    unable to successfully connect to the network.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Juno 之前的 OpenStack 版本中，为每个规则中引用的安全组创建了指数数量的 iptables 规则，这些规则对应于每个源和目标地址和端口对。这种行为导致
    L2 代理性能差，并且存在虚拟机实例连接到虚拟桥但无法成功连接到网络的竞争条件。
- en: Beginning with the Juno release, the ipset extension to iptables is utilized
    in an attempt to reduce the number of iptables rules required by creating groups
    of addresses and ports that are stored efficiently for fast lookup.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 从 Juno 版本开始，iptables 的 ipset 扩展被用于尝试通过创建地址和端口的组进行高效存储以减少所需的 iptables 规则数量。
- en: 'Without ipset, iptables rules that allow connections on port `80` to a set
    of web instances may resemble the following:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 如果没有 ipset，允许连接到端口 `80` 的 iptables 规则可能如下所示：
- en: '[PRE0]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The match syntax `-d x.x.x.x` in the preceding code means "match packets whose
    destination address is `x.x.x.x`". To allow all four addresses, four separate
    iptables rules with four separate match specifications must be defined.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 上述代码中的匹配语法 `-d x.x.x.x` 表示“匹配目标地址为 `x.x.x.x` 的数据包”。为了允许所有四个地址，必须定义四条独立的 iptables
    规则，每条规则包含一个独立的匹配规范。
- en: 'Alternatively, a combination of `ipset` and `iptables` commands can be used
    to achieve the same result:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，可以使用 `ipset` 和 `iptables` 命令的组合来实现相同的结果：
- en: '[PRE1]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: The `ipset` command creates a new set, a webset, with four addresses. The `iptables`
    command references the set with `--m set --match-set webset dst`, which means
    "match packets whose destination matches an entry within the set named webset".
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: '`ipset` 命令创建一个新的集合，名为 webset，其中包含四个地址。`iptables` 命令通过 `--m set --match-set
    webset dst` 引用该集合，表示“匹配目标地址与名为 webset 的集合中的某个条目相匹配的包”。'
- en: By using an ipset, only one rule is required to accomplish what previously took
    four rules. The savings are small in this example, but as instances are added
    to security groups and security group rules are configured, the reduction in rules
    has a noticeable impact on performance and reliability.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 通过使用 ipset，只需一条规则即可完成之前需要四条规则才能完成的任务。虽然在这个例子中节省的规则很少，但随着实例被添加到安全组并且安全组规则配置的增多，规则的减少对性能和可靠性的影响会变得非常明显。
- en: Working with security groups
  id: totrans-62
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 管理安全组
- en: Security groups can be managed using the Neutron ReST API, the OpenStack CLI,
    or the Horizon dashboard. Both methods offer a pretty complete experience and
    are discussed in the following sections.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 安全组可以通过 Neutron ReST API、OpenStack CLI 或 Horizon 仪表板进行管理。两种方法都提供了相当完整的体验，以下部分将详细讨论。
- en: Managing security groups in the CLI
  id: totrans-64
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在 CLI 中管理安全组
- en: 'From within the OpenStack command-line client, a number of commands can be
    used to manage security groups. The primary commands associated with security
    group management that will be discussed in this chapter are listed in the following
    table:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 在 OpenStack 命令行客户端中，可以使用多个命令来管理安全组。本章将讨论与安全组管理相关的主要命令，以下表格列出了这些命令：
- en: '| **Security Group Commands** | Description |'
  id: totrans-66
  prefs: []
  type: TYPE_TB
  zh: '| **安全组命令** | 描述 |'
- en: '| `security group create` | Creates a new security group |'
  id: totrans-67
  prefs: []
  type: TYPE_TB
  zh: '| `security group create` | 创建一个新的安全组 |'
- en: '| `security group delete` | Deletes security group(s) |'
  id: totrans-68
  prefs: []
  type: TYPE_TB
  zh: '| `security group delete` | 删除安全组 |'
- en: '| `security group list` | Lists security group(s) |'
  id: totrans-69
  prefs: []
  type: TYPE_TB
  zh: '| `security group list` | 列出安全组 |'
- en: '| `security group rule create` | Creates a new security group rule |'
  id: totrans-70
  prefs: []
  type: TYPE_TB
  zh: '| `security group rule create` | 创建一个新的安全组规则 |'
- en: '| `security group rule delete` | Deletes security group rule(s) |'
  id: totrans-71
  prefs: []
  type: TYPE_TB
  zh: '| `security group rule delete` | 删除安全组规则 |'
- en: '| `security group rule list` | Lists security group rules |'
  id: totrans-72
  prefs: []
  type: TYPE_TB
  zh: '| `security group rule list` | 列出安全组规则 |'
- en: '| `security group rule show` | Displays security group rule details |'
  id: totrans-73
  prefs: []
  type: TYPE_TB
  zh: '| `security group rule show` | 显示安全组规则详情 |'
- en: '| `security group set` | Sets security group properties |'
  id: totrans-74
  prefs: []
  type: TYPE_TB
  zh: '| `security group set` | 设置安全组属性 |'
- en: '| `security group show` | Displays security group details |'
  id: totrans-75
  prefs: []
  type: TYPE_TB
  zh: '| `security group show` | 显示安全组详情 |'
- en: '| `server add security group` | Adds a security group to a server |'
  id: totrans-76
  prefs: []
  type: TYPE_TB
  zh: '| `server add security group` | 向服务器添加安全组 |'
- en: '| `server remove security group` | Removes a security group from a server |'
  id: totrans-77
  prefs: []
  type: TYPE_TB
  zh: '| `server remove security group` | 从服务器中移除安全组 |'
- en: Creating security groups in the CLI
  id: totrans-78
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在 CLI 中创建安全组
- en: 'To create a security group, use the `openstack security group create` command
    as follows:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建一个安全组，请使用 `openstack security group create` 命令，格式如下：
- en: '[PRE2]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: By default, security groups in Neutron are pre-populated with two egress rules
    that allow all outbound traffic over IPv4 and IPv6\. Inbound traffic is not permitted
    by default.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Neutron 中的安全组已预填充了两条出站规则，允许所有 IPv4 和 IPv6 的出站流量。默认情况下不允许入站流量。
- en: Deleting security groups in the CLI
  id: totrans-82
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在 CLI 中删除安全组
- en: 'To delete a security group, use the `openstack security group delete` command
    and specify the ID or name of the security group:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 要删除一个安全组，请使用 `openstack security group delete` 命令，并指定安全组的 ID 或名称：
- en: '[PRE3]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'To delete a security group named `MySampleSecGrp`, you can enter the following
    command:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 要删除名为 `MySampleSecGrp` 的安全组，可以输入以下命令：
- en: '[PRE4]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Alternatively, you can use the group''s ID:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 另外，你可以使用该安全组的 ID：
- en: '[PRE5]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Multiple security groups can also be deleted simultaneously, as follows:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 也可以同时删除多个安全组，如下所示：
- en: '[PRE6]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Neutron will successfully delete the security group(s) as long as ports utilizing
    the group(s) have been deleted prior to the request.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 只要使用该安全组的端口在请求之前已经被删除，Neutron将成功删除安全组。
- en: Listing security groups in the CLI
  id: totrans-92
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在CLI中列出安全组
- en: 'To obtain a listing of security groups, use the `openstack security group list`
    command as follows:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 要获取安全组列表，请使用以下`openstack security group list`命令：
- en: '[PRE7]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: The output returned includes the ID, name, and description of all security groups
    associated with the scoped or specified project. If run as a user with the admin
    role, all security groups across all projects will be listed.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 返回的输出包括与指定项目相关联的所有安全组的ID、名称和描述。如果以具有管理员角色的用户身份运行，将列出所有项目的所有安全组。
- en: Showing the details of a security group in the CLI
  id: totrans-96
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在CLI中显示安全组的详细信息
- en: 'To display the details of a security group, use the `openstack security group
    show` command, as shown here:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 要显示安全组的详细信息，请使用`openstack security group show`命令，如下所示：
- en: '[PRE8]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Either the name or the ID of the security group can be specified. The output
    returned includes the description, ID, name, associated project ID, and the individual
    rules within the security group.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 可以指定安全组的名称或ID。返回的输出包括描述、ID、名称、关联的项目ID以及安全组内的各个规则。
- en: Updating security groups in the CLI
  id: totrans-100
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在CLI中更新安全组
- en: 'To update the attributes of a security group, use the `openstack security group
    set` command as follows:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 要更新安全组的属性，请使用以下`openstack security group set`命令：
- en: '[PRE9]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Attempting to modify the name of a default security group will result in an
    error.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 尝试修改默认安全组的名称会导致错误。
- en: Creating security group rules in the CLI
  id: totrans-104
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在CLI中创建安全组规则
- en: 'To create a security group rule, use the `openstack security group rule create`
    command as follows:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建安全组规则，请使用以下`openstack security group rule create`命令：
- en: '[PRE10]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: The `--remote-ip` argument is optional and allows you to specify the source
    address or network the rule applies to. The address or network should be defined
    in CIDR format.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: '`--remote-ip`参数是可选的，允许您指定规则适用的源地址或网络。地址或网络应使用CIDR格式定义。'
- en: The `--remote-group` argument is optional and allows you to specify the name
    or ID of a security group the rule should apply to rather than individual IP addresses
    or networks. For example, when creating a rule to allow inbound SQL traffic to
    database servers, you can specify the ID of a security group that application
    servers are a member of without having to specify their individual IP addresses.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: '`--remote-group`参数是可选的，允许您指定规则应适用于的安全组的名称或ID，而不是单个IP地址或网络。例如，在创建允许SQL流量进入数据库服务器的规则时，您可以指定应用服务器所在安全组的ID，而无需指定它们的单个IP地址。'
- en: The `--description` argument applies a description to the security group rule.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: '`--description`参数用于为安全组规则添加描述。'
- en: The `--dst-port` argument is optional and allows you to specify a destination
    port or range of ports separated by a colon, as in 137:139\. This option is required
    for TCP and UDP protocols.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: '`--dst-port`参数是可选的，允许您指定目标端口或端口范围，端口范围之间用冒号分隔，如137:139\。此选项对于TCP和UDP协议是必需的。'
- en: The `--icmp-type` and `--icmp-code` arguments specify the ICMP type and code,
    respectively, for ICMP IP protocols. Allowing the entire ICMP protocol without
    specific types and codes satisfies most use cases.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: '`--icmp-type`和`--icmp-code`参数分别指定ICMP类型和代码，用于ICMP IP协议。在没有特定类型和代码的情况下允许整个ICMP协议可以满足大多数使用场景。'
- en: The `--protocol` argument is optional and allows you to match traffic based
    on the IP protocol. Possible options include ah, dccp, egp, esp, gre, icmp, igmp,
    ipv6-encap, ipv6-frag, ipv6-icmp, ipv6-nonxt, ipv6-opts, ipv6-route, ospf, pgm,
    rsvp, sctp, tcp, udp, udplite, vrrp or an IP protocol number [0-255]. The default
    is tcp.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: '`--protocol`参数是可选的，允许您根据IP协议匹配流量。可能的选项包括ah、dccp、egp、esp、gre、icmp、igmp、ipv6-encap、ipv6-frag、ipv6-icmp、ipv6-nonxt、ipv6-opts、ipv6-route、ospf、pgm、rsvp、sctp、tcp、udp、udplite、vrrp或一个IP协议号[0-255]。默认值是tcp。'
- en: The `--ingress` argument means that the rule applies to incoming traffic, whereas
    the `--egress` argument means that the rule applies to outgoing traffic from the
    instance. These arguments are mutually exclusive, meaning only one can be used
    to describe the rule's direction. If left unspecified, the default direction is
    ingress.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: '`--ingress`参数表示该规则适用于传入流量，而`--egress`参数表示该规则适用于实例的传出流量。这两个参数是互斥的，意味着只能使用其中一个来描述规则的方向。如果未指定，默认方向为传入（ingress）。'
- en: The `--ethertype` argument is optional and allows you to specify whether the
    rule applies to IPv4 or IPv6 traffic.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: '`--ethertype`参数是可选的，允许你指定规则是适用于IPv4还是IPv6流量。'
- en: The `--project` and `--project-domain` arguments are optional and can be used
    to specify a project and domain other than the one associated with the user creating
    the rule.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: '`--project`和`--project-domain`参数是可选的，可用于指定与创建规则的用户关联的其他项目和域。'
- en: The group argument is used to specify the name or ID of the security group the
    rule should be associated with.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: '`group`参数用于指定规则应该关联的安全组的名称或ID。'
- en: Deleting security group rules in the CLI
  id: totrans-117
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在CLI中删除安全组规则
- en: 'To delete a security group rule, use the `openstack security group rule delete`
    command and specify the ID or name of the security group rule:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 要删除安全组规则，请使用`openstack security group rule delete`命令，并指定安全组规则的ID或名称：
- en: '[PRE11]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'To delete a security group named `MySampleSecGrpRule80`, you can enter the
    following command:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 要删除名为`MySampleSecGrpRule80`的安全组，可以输入以下命令：
- en: '[PRE12]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Multiple security groups can also be deleted simultaneously, like so:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 也可以同时删除多个安全组，如下所示：
- en: '[PRE13]'
  id: totrans-123
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: While it is possible to delete the rules within the default security group,
    it is not possible to delete the group itself.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然可以删除默认安全组中的规则，但无法删除该安全组本身。
- en: Listing security group rules in the CLI
  id: totrans-125
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在CLI中列出安全组规则
- en: 'To obtain a listing of security group rules and associated security groups,
    use the `openstack security group rule list` command, as follows:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 要获取安全组规则及其关联的安全组的列表，请使用`openstack security group rule list`命令，如下所示：
- en: '[PRE14]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: All arguments are optional but can be used to filter results. The output returned
    includes the ID, protocol, IP range, remote security group, and associated security
    group for all security group rules associated with the scoped project. Specifying
    `--long` will provide additional details not available in the standard output,
    including direction and ether type. If run as a user with the admin role, all
    security group rules across all projects will be listed.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 所有参数都是可选的，但可以用来过滤结果。返回的输出包括与作用域项目相关的所有安全组规则的ID、协议、IP范围、远程安全组和关联的安全组。如果指定`--long`，将提供标准输出中没有的附加详细信息，包括方向和以太类型。如果以管理员角色运行，所有项目中的所有安全组规则都将列出。
- en: Showing the details of a security group rule in the CLI
  id: totrans-129
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在CLI中显示安全组规则的详细信息
- en: 'To display the details of a security group rule, use the `openstack security
    group rule show` command, as shown here:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 要显示安全组规则的详细信息，请使用`openstack security group rule show`命令，如下所示：
- en: '[PRE15]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Applying security groups to instances and ports
  id: totrans-132
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将安全组应用于实例和端口
- en: 'Applying security groups to instances within the CLI is typically done at instance
    creation using the `openstack server create` command that''s shown here:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 在CLI中将安全组应用于实例通常是在实例创建时完成，使用`openstack server create`命令，如下所示：
- en: '[PRE16]'
  id: totrans-134
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Security groups can also be applied to running instances by using either the
    `openstack port set` or the `openstack server add security group` commands. The
    following examples demonstrate the use of the `openstack port set` command to
    apply security groups to a port.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 通过使用`openstack port set`或`openstack server add security group`命令，也可以将安全组应用于正在运行的实例。以下示例演示了使用`openstack
    port set`命令将安全组应用于端口。
- en: 'In this example, the security group will be applied to the port, and the associated
    rules will be implemented immediately:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 在此示例中，安全组将应用于端口，相关规则将立即生效：
- en: '[PRE17]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Multiple security groups can be associated with a port simultaneously. To apply
    multiple security groups to a port, use the `--security-group` argument before
    each security group, as shown here:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 一个端口可以同时关联多个安全组。要将多个安全组应用于端口，请在每个安全组之前使用`--security-group`参数，如下所示：
- en: '[PRE18]'
  id: totrans-139
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'The following example demonstrates the use of the `openstack server add group`
    command to apply a security group to an instance:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 以下示例演示了使用`openstack server add group`命令将安全组应用于实例：
- en: '[PRE19]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Because a port cannot be specified as part of the command, the security group
    will be applied to all ports associated with the instance.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 由于命令中不能指定端口，因此安全组将应用于与实例关联的所有端口。
- en: Removing security groups from instances and ports in the CLI
  id: totrans-143
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在CLI中从实例和端口中移除安全组
- en: 'To remove an individual security group, use the `openstack server remove security
    group` command, as shown in the following example:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 要移除单个安全组，请使用`openstack server remove security group`命令，如以下示例所示：
- en: '[PRE20]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Alternatively, you can use the `openstack port unset command` to remove the
    group from a port:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 另外，您可以使用`openstack port unset`命令将安全组从端口中移除：
- en: '[PRE21]'
  id: totrans-147
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'To remove all security groups from a port, including the default group, use
    the `openstack port set` command with the `--no-security-group` argument, as shown
    in the following example:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 要从端口中移除所有安全组，包括默认组，请使用带有`--no-security-group`参数的`openstack port set`命令，如下所示：
- en: '[PRE22]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: Implementing security group rules
  id: totrans-150
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 实施安全组规则
- en: 'In the following example, an instance named WEB1 has been created that acts
    as a web server running Apache on ports 80 and 443\. Making a request to the web
    server at 192.168.206.6:80 eventually times out:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下示例中，创建了一个名为WEB1的实例，该实例作为Web服务器运行Apache，监听端口80和443。向192.168.206.6:80发起请求最终超时：
- en: '![](img/25a895c4-7704-419e-9e11-19b1a6e1e4cb.png)'
  id: totrans-152
  prefs: []
  type: TYPE_IMG
  zh: '![](img/25a895c4-7704-419e-9e11-19b1a6e1e4cb.png)'
- en: 'To demonstrate how security group rules are implemented on a compute node,
    take note of the following WEB_SERVERS security group:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 为了演示如何在计算节点上实现安全组规则，请注意以下WEB_SERVERS安全组：
- en: '![](img/5a3f7aa0-bf48-4f59-9685-440c9bfc52ec.png)'
  id: totrans-154
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5a3f7aa0-bf48-4f59-9685-440c9bfc52ec.png)'
- en: 'The following screenshot demonstrates two security group rules being added
    to the WEB_SERVERS security group using the `openstack security group rule create`
    command. The rules allow inbound connections on ports 80 and 443 from any remote
    host, as defined by the CIDR 0.0.0.0/0:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图展示了使用`openstack security group rule create`命令将两条安全组规则添加到WEB_SERVERS安全组。这些规则允许来自任何远程主机通过端口80和443的入站连接，CIDR为0.0.0.0/0：
- en: '![](img/a62285ab-81b3-4c62-9334-974a74acf74a.png)'
  id: totrans-156
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a62285ab-81b3-4c62-9334-974a74acf74a.png)'
- en: 'Using the `openstack server add security group` command, the WEB_SERVERS security
    group can be applied to the WEB1 instance, as shown in the following screenshot:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`openstack server add security group`命令，可以将WEB_SERVERS安全组应用到WEB1实例，如下所示：
- en: '![](img/d340f90e-1db7-443e-9472-e4ec63190846.png)'
  id: totrans-158
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d340f90e-1db7-443e-9472-e4ec63190846.png)'
- en: 'Once a security group has been applied to the corresponding port of an instance,
    a series of iptables rules and chains are implemented on the compute node hosting
    the instance. A quick connectivity check shows that the rule(s) work as expected:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦安全组被应用到实例的相应端口，计算节点上会实施一系列的iptables规则和链。快速的连接性检查表明这些规则按预期工作：
- en: '![](img/9a74f15b-9c85-4bf4-ba09-a95ba7148267.png)'
  id: totrans-160
  prefs: []
  type: TYPE_IMG
  zh: '![](img/9a74f15b-9c85-4bf4-ba09-a95ba7148267.png)'
- en: Stepping through the chains
  id: totrans-161
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 逐步执行链
- en: The implementation of security group rules using iptables is similar in both
    Linux bridge and Open vSwitch-based environments. On `compute01`, a compute node
    running the Linux bridge agent and hosting the instance in this example, shows
    that iptables rules applied by the Neutron agent can be observed using the `iptables-save`
    or `iptables -L` commands.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 在Linux桥接和Open vSwitch环境中，使用iptables实施安全组规则的方式是类似的。在`compute01`上，作为本示例中的计算节点，运行Linux桥接代理并托管实例，显示通过Neutron代理应用的iptables规则，可以使用`iptables-save`或`iptables
    -L`命令观察到。
- en: 'For readability, only the raw and filter tables of rules related to the instance
    are shown in the following screenshot. Some comments have been removed or truncated
    to fit the page:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 为了提高可读性，以下截图仅显示与实例相关的原始表和过滤器表中的规则。一些注释已被删除或缩短以适应页面：
- en: '![](img/cc6c710c-f8a2-4641-a1ae-e4192a0a5db6.png)'
  id: totrans-164
  prefs: []
  type: TYPE_IMG
  zh: '![](img/cc6c710c-f8a2-4641-a1ae-e4192a0a5db6.png)'
- en: 'First, the PREROUTING chain of the raw table is consulted. In the PREROUTING
    chain, we can find rules associating traffic traversing an instance''s interface
    and/or related network to specific conntrack zone(s):'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，查询原始表（raw table）的PREROUTING链。在PREROUTING链中，我们可以找到将流量与实例接口和/或相关网络关联到特定conntrack区域的规则：
- en: '![](img/e8a06af4-d54b-4be7-aaae-41831a86a6ac.png)'
  id: totrans-166
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e8a06af4-d54b-4be7-aaae-41831a86a6ac.png)'
- en: Each Neutron network corresponds to a conntrack zone, which further helps distinguish
    traffic in the case of overlapping address space between projects. Conntrack is
    one piece of the Connection Tracking System and is utilized by iptables when performing
    stateful packet inspection.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 每个Neutron网络对应一个conntrack区域，这有助于在项目之间的地址空间重叠时区分流量。Conntrack是连接跟踪系统的一部分，iptables在执行有状态数据包检查时使用它。
- en: 'Next, network traffic may traverse the INPUT chain of the filter table as follows:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，网络流量可能会穿越过滤器表中的INPUT链，如下所示：
- en: '[PRE23]'
  id: totrans-169
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'This rule jumps to a chain named neutron-linuxbri-INPUT, as shown here:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 该规则跳转到一个名为neutron-linuxbri-INPUT的链，如下所示：
- en: '[PRE24]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'The rule states that traffic leaving the instance through the `tapadcc4b66-c1` interface
    should be forwarded to the `neutron-linuxbri-oadcc4b66-c` chain, as shown here:'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 该规则表示，流量通过 `tapadcc4b66-c1` 接口离开实例时，应转发到 `neutron-linuxbri-oadcc4b66-c` 链，如下所示：
- en: '![](img/0f8794a8-be34-44e6-8fdb-6bf64e98d4fb.png)'
  id: totrans-173
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0f8794a8-be34-44e6-8fdb-6bf64e98d4fb.png)'
- en: The rules of the `neutron-linuxbri-oadcc4b66-c` chain states that outgoing DHCP
    traffic should only be allowed when the client is attempting to obtain an address
    from a DHCP server. By default, instances are not allowed to act as DHCP servers
    and traffic will be dropped accordingly. The rules also state that traffic marked
    as RETURN or ESTABLISHED will be allowed, but INVALID packets will be dropped.
    Lastly, any traffic that does not match is dropped by a rule in the `neutron-linuxbri-sg-fallback`
    chain.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: '`neutron-linuxbri-oadcc4b66-c` 链的规则规定，只有在客户端试图从 DHCP 服务器获取地址时，才允许外发的 DHCP 流量。默认情况下，实例不允许作为
    DHCP 服务器，流量会被相应丢弃。规则还规定，标记为 RETURN 或 ESTABLISHED 的流量将被允许，但 INVALID 数据包将被丢弃。最后，任何不匹配的流量将被
    `neutron-linuxbri-sg-fallback` 链中的规则丢弃。'
- en: Iptables may process traffic using the INPUT or FORWARD chains depending on
    the destination address and whether it is local to the node or not. In most cases,
    the FORWARD chains will be used instead.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: Iptables 可能会根据目的地址以及是否本地化于节点来使用 INPUT 或 FORWARD 链处理流量。在大多数情况下，将使用 FORWARD 链。
- en: 'If traffic has survived the INPUT chains, it then moves on to the FORWARD chains
    seen here:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 如果流量已经通过了 INPUT 链，则会继续进入下图所示的 FORWARD 链：
- en: '![](img/e8419d27-1788-49cd-bf6a-1e27f2a1bfe1.png)'
  id: totrans-177
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e8419d27-1788-49cd-bf6a-1e27f2a1bfe1.png)'
- en: The first rule causes iptables to jump to the neutron-filter-top chain. From
    there, iptables jumps to the `neutron-linuxbri-local` chain for further processing.
    Because there are no rules defined in that chain, iptables returns to the calling
    chain, `neutron-filter-top`. Once all rules have been processed, iptables returns
    to the previous calling chain, FORWARD.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 第一条规则使 iptables 跳转到 neutron-filter-top 链。之后，iptables 跳转到 `neutron-linuxbri-local`
    链进行进一步处理。因为该链中没有定义规则，所以 iptables 会返回到调用链 `neutron-filter-top`。一旦所有规则被处理完毕，iptables
    会返回到之前的调用链，FORWARD。
- en: 'The next rule in the FORWARD chain that is processed is as follows:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: FORWARD 链中接下来处理的规则如下：
- en: '[PRE25]'
  id: totrans-180
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'The mentioned rule causes iptables to jump to the `neutron-linuxbri-FORWARD`
    chain seen here:'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 上述规则使 iptables 跳转到下图所示的 `neutron-linuxbri-FORWARD` 链：
- en: '![](img/0441d2b5-9580-4b5b-8d36-4070be4f4e97.png)'
  id: totrans-182
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0441d2b5-9580-4b5b-8d36-4070be4f4e97.png)'
- en: The `-m` flag followed by `physdev` is a directive to iptables to use an extended
    `packet matching` module that supports devices enslaved to a bridge device.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: '`-m` 标志后跟 `physdev` 是指示 iptables 使用一个扩展的 `packet matching` 模块，该模块支持绑定到桥接设备的设备。'
- en: 'Remember: When the Linux bridge agent is used, tap interfaces for instances
    are connected to network bridges prefaced with brq-*. When the OVS agent is used,
    the tap interfaces are connected to their own Linux bridge prefaced with qbr-*.'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住：当使用 Linux 桥接代理时，实例的 tap 接口会连接到以 brq-* 为前缀的网络桥接器。当使用 OVS 代理时，tap 接口连接到其自己的
    Linux 桥接器，前缀为 qbr-*。
- en: 'The packet will match one of the two rules based on the direction the packet
    is headed through the interface. In either case, iptables jumps to the `neutron-linuxbri-sg-chain`
    chain, as shown here:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 数据包将根据其通过接口的方向匹配两个规则之一。在任何情况下，iptables 都会跳转到 `neutron-linuxbri-sg-chain` 链，如下所示：
- en: '![](img/aba61ace-b5f2-44da-b29d-7c1ea48bad73.png)'
  id: totrans-186
  prefs: []
  type: TYPE_IMG
  zh: '![](img/aba61ace-b5f2-44da-b29d-7c1ea48bad73.png)'
- en: 'The direction of the packet will again dictate which rule is matched. Traffic
    centering the instance through the `tapadcc4b66-c1` interface will be processed
    by the `neutron-linuxbri-iadcc4b66-c` chain as follows:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 数据包的方向将再次决定匹配的规则。通过 `tapadcc4b66-c1` 接口流向实例的流量将由 `neutron-linuxbri-iadcc4b66-c`
    链处理，如下所示：
- en: '![](img/3f98afd1-0c5b-40e8-8e95-c613dd8a1371.png)'
  id: totrans-188
  prefs: []
  type: TYPE_IMG
  zh: '![](img/3f98afd1-0c5b-40e8-8e95-c613dd8a1371.png)'
- en: The name of a security group chain corresponds to the first 9 characters of
    the UUID of the Neutron port of which it is associated.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 安全组链的名称与其关联的 Neutron 端口的 UUID 的前 9 个字符对应。
- en: 'In the mentioned rule, iptables uses the state module to determine the state
    of the packet. Combined with connection tracking, iptables is able to track the
    connection and determine the following states of the packet: INVALID, NEW, RELATED,
    or ESTABLISHED. The state of the packet results in an appropriate action being
    taken. Traffic not matched by any rule is dropped by the `neutron-linuxbri-sg-fallback`
    chain:'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 在上述规则中，iptables使用`state`模块来确定数据包的状态。结合连接追踪，iptables能够跟踪连接并确定数据包的以下状态：INVALID、NEW、RELATED或ESTABLISHED。数据包的状态将决定采取相应的措施。未匹配任何规则的流量将被`neutron-linuxbri-sg-fallback`链丢弃：
- en: '[PRE26]'
  id: totrans-191
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Traffic exiting the instance through the `tapadcc4b66-c1` interface is processed
    by the `neutron-linuxbri-oadcc4b66-c` chain as follows:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 通过`tapadcc4b66-c1`接口退出实例的流量将由`neutron-linuxbri-oadcc4b66-c`链按照以下方式处理：
- en: '![](img/ecde14dc-b778-4099-87ea-572404d5add8.png)'
  id: totrans-193
  prefs: []
  type: TYPE_IMG
  zh: '![](img/ecde14dc-b778-4099-87ea-572404d5add8.png)'
- en: 'The first UDP rule allows the instance to send `DHCPDISCOVER` and `DHCPREQUEST`
    broadcast packets on UDP port 67\. All other traffic is then processed by the
    `neutron-linuxbri-sadcc4b66-c` chain as follows:'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个UDP规则允许实例在UDP端口67上发送`DHCPDISCOVER`和`DHCPREQUEST`广播包。所有其他流量将由`neutron-linuxbri-sadcc4b66-c`链按照以下方式处理：
- en: '![](img/5df28e2e-ade4-4a72-92e6-8c93a0b386ef.png)'
  id: totrans-195
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5df28e2e-ade4-4a72-92e6-8c93a0b386ef.png)'
- en: The preceding rule prevents an instance from performing IP and MAC address spoofing.
    Any traffic exiting the `tapadcc4b66-c1` interface must be sourced from IP address `192.168.206.6/32` and
    MAC address `FA:16:3E:DC:D2:AB`. To permit outbound traffic from additional IP
    or MAC addresses, use the Neutron `allowed-address-pairs `extension, which will
    be discussed later on in this chapter.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 上述规则防止实例进行IP和MAC地址欺骗。所有通过`tapadcc4b66-c1`接口的流量必须来自IP地址`192.168.206.6/32`和MAC地址`FA:16:3E:DC:D2:AB`。要允许来自其他IP或MAC地址的出站流量，请使用Neutron的`allowed-address-pairs`扩展，稍后本章将讨论该扩展。
- en: 'Further processing includes preventing DHCP spoofing and verifying the state
    of the packet and performing the appropriate action. Traffic eventually returns
    to the `neutron-linuxbri-sg-chain`, calling chain where it is allowed through:'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 后续处理包括防止DHCP欺骗并验证数据包状态，执行相应的操作。流量最终返回到`neutron-linuxbri-sg-chain`链，在此链中流量被允许通过：
- en: '[PRE27]'
  id: totrans-198
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: Working with security groups in the dashboard
  id: totrans-199
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在仪表板中使用安全组
- en: 'Within the Horizon dashboard, security groups are managed within the Security
    Groups section under the Network tab:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 在Horizon仪表板中，安全组在“网络”标签下的“安全组”部分进行管理：
- en: '![](img/76fe940b-3a37-4493-b60e-d923c9f8ba7b.png)'
  id: totrans-201
  prefs: []
  type: TYPE_IMG
  zh: '![](img/76fe940b-3a37-4493-b60e-d923c9f8ba7b.png)'
- en: Creating a security group
  id: totrans-202
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建安全组
- en: To create a security group, perform the following steps.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建安全组，请执行以下步骤。
- en: 'Click on the Create Security Group button in the upper right-hand corner of
    the screen. A window will appear that will allow you to create a security group:'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 点击屏幕右上角的“创建安全组”按钮。将弹出一个窗口，允许您创建安全组：
- en: '![](img/8621c7f9-81a8-4dd4-afaf-1c0976e1d521.png)'
  id: totrans-205
  prefs: []
  type: TYPE_IMG
  zh: '![](img/8621c7f9-81a8-4dd4-afaf-1c0976e1d521.png)'
- en: The Name field is required. When you are ready to proceed, click on the blue
    Create Security Group button to create the security group.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: “名称”字段是必填项。当您准备好继续时，请点击蓝色的“创建安全组”按钮以创建安全组。
- en: Managing security group rules
  id: totrans-207
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 管理安全组规则
- en: 'Once created, you will be returned to the Security Groups section where you
    can add rules to the security group by clicking the Manage Rules button of the
    corresponding group:'
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 创建完成后，您将返回到“安全组”部分，您可以通过点击相应组的“管理规则”按钮来添加规则：
- en: '![](img/c24447b8-7283-4515-8085-89ed12eeccf9.png)'
  id: totrans-209
  prefs: []
  type: TYPE_IMG
  zh: '![](img/c24447b8-7283-4515-8085-89ed12eeccf9.png)'
- en: 'To delete a rule, click the red Delete Rule button next to the corresponding
    security group rule. To add a rule, click on the Add Rule button in the upper
    right-hand corner:'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 要删除规则，请点击相应安全组规则旁边的红色“删除规则”按钮。要添加规则，请点击右上角的“添加规则”按钮：
- en: '![](img/75971aea-b8de-4ee6-82f8-36e3460778b1.png)'
  id: totrans-211
  prefs: []
  type: TYPE_IMG
  zh: '![](img/75971aea-b8de-4ee6-82f8-36e3460778b1.png)'
- en: 'A window will appear that will allow you to create rules. Within the rule list,
    you can choose from a predefined list of protocols or create a custom rule as
    follows:'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 将弹出一个窗口，允许您创建规则。在规则列表中，您可以从预定义的协议列表中选择，或按照以下方式创建自定义规则：
- en: '![](img/3eef5604-6c1d-4070-a8d0-7d0b79705a6f.png)'
  id: totrans-213
  prefs: []
  type: TYPE_IMG
  zh: '![](img/3eef5604-6c1d-4070-a8d0-7d0b79705a6f.png)'
- en: The wizard allows you to specify the direction, port or range of ports, and
    the remote network or group. To complete the rule creation process, click on the
    blue Add button.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 向导允许您指定方向、端口或端口范围，以及远程网络或组。要完成规则创建过程，请点击蓝色的“添加”按钮。
- en: Applying security groups to instances
  id: totrans-215
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将安全组应用于实例
- en: 'To apply a security group to an instance, return to the Instances section of
    the Compute panel. Click on the arrow under the Actions menu next to the instance
    and choose Edit Security Groups:'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 要向实例应用安全组，请返回计算面板的实例部分。单击实例旁边操作菜单下的箭头，并选择编辑安全组：
- en: '![](img/d3eb7f7d-6c97-4dc0-b876-c41c17579249.png)'
  id: totrans-217
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d3eb7f7d-6c97-4dc0-b876-c41c17579249.png)'
- en: 'A window will appear that allows you to apply or remove security groups from
    an instance. Hit the blue plus sign next to the group to apply it to an instance:'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 将出现一个窗口，允许您向实例应用或移除安全组。点击组旁边的蓝色加号将其应用到实例。
- en: '![](img/23ea1f07-7a34-456c-af12-c423a37a308e.png)'
  id: totrans-219
  prefs: []
  type: TYPE_IMG
  zh: '![](img/23ea1f07-7a34-456c-af12-c423a37a308e.png)'
- en: 'Once clicked, the group will move to the Instance Security Groups column, as
    shown in the following screenshot:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 单击后，组将移动到实例安全组列，如下截图所示：
- en: '![](img/51b1ef6a-9e33-4636-bd1f-852e466f9a4a.png)'
  id: totrans-221
  prefs: []
  type: TYPE_IMG
  zh: '![](img/51b1ef6a-9e33-4636-bd1f-852e466f9a4a.png)'
- en: Click on the blue Save button to apply the changes to the instance.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 单击蓝色保存按钮以应用更改到实例。
- en: Disabling port security
  id: totrans-223
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 禁用端口安全
- en: By default, Neutron applies anti-spoofing rules to all ports to ensure that
    unexpected or undesired traffic cannot originate from or pass through a port.
    This includes rules that prohibit instances from running DHCP servers or from
    acting as routers. To address the latter, the `allowed-address-pairs` extension
    can be used to allow additional IPs, subnets, and MAC addresses through the port.
    However, additional functionality may be required that cannot be addressed by
    the `allowed-address-pairs` extension.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Neutron对所有端口应用反欺骗规则，以确保不期望或不希望的流量不能从端口发出或通过。这包括禁止实例运行DHCP服务器或充当路由器的规则。要解决后者，可以使用`allowed-address-pairs`扩展来允许额外的IP、子网和MAC地址通过端口。但是，可能需要额外的功能，这些功能无法通过`allowed-address-pairs`扩展解决。
- en: In the Kilo release of OpenStack, the port security extension was introduced
    for the ML2 plugin, which allows all packet filtering to be disabled on a port.
    This includes default rules that prevent IP and MAC spoofing as well as security
    group functionality. This extension is especially useful when deploying instances
    for use as a router or a load balancer. The port security extension requires additional
    configuration that will be discussed in the following sections.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 在OpenStack Kilo版本中，为ML2插件引入了端口安全扩展，允许在端口上禁用所有数据包过滤。这包括防止IP和MAC欺骗以及安全组功能的默认规则。当部署用作路由器或负载均衡器的实例时，此扩展特别有用。端口安全扩展需要额外的配置，将在接下来的部分讨论。
- en: Configuring Neutron
  id: totrans-226
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置Neutron
- en: 'To enable the port security extension, edit the ML2 configuration file on the
    `controller01` node at `/etc/neutron/plugins/ml2/ml2_conf.ini` and add the following
    to the `[ml2]` section:'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 要启用端口安全扩展，在`controller01`节点的`/etc/neutron/plugins/ml2/ml2_conf.ini`编辑ML2配置文件，并在`[ml2]`部分添加以下内容：
- en: '[PRE28]'
  id: totrans-228
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'Restart the `neutron-server` service for the changes to take effect:'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 重启`neutron-server`服务以使更改生效：
- en: '[PRE29]'
  id: totrans-230
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'You can verify that the port security extension is enabled by verifying its
    name in the extension list that''s provided by the `openstack extension list`
    command, as shown here:'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过查看`openstack extension list`命令提供的扩展列表中的名称来验证是否已启用端口安全扩展，如下所示：
- en: '![](img/70567af4-1948-4ebe-9c9f-87332f6837f4.png)'
  id: totrans-232
  prefs: []
  type: TYPE_IMG
  zh: '![](img/70567af4-1948-4ebe-9c9f-87332f6837f4.png)'
- en: Disabling port security for all ports on a network
  id: totrans-233
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 禁用网络上所有端口的端口安全
- en: 'Even without the port security extension in place, Neutron implements the default
    behavior of the extension by implementing DHCP, MAC address, and IP address spoofing
    rules on every port. The port security extension allows users with the admin role
    to disable port security on individual ports or network-wide. Port security can
    be disabled on all ports connected to a particular network by setting the `--disable-port-security` argument
    during network creation:'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 即使没有端口安全扩展，Neutron也通过在每个端口上实施DHCP、MAC地址和IP地址欺骗规则来实现扩展的默认行为。端口安全扩展允许具有管理员角色的用户在单个端口或整个网络上禁用端口安全。在网络创建过程中，可以通过设置`--disable-port-security`参数来禁用连接到特定网络的所有端口上的端口安全：
- en: '![](img/2bfcb8f3-df3c-4b27-80a3-a07c35f365d0.png)'
  id: totrans-235
  prefs: []
  type: TYPE_IMG
  zh: '![](img/2bfcb8f3-df3c-4b27-80a3-a07c35f365d0.png)'
- en: 'When a port is created and attached to the network, its `port_security_enabled`
    attribute will be set to `False` automatically:'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 创建端口并将其附加到网络时，其`port_security_enabled`属性将自动设置为`False`：
- en: '![](img/56ac179e-ab5c-4359-b769-3f7a75c54987.png)'
  id: totrans-237
  prefs: []
  type: TYPE_IMG
  zh: '![](img/56ac179e-ab5c-4359-b769-3f7a75c54987.png)'
- en: It is important to know that when port security is disabled on a port, the API
    will not allow the port to be associated with any security groups. The lack of
    security group rules means all traffic is allowed in and out of a port. Disabling
    port security means any filtering must be implemented within the guest operating
    system.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 需要注意的是，当端口禁用端口安全性时，API将不允许该端口与任何安全组关联。没有安全组规则意味着所有流量都可以进出端口。禁用端口安全性意味着任何过滤必须在虚拟机操作系统内实现。
- en: Modifying port security on an individual port
  id: totrans-239
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 修改单个端口的端口安全性
- en: When the port security extension is enabled, port security can be enabled or
    disabled on an individual port by setting the `port_security_enabled` attribute
    accordingly during the creation or update of a port.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 当端口安全性扩展启用时，可以通过在创建或更新端口时相应设置`port_security_enabled`属性来启用或禁用单个端口的端口安全性。
- en: 'The following screenshot demonstrates updating a port to enable port security:'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图演示了如何更新端口以启用端口安全性：
- en: '![](img/5714ce0e-6cb3-4091-ad0e-7e2ea6462c58.png)'
  id: totrans-242
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5714ce0e-6cb3-4091-ad0e-7e2ea6462c58.png)'
- en: By enabling port security, default anti-spoofing rules will be applied to the
    port, and security groups can be applied as needed. Disabling port security will
    remove the default anti-spoofing rules and security groups will not be allowed
    on the port.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 启用端口安全性时，默认的防伪规则将应用到端口，安全组可以根据需要应用。禁用端口安全性将移除默认的防伪规则，并且该端口将不允许使用安全组。
- en: Allowed address pairs
  id: totrans-244
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 允许的地址对
- en: The `allowed-address-pairs` extension can be used to allow additional IPs, subnets,
    and MAC addresses, other than the fixed IP and MAC address associated with the
    port, to act as source addresses for traffic leaving a port or virtual interface.
    This is useful when treating an instance as a routing device or VPN concentrator,
    or when implementing high-availability between multiple instances using addresses
    that need to "float" between them, such as an `haproxy` and/or `keepalived` implementation.
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: '`allowed-address-pairs`扩展可以用来允许除端口关联的固定IP和MAC地址之外的额外IP、子网和MAC地址作为源地址，用于流出端口或虚拟接口的流量。这在将实例视为路由设备或VPN集中器，或者在使用需要“漂浮”在多个实例之间的地址（例如`haproxy`和/或`keepalived`实现）时，尤其有用。'
- en: 'Existing allowed address pairs can be found in the details of each port by
    using the `openstack port show` command. For every network and/or MAC address
    that should be allowed, the `openstack port set` command should be used with the
    `--allowed-address` argument, as shown here:'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过使用`openstack port show`命令，在每个端口的详细信息中找到现有的允许地址对。对于每个应该被允许的网络和/或MAC地址，应使用带有`--allowed-address`参数的`openstack
    port set`命令，如下所示：
- en: '[PRE30]'
  id: totrans-247
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: The MAC address value is optional. When a MAC address is not specified, the
    MAC address of the port is used.
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: MAC地址值是可选的。如果未指定MAC地址，则使用端口的MAC地址。
- en: 'Multiple allowed address pairs can be associated with a Neutron port simultaneously.
    To apply multiple allowed address pairs to a port, simply specify multiple `ip_address` and `mac_address`
    key/value pairs, as shown here:'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 可以同时为一个Neutron端口关联多个允许的地址对。要将多个允许的地址对应用到端口，只需指定多个`ip_address`和`mac_address`键值对，如下所示：
- en: '[PRE31]'
  id: totrans-250
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: To remove all allowed address pairs from the port, use the `openstack port set`
    command with the `--no-allowed-address` argument.
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 要从端口中移除所有允许的地址对，请使用带有`--no-allowed-address`参数的`openstack port set`命令。
- en: Summary
  id: totrans-252
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: Security groups are fundamental for controlling access to instances by allowing
    users to create inbound and outbound rules that limit traffic to and from instances
    based on specific addresses, ports, protocols, and even other security groups.
    Default security groups are created by Neutron for every project that allows all
    outbound communication and restrict inbound communication to instances in the
    same default security group. Subsequent security groups are locked down even further,
    allowing only outbound communication and not allowing any inbound traffic at all
    unless modified by the user.
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 安全组对于控制实例访问至关重要，允许用户创建入站和出站规则，基于特定的地址、端口、协议，甚至其他安全组，限制到达和离开实例的流量。默认安全组由Neutron为每个项目创建，允许所有出站通信并将入站通信限制在同一默认安全组中的实例之间。后续的安全组会进一步限制，只允许出站通信，并且不允许任何入站流量，除非用户进行修改。
- en: Security group rules are implemented on the compute nodes and are triggered
    when traffic enters or leaves a virtual network interface belonging to an instance.
    Users are free to implement additional firewalls within the guest operating system,
    but may find managing rules in both places a bit cumbersome. Many organizations
    still utilize and rely on physical firewall devices to provide additional filtering
    at the edge of the network, which may mean coordination is required between users
    of the cloud and traditional security teams to ensure proper rules and actions
    are in place in all locations.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 安全组规则在计算节点上实现，并在流量进入或离开实例所属的虚拟网络接口时触发。用户可以在客户操作系统内实现额外的防火墙，但可能会发现同时管理两个地方的规则有些繁琐。许多组织仍然使用并依赖物理防火墙设备，在网络边缘提供额外的过滤，这可能意味着云用户和传统安全团队之间需要进行协调，以确保在所有位置都有适当的规则和措施到位。
- en: In the next chapter, we will look at implementing Role-Based Access Control
    (RBAC) within Neutron as a method of controlling access to networks between projects
    from an API perspective.
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将探讨在 Neutron 中实施基于角色的访问控制（RBAC），作为一种从 API 角度控制项目之间网络访问的方法。
