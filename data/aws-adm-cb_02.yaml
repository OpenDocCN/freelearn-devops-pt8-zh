- en: Managing AWS Accounts
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 管理 AWS 账户
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将介绍以下主题：
- en: Setting up a master account
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置主账户
- en: Creating a member account
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建会员账户
- en: Inviting an account
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 邀请账户
- en: Managing your accounts
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 管理你的账户
- en: Adding a service control policy
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 添加服务控制策略
- en: Introduction
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍
- en: We work with a lot of companies who maintain a large, ever-growing number of
    AWS accounts. Keeping a handle on all these accounts has typically been quite
    difficult to do—even for the most seasoned AWS users.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 我们与许多公司合作，这些公司管理着大量不断增长的 AWS 账户。保持对所有这些账户的控制通常是非常困难的——即使对于经验丰富的 AWS 用户来说也是如此。
- en: With the release of AWS Organizations, you now have the ability to centrally
    manage your AWS accounts, to arrange them into logical groupings and hierarchies,
    and to apply controls to them in ways which haven't previously been possible on
    the AWS platform.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 随着 AWS Organizations 的发布，你现在可以集中管理 AWS 账户，将它们安排成逻辑分组和层级结构，并对它们进行以前在 AWS 平台上无法实现的控制。
- en: Setting up a master account
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置主账户
- en: All accounts that use AWS Organizations for billing and control purposes must
    have a *master account*. This account controls membership to the organization,
    and pays the bills of all the members (someone's got to do it).
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 所有使用 AWS Organizations 进行计费和控制的账户都必须拥有一个*主账户*。该账户控制组织的成员资格，并支付所有成员的账单（总得有人做这个事情）。
- en: How to do it...
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'To set up a master account, perform the following steps:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 要设置主账户，请执行以下步骤：
- en: 'Go to the My Organization section of the account you want to become the master.
    You must be logged in with your root credentials (that is, those you created the
    account with):'
  id: totrans-14
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到你希望成为主账户的账户的我的组织部分。你必须使用根凭证登录（即你用来创建账户的凭证）：
- en: '![](img/image_02_001.png)'
  id: totrans-15
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_02_001.png)'
- en: 'In the AWS Organizations section of the AWS console, click on Create organization,
    as shown in the following screenshot:'
  id: totrans-16
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 AWS 控制台的 AWS Organizations 部分，点击创建组织，如下图所示：
- en: '![](img/image_02_002.png)'
  id: totrans-17
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_02_002.png)'
- en: 'Unless you have a specific requirement, choose ENABLE ALL FEATURES to get the
    full benefit of organizations, as shown in the following screenshot:'
  id: totrans-18
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 除非有特定需求，否则选择启用所有功能，以便充分利用 AWS Organizations，如下图所示：
- en: '![](img/image_02_003.png)'
  id: totrans-19
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_02_003.png)'
- en: 'Now that your account has been converted, you can return to the AWS Organizations
    page to see a list of all your accounts:'
  id: totrans-20
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在你的账户已经转换，你可以返回 AWS Organizations 页面查看所有账户的列表：
- en: '![](img/image_02_004.png)'
  id: totrans-21
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_02_004.png)'
- en: How it works...
  id: totrans-22
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 工作原理...
- en: While this is a very simple recipe, it's the first thing you must do before
    you can use any of the useful features of AWS Organizations.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然这是一个非常简单的流程，但它是你在使用 AWS Organizations 的任何有用功能之前必须做的第一件事。
- en: 'Here you can see a high-level diagram of the relationships between master accounts,
    members, and **organizational units** (**OUs**):'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里你可以看到主账户、成员和**组织单位**（**OUs**）之间关系的高层次图示：
- en: '![](img/B06236_02_05.png)'
  id: totrans-25
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_02_05.png)'
- en: We deliberately enable all the features of organizations. The consolidated billing
    option is available for backward compatibility—before organizations, consolidated
    billing was your only option to link accounts.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 我们故意启用所有组织功能。合并计费选项用于向后兼容——在组织功能之前，合并计费是唯一可以链接账户的选项。
- en: '*Do not use your master account for day-to-day tasks*. Since it is so important,
    it doesn''t make sense to risk using it and/or having access keys for it. If your
    master account was to become compromised somehow, it would impact all of your
    member accounts. Just don''t do it.'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: '*不要将主账户用于日常任务*。由于主账户非常重要，因此不建议冒险使用它或为其设置访问密钥。如果主账户被不正当地访问，将会影响所有成员账户。最好避免这样做。'
- en: The master account will always have a star next to its name.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 主账户的名称旁边将始终有一个星标。
- en: There's more...
  id: totrans-29
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多内容…
- en: All of the organizations functionality is exposed via the API. This means you
    can use the AWS SDKs or the CLI tool to do the same things you would in the web
    console.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 所有组织功能都通过 API 提供。这意味着你可以使用 AWS SDK 或 CLI 工具执行你在 Web 控制台中执行的相同操作。
- en: Multi-factor authentication
  id: totrans-31
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 多因素认证
- en: As mentioned in the consolidated billing confirmation e-mail, it is advisable
    to configure **multi-factor authentication** (**MFA**) on your console. To do
    this, log in as your root user (that is, the credentials you used when first creating
    your account), go to the **Identity and Access Management** (**IAM**) console,
    and follow the Activate MFA on your root account prompts.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 如在合并账单确认邮件中所提到，建议在控制台上配置**多因素认证**（**MFA**）。为此，请以根用户身份登录（即你首次创建账户时使用的凭证），进入**身份与访问管理**（**IAM**）控制台，并按照激活根账户MFA的提示操作。
- en: Using the CLI
  id: totrans-33
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用CLI
- en: 'You can easily create your master account with the CLI tool. The following
    command will turn your account into a master account, with all organizations features
    enabled:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以轻松使用CLI工具创建你的主账户。以下命令将使你的账户成为主账户，并启用所有组织功能：
- en: '[PRE0]'
  id: totrans-35
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: See also
  id: totrans-36
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 另见
- en: The *Inviting an account* recipe
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*邀请账户*的操作步骤'
- en: The *Creating a member account* recipe
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*创建成员账户*的操作步骤'
- en: Creating a member account
  id: totrans-39
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建成员账户
- en: Once your organization is up and running, the most common use you will have
    for it is automating the account creation process. Accounts created inside an
    organization are referred to as **member accounts**.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你的组织启动并运行，最常见的用途就是自动化账户创建过程。组织内创建的账户被称为**成员账户**。
- en: All charges incurred by a member account will be billed to the master account.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 所有由成员账户产生的费用将由主账户进行计费。
- en: Getting ready
  id: totrans-42
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: Obviously, you will need an organization to perform this recipe. See the other
    recipes in this chapter to get started.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 显然，你需要一个组织来执行这个操作步骤。请参阅本章中的其他操作步骤来开始使用。
- en: How to do it...
  id: totrans-44
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 操作步骤...
- en: 'Run the CLI tool command to create a new account, with appropriate values:'
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行CLI工具命令以创建一个新账户，并填写适当的值：
- en: '[PRE1]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'This command will return a `create account status` request ID value that you
    can use to check the status:'
  id: totrans-47
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 此命令将返回一个`create account status`请求ID，你可以用它来检查状态：
- en: '[PRE2]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: How it works...
  id: totrans-49
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 工作原理...
- en: The command to create a member account in your organization is extremely simple.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 在你的组织中创建成员账户的命令非常简单。
- en: The e-mail address used cannot be associated with any other AWS accounts.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 使用的电子邮件地址不能与其他AWS账户关联。
- en: The account creating process takes some time, so it is done *asynchronously*.
    This means that you won't receive an immediate status to your `create-account`
    command. Instead, the command in this recipe will return a request ID.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 账户创建过程需要一些时间，因此是*异步*进行的。这意味着你不会立即收到`create-account`命令的状态。相反，本操作步骤中的命令将返回一个请求ID。
- en: This ID is then passed to another account to check the status of the creation.
    When the status is `CREATED`, you can start to use the new account.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 该ID会被传递到另一个账户中，用于检查创建的状态。当状态为`CREATED`时，你就可以开始使用新账户了。
- en: There's more...
  id: totrans-54
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多...
- en: While this functionality is definitely useful, the AWS Organizations service
    is relatively new. This means there are a few *features* you should be aware of.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然这个功能确实很有用，但AWS组织服务相对较新。这意味着你需要了解一些*功能*。
- en: Accessing the member account
  id: totrans-56
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 访问成员账户
- en: Once you've created your member account, it's time to put it to work!
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你创建了成员账户，就可以开始使用它了！
- en: An IAM role will be present in the new account, with a default name of `OrganizationAccountAccessRole`.
    This is so you can assume the role (from your master account) and administer the
    member account. While this name is as good as any, it can be configured by passing
    the `--role-name` argument when creating the account.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 新账户中将存在一个IAM角色，默认名称为`OrganizationAccountAccessRole`。这是为了让你能够（从主账户）承担该角色并管理成员账户。虽然这个名称已经足够好，但你也可以在创建账户时传递`--role-name`参数来配置该名称。
- en: 'In order to assume the role, you need to know its **Amazon Resource Name**
    (**ARN**). Working out the ARN is a multi-step process:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 为了承担该角色，你需要知道它的**Amazon资源名称**（**ARN**）。计算ARN是一个多步骤过程：
- en: 'List your member accounts by running the following command in your master account:'
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在主账户中运行以下命令以列出你的成员账户：
- en: '[PRE3]'
  id: totrans-61
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Find the account you created (by its name) and note the ID value in the record.
    Using that ID, generate the role''s ARN by following this pattern:'
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 找到你创建的账户（根据其名称），并记录下记录中的ID值。使用该ID，按照以下模式生成角色的ARN：
- en: '[PRE4]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: If you have changed the created role's name, update the last part of the ARN
    accordingly.
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果你更改了创建的角色名称，请相应更新ARN的最后部分。
- en: See the recipes in [Chapter 8](c19319d5-2db2-4b99-ad4c-1676db3bae2f.xhtml), *Security
    and Identity* for information on how to best manage multiple accounts.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 请参见[第8章](c19319d5-2db2-4b99-ad4c-1676db3bae2f.xhtml)中的配方，*安全性与身份*，了解如何最佳地管理多个账户。
- en: Service control policies
  id: totrans-66
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 服务控制策略
- en: The **service control policies** (**SCPs**) are another major feature of AWS
    Organizations. You can apply them at multiple levels/resources, including accounts
    (both member accounts and invited accounts). Check the other recipes in this chapter
    for more details.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: '**服务控制策略**（**SCPs**）是 AWS Organizations 的另一个主要功能。你可以在多个级别/资源上应用它们，包括账户（成员账户和被邀请账户）。查看本章中的其他配方，获取更多细节。'
- en: Root credentials
  id: totrans-68
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 根凭证
- en: Some activities still require the root credentials of the account. An example
    activity would be closing (or deleting) an account (see the next section for more
    details).
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 一些活动仍然需要账户的根凭证。一个示例活动是关闭（或删除）账户（更多细节请参见下一节）。
- en: In order to do this, you will need to do the password recovery process for the
    e-mail that was associated with the account when the `create-account` request
    was sent.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 为了做到这一点，你需要进行与账户关联的电子邮件的密码恢复过程，尤其是在发送 `create-account` 请求时。
- en: Deleting accounts
  id: totrans-71
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 删除账户
- en: At the time of writing, *there is no way to delete an account created in your
    organization via the API*. We can only imagine that being able to programmatically
    delete a member account created in an organization will be a *highly requested*
    feature, and will be addressed soon. You can still go into the member account
    and close it using the root credentials, but these don't exist by default.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 在撰写本文时，*无法通过 API 删除在你的组织中创建的账户*。我们只能推测，能够通过编程删除组织中创建的成员账户将是一个*高度需求*的功能，并将在不久的将来得到解决。你仍然可以进入成员账户并使用根凭证关闭它，但这些凭证默认并不存在。
- en: While you can technically delete your *organization* via the API, you cannot
    do it if you have created any member accounts in your organization (because you
    can't delete them, your organization will never be empty). This should improve
    in the near future, but is still worth being aware of now.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然你可以通过 API 删除你的*组织*，但如果你在组织中创建了任何成员账户，就无法进行删除（因为你不能删除它们，所以你的组织永远不会为空）。这一点在不久的将来会有所改进，但现在仍然值得注意。
- en: See also
  id: totrans-74
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 另见
- en: The *Setting up a master account* recipe
  id: totrans-75
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*设置主账户* 配方'
- en: The *Adding a service control policy* recipe
  id: totrans-76
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*添加服务控制策略* 配方'
- en: The *Cross-account user roles* recipe in [Chapter 8](c19319d5-2db2-4b99-ad4c-1676db3bae2f.xhtml),
    *Security and Identity*
  id: totrans-77
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[第8章](c19319d5-2db2-4b99-ad4c-1676db3bae2f.xhtml)中的*跨账户用户角色* 配方，*安全性与身份*'
- en: Inviting an account
  id: totrans-78
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 邀请账户
- en: While it makes sense to create new accounts in your organization, what do you
    do with all the other accounts you have now?
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然创建新账户进入你的组织是有意义的，但你现在该如何处理所有其他账户呢？
- en: You can invite existing accounts to your organization, which means you can treat
    them just like a member account from an administrative point of view. This greatly
    simplifies the administrative overhead of your accounts, as there isn't a separate
    process for *old* and *new* accounts.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以邀请现有账户加入你的组织，这意味着你可以从管理角度将它们视为成员账户。这极大简化了账户的管理工作量，因为*旧*账户和*新*账户没有单独的处理流程。
- en: As this is generally performed once for each existing account, we will use the
    console.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 由于这通常仅针对每个现有账户执行一次，我们将使用控制台。
- en: All the AWS organizations functionality is available via the SDKs and AWS CLI
    tool. If you need to automate this process, you can.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 所有 AWS 组织功能都可以通过 SDK 和 AWS CLI 工具访问。如果你需要自动化此过程，完全可以实现。
- en: Getting ready
  id: totrans-83
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: You must have enabled AWS Organizations for one of your accounts (your master
    account), and have another account that has not been made part of an organization
    yet (that you will invite).
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 你必须为其中一个账户（主账户）启用了 AWS Organizations，并且有另一个尚未成为组织一部分的账户（你将邀请它）。
- en: How to do it...
  id: totrans-85
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'From the AWS console of the master account, click on your username, and select
    My Organization from the drop-down menu:'
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从主账户的 AWS 控制台中，点击你的用户名，并从下拉菜单中选择“我的组织”：
- en: '![](img/image_02_006.png)'
  id: totrans-87
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_02_006.png)'
- en: 'You will be taken to the AWS Organizations console, where you will see your
    current account:'
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你将被带到 AWS Organizations 控制台，在那里你会看到当前账户：
- en: '![](img/image_02_007.png)'
  id: totrans-89
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_02_007.png)'
- en: 'Click on the Invitations tab in the top-right of the console:'
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击控制台右上角的“邀请”标签：
- en: '![](img/image_02_008.png)'
  id: totrans-91
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_02_008.png)'
- en: 'Click on the Invite account button. Specify the account ID (or main e-mail
    address) of the account to invite:'
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“邀请账户”按钮，指定要邀请的账户ID（或主电子邮件地址）：
- en: '![](img/image_02_009.png)'
  id: totrans-93
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_02_009.png)'
- en: 'Once you click Invite, you will be taken to a list of invitations where you
    can view the status:'
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦点击“邀请”，你将被带到一个邀请列表页面，在那里可以查看状态：
- en: '![](img/image_02_010.png)'
  id: totrans-95
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_02_010.png)'
- en: 'At this stage, the target/invited account will receive an e-mail notifying
    them of the invite:'
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在这个阶段，目标/受邀账户将收到一封通知他们邀请的电子邮件：
- en: '![](img/image_02_011.png)'
  id: totrans-97
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_02_011.png)'
- en: 'Log in to the invited account and go to the My Organization link under the
    user menu:'
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录受邀账户，并在用户菜单下点击“我的组织”链接：
- en: '![](img/image_02_012.png)'
  id: totrans-99
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_02_012.png)'
- en: 'In the AWS Organizations console, you can see the pending invite on the left:'
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在AWS Organizations控制台中，你可以在左侧看到待处理的邀请：
- en: '![](img/image_02_013.png)'
  id: totrans-101
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_02_013.png)'
- en: 'Clicking on the invite, you can see its details:'
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击邀请，你可以查看其详细信息：
- en: '![](img/image_02_014.png)'
  id: totrans-103
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_02_014.png)'
- en: 'When the invite includes all features, you will be asked to confirm your acceptance:'
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当邀请包含所有功能时，你将被要求确认接受：
- en: '![](img/image_02_015.png)'
  id: totrans-105
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_02_015.png)'
- en: 'Once confirmed, you can now see the details of the organization you have joined:'
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确认后，你现在可以看到你已加入的组织的详细信息：
- en: '![](img/image_02_016.png)'
  id: totrans-107
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_02_016.png)'
- en: 'At this stage, the master account will be notified of the accepted invite:'
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在这个阶段，主账户会收到已接受邀请的通知：
- en: '![](img/image_02_017.png)'
  id: totrans-109
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_02_017.png)'
- en: 'Back in the master account, you can now see the new account alongside the master:'
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 返回主账户，现在你可以看到新账户与主账户一起显示：
- en: '![](img/image_02_018.png)'
  id: totrans-111
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_02_018.png)'
- en: How it works...
  id: totrans-112
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: While there are many steps involved, the process of inviting an existing account
    is a relatively simple *handshake* process. This means that both sides must actively
    initiate/accept the invite, in order for it to succeed—an invite cannot be forced.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然有许多步骤，但邀请现有账户的过程是一个相对简单的*握手*过程。这意味着双方必须主动发起/接受邀请，才能成功——邀请无法被强制进行。
- en: After specifying the target account's account ID (or e-mail address), the e-mail
    address associated will be notified.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 在指定目标账户的账户ID（或电子邮件地址）后，关联的电子邮件地址将收到通知。
- en: As part of the handshake process, the invited account must explicitly accept
    the invite.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 作为握手过程的一部分，受邀账户必须明确接受邀请。
- en: It is important to note that the default invite type (and what we have used
    in the recipe) is to use the full feature set for AWS Organizations. As noted
    in the console, this means that the invited account *could be prevented from leaving
    the organization* if the relevant policies are configured.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 需要注意的是，默认的邀请类型（以及我们在此过程中使用的）是使用AWS Organizations的完整功能集。如控制台中所述，这意味着如果相关策略已配置，受邀账户*可能会被阻止离开组织*。
- en: After confirmation, both parties will receive an e-mail detailing the membership.
    From this point forward, the bill for the invited account will be paid by the
    master account.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 确认后，双方将收到一封详细说明会员资格的电子邮件。从此时起，受邀账户的账单将由主账户支付。
- en: There's more...
  id: totrans-118
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多...
- en: Invited accounts are treated differently to accounts created via the organizations
    functionality.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 受邀账户与通过组织功能创建的账户有所不同。
- en: Removing accounts
  id: totrans-120
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 移除账户
- en: Unlike *member accounts* (which are created via the AWS Organizations API),
    invited accounts can be removed from an organization.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 与*成员账户*（通过AWS Organizations API创建的账户）不同，受邀账户可以从组织中移除。
- en: Consolidated billing
  id: totrans-122
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 合并账单
- en: As an alternative to the *full feature* invite, it is possible to specify just
    *consolidated billing* mode for an organization. In this mode, no OUs or policies
    will be available, only the billing relationship will be shared between the accounts
    (that is, the master account will pay the bill of the member accounts).
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 作为*全功能*邀请的替代方案，可以仅为组织指定*合并账单*模式。在这种模式下，不会有OU或策略，仅会在账户之间共享账单关系（即主账户将支付成员账户的账单）。
- en: Any pre-existing accounts that were configured to use consolidated billing will
    have been *automatically* migrated to AWS Organizations *in consolidated billing
    mode*.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 任何预先配置为使用合并账单的账户将*自动*迁移到AWS Organizations *合并账单模式*中。
- en: See also
  id: totrans-125
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 参见
- en: The *Creating a member account* recipe
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*创建成员账户*过程'
- en: Managing your accounts
  id: totrans-127
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 管理你的账户
- en: 'There are a number of ways to group and arrange your AWS accounts. How you
    do this is completely up to you, but here are a few examples to consider:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 有多种方法可以对 AWS 帐户进行分组和排列。如何做完全取决于您，但以下是一些考虑的示例：
- en: '**Business unit (BU) or location**: You may wish to allow each BU to work in
    isolation on their own products or services, on their own schedule, without impacting
    other parts of the business'
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**业务单元（BU）或位置**：您可能希望允许每个 BU 在其自己的产品或服务上独立工作，按照自己的时间表进行工作，而不会影响业务的其他部分。'
- en: '**Cost center**: Grouping according to cost may help you track spend versus
    allocated budget'
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**成本中心**：根据成本分组可能有助于您跟踪支出与分配预算的情况。'
- en: '**Environment type**: It may make sense to group your development, test, and
    production environments together in a way which helps you manage the controls
    across each environment'
  id: totrans-131
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**环境类型**：将开发、测试和生产环境合理地分组，有助于您跨每个环境管理控制。'
- en: '**Workload type or data classification**: Your company may want to isolate
    workload types from each other, or ensure that particular controls are applied
    to all accounts containing a particular kind of data'
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**工作负载类型或数据分类**：您的公司可能希望将工作负载类型相互隔离，或者确保所有包含特定数据类型的帐户应用特定的控制。'
- en: In the following fictitious example, we have isolated the **Sitwell Enterprises
    Account** from the rest of the organization by placing it in an OU called **Sudden
    Valley**. Perhaps they operate in a different geographical location and have different
    regulatory requirements around controls and access.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 在下面的虚构示例中，我们通过将其放入名为**突然谷**的 OU 中，将**Sitwell Enterprises 帐户**与组织的其他部分隔离开来。也许他们在不同的地理位置运营，并且对控制和访问有不同的法规要求。
- en: '![](img/image_02_019.png)'
  id: totrans-134
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_02_019.png)'
- en: Organization hierarchy
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 组织层次结构
- en: 'Note that while it''s also technically possible for us to put the master account
    inside an OU, we avoid doing this to make it obvious that:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，虽然我们也可以将主帐户放入 OU 中，但我们避免这样做是为了明确以下事实：
- en: It's the master account and has control over the entire organization
  id: totrans-137
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它是主帐户，并且对整个组织拥有控制权。
- en: The rules we set, using SCPs for the member accounts in our organization, do
    not apply to the master account (because they can't)
  id: totrans-138
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们设置的规则，使用 SCP 来控制组织中的成员帐户，不适用于主帐户（因为它们不能）。
- en: Learn more about SCPs in the *Adding a service control policy* recipe in this
    chapter.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章节的*添加服务控制策略*食谱中了解更多关于 SCP 的信息。
- en: Getting ready
  id: totrans-140
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备就绪
- en: 'Before we can proceed, you should have already done the following:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 在继续之前，您应该已经完成了以下工作：
- en: Set up a master AWS account
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置主 AWS 帐户
- en: Created an organization
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建了一个组织
- en: Created member accounts in your organization, or manually added member accounts
    (by invitation) to your organization
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在您的组织中创建成员帐户，或者通过邀请手动添加成员帐户
- en: How to do it...
  id: totrans-145
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: We'll now cover the one-line commands you'll need to perform the common tasks
    required to manage your OU. These commands can only be performed in your master
    account.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将介绍执行管理 OU 所需的常见任务的单行命令。这些命令只能在您的主帐户中执行。
- en: Getting the root ID for your organization
  id: totrans-147
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 获取组织的根 ID
- en: 'You can run this command to get the ID of the root for your organization. The
    root is created automatically for you when you create your organization in your
    master account. The ID returned to you will look something like this: `r-bmdw`.'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以运行此命令来获取组织的根 ID。当您在主帐户中创建组织时，根会自动为您创建。返回给您的 ID 看起来会像这样：`r-bmdw`。
- en: '[PRE5]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Creating an OU
  id: totrans-150
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建一个 OU
- en: 'To create an OU, perform the following steps:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建 OU，请执行以下步骤：
- en: Determine where you'd like this OU to live. If it lives directly underneath
    the root, then your root ID will be the parent. Alternatively, if this OU is going
    to be a child of another OU, use the ID of the OU instead. Obviously, if this
    is the first OU you're creating, the root will be the parent.
  id: totrans-152
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确定您希望此 OU 存在的位置。如果它直接位于根目录下，那么根 ID 将作为父级。或者，如果此 OU 将作为另一个 OU 的子级，使用该 OU 的 ID。显然，如果这是您创建的第一个
    OU，则根将作为父级。
- en: 'Use the CLI to create your OU like so:'
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 CLI 像这样创建您的 OU：
- en: '[PRE6]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Getting the ID of an OU
  id: totrans-155
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 获取 OU 的 ID
- en: 'If you need to fetch the ID of an OU, you can use the CLI to do so; note that
    you''ll need to know the parent of the OU. Here is how you''d get a list of all
    the OUs and their IDs in a root or OU:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您需要获取 OU 的 ID，可以使用 CLI 进行操作；请注意，您需要知道 OU 的父级。以下是如何在根或 OU 中获取所有 OU 及其 ID 列表的方法：
- en: '[PRE7]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Adding an account to an OU
  id: totrans-158
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将帐户添加到 OU 中
- en: 'To add an account to an OU, perform the following steps:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 要将账户添加到OU，执行以下步骤：
- en: 'When an account is initially added to your organization, it will be a child
    of the organization root. To add it to the OU you just created, you need to move
    it using the following CLI command:'
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当账户首次添加到你的组织时，它将是组织根目录的子账户。要将其添加到你刚刚创建的OU，你需要使用以下CLI命令将其移动：
- en: '[PRE8]'
  id: totrans-161
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: If you wish to move an account from one OU to another, simply use the same command
    but use the existing parent OU ID instead of the root ID.
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果你希望将账户从一个OU移动到另一个OU，只需使用相同的命令，但使用现有父OU的ID，而不是根目录的ID。
- en: Removing an account from an OU
  id: totrans-163
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 从OU中移除账户
- en: 'To remove an account from an OU, perform the following steps:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 要从OU中移除账户，执行以下步骤：
- en: If you wish to remove an account from an OU, you have two options. You can move
    it to another OU, or you can move it back to the root. If you decide you want
    to delete an OU, you'll need to make sure no accounts exist inside it first (we'll
    show you how to do this next).
  id: totrans-165
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果你希望将一个账户从OU中移除，你有两个选择。你可以将它移动到另一个OU，或者将它移回根目录。如果你决定删除一个OU，你需要首先确保它里面没有账户（我们接下来会展示如何操作）。
- en: 'Run the following command to move an account back to the root:'
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行以下命令将账户移回根目录：
- en: '[PRE9]'
  id: totrans-167
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Deleting an OU
  id: totrans-168
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 删除OU
- en: 'To delete an OU, you''ll first need to make sure it''s empty by removing its
    child accounts (as mentioned previously). You can then go ahead and delete the
    OU like so:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 要删除一个OU，你首先需要确保它是空的，通过移除它的子账户（如前所述）。然后你可以像下面这样删除OU：
- en: '[PRE10]'
  id: totrans-170
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: How it works...
  id: totrans-171
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: If done right, grouping your accounts together using OUs will help you simplify
    the way you manage and administer them. Try to use only *just enough* OUs to get
    the job done. The idea is to use OUs to make your life easier, not harder.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 如果操作得当，使用OU将你的账户分组在一起，将帮助你简化管理和操作它们的方式。尽量只使用*刚好够用*的OU来完成任务。我们的目标是使用OU让你的工作更轻松，而不是更困难。
- en: There's more...
  id: totrans-173
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多...
- en: 'The **organizational control policies** (**OCPs**) can be attached to your
    root, OU, or AWS accounts. At this time, only one kind of OCP is supported: SCP.'
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**组织控制策略**（**OCPs**）可以附加到你的根目录、OU或AWS账户上。目前，只支持一种OCP类型：SCP。'
- en: Accounts can only belong to one OU or root.
  id: totrans-175
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 账户只能属于一个组织单位（OU）或根目录。
- en: Similarly, OUs can only belong to one OU or root.
  id: totrans-176
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 同样地，OU只能属于一个OU或根目录。
- en: It's best to avoid deploying resources in the master account because this account
    can't be controlled with SCPs. The master account should be treated as a management
    account for audit, control, and billing purposes only.
  id: totrans-177
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最好避免在主账户中部署资源，因为该账户无法通过SCP进行控制。主账户应仅作为审计、控制和计费的管理账户使用。
- en: See also
  id: totrans-178
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 另见
- en: The *Adding a service control policy* recipe
  id: totrans-179
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*添加服务控制策略*操作步骤'
- en: Adding a service control policy
  id: totrans-180
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 添加服务控制策略
- en: Before we begin, we should talk through what SCPs are and how they apply to
    your organization.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始之前，我们应该先讲一下SCP是什么，它是如何应用到你的组织中的。
- en: An SCP consists of a policy document which defines (by way of filtering) the
    services and actions which are able to be used and performed within an OU or in
    an AWS account. If you've previously configured an IAM policy, then you will have
    more than enough background knowledge to get started with SCPs. Apart from a couple
    of minor exceptions, they look exactly the same.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: SCP由一个策略文档组成，通过过滤定义了哪些服务和操作可以在OU或AWS账户内使用和执行。如果你之前配置过IAM策略，那么你已经有了足够的背景知识来开始使用SCP。除了少数几个小例外，它们看起来完全一样。
- en: 'SCPs can be applied at different levels throughout an organization. These are
    the levels, starting from the bottom and going up:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: SCP可以在组织的不同级别应用。以下是这些级别，从下到上：
- en: '**AWS account level**: An SCP applied to an AWS account takes effect on only
    that account. It''s important to note that the SCP is very separate from the IAM
    policies which live inside the account. For example, an SCP might allow full access
    to S3 for an AWS account but the IAM policies inside the account may deny it (for
    certain roles and/or users).'
  id: totrans-184
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**AWS账户级别**：应用于AWS账户的SCP只会对该账户生效。需要注意的是，SCP与账户内的IAM策略是完全独立的。例如，SCP可能允许AWS账户完全访问S3，但账户内的IAM策略可能会拒绝访问（针对某些角色和/或用户）。'
- en: '**OU level**: An SCP applied at the OU level will apply to all the AWS accounts
    which live inside the OU as well as any child OUs (remember that an OU can by
    a member of an OU).'
  id: totrans-185
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**OU级别**：在OU级别应用的SCP将适用于该OU中的所有AWS账户以及任何子OU（记住，OU可以是另一个OU的成员）。'
- en: '**Root level**: If an SCP is applied at this level, it will apply to all AWS
    accounts inside the organization.'
  id: totrans-186
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**根级别**：如果在此级别应用SCP，它将应用于组织内所有AWS账户。'
- en: Things can start to get really interesting when you have an SCP applied at multiple
    levels. The *intersection* of the polices at the root, OU, account, and IAM levels
    is evaluated and will determine whether or not an API call is allowed to be made.
    For example, someone belonging to an IAM role which has full administrator access
    to an account still won't be able to call any EC2 APIs if any of the SCPs above
    it (account, OU, root) deny EC2 access.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 当你在多个层次上应用SCP时，事情可能会变得非常有趣。在根、OU、账户和IAM层次上的策略*交集*将被评估，并决定是否允许API调用。例如，即使某人属于具有账户完全管理员访问权限的IAM角色，如果任何上层SCP（账户、OU、根）拒绝EC2访问，他们仍然无法调用任何EC2
    API。
- en: 'In the following example, we have a top-level OU, Austero Bluth, with an SCP
    which allows access to all AWS resources for all OUs and accounts underneath it:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 在下面的示例中，我们有一个顶级组织单元（OU），Austero Bluth，附加了一个SCP，该SCP允许对其下所有OU和账户的所有AWS资源访问：
- en: '![](img/image_02_020.png)'
  id: totrans-189
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_02_020.png)'
- en: Organization hierarchy and policies
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 组织层级和策略
- en: Austero Bluth has two child OUs; let's focus on Sudden Valley. It has an SCP
    which allows only EC2 and S3\. By using a whitelisting approach, anything except
    these two services will be denied. Remembering that SCPs act like a filter, any
    OU or AWS accounts living underneath the Sudden Valley OU will, at most, have
    access to EC2 and S3.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: Austero Bluth有两个子OU；让我们专注于Sudden Valley。它有一个SCP，只允许EC2和S3。通过使用白名单方法，除了这两个服务，其他任何服务都会被拒绝访问。记住，SCP像一个过滤器，任何位于Sudden
    Valley OU下的OU或AWS账户，最多只能访问EC2和S3。
- en: The **Sitwell Enterprises Account** also has an SCP attached to it. This particular
    SCP allows S3 and SQS. Note that the SQS statement will have no effect here because
    the Sitwell account is inside an OU which does not allow SQS. Also note that this
    account has no access to EC2 despite the **Sudden Valley OU** allowing it; this
    is because EC2 wasn't explicitly allowed in the SCP attached to the account.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: '**Sitwell Enterprises账户**也附加了一个SCP。这个特定的SCP允许S3和SQS。请注意，由于Sitwell账户位于一个不允许SQS的OU中，SQS声明在这里不会生效。还要注意，尽管**Sudden
    Valley OU**允许EC2，但该账户无法访问EC2，这是因为附加在账户上的SCP中没有明确允许EC2。'
- en: At the IAM level, we have a role in the Sitwell AWS account which allows full
    administrator privileges. But, because the intersection of the SCPs governing
    this account will only allow S3, anyone using this role will be denied access
    if they attempt to use EC2 or SQS, for example.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 在IAM级别，我们在Sitwell AWS账户中有一个角色，允许完全的管理员权限。但由于管理此账户的SCP交集只允许S3，因此任何使用该角色的人，如果尝试使用EC2或SQS等服务，将被拒绝访问。
- en: Let's also take a look at the **Bluth Company Account**. The SCP which is attached
    to it allows full AWS access; however, it lives inside an OU (Balboa Bay) which
    only allows EC2, RDS, and S3\. There is an IAM role inside this account which
    also allows full admin access but, again, administrators in this account will
    be limited to EC2, RDS, and S3.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们再看一下**Bluth Company账户**。附加在该账户上的SCP允许完全的AWS访问；然而，它位于一个仅允许EC2、RDS和S3的OU（Balboa
    Bay）中。该账户内有一个IAM角色，也允许完全的管理员访问，但同样，该账户中的管理员将被限制在EC2、RDS和S3之内。
- en: Getting ready
  id: totrans-195
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: We're going to step through creating an SCP and adding it to an OU.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将一步步创建一个SCP并将其添加到OU中。
- en: 'You''re going to need the ID of the OU in question; you can fetch it from the
    organizations web console or use the CLI. It will look something like this: `ou-bmdw-omzypry7`.'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要该OU的ID；你可以从组织的网页控制台获取，或者使用CLI。它看起来像这样：`ou-bmdw-omzypry7`。
- en: 'We''ll be preparing a policy document as well. In this example, we''re going
    to add an SCP to the Sudden Valley OU to allow access to EC2 and S3\. Here''s
    what our SCP looks like:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还将准备一个策略文档。在这个例子中，我们将向Sudden Valley OU添加一个SCP，允许访问EC2和S3。以下是我们的SCP的样子：
- en: '[PRE11]'
  id: totrans-199
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: How to do it...
  id: totrans-200
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: Open a new file in your text editor, add your JSON policy document, and save
    it.
  id: totrans-201
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在文本编辑器中打开一个新文件，添加你的JSON策略文档，并保存。
- en: 'Run the `create-policy` CLI command like so. We''re getting a little tricky
    with the `tr` command here: we''re using it to remove the carriage returns from
    the policy document, so pay close attention to the syntax in the example provided.
    Unfortunately, the organizations CLI doesn''t allow us to provide the path to
    the policy document directly:'
  id: totrans-202
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 像这样运行`create-policy` CLI命令。我们在这里使用`tr`命令稍微有些技巧：我们用它来移除策略文档中的回车符，因此请特别注意示例中的语法。不幸的是，组织CLI不允许我们直接提供策略文档的路径：
- en: '[PRE12]'
  id: totrans-203
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'If the preceding CLI command works successfully, some JSON will be returned
    to you containing the ID of the policy we just added. It will look something like
    this: `p-o9to04s7`.'
  id: totrans-204
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果前面的CLI命令成功执行，将返回一些JSON，包含我们刚刚添加的策略ID。它看起来像这样：`p-o9to04s7`。
- en: 'You can now go ahead and attach this policy to the OU. Use the following CLI
    command to do this:'
  id: totrans-205
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在你可以继续将此策略附加到OU。使用以下CLI命令来执行此操作：
- en: '[PRE13]'
  id: totrans-206
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Unfortunately, the preceding command does not output anything if it ran successfully.
    You can double-check your handiwork in the AWS web console or use the following
    CLI command to verify that it worked:'
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 不幸的是，前面的命令如果成功执行，则不会输出任何内容。你可以通过AWS Web控制台重新检查你的操作，或者使用以下CLI命令来验证它是否成功：
- en: '[PRE14]'
  id: totrans-208
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: How it works...
  id: totrans-209
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的……
- en: Again, the policies you add will act as a filter at each level of your organizational
    structure. With this in mind, it might be a good time to point out that testing
    your policies on a single account before applying them organization-wide will
    save you a lot of heartache. Making sweeping changes to an SCP living at the top
    of your organization may create an unforeseen situation at the AWS account level
    at the bottom of the chain. A local admin in an AWS account is not able to override
    SCPs.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 再次强调，你添加的策略将在组织结构的每一层充当过滤器。考虑到这一点，可能是时候指出，在将策略应用于整个组织之前，先在单一账户上测试策略将为你节省许多麻烦。对组织顶层的SCP进行大范围更改可能会在链条底部的AWS账户层面产生意想不到的情况。AWS账户中的本地管理员无法覆盖SCP。
- en: There's more...
  id: totrans-211
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多……
- en: At the time of publishing, you are only able to have a single root inside an
    organization (it's created automatically for you when you create an organization).
  id: totrans-212
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在发布时，你只能在一个组织中拥有一个根（当你创建组织时，它会自动为你创建）。
- en: For obvious reasons, the master account is not affected by any SCPs which are
    attached to it. You may also notice that it's technically possible to place the
    master account in an OU; again, it will be unaffected by any SCPs which have been
    attached to that OU.
  id: totrans-213
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 出于显而易见的原因，主账户不会受到附加到它的任何SCP的影响。你还可能注意到，技术上是可以将主账户放置到OU中的；同样，它也不会受到附加到该OU的任何SCP的影响。
- en: Since the master account is unaffected by SCPs, it's a good idea to leave it
    as empty as possible and to not create any resources in it. Use child AWS accounts
    instead so you can apply fine-grained controls to them.
  id: totrans-214
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 由于主账户不受SCP的影响，最好尽可能保持它为空，并且不要在其中创建任何资源。使用子AWS账户，这样你可以对其应用细粒度控制。
- en: SCPs are required on each OU and account but shouldn't be considered the only
    form of access control for your AWS accounts. Apply IAM where appropriate.
  id: totrans-215
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每个组织单元（OU）和账户都需要使用SCP，但不应将其视为AWS账户的唯一访问控制方式。根据需要应用IAM。
- en: 'When creating our policy, we have to specify a `--type` parameter. At the time
    of publishing, AWS only supports one variant of OCP: `SERVICE_CONTROL_POLICY`.'
  id: totrans-216
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建策略时，我们必须指定`--type`参数。在发布时，AWS仅支持一种OCP变体：`SERVICE_CONTROL_POLICY`。
- en: As much as possible, follow the principle of least privilege. You want to give
    your AWS accounts access to only the services they need. This helps you mitigate
    damage caused by misclicks, programming errors, or compromised accounts.
  id: totrans-217
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 尽可能遵循最小权限原则。你应该只给予AWS账户访问它们所需的服务。这有助于减少误操作、编程错误或账户被攻破所带来的损害。
- en: In the long run, you may find it advantageous to not assign controls at the
    root level. Instead, you may be better off adding *all* accounts to an OU and
    applying your controls to the OU instead.
  id: totrans-218
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从长远来看，你可能会发现不在根级别分配控制更有利。相反，可能更好将*所有*账户添加到一个OU，并将控制应用于该OU。
- en: Your policies can take a whitelisting or blacklisting approach. In this recipe,
    we've used a whitelist approach, but you may instead prefer to allow your OUs
    and accounts to use all services except the ones you explicitly disallow. You
    should choose one of these approaches and stick with it, as mixing the two will
    cause you lots of confusion down the road.
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你的策略可以采用白名单或黑名单方法。在这个示例中，我们使用了白名单方法，但你也可以选择允许你的组织单元（OU）和账户使用所有服务，除了那些你明确禁止的服务。你应该选择其中一种方法并坚持使用，因为混合这两种方法会在未来造成很多困惑。
- en: Unlike IAM policies, you can't specify conditions in SCP documents and `Resource`
    *must* be `*`.
  id: totrans-220
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 与IAM策略不同，你不能在SCP文档中指定条件，并且`Resource`*必须*是`*`。
- en: See also
  id: totrans-221
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 另请参见
- en: The *Federating with your AWS account* recipe in [Chapter 8](c19319d5-2db2-4b99-ad4c-1676db3bae2f.xhtml), *Security
    and Identity* for some discussion around IAM roles
  id: totrans-222
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[第8章](c19319d5-2db2-4b99-ad4c-1676db3bae2f.xhtml)中的*与AWS账户联邦*示例，*安全与身份*章节，涉及一些关于IAM角色的讨论。'
