- en: Exploring Azure AD Identity Services
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 探索 Azure AD 身份服务
- en: In this chapter, we'll explore the different Azure AD identity services and
    AD FS as an on-premise identity service. We'll look at the Azure AD B2B and B2C
    functionality and explain the main concepts behind these technologies. Furthermore,
    we'll look at and extend the Azure AD Domain Services that we configured in [Chapter
    1](54c375d9-b7d0-4478-8777-33935239254b.xhtml), *Building and Managing Azure Active
    Dire**ctory*. To get the whole picture, we'll also view the different capabilities
    of the Active Directory Federation Services, and how they support different authentication
    scenarios. You will learn how to use the Azure AD B2B and B2C services for your
    projects, in order to provide suitable access to your applications for customers,
    partners, and internal employees. Particularly, you can use Azure AD B2C as a
    complete identity platform for your developed applications.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将探索不同的 Azure AD 身份服务以及作为本地身份服务的 AD FS。我们将研究 Azure AD B2B 和 B2C 功能，并解释这些技术背后的主要概念。此外，我们还将查看并扩展在[第
    1 章](54c375d9-b7d0-4478-8777-33935239254b.xhtml)中配置的 Azure AD 域服务，*构建和管理 Azure
    Active Directory*。为了获得完整的视图，我们还将查看 Active Directory 联邦服务的不同功能，以及它们如何支持不同的身份验证场景。您将学习如何在您的项目中使用
    Azure AD B2B 和 B2C 服务，以便为客户、合作伙伴和内部员工提供适当的访问权限。特别是，您可以将 Azure AD B2C 作为您开发应用程序的完整身份平台。
- en: 'The chapter will be divided into the following sections:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将分为以下几个部分：
- en: Preparing your lab environment
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 准备您的实验室环境
- en: Understanding Azure AD **Business to Business** (**B2B**)
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 了解 Azure AD **面向企业**（**B2B**）
- en: Exploring Azure AD **Business to Customer** (**B2C**)
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 探索 Azure AD **面向客户**（**B2C**）
- en: Extending Active Directory solutions with Azure AD Domain Services
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 Azure AD 域服务扩展 Active Directory 解决方案
- en: AD FS as an on-premise identity service for the cloud
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: AD FS 作为云端的本地身份服务
- en: In the first section, we start preparing our lab environment.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 在第一部分中，我们开始准备我们的实验室环境。
- en: Preparing your lab environment
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备您的实验室环境
- en: 'In this chapter, we will need to have an additional Azure AD, configured with
    Office 365, to test the different features. You already know how to create this
    configuration from [Chapter 1](54c375d9-b7d0-4478-8777-33935239254b.xhtml), *Building
    and Managing Azure Active Directory**. *Build this additional tenant with a minimum
    set of configurations. Basically, you''ll need to have a custom domain verified
    and registered, and nothing else. Furthermore, you will need to install Visual
    Studio 2017 Community with the ASP.NET and web development workload on your administrative
    workstation:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将需要一个额外的 Azure AD，并配置 Office 365，以测试不同的功能。您已经知道如何通过[第 1 章](54c375d9-b7d0-4478-8777-33935239254b.xhtml)中的方法创建此配置，*构建和管理
    Azure Active Directory*。创建此额外租户时只需要最小的配置集。基本上，您只需要验证并注册一个自定义域名，其他没有要求。此外，您还需要在您的管理工作站上安装
    Visual Studio 2017 Community，并安装 ASP.NET 和 Web 开发工作负载：
- en: '![](img/5f186b00-0296-4ea8-a9d2-2f16fd0ba48d.png)'
  id: totrans-11
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5f186b00-0296-4ea8-a9d2-2f16fd0ba48d.png)'
- en: Lab environment overview
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 实验室环境概览
- en: To configure the Azure AD Domain Services LDAPS use case, you need to provide
    a public SSL certificate. You can use the procedure from [Chapter 7](468509fa-856c-411d-abdb-e9a39c266750.xhtml),
    *Deploying Solutions on Azure AD and AD FS*, to generate certificates for your
    needs with Let's Encrypt solution. We'll start with the Azure AD B2B functionality.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 若要配置 Azure AD 域服务 LDAPS 使用场景，您需要提供一个公共 SSL 证书。您可以使用[第 7 章](468509fa-856c-411d-abdb-e9a39c266750.xhtml)中的程序，*在
    Azure AD 和 AD FS 上部署解决方案*，利用 Let's Encrypt 解决方案生成适合您需求的证书。我们将从 Azure AD B2B 功能开始。
- en: Understanding Azure AD B2B
  id: totrans-14
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 了解 Azure AD B2B
- en: Azure AD B2B solves the problem of collaboration between business partners.
    It allows users to share business applications between partners, without going
    through inter-company federation relationships and internally-managed partner
    identities. With Azure AD B2B, you can create cross-company relationships by inviting
    and authorizing users from partner companies to access your resources. With this
    process, each company federates once, with Azure AD, and each user is then represented
    by a single Azure AD account. This option also provides a higher security level,
    because if a user leaves the partner organization, access is automatically disallowed.
    Inside of Azure AD, the user will be handled as a guest, and they won't be able
    to traverse other users in the directory. Permissions of the invited user will
    be provided over the correct associated group membership.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD B2B 解决了业务合作伙伴之间的协作问题。它允许用户在合作伙伴之间共享业务应用程序，而无需通过公司间的联合关系和内部管理的合作伙伴身份。通过
    Azure AD B2B，您可以通过邀请和授权来自合作伙伴公司的用户访问您的资源，创建跨公司关系。通过此过程，每个公司与 Azure AD 联合一次，然后每个用户都由一个
    Azure AD 账户表示。这个选项还提供了更高的安全性，因为如果用户离开合作伙伴组织，访问权限将被自动禁用。在 Azure AD 内，用户将作为来宾处理，且不能在目录中遍历其他用户。邀请用户的权限将通过正确关联的组成员身份提供。
- en: 'The following figure shows the process of enabling business partners to access
    your applications:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 下图展示了使业务合作伙伴能够访问您的应用程序的过程：
- en: '![](img/adca06a2-b987-4aef-816d-4581782a6ca4.png)'
  id: totrans-17
  prefs: []
  type: TYPE_IMG
  zh: '![](img/adca06a2-b987-4aef-816d-4581782a6ca4.png)'
- en: Azure AD B2B invitation flows
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD B2B 邀请流程
- en: In the case of **FLOW 1**, the user will be able to sign in to the partner organization
    after they accept, and consent to, the invitation.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 在**FLOW 1**的情况下，用户接受邀请后，将能够登录到合作伙伴组织。
- en: In the case of **FLOW 2**, the user signs up for their own Azure Active Directory
    and will be added to the Azure AD from which the invitation process was started.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 在**FLOW 2**的情况下，用户将注册自己的 Azure Active Directory，并将被添加到启动邀请过程的 Azure AD 中。
- en: You can find more information about the service at [https://docs.microsoft.com/en-us/azure/active-directory/b2b/what-is-b2b](https://docs.microsoft.com/en-us/azure/active-directory/b2b/what-is-b2b).
    In [Chapter 11](c2cd3ca9-8110-49fe-893e-3f4078ee9e26.xhtml), *Creating Identity
    Life Cycle Management on Azure*, we'll provide the configuration tasks for the
    complete guest-management life cycle, which includes the Azure AD B2B portal,
    using Azure MFA, conditional access, and access reviews.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在[https://docs.microsoft.com/en-us/azure/active-directory/b2b/what-is-b2b](https://docs.microsoft.com/en-us/azure/active-directory/b2b/what-is-b2b)找到更多关于该服务的信息。在[第
    11 章](c2cd3ca9-8110-49fe-893e-3f4078ee9e26.xhtml)中，*在 Azure 上创建身份生命周期管理*，我们将提供完整的来宾管理生命周期配置任务，包括使用
    Azure MFA、条件访问和访问审查的 Azure AD B2B 门户。
- en: Providing resource access to external partners (on-premise)
  id: totrans-22
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 为外部合作伙伴提供资源访问（本地部署）
- en: With the following on-premise configuration, we can provide resource access
    to external partners. You can use AD FS for this task, to allow employees and
    customers or partners to access your claims-aware applications. We can achieve
    the goal of providing federated B2B access by configuring federation partners.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 通过以下本地配置，我们可以为外部合作伙伴提供资源访问。您可以使用 AD FS 来执行此任务，以允许员工和客户或合作伙伴访问您的声明感知应用程序。我们可以通过配置联合合作伙伴来实现提供联合
    B2B 访问的目标。
- en: 'The design and the traffic flow are shown in the following diagram:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 设计和流量流程如下面的图所示：
- en: '![](img/80a6590d-7671-4c16-9dfe-317c0af3a41b.png)'
  id: totrans-25
  prefs: []
  type: TYPE_IMG
  zh: '![](img/80a6590d-7671-4c16-9dfe-317c0af3a41b.png)'
- en: ADFS B2B configuration
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: ADFS B2B 配置
- en: Another capability of Active Directory Federation Service is the ability to
    support active clients using the **WS-Trust** specifications. This allows your
    client software to interact with the different players in such a scenario, without
    relying on browser redirects to locate the claims provider, resource provider,
    or other relevant components.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: Active Directory 联合服务的另一个功能是支持使用**WS-Trust**规范的活动客户端。这使得您的客户端软件能够与不同的参与者进行交互，而无需依赖浏览器重定向来查找声明提供者、资源提供者或其他相关组件。
- en: 'The flow runs in the following steps:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 流程按以下步骤进行：
- en: The **Requesting Service** (software on client) queries the **Target Service**
    and requests a list of policy requirements. This includes a list of required claims
    and the STS.
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**请求服务**（客户端上的软件）查询**目标服务**并请求政策要求列表。这包括所需声明的列表和 STS。'
- en: TheRequesting Service queries the **Relying Party STS** for policies. This includes
    the list of claims providers that the STS trusts.
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Requesting Service 查询**Relying Party STS**的策略。这包括 STS 信任的声明提供程序列表。
- en: TheRequesting Service queries the **Claims Provider STS** for the list of policies.
    This includes the required authentication method and other information.
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Requesting Service 查询**Claims Provider STS**以获取策略列表。这包括所需的身份验证方法和其他信息。
- en: TheRequesting Service receives all of the policy information; the client will
    request a token from the **C****laims Provider** (**CP**). This is a direct connection
    to the CP using **SOAP over HTTPS**.
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Requesting Service 接收所有的策略信息；客户端将向**Claims Provider**（**CP**）请求令牌。这是通过**SOAP
    over HTTPS**与 CP 的直接连接。
- en: The **CP** authenticates the user and returns a token.
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**CP** 进行用户身份验证并返回令牌。'
- en: TheRequesting Service receives the token; a token will be directly requested
    from the **Relying Party** (**RP**) using SOAP over HTTPS.
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Requesting Service 接收令牌；令牌将通过 HTTPS 上的 SOAP 直接向**Relying Party**（**RP**）请求。
- en: The **Relying Party Federation** Server signs the token and sends it back to
    the user.
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**Relying Party Federation** 服务器签署令牌并将其发送回用户。'
- en: 'The **Requesting Service receives** the token that has been issued and signed
    by the **Relying Party STS**. It submits the token to the target services and
    receives a response:'
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**Requesting Service 接收**由**Relying Party STS**签发并签名的令牌。它将令牌提交到目标服务并接收响应：'
- en: '![](img/8051c144-6f62-44b9-91f0-67254195437d.png)'
  id: totrans-37
  prefs: []
  type: TYPE_IMG
  zh: '![](img/8051c144-6f62-44b9-91f0-67254195437d.png)'
- en: WS-trust flow
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: WS-trust 流程
- en: Remember that this on-premise extension can always be supported and used with
    Azure Identity and Access Management services.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住，这个本地扩展始终可以与 Azure 身份和访问管理服务一起支持和使用。
- en: Exploring Azure AD B2C
  id: totrans-40
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 探索 Azure AD B2C
- en: Azure AD B2C builds a complete identity-management framework for developers
    and supports signing in to your application using social networks, such as Facebook,
    Google, or LinkedIn, and creating developed accounts with usernames and passwords
    specifically for your company-owned application. Self-service password management
    and profile management are also provided. Additionally, Azure MFA introduces a
    higher grade of security to the solution. Principally, this feature allows for
    small, medium, and large companies to hold their customers in a separate Azure
    Active Directory, with all the capabilities, and more, in a similar way to the
    corporate-managed Azure Active Directory. With different verification options,
    you are also able to provide the necessary identity assurance required for more
    sensible transactions. Azure AD B2C takes care of all of the IAM tasks for your
    own development activities.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD B2C 为开发人员构建了一个完整的身份管理框架，并支持通过社交网络（如 Facebook、Google 或 LinkedIn）登录应用程序，还可以为专门为公司应用程序创建使用用户名和密码的账户。同时，还提供自助密码管理和个人资料管理。此外，Azure
    MFA 通过引入更高等级的安全性，进一步增强了解决方案的安全性。原则上，这项功能允许小型、中型和大型公司将其客户存储在单独的 Azure Active Directory
    中，并拥有与企业管理的 Azure Active Directory 相似的所有功能，甚至更多。通过不同的验证选项，您还能够为更敏感的交易提供必要的身份验证保证。Azure
    AD B2C 为您的开发活动处理所有 IAM 任务。
- en: 'Basically, the minimum architecture with the usage of Azure AD B2C looks like
    the following example. As we already mentioned, Azure AD B2C provides the identity-management
    framework for your application:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 基本上，使用 Azure AD B2C 的最小架构如下所示。如前所述，Azure AD B2C 为您的应用程序提供身份管理框架：
- en: '![](img/a291032e-0aa6-4c8d-a7eb-56d00f615397.png)'
  id: totrans-43
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a291032e-0aa6-4c8d-a7eb-56d00f615397.png)'
- en: Azure AD B2C basic concepts
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD B2C 基本概念
- en: To get a better understanding of Azure AD B2C, we'll build an example application
    from Microsoft that provides a small web application, including a web API. This
    application is a good starting point to get deeper into Azure AD B2C. We highly
    recommend building it in your lab environment. The application can also run against
    a predefined demo environment. You will find the source at [https://github.com/Azure-Samples/active-directory-b2c-dotnet-webapp-and-webapi#Using-the-demo-environment](https://github.com/Azure-Samples/active-directory-b2c-dotnet-webapp-and-webapi#Using-the-demo-environment).
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 为了更好地理解 Azure AD B2C，我们将构建一个来自 Microsoft 的示例应用程序，它提供一个小型 Web 应用程序，包括一个 Web API。这个应用程序是深入了解
    Azure AD B2C 的良好起点。我们强烈建议在您的实验环境中构建该应用程序。该应用程序也可以运行在预定义的演示环境中。您可以在[https://github.com/Azure-Samples/active-directory-b2c-dotnet-webapp-and-webapi#Using-the-demo-environment](https://github.com/Azure-Samples/active-directory-b2c-dotnet-webapp-and-webapi#Using-the-demo-environment)找到源代码。
- en: We recommend working through the following Azure AD B2C introduction before
    you start the lab activities: [https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-overview](https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-overview)
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始实验活动之前，我们建议先学习以下 Azure AD B2C 介绍：[https://docs.microsoft.com/zh-cn/azure/active-directory-b2c/active-directory-b2c-overview](https://docs.microsoft.com/zh-cn/azure/active-directory-b2c/active-directory-b2c-overview)
- en: Let's start our journey and log in to our administrative workstation.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们开始旅程，并登录到我们的管理工作站。
- en: We'll do all of the Azure AD B2C tasks on the first full-blown Azure AD that
    we created.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在我们创建的第一个完整 Azure AD 上执行所有 Azure AD B2C 任务。
- en: In the next section, we will create the Azure AD B2C tenant.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一部分中，我们将创建 Azure AD B2C 租户。
- en: Azure AD B2C tenant creation
  id: totrans-50
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure AD B2C 租户创建
- en: 'Now that we know the basic concept of Azure AD B2C, we will start our configuration
    for the test application that uses Azure AD B2C to provide the identity platform:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们了解了 Azure AD B2C 的基本概念，我们将开始为使用 Azure AD B2C 提供身份平台的测试应用程序进行配置：
- en: 'Open a shell or command line in your Visual Studio project folder, in my case
    `C:\Users\jochen.nickel\Documents\Visual Studio 2017\Projects`, and execute the
    following command:'
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Visual Studio 项目文件夹中打开一个命令行窗口，我的路径是 `C:\Users\jochen.nickel\Documents\Visual
    Studio 2017\Projects`，并执行以下命令：
- en: '[PRE0]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Create the **Azure AD B2C directory**.
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建 **Azure AD B2C 目录**。
- en: Open the Azure Portal ([https://portal.azure.com](https://portal.azure.com))
    with global administrator credentials.
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用全局管理员凭据打开 Azure 门户 ([https://portal.azure.com](https://portal.azure.com))。
- en: 'Use the search option to find the Azure AD B2C blade to view the service that
    we''ll create:'
  id: totrans-56
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用搜索选项查找 Azure AD B2C 窗格，以查看我们将要创建的服务：
- en: '![](img/ccf4d5eb-89e7-424c-aa44-7458ee85ad15.png)'
  id: totrans-57
  prefs: []
  type: TYPE_IMG
  zh: '![](img/ccf4d5eb-89e7-424c-aa44-7458ee85ad15.png)'
- en: Azure AD B2C creation procedure
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD B2C 创建过程
- en: Click on Create a resource in the top-left corner of the Azure portal.
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击 Azure 门户左上角的“创建资源”。
- en: 'Click on Identity and choose Azure Active Directory B2C:'
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击“身份”并选择 Azure Active Directory B2C：
- en: '![](img/037e5dda-3095-4a09-9b32-26d9a3a952ed.png)'
  id: totrans-61
  prefs: []
  type: TYPE_IMG
  zh: '![](img/037e5dda-3095-4a09-9b32-26d9a3a952ed.png)'
- en: Choose Azure AD B2C
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 选择 Azure AD B2C
- en: 'Click on Create a new Azure AD B2C Tenant:'
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击“创建新的 Azure AD B2C 租户”：
- en: '![](img/0693f86b-8923-424e-aa3b-f3c988aa827b.png)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0693f86b-8923-424e-aa3b-f3c988aa827b.png)'
- en: Create the new Azure AD B2C tenant
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 创建新的 Azure AD B2C 租户
- en: 'Use the `YOURDOMAIN1` and `YOURDOMAINB2C` values for your demo environment:'
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `YOURDOMAIN1` 和 `YOURDOMAINB2C` 值作为您的演示环境：
- en: '![](img/087afe05-7684-44dc-97ba-be18e038d85a.png)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
  zh: '![](img/087afe05-7684-44dc-97ba-be18e038d85a.png)'
- en: Azure AD B2C properties
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD B2C 属性
- en: 'Link the new Azure AD B2C to our Azure subscription:'
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将新的 Azure AD B2C 与我们的 Azure 订阅关联：
- en: '![](img/c8624929-7cf3-471a-8a8b-f41c4aedddd5.png)'
  id: totrans-70
  prefs: []
  type: TYPE_IMG
  zh: '![](img/c8624929-7cf3-471a-8a8b-f41c4aedddd5.png)'
- en: Linking the Azure AD B2C tenant
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 关联 Azure AD B2C 租户
- en: 'Switch the directory to use the new Azure AD B2C tenant:'
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 切换目录以使用新的 Azure AD B2C 租户：
- en: '![](img/f5392e27-b426-4096-951a-00f80e413d32.png)'
  id: totrans-73
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f5392e27-b426-4096-951a-00f80e413d32.png)'
- en: Azure AD directory switching
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD 目录切换
- en: 'Use the Azure AD B2C directory:'
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 Azure AD B2C 目录：
- en: '![](img/e512e211-6e95-4429-85fe-0382b2efffba.png)'
  id: totrans-76
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e512e211-6e95-4429-85fe-0382b2efffba.png)'
- en: Choose the newly created Azure AD B2C tenant
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 选择新创建的 Azure AD B2C 租户
- en: 'Navigate to the Azure AD B2C blade:'
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到 Azure AD B2C 窗格：
- en: '![](img/21a2b993-cc5e-4a99-a301-51be0ddb5b63.png)'
  id: totrans-79
  prefs: []
  type: TYPE_IMG
  zh: '![](img/21a2b993-cc5e-4a99-a301-51be0ddb5b63.png)'
- en: Azure AD B2C overview page
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD B2C 概述页面
- en: In the next section, we will configure the demo application in Azure AD.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一部分中，我们将配置 Azure AD 中的演示应用程序。
- en: Demo app registration
  id: totrans-82
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 演示应用注册
- en: 'Next, we''ll register the new `Demo Web App` and the Web AppAPI under application:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将在应用程序下注册新的 `Demo Web App` 和 Web AppAPI：
- en: 'Add the web app, as shown in the following screenshot:'
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照以下截图所示添加 Web 应用：
- en: '![](img/94e7d831-7d91-4953-8417-2350e7bfdfda.png)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
  zh: '![](img/94e7d831-7d91-4953-8417-2350e7bfdfda.png)'
- en: Provide the app properties
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 提供应用程序属性
- en: 'Create an app key:'
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建应用密钥：
- en: '![](img/d3e47636-fdbc-4e25-94b5-d91544aa759f.png)'
  id: totrans-88
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d3e47636-fdbc-4e25-94b5-d91544aa759f.png)'
- en: App key generation process
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 应用密钥生成过程
- en: Copy the key value to a notepad.
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将密钥值复制到记事本。
- en: Copy the app ID under the properties section to the notepad.
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将应用 ID 从属性部分复制到记事本。
- en: Register the second app for the Web App API.
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为 Web App API 注册第二个应用程序。
- en: 'Fill in the values, as shown in the following screenshot:'
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 填写如下截图所示的值：
- en: '![](img/36fa302a-7db7-4f93-a277-6105bbc65cae.png)'
  id: totrans-94
  prefs: []
  type: TYPE_IMG
  zh: '![](img/36fa302a-7db7-4f93-a277-6105bbc65cae.png)'
- en: Register the second application with properties
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 注册具有属性的第二个应用程序
- en: Copy the App ID URI (optional) to the notepad.
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将应用 ID URI（可选）复制到记事本。
- en: 'Configure the Published scopes of the web API:'
  id: totrans-97
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置 Web API 的发布作用域：
- en: Hello.Write | Write access to hello
  id: totrans-98
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Hello.Write | 对 hello 的写访问
- en: 'Hello.Read | Read access to hello:'
  id: totrans-99
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Hello.Read | 对 hello 的读取访问：
- en: '![](img/235e4f28-b3db-401d-9486-8a36dfcfd5df.png)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
  zh: '![](img/235e4f28-b3db-401d-9486-8a36dfcfd5df.png)'
- en: Defining scopes
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 定义作用域
- en: Change to the Web App and API access section.
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 切换到 Web 应用和 API 访问部分。
- en: 'Click on Add and select the Demo Web API:'
  id: totrans-103
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“添加”，选择演示 Web API：
- en: '![](img/3ddfd61d-9465-4362-89ff-45dfd4e8b050.png)'
  id: totrans-104
  prefs: []
  type: TYPE_IMG
  zh: '![](img/3ddfd61d-9465-4362-89ff-45dfd4e8b050.png)'
- en: Define the app access
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 定义应用访问权限
- en: 'You should be presented with the following:'
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你应该看到以下内容：
- en: '![](img/979fd52b-2f60-4b45-a26e-df8f5f8d8712.png)'
  id: totrans-107
  prefs: []
  type: TYPE_IMG
  zh: '![](img/979fd52b-2f60-4b45-a26e-df8f5f8d8712.png)'
- en: API access result
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: API 访问结果
- en: 'You should have a notepad with the following values:'
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你应该有一个记事本，其中包含以下值：
- en: '[PRE1]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Now, we can start the user flow creation in Azure AD B2C.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以开始在 Azure AD B2C 中创建用户流程。
- en: User flow creation
  id: totrans-112
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 用户流程创建
- en: In the following section, we will configure the first user flow in Azure AD
    B2C to get a user sign-up process to the demo application.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的部分中，我们将配置 Azure AD B2C 中的第一个用户流程，获取用户注册流程并将其引导到演示应用程序。
- en: 'Next, we will create our first user flow:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将创建我们的第一个用户流程：
- en: 'Navigate to user flows (policies) and create your first flow:'
  id: totrans-115
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到用户流程（策略），并创建你的第一个流程：
- en: '![](img/7dca4889-7a6c-48f0-ba48-b762825e6171.png)'
  id: totrans-116
  prefs: []
  type: TYPE_IMG
  zh: '![](img/7dca4889-7a6c-48f0-ba48-b762825e6171.png)'
- en: New user flow creation
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 新用户流程创建
- en: 'Use the Sign up and sign in option:'
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用注册和登录选项：
- en: '![](img/659bdb77-c731-4682-b813-ba5198d50056.png)'
  id: totrans-119
  prefs: []
  type: TYPE_IMG
  zh: '![](img/659bdb77-c731-4682-b813-ba5198d50056.png)'
- en: Choosing the Sign up and sign in option
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 选择注册和登录选项
- en: 'Use the following values for the flow:'
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于流程，使用以下值：
- en: '![](img/90bfcf98-1fe3-4cd9-99fc-270c3ad8ad23.png)'
  id: totrans-122
  prefs: []
  type: TYPE_IMG
  zh: '![](img/90bfcf98-1fe3-4cd9-99fc-270c3ad8ad23.png)'
- en: Defining the flow properties
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 定义流程属性
- en: 'And the following attributes:'
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以及以下属性：
- en: '![](img/e8c9318f-1941-432c-a0cc-f322cb464beb.png)'
  id: totrans-125
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e8c9318f-1941-432c-a0cc-f322cb464beb.png)'
- en: Choosing the attributes that will be collected and will also return a claim
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 选择将被收集并返回声明的属性
- en: Click on Create.
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“创建”。
- en: Now that we have prepared the Sign up and sign in options, we can start to modify
    the demo application code.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经准备好了注册和登录选项，可以开始修改演示应用程序的代码。
- en: Visual Studio code modification
  id: totrans-129
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Visual Studio 代码修改
- en: To use the newly created user flow, we need to modify the demo application code.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用新创建的用户流程，我们需要修改演示应用程序的代码。
- en: 'Modify the `TaskWebApp` project, as follows:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 修改`TaskWebApp`项目，内容如下：
- en: Open the `web.config` file from `TaskWebApp`.
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开`TaskWebApp`中的`web.config`文件。
- en: 'Find the following keys and replace them:'
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 找到以下密钥并替换它们：
- en: '`ida:Tenant`, with your tenant name, `yourdomainb2c.onmicrosoft.com`'
  id: totrans-134
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ida:Tenant`，使用你的租户名称`yourdomainb2c.onmicrosoft.com`'
- en: '`ida:ClientId`, with the app ID from the notepad'
  id: totrans-135
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ida:ClientId`，使用记事本中的应用 ID'
- en: '`ida:ClientSecret`, with your key from the notepad'
  id: totrans-136
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ida:ClientSecret`，使用记事本中的密钥'
- en: '`ida:SignUpSignInPolicyId`, with `b2c_1_SiUpIn`'
  id: totrans-137
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ida:SignUpSignInPolicyId`，值为`b2c_1_SiUpIn`'
- en: 'Comment out the following entries:'
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 注释掉以下条目：
- en: '[PRE2]'
  id: totrans-139
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Uncomment the following entries:'
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 取消注释以下条目：
- en: '[PRE3]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Change the `api:ApiIdentifier` key value to the app ID URI of the API:'
  id: totrans-142
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`api:ApiIdentifier`的键值更改为 API 的应用 ID URI：
- en: '[PRE4]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Your code should look as follows:'
  id: totrans-144
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你的代码应该如下所示：
- en: '![](img/a81ab074-d9f1-449d-8ac8-f49ef4f90dd7.png)'
  id: totrans-145
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a81ab074-d9f1-449d-8ac8-f49ef4f90dd7.png)'
- en: Modified code reference
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 修改后的代码引用
- en: 'Modify the `TaskService` project, as follows:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 修改`TaskService`项目，内容如下：
- en: Open the `Web.config` file from the `TaskService` project.
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开`TaskService`项目中的`Web.config`文件。
- en: 'Find the following keys and replace them:'
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 找到以下密钥并替换它们：
- en: '`ida:Tenant`, with your `yourdomainb2c.onmicrosoft.com`'
  id: totrans-150
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ida:Tenant`，值为`yourdomainb2c.onmicrosoft.com`'
- en: '`ida:ClientId`, with the application ID from your web API'
  id: totrans-151
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ida:ClientId`，使用来自你的 Web API 的应用程序 ID'
- en: '`ida:SignUpSignInPolicyId`, with `b2c_1_SiUpIn`'
  id: totrans-152
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ida:SignUpSignInPolicyId`，值为`b2c_1_SiUpIn`'
- en: '`api:ReadScope`, with `Hello.Read`'
  id: totrans-153
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`api:ReadScope`，使用`Hello.Read`'
- en: '`api:WriteScope`, with `Hello.Write`'
  id: totrans-154
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`api:WriteScope`，值为`Hello.Write`'
- en: 'Your code should look like this:'
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你的代码应该是这样的：
- en: '![](img/61e626ca-3091-43f2-aa04-ed2a500eab1f.png)'
  id: totrans-156
  prefs: []
  type: TYPE_IMG
  zh: '![](img/61e626ca-3091-43f2-aa04-ed2a500eab1f.png)'
- en: Modified code reference
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 修改后的代码引用
- en: 'The Visual Studio Startup Project modification is as follows:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: Visual Studio 启动项目修改如下：
- en: Go to the Solution Explorer and right-click on Properties.
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到解决方案资源管理器，右键点击“属性”。
- en: Under Common Properties, go to Startup Project.
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在常规属性下，转到启动项目。
- en: 'Use the following configuration:'
  id: totrans-161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下配置：
- en: '![](img/b127c982-4376-485b-b007-68240eb25fc0.png)'
  id: totrans-162
  prefs: []
  type: TYPE_IMG
  zh: '![](img/b127c982-4376-485b-b007-68240eb25fc0.png)'
- en: Configuring the project start up options
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 配置项目启动选项
- en: 'Press *F5* in Visual Studio to start both the Web App and the Web App API:'
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Visual Studio 中按*F5*，启动 Web 应用和 Web 应用 API：
- en: '![](img/532bda90-6f96-453a-aa5d-49599549c63b.png)'
  id: totrans-165
  prefs: []
  type: TYPE_IMG
  zh: '![](img/532bda90-6f96-453a-aa5d-49599549c63b.png)'
- en: Started applications view
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 启动应用程序视图
- en: 'Click on Sign up/Sign In on the web app, and Azure AD B2C will come into the
    game:'
  id: totrans-167
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 Web 应用上的 注册/登录，Azure AD B2C 就会参与进来：
- en: '![](img/0fe711b8-1ff2-46ce-91e4-101892114ed2.png)'
  id: totrans-168
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0fe711b8-1ff2-46ce-91e4-101892114ed2.png)'
- en: Testing the user flow
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 测试用户流程
- en: Click on Sign up now.
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 立即注册。
- en: 'Enter your details and click on Send verification code:'
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入您的信息并点击 发送验证代码：
- en: '![](img/2780ae59-f3cb-4022-9145-c905d5132f80.png)'
  id: totrans-172
  prefs: []
  type: TYPE_IMG
  zh: '![](img/2780ae59-f3cb-4022-9145-c905d5132f80.png)'
- en: Providing the required data
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 提供所需的资料
- en: 'You''ll receive an email with the verification code, as follows:'
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您将收到一封包含验证代码的电子邮件，内容如下：
- en: '![](img/22634846-deb7-4c57-902b-9d38de834654.png)'
  id: totrans-175
  prefs: []
  type: TYPE_IMG
  zh: '![](img/22634846-deb7-4c57-902b-9d38de834654.png)'
- en: Get your verification code
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 获取您的验证代码
- en: Verify and create the account.
  id: totrans-177
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 验证并创建帐户。
- en: 'Azure MFA will now come into the game; provide your preferred verification
    option:'
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，Azure MFA 将参与进来；请选择您首选的验证选项：
- en: '![](img/7f57a770-f6be-4faa-8975-ef3ec3c8b407.png)'
  id: totrans-179
  prefs: []
  type: TYPE_IMG
  zh: '![](img/7f57a770-f6be-4faa-8975-ef3ec3c8b407.png)'
- en: Providing your verification
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 提供您的验证
- en: 'You''ve successfully signed in, and you can view your claims:'
  id: totrans-181
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您已成功登录，可以查看您的声明：
- en: '![](img/53f10f96-6cda-4947-b2c7-4f71a86c8c8a.png)'
  id: totrans-182
  prefs: []
  type: TYPE_IMG
  zh: '![](img/53f10f96-6cda-4947-b2c7-4f71a86c8c8a.png)'
- en: Successful login on the demo app, including the provided claims
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 演示应用程序登录成功，包括提供的声明
- en: Yeah! Well done. You can dive deeper into Azure AD B2C at [https://docs.microsoft.com/en-us/azure/active-directory-b2c/](https://docs.microsoft.com/en-us/azure/active-directory-b2c/)[.](https://bit.ly/2AVqifY)
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 好极了！做得好。您可以在 [https://docs.microsoft.com/zh-cn/azure/active-directory-b2c/](https://docs.microsoft.com/en-us/azure/active-directory-b2c/) 上深入了解
    Azure AD B2C[。](https://bit.ly/2AVqifY)
- en: Comparing Azure AD B2B and B2C
  id: totrans-185
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 比较 Azure AD B2B 和 B2C
- en: Basically, both of the Azure AD services allow you to work with external users.
    Azure AD B2B focuses on the business to simplify the collaboration process with
    the secure sharing of information and resources. It takes care of the federation
    between the organizations and allows for a simple invitation-and-redemption process
    with different account types, such as school and work accounts, or simply an email
    account.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 基本上，这两个 Azure AD 服务都允许您与外部用户协作。Azure AD B2B 专注于简化与合作伙伴的协作流程，通过安全共享信息和资源来实现。它处理组织之间的联合，并允许不同帐户类型（如学校帐户、工作帐户，或仅仅是电子邮件帐户）进行简单的邀请和兑换过程。
- en: 'Azure AD B2C focuses on developers that create customer-facing apps. Developers
    get a full-featured identity system for their applications. Azure AD B2C provides
    a local repository and the sign-in experience with many other identity providers:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD B2C 专注于创建面向客户的应用程序的开发人员。开发人员为其应用程序提供全功能的身份系统。Azure AD B2C 提供本地存储库和与其他多个身份提供商的登录体验：
- en: '| **Azure AD B2B** | **Azure AD B2C** |'
  id: totrans-188
  prefs: []
  type: TYPE_TB
  zh: '| **Azure AD B2B** | **Azure AD B2C** |'
- en: '| Authentication of users from partner organizations | Customer access with
    mobile and web apps |'
  id: totrans-189
  prefs: []
  type: TYPE_TB
  zh: '| 来自合作伙伴组织的用户身份验证 | 移动和 Web 应用程序的客户访问 |'
- en: '| Partner life cycle = host and inviting organizations, including access reviews
    | Customer life cycle = self-service or application-managed |'
  id: totrans-190
  prefs: []
  type: TYPE_TB
  zh: '| 合作伙伴生命周期 = 主机和邀请组织，包括访问审查 | 客户生命周期 = 自助服务或应用程序管理 |'
- en: '| Supports work or school accounts, or any email address | Supports local user
    application accounts or supported identity providers |'
  id: totrans-191
  prefs: []
  type: TYPE_TB
  zh: '| 支持工作或学校帐户，或任何电子邮件地址 | 支持本地用户应用帐户或受支持的身份提供商 |'
- en: '| Supports SSO to all Azure AD connected applications | Supports SSO to customer-owned
    applications within the Azure AD B2C tenants |'
  id: totrans-192
  prefs: []
  type: TYPE_TB
  zh: '| 支持对所有 Azure AD 连接应用程序的单点登录（SSO） | 支持对 Azure AD B2C 租户内客户自有应用程序的单点登录（SSO）
    |'
- en: '| Security policy managed by both organizations | Security policy managed by
    the application |'
  id: totrans-193
  prefs: []
  type: TYPE_TB
  zh: '| 双方组织共同管理安全策略 | 应用程序管理安全策略 |'
- en: '| Branding managed by both organizations | Branding managed by the application
    |'
  id: totrans-194
  prefs: []
  type: TYPE_TB
  zh: '| 双方组织共同管理品牌 | 应用程序管理品牌 |'
- en: '| Partner users are included in the same Azure AD, by default, with the guest
    user type | Managed separately from the organization or partner Azure AD |'
  id: totrans-195
  prefs: []
  type: TYPE_TB
  zh: '| 合作伙伴用户默认包含在同一个 Azure AD 中，用户类型为来宾 | 与组织或合作伙伴的 Azure AD 分开管理 |'
- en: In the next section, we'll compare AD FS against the two services, to provide
    you with a global view.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的章节中，我们将比较 AD FS 与这两项服务，以为您提供一个全面的视角。
- en: Comparing AD FS with Azure B2B and B2C
  id: totrans-197
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 比较 AD FS 与 Azure B2B 和 B2C
- en: In this section, we'll provide you with some helpful information so that you
    can differentiate between AD FS and the Azure AD B2B and B2C functionalities.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将提供一些有用的信息，以帮助您区分 AD FS 和 Azure AD B2B 以及 B2C 的功能。
- en: We'll start with the main differences between AD FS and the Azure B2B scenario.
    With Azure AD B2B comes the capability to invite users from partner organizations
    to access applications on your own Azure AD instance. With AD FS, you can provide
    the same functionality, with CP trusts, to any partner organization that's based
    on AD FS.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将从 AD FS 和 Azure B2B 场景之间的主要差异开始。使用 Azure AD B2B，可以邀请来自合作伙伴组织的用户访问你自己 Azure
    AD 实例中的应用程序。使用 AD FS，你可以通过 CP 信任为任何基于 AD FS 的合作伙伴组织提供相同的功能。
- en: 'However, you will hit the following differences:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，你将遇到以下差异：
- en: With AD FS, you have a lot of flexibility, and can run any customized scenario
  id: totrans-201
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 AD FS，你具有很大的灵活性，可以运行任何自定义的场景。
- en: 'The following requirements need to be fulfilled:'
  id: totrans-202
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 以下要求需要满足：
- en: Partner requires the Federation Service
  id: totrans-203
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 合作伙伴需要联合服务
- en: Certificate handling
  id: totrans-204
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 证书处理
- en: Administrative overhead
  id: totrans-205
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 管理开销
- en: With **Azure AD B2B**, there is an easy invitation process. The feature is available
    for free, or by using a **5.1 ratio** if basic or premium features are used, and
    the partner doesn't need to fulfill any requirements—invitations for Azure AD
    and locally-based directory users, including social identities, are possible.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 使用**Azure AD B2B**，有一个简单的邀请流程。该功能免费提供，或者如果使用基本或高级功能，则按**5.1 比例**计费，合作伙伴无需满足任何要求——可以向
    Azure AD 和本地目录用户（包括社交身份）发送邀请。
- en: The admin controls all of the access to your corporate apps through your Azure
    AD directory. When collaboration is terminated, partner users can be removed from
    your Azure AD, and their access to your apps will immediately be revoked. Access
    reviews can be used to manage the life cycles of guest users. Additionally, when
    a partner user leaves the partner organization, access is automatically lost if
    the partner organizations uses a native Azure AD and not an AdHoc (unmanaged Azure
    AD tenant).
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 管理员通过 Azure AD 目录控制对公司应用程序的所有访问。当合作关系终止时，合作伙伴用户可以从你的 Azure AD 中删除，且他们对你应用程序的访问将立即被撤销。可以使用访问审查来管理来宾用户的生命周期。此外，当合作伙伴用户离开合作伙伴组织时，如果该合作伙伴组织使用本地
    Azure AD 而非 AdHoc（非托管的 Azure AD 租户），他们的访问权限将自动丧失。
- en: Keep in mind that if you still want to use AD FS for B2B, you will need to manage
    the whole life cycle of the guest user's account.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住，如果你仍然希望使用 AD FS 进行 B2B，你将需要管理来宾用户账户的整个生命周期。
- en: The next thing that we will discuss is the difference between AD FS and Azure
    AD B2C. You have two main scenarios that you can run. First, you can handle customer
    accounts and an on-premise identity store, and the authentication can be managed
    by AD FS. This scenario is helpful if you want to have full control in your own
    environment. But you also need to provide several processes and technologies to
    support such a scenario—and this is for the whole year.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来我们将讨论 AD FS 和 Azure AD B2C 之间的差异。你可以运行两种主要场景。首先，你可以处理客户账户和本地身份存储，身份验证可以由
    AD FS 管理。如果你希望在自己的环境中拥有完全的控制权，这个场景会很有用。但你还需要提供多种流程和技术来支持这种场景——这适用于整年。
- en: The other option is that customers can sign up or bring their own consumer identities
    with Azure AD B2C, so you will receive a fully-manageable solution with high availability
    and the most common processes and support functionalities already implemented.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种选择是客户可以使用 Azure AD B2C 注册或带来自己的消费者身份，这样你将获得一个完全可管理的解决方案，具有高可用性，并且大多数常见的流程和支持功能已经实现。
- en: AD FS delivers a very flexible and customizable solution in your own environment,
    but you have to integrate social media providers and build trust relationships,
    so that the users can bring their own identities. As we already mentioned, user
    management and self-servicing have to be built and provided with high availability.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: AD FS 提供了一个非常灵活且可定制的解决方案，适用于你自己的环境，但你需要集成社交媒体提供商并建立信任关系，以便用户能够使用他们自己的身份。如前所述，用户管理和自助服务必须构建并提供高可用性。
- en: With Azure AD B2C, you receive a fully-packed solution, which allows for the
    developer of a business application to use the whole identity framework of Azure
    AD and the B2C extensions. Sign-up pages are ready to use, or users can bring
    their own identities (Google, Live, Facebook, and so on), and you can enable self-servicing
    options.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 Azure AD B2C，你将获得一个完整的解决方案，它允许业务应用程序的开发者使用 Azure AD 的整个身份框架和 B2C 扩展。注册页面已准备好使用，或者用户可以使用他们自己的身份（如
    Google、Live、Facebook 等），并且你可以启用自助服务选项。
- en: Extending Active Directory solutions with Azure AD Domain Services
  id: totrans-213
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 Azure AD 域服务扩展 Active Directory 解决方案
- en: Azure AD Domain Services helps you to move your on-premise applications, depending on
    traditional authentication methods, such as Kerberos and NTLM, to the cloud. This
    cloud-based service allows you to join your IaaS virtual machines to a managed
    domain without the need to provide domain controllers on virtual machines. With
    this solution, you can integrate your applications directly in your Azure Active
    Directory services and benefit from the rich feature set. With the synchronization
    of the Azure AD users to Azure AD DS, you can use identities to provide authentication
    and authorization. You're also able to connect by **Lightweight Directory Access
    Protocol** (**LDAP/S**) to the directory service.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD 域服务帮助您将依赖于传统身份验证方法（如 Kerberos 和 NTLM）的本地应用程序迁移到云中。此基于云的服务使您能够将 IaaS
    虚拟机加入到托管域，而无需在虚拟机上提供域控制器。通过此解决方案，您可以将应用程序直接集成到 Azure Active Directory 服务中，并享受丰富的功能集。随着
    Azure AD 用户同步到 Azure AD DS，您可以使用身份进行身份验证和授权。您还可以通过 **轻量级目录访问协议** (**LDAP/S**)
    连接到目录服务。
- en: 'The following diagram shows the integration scenario, from the perspective
    of an application installed on an IaaS virtual machine:'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 以下图示展示了从安装在 IaaS 虚拟机上的应用程序角度看集成场景：
- en: '![](img/5847465d-3676-4d90-b74c-7ac1ffbfadb5.png)'
  id: totrans-216
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5847465d-3676-4d90-b74c-7ac1ffbfadb5.png)'
- en: Azure AD Domain Services overview
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD 域服务概述
- en: This service provides you with a flat organizational unit structure and group
    policies, by default, for managing the domain-joined server systems. Generally,
    it's not a good idea to join client computers in this directory.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 该服务为您提供一个扁平的组织单位结构和默认的组策略，用于管理加入域的服务器系统。通常来说，将客户端计算机加入此目录并不是一个好主意。
- en: 'The service is used to help you with the integration of the following systems:'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 该服务用于帮助您集成以下系统：
- en: NAS systems
  id: totrans-220
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: NAS 系统
- en: Print solutions
  id: totrans-221
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 打印解决方案
- en: It also lifts your on-premise services to Azure if they aren't claims-enabled.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您的本地服务没有启用声明，它也可以将您的本地服务迁移到 Azure。
- en: 'The following configuration shows you how to extend the solution from [Chapter
    1](54c375d9-b7d0-4478-8777-33935239254b.xhtml), *Building and Managing Azure Active
    Directory*, where we first enabled the service. To configure this solution, you
    will need to have a certificate. Refer to [Chapter 8](efbe1917-c755-4449-b29e-fa4a21e819fd.xhtml),
    *Using the Azure AD App Proxy and the Web Application Proxy*, to find instructions
    for creating a certificate for this purpose. Perform the following steps:'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 以下配置展示了如何从 [第一章](54c375d9-b7d0-4478-8777-33935239254b.xhtml)，*构建和管理 Azure Active
    Directory*，扩展解决方案，在该章节中我们首次启用了该服务。要配置此解决方案，您需要拥有证书。请参阅 [第八章](efbe1917-c755-4449-b29e-fa4a21e819fd.xhtml)，*使用
    Azure AD 应用程序代理和 Web 应用程序代理*，查找为此目的创建证书的说明。执行以下步骤：
- en: Navigate to [https://portal.azure.com](https://portal.azure.com) on the Azure
    AD Domain Services blade.
  id: totrans-224
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Azure AD 域服务面板中导航到 [https://portal.azure.com](https://portal.azure.com)。
- en: 'Choose Secure LDAP and Enable the service:'
  id: totrans-225
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择“安全 LDAP”并启用该服务：
- en: '![](img/075ad8cb-9748-4433-8fe2-56c43e90856f.png)'
  id: totrans-226
  prefs: []
  type: TYPE_IMG
  zh: '![](img/075ad8cb-9748-4433-8fe2-56c43e90856f.png)'
- en: Secure LDAP activation procedure
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 安全 LDAP 激活程序
- en: 'Enable the Allow secure LDAP access over the internet, and upload the certificate,
    including the private key:'
  id: totrans-228
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启用“允许通过互联网进行安全 LDAP 访问”，并上传证书，包括私钥：
- en: '![](img/0b938e07-5335-40d2-8723-00ac17b530eb.png)'
  id: totrans-229
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0b938e07-5335-40d2-8723-00ac17b530eb.png)'
- en: Providing the certificate
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 提供证书
- en: Create a new LDAPS security rule in the network security group.
  id: totrans-231
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在网络安全组中创建一个新的 LDAPS 安全规则。
- en: 'Add a rule with your source IP and the Azure AD DS destination network:'
  id: totrans-232
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加一个规则，包含您的源 IP 和 Azure AD DS 目标网络：
- en: '![](img/4cc813b5-6bb4-4581-bd3e-0aa1db006843.png)'
  id: totrans-233
  prefs: []
  type: TYPE_IMG
  zh: '![](img/4cc813b5-6bb4-4581-bd3e-0aa1db006843.png)'
- en: Changing the firewall rules to allow LDAPS
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 更改防火墙规则以允许 LDAPS
- en: 'Connect to the LDAPS service with your preferred LDAP browser:'
  id: totrans-235
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用您偏好的 LDAP 浏览器连接到 LDAPS 服务：
- en: '![](img/a2aaad63-c812-44bf-98a9-6e205e107014.png)'
  id: totrans-236
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a2aaad63-c812-44bf-98a9-6e205e107014.png)'
- en: Testing the LDAPS connection
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 测试 LDAPS 连接
- en: You can find more information about the LDAPS configuration at [https://docs.microsoft.com/en-us/azure/active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap](https://docs.microsoft.com/en-us/azure/active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap).
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在 [https://docs.microsoft.com/en-us/azure/active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap](https://docs.microsoft.com/en-us/azure/active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap)
    上找到有关 LDAPS 配置的更多信息。
- en: In the next section, we'll discuss how to use AD FS as an on-premise identity
    service for the cloud.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节中，我们将讨论如何将AD FS作为云端的本地身份服务使用。
- en: AD FS as an on-premise identity service for the cloud
  id: totrans-240
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: AD FS作为云端的本地身份服务
- en: Authenticating users in multi-forest environments is just a bit more complex
    than doing it in a typical single-forest deployment. You should already be aware
    of the basics of the different authentication protocols and AD FS, thanks to previous
    chapters. The configuration of the integration with Office 365 is a straightforward
    process; with the `Convert-MsolDomainToFederated` command, you can create everything
    that's needed in your AD FS configuration. With the `SupportMultipleDomain` switch,
    you can define whether you're using a multi-forest scenario.
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 在多森林环境中验证用户比在典型的单森林部署中稍微复杂一些。由于前几章节的基础知识，您应该已经了解到不同的身份验证协议和AD FS。与Office 365的集成配置是一个简单的过程；使用`Convert-MsolDomainToFederated`命令，您可以在AD
    FS配置中创建所需的一切。通过`SupportMultipleDomain`开关，您可以定义是否使用多森林场景。
- en: Next, we'll start with the supported and possible scenarios in the case of using
    multiple forests and Office 365\. We'll focus on the AD FS server deployment.
    Furthermore, you can always attach an AD FS proxy/WAP to these scenarios.
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将讨论在使用多个森林和Office 365的情况下支持的和可能的场景。我们将重点介绍AD FS服务器的部署。此外，您始终可以将AD FS代理/WAP附加到这些场景中。
- en: 'This section will cover the following scenarios:'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 本节将涵盖以下场景：
- en: A typical single-forest deployment
  id: totrans-244
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 典型的单森林部署
- en: Two or more Active Directory forests running separate AD FS instances
  id: totrans-245
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 两个或更多个运行分开AD FS实例的Active Directory森林
- en: Running one AD FS instance for multiple trusted forests
  id: totrans-246
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 运行单个AD FS实例以支持多个受信任的森林
- en: Supporting one AD FS instance for multiple Active Directory forests without
    an AD trust relationship
  id: totrans-247
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 支持多个Active Directory森林的单个AD FS实例，无需AD信任关系
- en: Using a local CP trust to support multiple Active Directory forests
  id: totrans-248
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用本地CP信任支持多个Active Directory森林
- en: Using a shared Active Directory environment
  id: totrans-249
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用共享的Active Directory环境
- en: Microsoft Cloud Solution Provider summary
  id: totrans-250
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Microsoft云解决方案提供商总结
- en: Typical single-forest deployment
  id: totrans-251
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 典型的单森林部署
- en: 'This scenario is a commonly seen configuration in smaller and medium-sized
    organizations; it''s a one-forest scenario with AD FS authentication to Office
    365\. You can use one or more UPNs with the related verified UPN domains:'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 这种情况在中小型组织中非常常见；这是一个单森林场景，使用AD FS认证到Office 365。您可以使用一个或多个与验证过的UPN域相关的UPN：
- en: '![](img/ca657763-f2a0-4807-92bd-d109585a725d.png)'
  id: totrans-253
  prefs: []
  type: TYPE_IMG
  zh: '![](img/ca657763-f2a0-4807-92bd-d109585a725d.png)'
- en: Single-forest deployment
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 单森林部署
- en: We will follow up with the multiple AD forest scenarios in the next section.
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在下一节详细讨论多个AD森林场景。
- en: Two or more Active Directory forests running separate AD FS instances
  id: totrans-256
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 两个或更多个运行分开AD FS实例的Active Directory森林
- en: 'This scenario is commonly used if there are no Active Directory trust relationships
    and CP trusts are in place. Every Active Directory forest holds its own AD FS server
    and responds to their own UPN. The administrator only needs to configure a unique
    UPN suffix. Azure AD Connect will do the relevant identity synchronization for
    the different forests:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 如果没有Active Directory信任关系且存在CP信任，则通常会使用此场景。每个Active Directory森林都拥有自己的AD FS服务器，并响应其自己的UPN。管理员只需配置唯一的UPN后缀。Azure
    AD Connect将为不同森林进行相关的身份同步：
- en: '![](img/1cb52f5b-59dc-4540-b4ab-a9194563d270.png)'
  id: totrans-258
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1cb52f5b-59dc-4540-b4ab-a9194563d270.png)'
- en: Two or more Active Directory forests running separate AD FS instances
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 两个或更多个运行分开AD FS实例的Active Directory森林
- en: In the next section, we will discuss a one-instance ADFS scenario for multiple
    forests.
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节中，我们将讨论多森林的单实例ADFS场景。
- en: Running one AD FS instance for multiple trusted forests
  id: totrans-261
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 运行单个AD FS实例以支持多个受信任的森林
- en: 'Many organizations run several Active Directory forests. If a single authentication
    point is provided, one option is to work with an Active Directory **Trust Relationship**.
    With this design solution, every forest can use one AD FS environment, and all
    UPNs are running against this environment:'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 许多组织运行多个Active Directory森林。如果提供单一的身份验证点，一个选项是使用Active Directory **信任关系**。通过这种设计解决方案，每个森林可以使用一个AD
    FS环境，所有UPN都运行在这个环境中：
- en: '![](img/ee4bce0d-e147-4884-aab1-db2a2983a05c.png)'
  id: totrans-263
  prefs: []
  type: TYPE_IMG
  zh: '![](img/ee4bce0d-e147-4884-aab1-db2a2983a05c.png)'
- en: One AD FS instance for multiple trusted forests
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 单个AD FS实例以支持多个受信任的森林
- en: Next, we will discuss the one ADFS instance approach for multiple forests without
    trust relationships.
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将讨论没有信任关系的多个林使用一个ADFS实例的方式。
- en: One AD FS instance for multiple Active Directory forests without an AD trust
  id: totrans-266
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 一个AD FS实例支持多个Active Directory林，且没有AD信任
- en: 'Another option for supporting multiple forests is to work with a CP trust,
    if Active Directory trust relationships can''t be used. In this scenario, the
    AD FS server works, by default, against its own Active Directory forest. The AD
    FS server will also be configured to ask another AD FS for specific UPNs:'
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 支持多个林的另一个选项是使用CP信任，如果无法使用Active Directory信任关系。在此场景中，AD FS服务器默认情况下会与其自己的Active
    Directory林一起工作。AD FS服务器还将被配置为向另一个AD FS请求特定的UPN：
- en: '![](img/d91cbfe2-c7d8-4025-a736-2afc2c17bd0b.png)'
  id: totrans-268
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d91cbfe2-c7d8-4025-a736-2afc2c17bd0b.png)'
- en: One AD FS instance for multiple Active Directory forests without an AD trust
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 一个AD FS实例支持多个Active Directory林，且没有AD信任
- en: In the next steps, we will discuss using the local claims provider trust to
    connect multiple AD forests.
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的步骤中，我们将讨论如何使用本地声明提供程序信任连接多个AD林。
- en: Using a local CP trust to support multiple Active Directory forests
  id: totrans-271
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用本地CP信任来支持多个Active Directory林
- en: 'Beginning with AD FS 2016, you have the option of using a local CP trust to
    integrate additional forests. The only thing that you need to know is that you
    will lose automatic home-realm discovery for internal users. You can only provide
    a custom solution to do this for you:'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 从AD FS 2016开始，您可以选择使用本地CP信任来集成额外的林。唯一需要知道的是，您将失去对内部用户的自动主域发现功能。您只能提供自定义解决方案来为您完成此操作：
- en: '![](img/a4656d3b-ed3a-4db2-8ee0-0f211ec4eb27.png)'
  id: totrans-273
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a4656d3b-ed3a-4db2-8ee0-0f211ec4eb27.png)'
- en: Using a local CP trust to support multiple Active Directory forests
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 使用本地CP信任来支持多个Active Directory林
- en: 'You can configure the scenario with the following procedure:'
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以按照以下步骤配置该场景：
- en: 'Set the credentials for the service account:'
  id: totrans-276
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置服务账户的凭据：
- en: '[PRE5]'
  id: totrans-277
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Change the `HostName` to your domain controller, and use Port `636` if configured
    for a secure connection:'
  id: totrans-278
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`HostName`更改为您的域控制器，并且如果已配置安全连接，则使用端口`636`：
- en: '[PRE6]'
  id: totrans-279
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Configure your own identifier, like `urn:example`, and define your root user
    container, like `DC=EXAMPLE,DC=COM`:'
  id: totrans-280
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置您自己的标识符，例如`urn:example`，并定义您的根用户容器，例如`DC=EXAMPLE,DC=COM`：
- en: '[PRE7]'
  id: totrans-281
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Configure additional claim rules:'
  id: totrans-282
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置额外的声明规则：
- en: '[PRE8]'
  id: totrans-283
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Set the newly defined claim rules:'
  id: totrans-284
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置新定义的声明规则：
- en: '[PRE9]'
  id: totrans-285
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Modify the display name of the Active Directory IDP:'
  id: totrans-286
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 修改Active Directory身份提供者的显示名称：
- en: '[PRE10]'
  id: totrans-287
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Configure the relying party claims issuance policy:'
  id: totrans-288
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置依赖方声明发布策略：
- en: '[PRE11]'
  id: totrans-289
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: In the next section, we will discuss using a shared AD environment.
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的部分，我们将讨论如何使用共享的AD环境。
- en: Using a shared Active Directory environment
  id: totrans-291
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用共享的Active Directory环境
- en: In recent months, we've had several discussions about using a single forest
    environment with two Azure Active Directory tenants, including Office 365 services
    and an AD FS and Web Application Proxy combination. We often get these questions
    if the organization wants to use a separate Office 365 tenant, operated by 21Vianet
    or service providers that want to use a shared Active Directory infrastructure
    for small customers.
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: 最近几个月，我们讨论了如何使用单一林环境来支持两个Azure Active Directory租户，包括Office 365服务以及AD FS和Web应用代理的组合。如果组织希望使用由21Vianet或服务提供商运营的独立Office
    365租户，或者服务提供商希望为小型客户使用共享的Active Directory基础设施，我们经常收到这些问题。
- en: 'The following solution design is based on the following supported AAD Connect
    topology:'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 以下解决方案设计基于以下支持的AAD Connect拓扑结构：
- en: '![](img/5ffcf133-1f05-48d6-840b-f5800de65047.png)'
  id: totrans-294
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5ffcf133-1f05-48d6-840b-f5800de65047.png)'
- en: Using a shared Active Directory environment
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: 使用共享的Active Directory环境
- en: You can only use this option with AD FS or an equivalent product. Pass-Through
    Authentication won't work for this use case.
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 您只能在AD FS或等效产品中使用此选项。通行身份验证在此用例中无法使用。
- en: 'In this topology, an AAD Connect instance is configured for a mutually-exclusive
    set of objects; for example, an organizational unit or domain. Furthermore, different
    domains and user principle names need to be used for this scenario, as follows:'
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: 在此拓扑结构中，AAD Connect实例配置为一组互斥的对象；例如，一个组织单位或域。此外，需要为此场景使用不同的域和用户主体名称，如下所示：
- en: A DNS name can only be registered in one Azure Active Directory (custom domains)
  id: totrans-298
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个DNS名称只能在一个Azure Active Directory中注册（自定义域）
- en: One-to-one relationships between an Azure AD Connect synchronization server
    and one Azure Active Directory
  id: totrans-299
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个Azure AD Connect同步服务器与一个Azure Active Directory之间的一对一关系
- en: Azure Active Directory instances are, by design, isolated
  id: totrans-300
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure Active Directory实例在设计上是隔离的。
- en: 'The requirement for a mutually-exclusive set of objects also applies to write-back.
    Some write-back features aren''t supported with this topology, including the following:'
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 对于互斥对象集的要求同样适用于写回。一些写回功能在此拓扑结构下不受支持，包括以下内容：
- en: Group write-back with a default configuration
  id: totrans-302
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用默认配置的组写回
- en: Device write-back
  id: totrans-303
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设备写回
- en: 'The solution''s design is based on the following key features:'
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: 该解决方案的设计基于以下关键特性：
- en: One single Active Directory forest, with organizational units based on regions
    or customers.
  id: totrans-305
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个单一的Active Directory森林，组织单元根据地区或客户进行划分。
- en: Users in the organizational units have the associated user principle names configured;
    for example, **OU APAC** uses the `@apac.inovitdemos.ch` UPN suffix or the **specific
    customer suffix**, such as `@azureid.ch`.
  id: totrans-306
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 组织单元中的用户已配置相关的用户主体名称（UPN）；例如，**OU APAC**使用`@apac.inovitdemos.ch` UPN 后缀，或者**特定客户后缀**，如`@azureid.ch`。
- en: Two Azure AD Connect instances configured with the container filter, based on
    the organizational units.
  id: totrans-307
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置了基于组织单元的容器筛选器的两个Azure AD Connect实例。
- en: One AD FS and Web Application Proxy combination, with the `login.inovit.ch`
    STS name.
  id: totrans-308
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个AD FS和Web应用程序代理的组合，使用`login.inovit.ch`的STS名称。
- en: 'One Azure Active Directory Tenant with Office 365 services, called **Customer
    Tenant 1**, and the following registered custom domain name: `inovitdemos.ch`.'
  id: totrans-309
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个Azure Active Directory租户，配备Office 365服务，称为**客户租户1**，并注册了以下自定义域名：`inovitdemos.ch`。
- en: 'One Azure Active Directory Tenant with Office 365 services, called **Customer
    Tenant 2**, and the `apac.inovitdemos.ch` or `azureid.ch` registered custom domain
    name:'
  id: totrans-310
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个Azure Active Directory租户，配备Office 365服务，称为**客户租户2**，并且注册了`apac.inovitdemos.ch`或`azureid.ch`自定义域名：
- en: '![](img/19526e2c-f61b-4ae4-86d4-62096af9f8d9.png)'
  id: totrans-311
  prefs: []
  type: TYPE_IMG
  zh: '![](img/19526e2c-f61b-4ae4-86d4-62096af9f8d9.png)'
- en: Federation configuration overview
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: 联合配置概述
- en: 'The following description provides the main configuration steps to implement
    this scenario in your environment:'
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 以下描述提供了在您的环境中实现此场景的主要配置步骤：
- en: '**Configuration of the Federation Trust for Customer Tenant 1**: This task
    is a very common one, because you just need to open an evaluated PowerShell on
    the AD FS server and type the following commands:'
  id: totrans-314
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**客户租户1的联合信任配置**：此任务非常常见，因为只需在AD FS服务器上打开一个已评估的PowerShell并输入以下命令：'
- en: '[PRE12]'
  id: totrans-315
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '**Configuration of the Federation Trust for** **Customer Tenant 2**: You can''t
    use the same PowerShell command for the second tenant''s configuration. If you
    try, you''ll change the configuration completely to the second tenant. In this
    case, we need to use the `Set-MsolDomainAuthentication` command to configure the
    trust to the second tenant.'
  id: totrans-316
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**客户租户2的联合信任配置**：您不能使用相同的PowerShell命令来配置第二个租户。如果尝试这样做，您将完全更改配置为第二个租户。在这种情况下，我们需要使用`Set-MsolDomainAuthentication`命令来配置信任到第二个租户。'
- en: '`Set-MsolDomainAuthentication` is typically used to configure Federation Trusts
    with other Identity Providers.'
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: '`Set-MsolDomainAuthentication`通常用于配置与其他身份提供者的联合信任。'
- en: 'To configure the second Federation Trust, you need to export the AD FS token-signing
    certificate from the AD FS farm configuration. You can do this with the AD FS
    management console or the following PowerShell commands:'
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: 要配置第二个联合信任，您需要从AD FS农场配置中导出AD FS令牌签名证书。您可以使用AD FS管理控制台或以下PowerShell命令来完成此操作：
- en: '[PRE13]'
  id: totrans-319
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Now that we have exported the token-signing certificate, we can start to configure
    the Federation Trust for **Customer Tenant 2**:'
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已导出令牌签名证书，可以开始配置**客户租户2**的联合信任：
- en: '[PRE14]'
  id: totrans-321
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: With this solution, you're also ready to solve other scenarios with the same
    requirements.
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: 通过此解决方案，您还可以解决其他具有相同要求的场景。
- en: Microsoft Cloud Solution Provider summary
  id: totrans-323
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 微软云解决方案提供商总结
- en: 'The following figure provides an overview of the best way to integrate and
    connect cloud services for Microsoft Cloud Service Providers. The most supported
    way is to use one Active Directory for the customer and connect a single Azure
    AD tenant, or move a small customer to a cloud-only scenario. Azure AD DS can
    be very helpful in such a scenario:'
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: 下图提供了集成和连接微软云服务提供商云服务的最佳方式概览。最受支持的方式是为客户使用一个Active Directory，并连接一个Azure AD租户，或者将小型客户迁移到完全基于云的场景。Azure
    AD DS在这种场景下可以非常有帮助：
- en: '![](img/6f3e8f5d-1413-4742-bf31-aa29ae93b980.png)'
  id: totrans-325
  prefs: []
  type: TYPE_IMG
  zh: '![](img/6f3e8f5d-1413-4742-bf31-aa29ae93b980.png)'
- en: Microsoft Cloud Solution Provider overview
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
  zh: 微软云解决方案提供商概述
- en: The shared local Active Directory scenario can still be used, but with great
    effort.
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
  zh: 共享本地 Active Directory 场景仍然可以使用，但需要付出很大努力。
- en: Summary
  id: totrans-328
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, you worked through the different Azure AD identity services,
    such as Azure AD B2B/B2C and the Domain Services. You also explored different
    options with AD FS as an identity service, in order to get the whole picture of
    a hybrid identity and the access-management world.
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你已经了解了不同的 Azure AD 身份服务，例如 Azure AD B2B/B2C 和域服务。你还探索了将 AD FS 作为身份服务的不同选项，以便全面了解混合身份和访问管理的世界。
- en: In the next chapter, we'll dive into different application types and deployment
    methods, including more details about conditional access and other features that
    we can use.
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章，我们将深入探讨不同的应用类型和部署方法，包括更多关于条件访问和我们可以使用的其他功能的详细信息。
