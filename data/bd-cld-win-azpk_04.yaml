- en: Chapter 4. Building VM Clouds and IaaS Offerings
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第4章 构建虚拟机云和IaaS服务
- en: In the previous chapter, we installed and configured Windows Azure Pack components.
    The portals accessible to admins and tenants, available at this point of time,
    are just plain with respect to cloud services offering. In this chapter, we will
    build VM Clouds with the integration of Windows Azure Pack, SPF, and SCVMM. Windows
    Azure Pack VM Clouds are used to provide IaaS (Infrastructure as a Service) capabilities,
    such as virtual machines, virtual networks, and so on.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在前一章中，我们安装并配置了Windows Azure Pack组件。此时，管理员和租户可以访问的门户在云服务提供方面非常基础。在本章中，我们将构建与Windows
    Azure Pack、SPF和SCVMM集成的虚拟机云。Windows Azure Pack虚拟机云用于提供IaaS（基础设施即服务）功能，如虚拟机、虚拟网络等。
- en: You will learn about VM Cloud's architecture, planning, and implementation.
    Furthermore, we will start building the cloud offerings, such as VMs and templates,
    gallery resources and their integration, and mapping with fabric resources in
    SCVMM. You will learn to use Microsoft-provided standard cloud services gallery
    items as well as develop custom gallery items for custom needs.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 你将了解虚拟机云的架构、规划和实施。此外，我们将开始构建云服务，如虚拟机和模板、画廊资源及其集成，并与SCVMM中的基础设施资源进行映射。你将学习使用微软提供的标准云服务画廊项目，并开发定制的画廊项目以满足特定需求。
- en: 'In this chapter, we will be covering the following topic:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将涵盖以下主题：
- en: VM Clouds overview
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 虚拟机云概述
- en: Registering SCVMM with Windows Azure Pack
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将SCVMM注册到Windows Azure Pack
- en: Building a SCVMM cloud for Windows Azure Pack cloud
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为Windows Azure Pack云构建SCVMM云
- en: Preparing OS images for a cloud catalogue (Windows and Linux VMs)
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为云目录准备操作系统镜像（Windows和Linux虚拟机）
- en: IaaS virtual machine offerings – standalone VM versus VM role
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: IaaS虚拟机服务 – 独立虚拟机与虚拟机角色
- en: Building standalone VM IaaS offerings
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 构建独立虚拟机IaaS服务
- en: The VM Role architecture
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: VM角色架构
- en: Building VM Role IaaS offerings using gallery resources
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用画廊资源构建虚拟机角色IaaS服务
- en: Using the **GRIT** (**Gallery Resource Import**) tool
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用**GRIT**（**Gallery Resource Import**）工具
- en: Developing VM Role gallery resources using VM Role Authoring Tool
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用虚拟机角色创作工具开发虚拟机角色资源
- en: Accessing tenant's virtual machines – Windows Azure Pack Console Connect
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 访问租户虚拟机 – Windows Azure Pack 控制台连接
- en: VM Clouds overview
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 虚拟机云概述
- en: VM Clouds in Windows Azure Pack cloud solution is a top-level umbrella to provide
    IaaS services. Clouds created in **System Center Virtual Machine** **Manager (SCVMM)**
    are represented as VM Clouds in the Windows Azure Pack management portal.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: Windows Azure Pack云解决方案中的虚拟机云是一个顶层的伞形结构，用于提供IaaS服务。在**System Center Virtual
    Machine** **Manager (SCVMM)**中创建的云表示为Windows Azure Pack管理门户中的虚拟机云。
- en: VM Clouds can be used to provide IaaS services with multitenancy capabilities.
    In Windows Azure Pack-based cloud, cloud plans and subscriptions and cloud offering
    catalogues and fabric resources are provisioned, mapped, and managed on a VM Cloud
    level.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟机云可以用来提供带有多租户功能的IaaS服务。在基于Windows Azure Pack的云中，云计划、订阅、云服务目录和基础设施资源都是在虚拟机云层面进行配置、映射和管理的。
- en: Windows Azure Pack uses SPF to communicate with VMM for all operations and management
    with respect to VM Clouds. There can be a multiple number of VM Clouds created
    in one or more SCVMM as per requirements; it is recommended to only single or
    fewer VM Clouds.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: Windows Azure Pack使用SPF与VMM进行通信，处理与虚拟机云相关的所有操作和管理。根据需求，可以在一个或多个SCVMM中创建多个虚拟机云；但推荐只创建单个或较少数量的虚拟机云。
- en: Use case for creating multiple VM Cloud includes GEO site locations, dedicated
    hardware services to tenants, backup/secondary/DR infrastructure, or as per the
    features available as per the cloud provider's strategy; but, they are not limited
    to these.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 创建多个虚拟机云的使用场景包括GEO站点位置、为租户提供专用硬件服务、备份/辅助/灾难恢复基础设施，或根据云提供商策略提供的功能；但这些不局限于此。
- en: IaaS services include virtual machines, virtual networks, and IaaS machines
    with automated application deployment, and they are provided using VM Clouds.
    But, they are not limited to these.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: IaaS服务包括虚拟机、虚拟网络和带有自动化应用部署的IaaS虚拟机，这些服务通过虚拟机云提供。但它们不限于此。
- en: VM Clouds are responsible for delivering IaaS services including virtual machines
    and networks along with automated application deployment inside the virtual machines.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟机云负责提供IaaS服务，包括虚拟机、网络和虚拟机内部的自动化应用部署。
- en: Registering SCVMM with Windows Azure Pack
  id: totrans-22
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将SCVMM注册到Windows Azure Pack
- en: Before we start building VM Clouds and IaaS offerings, we must register our
    SCVMM instance with Windows Azure Pack. This is also called stamp registration.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始构建VM云和IaaS提供之前，我们必须将我们的SCVMM实例注册到Windows Azure Pack。这也称为印章注册。
- en: 'The following steps need to be carried out for registering SCVMM stamp with
    Windows Azure Pack:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 注册SCVMM印章与Windows Azure Pack的以下步骤需要执行
- en: Log into the Windows Azure Pack Management portal for administrators.
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录Windows Azure Pack管理门户进行管理员操作。
- en: Browse the **vm clouds** workspace.![Registering SCVMM with Windows Azure Pack](img/00056.jpeg)
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 浏览**vm clouds**工作区。![在Windows Azure Pack中注册SCVMM](img/00056.jpeg)
- en: Click on **USE AN EXISTING VIRTUAL MACHINE CLOUD PROVIDER TO PROVISION VIRTUAL
    MACHINES**.
  id: totrans-27
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**使用现有虚拟机云提供商来配置虚拟机**。
- en: Provide **VIRTUAL MACHINE MANAGER SERVER FQDN** and **PORT NUMBER** (if customized).
    Note that it doesn't ask for credentials as Windows Azure Pack uses the service
    provider foundation VMM service account for accessing VMM. Enter **REMOTE DESKTOP
    GATEWAY FQDN**, which will be used for Azure Pack Console Connect. This can be
    configured later as a remote Desktop Gateway is covered later in this chapter.![Registering
    SCVMM with Windows Azure Pack](img/00057.jpeg)
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供**虚拟机管理器服务器FQDN**和**端口号**（如果自定义）。请注意，Windows Azure Pack使用服务提供商基础VMM服务帐户访问VMM，因此不需要凭据。输入**远程桌面网关FQDN**，这将用于Azure
    Pack控制台连接。稍后可以在本章中配置远程桌面网关。![在Windows Azure Pack中注册SCVMM](img/00057.jpeg)
- en: Upon successful registration, VMM stamps will be displayed in the **CLOUDS**
    workspace in the Windows Azure Pack portal.![Registering SCVMM with Windows Azure
    Pack](img/00058.jpeg)
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 成功注册后，在Windows Azure Pack门户的**云**工作区中将显示VMM印章。![在Windows Azure Pack中注册SCVMM](img/00058.jpeg)
- en: Review the Windows Azure Pack registration error, Windows Azure Pack, SPF, and
    VMM logs in case of any registration failure.
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查Windows Azure Pack注册错误、Windows Azure Pack、SPF和VMM日志，以防任何注册失败。
- en: We do not see any cloud listed in the Windows Azure Pack portal at this point
    as we have only integrated the virtualization machine cloud provider. Now, we
    will start building VM Clouds.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 我们目前在Windows Azure Pack门户中看不到任何列出的云，因为我们只集成了虚拟化机器云提供商。现在，我们将开始构建VM云。
- en: Building a SCVMM cloud for Windows Azure Pack cloud
  id: totrans-32
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 为Windows Azure Pack云构建SCVMM云
- en: A cloud in **SCVMM** is an umbrella containing our VMM fabric resources, such
    as compute (hypervisors), networking, and storage along with resources, such as
    VM, services, and templates. A cloud created in SCVMM is used by Windows Azure
    Pack to offer IaaS services to tenants using plans and subscriptions.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 在**SCVMM**中的云是一个包含我们的VMM布局资源（如计算（hypervisors）、网络和存储），以及资源（如VM、服务和模板）的总称。在SCVMM中创建的云被Windows
    Azure Pack用于通过计划和订阅向租户提供IaaS服务。
- en: A cloud in SCVMM can be created using SCVMM host groups, which may contain different
    hypervisors or can be created from the VMware resource pool. At the time of writing
    this book, Windows Azure Pack VM Cloud didn't support SCVMM cloud created using
    the VMware resource pool.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 在SCVMM中可以使用SCVMM主机组创建云，这些主机组可能包含不同的hypervisor，或者可以从VMware资源池创建。在撰写本书时，Windows
    Azure Pack VM云不支持使用VMware资源池创建的SCVMM云。
- en: Note that though VMware or server resources can be added in a SCVMM Cloud, IaaS
    resource provisioning on these via Windows Azure Pack tenant portal isn't possible.
    At this point of time, only Hyper-V is the supported hypervisor for IaaS services
    in a WAP VM Cloud. The third-party partner solutions are available for using Windows
    Azure Pack with VMware-based virtualization solutions. This limitation is applicable
    only for tenants' IaaS workloads, VMware/Xen, and other based VMs that can be
    used to host Windows Azure Pack management servers, websites, DBaaS servers, and
    more.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，虽然可以将VMware或服务器资源添加到SCVMM云中，但通过Windows Azure Pack租户门户对这些资源进行IaaS资源配置是不可能的。目前，仅支持Hyper-V作为WAP
    VM云中IaaS服务的hypervisor。第三方合作伙伴解决方案可用于使用基于VMware的虚拟化解决方案的Windows Azure Pack。此限制仅适用于租户的IaaS工作负载，可用于托管Windows
    Azure Pack管理服务器、网站、DBaaS服务器等的VMware/Xen和其他基于VM的VM。
- en: Before creating a SCVMM cloud, let's have a look at the SCVMM cloud's requirements
    with respect to Windows Azure Pack VM Cloud support.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建SCVMM云之前，让我们看看SCVMM云在Windows Azure Pack VM云支持方面的要求。
- en: Requirements for Windows Azure Pack VM Clouds
  id: totrans-37
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Windows Azure Pack VM云的要求
- en: 'While creating a SCVMM cloud, consider the following prerequisites that need
    to be taken care of with respect to the Windows Azure Pack VM Cloud:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 创建 SCVMM 云时，请注意以下有关 Windows Azure Pack VM 云的前提条件：
- en: An SCVMM cloud must be created from host groups. A cloud created with VMware
    resource pool is not supported by Windows Azure Pack at this point of time.
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SCVMM 云必须从主机组中创建。当前，Windows Azure Pack 不支持使用 VMware 资源池创建的云。
- en: The cloud capability profile (ESX server, Hyper-V, or XenServer) must not be
    selected while creating the cloud.
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建云时，不能选择云能力配置文件（ESX 服务器、Hyper-V 或 XenServer）。
- en: A cloud capacity (compute/network/storage resource) must be selected as per
    the available capacity. The limits of these resources will be applicable for tenants
    using Windows Azure Pack cloud while provisioning resources.
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 必须根据可用的容量选择云容量（计算/网络/存储资源）。这些资源的限制将适用于使用 Windows Azure Pack 云的租户在资源供应过程中。
- en: Logical network planned for Windows Azure Pack must be already created and associated
    with the SCVMM cloud.
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 计划用于 Windows Azure Pack 的逻辑网络必须已创建并与 SCVMM 云关联。
- en: The VMM library share must be already created and configured with the cloud.
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 必须已创建并配置 VMM 库共享与云一起使用。
- en: '**Service Management Automation** (**SMA**) will be discussed in the upcoming
    chapters. If it is being used for automation with respect to the SCVMM cloud,
    then the SMA web service certificate must be trusted on the SPF server. This will
    be discussed in detail in [Chapter 9](part0082_split_000.html#2E6E41-b479cf466c26404ca54119871a9b2715
    "Chapter 9. Automation and Authentication – Service Management Automation and
    ADFS"), *Automation and Authentication – Service Management Automation and ADFS*.'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**服务管理自动化**（**SMA**）将在接下来的章节中讨论。如果它用于与 SCVMM 云相关的自动化，则必须在 SPF 服务器上信任 SMA Web
    服务证书。这将在[第9章](part0082_split_000.html#2E6E41-b479cf466c26404ca54119871a9b2715
    "第9章 自动化与身份验证 - 服务管理自动化与 ADFS")，*自动化与身份验证 - 服务管理自动化与 ADFS*中详细讨论。'
- en: Creating a cloud in SCVMM
  id: totrans-45
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在 SCVMM 中创建云
- en: The SCVMM management console is used to create a cloud in VMM. Before creating
    a cloud, verify that you have configured all the required fabric components. See
    [Chapter 2](part0023_split_000.html#LTSU2-b479cf466c26404ca54119871a9b2715 "Chapter 2. Getting
    the Cloud Fabric Ready"), *Getting the Cloud Fabric Ready*, to review the fabric
    components requirements.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: SCVMM 管理控制台用于在 VMM 中创建云。在创建云之前，请确认已配置所有必需的架构组件。请参阅[第2章](part0023_split_000.html#LTSU2-b479cf466c26404ca54119871a9b2715
    "第2章 准备云架构")，*准备云架构*，以回顾架构组件的要求。
- en: 'Carry out these steps to create the SCVMM cloud:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤创建 SCVMM 云：
- en: Log into the SCVMM server using the VMM console with administrative access.
  id: totrans-48
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用具有管理权限的 VMM 控制台登录到 SCVMM 服务器。
- en: Click on **Create Cloud** in the **Home** ribbon.![Creating a cloud in SCVMM](img/00059.jpeg)
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击**主页**功能区中的**创建云**。![在 SCVMM 中创建云](img/00059.jpeg)
- en: Provide the cloud name and description in **Create Cloud Wizard**.![Creating
    a cloud in SCVMM](img/00060.jpeg)
  id: totrans-50
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**创建云向导**中提供云名称和描述。 ![在 SCVMM 中创建云](img/00060.jpeg)
- en: Select the **Host groups** cloud that is to be used for Windows Azure Pack tenant's
    workload in the **Select resource for this cloud** section. The wizard will also
    display the capacity or host groups in terms of CPU's memory and network.![Creating
    a cloud in SCVMM](img/00061.jpeg)
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**选择此云的资源**部分，选择将用于 Windows Azure Pack 租户工作负载的**主机组**云。向导还将显示 CPU、内存和网络方面的容量或主机组。
    ![在 SCVMM 中创建云](img/00061.jpeg)
- en: On the **Logical Networks** page, select logical network or networks created
    for the usage of Windows Azure Pack Cloud. It will be used by tenants to create
    and use VM networks. This will leverage network virtualization for provisioning
    virtual networks for tenants independent of each other. See [Chapter 2](part0023_split_000.html#LTSU2-b479cf466c26404ca54119871a9b2715
    "Chapter 2. Getting the Cloud Fabric Ready"), *Getting the Cloud Fabric Ready*,
    to learn more about network virtualization.
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**逻辑网络**页面，选择为 Windows Azure Pack 云使用而创建的逻辑网络或网络。租户将使用这些网络来创建和使用虚拟机网络。这将利用网络虚拟化为租户提供独立的虚拟网络。有关网络虚拟化的更多信息，请参阅[第2章](part0023_split_000.html#LTSU2-b479cf466c26404ca54119871a9b2715
    "第2章 准备云架构")，*准备云架构*，了解更多关于网络虚拟化的内容。
- en: Note
  id: totrans-53
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Note that logical networks assigned with physical network adaptors on Hyper-V
    hosts will only be visible on this page.
  id: totrans-54
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 请注意，分配给 Hyper-V 主机物理网络适配器的逻辑网络仅在此页面上可见。
- en: '![Creating a cloud in SCVMM](img/00062.jpeg)'
  id: totrans-55
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![在 SCVMM 中创建云](img/00062.jpeg)'
- en: Optionally, select **Load Balancers** to be made available for access in this
    cloud.
  id: totrans-56
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 可选地，选择**负载均衡器**，使其在此云中可供访问。
- en: Optionally, select **VIP Templates** for cloud usage. VIP templates are used
    in conjunction with load balancers for virtual IPs and other related configurations.
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 可选地，选择用于云端的**VIP模板**。VIP模板与负载均衡器配合使用，用于虚拟IP和其他相关配置。
- en: Optionally, select **Port Classifications** to be used for cloud resources.
    The port profile can be used to specify **QOS** (**Quality of Service**) at the
    cloud layer along with a granular control at the Windows Azure Pack plans level.
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 可选地，选择**端口分类**以供云资源使用。端口配置文件可用于指定云层的**QOS**（**服务质量**），并在Windows Azure Pack计划级别进行精细控制。
- en: Optionally, select **Storage** to be used to store virtual machines for this
    cloud. See [Chapter 2](part0023_split_000.html#LTSU2-b479cf466c26404ca54119871a9b2715
    "Chapter 2. Getting the Cloud Fabric Ready"), *Getting the Cloud Fabric Ready*,
    to know more on storage options for the Windows Azure Pack cloud.
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 可选地，选择**存储**来存储此云中的虚拟机。有关Windows Azure Pack云存储选项的详细信息，请参阅[第2章](part0023_split_000.html#LTSU2-b479cf466c26404ca54119871a9b2715
    "第2章：准备云基础设施")，*准备云基础设施*。
- en: Select the stored VM path and read only library shares for cloud usage.![Creating
    a cloud in SCVMM](img/00063.jpeg)
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择存储的虚拟机路径和只读库共享以供云端使用。![在SCVMM中创建云](img/00063.jpeg)
- en: Select **Capacity** to know about the cloud capacity available for usage by
    tenants. This is one of the most important settings at the SCVMM layer for the
    cloud. The capacity should be wisely selected as per the availability of resources.
    This capacity limit will be applicable for all the tenants that the IaaS workload
    has hosted inside the cloud. The tenant level capacity limit shall be configured
    and at the Windows Azure Pack plan's level. While values such as CPU and memory
    are self-explanatory, custom quota values in capacity are values defined for virtual
    machine templates based upon parameters such as size. Later, these are used for
    restricting maximum resources provisioned by any self-service user in cloud.
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**容量**以了解可供租户使用的云容量。这是SCVMM层面云的重要设置之一。容量应根据资源的可用性谨慎选择。此容量限制将适用于云中所有托管IaaS工作负载的租户。租户级别的容量限制将在Windows
    Azure Pack计划级别配置。虽然CPU和内存等值易于理解，但容量中的自定义配额值是根据虚拟机模板的参数（如大小）定义的值。稍后，这些将用于限制任何自服务用户在云中提供的最大资源。
- en: Note
  id: totrans-62
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Note that custom quota points provide backward compatibility and are only applicable
    for self-service users created in VMM 2008 R2\. These aren't applicable for Windows
    Azure Pack VM Clouds.
  id: totrans-63
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 请注意，自定义配额点提供向后兼容性，仅适用于在VMM 2008 R2中创建的自服务用户。这些不适用于Windows Azure Pack虚拟机云。
- en: '![Creating a cloud in SCVMM](img/00064.jpeg)'
  id: totrans-64
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![在SCVMM中创建云](img/00064.jpeg)'
- en: On the **Capability Profiles** page, do not select any of the profiles (ESX/Hyper-V/XenServer).
    Windows Azure Pack doesn't support using a SCVMM cloud with a capability profile
    for IaaS workload of tenants.
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**功能配置文件**页面中，不要选择任何配置文件（ESX/Hyper-V/XenServer）。Windows Azure Pack不支持在IaaS工作负载的租户使用带有功能配置文件的SCVMM云。
- en: If applicable, add any **Cloud Disaster Recovery Solutions** on **Replication
    Groups** page.
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如适用，添加任何**云灾难恢复解决方案**，可在**复制组**页面上进行操作。
- en: Review the settings on the **Summary** page.
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 查看**总结**页面上的设置。
- en: Click on **Finish** to create the cloud.
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**完成**以创建云端。
- en: View the jobs to verify the status of cloud creation jobs. The newly created
    cloud will be visible in the **SCVMM VMs** and **Service Management** workspaces.
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 查看任务以验证云创建任务的状态。新创建的云将显示在**SCVMM虚拟机**和**服务管理**工作区中。
- en: Note
  id: totrans-70
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Azure Site Recovery, Microsoft's cloud-based disaster recovery offering, can
    be leveraged for protecting SCVMM clouds against disasters. See [https://azure.microsoft.com/en-in/services/site-recovery/](https://azure.microsoft.com/en-in/services/site-recovery/)
    to learn more about Azure Site Recovery.
  id: totrans-71
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: Azure Site Recovery，微软基于云的灾难恢复解决方案，可以用于保护SCVMM云免受灾难影响。请访问[https://azure.microsoft.com/en-in/services/site-recovery/](https://azure.microsoft.com/en-in/services/site-recovery/)以了解更多关于Azure
    Site Recovery的信息。
- en: Verifying a SCVMM cloud in the Windows Azure Pack portal
  id: totrans-72
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在Windows Azure Pack门户中验证SCVMM云
- en: 'We created a SCVMM cloud in the previous topic. In order to use it for building
    IaaS cloud offerings, it must be visible in the Windows Azure Pack Management
    portal for administrators under VM Clouds. Service provider foundation does the
    job of synchronizing the changes made at SCVMM and Windows Azure Pack level and
    vice versa. Let''s verify that the cloud is visible in the Windows Azure Pack
    Management portal:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在上一篇文章中创建了一个 SCVMM 云。为了将其用于构建 IaaS 云服务，它必须在 Windows Azure Pack 管理门户中的虚拟机云部分可见。服务提供商基础架构负责同步
    SCVMM 和 Windows Azure Pack 层级所做的更改，反之亦然。让我们验证一下云是否在 Windows Azure Pack 管理门户中可见：
- en: Log into the Windows Azure Pack Management portal for administrators.
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到 Windows Azure Pack 管理门户（管理员）。
- en: Browse the **VM CLOUDS** sections.
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 浏览 **虚拟机云** 部分。
- en: Expand the currently registered SCVMM stamp.
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 展开当前已注册的 SCVMM 服务器。
- en: The newly created cloud in the previous topic will be visible.![Verifying a
    SCVMM cloud in the Windows Azure Pack portal](img/00065.jpeg)
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在上一篇文章中创建的新云将可见。![在 Windows Azure Pack 门户中验证 SCVMM 云](img/00065.jpeg)
- en: If you do not see the newly created cloud listed in the Windows Azure Pack Management
    portal, verify the status of **Create new Cloud** Job in VMM. Have a look at the
    SPF SCVMM and Windows Azure Pack Integration checklist and status.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 如果在 Windows Azure Pack 管理门户中没有看到新创建的云， 请验证 VMM 中 **创建新云** 作业的状态。请查看 SPF SCVMM
    和 Windows Azure Pack 集成检查表及状态。
- en: The SCVMM **Jobs** window provides clear details, comprising events occurred
    to perform any particular task along with individual status. This can be handy
    for any troubleshooting operation.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: SCVMM **作业**窗口提供了清晰的细节，包含执行特定任务所发生的事件及其各自的状态。这对于任何故障排除操作都非常有用。
- en: '![Verifying a SCVMM cloud in the Windows Azure Pack portal](img/00066.jpeg)'
  id: totrans-80
  prefs: []
  type: TYPE_IMG
  zh: '![在 Windows Azure Pack 门户中验证 SCVMM 云](img/00066.jpeg)'
- en: With this topic, we have successfully integrated our fabric and cloud with Windows
    Azure Pack. Furthermore, we will start creating cloud offerings for our Windows
    Azure Pack cloud.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 通过本主题，我们已经成功将我们的基础架构和云与 Windows Azure Pack 集成。此外，我们将开始为 Windows Azure Pack 云创建云服务。
- en: Preparing OS images for a cloud catalogue (Windows and Linux VMs)
  id: totrans-82
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 为云目录准备操作系统镜像（Windows 和 Linux 虚拟机）
- en: A cloud offering catalogue can be compared with any online shopping websites
    items catalogue. In any online shopping website, there are different types of
    items available for purchase, and then each item maybe available in different
    sizes or versions.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 云服务目录可以与任何在线购物网站的商品目录进行对比。在任何在线购物网站上，都有不同类型的商品可供购买，而每个商品可能会有不同的尺寸或版本。
- en: Customers choose items available in the given catalogue and make a purchase.
    The similar purchase aspect applies in the case of cloud catalogues. If we see
    any public cloud provider, such as Microsoft, Amazon, and more such catalogues
    for virtual machines offerings, there would be a range of operating systems available
    in different formats, such as Vanilla OS or an OS customized for particular application
    or workload type, which are available in different size configurations (CPU/memory/storage
    capacity). There can be other characteristics as well as differentiating catalogues,
    such as high availability, performance, features, and so on.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 客户选择目录中提供的商品并进行购买。在云目录的情况下，类似的购买方式也适用。如果我们查看任何公共云提供商，例如微软、亚马逊等虚拟机服务目录，可能会有不同操作系统以不同格式提供，如普通操作系统或为特定应用或工作负载类型定制的操作系统，这些操作系统以不同的配置尺寸（CPU/内存/存储容量）提供。还可以有其他特征和区分目录的因素，如高可用性、性能、功能等。
- en: In the case of Windows Azure Pack-based cloud solution, SCVMM VM templates and
    Windows Azure Pack gallery items are the backbone of cloud catalogues. Both VM
    templates and gallery items rely on preinstalled OS VHDXs for the provisioning
    of virtual machines and applications. This Hyper-V **Virtual Hard Disk** (**VHD**)
    or VHDXs is stored in the VMM library for usage by VM templates and gallery resources.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 在基于 Windows Azure Pack 的云解决方案中，SCVMM 虚拟机模板和 Windows Azure Pack 画廊项目是云目录的核心。虚拟机模板和画廊项目都依赖于预安装的操作系统
    VHDXs，用于虚拟机和应用程序的配置。这些 Hyper-V **虚拟硬盘**（**VHD**）或 VHDXs 存储在 VMM 库中，以供虚拟机模板和画廊资源使用。
- en: In this section, we will cover the planning and execution of the preparation
    of virtual disks for VM templates and gallery items.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将介绍虚拟磁盘的规划和执行，以用于虚拟机模板和画廊项目的准备。
- en: Planning VM images
  id: totrans-87
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 规划虚拟机镜像
- en: Preparing VM images and catalogues is a continuous process in any cloud solution
    since the cloud has to fulfil the daily changing needs of IT solutions. The number
    and types of images to be prepared for any cloud will depend on the provider's
    strategy and offerings portfolio.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 准备虚拟机镜像和目录是任何云解决方案中的持续过程，因为云需要满足 IT 解决方案日常变化的需求。为任何云准备的镜像数量和类型将取决于提供商的策略和产品组合。
- en: In a generic scenario for a Windows Azure Pack-based cloud solution, the following
    images can be prepared for both organizations and service providers cloud solutions.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 在基于 Windows Azure Pack 的云解决方案的通用场景中，可以为组织和服务提供商的云解决方案准备以下镜像。
- en: 'The following are based upon the operating systems supported by Hyper-V:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是基于 Hyper-V 支持的操作系统：
- en: 'Images for all the available and supported Windows operating systems are as
    follows:'
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 所有可用和受支持的 Windows 操作系统的镜像如下：
- en: Windows Server 2012 R2
  id: totrans-92
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows Server 2012 R2
- en: Windows Server 2012
  id: totrans-93
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows Server 2012
- en: Windows Server 2008 R2 SP1
  id: totrans-94
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows Server 2008 R2 SP1
- en: Windows Client Operating Systems (Win 7/8/8.1)
  id: totrans-95
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows 客户操作系统（Win 7/8/8.1）
- en: 'Images for all available and supported Unix/Linux flavor operating systems
    are as follows:'
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 所有可用和受支持的 Unix/Linux 系统的镜像如下：
- en: Red Hat Enterprise Linux
  id: totrans-97
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Red Hat Enterprise Linux
- en: Cent OS
  id: totrans-98
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Cent OS
- en: Any other supported Unix distributions
  id: totrans-99
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 任何其他支持的 Unix 发行版
- en: Any other Hyper-V supported operating system
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 任何其他 Hyper-V 支持的操作系统
- en: 'For the size of the operating system disk, Windows Azure Pack provides the
    same size to the tenant''s virtual machines as that of the VHD''s template. Though
    it can be customized using Windows Azure Pack automation capabilities, it''s a
    good idea to have OS virtual disks available in multiple size variants such as
    the following:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 对于操作系统磁盘的大小，Windows Azure Pack 会为租户的虚拟机提供与 VHD 模板相同的大小。尽管可以使用 Windows Azure
    Pack 自动化功能进行定制，但最好有多种大小变体的操作系统虚拟磁盘，例如以下：
- en: 150 GB
  id: totrans-102
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 150 GB
- en: 100 GB
  id: totrans-103
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 100 GB
- en: 80 GB
  id: totrans-104
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 80 GB
- en: 40 GB
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 40 GB
- en: Any other size as per the organization's or tenant's needs
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 根据组织或租户的需求提供任何其他大小
- en: In applications or workload specific OS disk Infrastructure as a Service (IaaS)
    Virtual machines are not just about providing plain operating systems for tenants'
    workloads; it can also provide servers with preconfigured applications of automated
    application deployment as per tenant's requirement; examples include web servers,
    dedicated database server dedicated for tenant, and so on. Separate OS disks can
    be created for applications or workload specific offerings having specific preinstalled
    or configuration apps or platforms for deploying applications (such as .NET framework).
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 在应用程序或工作负载特定的操作系统磁盘基础设施即服务（IaaS）中，虚拟机不仅仅是为租户的工作负载提供纯粹的操作系统；它还可以根据租户的要求提供带有预配置应用程序的服务器，支持自动化应用程序部署；例如包括
    Web 服务器、为租户专门配置的数据库服务器等。可以为应用程序或工作负载特定的产品创建单独的操作系统磁盘，这些磁盘具有特定预安装或配置的应用程序或平台，用于部署应用程序（如
    .NET 框架）。
- en: Preparing a Sysprepped virtual disk for Windows OS virtual machine
  id: totrans-108
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 为 Windows 操作系统虚拟机准备 Sysprepped 虚拟磁盘
- en: Each Windows operating system has a unique identifier attached, that is, a SID
    (secure ID). To avoid any SID conflict, Sysprep is used for VMs deployed using
    template VHD.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 每个 Windows 操作系统都有一个独特的标识符，即 SID（安全 ID）。为避免任何 SID 冲突，使用 Sysprep 来处理通过模板 VHD 部署的虚拟机。
- en: Once planning is completed for VM images to be prepared, the following instructions
    can be followed to prepare a Sysprepped virtual disk.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦为虚拟机镜像的准备工作完成计划，以下说明可以用来准备 Sysprepped 虚拟磁盘。
- en: 'Steps for preparing VHD for Windows operating systems templates are as follows:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 为 Windows 操作系统模板准备 VHD 的步骤如下：
- en: Create a Hyper-V virtual machine.
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个 Hyper-V 虚拟机。
- en: Mount OS installation ISO and install the operating system.
  id: totrans-113
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 挂载操作系统安装 ISO 并安装操作系统。
- en: Install or verify Hyper-V integration services.
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装或验证 Hyper-V 集成服务。
- en: Configure any required local hardening policies.
  id: totrans-115
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置所需的本地加固策略。
- en: Configure the accessibility setting such as enabling RDP and configuring Windows
    Firewall.
  id: totrans-116
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置访问设置，例如启用 RDP 和配置 Windows 防火墙。
- en: Install required agents (Antivirus, Backup, and so on).
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装所需的代理（如杀毒软件、备份等）。
- en: Install any required Windows Roles and features if applicable.
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如适用，安装所需的 Windows 角色和功能。
- en: Install any other third-party applications if applicable.
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装任何其他第三方应用程序（如适用）。
- en: Add any script in start-up (such as Windows activation, agents configuration,
    and application deployment).
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在启动时添加任何脚本（如 Windows 激活、代理配置和应用程序部署）。
- en: Update OS with the latest Windows patches and services packs.
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用最新的Windows补丁和服务包更新操作系统。
- en: Perform the necessary housekeeping such as removing installation media, event
    viewer logs, temp files, and more.
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 执行必要的清理工作，例如移除安装介质、事件查看器日志、临时文件等。
- en: Have a final look at the OS to identify any missing component or issue.
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后检查操作系统，识别任何缺失的组件或问题。
- en: For generalizing the OS image using Sysprep, we can find `Sysprep.exe` in `C:\Windows\System32\Sysprep`
    folder. Select **Enter System Out-of-Box Experience (OOBE)** in **System Clean-up
    Action** with the **Generalize** option checked. Select **Shutdown** in **Shutdown
    Options** to power off the VM post in completion of Sysprep.![Preparing a Sysprepped
    virtual disk for Windows OS virtual machine](img/00067.jpeg)
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要使用Sysprep泛化操作系统镜像，我们可以在`C:\Windows\System32\Sysprep`文件夹中找到`Sysprep.exe`。在**系统清理操作**中选择**进入系统开箱体验（OOBE）**，并勾选**泛化**选项。在**关机选项**中选择**关机**，以在Sysprep完成后关闭虚拟机。![为Windows
    OS虚拟机准备Sysprep虚拟磁盘](img/00067.jpeg)
- en: Post completion of this process, the virtual disk file can be copied to the
    VMM library for the usage of templates. It's a good idea to keep multiple copies
    of the prepared disk file for future usage and rollback.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 完成此过程后，虚拟磁盘文件可以复制到VMM库中供模板使用。建议保留多个已准备好的磁盘文件副本，以备未来使用和回滚。
- en: Note
  id: totrans-126
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Product key, hostname, and other values configured in the virtual disk don't
    have any effect on the provisioned VM using this. These will not be used after
    the Sysprep process.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 在虚拟磁盘中配置的产品密钥、主机名和其他值对使用该虚拟磁盘配置的虚拟机没有任何影响。Sysprep过程完成后，这些配置将不再使用。
- en: Preparing VHDX for a Linux OS virtual machine
  id: totrans-128
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备Linux OS虚拟机的VHDX
- en: Linux operating systems don't have any SID associates; hence, it does not require
    any Sysprep operation to be performed. However, there are additional considerations
    that need to be followed for generalizing OS image for the Linux workload.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: Linux操作系统没有任何SID关联，因此不需要执行任何Sysprep操作。然而，在对Linux工作负载进行操作系统镜像泛化时，需要遵循额外的考虑事项。
- en: 'Let''s carry out the following steps to prepare the Linux OS image:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们执行以下步骤以准备Linux操作系统镜像：
- en: Finalize the Linux version, partitions/LVM configurations, and more.
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确定Linux版本、分区/LVM配置等。
- en: Mount the OS installation ISO and install the operating system.
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 挂载操作系统安装ISO并安装操作系统。
- en: Install or verify **Linux Integration Services** (**LIS**).
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装或验证**Linux集成服务**（**LIS**）。
- en: Configure any required local hardening policies.
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置任何需要的本地加固策略。
- en: Install required agents (Antivirus, Backup, and so on).
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装所需的代理（杀毒软件、备份等）。
- en: Install the SCVMM guest agent.
  id: totrans-136
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装SCVMM客户端代理。
- en: Install any other third-party applications if applicable.
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装任何其他第三方应用程序（如适用）。
- en: Add any script in start-up (such as agents configuration /application deployment).
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在启动时添加任何脚本（例如代理配置/应用程序部署）。
- en: Update the OS with the latest patches and updates.
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用最新的补丁和更新更新操作系统。
- en: Perform some necessary housekeeping, such as removing installation media, logs,
    temp files, and so on.
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 执行一些必要的清理工作，例如移除安装介质、日志、临时文件等。
- en: Have a final look at the OS to identify any missing components or issues.
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后检查操作系统，识别任何缺失的组件或问题。
- en: Remove any IP configuration and shutdown the virtual machine.
  id: totrans-142
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 移除任何IP配置并关闭虚拟机。
- en: Post completion of this process, the virtual disk file can be copied to the
    VMM library for the usage of templates. It's a good idea to keep multiple copies
    of prepared disk file for future usage and rollback.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 完成此过程后，虚拟磁盘文件可以复制到VMM库中供模板使用。建议保留多个已准备好的磁盘文件副本，以备未来使用和回滚。
- en: 'The SCVMM guest agent for the Linux operating system can be found on `C:\Program
    Files\Microsoft System Center 2012\Virtual Machine Manager\agents\Linux` on the
    VMM management server. Copy the agents into the Linux VM and execute the following
    commands for installation:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: Linux操作系统的SCVMM客户端代理可以在VMM管理服务器的`C:\Program Files\Microsoft System Center 2012\Virtual
    Machine Manager\agents\Linux`目录中找到。将代理复制到Linux虚拟机中，并执行以下命令进行安装：
- en: 'Run the following command:'
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 运行以下命令：
- en: '[PRE0]'
  id: totrans-146
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Run either of the following commands as applicable for x86 or x64:'
  id: totrans-147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 根据需要运行以下命令，适用于x86或x64：
- en: '[PRE1]'
  id: totrans-148
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: IaaS virtual machine offerings – standalone VM versus VM Role
  id: totrans-149
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: IaaS虚拟机服务 – 独立VM与VM角色
- en: 'Windows Azure Pack-based cloud solution provides the following two options
    to tenants for provisioning virtual machine workloads:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 基于Windows Azure Pack的云解决方案为租户提供了以下两种虚拟机工作负载配置选项：
- en: Standalone virtual machine
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 独立虚拟机
- en: Virtual machine role (VM Role)
  id: totrans-152
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 虚拟机角色（VM角色）
- en: Standalone virtual machine
  id: totrans-153
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 独立虚拟机
- en: Standalone virtual machine in Windows Azure Pack tenant admin portal is a direct
    mapping between standalone the VM offerings catalogue and the VM template created
    and configured in SCVMM.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: Windows Azure Pack 租户管理员门户中的独立虚拟机是独立虚拟机产品目录与 SCVMM 中创建和配置的虚拟机模板之间的直接映射。
- en: For a standalone virtual machine, all the configurations are performed at the
    SCVMM level. The Windows Azure Pack portal is used to create virtual machine using
    predefined configurations in the SCVMM VM template. This does not give any flexibility
    to the tenant user to customize VM as per custom needs.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 对于独立虚拟机，所有配置都在 SCVMM 层面进行。Windows Azure Pack 门户用于使用 SCVMM 虚拟机模板中的预定义配置来创建虚拟机。这不允许租户用户根据自定义需求自定义虚拟机。
- en: Cloud administrator needs to precreate multiple SCVMM VM templates for different
    sizes and options for providing flexibility to tenants in terms of choice. Any
    changes in the existing standalone VM offering has to be performed at the SCVMM
    end only.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 云管理员需要预先创建多个 SCVMM 虚拟机模板，以提供不同的大小和选项，从而为租户提供灵活性。对现有独立虚拟机提供的任何更改都必须在 SCVMM 端进行。
- en: Since standalone VM in Windows Azure Pack uses SCVMM VM templates directly,
    it is normally used to provide the vanilla operating system or OS with preinstalled
    or configured applications. It cannot be used to install applications as per tenants'
    needs in an automated fashion (which is provided by the service template engine
    in SCVMM).
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 由于 Windows Azure Pack 中的独立虚拟机直接使用 SCVMM 虚拟机模板，因此通常用于提供标准操作系统或预安装或配置应用程序的操作系统。它不能用于根据租户需求以自动化方式安装应用程序（这由
    SCVMM 中的服务模板引擎提供）。
- en: In further topics, you will learn to create a SCVMM VM template, which can be
    used by standalone VM Role in Windows Azure Pack.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 在后续的主题中，你将学习如何创建一个 SCVMM 虚拟机模板，该模板可供 Windows Azure Pack 中的独立虚拟机角色使用。
- en: VM Role
  id: totrans-159
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 虚拟机角色
- en: VM Role in Windows Azure Pack provides a customizable self-service wizard for
    tenant users to request for virtual machines, which gives flexibility to tenant
    users to customize their virtual machines as per requirements. VM Roles can also
    be used to deploy automated applications at the top of virtual machines being
    delivered in the same self-service manner.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: Windows Azure Pack 中的虚拟机角色为租户用户提供了一个可定制的自服务向导，用于请求虚拟机，这使租户用户可以根据需求自定义虚拟机。虚拟机角色也可以用于在虚拟机之上自动化部署应用程序，并以相同的自服务方式交付。
- en: Unlike standalone VM Role, VM Role uses a service template engine of SCVMM for
    provisioning OS and apps.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 与独立虚拟机角色不同，虚拟机角色使用 SCVMM 的服务模板引擎来配置操作系统和应用程序。
- en: VM Role in Windows Azure Pack subscription may contain multiple virtual machines
    of the same type or application and can be scaled easily (by just moving a sliding
    bar).
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: Windows Azure Pack 订阅中的 VM 角色可以包含相同类型或应用程序的多个虚拟机，并且可以轻松扩展（只需移动滑块）。
- en: 'VM Role provides a lot of flexibilities over standalone VMs such as the following:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟机角色提供了比独立虚拟机更多的灵活性，具体包括：
- en: Customizable self-service wizard for tenant's VM requests
  id: totrans-164
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为租户的虚拟机请求提供可定制的自服务向导。
- en: With VM Role, tenants control VM configurations and deployment with options
    provided by the cloud provider, which removes any dependency on the VMM administrator
    for any VM changes required on the standard template.
  id: totrans-165
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用虚拟机角色，租户可以根据云提供商提供的选项控制虚拟机配置和部署，这消除了租户用户对 VMM 管理员在标准模板上所需的任何虚拟机更改的依赖。
- en: It adds extreme automation capabilities with the integration of **SMA** (**Service
    Management Automation**)
  id: totrans-166
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它通过与 **SMA**（**服务管理自动化**）的集成，提供极高的自动化能力。
- en: It deploys applications and not just virtual machines in a self-service automated
    manner
  id: totrans-167
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它不仅以自服务自动化的方式部署虚拟机，还可以部署应用程序。
- en: It deploys and manage multiple instances of the same type under a single umbrella
  id: totrans-168
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它在一个统一的框架下部署和管理相同类型的多个实例。
- en: It scales out the number of instances in just one click (by moving a slider)
  id: totrans-169
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它只需点击一下（通过移动滑块）即可扩展实例数量。
- en: It provides the flexibility of using Hyper-V differencing or dedicated disks
    (added in CU5) for operating systems saving ample amount of disk space and management
    in larger deployments
  id: totrans-170
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它提供了使用 Hyper-V 差异磁盘或专用磁盘（在 CU5 中新增）来节省大量磁盘空间和管理开销的灵活性，适用于大型部署的操作系统。
- en: Microsoft and third-party vendors provide a wide range of preconfigured gallery
    items for VM Roles for standard usage. Custom VM Roles can also be developed which
    makes sky the limit for VM Role offerings possibilities.
  id: totrans-171
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 微软和第三方供应商提供了广泛的预配置画廊项目，供虚拟机角色用于标准使用。也可以开发自定义虚拟机角色，这使得虚拟机角色的提供可能性几乎无限。
- en: In further topics, you will learn architecture, implementation, and other aspects
    of VM Roles.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 在后续的主题中，您将学习虚拟机角色的架构、实现和其他方面的内容。
- en: Building standalone VM IaaS offerings
  id: totrans-173
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 构建独立虚拟机 IaaS 服务
- en: For every standalone VM offering in Windows Azure pack cloud, there has to be
    a direct mapping present with VM template in the SCVMM library. The VM template
    in the SCVMM library can be configured using a virtual disk prepared in the earlier
    topics. Let's start creating VM templates in SCVMM for Windows Azure Pack usage.
    Multiple templates can be created using the same VHD and defined hardware/OS profile
    combinations to provide flexible options for tenants for deploying VM workloads.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 每个 Windows Azure Pack 云中的独立虚拟机服务都必须与 SCVMM 库中的虚拟机模板有直接映射。SCVMM 库中的虚拟机模板可以使用之前准备的虚拟磁盘进行配置。我们现在开始为
    Windows Azure Pack 创建 SCVMM 中的虚拟机模板。可以使用相同的 VHD 和定义的硬件/操作系统配置组合创建多个模板，为租户提供灵活的虚拟机工作负载部署选项。
- en: Requirements for using VM templates for Windows Azure Pack
  id: totrans-175
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用虚拟机模板为 Windows Azure Pack 提供服务的要求
- en: 'The following consideration must be taken care while creating VM templates
    to be used for a standalone VM in Windows Azure Pack:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 创建用于 Windows Azure Pack 独立虚拟机的虚拟机模板时必须考虑以下事项：
- en: There must not be any cloud capability profile selected on the hardware profile
    page in the template creation wizard. The same case applies in case of any preconfigured
    hardware profile that is being used.
  id: totrans-177
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在模板创建向导的硬件配置页面上，不得选择任何云能力配置文件。如果使用的是任何预配置的硬件配置文件，情况也是一样。
- en: The VHD that is being used to create the template must have a remote desktop
    enabled.
  id: totrans-178
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用于创建模板的 VHD 必须启用远程桌面。
- en: While creating the VM template, the guest OS profile must be selected from the
    drop-down list. It should not be selected as none.
  id: totrans-179
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在创建虚拟机模板时，必须从下拉列表中选择客户操作系统配置文件。不能选择为“无”。
- en: Creating a SCVMM virtual machine template for Windows Azure Pack standalone
    VM Cloud offerings
  id: totrans-180
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建用于 Windows Azure Pack 独立虚拟机云服务的 SCVMM 虚拟机模板
- en: Before creating VM templates, prepare the required VHDs for templates and copy
    them to the VMM library.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建虚拟机模板之前，准备好所需的 VHD 文件并将其复制到 VMM 库中。
- en: 'Steps for creating a VM template for the standalone VM Role are as follows:'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 创建独立虚拟机角色模板的步骤如下：
- en: Log into SCVMM using the VMM management console with administrator privileges.
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用具有管理员权限的 VMM 管理控制台登录 SCVMM。
- en: Navigate to the **Library** workspace and expand **Templates**.![Creating a
    SCVMM virtual machine template for Windows Azure Pack standalone VM Cloud offerings](img/00068.jpeg)
  id: totrans-184
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到**库**工作区并展开**模板**。![创建用于 Windows Azure Pack 独立虚拟机云服务的 SCVMM 虚拟机模板](img/00068.jpeg)
- en: Click **Create VM Template** to start the VM template wizard.
  id: totrans-185
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**创建虚拟机模板**以启动虚拟机模板向导。
- en: Select **Use an Existing VM template or virtual hard disk stored in the library**.
    You can also choose **From an existing virtual machine that is deployed on a host**
    if the VHD file isn't already copied to the VMM library.![Creating a SCVMM virtual
    machine template for Windows Azure Pack standalone VM Cloud offerings](img/00069.jpeg)
  id: totrans-186
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**使用库中存储的现有虚拟机模板或虚拟硬盘**。如果 VHD 文件尚未复制到 VMM 库，也可以选择**从已部署在主机上的现有虚拟机**。![创建用于
    Windows Azure Pack 独立虚拟机云服务的 SCVMM 虚拟机模板](img/00069.jpeg)
- en: Click on **Browse** to select VHD from the disks available in the VMM library.
  id: totrans-187
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**浏览**以从 VMM 库中选择可用的 VHD。
- en: Provide the Template Name, Description, and Generation. Use a self-explanatory
    name and description that provides details about VM as this will be visible to
    the tenant user on the Windows Azure Pack portal. It's a good idea to include
    both hardware and software configurations along with the feature set available
    in the description.
  id: totrans-188
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供模板名称、描述和代数。使用一个具有自解释性的名称和描述，详细说明虚拟机的相关信息，因为这些将显示给 Windows Azure Pack 门户中的租户用户。最好在描述中包括硬件和软件配置以及可用的功能集。
- en: Note
  id: totrans-189
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The generation of VM describes features and functionality available with virtual
    machines. Generation 2 VM introduces the Hyper-V 2012 R2; it provides support
    for the UEFI firmware, all synthetic devices, and more. See [https://technet.microsoft.com/en-in/library/dn282285.aspx](https://technet.microsoft.com/en-in/library/dn282285.aspx)
    to learn more about generation 2 virtual machines.
  id: totrans-190
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 虚拟机的代数描述了虚拟机的特性和功能。第 2 代虚拟机引入了 Hyper-V 2012 R2，支持 UEFI 固件、所有合成设备等功能。有关第 2 代虚拟机的更多信息，请访问
    [https://technet.microsoft.com/en-in/library/dn282285.aspx](https://technet.microsoft.com/en-in/library/dn282285.aspx)。
- en: '![Creating a SCVMM virtual machine template for Windows Azure Pack standalone
    VM Cloud offerings](img/00070.jpeg)'
  id: totrans-191
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![为Windows Azure Pack独立虚拟机云提供创建SCVMM虚拟机模板](img/00070.jpeg)'
- en: Use a precreated hardware profile or custom settings to customize hardware for
    the template. Ensure that no cloud capability profile is selected. Any hardware
    change in the offering at later storage has to be done in the hardware profile
    properties of the VM template.
  id: totrans-192
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用预创建的硬件配置文件或自定义设置来定制模板的硬件。确保未选择任何云能力配置文件。在稍后的存储中，任何硬件更改必须在虚拟机模板的硬件配置文件属性中进行。
- en: Configure a proper network configuration such as virtual switch name, IP pool,
    and MAC (has to be static) as per the tenant's requirement. Add any additional
    hardware such as data disks at this stage.![Creating a SCVMM virtual machine template
    for Windows Azure Pack standalone VM Cloud offerings](img/00071.jpeg)
  id: totrans-193
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 根据租户的需求配置适当的网络配置，如虚拟交换机名称、IP池和MAC地址（必须是静态的）。在此阶段添加任何额外硬件，例如数据磁盘。![为Windows Azure
    Pack独立虚拟机云提供创建SCVMM虚拟机模板](img/00071.jpeg)
- en: Configure operating system profile settings. Do not select none in the OS profile
    settings; instead, precreate **Guest OS profiles** and select it from the drop-down
    list. Make necessary changes, such as Windows OS version, administrator password,
    time zone, product key, Domain/Workgroup, scripts to run, and so on. Do not select
    any Roles and features to add in this page. These are supported only with service
    templates or VM Role.![Creating a SCVMM virtual machine template for Windows Azure
    Pack standalone VM Cloud offerings](img/00072.jpeg)
  id: totrans-194
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置操作系统配置文件设置。不要在操作系统配置文件设置中选择"无"；相反，预先创建**客户操作系统配置文件**并从下拉列表中选择。进行必要的更改，例如Windows操作系统版本、管理员密码、时区、产品密钥、域/工作组、要运行的脚本等。不要在此页面中选择任何角色和功能。这些仅在服务模板或虚拟机角色中支持。![为Windows
    Azure Pack独立虚拟机云提供创建SCVMM虚拟机模板](img/00072.jpeg)
- en: Select none for the application profile and SQL profile settings as these aren't
    supported with standalone VM.
  id: totrans-195
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于应用程序配置文件和SQL配置文件设置请选择"无"，因为这些在独立虚拟机中不受支持。
- en: Review the settings on the **Summary** page and finish the wizard for creating
    the VM template.
  id: totrans-196
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 审查**摘要**页面中的设置，并完成向导以创建虚拟机模板。
- en: View job status under the **Jobs** windows in **Settings**.
  id: totrans-197
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**设置**中的**作业**窗口查看作业状态。
- en: The newly created template will be available in the VMM library workspace under
    the **VM Templates** section.
  id: totrans-198
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 新创建的模板将在VMM库工作区的**虚拟机模板**部分中可用。
- en: Testing the VM template functionality
  id: totrans-199
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 测试虚拟机模板功能
- en: 'Before assigning this standalone VM template in a Windows Azure Pack deployment,
    it''s a good idea to test the configuration by provisioning a test virtual machine
    using the following steps:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 在Windows Azure Pack部署中分配此独立虚拟机模板之前，最好通过以下步骤配置一个测试虚拟机来测试配置：
- en: Log into SCVMM and browse the **VM template** section under the **Library**
    workspace.
  id: totrans-201
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到SCVMM并浏览**库**工作区下的**虚拟机模板**部分。
- en: Right-click on the newly created VM template and select **Create Virtual Machine**.![Testing
    the VM template functionality](img/00073.jpeg)
  id: totrans-202
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 右键点击新创建的虚拟机模板并选择**创建虚拟机**。![测试虚拟机模板功能](img/00073.jpeg)
- en: Provide the VM name and description. It's good to use the same the VM name and
    hostname for any VM to ensure consistency and easy identification at each layer.
  id: totrans-203
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供虚拟机名称和描述。最好为任何虚拟机使用相同的虚拟机名称和主机名，以确保一致性并在每一层都能轻松识别。
- en: Customize the hardware and guest OS profile if required.
  id: totrans-204
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如有需要，定制硬件和客户操作系统配置文件。
- en: Select the newly created cloud or host group as the destination for VM.![Testing
    the VM template functionality](img/00074.jpeg)
  id: totrans-205
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择新创建的云或主机组作为虚拟机的目标。![测试虚拟机模板功能](img/00074.jpeg)
- en: Configure the operating system computer name and add custom properties such
    as server power on/off action.
  id: totrans-206
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置操作系统计算机名称，并添加自定义属性，如服务器开关机操作。
- en: Review the selected values in the summary and click on **Create** to start creating
    this virtual machine.
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 审查摘要中的所选值，然后点击**创建**以开始创建此虚拟机。
- en: Monitor the VM creation job for any errors; browse VMs and the service workspace
    in SCVMM management console post successful completion.
  id: totrans-208
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 监控虚拟机创建作业是否有错误；在作业成功完成后，浏览虚拟机和SCVMM管理控制台中的服务工作区。
- en: Log into the newly created virtual machine and verify the expected results as
    per the configuration.
  id: totrans-209
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到新创建的虚拟机，并根据配置验证预期结果。
- en: The VM Role architecture
  id: totrans-210
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 虚拟机角色架构
- en: VM Role in Windows Azure Pack adds greater flexibilities and self-service capabilities
    in IaaS offerings. VM Role is not just about providing virtual machines for tenant's
    workload, it takes IaaS services to another level by offering automated applications
    deployment in VM in a self-service manner.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: Windows Azure Pack 中的虚拟机角色为 IaaS 产品提供了更大的灵活性和自助服务功能。虚拟机角色不仅仅是为租户的工作负载提供虚拟机，它通过以自助服务的方式提供自动化的应用程序部署，将
    IaaS 服务提升到了另一个层次。
- en: VM Role packages are developed in JSON and provide resources or values, which
    are used to provision virtual machines and applications. **JSON** (**JavaScript
    Object Notation**) is a lightweight format used for data interchanging.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟机角色包是用 JSON 开发的，并提供用于配置虚拟机和应用程序的资源或值。**JSON**（**JavaScript 对象表示法**）是一种轻量级的数据交换格式。
- en: JSON files for a VM Role along with metadata such as logos, resources, and more
    make a VM Role package.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 包含虚拟机角色的 JSON 文件以及元数据（如图标、资源等）构成了虚拟机角色包。
- en: 'A VM Role is primarily made up of two components/packages as follows:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 一个虚拟机角色主要由以下两个组件/包组成：
- en: Resource Definition package
  id: totrans-215
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 资源定义包
- en: Resource Extension package
  id: totrans-216
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 资源扩展包
- en: Before diving into these packages, let's understand VM Role's working mechanism.
    In a traditional scenario without any self-service portal, VM creation requires
    some set of input as variables, such as hardware configuration (the number of
    CPUs, the amount of memory, and more) and network configurations (virtual switch
    ), which are provided by virtualization administrators during the VM creation
    process. Similar things happen in a cloud-based self-service scenario where some
    value, such as VM name, configuration, and so on, would be provided to tenants
    as per their needs and some will be preconfigured by the cloud administrator,
    such as the hypervisor host to use, or SCVMM cloud to leverage for deploying VM.
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 在深入了解这些包之前，让我们先理解虚拟机角色的工作机制。在没有自助服务门户的传统场景中，虚拟机创建需要一组输入变量，如硬件配置（CPU 数量、内存大小等）和网络配置（虚拟交换机），这些是由虚拟化管理员在虚拟机创建过程中提供的。在基于云的自助服务场景中，也会发生类似的事情，其中某些值（如虚拟机名称、配置等）会根据租户需求提供，而某些则由云管理员预先配置，例如用于虚拟机部署的虚拟化主机或
    SCVMM 云。
- en: In Windows Azure Pack-based cloud solution, a tenant user will provide tenant-specific
    values in Windows Azure Pack tenant portal using a self-service wizard. These
    values need to be passed to SCVMM where it will add up the administrator specified
    values and start the creation of virtual machine. In a similar manner, application
    deployment on IaaS services will also have to get values from the tenant user
    and administrator to deploy applications.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 在基于 Windows Azure Pack 的云解决方案中，租户用户将通过自助服务向导在 Windows Azure Pack 租户门户中提供特定于租户的值。这些值需要传递给
    SCVMM，在那里它会添加管理员指定的值并开始虚拟机的创建。以类似的方式，IaaS 服务上的应用部署也需要从租户用户和管理员那里获取值，以便部署应用。
- en: All these operations have to be done in a self-service and automated manner.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 所有这些操作都必须以自助服务和自动化的方式进行。
- en: VM Role packages or gallery resource packages that were mentioned previously
    facilitate the preceding functionalities.
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 前面提到的虚拟机角色包或画廊资源包便于实现上述功能。
- en: Resource definition packages
  id: totrans-221
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 资源定义包
- en: A resource definition package consists of VM configuration or values available
    to tenant users in a self-service wizard and their mapping with resourced resources
    in SCVMM, defined via a resource extension package. The definition of resource
    also contains a small package called `View Definition`, which includes values
    and graphical images visible to tenant users. If applicable, view resource definition
    values are mapped to the resource extension, and they are passed to VMM for VM
    and application deployment. Resource definition packages are stored with the `.resdefpkg`
    extension and gets imported in Windows Azure Pack.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 资源定义包包含虚拟机配置或在自助服务向导中提供给租户用户的值，以及通过资源扩展包定义的与 SCVMM 中资源的映射。资源定义还包含一个小包，叫做 `视图定义`，它包含租户用户可见的值和图形图像。如果适用，视图资源定义值会映射到资源扩展，并传递给
    VMM 以进行虚拟机和应用程序部署。资源定义包以 `.resdefpkg` 扩展名存储，并导入到 Windows Azure Pack 中。
- en: 'Overall, the following files make up the resource definition package:'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 总体来说，以下文件构成了资源定义包：
- en: '**Resource Definition file** **(RESDEF File)**: It contains all parameters
    required by SCVMM—from VM Role to provisioning virtual machines and services'
  id: totrans-224
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**资源定义文件** **（RESDEF 文件）**：它包含 SCVMM 所需的所有参数——从虚拟机角色到虚拟机和服务的配置。'
- en: '**View Definition file** **(VIEWDEF File)**: It contains forms and icon mapping
    (Publisher icon/Resource icon) that are visible to tenant users while requesting
    IaaS resource using the VM Role gallery items'
  id: totrans-225
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**查看定义文件** **（VIEWDEF 文件）**：它包含表单和图标映射（发布者图标/资源图标），在租户用户请求 IaaS 资源时会显示这些内容，使用虚拟机角色画廊项。'
- en: '**Icons**: These icons are visible to tenant users in the list of gallery items'
  id: totrans-226
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**图标**：这些图标在画廊项列表中对租户用户可见。'
- en: '**Localization files**: These files are used to display the gallery item self-service
    deployment wizard with localized values'
  id: totrans-227
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**本地化文件**：这些文件用于显示具有本地化值的画廊项自助服务部署向导。'
- en: Resource definition package includes conditions or parameters values, which
    must be met at SCVMM resource level to know which hard disk to use for OS or data
    . These values need to be configured on resources stored in SCVMM for VM Role
    usage. For example, a VM Role for Windows Server 2012 R2 VM is likely to have
    a condition configured that uses VHD available in SCVMM with the operating system
    family Windows Server 2012 and so on. Only compatible resources are available
    to tenant users to choose in the gallery resource deployment wizard.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 资源定义包包括条件或参数值，这些条件或参数值必须在 SCVMM 资源级别满足，以确定使用哪个硬盘作为操作系统或数据存储。这些值需要在 SCVMM 中为虚拟机角色使用配置在资源上。例如，Windows
    Server 2012 R2 虚拟机的虚拟机角色可能会配置一个条件，使用 SCVMM 中与操作系统系列 Windows Server 2012 兼容的 VHD
    等。只有兼容的资源才能在画廊资源部署向导中供租户用户选择。
- en: Resources extension packages
  id: totrans-229
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 资源扩展包
- en: Resources extension packages are imported in System Center Virtual Machine Manager.
    Extension packages are used to provision the applications as a part of VM Role
    deployment. This is an optional component of VM Role and is used only while deploying
    VM Roles with automated applications provisioning. This can be compared to application
    profiles in VMM service templates. Resource extension leverages the SCVMM service
    template engine for executing application logic.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 资源扩展包在系统中心虚拟机管理器中导入。扩展包用于将应用作为虚拟机角色部署的一部分进行配置。这个组件是虚拟机角色的可选部分，仅在使用自动化应用程序配置部署虚拟机角色时使用。这可以与
    VMM 服务模板中的应用配置文件进行比较。资源扩展利用 SCVMM 服务模板引擎执行应用程序逻辑。
- en: Parameters configured in resource extension packages are mapped to parameters
    in resource definition.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 在资源扩展包中配置的参数与资源定义中的参数进行映射。
- en: Along with resource extension packages, some VM Roles also contain **Application
    payload**.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 除了资源扩展包外，一些虚拟机角色还包含**应用负载**。
- en: Application payload contains resources such as installation binaries or media
    and scripts and other prerequisites for application deployment. This is an optional
    component, and its necessity varies from application to application.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 应用负载包含诸如安装二进制文件、媒体、脚本和其他应用部署所需的先决条件等资源。这个组件是可选的，其必要性因应用而异。
- en: Getting VM Role gallery resources
  id: totrans-234
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 获取虚拟机角色画廊资源
- en: 'Gallery resources consist of required packages such as resource definition
    packages, resource extension packages, and application payloads for any VM Role.
    Organizations or service providers choose the following ways to get gallery resources
    for their Cloud VM Role offerings:'
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 画廊资源包括所需的包，例如资源定义包、资源扩展包和任何虚拟机角色的应用负载。组织或服务提供商可以选择以下方式获取画廊资源以供云虚拟机角色使用：
- en: '**Use Microsoft or third party provided gallery resources**: The Microsoft
    web platform installer includes a wide range of ready-made gallery resources for
    various offering, such as Windows Server Virtual Machine, web servers, domain
    controllers, and more. These gallery items can be downloaded and customized as
    per specific environment-based requirements'
  id: totrans-236
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**使用微软或第三方提供的画廊资源**：微软网页平台安装程序包括各种现成的画廊资源，适用于多种产品，例如 Windows Server 虚拟机、Web
    服务器、域控制器等。这些画廊项可以根据特定环境需求进行下载和自定义。'
- en: '**Develop own custom gallery items**: Organizations or service providers may
    also choose to develop their own gallery items in JSON. This gives the flexibility
    of offering almost everything in the Windows Azure Pack-based cloud solution.'
  id: totrans-237
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**开发自定义画廊项**：组织或服务提供商还可以选择以 JSON 格式开发自己的画廊项。这为基于 Windows Azure Pack 的云解决方案提供几乎所有内容的灵活性。'
- en: Dealing with gallery items – available tools
  id: totrans-238
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 处理画廊项——可用工具
- en: 'While JSON files and packages look more of developer stuff instead of IT professional,
    there are certain tools available that can be leveraged by IT professionals or
    cloud providers to deal with gallery items without any development knowledge (at
    least language specific). Microsoft and third-party vendors provide the following
    tools for dealing with gallery items in Windows Azure Pack-based deployment:'
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然 JSON 文件和包看起来更像是开发者的东西，而不是 IT 专业人员的工具，但有一些工具可以被 IT 专业人员或云服务提供商利用，以便在没有任何开发知识（至少是特定语言的知识）的情况下处理画廊项。微软和第三方供应商提供以下工具来处理基于
    Windows Azure Pack 部署的画廊项：
- en: '**VM Role authoring tool**: This tool can be used to create, view, and edit
    gallery item packages, such as resource definition package, resource extension
    package, and more. It can also be used to edit Microsoft or vendor provided gallery
    items for custom modifications. This tool is developed by CodePlex ([https://vmRoleauthor.codeplex.com/](https://vmRoleauthor.codeplex.com/)).'
  id: totrans-240
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**VM 角色创作工具**：此工具可用于创建、查看和编辑画廊项包，如资源定义包、资源扩展包等。它还可以用于编辑微软或供应商提供的画廊项，以便进行自定义修改。此工具由
    CodePlex 开发（[https://vmRoleauthor.codeplex.com/](https://vmRoleauthor.codeplex.com/)）。'
- en: '**Gallery resource import tool**: This tool simplifies the process of importing
    resource definition package into Windows Azure Pack, resource extension package
    into SCVMM, and sets the properties of resources such as hard disks. This tool
    is completely written in PowerShell.'
  id: totrans-241
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**画廊资源导入工具**：此工具简化了将资源定义包导入到 Windows Azure Pack，将资源扩展包导入到 SCVMM，并设置资源属性（如硬盘）的过程。此工具完全使用
    PowerShell 编写。'
- en: Building VM Role IaaS offerings using gallery resources
  id: totrans-242
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用画廊资源构建 VM 角色 IaaS 产品
- en: Microsoft and some third-party vendors have developed a wide range of standard
    gallery items for public usage. These gallery items can be downloaded and used
    by organizations or service providers for their cloud IaaS offerings. The beauty
    is that these can also be customized or modified to meet specific custom requirements.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 微软和一些第三方供应商已经开发了广泛的标准画廊项供公众使用。这些画廊项可以被组织或服务提供商下载并用于他们的云 IaaS 产品。值得注意的是，这些项也可以根据特定的定制需求进行修改或定制。
- en: The Microsoft Web Platform installer is used to download the Microsoft provided
    Windows Azure Pack gallery items.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 微软 Web 平台安装程序用于下载微软提供的 Windows Azure Pack 画廊项。
- en: Downloading gallery items using Microsoft Web PI
  id: totrans-245
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 Microsoft Web PI 下载画廊项
- en: 'Windows Azure Pack gallery items aren''t available in the standard WEB PI downloads
    list; custom feeds have to be added. Let''s have a look at the steps to download
    these resources:'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: Windows Azure Pack 画廊项不在标准 Web PI 下载列表中；必须添加自定义源。我们来看看下载这些资源的步骤：
- en: Log into Windows Azure Pack or any other server with Internet connectivity.
  id: totrans-247
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录 Windows Azure Pack 或任何其他具有互联网连接的服务器。
- en: Launch **Microsoft Web Platform Installer** ([https://www.microsoft.com/web/downloads/platform.aspx](https://www.microsoft.com/web/downloads/platform.aspx)).
  id: totrans-248
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动**Microsoft Web 平台安装程序**（[https://www.microsoft.com/web/downloads/platform.aspx](https://www.microsoft.com/web/downloads/platform.aspx)）。
- en: Click on the **Options** link at the bottom of Web PI.
  id: totrans-249
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 Web PI 底部的**选项**链接。
- en: Add [http://www.microsoft.com/web/webpi/partners/servicemodels.xml](http://www.microsoft.com/web/webpi/partners/servicemodels.xml)
    in **Custom Feeds**.![Downloading gallery items using Microsoft Web PI](img/00075.jpeg)
  id: totrans-250
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**自定义源**中添加 [http://www.microsoft.com/web/webpi/partners/servicemodels.xml](http://www.microsoft.com/web/webpi/partners/servicemodels.xml)。![使用
    Microsoft Web PI 下载画廊项](img/00075.jpeg)
- en: The new **Service Models** options will now be available in the Web PI.
  id: totrans-251
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 新的**服务模型**选项现在将在 Web PI 中提供。
- en: Browse through the **Server Model** option and **Gallery Resource**. Select
    **Add** for gallery resources to be downloaded.
  id: totrans-252
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 浏览**服务器模型**选项和**画廊资源**。选择**添加**以下载画廊资源。
- en: Clicking on **Install** will download these gallery resources on a local folder
    on a server where PI is running.![Downloading gallery items using Microsoft Web
    PI](img/00076.jpeg)
  id: totrans-253
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**安装**将把这些画廊资源下载到运行 PI 的服务器上的本地文件夹中。![使用 Microsoft Web PI 下载画廊项](img/00076.jpeg)
- en: Preparing and importing gallery resources in Windows Azure Pack and SCVMM
  id: totrans-254
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在 Windows Azure Pack 和 SCVMM 中准备和导入画廊资源
- en: 'Each gallery resource downloaded from Web PI usually contains one or more packages
    from the following:'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 从 Web PI 下载的每个画廊资源通常包含以下一个或多个包：
- en: One or more Resource Definition Packages
  id: totrans-256
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个或多个资源定义包
- en: Resource Extension Packages
  id: totrans-257
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 资源扩展包
- en: ReadMe file
  id: totrans-258
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ReadMe 文件
- en: Any other application payload files
  id: totrans-259
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 任何其他应用程序负载文件
- en: The `ReadMe` file in gallery resources files usually contains a description
    about VM Role, package details, other application payload details, and download
    link if applicable. The most important thing is that it contains instructions
    for preparing SCVMM resources to be used for provisioning VM and applications.
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: '`ReadMe` 文件通常包含关于 VM 角色、包详情、其他应用负载详情以及适用时的下载链接。最重要的是，它包含了为 VM 和应用程序提供资源所需准备
    SCVMM 资源的说明。'
- en: 'Importing a gallery item in Windows Azure Pack/SCVMM and making it usable usually
    consists of the following operations:'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Windows Azure Pack/SCVMM 中导入画廊项并使其可用通常包括以下操作：
- en: Download gallery resources and any application payload specified in the. `ReadMe`
    file.
  id: totrans-262
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下载 `ReadMe` 文件中指定的画廊资源和任何应用负载。
- en: Prepare operating system or data disks as specified in `ReadMe`. The OS disk
    must be prepared with `sysprep` and uploaded to the VMM library.
  id: totrans-263
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 根据 `ReadMe` 文件中的要求准备操作系统或数据磁盘。操作系统磁盘必须使用 `sysprep` 准备，并上传到 VMM 库。
- en: Import Resource Extension Package in SCVMM.
  id: totrans-264
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 SCVMM 中导入资源扩展包。
- en: Prepare virtual hard disks (OS/data disks) properties as specified in `ReadMe`.
  id: totrans-265
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照 `ReadMe` 中的说明准备虚拟硬盘（操作系统/数据磁盘）属性。
- en: Import Resource Definition Packages in Windows Azure Pack.
  id: totrans-266
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Windows Azure Pack 中导入资源定义包。
- en: Perform any other additional tasks if required as per the `ReadMe` file.
  id: totrans-267
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果 `ReadMe` 文件中有其他要求，请执行相应的附加任务。
- en: Test the provisioning.
  id: totrans-268
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 测试配置。
- en: Importing resource extension packages in SCVMM
  id: totrans-269
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在 SCVMM 中导入资源扩展包。
- en: Windows PowerShell cmdlet is used to import resource extension packages in SCVMM.
    There is no VMM or Windows Azure Pack GUI available to perform this function at
    this point of time.
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 Windows PowerShell cmdlet 在 SCVMM 中导入资源扩展包。此时没有 VMM 或 Windows Azure Pack
    图形用户界面可用来执行此功能。
- en: 'The following PowerShell commands can be used to import this:'
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 以下 PowerShell 命令可用于导入此资源扩展：
- en: Launch Virtual Machine Manager PowerShell Module.
  id: totrans-272
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动虚拟机管理器 PowerShell 模块。
- en: 'Connect to the VMM server using admin privileges. The following PowerShell
    code can be used for connecting to the VMM server in a PowerShell session:'
  id: totrans-273
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用管理员权限连接到 VMM 服务器。以下 PowerShell 代码可用于在 PowerShell 会话中连接到 VMM 服务器：
- en: '[PRE2]'
  id: totrans-274
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Enter VMM FQDN on the computer name attribute value. This will connect to the
    VMM service using credentials logged into Windows.
  id: totrans-275
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在计算机名属性值中输入 VMM FQDN。这将使用登录到 Windows 的凭证连接到 VMM 服务。
- en: Execute the following PowerShell as per requirements to import the resource
    extension in VMM.
  id: totrans-276
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 根据要求执行以下 PowerShell 命令，将资源扩展导入到 VMM 中。
- en: 'The following code will import the Resource Extension named `SampleVMRole.resextpkg`
    stored at the `SystemDrive\GalleryResources\Sample-VMRole-Pkg\MyVMRole.resextpkg`
    folder in the SCVMM library named `MSSCVMMLibrary`:'
  id: totrans-277
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 以下代码将在 SCVMM 库 `MSSCVMMLibrary` 中导入名为 `SampleVMRole.resextpkg` 的资源扩展，该包存储在 `SystemDrive\GalleryResources\Sample-VMRole-Pkg\MyVMRole.resextpkg`
    文件夹中：
- en: '[PRE3]'
  id: totrans-278
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Verify successful import by checking resource extension imported status using
    the following PowerShell command:'
  id: totrans-279
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下 PowerShell 命令验证资源扩展导入状态，以确认导入是否成功：
- en: '[PRE4]'
  id: totrans-280
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: The results will display all the Resource Extension imported in SCVMM.
  id: totrans-281
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 结果将显示在 SCVMM 中导入的所有资源扩展。
- en: Configuring virtual hard disks properties for VM Role
  id: totrans-282
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配置虚拟硬盘属性以供 VM 角色使用。
- en: Each VM Role gallery resource requires at least one OS virtual disk for VM deployment,
    and optionally, it requires one or more additional data disks. Since VMM usually
    contains lots of virtual hard disks, VHD properties such as OS name, OS family
    name and release, and tags are used to identify disks compatible with a specific
    VM Role.
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 每个 VM 角色画廊资源至少需要一个操作系统虚拟磁盘进行 VM 部署，另外可以选择性地需要一个或多个额外的数据磁盘。由于 VMM 通常包含大量虚拟硬盘，VHD
    属性如操作系统名称、操作系统系列名称和版本、标签等用于识别与特定 VM 角色兼容的磁盘。
- en: Each gallery resource has its own specific values for the previously mentioned
    parameters, which are defined in the `ReadMe` file. These parameters need to be
    configured manually on virtual hard disks prepared for the given VMM Role. All
    the compatible virtual hard disks, as per required parameters, are made available
    to tenant users' self-service portal while requesting for resources.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 每个画廊资源都有自己的特定参数值，这些参数在 `ReadMe` 文件中定义。需要手动在为给定 VMM 角色准备的虚拟硬盘上配置这些参数。所有符合要求参数的虚拟硬盘，在请求资源时将提供给租户用户的自服务门户。
- en: 'For example, the following attributes are required to be configured to the
    virtual hard disks that are available for a given gallery resource, which provisions
    VMs for Windows Server 2012 operating systems:'
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，以下属性是配置为可用于某个画廊资源的虚拟硬盘所必需的，该资源用于为 Windows Server 2012 操作系统提供虚拟机：
- en: '| **Configuration** | Install the following software:'
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: '| **配置** | 安装以下软件：'
- en: Windows Server 2012
  id: totrans-287
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows Server 2012
- en: '|'
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '| **The Operating System property** | Use one of the following:'
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: '| **操作系统属性** | 使用以下之一：'
- en: 64-bit edition of Windows Server 2012 Datacenter
  id: totrans-290
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 64 位版本的 Windows Server 2012 Datacenter
- en: 64-bit edition of Windows Server 2012 Standard
  id: totrans-291
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 64 位版本的 Windows Server 2012 Standard
- en: 64-bit edition of Windows Server 2012 Essentials
  id: totrans-292
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 64 位版本的 Windows Server 2012 Essentials
- en: Windows Server 2012 R2 Datacenter Preview
  id: totrans-293
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows Server 2012 R2 Datacenter 预览版
- en: Windows Server 2012 R2 Standard Preview
  id: totrans-294
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows Server 2012 R2 Standard 预览版
- en: Windows Server 2012 R2 Essentials Preview
  id: totrans-295
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows Server 2012 R2 Essentials 预览版
- en: '|'
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '| **The Familyname property** | Consider the following values for a familyname:'
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: '| **Familyname 属性** | 考虑以下 familyname 的值：'
- en: Windows Server 2012 Datacenter
  id: totrans-298
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows Server 2012 Datacenter
- en: Windows Server 2012 Standard
  id: totrans-299
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows Server 2012 Standard
- en: Windows Server 2012 Essentials
  id: totrans-300
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows Server 2012 Essentials
- en: Windows Server 2012 R2 Datacenter Preview
  id: totrans-301
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows Server 2012 R2 Datacenter 预览版
- en: Windows Server 2012 R2 Standard Preview
  id: totrans-302
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows Server 2012 R2 Standard 预览版
- en: Windows Server 2012 R2 Essentials Preview
  id: totrans-303
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows Server 2012 R2 Essentials 预览版
- en: '|'
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '| **Tags** | Add all of the following tags:'
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: '| **标签** | 添加以下所有标签：'
- en: Windows Server 2012
  id: totrans-306
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows Server 2012
- en: Windows Server 2012 R2
  id: totrans-307
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows Server 2012 R2
- en: '|'
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: These parameters can be configured using VMM GUI or VMM PowerShell. Tags parameter
    can only be configured using VMM PowerShell.
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: 这些参数可以通过 VMM GUI 或 VMM PowerShell 配置。`tags` 参数只能通过 VMM PowerShell 配置。
- en: Configuring the operating system property
  id: totrans-310
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 配置操作系统属性
- en: The operating system property specifies the operating system installed inside
    the virtual hard disk. This can be configured using the VMM management console
    or PowerShell.
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: 操作系统属性指定安装在虚拟硬盘中的操作系统。可以通过 VMM 管理控制台或 PowerShell 配置。
- en: 'In the following sample PowerShell, values can be replaced as per the gallery
    resource specific `Readme` file values:'
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下示例 PowerShell 中，值可以根据画廊资源的`Readme`文件中的值进行替换：
- en: '[PRE5]'
  id: totrans-313
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: For data disks, the operating system property must be set to *None*.
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 对于数据磁盘，操作系统属性必须设置为*无*。
- en: Configuring family name and release property
  id: totrans-315
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 配置 family name 和 release 属性
- en: The `familyName` and `release` properties are the configuration behind virtual
    disk availability in the tenant self-service provisioning wizard. All virtual
    disks having `familyName` and `release` properties configured, as per gallery
    resources requirements, are visible to a tenant user for usage.
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: '`familyName` 和 `release` 属性是虚拟磁盘在租户自助服务部署向导中可用性的配置。所有按画廊资源要求配置了 `familyName`
    和 `release` 属性的虚拟磁盘，租户用户都可以看到并使用。'
- en: The `familyName` usually contains OS version and VM Role specific values, such
    as webserver, domain controller, and so on. The `release` property usually controls
    multiple versions of virtual hard disks and is usually mentioned as 1.0.0.0, 1.0.0.1,
    1.1.0.0 and more.
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: '`familyName` 通常包含操作系统版本和虚拟机角色特定的值，例如 Web 服务器、域控制器等。`release` 属性通常控制虚拟硬盘的多个版本，通常表示为
    1.0.0.0、1.0.0.1、1.1.0.0 等。'
- en: 'The `familyName` and `release` properties can be configured using the VMM administrator
    console or PowerShell. See the following sample PowerShell for configuring the
    `familyName` and `release` properties for virtual hard disks. The values can be
    replaced as per requirements provided in the gallery resource `Readme` file:'
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: '`familyName`和`release`属性可以通过 VMM 管理控制台或 PowerShell 配置。请参阅以下示例 PowerShell，了解如何为虚拟硬盘配置`familyName`和`release`属性。值可以根据画廊资源`Readme`文件中提供的要求进行替换：'
- en: '[PRE6]'
  id: totrans-319
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Data disks may have values, such as SQL DB disk, larger disks, smaller disks,
    and so on.
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: 数据磁盘可以具有不同的值，例如 SQL DB 磁盘、更大的磁盘、更小的磁盘等。
- en: Configuring the tags property
  id: totrans-321
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 配置标签属性
- en: The `tags` property must be configured properly as per gallery resource requirements
    to make it available for provisioning. While it is a must for operating systems
    disks to have `tags` configured, data disks may or may not have `tags` specific
    requirement. Tags may be words defining Roles or features that VM Roles provides.
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: '`tags` 属性必须根据画廊资源要求正确配置，以便用于部署。操作系统磁盘必须配置 `tags`，而数据磁盘可能有也可能没有特定的 `tags` 要求。标签可能是定义角色或虚拟机角色提供的功能的词汇。'
- en: Tags can be configured only using VMM PowerShell. There is no VMM GUI option
    available at this point of time for configuring `tags` on virtual hard disks.
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: 标签只能通过 VMM PowerShell 配置。目前没有 VMM GUI 选项用于配置虚拟硬盘上的 `tags`。
- en: 'See the following sample PowerShell for configuring the `tags` property for
    virtual hard disks. Values can be replaced as per requirements provided in the
    gallery resource `Readme` file:'
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: 请参阅以下 PowerShell 示例，用于配置虚拟硬盘的 `tags` 属性。可以根据画廊资源 `Readme` 文件中提供的要求替换相关值：
- en: '[PRE7]'
  id: totrans-325
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Note
  id: totrans-326
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: PowerShell for configuring virtual disk properties must be executed on VMM PowerShell
    or Windows PowerShell, loaded with VMM modules, connected with the SCVMM instance.
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
  zh: 配置虚拟磁盘属性的 PowerShell 必须在 VMM PowerShell 或 Windows PowerShell 上执行，并加载 VMM 模块，且连接到
    SCVMM 实例。
- en: Importing the Resource Definition package in Windows Azure Pack
  id: totrans-328
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在 Windows Azure Pack 中导入资源定义包
- en: The Windows Azure Pack management or administrator portal or Windows Azure Pack
    PowerShell can be used to import gallery Resource Definition package in Windows
    Azure Pack.
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过 Windows Azure Pack 管理或管理员门户，或者 Windows Azure Pack PowerShell 导入画廊资源定义包。
- en: 'The following are the steps for importing gallery resource definition package
    in Windows Azure Pack:'
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是在 Windows Azure Pack 中导入画廊资源定义包的步骤：
- en: Log into the Windows Azure Pack management portal for administrators.
  id: totrans-331
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录 Windows Azure Pack 管理门户进行管理员操作。
- en: Navigate to the **vm clouds** workspace.
  id: totrans-332
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到 **vm clouds** 工作区。
- en: Click on the **GALLERY** tab.
  id: totrans-333
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **GALLERY** 标签。
- en: Click the **IMPORT** button from the tasks pane.![Importing the Resource Definition
    package in Windows Azure Pack](img/00077.jpeg)
  id: totrans-334
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从任务面板中点击 **IMPORT** 按钮。![在 Windows Azure Pack 中导入资源定义包](img/00077.jpeg)
- en: Select the resource definition file (`RESDEFPKG`) to be imported.
  id: totrans-335
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择要导入的资源定义文件（`RESDEFPKG`）。
- en: Items will be listed in the gallery upon successful import.![Importing the Resource
    Definition package in Windows Azure Pack](img/00078.jpeg)
  id: totrans-336
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导入成功后，项目信息将在画廊中列出。![在 Windows Azure Pack 中导入资源定义包](img/00078.jpeg)
- en: Imported gallery items can now be tested for deployment using Windows Azure
    Pack tenant portal. This will be covered in detail in the next chapter.
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: 导入的画廊项目信息现在可以通过 Windows Azure Pack 租户门户进行部署测试。该部分将在下一章详细介绍。
- en: Using GRIT (Gallery Resource Import) tool
  id: totrans-338
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 GRIT（画廊资源导入）工具
- en: GRIT, also known as Gallery Resource Import tool, is a Microsoft provided tool
    written in PowerShell. It can be used to ease the gallery resource downloading
    and installing process covered in the previous topic. The GRIT tool provides a
    graphical user interface for the lifecycle of gallery resource installation or
    import.
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
  zh: GRIT（也称为画廊资源导入工具）是微软提供的一个 PowerShell 编写的工具。它可以简化前面提到的画廊资源下载和安装过程。GRIT 工具为画廊资源的安装或导入生命周期提供了图形用户界面。
- en: It is recommended to use the GRIT tool while dealing with gallery resources
    for ease administrator and to avoid any human errors in PowerShell scripts.
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
  zh: 建议在处理画廊资源时使用 GRIT 工具，以方便管理员操作，并避免在 PowerShell 脚本中出现人为错误。
- en: GRIT functionalities
  id: totrans-341
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: GRIT 功能
- en: 'GRIT provides the following capabilities in an easy-to-use graphical user interface:'
  id: totrans-342
  prefs: []
  type: TYPE_NORMAL
  zh: GRIT 提供了一个易于使用的图形用户界面，具备以下功能：
- en: It can be used with both Microsoft provided gallery resources as well as custom
    developed resources
  id: totrans-343
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它既可以与微软提供的画廊资源一起使用，也可以与自定义开发的资源一起使用。
- en: It can download gallery resources directly from Microsoft (no need for a web
    PI)
  id: totrans-344
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它可以直接从 Microsoft 下载画廊资源（无需使用 Web PI）。
- en: Importing of Resource Extension files
  id: totrans-345
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 导入资源扩展文件
- en: Importing of Resource Definition files
  id: totrans-346
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 导入资源定义文件
- en: It can compare and configure virtual disk properties (for both OS and data disks)
    required for gallery resource with disks available in the VMM library
  id: totrans-347
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它可以比较并配置画廊资源所需的虚拟磁盘属性（包括操作系统磁盘和数据磁盘），并与 VMM 库中可用的磁盘进行对比。
- en: It makes gallery items private and public (this is discussed in detail in the
    next chapter)
  id: totrans-348
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它可以使画廊项目信息变为私有或公开（这一点将在下一章详细讨论）。
- en: Removal of Resource Definition or Extension files
  id: totrans-349
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 移除资源定义或扩展文件
- en: Using GRIT for dealing with gallery resource
  id: totrans-350
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 GRIT 处理画廊资源
- en: The latest version of the GRIT tool is 1.2, which can be download from [https://gallery.technet.microsoft.com/Gallery-Resource-Import-2273ce71](https://gallery.technet.microsoft.com/Gallery-Resource-Import-2273ce71).
    The GRIT tool needs to have access to SCVMM, SPF, and Windows Azure Pack; hence,
    the SPF server is the best place to run the tool.
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: GRIT 工具的最新版本是 1.2，可以从[https://gallery.technet.microsoft.com/Gallery-Resource-Import-2273ce71](https://gallery.technet.microsoft.com/Gallery-Resource-Import-2273ce71)下载。GRIT
    工具需要访问 SCVMM、SPF 和 Windows Azure Pack，因此 SPF 服务器是运行此工具的最佳位置。
- en: 'We need to carry out the following steps to use GRIT:'
  id: totrans-352
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要执行以下步骤以使用 GRIT：
- en: Download the GRIT tool and log into Windows with an account having permission
    on SCVMM, SPF, and Windows Azure Pack.
  id: totrans-353
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下载 GRIT 工具并使用具有 SCVMM、SPF 和 Windows Azure Pack 权限的帐户登录 Windows。
- en: Execute the downloaded `GalleryResourceImportTool.ps1` PowerShell script with
    elevated access.
  id: totrans-354
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以提升权限执行下载的`GalleryResourceImportTool.ps1` PowerShell 脚本。
- en: The PowerShell script execution will start with check parameters and prerequisites.
  id: totrans-355
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: PowerShell 脚本执行将开始检查参数和先决条件。
- en: It will launch a GUI console similar to the following, depending upon Internet
    access.![Using GRIT for dealing with gallery resource](img/00079.jpeg)
  id: totrans-356
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 它将启动一个 GUI 控制台，具体内容取决于网络连接情况。![使用 GRIT 处理库资源](img/00079.jpeg)
- en: Browse your local computer for gallery resource files or select any online available
    gallery resource to download and import the files.![Using GRIT for dealing with
    gallery resource](img/00080.jpeg)
  id: totrans-357
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 浏览本地计算机以查找库资源文件，或者选择任何在线可用的库资源下载并导入文件。![使用 GRIT 处理库资源](img/00080.jpeg)
- en: Select the **Virtual Disks Configuration** page to set VHD properties.
  id: totrans-358
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**虚拟磁盘配置**页面来设置 VHD 属性。
- en: Choose an operating system version from the drop-down list as applicable.
  id: totrans-359
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从下拉列表中选择适用的操作系统版本。
- en: Choosing the OS version will automatically display the available VHD and its
    status (matching with requirement specified in VM Role packages). Select VHD to
    use this particular gallery items, and hit **Apply These OS Disk Settings to Selected
    Disks(s) and Refresh List** to apply OS disk parameters and **Apply These Data
    Disk Settings to Selected Disks(s) and Refresh List** to apply data disk parameters.
    The refreshing list will display disks configured with status as green, which
    means configured.![Using GRIT for dealing with gallery resource](img/00081.jpeg)
  id: totrans-360
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择操作系统版本后，将自动显示可用的 VHD 及其状态（与 VM 角色包中指定的要求匹配）。选择 VHD 来使用此特定库项，并点击**将这些操作系统磁盘设置应用于选定磁盘并刷新列表**以应用操作系统磁盘参数，点击**将这些数据磁盘设置应用于选定磁盘并刷新列表**以应用数据磁盘参数。刷新后的列表将显示已配置的磁盘，状态为绿色，表示已配置。![使用
    GRIT 处理库资源](img/00081.jpeg)
- en: Select the **Gallery Resource Import** page to import Resource Extension and
    Definition packages in SCVMM and Windows Azure Pack respectively.
  id: totrans-361
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**库资源导入**页面，分别导入 SCVMM 和 Windows Azure Pack 中的资源扩展和定义包。
- en: Choose **VMM Library** **Share** from the drop down list.
  id: totrans-362
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从下拉列表中选择**VMM 库** **共享**。
- en: Select **Import Resource Extension**, **Import Resource Definition**, or both
    as applicable.
  id: totrans-363
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**导入资源扩展**、**导入资源定义**，或根据需要选择两者。
- en: Select **Make Gallery Item Public** if required (this is discussed in detail
    in the next chapter).
  id: totrans-364
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果需要，选择**使库项公开**（此内容将在下一章中详细讨论）。
- en: Clicking on import will import the resource Extension and Definition packages
    in SCVMM and Windows Azure Pack respectively.![Using GRIT for dealing with gallery
    resource](img/00082.jpeg)
  id: totrans-365
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击导入将分别导入 SCVMM 和 Windows Azure Pack 中的资源扩展和定义包。![使用 GRIT 处理库资源](img/00082.jpeg)
- en: The **Bonus tools** page can be used to access additional features such as removing
    extension and definition packages or making any definition package private.![Using
    GRIT for dealing with gallery resource](img/00083.jpeg)
  id: totrans-366
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**附加工具**页面可以用来访问其他功能，例如删除扩展和定义包或将任何定义包设为私有。![使用 GRIT 处理库资源](img/00083.jpeg)'
- en: Developing VM Role gallery resource using VM Role Authoring tool
  id: totrans-367
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 VM 角色创作工具开发 VM 角色库资源
- en: VM Role Authoring tool is published as an open source project on CodePlex. It
    provides an easy-to use-GUI for developing custom gallery resources for Windows
    Azure Pack VM Role.
  id: totrans-368
  prefs: []
  type: TYPE_NORMAL
  zh: VM 角色创作工具作为一个开源项目发布在 CodePlex 上。它提供了一个易于使用的 GUI，用于为 Windows Azure Pack VM 角色开发自定义库资源。
- en: With VM Role Authoring tool, the components of VM Role such as Resource Definition
    package and Resource Extension package can be developed from scratch, and it can
    also be used to modify the available gallery items at Microsoft for environmental
    specific requirements.
  id: totrans-369
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 VM Role Authoring 工具，可以从零开始开发 VM Role 的组件，如资源定义包和资源扩展包，同时也可以用于修改微软提供的现有图库项，以满足特定环境的需求。
- en: 'VM Role Authoring tool can be used for VM Roles developing and modifications
    operations, including:'
  id: totrans-370
  prefs: []
  type: TYPE_NORMAL
  zh: VM Role Authoring 工具可用于 VM Roles 的开发和修改操作，包括：
- en: A Resource Definition package
  id: totrans-371
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个资源定义包
- en: View Definition packages and localized resource files
  id: totrans-372
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 查看定义包和本地化资源文件
- en: Resource Extension packages for Windows and Linux machines
  id: totrans-373
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows 和 Linux 机器的资源扩展包
- en: The mapping of parameters and values of Resource Definition to Resource Extension
  id: totrans-374
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 资源定义到资源扩展的参数和值映射
- en: Getting the VM Role Authoring tool
  id: totrans-375
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 获取 VM Role Authoring 工具
- en: This tool is available on the CodePlex site. The latest, stable version available
    at the point of writing this book was 1.1.
  id: totrans-376
  prefs: []
  type: TYPE_NORMAL
  zh: 此工具可在 CodePlex 网站上获取。写本书时，最新的稳定版本是 1.1。
- en: Any supported Windows system can be used for developing VM Roles using this
    tool.
  id: totrans-377
  prefs: []
  type: TYPE_NORMAL
  zh: 任何支持的 Windows 系统都可以用来使用此工具开发 VM Roles。
- en: You can the download VM Role Authoring tool from [https://vmroleauthor.codeplex.com/](https://vmroleauthor.codeplex.com/).
    Post downloading, the tool can be extracted to any location in the system.
  id: totrans-378
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以从[https://vmroleauthor.codeplex.com/](https://vmroleauthor.codeplex.com/)下载
    VM Role Authoring 工具。下载后，工具可以解压到系统中的任何位置。
- en: Developing sample gallery resource – VM Role
  id: totrans-379
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 开发示例图库资源 – VM Role
- en: VM Roles are written in JSON language. The VM Role Authoring tool adds a basic
    graphic user interface to it. Using VM Role Authoring tool, IT professionals can
    develop custom gallery resources without the knowledge of JSON (it's good to have
    it though).
  id: totrans-380
  prefs: []
  type: TYPE_NORMAL
  zh: VM Role 是用 JSON 语言编写的。VM Role Authoring 工具为其添加了一个基础的图形用户界面。通过使用 VM Role Authoring
    工具，IT 专业人员可以在不掌握 JSON 的情况下开发自定义图库资源（虽然掌握 JSON 会更好）。
- en: 'The VM Role Authoring tool displays each configuration and bindings in two
    ways:'
  id: totrans-381
  prefs: []
  type: TYPE_NORMAL
  zh: VM Role Authoring 工具以两种方式展示每个配置和绑定：
- en: 'Editor View: This provide GUI.'
  id: totrans-382
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 编辑器视图：提供 GUI 界面。
- en: 'JSON View: This is the configuration view in the advanced JSON language. It
    can be modified for any deep custom modifications.'
  id: totrans-383
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: JSON 视图：这是高级 JSON 语言中的配置视图。可以进行深度自定义修改。
- en: Let's create a sample VM Role gallery resource for a Windows machine IaaS VM
    Role to learn more about using VM Role Authoring tool and developing custom VM
    Roles.
  id: totrans-384
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们为 Windows 机器 IaaS VM Role 创建一个示例 VM Role 图库资源，以便了解更多关于使用 VM Role Authoring
    工具以及开发自定义 VM Role 的信息。
- en: 'The following are the steps to create VM Role:'
  id: totrans-385
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是创建 VM Role 的步骤：
- en: Execute `VM Role Authoring Tool.exe`.![Developing sample gallery resource –
    VM Role](img/00084.jpeg)
  id: totrans-386
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 执行`VM Role Authoring Tool.exe`。![开发示例图库资源 – VM Role](img/00084.jpeg)
- en: Provide the package name and directory to store the gallery resources.![Developing
    sample gallery resource – VM Role](img/00085.jpeg)
  id: totrans-387
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供包名称和存储图库资源的目录。![开发示例图库资源 – VM Role](img/00085.jpeg)
- en: Provide gallery resources called **Version** and **Publisher**.
  id: totrans-388
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供名为**版本**和**发布者**的图库资源。
- en: .
  id: totrans-389
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: .
- en: '![Developing sample gallery resource – VM Role](img/00086.jpeg)'
  id: totrans-390
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![开发示例图库资源 – VM Role](img/00086.jpeg)'
- en: '**Resource Requirements** contains parameters that are required to be set on
    virtual hard disks to be used for provisioning of this VM Role. Enter parameters
    such as Tags.![Developing sample gallery resource – VM Role](img/00087.jpeg)'
  id: totrans-391
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**资源需求**包含了在虚拟硬盘上设置的必要参数，这些硬盘将用于此 VM Role 的配置。输入如标签等参数。![开发示例图库资源 – VM Role](img/00087.jpeg)'
- en: Expand **Application Profile (Windows)** and select **Roles & Features**. This
    option can be used to enable Windows Roles and features in VM Role post deployment
    in an automated fashion. Select the compatible OS and required Roles and features.![Developing
    sample gallery resource – VM Role](img/00088.jpeg)
  id: totrans-392
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 展开**应用程序配置文件（Windows）**并选择**角色和功能**。此选项可用于在自动化过程中启用 VM Role 部署后的 Windows 角色和功能。选择兼容的操作系统以及所需的角色和功能。![开发示例图库资源
    – VM Role](img/00088.jpeg)
- en: 'Click on **Add** and select **Web Application** / **SQL DAC Application** /
    **Script Application** or anything else, as applicable for automated application
    installation. This feature enables cloud providers to deliver more than IaaS:
    automated web, applications, and database provisioning at the top of Vanilla IaaS
    services.![Developing sample gallery resource – VM Role](img/00089.jpeg)'
  id: totrans-393
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **Add** 并选择 **Web Application** / **SQL DAC Application** / **Script Application**
    或其他适用的选项，以便进行自动化应用程序安装。此功能使云服务提供商能够提供超越 IaaS 的服务：在 Vanilla IaaS 服务之上进行自动化的 Web、应用程序和数据库配置。![开发示例画廊资源
    – VM 角色](img/00089.jpeg)
- en: Select **File** and select the new **Resource Definition** file. Provide the
    Resource Definition file name and location. Add **Version** and **Publisher**
    properties.![Developing sample gallery resource – VM Role](img/00090.jpeg)
  id: totrans-394
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择 **File** 并选择新的 **Resource Definition** 文件。提供资源定义文件的名称和位置。添加 **Version** 和
    **Publisher** 属性。![开发示例画廊资源 – VM 角色](img/00090.jpeg)
- en: In the **Extension Reference** page, binding or mapping between Resource Definition
    and Resource Extension parameters is performed. Select the available Resource
    Extension package. It will populate **Name** and **Publisher** details and more
    automatically.![Developing sample gallery resource – VM Role](img/00091.jpeg)
  id: totrans-395
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 **Extension Reference** 页面中，执行资源定义和资源扩展参数之间的绑定或映射。选择可用的资源扩展包。它将自动填充 **Name**
    和 **Publisher** 等详细信息。![开发示例画廊资源 – VM 角色](img/00091.jpeg)
- en: In the **Parameters** tab, add values to be provided by tenant users in self-service
    form.![Developing sample gallery resource – VM Role](img/00092.jpeg)
  id: totrans-396
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 **Parameters** 选项卡中，添加由租户用户在自助服务表单中提供的值。![开发示例画廊资源 – VM 角色](img/00092.jpeg)
- en: The **Scale Out** configuration adds easy (by just moving a slider) scale in
    and scale out features for this VM Role. Minimum, initial, and maximum instance
    counts can be provided.![Developing sample gallery resource – VM Role](img/00093.jpeg)
  id: totrans-397
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**Scale Out** 配置为此虚拟机角色添加了简单的（只需移动滑块）扩展和缩减功能。可以提供最小、初始和最大实例数量。![开发示例画廊资源 –
    VM 角色](img/00093.jpeg)'
- en: '**Hardware Profile** provides options to tenant users with respect to the size
    of VM in terms of compute (CPU and memory). **Param.VMRoleVMSize** provides standard
    Azure size available to tenant users, such as extra small, small, and so on.![Developing
    sample gallery resource – VM Role](img/00094.jpeg)'
  id: totrans-398
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**Hardware Profile** 提供与虚拟机大小相关的选项，包括计算（CPU 和内存）。**Param.VMRoleVMSize** 提供可供租户用户选择的标准
    Azure 大小，如 Extra Small、Small 等。![开发示例画廊资源 – VM 角色](img/00094.jpeg)'
- en: In **Storage Profile**, cloud administrators can add additional VDHXs to VM
    Role such as data disks and DB disks as applicable. Parameters such as tags and
    others need to be defined for each disk added in VM Role.![Developing sample gallery
    resource – VM Role](img/00095.jpeg)
  id: totrans-399
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 **Storage Profile** 中，云管理员可以为虚拟机角色添加额外的 VDHX，例如数据磁盘和数据库磁盘等。需要为每个添加到虚拟机角色中的磁盘定义标签等参数。![开发示例画廊资源
    – VM 角色](img/00095.jpeg)
- en: '**Network Profile** provides options to configure networking options for a
    VM Role such as NIC connectivity, load balancers, and more. Additional network
    adaptors can be used using the **Add** button.![Developing sample gallery resource
    – VM Role](img/00096.jpeg)'
  id: totrans-400
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**Network Profile** 提供用于配置虚拟机角色网络选项的功能，如 NIC 连接、负载均衡器等。可以使用 **Add** 按钮添加更多网络适配器。![开发示例画廊资源
    – VM 角色](img/00096.jpeg)'
- en: '**Operating System Profile** provides OS options to configure such as local
    administrator password, machine to join domain, or workgroup. Tenant specific
    settings can be entered by user in a self-service wizard. Map values to the self-service
    wizard using generate new parameter in the drop-down list.![Developing sample
    gallery resource – VM Role](img/00097.jpeg)'
  id: totrans-401
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**Operating System Profile** 提供配置操作系统选项，例如本地管理员密码、计算机加入域或工作组。租户特定的设置可以通过自助服务向导由用户输入。使用下拉列表中的生成新参数将值映射到自助服务向导。![开发示例画廊资源
    – VM 角色](img/00097.jpeg)'
- en: In the **ViewDefinition** section, graphical icons such as **Label**, **PublisherLabel**,
    and **Description** that are available to tenant users in the gallery catalogue
    can be added.![Developing sample gallery resource – VM Role](img/00098.jpeg)
  id: totrans-402
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 **ViewDefinition** 部分，可以添加租户用户在画廊目录中可以看到的图形图标，如 **Label**、**PublisherLabel**
    和 **Description**。![开发示例画廊资源 – VM 角色](img/00098.jpeg)
- en: Click on **Validate** to verify all configurations and mapping.
  id: totrans-403
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **Validate** 以验证所有配置和映射。
- en: Click on **Save** to save packages and other components.
  id: totrans-404
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **Save** 保存包和其他组件。
- en: These packages can now be imported to Windows Azure Pack and SCVMM respectively.
    See the previous topic to see how to import gallery resources.
  id: totrans-405
  prefs: []
  type: TYPE_NORMAL
  zh: 这些包现在可以分别导入到 Windows Azure Pack 和 SCVMM 中。请参阅前面的主题，了解如何导入库资源。
- en: With VM Role Authoring tool, JSON language scripting capabilities, and **Service
    Management Automation** (**SMA**), service providers may configure XaaS (anything
    as a service) cloud service offerings.
  id: totrans-406
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 VM 角色创作工具、JSON 脚本语言能力和 **服务管理自动化** (**SMA**)，服务提供商可以配置 XaaS（任何服务作为一种服务）云服务。
- en: The virtual machine Role example kit
  id: totrans-407
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 虚拟机角色示例工具包
- en: Microsoft provides a virtual machine Role example kit, which can be used as
    a reference for developing custom VM Role using VM Role Authoring tool.
  id: totrans-408
  prefs: []
  type: TYPE_NORMAL
  zh: 微软提供了一个虚拟机角色示例工具包，可以作为使用虚拟机角色创作工具开发自定义虚拟机角色的参考。
- en: The example kit contains example configurations of Resource Extension packages,
    Resource Definition packages, payload, custom scripts, and a lot more. This can
    help cloud providers in developing customer VM Role gallery resources.
  id: totrans-409
  prefs: []
  type: TYPE_NORMAL
  zh: 示例工具包包含了资源扩展包、资源定义包、有效载荷、自定义脚本等的示例配置。这有助于云服务提供商开发客户虚拟机角色库资源。
- en: The virtual machine Role example kit can be downloaded from [http://blogs.technet.com/b/privatecloud/archive/2013/12/11/virtual-machine-Role-example-kit.aspx](http://blogs.technet.com/b/privatecloud/archive/2013/12/11/virtual-machine-Role-example-kit.aspx).
  id: totrans-410
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟机角色示例工具包可以从[http://blogs.technet.com/b/privatecloud/archive/2013/12/11/virtual-machine-Role-example-kit.aspx](http://blogs.technet.com/b/privatecloud/archive/2013/12/11/virtual-machine-Role-example-kit.aspx)下载。
- en: Accessing tenant virtual machines – Windows Azure Pack Console Connect
  id: totrans-411
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 访问租户虚拟机 – Windows Azure Pack Console Connect
- en: 'Windows Azure Pack provides two ways of connecting to virtual machine for tenants:'
  id: totrans-412
  prefs: []
  type: TYPE_NORMAL
  zh: Windows Azure Pack 为租户提供了两种连接虚拟机的方式：
- en: Remote desktop connection
  id: totrans-413
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 远程桌面连接
- en: Windows Azure Pack Console Connect
  id: totrans-414
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows Azure Pack Console Connect
- en: Remote desktop connection in a Windows Azure Pack Cloud works in the traditional
    RDP mechanism, requiring network connectivity to VM guest OS, RDP to be enabled,
    firewall rules to allow RDP communications, and lots more. If machines need to
    be accessed on Internet (service provider cloud scenarios), public IP would also
    be required.
  id: totrans-415
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Windows Azure Pack Cloud 中的远程桌面连接使用传统的 RDP 机制，需要网络连接到虚拟机的客户操作系统、启用 RDP、允许
    RDP 通信的防火墙规则等。如果机器需要通过互联网访问（服务提供商云场景），还需要公有 IP。
- en: The other option, Windows Azure Pack Console Connect, solves the challenges
    of RDP method. It provides access to VM guest OS through Hypervisor host using
    remote desktop gateways. Console Connect does not require any network reachability
    to the guest OS.
  id: totrans-416
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个选项是 Windows Azure Pack Console Connect，它解决了 RDP 方法的挑战。它通过 Hypervisor 主机使用远程桌面网关提供对虚拟机客户操作系统的访问。Console
    Connect 不需要与客户操作系统的网络连接。
- en: The Console Connect gives access to tenant users of their VM in similar way
    as of VM connect for Hyper-V manager over SSL using remote desktop gateway.
  id: totrans-417
  prefs: []
  type: TYPE_NORMAL
  zh: Console Connect 使租户用户能够像通过远程桌面网关使用 SSL 访问 Hyper-V 管理器上的虚拟机连接一样访问其虚拟机。
- en: Console Connect doesn't have any dependency on the state of the operating system
    inside virtual machine (powered off, crashed, or something else). Since Console
    Connect works in a different way from RDP, few RDP features such as clipboard
    redirection, drives mapping, sound and printer redirection, and more aren't available.
  id: totrans-418
  prefs: []
  type: TYPE_NORMAL
  zh: Console Connect 不依赖于虚拟机内操作系统的状态（无论是关闭、电源故障，还是其他）。由于 Console Connect 的工作方式与 RDP
    不同，因此一些 RDP 功能，如剪贴板重定向、驱动器映射、声音和打印机重定向等，无法使用。
- en: Windows Azure Pack Console Connect architecture
  id: totrans-419
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Windows Azure Pack Console Connect 架构
- en: Windows Azure Pack Console Connect leverages the Remote Desktop Gateway services
    of Windows Server 2012 R2 for establishing Console Connect to VM via an underlying
    hypervisor on SSL.
  id: totrans-420
  prefs: []
  type: TYPE_NORMAL
  zh: Windows Azure Pack Console Connect 利用 Windows Server 2012 R2 的远程桌面网关服务，通过底层的虚拟化管理程序基于
    SSL 与虚拟机建立 Console Connect 连接。
- en: Console Connect doesn't use any guest OS (inside VM) level authentication. It
    works upon SSL certificate token claim-based authentication. This requires Windows
    Azure Pack, SPF, remote desktop gateway server, VMM, and Hyper-V hosts to trust
    each other.
  id: totrans-421
  prefs: []
  type: TYPE_NORMAL
  zh: Console Connect 不使用任何虚拟机内部操作系统的身份验证。它基于 SSL 证书令牌声明身份验证工作。这要求 Windows Azure Pack、SPF、远程桌面网关服务器、VMM
    和 Hyper-V 主机彼此信任。
- en: Windows Azure Pack along with the remote desktop gateway, SPF, and SCVMM authenticates
    users and authorizes access to virtual machine and generate token assigned to
    tenants for accessing this particular VM. This token is used by Hyper-V host to
    ensure that tenant users get access to only authorized virtual machine.
  id: totrans-422
  prefs: []
  type: TYPE_NORMAL
  zh: Windows Azure Pack 结合远程桌面网关、SPF 和 SCVMM 对用户进行身份验证并授权访问虚拟机，并生成分配给租户的令牌，以便访问该虚拟机。Hyper-V
    主机使用该令牌确保租户用户只能访问授权的虚拟机。
- en: This process isn't visible to tenant users. When a tenant user connects to any
    VM using Console Connect on the Azure Pack portal, it downloads a RDM file containing
    all required connectivity details. Running this RDP file connects user to the
    VM's console.
  id: totrans-423
  prefs: []
  type: TYPE_NORMAL
  zh: 该过程对租户用户不可见。当租户用户通过 Azure Pack 门户使用 Console Connect 连接到任何虚拟机时，它会下载一个包含所有必要连接信息的
    RDM 文件。运行此 RDP 文件将用户连接到虚拟机的控制台。
- en: '![Windows Azure Pack Console Connect architecture](img/00099.jpeg)'
  id: totrans-424
  prefs: []
  type: TYPE_IMG
  zh: '![Windows Azure Pack Console Connect 架构](img/00099.jpeg)'
- en: 'Diagram Source: TechNet'
  id: totrans-425
  prefs: []
  type: TYPE_NORMAL
  zh: 图示来源：TechNet
- en: Note
  id: totrans-426
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: All servers participating in the Console Connect architecture must run Windows
    Server 2012 R2.
  id: totrans-427
  prefs: []
  type: TYPE_NORMAL
  zh: 所有参与 Console Connect 架构的服务器必须运行 Windows Server 2012 R2。
- en: Minimum RDP version for Console Connect at the client end is 8.1.
  id: totrans-428
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端端的 Console Connect 最低 RDP 版本为 8.1。
- en: Preparing certificates for Console Connect deployment
  id: totrans-429
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备 Console Connect 部署所需的证书
- en: A trust relationship needs to be configured between remote the Desktop Gateway
    Server, SPF, SCVMM, and Hyper-V hosts to support claim token-based authentication.
    Single or multiple SSL certificates can be used to establish this trust relationship.
  id: totrans-430
  prefs: []
  type: TYPE_NORMAL
  zh: 需要在远程桌面网关服务器、SPF、SCVMM 和 Hyper-V 主机之间配置信任关系，以支持基于声明令牌的身份验证。可以使用单个或多个 SSL 证书来建立此信任关系。
- en: 'The SSL certificate used for Console Connect must meet the following requirements:'
  id: totrans-431
  prefs: []
  type: TYPE_NORMAL
  zh: 用于 Console Connect 的 SSL 证书必须满足以下要求：
- en: The certificate must be valid, which is not expired
  id: totrans-432
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 证书必须有效，即未过期。
- en: The key usage field must contain a digital signature
  id: totrans-433
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 密钥使用字段必须包含数字签名。
- en: 'The enhanced key usage field must contain the following client authentication
    object identifier: (1.3.6.1.5.5.7.3.2)'
  id: totrans-434
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 扩展密钥使用字段必须包含以下客户端身份验证对象标识符：（1.3.6.1.5.5.7.3.2）
- en: Root certificates for the **certification authority** (**CA**) that issued the
    certificate must be installed in the Trusted Root Certification Authorities certificate
    store
  id: totrans-435
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发行证书的**认证机构**（**CA**）的根证书必须安装在受信任的根证书颁发机构证书存储区中。
- en: The cryptographic service provider for the certificate must support SHA256
  id: totrans-436
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 证书的加密服务提供商必须支持 SHA256。
- en: SSL certificates can be self-signed as well as issued from any internal enterprise
    or public certificate authority. It is recommended to use CA provided SSL for
    better management and easy renewals.
  id: totrans-437
  prefs: []
  type: TYPE_NORMAL
  zh: SSL 证书可以是自签名的，也可以是由任何内部企业或公共证书颁发机构颁发的。建议使用 CA 提供的 SSL 证书，以便更好地管理和轻松续订。
- en: Deploying Console Connect
  id: totrans-438
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 部署 Console Connect
- en: Deploying Windows Azure Pack Console Connect requires multiple operations to
    be performed, such as importing the Console Connect certificate, configuring RDS
    Gateway, and adding RDS Gateway in Windows Azure Pack.
  id: totrans-439
  prefs: []
  type: TYPE_NORMAL
  zh: 部署 Windows Azure Pack Console Connect 需要执行多个操作，例如导入 Console Connect 证书、配置 RDS
    网关以及在 Windows Azure Pack 中添加 RDS 网关。
- en: Importing trusted certificates (Console Connect) to management servers
  id: totrans-440
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 将受信任的证书（Console Connect）导入到管理服务器
- en: 'Instead of importing a Console Connect certificate to each Hyper-V hosts individually,
    it can first be imported in the VMM database, and then be distributed to Hyper-V
    hosts. For this, the following steps are carried out:'
  id: totrans-441
  prefs: []
  type: TYPE_NORMAL
  zh: 可以先将 Console Connect 证书导入到 VMM 数据库中，而不是将其逐个导入到每台 Hyper-V 主机中，然后再将其分发到 Hyper-V
    主机。为此，需要执行以下步骤：
- en: Execute VMM PowerShell on as an administrator.
  id: totrans-442
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以管理员身份执行 VMM PowerShell。
- en: Connect to the SCVMM server using the `Set-SCVMMServer` PowerShell cmdlet.
  id: totrans-443
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `Set-SCVMMServer` PowerShell cmdlet 连接到 SCVMM 服务器。
- en: 'Use the following script to import the certificate in the VMM DB. Update highlighted
    values as per environmental specific details:'
  id: totrans-444
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下脚本将证书导入到 VMM 数据库中。根据环境的具体细节更新高亮显示的值：
- en: '[PRE8]'
  id: totrans-445
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Wait for all Hyper-V hosts to refresh in SCVMM, or manual refresh it by logging
    into the VMM management console.
  id: totrans-446
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 等待所有 Hyper-V 主机在 SCVMM 中刷新，或通过登录 VMM 管理控制台手动刷新。
- en: 'If you use a self-signed certificate, import the public key of the certificate
    to the trusted root certification authorities certificate store for the Hyper-V
    hosts. Restart the Hyper-V management service post import:'
  id: totrans-447
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果使用自签名证书，请将证书的公钥导入到 Hyper-V 主机的受信任根证书颁发机构存储区。导入后，重新启动 Hyper-V 管理服务：
- en: '[PRE9]'
  id: totrans-448
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Import a certificate to the SPF server; here, PowerShell can be used:'
  id: totrans-449
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向SPF服务器导入证书；在此可以使用PowerShell：
- en: '[PRE10]'
  id: totrans-450
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Configure the service provider foundation to use this certificate to create
    claim tokens using the following PowerShell cmdlet. Replace thumbprint values
    as applicable:'
  id: totrans-451
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置服务提供商基础架构以使用此证书创建声明令牌，可以使用以下PowerShell命令。根据需要替换指纹值：
- en: '[PRE11]'
  id: totrans-452
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Define token lifetime in minutes from 1 to 60\. Thumbprint value of SSL certificate
    can be found using the following PowerShell cmdlet:'
  id: totrans-453
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义令牌的生命周期，范围从1到60分钟。SSL证书的指纹值可以通过以下PowerShell命令找到：
- en: '[PRE12]'
  id: totrans-454
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Setting up Remote Desktop Services Gateway
  id: totrans-455
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 设置远程桌面服务网关
- en: 'To set up Remote Desktop Services Gateway, the following steps are carried
    out:'
  id: totrans-456
  prefs: []
  type: TYPE_NORMAL
  zh: 设置远程桌面服务网关时，需要执行以下步骤：
- en: Log into the VM designated for RDS Gateway Role.
  id: totrans-457
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到指定的RDS网关角色虚拟机。
- en: Install the Remote Desktop Gateway component using **Add Roles and Features**
    in Server Manager.
  id: totrans-458
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用**添加角色和功能**在服务器管理器中安装远程桌面网关组件。
- en: Install the Microsoft System Center Virtual Machine Manager Console Connect
    Gateway component on the Remote Desktop Gateway server. The MSI installer for
    SCVMM Console Connect Gateway can be found in the SCVMM installation media location
    `CDLayout.EVAL\amd64\Setup\msi\RDGatewayFedAuth`.
  id: totrans-459
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在远程桌面网关服务器上安装Microsoft System Center虚拟机管理器控制台连接网关组件。SCVMM控制台连接网关的MSI安装程序可以在SCVMM安装媒体位置`CDLayout.EVAL\amd64\Setup\msi\RDGatewayFedAuth`找到。
- en: 'Import the public key of the certificate into the personal certificate store:'
  id: totrans-460
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将证书的公钥导入到个人证书存储中：
- en: '[PRE13]'
  id: totrans-461
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Configure the RDS Gateway server to accept tokens using Console Connect SSL
    and hash algorithms.
  id: totrans-462
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置RDS网关服务器以使用Console Connect SSL和哈希算法接受令牌。
- en: 'This is configured using the `TrustedIssuerCertificateHashes` and `AllowedHashAlgorithms`
    properties in the **Windows Management Instrumentation** (**WMI**) `FedAuthSettings`
    class. Use the following PowerShell to configure the RDS Gateway server:'
  id: totrans-463
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 通过**Windows管理工具**（**WMI**）`FedAuthSettings`类中的`TrustedIssuerCertificateHashes`和`AllowedHashAlgorithms`属性来配置此项。使用以下PowerShell命令配置RDS网关服务器：
- en: 'Replace the server as thumbprint values with environment-specific values:'
  id: totrans-464
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 将服务器的指纹值替换为特定环境的值：
- en: '[PRE14]'
  id: totrans-465
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Configure the SSL certificate for RDS Gateway server. This certificate will
    be used to identify RDS server by clients. Use the RDS Gateway manager to create
    a self-signed SSL or use the existing trusted SSL.
  id: totrans-466
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置RDS网关服务器的SSL证书。该证书将用于客户端识别RDS服务器。使用RDS网关管理器创建自签名SSL证书，或使用现有的受信SSL证书。
- en: Verify the configuration at SCVMM, Hyper-V hosts, SPF, and RDS Gateway server.
  id: totrans-467
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 验证SCVMM、Hyper-V主机、SPF和RDS网关服务器的配置。
- en: Registering RDS Gateway server in Windows Azure Pack
  id: totrans-468
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在Windows Azure Pack中注册RDS网关服务器
- en: Windows Azure Pack provides the option to register Remote Desktop Gateway server
    while registering the SCVMM stamp. The RDS Gateway server must be registered with
    mapping to the VMM server to function.
  id: totrans-469
  prefs: []
  type: TYPE_NORMAL
  zh: Windows Azure Pack提供在注册SCVMM戳记时注册远程桌面网关服务器的选项。RDS网关服务器必须与VMM服务器进行映射注册才能正常工作。
- en: Any existing registered SCVMM connection can also be modified to add RDS Gateway
    at a later stage.
  id: totrans-470
  prefs: []
  type: TYPE_NORMAL
  zh: 任何现有的注册SCVMM连接也可以在后期修改，以便添加RDS网关。
- en: 'Let''s see the following steps for registering RDS Gateway:'
  id: totrans-471
  prefs: []
  type: TYPE_NORMAL
  zh: 请查看以下注册RDS网关的步骤：
- en: Log into the Windows Azure Pack management portal and browse to the VM Clouds.
  id: totrans-472
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到Windows Azure Pack管理门户并浏览虚拟机云。
- en: Select an existing SCVMM registration and click on **Edit**.
  id: totrans-473
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择一个现有的SCVMM注册，并点击**编辑**。
- en: Provide RDS Gateway FQDN and click on **Finish** to complete the configuration.![Registering
    RDS Gateway server in Windows Azure Pack](img/00100.jpeg)
  id: totrans-474
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供RDS网关的FQDN，点击**完成**以完成配置。![在Windows Azure Pack中注册RDS网关服务器](img/00100.jpeg)
- en: Securing the Console Connect deployment
  id: totrans-475
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 确保Console Connect部署的安全性
- en: 'Windows Azure Pack Console Connect uses SSL token-based claim authentication.
    It is recommended to consider the following security recommendations while deploying
    the Console Connect environment:'
  id: totrans-476
  prefs: []
  type: TYPE_NORMAL
  zh: Windows Azure Pack Console Connect使用基于SSL令牌的声明认证。建议在部署Console Connect环境时考虑以下安全建议：
- en: 'Token Lifetime: RDP File downloaded by the tenant user for accessing VM console
    contains the `EndpointFedAuth` token to verify user''s authenticity. It is recommended
    to configure token lifetime to small values such as 1 or 2 minutes to eliminate
    the security risk of losing or leaking this file.'
  id: totrans-477
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 令牌生命周期：租户用户下载的RDP文件用于访问虚拟机控制台，包含`EndpointFedAuth`令牌以验证用户的真实性。建议将令牌生命周期配置为较小的值，如1或2分钟，以消除丢失或泄露该文件的安全风险。
- en: Configure strong firewall and security policies on the RDS Gateway server to
    protect it from malicious users or attacks. For example, it's a good idea to block
    the RDP (3389) port.
  id: totrans-478
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在 RDS Gateway 服务器上配置强大的防火墙和安全策略，以保护其免受恶意用户或攻击。例如，最好阻止 RDP（3389）端口。
- en: Access to the certificate store on the SCVMM server generating token should
    be restricted.
  id: totrans-479
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 应限制访问生成令牌的 SCVMM 服务器上的证书存储。
- en: It is recommend to use a CA-provided certificate with a valid chain for the
    Hyper-V host. This will prevent the RDP connection warning related to the identification
    of the computer's identity.
  id: totrans-480
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 建议为 Hyper-V 主机使用由 CA 提供的有效链证书。这将防止与计算机身份识别相关的 RDP 连接警告。
- en: The RDP file downloaded by tenant user contains hostname/network details of
    Hyper-V server hosting that machine. This allows tenant users to see hypervisor
    host network details. It is recommended to secure Hyper-V hosts and prevent Internet
    access to avoid the misuse of these details.
  id: totrans-481
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 租户用户下载的 RDP 文件包含托管该虚拟机的 Hyper-V 服务器的主机名/网络详细信息。这使得租户用户可以看到虚拟化主机的网络信息。建议对 Hyper-V
    主机进行安全保护，避免互联网访问，以防止这些信息被滥用。
- en: Summary
  id: totrans-482
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: With this chapter, we are ready with a Windows Azure Pack-based cloud solution
    having IaaS services ready for tenants. You learned about Windows Azure Pack VM
    Clouds architecture and steps for building SCVMM cloud for Windows Azure Pack.
    You learned about building IaaS offerings, also known as catalogues, for Windows
    and Linux operating systems. We also covered creating custom offerings using the
    VM Role authoring tool as well as using GRIT for easy import of gallery resources
    in Windows Azure Pack and SCVMM.
  id: totrans-483
  prefs: []
  type: TYPE_NORMAL
  zh: 本章结束时，我们已经准备好了基于 Windows Azure Pack 的云解决方案，提供 IaaS 服务供租户使用。你学习了 Windows Azure
    Pack VM Clouds 的架构以及为 Windows Azure Pack 构建 SCVMM 云的步骤。你了解了为 Windows 和 Linux 操作系统构建
    IaaS 服务（也称为目录）。我们还讨论了使用 VM Role 作者工具创建自定义服务，以及使用 GRIT 轻松导入 Windows Azure Pack
    和 SCVMM 中的画廊资源。
- en: Accessing virtual machines using RDP and Console Connect along with Console
    Connect architecture and deployment was also covered.
  id: totrans-484
  prefs: []
  type: TYPE_NORMAL
  zh: 还讨论了如何使用 RDP 和 Console Connect 访问虚拟机，并介绍了 Console Connect 架构和部署。
- en: In the next chapter, we will be assigning these services to tenants using Windows
    Azure Pack plans and subscriptions.
  id: totrans-485
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章，我们将通过使用 Windows Azure Pack 计划和订阅，将这些服务分配给租户。
