- en: Access Control Using AWS IAM and AWS Organizations
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 AWS IAM 和 AWS Organizations 进行访问控制
- en: In the previous chapter, we learnt and explored about how you can leverage two
    AWS services, namely AWS Config and AWS CloudTrail, to govern your Cloud environments.
    In this chapter, we will be continuing on the security journey by revisiting AWS
    IAM along with a few useful features as well as learning a bit about yet another
    service in the form of AWS Organizations!
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们学习并探索了如何利用两个 AWS 服务——AWS Config 和 AWS CloudTrail 来管理你的云环境。在本章中，我们将继续安全之旅，重新审视
    AWS IAM 并介绍一些实用功能，同时还会学习另一个服务——AWS Organizations！
- en: 'Keeping this in mind, let us have a quick look at the various topics that we
    will be covering in this chapter:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 牢记这一点，让我们快速看一下本章将要涵盖的各个主题：
- en: What's new with AWS IAM
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: AWS IAM 的新功能
- en: Creating policies using the IAM visual editor
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 IAM 可视化编辑器创建策略
- en: Testing your IAM policies using the IAM Policy Simulator
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 IAM 策略模拟器测试你的 IAM 策略
- en: Introducing AWS Organizations with a few essential concepts and terminologies
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 介绍 AWS Organizations 及其一些基本概念和术语
- en: Creating your own organizations using the AWS Management Console as well as
    the AWS CLI
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 AWS 管理控制台和 AWS CLI 创建你自己的组织
- en: What's new with AWS IAM
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: AWS IAM 的新功能
- en: Before we look at some of the recent enhancements made to IAM, here is a quick
    crash course on IAM for the uninitiated. AWS Identity and Access Management or
    IAM is a web service that provides secured access control mechanisms for all AWS
    services. You can use IAM to create users and groups, assigning users specific
    permissions and policies, and a lot more. The best part of all this is that IAM
    is completely FREE. Yup! Not a penny is required to use it.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们查看 IAM 最近的增强功能之前，这里为没有接触过的朋友提供一个 IAM 的简短速成课程。AWS 身份与访问管理（IAM）是一个提供安全访问控制机制的
    Web 服务，适用于所有 AWS 服务。你可以使用 IAM 创建用户和组，分配用户特定的权限和策略等等。最棒的是，IAM 完全免费！没错！使用它不需要支付一分钱。
- en: 'Let''s quickly look at some interesting features provided by AWS IAM:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们快速浏览一些 AWS IAM 提供的有趣功能：
- en: '**Multi-factor authentication**: IAM allows you to provide two-factor authentications
    to users for added security. This means that now, along with your password, you
    will also have to provide a secret key/pin from a special hardware device, such
    as a hard token, or even from software apps such as Google Authenticator.'
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**多因素身份验证**：IAM 允许你为用户提供双因素身份验证以增强安全性。这意味着，除了密码外，你还需要提供来自特殊硬件设备（如硬件令牌）或软件应用程序（如
    Google Authenticator）的密钥/密码。'
- en: '**Integration with other AWS products**: IAM integrates with almost all AWS
    products and services and can be used to provide granular access rights and permissions
    to each service as required.'
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**与其他 AWS 产品的集成**：IAM 与几乎所有 AWS 产品和服务集成，并且可以根据需要为每个服务提供细粒度的访问权限和权限。'
- en: '**Identity federation**: Do you have an on-premise Active Directory already
    that has users and groups created? Not a problem, as IAM can be integrated with
    an on-premise AD to provide access to your AWS account using a few simple steps.'
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**身份联合**：你是否已经有一个本地 Active Directory，其中包含已创建的用户和组？没问题，IAM 可以与本地 AD 集成，通过一些简单步骤提供访问你的
    AWS 账户的权限。'
- en: '**Access mechanisms**: IAM can be accessed using a variety of different tools,
    the most common and frequently used being the AWS Management Console. Apart from
    this, IAM can also be accessed via the AWS CLI, via SDKs that support different
    platforms and programming languages such as Java, .NET, Python, Ruby, and so on,
    and programmatically via a secured HTTPS API as well.'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**访问机制**：IAM 可以通过多种工具访问，最常用且最频繁使用的是 AWS 管理控制台。除此之外，IAM 还可以通过 AWS CLI 访问，通过支持不同平台和编程语言的
    SDK（如 Java、.NET、Python、Ruby 等）访问，甚至可以通过一个安全的 HTTPS API 进行编程访问。'
- en: With the basics in mind, let us now look at some interesting and useful enhancements
    made to IAM in recent years.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 牢记这些基础知识后，让我们来看看近年来对 IAM 进行的一些有趣和有用的增强功能。
- en: Using the visual editor to create IAM policies
  id: totrans-16
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用可视化编辑器创建 IAM 策略
- en: 'IAM policies are used to define permissions for your IAM entities such as users,
    groups, and roles. Each policy that you create consists of one or more statements
    that include the following elements:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: IAM 策略用于定义 IAM 实体（如用户、组和角色）的权限。你创建的每个策略由一个或多个语句组成，这些语句包含以下元素：
- en: '**Effect**: This element determines whether a policy statement allows or explicitly
    denies access to a particular IAM resource.'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**效果**：此元素决定策略语句是否允许或明确拒绝对特定 IAM 资源的访问。'
- en: '**Action**: Actions are used to define AWS service actions within a policy,
    for example; you can specify Amazon S3 related actions such as list buckets, read
    or write to buckets, and so on.'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**操作**：操作用于在策略中定义AWS服务操作，例如，您可以指定与Amazon S3相关的操作，如列出存储桶、读取或写入存储桶等。'
- en: '**Resource**: Resources are the AWS services or individual entities to which
    the actions apply.'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**资源**：资源是指AWS服务或单个实体，操作将在其上应用。'
- en: '**Condition**: Conditions are used to define when a particular permission is
    allowed or denied on a resource. You can leverage one or more conditions to provide
    additional granular security to your AWS resources.'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**条件**：条件用于定义在某个资源上何时允许或拒绝特定权限。您可以利用一个或多个条件来为AWS资源提供更细粒度的安全性。'
- en: 'Once a policy is created, you essentially attach it to your resource which
    can be an IAM user, group or even a role. However, creating custom and granular
    IAM policies can prove to be a challenge at times especially if you are just getting
    started with AWS. To address this, AWS has provided a new and improved visual
    editor using which you can easily create customized policies on your own:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 创建策略后，您需要将其附加到资源上，资源可以是IAM用户、组或角色。然而，创建自定义且细粒度的IAM策略有时会带来挑战，尤其是当您刚开始使用AWS时。为了解决这个问题，AWS提供了一个新的改进版可视化编辑器，您可以轻松地使用它创建自定义策略：
- en: To get started with the visual editor, first log in to the IAM Management Console
    by selecting this URL [https://console.aws.amazon.com/iam/home](https://console.aws.amazon.com/iam/home).
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要开始使用可视化编辑器，首先登录到IAM管理控制台，选择此URL [https://console.aws.amazon.com/iam/home](https://console.aws.amazon.com/iam/home)。
- en: Once logged in, select the Policies option from the navigation pane. This will
    display a page that lists both the AWS Managed as well as the Customer Managed policies.
    To create a policy, simply select the Create policy option. For this scenario,
    let us create a simple S3 policy that grants full access to only a single folder
    present within an S3 bucket.
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录后，从导航窗格中选择“策略”选项。这将显示一个页面，列出AWS托管策略和客户托管策略。要创建策略，只需选择“创建策略”选项。在这个场景中，我们将创建一个简单的S3策略，仅授予对S3存储桶内单个文件夹的完全访问权限。
- en: On the Create policy page, ensure that the Visual editor tab is selected and
    click on the Choose a service option to filter and pick out Amazon S3.
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在“创建策略”页面上，确保选择了“可视化编辑器”标签，然后点击“选择服务”选项以筛选并选择Amazon S3。
- en: 'With the Service selected, next click on the Select actions options to add
    the appropriate actions for our policy. Here, you can select the appropriate Access
    levels for your resource by either opting to add the actions *manually* or even
    provide individual permissions by selecting the correct access rights from each
    individual Access levels. In this case, I have opted to select the entire List level
    for permissions and the `s3:GetObject` from the Read access level followed by
    the `s3:PutObject`, and the `s3:DeleteObject` permissions from the Write access
    level. Following is screenshot of the Actions selected for your reference:'
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择服务后，接下来点击“选择操作”选项，添加适合我们策略的操作。在这里，您可以通过选择手动添加操作或通过选择每个访问级别中的正确访问权限，选择资源的适当访问级别。在此示例中，我选择了权限的整个列表级别，并从读取访问级别中选择了`s3:GetObject`，随后又从写入访问级别中选择了`s3:PutObject`和`s3:DeleteObject`权限。以下是您参考的操作截图：
- en: '![](img/dee5eded-e465-466d-9aef-fe4f83254c4e.png)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
  zh: '![](img/dee5eded-e465-466d-9aef-fe4f83254c4e.png)'
- en: By default, all actions selected here will be allowed. To deny actions explicitly,
    select the Switch to deny permissions option provided in the Actions section.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，这里选定的所有操作都将被允许。如果要明确拒绝某些操作，请选择“切换到拒绝权限”选项，该选项位于“操作”部分。
- en: Once completed, you can now select the Resources section to add either all or
    specific resources to your new set of permissions. In this case, we will add the
    set of permissions to a specific bucket called **useast-prod-stuff-01**. To do
    so, select the Add ARN option adjoining to the bucket field.
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成后，您可以选择“资源”部分，将所有或特定的资源添加到新的权限集。在此情况下，我们将权限集添加到一个名为**useast-prod-stuff-01**的特定存储桶中。为此，请选择与存储桶字段相邻的“添加
    ARN”选项。
- en: 'In the Add ARN(s) dialog box, type in the name of the selected bucket in the
    Bucket name field as depicted in the following screenshot. Once done, select Add to
    complete the process:'
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在“添加 ARN(s)”对话框中，在“存储桶名称”字段中输入所选存储桶的名称，如以下截图所示。完成后，选择“添加”以完成此过程：
- en: '![](img/cccd14f2-0fee-4adb-9fb2-a3ce51fd4445.png)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
  zh: '![](img/cccd14f2-0fee-4adb-9fb2-a3ce51fd4445.png)'
- en: 'Once done, you can optionally choose to add permissions to an object level
    as well. Click on the Add ARN option adjoining the object field and fill in the
    required information as we performed in the previous steps. The only addition
    here is that you can provide an additional *folder name* in the Object name field
    for a more granular permission control. Once done, click on Add to complete the
    process. Here is a screenshot of the completed resource allocation for our policy:'
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成后，你还可以选择为对象级别添加权限。点击对象字段旁边的“添加ARN”选项，填写所需信息，就像我们在前面步骤中操作的那样。唯一的附加项是，你可以在对象名称字段中提供额外的*文件夹名称*，以便更精细地控制权限。完成后，点击“添加”以完成此过程。以下是我们策略完成的资源分配截图：
- en: '![](img/28a65ad5-7662-44fc-ab42-d1c9a533ef62.png)'
  id: totrans-33
  prefs: []
  type: TYPE_IMG
  zh: '![](img/28a65ad5-7662-44fc-ab42-d1c9a533ef62.png)'
- en: With the permissions and the resources set, you can optionally choose to add
    Conditions as well to your policy. To do so, select the Specify request conditions option.
    Here you can opt to select and edit conditions that match your requirements. For
    example, for this particular policy, we want the user to access the particular
    S3 bucket only from within an organization's internal network. To do so, select
    the Source IP option and type in suitable IP range or a single IP address based
    on your organization's IP range.
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在设置了权限和资源之后，你还可以选择向策略中添加条件。为此，选择“指定请求条件”选项。在这里，你可以选择并编辑符合需求的条件。例如，对于此策略，我们希望用户仅能从组织的内部网络访问特定的S3存储桶。为此，选择“源IP”选项，并根据组织的IP范围输入合适的IP范围或单个IP地址。
- en: 'You can also add additional conditions to your policy by selecting the Add
    request condition option. Here, you can customize and specify a granular condition
    using a combination of Condition key, Qualifier, and Operator as shown in the
    following screenshot:'
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你还可以通过选择“添加请求条件”选项向策略中添加额外的条件。在这里，你可以使用条件键、限定符和操作符的组合，定制和指定更精细的条件，以下截图展示了这一过程：
- en: '![](img/5b5d61fc-38f7-4135-9ed9-b3b1359a7915.png)'
  id: totrans-36
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5b5d61fc-38f7-4135-9ed9-b3b1359a7915.png)'
- en: Here, the condition will check and allow only a particular AWS IAM user with
    the username joe access to the S3 bucket. You can create your own custom conditions
    using the same approach and once done, click on Add to complete the process.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，条件将检查并允许只有用户名为joe的特定AWS IAM用户访问S3存储桶。你可以使用相同的方法创建自己的自定义条件，完成后点击“添加”以完成此过程。
- en: With the permissions, resources, and conditions in place, select the Review
    policy option to complete the policy creation process. Provide a suitable Name and
    an optional Description for your policy before selecting the Create policy option.
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在设置了权限、资源和条件后，选择“审查策略”选项以完成策略创建过程。在选择“创建策略”选项之前，为你的策略提供一个合适的名称和可选的描述。
- en: There you have it! Simple, wasn't it! You can use the same process to create
    highly customized and granular policies with relative ease. However, there is
    still one question that remains unanswered; how do we test and troubleshoot the
    policies without making any actual requests? That's exactly what the IAM Policy
    Simulator is all about!
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 就是这样！简单吧，是吧！你可以使用相同的流程，轻松创建高度自定义和精细化的策略。然而，仍然有一个问题没有解答：我们如何在不发出实际请求的情况下测试和排查策略？这正是IAM策略模拟器的作用所在！
- en: Testing IAM policies using the IAM Policy Simulator
  id: totrans-40
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用IAM策略模拟器测试IAM策略
- en: With your new policy created, the next steps would be to attach it to either
    an IAM user or group and test it out. But how do you effectively test your new
    policy without having to make any actual calls or requests? That's where the new
    IAM Policy Simulator comes into play!
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 创建好新策略后，接下来的步骤是将其附加到IAM用户或组，并进行测试。但你如何在不发出任何实际调用或请求的情况下有效地测试新策略呢？这正是新的IAM策略模拟器派上用场的地方！
- en: 'The IAM Policy Simulator is used to evaluate IAM policies in order to determine
    the most effective set of permissions and actions that you can specify without
    making any actual resource calls whatsoever. The policy simulator internally leverages
    the same policy evaluation engine that processes real requests to AWS resources;
    however, it does not make any actual service request itself. Because of this nature,
    the policy simulator is unable to report any responses from the generated requests.
    All you get as a result is whether the policy would allow or deny a particular
    action. Here are a few ways using which you can leverage the IAM Policy Simulator:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: IAM策略模拟器用于评估IAM策略，以确定你可以指定的最有效的权限和操作集，而无需实际调用任何资源。策略模拟器内部利用与处理真实请求到AWS资源的策略评估引擎相同的引擎；然而，它本身并不进行任何实际的服务请求。因此，策略模拟器无法报告从生成的请求中得到的任何响应。你所得到的结果只是该策略是否允许或拒绝某个特定操作。以下是你可以利用IAM策略模拟器的一些方法：
- en: You can use the IAM Policy Simulator to test policies that are attached to existing
    users, groups and roles.
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你可以使用IAM策略模拟器来测试附加到现有用户、组和角色上的策略。
- en: You can also use the simulator to test policies that are not attached yet to
    your resources by simply copying and executing them against the simulator
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你也可以通过简单地复制并执行策略到模拟器，来测试那些尚未附加到你的资源上的策略。
- en: The simulator can also be used to test policies attached to various AWS resources
    such as Amazon S3 buckets, Amazon EC2 instances, and so on.
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 模拟器还可以用于测试附加到各种AWS资源上的策略，比如Amazon S3桶、Amazon EC2实例等。
- en: You can even use the simulator to test out real world scenarios by passing various
    context keys such as *IP addresses* or *usernames* that are passed alongside the
    conditions of a policy, and much more!
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你甚至可以通过传递各种上下文键（例如*IP地址*或*用户名*），这些键与策略的条件一起传递，从而使用模拟器测试真实世界的场景，等等！
- en: 'To get started with the IAM Policy Simulator, simply select this URL [https://policysim.aws.amazon.com/](https://policysim.aws.amazon.com/). The
    policy simulator is a separate entity that runs outside your standard AWS Console.
    Use your standard AWS IAM credentials to log in to the policy simulator if asked:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始使用IAM策略模拟器，只需选择这个网址[https://policysim.aws.amazon.com/](https://policysim.aws.amazon.com/)。策略模拟器是一个独立的实体，运行在你的标准AWS控制台之外。如果需要，请使用你的标准AWS
    IAM凭证登录到策略模拟器：
- en: Once logged in, you can use the simulator to test and validate your existing
    user, group and even role-based policies. To start with, let us test the policy
    we created in our earlier section of this chapter! To do so, from the Users, Groups,
    and Roles section, select the Users from the drop-down list. You should see a
    list of users present in your AWS account.
  id: totrans-48
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录后，你可以使用模拟器测试和验证现有的用户、组甚至基于角色的策略。首先，让我们测试一下我们在本章前面部分创建的策略！为此，在“用户、组和角色”部分，从下拉列表中选择“用户”。你应该能看到你的AWS账户中存在的用户列表。
- en: 'Select the appropriate User that was used to attach the policy. In my case,
    the username was `joe`. Once selected, you will be shown all the policies that
    the user is currently associated with, in this case, we should see the custom
    S3 access policy that we created in the earlier section as shown in the following
    screenshot:'
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择用于附加策略的适当用户。在我的例子中，用户名是`joe`。选择后，你将看到该用户当前关联的所有策略，在本例中，我们应该能看到我们在前面部分创建的自定义S3访问策略，如下图所示：
- en: '![](img/9770311d-142a-479b-8b98-a3165d016824.png)'
  id: totrans-50
  prefs: []
  type: TYPE_IMG
  zh: '![](img/9770311d-142a-479b-8b98-a3165d016824.png)'
- en: Select the policy to view its details. You can even choose to modify and test
    the policy here using the inbuilt *policy editor*, however do note that changes
    made to the policy here are not reflected in the actual policy.
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择策略以查看其详细信息。你甚至可以选择修改并在这里使用内置的*策略编辑器*来测试该策略，但请注意，在这里对策略所做的更改不会反映到实际的策略中。
- en: 'With the policy selected, we are now ready to test it using the IAM Policy
    Simulator section. Here''s a snippet of the policy that we are going to test:'
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择策略后，我们现在准备使用IAM策略模拟器部分来测试它。下面是我们将要测试的策略片段：
- en: '[PRE0]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: As per our policy, only the user `joe` has the `s3:PutObject`, `s3:GetObject`,
    `s3:ListBucket`, `s3:DeleteObject` rights to the `useast-prod-stuff-01` bucket
    and that too if Joe is accessing the bucket from his organization's internal network
    (`10.0.0.0/24`).
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 根据我们的策略，只有用户`joe`拥有`s3:PutObject`、`s3:GetObject`、`s3:ListBucket`、`s3:DeleteObject`等权限，且只有当Joe从他所在组织的内部网络（`10.0.0.0/24`）访问`useast-prod-stuff-01`桶时才有效。
- en: To test the same, from the Select service drop-down list, select Amazon S3 option.
    Next, match either of the actions using the Select actions drop-down list. In
    this case, I've only selected the `s3:PutObject` action.
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要进行测试，请从“选择服务”下拉列表中选择Amazon S3选项。接下来，使用“选择操作”下拉列表匹配任一操作。在这种情况下，我只选择了`s3:PutObject`操作。
- en: 'Once completed, from the Global Settings section, type in the adjacent values
    against the *condition keys* that appear in the policy. In this case, type in
    the username and the sourceip as depicted in the following screenshot:'
  id: totrans-56
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成后，在“全局设置”部分，输入与策略中出现的*条件键*相邻的值。在这种情况下，输入用户名和源IP，如下图所示：
- en: '![](img/ff4a14dc-1396-4be1-9e6e-11b7482e6c47.png)'
  id: totrans-57
  prefs: []
  type: TYPE_IMG
  zh: '![](img/ff4a14dc-1396-4be1-9e6e-11b7482e6c47.png)'
- en: Next, from the Action Settings and Results section, expand on the Resource and
    type in the ARN of the resource against which the policy needs to be tested. In
    this case, this has to be the ARN of the S3 bucket arn:aws:s3:::useast-prod-stuff-01\.
    Once done, select the Run Simulation option.
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，在“操作设置和结果”部分，展开资源，并输入需要测试的策略对应的资源ARN。在这种情况下，必须是S3桶的ARN `arn:aws:s3:::useast-prod-stuff-01`。完成后，选择“运行模拟”选项。
- en: With the simulation running, you should get either *allowed* or *denied* results
    based on the values you provide during the simulation. Feel free to change the
    *actions* as well as the *condition keys* and re-run the simulation. With each
    attempt, you can fine tune and troubleshoot your policy without having to actually
    pass any real requests to your resources.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 在模拟运行过程中，您应该会根据在模拟过程中提供的值看到*允许*或*拒绝*的结果。您可以随意更改*操作*和*条件键*，并重新运行模拟。每次尝试后，您可以微调并排查策略问题，而无需真正向资源发出任何实际请求。
- en: You can also use the same policy simulator to test out new policies that are
    not yet attached to resources. To do so, you will first need to toggle from the
    current (default) mode of Existing policies to New Policy using the Mode option
    provided at the very top of the simulator.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以使用相同的策略模拟器来测试尚未附加到资源的新的策略。为此，您首先需要通过模拟器顶部提供的模式选项，将当前的（默认）现有策略模式切换为新策略模式。
- en: Once the New Policy option is selected, you can use the Policy Sandbox to create
    new policies and test them out the same way we did a while back. Remember, however,
    that policies created or edited here are not reflected back in AWS IAM.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦选择了“新策略”选项，您可以使用策略沙箱来创建新策略，并像之前一样测试它们。不过请记住，在此创建或编辑的策略不会反映到AWS IAM中。
- en: With this, we come towards the end of this section. In the next section, we
    will be looking at how you can leverage AWS Organizations to effectively manage
    multiple AWS accounts with relative ease.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 至此，我们接近本节的结束。在下一节中，我们将介绍如何利用AWS Organizations轻松有效地管理多个AWS账户。
- en: Introducing AWS Organizations
  id: totrans-63
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍AWS Organizations
- en: So far we have been working out of a single AWS account that we use for development,
    testing as well as for production purposes, but this isn't the case with many
    organizations who end up with multiple AWS accounts for a variety of purposes
    such as multiple environments, compliance issues, and so on. Each account gets
    governed and managed in its own way with no centralized ownership or control.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们一直使用单一的AWS账户进行开发、测试和生产，但许多组织并非如此，他们会为了多个用途（如多个环境、合规问题等）拥有多个AWS账户。每个账户都有自己独特的管理方式，并没有集中式的所有权或控制。
- en: AWS Organizations is a simple service that allows you to consolidate and manage
    multiple such AWS accounts all under one roof. It enables you to group AWS accounts
    into one or more collective *organizations* that you can create and manage as
    a whole.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: AWS Organizations是一个简单的服务，允许您集中管理多个AWS账户。它使您能够将AWS账户分组为一个或多个集体*组织*，您可以像管理一个整体一样进行创建和管理。
- en: 'Here''s a quick look at some of AWS Organizations key concepts and terminologies:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 下面是一些AWS Organizations的关键概念和术语的简要介绍：
- en: '**Organizations**: Organizations are consolidated views of all your AWS accounts
    in one place. Using organizations, you can centrally view and manage each of your
    AWS accounts under one roof. Organizations provide an additional functionality
    using which you can determine the type of organization you wish to create. There
    are two such feature sets, namely:'
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**组织**：组织是您所有AWS账户的集中视图，统一管理。通过组织，您可以在一个地方集中查看和管理所有AWS账户。组织提供了一项附加功能，您可以通过它来决定希望创建的组织类型。有两个此类功能集，即：'
- en: '**Consolidated billing**: A key feature provided by AWS Organizations is the
    ability to view and consolidate each AWS accounts billing under one organization.
    This feature is selected by default when you first create an organization and
    only provides you with the consolidated billing views. For leveraging all of the
    AWS Organizations advanced features, you will have to select the All features
    option.'
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**合并计费**：AWS Organizations 提供的一个关键功能是能够查看并将每个 AWS 账户的计费合并到一个组织下。当您首次创建组织时，默认会选择此功能，并仅为您提供合并计费视图。要利用所有
    AWS Organizations 的高级功能，您需要选择“全部功能”选项。'
- en: '**All features**: This feature set provides the full functionality of AWS Organizations,
    including consolidated billing and many other features that provide you with better
    control over your individual accounts. Using this feature set, you can restrict
    certain AWS services from accounts; modify access roles, and much more.'
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**全部功能**：此功能集提供了 AWS Organizations 的完整功能，包括合并计费以及许多其他功能，使您能够更好地控制您的各个账户。使用此功能集，您可以限制某些
    AWS 服务的账户访问；修改访问角色等更多操作。'
- en: '**Root**: The root is the primary container for all your individual accounts
    used within AWS. AWS Organizations automatically creates a default root element
    for you when you first create an organization. Any changes or policies applied
    at the root level propagate to its subsequent child elements as well.'
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**根**：根是您在 AWS 中使用的所有单个账户的主要容器。当您首次创建组织时，AWS Organizations 会自动为您创建一个默认的根元素。任何在根级别应用的更改或策略都会传播到其后续的子元素。'
- en: '**Organizational Unit** (**OU**): OUs are containers for one or more AWS accounts.
    You can branch multiple OUs from a single OU as well, however the end of an OU
    is always an account. Here is a representational diagram depicting the interactions
    between an organization, the root element, OUs, and various AWS accounts:'
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**组织单位**（**OU**）：OU 是一个包含一个或多个 AWS 账户的容器。您还可以从单个 OU 分支出多个 OU，但 OU 的终点始终是一个账户。以下是一个示意图，展示了组织、根元素、OU
    和各种 AWS 账户之间的交互关系：'
- en: '**![](img/25cd1cdc-8bb6-46bc-adbe-16f3d5c34953.png)**'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: '**![](img/25cd1cdc-8bb6-46bc-adbe-16f3d5c34953.png)**'
- en: '**Accounts**: Accounts are standard AWS accounts that contain your AWS resources.
    When creating an organization, AWS marks the account from where the organization
    gets created as the *master account*. Any additional accounts added later to this
    organization are termed as *member accounts*. The master account is also responsible
    for overseeing the consolidated billing and payments for the rest member accounts
    as well as useful for inviting other AWS accounts into the organization, creating
    OUs, managing policies, and so on.'
  id: totrans-73
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**账户**：账户是包含您 AWS 资源的标准 AWS 账户。在创建组织时，AWS 将创建组织的账户标记为 *主账户*。稍后添加到此组织的任何其他账户都称为
    *成员账户*。主账户还负责监督合并计费和为其他成员账户进行支付，并且可以用于邀请其他 AWS 账户加入组织、创建 OU、管理策略等。'
- en: '**Service Control Policy** (**SCP**): SCPs are essentially policies that are
    attached to roots, accounts or OUs for specifying services and actions that the
    particular account''s or OU''s user can use. For example, you can use an SCP on
    an account that is created with HIPAA compliance in mind and you want to restrict
    all users of this account to use only HIPAA compliant AWS services, and so on.'
  id: totrans-74
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**服务控制策略**（**SCP**）：SCP 本质上是附加到根、账户或组织单位（OU）上的策略，用于指定特定账户或 OU 的用户可以使用的服务和操作。例如，您可以在一个针对
    HIPAA 合规性创建的账户上使用 SCP，并希望限制该账户的所有用户仅使用符合 HIPAA 合规的 AWS 服务，等等。'
- en: To know more about the HIPAA compliance and how it works along with AWS visit
    this URL to know more [https://aws.amazon.com/compliance/hipaa-compliance/](https://aws.amazon.com/compliance/hipaa-compliance/).
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解更多关于 HIPAA 合规性以及它如何与 AWS 一起工作，请访问此 URL 了解更多信息 [https://aws.amazon.com/compliance/hipaa-compliance/](https://aws.amazon.com/compliance/hipaa-compliance/)。
- en: An important point to remember here is that SCPs only work when you have enabled
    the All features feature set while creating your organization.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 这里需要记住一个重要点：SCP 只有在您启用创建组织时的“全部功能”功能集时才会生效。
- en: With this basic information in hand, let us look at how you can get started
    with AWS Organizations using a few simple steps.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 了解这些基本信息后，让我们看看如何通过几个简单的步骤开始使用 AWS Organizations。
- en: Getting started with AWS Organizations
  id: totrans-78
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 开始使用 AWS Organizations
- en: 'AWS Organizations can be set up using both the AWS Management Console as well
    as the AWS CLI. In this section, we will be exploring simple steps using which
    you can get started with your own organization in a matter of minutes:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: AWS Organizations 可以通过 AWS 管理控制台和 AWS CLI 进行设置。在本节中，我们将探索简单的步骤，您可以通过这些步骤在几分钟内开始使用自己的组织：
- en: From the AWS Management Console, filter out AWS Organizations using the Filter option
    or alternatively navigating to this URL [https://console.aws.amazon.com/organizations/](https://console.aws.amazon.com/organizations/).
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从 AWS 管理控制台，使用“筛选”选项过滤出 AWS Organizations，或者直接访问此 URL [https://console.aws.amazon.com/organizations/](https://console.aws.amazon.com/organizations/)。
- en: Since this is the first time we are setting up an AWS Organization here, this
    particular account will now be transformed into the master account. Any other
    AWS accounts added or created to this master account will be termed as member
    accounts. Click on Create organization to get started.
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 由于这是我们第一次设置 AWS 组织，因此此帐户将被转变为主帐户。添加或创建到该主帐户的任何其他 AWS 帐户将被视为成员帐户。点击“创建组织”以开始操作。
- en: At the time of creating an organization, you can opt to select either to Enable
    all features or Enable only Consolidated Billing based on your requirements. For
    this scenario, select Enable all features and click on Create organization once
    completed.
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在创建组织时，您可以选择启用“启用所有功能”或“仅启用合并账单”选项，具体取决于您的需求。在此场景中，选择“启用所有功能”，然后在完成后点击“创建组织”。
- en: 'With the organization created, you should see your existing account listed
    on the accounts page as shown in the following screenshot. Select the Add account option
    to add a new AWS account to our organization:'
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建组织后，您应该可以在帐户页面上看到现有帐户，如下图所示。选择“添加帐户”选项，将新 AWS 帐户添加到我们的组织中：
- en: '![](img/8bbd5dbe-17b7-4137-bd17-4c3bfa38f132.png)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![](img/8bbd5dbe-17b7-4137-bd17-4c3bfa38f132.png)'
- en: As mentioned before, AWS Organizations allows you to add existing AWS accounts
    into a new organization as well as create new accounts as a part of your master
    account itself. For this particular scenario, let us go ahead and create a new
    account called **sandbox**. Select the Create account option on the Add account page.
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如前所述，AWS Organizations 允许您将现有的 AWS 帐户添加到新组织中，并作为主帐户的一部分创建新帐户。在此场景中，我们将继续创建一个名为
    **sandbox** 的新帐户。在“添加帐户”页面选择“创建帐户”选项。
- en: Provide a suitable name and email address for your new account in the Full name and
    Email fields respectively. The email that you provide has to be globally unique
    so provide an email address that has not been used so far with AWS here.
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在“全名”和“电子邮件”字段中分别为您的新帐户提供合适的名称和电子邮件地址。您提供的电子邮件必须是全球唯一的，因此请提供一个之前未在 AWS 使用过的电子邮件地址。
- en: Next, in the IAM role name filed, provide a suitable role name for your account.
    This role will enable you to access the new member account when signed in as an
    IAM user in the master account. Once completed, click on Create to complete the
    process.
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，在 IAM 角色名称字段中，为您的帐户提供一个合适的角色名称。此角色将使您能够在作为主帐户中的 IAM 用户登录时访问新成员帐户。完成后，点击“创建”完成该过程。
- en: 'Here is a snippet of the IAM Role that is created by AWS. The role grants full
    access to all AWS services and resources present in the new account:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 这是 AWS 创建的 IAM 角色的片段。该角色授予对新帐户中所有 AWS 服务和资源的完全访问权限：
- en: '[PRE1]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: The account creation process takes a few minutes to complete. Once done, you
    should see a new account created with the name Sandbox and a new Account ID as
    well in the Accounts page of AWS Organizations. Select the sandbox account to
    view its associated ARN and ID in the adjoining pane.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 帐户创建过程需要几分钟时间。一旦完成，您应该会看到名为 Sandbox 的新帐户以及新的帐户 ID，也会出现在 AWS Organizations 的帐户页面中。选择
    sandbox 帐户，查看其关联的 ARN 和 ID，显示在旁边的窗格中。
- en: 'With your account created, the next step involves creation of one or more OUs
    and moving the newly created account into an OU. For this particular scenario,
    let us go ahead and create an OU called Sandbox:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 创建帐户后，下一步是创建一个或多个组织单元（OU），并将新创建的帐户移入该 OU。在此场景中，我们将继续创建一个名为 Sandbox 的 OU：
- en: Select the Organize accounts tab from the AWS Organizations dashboard to view
    the current hierarchical setup of the organization. From the Organizational Units section,
    select the + New Organization Unit option to get started.
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从 AWS Organizations 仪表板中选择“组织帐户”选项卡，以查看组织的当前层级设置。在“组织单元”部分，选择“+ 新建组织单元”选项以开始操作。
- en: 'In the Create organizational unit dialog box, provide a suitable name for the
    new OU in the Name of organization unit field as shown in the following screenshot.
    Click on Create organizational unit once done:'
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在“创建组织单元”对话框中，在“组织单元名称”字段中提供新 OU 的合适名称，如下图所示。完成后，点击“创建组织单元”：
- en: '![](img/5fdd02cc-f82f-4790-af05-58ba53f63a2f.png)'
  id: totrans-94
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5fdd02cc-f82f-4790-af05-58ba53f63a2f.png)'
- en: With the OU created, the final step in the process is to move the account into
    the newly created OU. To do so, from the same Organize accounts page, select the
    Sandbox account and click on Move.
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建完 OU 后，过程的最后一步是将账户移动到新创建的 OU 中。为此，从相同的“组织账户”页面，选择“沙盒”账户并点击“移动”。
- en: This will bring up a simple interface using which you will need to select the
    new OU to which you want to move the Sandbox account. Select the Sandbox OU and
    click on Move to compete the process.
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这将弹出一个简单的界面，您需要在其中选择要将沙盒账户移动到的新 OU。选择“沙盒”OU，点击“移动”以完成过程。
- en: 'With this step, you should have a new OU and a new account listed within it.
    You can use the same steps to create multiple OUs and accounts based on your requirements
    and needs. You can additionally provide restricted access to the services present
    in your new account by creating and assigning a new SCP to it as well:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 完成此步骤后，您应该会在新 OU 中看到一个新的账户。您可以使用相同的步骤根据需求创建多个 OU 和账户。您还可以通过为新账户创建并分配新的 SCP，进一步限制其访问服务：
- en: To create a new SCP, select the Policies tab on the AWS Organization dashboard.
    You should see a default policy with the name `FullAWSAccess` already present
    there. This is a default policy that is created by AWS the first time you create
    an AWS Organization. The sandbox environment too is currently referenced to the
    same policy.
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要创建新的 SCP，请在 AWS 组织仪表板上选择“策略”选项卡。您应该会看到一个默认的名为`FullAWSAccess`的策略。这个策略是 AWS 在您第一次创建
    AWS 组织时自动创建的。沙盒环境目前也引用了相同的策略。
- en: To create a new SCP, select the Create policy option. AWS Organization provides
    you with two options when it comes to creating new SCPs. You can choose to leverage
    the Policy generator to select specific services and actions from a list and build
    your custom policy or alternatively, choose to Copy an existing SCP and edit the
    same manually. For this case, select the Policy generator option.
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要创建新的 SCP，请选择“创建策略”选项。AWS 组织在创建新 SCP 时提供两种选择。您可以选择利用策略生成器，从列表中选择特定服务和操作，构建自定义策略；或者选择复制现有的
    SCP 并手动编辑。此处请选择“策略生成器”选项。
- en: Next, provide a Policy name and Description followed by selecting the Effect the
    policy should have on the applied AWS account.
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，提供一个策略名称和描述，然后选择策略在应用的 AWS 账户上应该具有的效果。
- en: AWS Organizations allows you to either whitelist (allow) or blacklist (deny)
    services based on your requirements. Blacklisting services will cause all services
    listed in the policy to be blocked by default, whereas whitelisting services will
    block all service APIs that are not listed in the policy. Let us go ahead and
    create a simple policy for our sandbox OU that allows EC2, S3, and RDS services
    while explicitly blocking AWS CloudTrail.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: AWS Organizations 允许您根据需求对服务进行白名单（允许）或黑名单（拒绝）。将服务列入黑名单会导致策略中列出的所有服务默认被阻止，而将服务列入白名单则会阻止所有未在策略中列出的服务
    API。接下来，我们将为沙盒 OU 创建一个简单的策略，允许使用 EC2、S3 和 RDS 服务，同时明确阻止 AWS CloudTrail。
- en: 'In the Choose Overall Effect section, select Allow to first create the whitelist
    of services. Use the Statement builder to select the correct service and its appropriate
    action as well. Once done, click on Add statement to add further services and
    actions as shown in the following screenshot:'
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在“选择总体效果”部分，选择“允许”以首先创建服务的白名单。使用语句生成器选择正确的服务及其相应的操作。完成后，点击“添加语句”以添加更多服务和操作，如下图所示：
- en: '![](img/9032107d-2367-4c09-9e20-511aa6ae4279.png)'
  id: totrans-103
  prefs: []
  type: TYPE_IMG
  zh: '![](img/9032107d-2367-4c09-9e20-511aa6ae4279.png)'
- en: Once you are done with adding the required statements, simply select the Create
    policy option to complete the process.
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加完所需的语句后，直接选择“创建策略”选项以完成该过程。
- en: With the policy created, you can attach the same to an existing account, OU,
    or even root by simply selecting the policy from the Policies page and selecting
    either of the root, accounts, or organization units options as required. However,
    before you proceed further, you will first need to enable SCP policy types for
    your root account. To do so, select the Root option from the Organize accounts tab.
    In the adjoining details pane, select enable next to the Service control policies section.
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建策略后，你可以将其附加到现有帐户、组织单位（OU）或甚至根目录，只需从策略页面选择策略，并根据需要选择根目录、帐户或组织单位选项。然而，在继续之前，你需要首先为根帐户启用
    SCP 策略类型。为此，请从“组织帐户”选项卡中选择“根目录”选项。在相邻的详细信息窗格中，在“服务控制策略”部分旁边选择启用。
- en: With this completed, you can now proceed with attaching the newly created policy
    to an entity within your organization. Remember, by attaching the policy to the
    root domain, you effectively propagate the policy down to its members as well.
    This includes the sub OUs and accounts that you may have created. For this particular
    case however, select the Accounts option and click the Attach option below the
    listed Sandbox environment.
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成此步骤后，你现在可以继续将新创建的策略附加到组织中的实体。记住，通过将策略附加到根域，你实际上也将策略传播到其成员中。这包括你可能已创建的子组织单位（OUs）和帐户。然而，对于此特定情况，请选择“帐户”选项，并点击列表中“沙盒”环境下方的“附加”选项。
- en: There you have it! A simple way using which you can create and manage your AWS
    accounts with utmost ease. Next, we will look at how you can achieve the same
    results by leveraging the AWS CLI as well.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 就这样！这是一个简单的方法，通过它你可以轻松创建和管理你的 AWS 帐户。接下来，我们将展示如何通过 AWS CLI 实现相同的结果。
- en: 'Creating and managing AWS accounts, OUs and SCPs using the CLI has its own
    bit of advantages. For example, you can easily automate the entire account creation
    process and make it faster and easier to on-board new teams within your organization,
    and so on:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 CLI 创建和管理 AWS 帐户、OUs 和 SCPs 有其独特的优势。例如，你可以轻松自动化整个帐户创建过程，加快速度并简化新团队在组织中的入驻等：
- en: 'The first step involved in this exercise is to create the organization and
    set it to use all features, just as we performed with the AWS Management Console.
    To do so, type in the following command as shown:'
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 本练习的第一步是创建组织并设置为使用所有功能，正如我们在 AWS 管理控制台中所做的那样。为此，请输入如下命令：
- en: '[PRE2]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: However this command may result in an error message for those of you who already
    have associated your AWS account with an organization.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，对于已经将 AWS 帐户与组织关联的用户，这条命令可能会导致错误消息。
- en: You can alternatively pass the `CONSOLIDATED_BILLING` value for the `--feature-set` parameter
    depending on your organization's requirements.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 你也可以根据组织的需求，将 `CONSOLIDATED_BILLING` 值传递给 `--feature-set` 参数。
- en: 'With the organization in place, let us go ahead and create an AWS account for
    our organization, but before we do that, we need to execute just one command that
    will provide us with the organization''s root''s ID. The ID will be in the form
    of `r-<XY00>`. Make a note of the same for later steps:'
  id: totrans-113
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 组织就绪后，接下来我们将为我们的组织创建一个 AWS 帐户，但在此之前，我们需要执行一条命令来获取组织根目录的 ID。该 ID 将采用 `r-<XY00>`
    的格式。请记下此 ID 以便后续步骤使用：
- en: '[PRE3]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'With the root ID noted type in the following command to create a new account.
    In this case, we are going to create a new account with the name of `prod`. Remember
    to substitute the `<EMAIL_ID>` field with a globally unique value:'
  id: totrans-115
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 记下根目录 ID 后，输入以下命令来创建新帐户。在此情况下，我们将创建一个名为 `prod` 的新帐户。记得将 `<EMAIL_ID>` 字段替换为一个全球唯一的值：
- en: '[PRE4]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Here is a snapshot of the command''s output. Make a note of the new account''s
    status ID in the format `car-<UNIQUE_ID>` as shown in the following screenshot:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 下面是命令输出的快照。请记下新帐户的状态 ID，格式为 `car-<UNIQUE_ID>`，如以下截图所示：
- en: '![](img/628de4ef-8741-47dd-a67e-0794ce84a780.png)'
  id: totrans-118
  prefs: []
  type: TYPE_IMG
  zh: '![](img/628de4ef-8741-47dd-a67e-0794ce84a780.png)'
- en: 'You can use this status ID to check whether the account creation has completed
    successfully or not by typing in the following command. Replace the `car-<UNIQUE_ID>` with
    the value copied from the earlier step:'
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你可以使用此状态 ID 来检查帐户创建是否成功，通过输入以下命令。将 `car-<UNIQUE_ID>` 替换为之前步骤中复制的值：
- en: '[PRE5]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'You can view the newly created accounts ID by using the following command:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用以下命令查看新创建的帐户 ID：
- en: '`**aws organizations list-accounts**`'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: '`**aws organizations list-accounts**`'
- en: 'Once the new account is created, we can proceed to create a new OU and move
    the account over to the new OU. In this case, we are naming the new OU as `production`.
    Substitute the value of `r-<XY00>` with the root ID that we made a note of from
    our earlier steps:'
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦新账户创建完成，我们就可以继续创建一个新的OU，并将账户移动到新的OU中。在这种情况下，我们将新OU命名为`production`。用我们在之前步骤中记下的root
    ID替换`r-<XY00>`的值：
- en: '[PRE6]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: The output of this command yields two important values, first is the ARN of
    the new OU and the second is the OU's ID which is in the form of `ou-<XY00>-<UNIQUE_ID>`.
    Make a note of the same for the next steps.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 该命令的输出将返回两个重要的值，第一个是新OU的ARN，第二个是OU的ID，格式为`ou-<XY00>-<UNIQUE_ID>`。请记下这些值，以便后续步骤使用。
- en: 'Now that the account and OU are created, we simply have to move the account
    into the new OU. To do so, type in the following command while substituting the
    correct values for the `account-id`, `parent-id`, and the `OU-id`:'
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在账户和OU已经创建完成，我们只需要将账户移动到新OU中。为此，输入以下命令，并替换`account-id`、`parent-id`和`OU-id`的正确值：
- en: '[PRE7]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '![](img/b52e917d-bae0-4464-9ccf-e4867d65cfb2.png)'
  id: totrans-128
  prefs: []
  type: TYPE_IMG
  zh: '![](img/b52e917d-bae0-4464-9ccf-e4867d65cfb2.png)'
- en: 'That''s it! You have just created a brand new AWS account and moved it into
    a new OU as well with a few simple commands! It''s that easy! However, you can
    take things a bit further by creating a new SCP and attaching the same to our
    newly created OU. Let us assume for a moment that the particular OU that we have
    created can only allow certain AWS services to run as a part of the production
    environment. To do so, we first need to create a new SCP as shown in the following
    code block:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 就这样！你刚刚创建了一个全新的AWS账户，并且通过几个简单的命令将其移动到了新的OU！就是这么简单！不过，你还可以通过创建一个新的SCP并将其附加到我们新创建的OU上来进一步完善。假设我们创建的这个特定OU只允许某些AWS服务在生产环境中运行。为此，我们首先需要创建一个新的SCP，代码块如下所示：
- en: '[PRE8]'
  id: totrans-130
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'In this case, the SCP is whitelisting EC2, RDS, and DynamoDB however feel free
    to modify to suit your own requirements:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，SCP是将EC2、RDS和DynamoDB列入白名单，当然你可以根据自己的需求进行修改：
- en: 'Paste the SQP into a new file named as `policy.json` and save it. Next, type
    in the following command to create it:'
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将SQP粘贴到一个名为`policy.json`的新文件中并保存。接下来，输入以下命令来创建它：
- en: '[PRE9]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'With the policy created, you should receive a policy ID in the form of `p-<UNIQUE_ID>`.
    Make a note of the same. Next, use the following command to attach the newly created
    policy to our OU:'
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建策略后，你应该会收到一个格式为`p-<UNIQUE_ID>`的策略ID。请记下该ID。接下来，使用以下命令将新创建的策略附加到我们的OU上：
- en: '[PRE10]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: That's it! You have just successfully attached a new policy to your OU. You
    can use the same syntax to attach the policy directly to each individual account
    as well.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 就这样！你已经成功地将一个新策略附加到你的OU上。你可以使用相同的语法直接将策略附加到每个单独的账户上。
- en: Planning your next steps
  id: totrans-137
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 规划你的下一步行动
- en: 'There are still plenty of things worth trying out when working with AWS Organizations.
    Here are a few recommendations for the same:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 在使用AWS Organizations时，仍然有很多值得尝试的事情。以下是一些建议：
- en: First up, as a best practice, you should always monitor your individual organizations
    and make sure that each change is tracked and reported. You can leverage both
    AWS CloudTrail as well as AWS CloudWatch events to accomplish the same. Monitoring
    the organizations is essential as it helps you to ensure that no unwanted changes
    affect the compliance of your accounts and environments. You can read up more
    on how you can leverage AWS CloudTrail and AWS CloudWatch events for monitoring
    organizations at [https://docs.aws.amazon.com/organizations/latest/userguide/orgs_monitoring.html](https://docs.aws.amazon.com/organizations/latest/userguide/orgs_monitoring.html).
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，作为最佳实践，你应该始终监控你的个人组织，并确保每个更改都能被跟踪和报告。你可以利用AWS CloudTrail和AWS CloudWatch事件来实现这一点。监控组织至关重要，因为它帮助你确保没有不必要的更改影响你的账户和环境的合规性。你可以在[https://docs.aws.amazon.com/organizations/latest/userguide/orgs_monitoring.html](https://docs.aws.amazon.com/organizations/latest/userguide/orgs_monitoring.html)阅读更多关于如何利用AWS
    CloudTrail和AWS CloudWatch事件来监控组织的内容。
- en: 'Next up, I would also recommend that you try out the AWS provided end-to-end
    account creation process here:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我还建议你试试AWS提供的端到端账户创建过程：
- en: '[https://aws.amazon.com/blogs/security/how-to-use-aws-organizations-to-automate-end-to-end-account-creation/](https://aws.amazon.com/blogs/security/how-to-use-aws-organizations-to-automate-end-to-end-account-creation/)'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://aws.amazon.com/blogs/security/how-to-use-aws-organizations-to-automate-end-to-end-account-creation/](https://aws.amazon.com/blogs/security/how-to-use-aws-organizations-to-automate-end-to-end-account-creation/)'
- en: The overall process for automating the account creation is very similar to the
    CLI commands that we executed a while back. The script accepts a few variables
    that are required to be defined first along with a few customizations of role
    names. Once done, you simply execute the shell script, which in turn calls a CloudFormation
    template to create and configure the new member account.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 自动化账户创建的整体过程与我们之前执行的 CLI 命令非常相似。脚本接受一些需要先定义的变量，并可以自定义角色名称。完成这些设置后，你只需执行 shell
    脚本，它会调用 CloudFormation 模板来创建和配置新的成员账户。
- en: Summary
  id: totrans-143
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: With this, we come toward the end of yet another chapter but before we move
    on to the next, let us quickly summarize all that we have learnt so far!
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 到这里，我们接近本章的结尾，但在进入下一章之前，让我们快速总结一下到目前为止学到的内容！
- en: We first started with a brief recap of AWS IAM and its core building blocks
    followed by learning a bit about two really useful enhancements made to IAM in
    recent times. The first was a visual editor using which you can create customized
    and granular IAM policies with relative ease, followed by an IAM Policy Simulator
    tool that helps you to create and test your policies without affecting any running
    workloads on the cloud. Post this we also learnt about AWS Organizations and how
    you can leverage it for creating and managing multiple AWS accounts under one
    roof. We also saw how easily you can create and work with root, organizations,
    and accounts using both the AWS Organizations dashboard as well as the CLI.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先简要回顾了 AWS IAM 及其核心构建块，接着学习了最近对 IAM 做出的两项非常有用的增强功能。第一项是一个可视化编辑器，使用它你可以相对轻松地创建定制化和细粒度的
    IAM 策略，接着是 IAM 策略模拟器工具，它帮助你创建和测试策略，而不影响云端任何正在运行的工作负载。之后，我们还了解了 AWS 组织及其如何帮助你在一个平台下创建和管理多个
    AWS 账户。我们还看到了如何通过 AWS 组织仪表板以及 CLI，轻松地创建和管理根账户、组织和其他账户。
- en: In the next chapter, we will be learning and exploring how you can leverage
    the AWS Code Suite of services to build an entire end-to-end CICD pipeline with
    the utmost of ease.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将学习和探索如何利用 AWS Code 套件服务，轻松地构建一个完整的端到端 CICD 流水线。
