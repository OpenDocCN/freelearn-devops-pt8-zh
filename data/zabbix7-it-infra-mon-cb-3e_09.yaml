- en: '9'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '9'
- en: Integrating Zabbix with External Services
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将 Zabbix 与外部服务集成
- en: In this chapter, we are going to set up some of the useful external service
    integrations that Zabbix has to offer. We can use these external services to notify
    our Zabbix users of ongoing problems.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将设置 Zabbix 提供的一些有用的外部服务集成。我们可以利用这些外部服务向 Zabbix 用户通知正在进行的问题。
- en: We will start by learning how to set up in-company chat applications such as
    Slack and Microsoft Teams. Then, we will learn how to use a personal chat application
    such as Telegram before learning how to integrate Atlassian Opsgenie for even
    more extensive alerting.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将从学习如何设置公司内的聊天应用程序，如 Slack 和 Microsoft Teams 开始。然后，我们将学习如何使用个人聊天应用 Telegram，最后学习如何集成
    Atlassian Opsgenie 以获得更广泛的警报功能。
- en: Once you’ve completed these recipes, you will be able to effectively integrate
    certain services with Zabbix. This is a good starting point for working with external
    services in general and the easiest way to set up Slack, Teams, Opsgenie, and
    Telegram.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你完成了这些设置，你将能够有效地将某些服务与 Zabbix 集成。这是一个很好的起点，适用于与外部服务的集成，并且是设置 Slack、Teams、Opsgenie
    和 Telegram 的最简单方式。
- en: 'In this chapter, we will cover the following recipes:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将介绍以下几个方案：
- en: Setting up Slack alerting with Zabbix
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 Zabbix 设置 Slack 警报
- en: Setting up Microsoft Teams alerting with Zabbix
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 Zabbix 设置 Microsoft Teams 警报
- en: Using Telegram bots with Zabbix
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 Telegram 机器人与 Zabbix 集成
- en: Integrating Atlassian Opsgenie with Zabbix
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将 Atlassian Opsgenie 与 Zabbix 集成
- en: Let’s get started!
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们开始吧！
- en: Technical requirements
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: For this chapter, we are going to need our Zabbix server, preferably how we
    set it up throughout this book, though any Zabbix 7 server with some alerts on
    it will do.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 本章我们需要使用 Zabbix 服务器，最好是按照本书中提供的设置方式来配置，尽管任何安装了警报功能的 Zabbix 7 服务器也可以使用。
- en: 'We will also need access to a few external services, as follows:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还需要访问以下一些外部服务：
- en: 'Slack (free, to an extent):'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Slack（免费，有限制）：
- en: '[https://slack.com/](https://slack.com/)'
  id: totrans-15
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '[https://slack.com/](https://slack.com/)'
- en: 'Microsoft Teams (free, to an extent):'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Microsoft Teams（免费，有限制）：
- en: '[https://www.microsoft.com/microsoft-teams](https://www.microsoft.com/microsoft-teams)'
  id: totrans-17
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '[https://www.microsoft.com/microsoft-teams](https://www.microsoft.com/microsoft-teams)'
- en: 'Opsgenie (free, to an extent):'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Opsgenie（免费，有限制）：
- en: '[https://www.atlassian.com/software/opsgenie/](https://www.atlassian.com/software/opsgenie/)'
  id: totrans-19
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '[https://www.atlassian.com/software/opsgenie/](https://www.atlassian.com/software/opsgenie/)'
- en: 'Telegram (free):'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Telegram（免费）：
- en: '[https://telegram.org/](https://telegram.org/)'
  id: totrans-21
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '[https://telegram.org/](https://telegram.org/)'
- en: We will not cover how to set up the services themselves, only how to integrate
    them with Zabbix. Make sure you have set up the required service by following
    a guide and that you have some knowledge of the services in general.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不会介绍如何设置这些服务本身，仅介绍如何将它们与 Zabbix 集成。确保你已按照指南设置了所需的服务，并对这些服务有一定的了解。
- en: Setting up Slack alerting with Zabbix
  id: totrans-23
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 Zabbix 设置 Slack 警报
- en: Slack is a widely used tool for easy text messaging, voice/video chat, and collaboration.
    In this recipe, we will learn how to use Zabbix Slack integration to send our
    Zabbix problem information to Slack so that we can gain a good overview of issues.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: Slack 是一个广泛使用的工具，用于简单的文本消息、语音/视频聊天和协作。在本章中，我们将学习如何使用 Zabbix 的 Slack 集成功能将 Zabbix
    问题信息发送到 Slack，从而能更好地了解问题概况。
- en: Getting ready
  id: totrans-25
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Make sure you have Slack set up. You can go to [https://slack.com/intl/en-in/](https://slack.com/intl/en-in/)
    and set it up for free there. We will also need a Zabbix server with some active
    problems.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 确保你已设置好 Slack。你可以访问 [https://slack.com/intl/en-in/](https://slack.com/intl/en-in/)
    并在那里免费设置。我们还需要一个有一些活跃问题的 Zabbix 服务器。
- en: How to do it…
  id: totrans-27
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作…
- en: 'Once you have set up and opened Slack, you should see the following page:'
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦你设置并打开 Slack，你应该能看到以下页面：
- en: '![Figure 9.1 – Slack default page](img/B19803_09_01.jpg)'
  id: totrans-29
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.1 – Slack 默认页面](img/B19803_09_01.jpg)'
- en: Figure 9.1 – Slack default page
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.1 – Slack 默认页面
- en: 'Let’s create a new channel for our Zabbix notifications by clicking the **+
    Add channels** button. Then, from the dropdown that appears, click **Create a**
    **new channel**:'
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们通过点击 **+ 添加频道** 按钮来创建一个新的 Zabbix 通知频道。然后，在下拉菜单中点击 **创建一个新频道**：
- en: '![Figure 9.2 – Slack, Create a channel window](img/B19803_09_02.jpg)'
  id: totrans-32
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.2 – Slack 创建频道窗口](img/B19803_09_02.jpg)'
- en: Figure 9.2 – Slack, Create a channel window
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.2 – Slack 创建频道窗口
- en: 'Click the **Next** button. Then, on the next window, click the **Create** button
    to make this a public (or private) channel:'
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **Next** 按钮。然后，在下一个窗口中，点击 **Create** 按钮以创建一个公开（或私人）频道：
- en: '![Figure 9.3 – Slack, setting the new channel visibility](img/B19803_09_03.jpg)'
  id: totrans-35
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.3 – Slack，设置新频道可见性](img/B19803_09_03.jpg)'
- en: Figure 9.3 – Slack, setting the new channel visibility
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.3 – Slack，设置新频道可见性
- en: You’ll be presented with one more step to add either specific or all people
    within your Slack to the new channel. In my test, I’ll add everyone, so I’ll just
    click on **Done**.
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您将看到最后一步，选择将特定人员或所有人员添加到新频道。在我的测试中，我会添加所有人，所以我只需点击**完成**。
- en: '![Figure 9.4 – Slack, Add people window](img/B19803_09_04.jpg)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.4 – Slack，添加人员窗口](img/B19803_09_04.jpg)'
- en: Figure 9.4 – Slack, Add people window
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.4 – Slack，添加人员窗口
- en: 'Now, navigate to the following link to create a Slack bot for working with
    Zabbix: [https://api.slack.com/apps](https://api.slack.com/apps).'
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，访问以下链接创建一个与 Zabbix 配合使用的 Slack 机器人：[https://api.slack.com/apps](https://api.slack.com/apps)。
- en: 'You will see the **Create New App** option on this page. Click on it, which
    brings us here:'
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您将在此页面上看到**创建新应用程序**选项。点击它，带您进入此页面：
- en: '![Figure 9.5 – Slack, API Create an app page](img/B19803_09_05.jpg)'
  id: totrans-42
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.5 – Slack，API 创建应用程序页面](img/B19803_09_05.jpg)'
- en: Figure 9.5 – Slack, API Create an app page
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.5 – Slack，API 创建应用程序页面
- en: After clicking the **Create New App** button, we have to click on **From scratch**.
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**创建新应用程序**按钮后，我们需要点击**从头开始**。
- en: 'Then, we’ll see a pop-up window where we can set up our new Slack bot:'
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们将看到一个弹出窗口，可以设置我们的新 Slack 机器人：
- en: '![Figure 9.6 – Slack, API Name app & choose workspace window](img/B19803_09_06.jpg)'
  id: totrans-46
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.6 – Slack，API 名称应用程序及选择工作区窗口](img/B19803_09_06.jpg)'
- en: Figure 9.6 – Slack, API Name app & choose workspace window
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.6 – Slack，API 名称应用程序及选择工作区窗口
- en: 'Click on **Create App**. This will take you to the **Basic Information** page.
    On this page, click on **Bots**, as highlighted in the following screenshot:'
  id: totrans-48
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**创建应用程序**。这将带您到**基本信息**页面。在此页面上，点击**机器人**，如以下截图所示：
- en: '![Figure 9.7 – Slack, API Add features and functionality page](img/B19803_09_07.jpg)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.7 – Slack，API 添加功能和功能页面](img/B19803_09_07.jpg)'
- en: Figure 9.7 – Slack, API Add features and functionality page
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.7 – Slack，API 添加功能和功能页面
- en: This will take you to the new app’s **App Home** page. On the left-hand side
    of the page, click the **OAuth &** **Permissions** option.
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这将带您到新应用程序的**应用主页**。在页面的左侧，点击**OAuth &** **权限**选项。
- en: 'Scroll down to **Scopes** and click on **Add an** **OAuth Scope**:'
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向下滚动至**范围**并点击**添加 OAuth 范围**：
- en: '![Figure 9.8 – Slack, API scopes](img/B19803_09_08.jpg)'
  id: totrans-53
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.8 – Slack，API 范围](img/B19803_09_08.jpg)'
- en: Figure 9.8 – Slack, API scopes
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.8 – Slack，API 范围
- en: 'From the drop-down menu, click on **chat:write** to allow our bot to write
    to a channel:'
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从下拉菜单中，点击**chat:write**，以允许我们的机器人向频道发送消息：
- en: "![Figure 9.9 – Slack, API Add an OAuth Scope dropdow\uFEFFn](img/B19803_09_09.jpg)"
  id: totrans-56
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.9 – Slack，API 添加 OAuth 范围下拉菜单](img/B19803_09_09.jpg)'
- en: Figure 9.9 – Slack, API Add an OAuth Scope dropdown
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.9 – Slack，API 添加 OAuth 范围下拉菜单
- en: Do the same for **im:write** and **groups:write**.
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对**im:write**和**groups:write**做同样的操作。
- en: 'Scroll back up and click on the **Install to Workspace** button to finish setting
    up this app:'
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向上滚动并点击**安装到工作区**按钮以完成应用程序的设置：
- en: '![Figure 9.10 – Slack, API Install to Workspace button](img/B19803_09_10.jpg)'
  id: totrans-60
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.10 – Slack，API 安装到工作区按钮](img/B19803_09_10.jpg)'
- en: Figure 9.10 – Slack, API Install to Workspace button
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.10 – Slack，API 安装到工作区按钮
- en: Next, you will see a pop-up message. Click the green **Allow** button that appears.
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，您将看到一个弹出消息。点击出现的绿色**允许**按钮。
- en: 'After clicking **Allow**, you will see your new token. Copy the token by clicking
    the **Copy** button:'
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**允许**后，您将看到新的令牌。通过点击**复制**按钮复制令牌：
- en: '![Figure 9.11 – Slack, API Our new Bot User OAuth Token](img/B19803_09_11.jpg)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.11 – Slack，API 我们的新 Bot 用户 OAuth 令牌](img/B19803_09_11.jpg)'
- en: Figure 9.11 – Slack, API Our new Bot User OAuth Token
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.11 – Slack，API 我们的新 Bot 用户 OAuth 令牌
- en: 'Lastly, add your bot to the **# zabbix-notifications** channel by going back
    to your Slack channel, clicking on the members in the top-right corner, and selecting
    **Integrations**:'
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，通过返回 Slack 频道，点击右上角的成员，选择**集成**，将您的机器人添加到**# zabbix-notifications**频道：
- en: '![Figure 9.12 – Slack, connect an app to a channel](img/B19803_09_12.jpg)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.12 – Slack，连接应用程序到频道](img/B19803_09_12.jpg)'
- en: Figure 9.12 – Slack, connect an app to a channel
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.12 – Slack，连接应用程序到频道
- en: Click on **Add** **an App**.
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**添加** **应用程序**。
- en: 'Simply add **Zabbix-Alert-Bot** by clicking the white **Add** button:'
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 只需点击白色的**添加**按钮，添加**Zabbix-Alert-Bot**：
- en: '![Figure 9.13 – Slack, connect an app with a bot](img/B19803_09_13.jpg)'
  id: totrans-71
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.13 – Slack，连接应用程序与机器人](img/B19803_09_13.jpg)'
- en: Figure 9.13 – Slack, connect an app with a bot
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.13 – Slack，连接应用程序与机器人
- en: Now, navigate to your Zabbix frontend and go to **Alerts** | **Media types**.
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，导航到你的Zabbix前端，进入**警报** | **媒体类型**。
- en: 'Click on **Slack** to edit the Slack media type. You will see a whole list
    of preconfigured parameters. We need to paste our OAuth token into the **bot_token**
    parameter, like this:'
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**Slack**来编辑Slack媒体类型。你将看到一整套预配置的参数。我们需要将OAuth令牌粘贴到**bot_token**参数中，如下所示：
- en: '![Figure 9.14 – Zabbix, Slack media type Edit page](img/B19803_09_14.jpg)'
  id: totrans-75
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.14 – Zabbix，Slack媒体类型编辑页面](img/B19803_09_14.jpg)'
- en: Figure 9.14 – Zabbix, Slack media type Edit page
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.14 – Zabbix，Slack媒体类型编辑页面
- en: Also, make sure **Media type** is enabled by scrolling all the way to the bottom.
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 同时，确保通过滚动到页面底部启用**媒体类型**。
- en: On the **Message templates** tab, we already have five message types configured.
    We can edit these to our liking if we would like to do so.
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**消息模板**标签页下，我们已经配置了五种消息类型。如果需要，我们可以根据自己的需求进行编辑。
- en: '![Figure 9.15 – Zabbix, media type Slack Edit page for message types](img/B19803_09_15.jpg)'
  id: totrans-79
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.15 – Zabbix，Slack消息类型的媒体类型编辑页面](img/B19803_09_15.jpg)'
- en: Figure 9.15 – Zabbix, media type Slack Edit page for message types
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.15 – Zabbix，Slack消息类型的媒体类型编辑页面
- en: You can now click on **Update** to save the changes.
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，你可以点击**更新**来保存更改。
- en: 'Now, let’s create a new user group for our media types by navigating to **Users**
    | **User groups** and clicking the **Create user group** button in the top-right
    corner. Add the following user group:'
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，通过导航到**用户** | **用户组**并点击右上角的**创建用户组**按钮，创建一个新的用户组来为我们的媒体类型提供支持。添加以下用户组：
- en: '![Figure 9.16 – Zabbix, Create user group page for the External services group](img/B19803_09_16.jpg)'
  id: totrans-83
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.16 – Zabbix，创建外部服务组的用户组页面](img/B19803_09_16.jpg)'
- en: Figure 9.16 – Zabbix, Create user group page for the External services group
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.16 – Zabbix，创建外部服务组的用户组页面
- en: 'Click on the **Host permissions** tab and then click on **Select**. Make sure
    that you select all the groups and subgroups with at least **Read** permissions,
    like so:'
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**主机权限**标签，然后点击**选择**。确保选择所有具有至少**读取**权限的组和子组，如下所示：
- en: '![Figure 9.17 – Zabbix, Create user group Host permissions for the External
    services group](img/B19803_09_17.jpg)'
  id: totrans-86
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.17 – Zabbix，创建外部服务组的用户组主机权限](img/B19803_09_17.jpg)'
- en: Figure 9.17 – Zabbix, Create user group Host permissions for the External services
    group
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.17 – Zabbix，创建外部服务组的用户组主机权限
- en: Important note
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 重要说明
- en: When applying permissions to the user group, make sure that you only add the
    host groups you want to receive notifications from. In my lab and even production
    environments, I add all groups, but sometimes, we want to filter the notifications
    down. One way to do this is to use different user groups and users so that you
    only receive notifications from host groups in certain channels, although Actions
    are also a great way to do this. For a more in-depth look into Zabbix user permissions
    and triggers, check out [*Chapter 2*](B19803_02.xhtml#_idTextAnchor171), *Getting
    Things Ready with Zabbix User Management*, and [*Chapter 4*](B19803_04.xhtml#_idTextAnchor601),
    *Working with Triggers and* *Alerts*, respectively.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 在为用户组应用权限时，请确保只添加你希望接收通知的主机组。在我的实验室环境和生产环境中，我通常会添加所有组，但有时我们希望筛选通知。实现这一点的一种方法是使用不同的用户组和用户，这样你就只会在特定的频道接收来自某些主机组的通知，尽管使用动作也是一种很好的方法。欲了解更多关于Zabbix用户权限和触发器的内容，请查看[*第二章*](B19803_02.xhtml#_idTextAnchor171)，*使用Zabbix用户管理做好准备*，以及[*第四章*](B19803_04.xhtml#_idTextAnchor601)，*使用触发器和警报*。
- en: Now, click on the blue **Add** button and finish creating this user group.
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，点击蓝色的**添加**按钮，完成用户组的创建。
- en: Next, navigate to **Users** | **User** to create a Slack user. Click on the
    blue **Create user** button in the top-right corner.
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，导航到**用户** | **用户**来创建一个Slack用户。在右上角点击蓝色的**创建用户**按钮。
- en: 'Add the following user to your Zabbix server and make sure to give it a secure
    password:'
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将以下用户添加到你的Zabbix服务器，并确保为其设置一个安全的密码：
- en: '![Figure 9.18 – Zabbix Create user page for the Slack user](img/B19803_09_18.jpg)'
  id: totrans-93
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.18 – Zabbix 为Slack用户创建的用户页面](img/B19803_09_18.jpg)'
- en: Figure 9.18 – Zabbix Create user page for the Slack user
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.18 – Zabbix 为Slack用户创建的用户页面
- en: Tip
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 提示
- en: When creating users for things such as alerting or just API access, it is best
    practice to also add the user to a user group that disables the frontend access.
    This is why we added the **No access to the frontend** group here.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 在为警报或API访问等创建用户时，最佳做法是将用户添加到一个禁用前端访问的用户组中。这就是我们在这里添加**无前端访问**组的原因。
- en: 'Now, click on the **Media** tab and click on the underlined **Add** text. We
    will add the following media to this user:'
  id: totrans-97
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，点击**媒体**标签，然后点击带下划线的**添加**文字。我们将为此用户添加以下媒体：
- en: "![Figure 9.19 – Zabbix Create user media page for the Slack user\uFEFF](img/B19803_09_19.jpg)"
  id: totrans-98
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.19 – Zabbix 为 Slack 用户创建用户媒体页面](img/B19803_09_19.jpg)'
- en: Figure 9.19 – Zabbix Create user media page for the Slack user
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.19 – Zabbix 为 Slack 用户创建用户媒体页面
- en: 'All users will also need a user role. To add it, go to **Permissions** and
    add the following:'
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 所有用户还需要一个用户角色。要添加它，前往**权限**并添加以下内容：
- en: '![Figure 9.20 – Zabbix Create user media page for the Slack user, Permissions](img/B19803_09_20.jpg)'
  id: totrans-101
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.20 – Zabbix 为 Slack 用户创建用户媒体页面，权限](img/B19803_09_20.jpg)'
- en: Figure 9.20 – Zabbix Create user media page for the Slack user, Permissions
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.20 – Zabbix 为 Slack 用户创建用户媒体页面，权限
- en: Important note
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 重要说明
- en: For convenience, we are adding the user in the **Super admin** user role in
    the example. This overrides the read-only permissions we assigned to the **External
    Services** user group. For security reasons, you might want to limit the permissions
    by choosing a **User** or **Admin** role for your user, which will adhere to the
    host group permissions we assigned earlier.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 为了方便，我们在示例中将该用户添加到**超级管理员**角色中。这会覆盖我们为**外部服务**用户组分配的只读权限。出于安全原因，你可能希望通过为用户选择**用户**或**管理员**角色来限制权限，这将遵循我们之前为主机组分配的权限。
- en: Click on the blue **Add** button at the bottom of the window and then on the
    blue **Add** button at the bottom of the page.
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击窗口底部的蓝色**添加**按钮，然后点击页面底部的蓝色**添加**按钮。
- en: 'We will also need to add a macro to **Administration** | **Macros**. Let’s
    add the following macro, which contains your Zabbix URL:'
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们还需要在**管理** | **宏**中添加一个宏。让我们添加以下宏，其中包含你的 Zabbix URL：
- en: '![Figure 9.21 – Zabbix Administration | Macros page with Zabbix URL](img/B19803_09_21.jpg)'
  id: totrans-107
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.21 – Zabbix 管理 | 带有 Zabbix URL 的宏页面](img/B19803_09_21.jpg)'
- en: Figure 9.21 – Zabbix Administration | Macros page with Zabbix URL
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.21 – Zabbix 管理 | 带有 Zabbix URL 的宏页面
- en: Click on the blue **Update** button.
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击蓝色的**更新**按钮。
- en: Last but not least, go to **Alerts** | **Actions**, and on the **Trigger Actions**
    page, click on the blue **Create** **action** button.
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，前往**警报** | **操作**，在**触发操作**页面上，点击蓝色的**创建** **操作**按钮。
- en: Use **Notify external services** for the name of the action. We won’t set up
    any conditions for this example, but it’s recommended to do so in production environments.
    If you do not set any conditions, all problems will be matched on this action.
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用**通知外部服务**作为操作的名称。我们不会为这个示例设置任何条件，但建议在生产环境中设置。如果不设置任何条件，所有问题都将匹配此操作。
- en: 'Go to **Operations** and add the following operations:'
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 前往**操作**并添加以下操作：
- en: '![Figure 9.22 – Zabbix, Create action operations page for Notify external services](img/B19803_09_22.jpg)'
  id: totrans-113
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.22 – Zabbix，为“通知外部服务”创建操作页面](img/B19803_09_22.jpg)'
- en: Figure 9.22 – Zabbix, Create action operations page for Notify external services
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.22 – Zabbix，为“通知外部服务”创建操作页面
- en: Tip
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 提示
- en: We could also use **Notify all involved** here to send a message to all the
    users involved in the **Operations** steps.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 我们也可以在这里使用**通知所有相关人员**，向所有参与**操作**步骤的用户发送消息。
- en: 'Now, click on the blue **Add** button. With that, you’re done. You can now
    view any new problems (once they are generated by Zabbix) in your Slack channel:'
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，点击蓝色的**添加**按钮。完成后，你就可以在 Slack 渠道中查看任何新生成的问题（由 Zabbix 生成）：
- en: "![Figure 9.23 – Slack notification sent from our Zabbix \uFEFF\uFEFFserver](img/B19803_09_23.jpg)"
  id: totrans-118
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.23 – 从我们的 Zabbix 服务器发送的 Slack 通知](img/B19803_09_23.jpg)'
- en: Figure 9.23 – Slack notification sent from our Zabbix server
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.23 – 从我们的 Zabbix 服务器发送的 Slack 通知
- en: How it works…
  id: totrans-120
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的……
- en: Working with media types might be something completely new to you, or you might
    have done it in the past. Regardless, starting from Zabbix 5, the process has
    changed a bit. In the days of Zabbix before Zabbix 5, we had to find the right
    media types online or make them ourselves.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 使用媒体类型可能对你来说是完全新的，或者你过去可能做过。不管怎样，从 Zabbix 5 开始，过程稍有变化。在 Zabbix 5 之前的版本中，我们需要在线寻找合适的媒体类型或自己创建它们。
- en: Now, with Zabbix 7, we get a lot of preconfigured media types that are ready
    to be used. We just need to do the necessary setup and fill in the right information,
    just like we just did for Slack. We are then ready to send our problem-related
    information from Zabbix 7 to Slack every time a problem is created.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，借助 Zabbix 7，我们获得了许多预配置的媒体类型，已经可以直接使用。我们只需做必要的设置并填写正确的信息，就像我们刚刚为 Slack 所做的那样。然后，每当创建问题时，我们就可以将与问题相关的信息从
    Zabbix 7 发送到 Slack。
- en: 'In this recipe, we told our Zabbix server to only send problem-related information
    with a severity of warning or higher to Slack, as shown in the following screenshot:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 在本配方中，我们告诉 Zabbix 服务器只将严重性为警告或更高的与问题相关的信息发送到 Slack，如下图所示：
- en: '![Figure 9.24 – Zabbix Media page for the Slack user](img/9.24.jpg)'
  id: totrans-124
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.24 – Zabbix 媒体页面（Slack 用户）](img/9.24.jpg)'
- en: Figure 9.24 – Zabbix Media page for the Slack user
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.24 – Zabbix 媒体页面（Slack 用户）
- en: We can fully customize these severities, but we can also fully customize what
    severities we send to our Slack setup.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以完全自定义这些严重性级别，但我们也可以完全自定义将哪些严重性级别发送到我们的 Slack 设置中。
- en: 'What we configured in this recipe is called a **Zabbix webhook**. A problem
    gets created in Zabbix and this problem matches our configured criteria, such
    as its severity. Our action matches the problem, and the media type will then
    be executed by the **Action** operations and sent to the configured links:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在本章中配置的内容被称为**Zabbix webhook**。当 Zabbix 中创建一个问题，并且这个问题符合我们配置的标准（如其严重性）时，我们的操作与问题匹配，媒体类型将通过**Action**操作执行，并发送到配置的链接：
- en: '![Figure 9.25 – Zabbix Slack integration diagram](img/B19803_09_25.jpg)'
  id: totrans-128
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.25 – Zabbix Slack 集成示意图](img/B19803_09_25.jpg)'
- en: Figure 9.25 – Zabbix Slack integration diagram
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.25 – Zabbix Slack 集成示意图
- en: Zabbix sends the problem to the Slack API, and then the API processes the problem.
    Then, the app we configured in Slack posts the problem to our channel.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: Zabbix 将问题发送到 Slack API，然后 API 处理该问题。接着，我们在 Slack 中配置的应用程序将问题发布到我们的频道。
- en: Now that we’ve completed this recipe, we can view problems in Slack and keep
    an eye on our Zabbix alerts from there.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们已经完成了这个配置，可以在 Slack 中查看问题，并从那里监控我们的 Zabbix 告警。
- en: See also
  id: totrans-132
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: 'If you want to do more with this integration, check out the Slack API documentation.
    There’s a lot we can do with this API, and we can build a number of awesome apps/bots
    for our channels: [https://api.slack.com](https://api.slack.com)/.'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想进一步利用这个集成，查看 Slack API 文档。这个 API 可以做很多事情，我们可以为我们的频道构建一些非常棒的应用程序或机器人：[https://api.slack.com](https://api.slack.com)/。
- en: Setting up Microsoft Teams alerting with Zabbix
  id: totrans-134
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 Zabbix 设置 Microsoft Teams 告警
- en: The previous edition of this book was written during the COVID-19 pandemic.
    At that time, a lot of IT companies had been requested to make their employees
    work from home. Due to this, we noticed a rise in the use of Microsoft Teams and
    similar applications. Suddenly, a lot of companies started using Microsoft Teams
    and others to make working from home and collaboration easier. Even after the
    pandemic ended, this is still the case, which is why we added this recipe.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 本书的上一版是在 COVID-19 大流行期间编写的。当时，许多 IT 公司要求员工在家办公。因此，我们注意到 Microsoft Teams 和类似应用的使用量激增。突然间，很多公司开始使用
    Microsoft Teams 等工具，以便让远程工作和协作变得更加容易。即使在大流行结束后，这一趋势依然存在，这也是我们加入此配方的原因。
- en: Let’s learn how we can make working with Microsoft Teams even better by integrating
    our Zabbix alerting into it.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们学习如何通过将 Zabbix 告警集成到 Microsoft Teams 中，使工作变得更加高效。
- en: Getting ready
  id: totrans-137
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: We will need our Zabbix server to be able to create some problems for us. For
    this, you can use `lar-book-rocky` from our previous chapters or any Zabbix server
    that you prefer.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要 Zabbix 服务器能够为我们创建一些问题。为此，你可以使用之前章节中的 `lar-book-rocky`，或者使用任何你喜欢的 Zabbix
    服务器。
- en: We will also need general Microsoft Teams knowledge and, of course, Microsoft
    Teams itself set up and ready to go.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还需要具备基本的 Microsoft Teams 知识，当然，Microsoft Teams 本身也需要已经设置并准备就绪。
- en: How to do it…
  id: totrans-140
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作…
- en: 'Let’s start by opening our Microsoft Teams application on either Windows, macOS,
    or Linux and creating a new channel. Go to **Teams** and click on the three dots
    (**…**) next to your team name, as shown in the following screenshot:'
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们需要打开 Microsoft Teams 应用程序，无论是在 Windows、macOS 还是 Linux 上，然后创建一个新频道。进入**Teams**，点击团队名称旁边的三个点（**…**），如下图所示：
- en: "![Figure 9.26 – MS Teams, Add chan\uFEFFnel option](img/B19803_09_26.jpg)"
  id: totrans-142
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.26 – MS Teams，添加频道选项](img/B19803_09_26.jpg)'
- en: Figure 9.26 – MS Teams, Add channel option
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.26 – MS Teams，添加频道选项
- en: 'In the **Add channel** window, fill in the following information to create
    our new channel:'
  id: totrans-144
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**添加频道**窗口中，填写以下信息以创建我们的新频道：
- en: '![Figure 9.27 – MS Teams, Add channel window](img/B19803_09_27.jpg)'
  id: totrans-145
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.27 – MS Teams，添加频道窗口](img/B19803_09_27.jpg)'
- en: Figure 9.27 – MS Teams, Add channel window
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.27 – MS Teams，添加频道窗口
- en: Now, click the purple **Add** button to add the channel. Upon doing this, we
    will be able to see our new channel in the list.
  id: totrans-147
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，点击紫色的**添加**按钮以添加频道。完成后，我们将能够在列表中看到我们的新频道。
- en: 'Click on the three dots (**…**) next to your channel, as shown in the following
    screenshot:'
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击频道旁边的三个点（**...**），如下图所示：
- en: "![Figure 9.28 – MS Teams, Connect\uFEFFors option](img/B19803_09_28.jpg)"
  id: totrans-149
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.28 – MS Teams，连接器选项](img/B19803_09_28.jpg)'
- en: Figure 9.28 – MS Teams, Connectors option
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.28 – MS Teams，连接器选项
- en: We want to select the **Connectors** option from this drop-down menu. This allows
    us to add our Microsoft Teams connector to this channel.
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们想从这个下拉菜单中选择**连接器**选项。这将允许我们将 Microsoft Teams 连接器添加到此频道。
- en: 'We are using the search field here to find the official **Zabbix** **Webhook**
    connector:'
  id: totrans-152
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们在这里使用搜索字段来查找官方的**Zabbix** **Webhook**连接器：
- en: '![Figure 9.29 – MS Teams, Add connectors window](img/B19803_09_29.jpg)'
  id: totrans-153
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.29 – MS Teams，添加连接器窗口](img/B19803_09_29.jpg)'
- en: Figure 9.29 – MS Teams, Add connectors window
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.29 – MS Teams，添加连接器窗口
- en: "Click on the **Configure** button next to the **Zabbix Webhook** connector\
    \ to add this connector to our channel. This will open a pop-up window in which\
    \ you need to copy the webhook URL.![Figure 9.30 – MS Teams – Webhook U\uFEFF\
    RL](img/B19803_09_30.jpg)"
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**Zabbix Webhook**连接器旁边的**配置**按钮，将此连接器添加到我们的频道中。此操作将打开一个弹出窗口，您需要复制 webhook
    URL。[![图 9.30 – MS Teams – Webhook URL](img/B19803_09_30.jpg)]
- en: Figure 9.30 – MS Teams – Webhook URL
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.30 – MS Teams – Webhook URL
- en: Now, click the **Save** button. Upon doing this, you can close the pop-up window.
  id: totrans-157
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，点击**保存**按钮。完成此操作后，您可以关闭弹出窗口。
- en: Go to the Zabbix frontend and navigate to **Alerts** | **Media types**. Click
    on the **MS Teams** media type here.
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 前往 Zabbix 前端，导航到**警报** | **媒体类型**。点击这里的**MS Teams**媒体类型。
- en: 'Scroll down until you see **teams_endpoint**. Paste the URL you copied previously
    here, as shown in the following screenshot:'
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向下滚动，直到看到**teams_endpoint**。将之前复制的 URL 粘贴到这里，如下图所示：
- en: '![Figure 9.31 – Zabbix Alerts | Media types, edit MS Teams page](img/9.31.jpg)'
  id: totrans-160
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.31 – Zabbix 警报 | 媒体类型，编辑 MS Teams 页面](img/9.31.jpg)'
- en: Figure 9.31 – Zabbix Alerts | Media types, edit MS Teams page
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.31 – Zabbix 警报 | 媒体类型，编辑 MS Teams 页面
- en: Make sure to scroll down and enable the media type before saving.
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保向下滚动并启用媒体类型，然后再保存。
- en: Now, click the blue **Update** button at the bottom of the page.
  id: totrans-163
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，点击页面底部的蓝色**更新**按钮。
- en: 'If you didn’t follow the previous recipe, then create a new user group for
    our media types by navigating to **Users** | **User groups** and clicking the
    **Create user group** button in the top-right corner. Add the following user group:'
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果你没有按照之前的步骤操作，请通过导航到**用户** | **用户组**并点击右上角的**创建用户组**按钮来为我们的媒体类型创建一个新的用户组。添加以下用户组：
- en: "![Figure 9.32 – Zabbix, Create user group page, the External service\uFEFF\
    s group](img/B19803_09_16.jpg)"
  id: totrans-165
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.32 – Zabbix，创建用户组页面，外部服务组](img/B19803_09_16.jpg)'
- en: Figure 9.32 – Zabbix, Create user group page, the External services group
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.32 – Zabbix，创建用户组页面，外部服务组
- en: 'Click on the **Host permissions** tab and click on **Select**. Make sure that
    you select all the groups and subgroups with **Read** permissions. The **Permissions**
    tab will look like this:'
  id: totrans-167
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**主机权限**标签，然后点击**选择**。确保你选择了所有拥有**读取**权限的组和子组。**权限**标签将如下所示：
- en: '![Figure 9.33 – Zabbix, Create user group permissions page, the External services
    group](img/B19803_09_17.jpg)'
  id: totrans-168
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.33 – Zabbix，创建用户组权限页面，外部服务组](img/B19803_09_17.jpg)'
- en: Figure 9.33 – Zabbix, Create user group permissions page, the External services
    group
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.33 – Zabbix，创建用户组权限页面，外部服务组
- en: Now, click on the blue **Add** button and finish creating this user group.
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，点击蓝色的**添加**按钮，完成创建此用户组。
- en: 'Navigate to **Users** | **Users** and click on the blue **Create user** button
    in the top-right corner. Add the following user:'
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**用户** | **用户**，然后点击右上角的蓝色**创建用户**按钮。添加以下用户：
- en: '![Figure 9.34 – Zabbix Users | Users, Create new user page, MS Teams](img/B19803_09_34.jpg)'
  id: totrans-172
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.34 – Zabbix 用户 | 用户，创建新用户页面，MS Teams](img/B19803_09_34.jpg)'
- en: Figure 9.34 – Zabbix Users | Users, Create new user page, MS Teams
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.34 – Zabbix 用户 | 用户，创建新用户页面，MS Teams
- en: Tip
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 提示
- en: When creating users for things such as alerting or just API access, it is best
    practice to also add the user to a user group that disables the frontend access.
    This is why we added the **No access to the frontend** group here.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建用于警报或仅仅用于 API 访问的用户时，最佳做法是将该用户添加到一个禁用前端访问的用户组。因此我们在这里添加了**无前端访问**用户组。
- en: 'Next, go to the **Media** tab of the **Create user** page. Click the underlined
    **Add** text here to create the following media:'
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，进入**创建用户**页面的**媒体**标签。点击下划线的**添加**文本，在此创建以下媒体：
- en: '![Figure 9.35 – Zabbix Users | Users, Create new user media page, MS Teams](img/B19803_09_35.jpg)'
  id: totrans-177
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.35 – Zabbix 用户 | 用户，创建新用户媒体页面，MS Teams](img/B19803_09_35.jpg)'
- en: Figure 9.35 – Zabbix Users | Users, Create new user media page, MS Teams
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.35 – Zabbix 用户 | 用户，创建新用户媒体页面，MS Teams
- en: 'All users will also need a **User** role. To add it, go to **Permissions**
    and add the following:'
  id: totrans-179
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 所有用户还需要一个**用户**角色。要添加它，请进入**权限**并添加以下内容：
- en: '![Figure 9.36 – Zabbix – Create user media page, MS Teams user, Permissions](img/B19803_09_36.jpg)'
  id: totrans-180
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.36 – Zabbix – 创建用户媒体页面，MS Teams 用户，权限](img/B19803_09_36.jpg)'
- en: Figure 9.36 – Zabbix – Create user media page, MS Teams user, Permissions
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.36 – Zabbix – 创建用户媒体页面，MS Teams 用户，权限
- en: Important note
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 重要说明
- en: For convenience, we are adding the user in the **Super admin** user role in
    the example. This overrides the read-only permissions we assigned to the **External
    services** user group. To limit the permissions, choose a **User** or **Admin**
    role for your user, which will adhere to the host group permissions we assigned
    earlier.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 为了方便起见，我们在示例中将用户添加到了**超级管理员**角色。这覆盖了我们为**外部服务**用户组分配的只读权限。为了限制权限，请选择**用户**或**管理员**角色，这将遵守我们之前分配的主机组权限。
- en: Once you’ve filled in this information, click the blue **Add** button at the
    bottom of the window and then the blue **Add** button at the bottom of the page.
  id: totrans-184
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 填写完这些信息后，点击窗口底部的蓝色**添加**按钮，然后在页面底部再次点击蓝色**添加**按钮。
- en: 'If you didn’t follow the previous recipe, then you will also need to add a
    macro to **Administration** | **Macros** and add the following macro. This macro
    will contain your Zabbix URL:'
  id: totrans-185
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果你没有遵循之前的步骤，你还需要在**管理** | **宏**中添加一个宏，并添加以下宏。这个宏将包含你的 Zabbix URL：
- en: '![Figure 9.37 – Zabbix Administration | Macros page, Zabbix URL for use with
    MS Teams](img/9.37.jpg)'
  id: totrans-186
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.37 – Zabbix 管理 | 宏页面，适用于 MS Teams 的 Zabbix URL](img/9.37.jpg)'
- en: Figure 9.37 – Zabbix Administration | Macros page, Zabbix URL for use with MS
    Teams
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.37 – Zabbix 管理 | 宏页面，适用于 MS Teams 的 Zabbix URL
- en: Click on the blue **Update** button. You will also need to go to **Alerts**
    | **Actions** if you didn’t follow the previous recipe and, on the **Trigger Actions**
    page, click on the blue **Create** **action** button.
  id: totrans-188
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击蓝色的**更新**按钮。如果你没有遵循之前的步骤，还需要进入**警报** | **操作**，在**触发器操作**页面上点击蓝色的**创建** **操作**按钮。
- en: Use **Notify external services** for the name of the action. We won’t set up
    any conditions for this example, but it’s recommended to do so in production environments.
    If you do not set any conditions, all problems will be matched on this action.
  id: totrans-189
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用**通知外部服务**作为操作名称。我们不会在这个示例中设置任何条件，但建议在生产环境中设置条件。如果不设置任何条件，所有问题将匹配此操作。
- en: 'Go to **Operations** and add the following operations:'
  id: totrans-190
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入**操作**，并添加以下操作：
- en: '![Figure 9.38 – Zabbix, Create action Operations page, Notify external services
    for use with MS Teams](img/B19803_09_22.jpg)'
  id: totrans-191
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.38 – Zabbix，创建操作操作页面，通知外部服务以供 MS Teams 使用](img/B19803_09_22.jpg)'
- en: Figure 9.38 – Zabbix, Create action Operations page, Notify external services
    for use with MS Teams
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.38 – Zabbix，创建操作操作页面，通知外部服务以供 MS Teams 使用
- en: 'Now, click on the blue **Add** button and you’ll be done. You can now view
    new problems as they occur in your MS Teams channel:'
  id: totrans-193
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，点击蓝色的**添加**按钮，你就完成了。现在，你可以在 MS Teams 渠道中查看发生的新问题：
- en: "![Figure 9.39 – Zabbix problem in an \uFEFF\uFEFFMS Teams channel](img/B19803_09_39.jpg)"
  id: totrans-194
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.39 – Zabbix 问题在 MS Teams 渠道中](img/B19803_09_39.jpg)'
- en: Figure 9.39 – Zabbix problem in an MS Teams channel
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.39 – Zabbix 问题在 MS Teams 渠道中
- en: How it works…
  id: totrans-196
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的……
- en: Microsoft Teams works in about the same way as our Slack setup. A problem is
    created in the Zabbix server and, if that problem matches our configured conditions
    in Zabbix, we send that problem to our Microsoft Teams connector.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: Microsoft Teams 的工作方式大致与我们的 Slack 设置相同。Zabbix 服务器中创建一个问题，如果该问题符合我们在 Zabbix 中配置的条件，我们会将该问题发送到
    Microsoft Teams 连接器。
- en: 'For instance, we configured Zabbix so that it only sends problems with a severity
    of warning or higher to Microsoft Teams, as shown here:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，我们配置了 Zabbix，使其只将警告或更高严重性的故障发送到 Microsoft Teams，如下所示：
- en: '![Figure 9.40 – Zabbix Media page for MS Teams users](img/9.40.jpg)'
  id: totrans-199
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.40 – MS Teams 用户的 Zabbix 媒体页面](img/9.40.jpg)'
- en: Figure 9.40 – Zabbix Media page for MS Teams users
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.40 – MS Teams 用户的 Zabbix 媒体页面
- en: 'Our Microsoft Teams connector catches our problem and, since this connector
    is configured directly on our channel, it posts a notification to the channel:'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的 Microsoft Teams 连接器捕捉到我们的故障，并且由于这个连接器直接配置在我们的频道中，它会向频道发送通知：
- en: '![Figure 9.41 – Zabbix Microsoft Teams integration diagram](img/B19803_09_41.jpg)'
  id: totrans-202
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.41 – Zabbix Microsoft Teams 集成图](img/B19803_09_41.jpg)'
- en: Figure 9.41 – Zabbix Microsoft Teams integration diagram
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.41 – Zabbix Microsoft Teams 集成图
- en: Now, we can see our Teams notifications in our channel and keep up to date with
    all our Zabbix issues directly via Microsoft Teams.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以在我们的频道中看到 Teams 通知，并通过 Microsoft Teams 直接跟踪所有 Zabbix 问题。
- en: See also
  id: totrans-205
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参见
- en: 'For more information about the Zabbix webhook connector, check out this page:
    [https://appsource.microsoft.com/en-us/product/office/WA200001837?tab=Overview](https://appsource.microsoft.com/en-us/product/office/WA200001837?tab=Overview).'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 有关 Zabbix webhook 连接器的更多信息，请查看此页面：[https://appsource.microsoft.com/en-us/product/office/WA200001837?tab=Overview](https://appsource.microsoft.com/en-us/product/office/WA200001837?tab=Overview)。
- en: Using Telegram bots with Zabbix
  id: totrans-207
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 Telegram 机器人与 Zabbix
- en: If you love automation in chat applications, you might have heard of or used
    Telegram Messenger. Telegram has an extensive API and amazing bot features.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你喜欢聊天应用中的自动化，可能听说过或使用过 Telegram Messenger。Telegram 拥有强大的 API 和惊人的机器人功能。
- en: In this recipe, we are going to use a Telegram bot to create a Telegram group
    for Zabbix alerts. Let’s get started.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个教程中，我们将使用 Telegram 机器人为 Zabbix 警报创建一个 Telegram 群组。让我们开始吧。
- en: Getting ready
  id: totrans-210
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备就绪
- en: Make sure you have your Zabbix server ready. You can use `lar-book-rocky` or
    any Zabbix server capable of sending some alerts.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 确保你的 Zabbix 服务器已经准备好。你可以使用`lar-book-rocky`或任何能够发送警报的 Zabbix 服务器。
- en: It would be useful if you have some knowledge of Telegram, but I’ll be describing
    how to set it up step by step, even for those of you who have never used Telegram
    bots. Just make sure that you have the Telegram app on your computer and that
    your account is set up.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你对 Telegram 有一些了解，那会很有帮助，但我将逐步描述如何设置，即使你从未使用过 Telegram 机器人。只要确保你已经在电脑上安装了
    Telegram 应用，并且你的账户已经设置好。
- en: How to do it…
  id: totrans-213
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作…
- en: 'First, let’s create a new channel in Telegram. Click on the create icon next
    to the search box and select **New Group**:'
  id: totrans-214
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们来在 Telegram 中创建一个新频道。点击搜索框旁的创建图标，然后选择**新建组**：
- en: '![Figure 9.42 – Telegram New Group button](img/B19803_09_42.jpg)'
  id: totrans-215
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.42 – Telegram 新建组按钮](img/B19803_09_42.jpg)'
- en: Figure 9.42 – Telegram New Group button
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.42 – Telegram 新建组按钮
- en: 'Add another user – someone in your team who needs to get notifications as well.
    Fill in a group name and add a picture if you want:'
  id: totrans-217
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加另一个用户——你团队中需要接收通知的人员。如果需要，可以填写组名并添加图片：
- en: '![Figure 9.43 – Telegram New Group page](img/B19803_09_43.jpg)'
  id: totrans-218
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.43 – Telegram 新建组页面](img/B19803_09_43.jpg)'
- en: Figure 9.43 – Telegram New Group page
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.43 – Telegram 新建组页面
- en: Now, click on the **Create** button in the top-right corner. This will take
    you to the **New** **Group** page.
  id: totrans-220
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，点击右上角的**创建**按钮。这将带你进入**新建** **组**页面。
- en: 'Working with Telegram bots is made easy with the **@BotFather** user on Telegram.
    We can start creating our bot by searching for **botfather** and clicking the
    specified contact:'
  id: totrans-221
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 Telegram 机器人变得简单，只需通过 Telegram 上的**@BotFather**用户即可开始。我们可以通过搜索**botfather**并点击指定的联系人来创建我们的机器人：
- en: '![Figure 9.44 – Telegram, BotFather user](img/B19803_09_44.JPG)'
  id: totrans-222
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.44 – Telegram，BotFather 用户](img/B19803_09_44.JPG)'
- en: Figure 9.44 – Telegram, BotFather user
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.44 – Telegram，BotFather 用户
- en: 'Let’s start by issuing the **/start** command in the chat. This will provide
    you with a list of commands you can use:'
  id: totrans-224
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们首先在聊天中发出**/start**命令。这将为你提供一个可以使用的命令列表：
- en: '![Figure 9.45 – Telegram, BotFather user help list](img/B19803_09_45.jpg)'
  id: totrans-225
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.45 – Telegram，BotFather 用户帮助列表](img/B19803_09_45.jpg)'
- en: Figure 9.45 – Telegram, BotFather user help list
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.45 – Telegram，BotFather 用户帮助列表
- en: 'Now, let’s immediately create a new bot by typing **/newbot** into the **BotFather**
    chat. Press *Enter* to send your message. This will give us the following result:'
  id: totrans-227
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，让我们通过在**BotFather**聊天中输入**/newbot**来立即创建一个新的机器人。按下*Enter*键发送消息。这样我们就会得到如下结果：
- en: "![Figure 9.46 – Telegram, BotFather /newb\uFEFFot command](img/B19803_09_46.jpg)"
  id: totrans-228
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.46 – Telegram，BotFather /newbot 命令](img/B19803_09_46.jpg)'
- en: Figure 9.46 – Telegram, BotFather /newbot command
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.46 – Telegram，BotFather /newbot 命令
- en: 'Type in the new name of the bot; we will call it **zabbix-notfication-bot**.
    Press *Enter* to send your name:'
  id: totrans-230
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入机器人的新名称；我们将其命名为**zabbix-notfication-bot**。按*Enter*键发送您的名称：
- en: '![Figure 9.47 – Telegram, BotFather bot username](img/B19803_09_47.jpg)'
  id: totrans-231
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.47 – Telegram，BotFather 机器人用户名](img/B19803_09_47.jpg)'
- en: Figure 9.47 – Telegram, BotFather bot username
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.47 – Telegram，BotFather 机器人用户名
- en: 'You will then be asked what username you want to give the bot. I will use **lar_
    zbx_notfication_bot**:'
  id: totrans-233
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 系统将要求您为机器人指定用户名。我将使用**lar_ zbx_notfication_bot**：
- en: '![Figure 9.48 – Telegram, BotFather bot token](img/B19803_09_48.jpg)'
  id: totrans-234
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.48 – Telegram，BotFather 机器人令牌](img/B19803_09_48.jpg)'
- en: Figure 9.48 – Telegram, BotFather bot token
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.48 – Telegram，BotFather 机器人令牌
- en: Important note
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: Your bot username must be unique, so you can’t use **lar_zbx_ notification_bot**
    here. Pick a unique bot name that suits you and then use that name throughout
    this recipe.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 您的机器人用户名必须是唯一的，因此您不能在这里使用**lar_zbx_ notification_bot**。选择一个独特的机器人名称并在整个操作中使用该名称。
- en: Make sure that you save the **HTTP API** key somewhere safe.
  id: totrans-238
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保将**HTTP API**密钥保存在一个安全的地方。
- en: Let’s go back to our **Zabbix notifications** group and add our bot. Click on
    the group in your list of chats and click on the group’s name.
  id: totrans-239
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们回到我们的**Zabbix 通知**群组并添加我们的机器人。在聊天列表中点击该群组并点击群组名称。
- en: 'Now, click on **Add** to add the bot, as follows:'
  id: totrans-240
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，点击**添加**来添加机器人，如下所示：
- en: '![Figure 9.49 – Telegram, Add user to group button](img/B19803_09_49.jpg)'
  id: totrans-241
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.49 – Telegram，添加用户到群组按钮](img/B19803_09_49.jpg)'
- en: Figure 9.49 – Telegram, Add user to group button
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.49 – Telegram，添加用户到群组按钮
- en: 'Next, you will need to search for your bot using its username, as shown in
    the following screenshot:'
  id: totrans-243
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，您需要通过机器人的用户名搜索您的机器人，如下图所示：
- en: '![Figure 9.50 – Telegram, Add user to group page](img/B19803_09_50.jpg)'
  id: totrans-244
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.50 – Telegram，添加用户到群组页面](img/B19803_09_50.jpg)'
- en: Figure 9.50 – Telegram, Add user to group page
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.50 – Telegram，添加用户到群组页面
- en: Click on the bot and click on the **Add** button. With that, your bot has been
    added to the channel.
  id: totrans-246
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击机器人并点击**添加**按钮。这样，您的机器人就添加到频道中了。
- en: Let’s navigate to the Zabbix frontend and go to **Alerts** | **Media types**.
    Click on the media type titled **Telegram**.
  id: totrans-247
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们进入 Zabbix 前端并导航到**警报**|**媒体类型**。点击标题为**Telegram**的媒体类型。
- en: 'Here, you must add the **HTTP API** key you generated earlier to the **Token**
    field of our media type:'
  id: totrans-248
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在这里，您必须将之前生成的**HTTP API**密钥添加到我们媒体类型的**Token**字段中：
- en: '![Figure 9.51 – Zabbix Alerts | Media types, Edit Telegram Media type page](img/B19803_09_51.JPG)'
  id: totrans-249
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.51 – Zabbix 警报 | 媒体类型，编辑 Telegram 媒体类型页面](img/B19803_09_51.JPG)'
- en: Figure 9.51 – Zabbix Alerts | Media types, Edit Telegram Media type page
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.51 – Zabbix 警报 | 媒体类型，编辑 Telegram 媒体类型页面
- en: Also, scroll down and make sure this media type is enabled.
  id: totrans-251
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 同时，向下滚动并确保启用此媒体类型。
- en: Click on the blue **Update** button at the bottom of the page to finish editing
    the **Telegram** media type.
  id: totrans-252
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击页面底部的蓝色**更新**按钮以完成编辑**Telegram**媒体类型。
- en: 'Now, let’s go back to Telegram and add another bot to our group. Go to our
    new group and click on the group’s name. Click on **Add** to add the **IDBot**
    user:'
  id: totrans-253
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，让我们回到 Telegram，并将另一个机器人添加到我们的群组中。进入我们的新群组并点击群组名称。点击**添加**以添加**IDBot**用户：
- en: '![Figure 9.52 – The Add user page for a Telegram group](img/B19803_09_52.jpg)'
  id: totrans-254
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.52 – 添加用户页面（Telegram 群组）](img/B19803_09_52.jpg)'
- en: Figure 9.52 – The Add user page for a Telegram group
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.52 – 添加用户页面（Telegram 群组）
- en: Click on the user and click on **Add**. Then, navigate back to the Zabbix frontend.
  id: totrans-256
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击用户并点击**添加**。然后，返回 Zabbix 前端。
- en: 'If you haven’t followed any of the preceding recipes, create a new user group
    for our media types by navigating to **Users** | **User groups** and clicking
    the **Create user group** button in the top-right corner. Add the following user
    group:'
  id: totrans-257
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您没有按照之前的任何操作创建，请通过导航到**用户**|**用户组**并点击右上角的**创建用户组**按钮，创建一个新的用户组。添加以下用户组：
- en: "![Figure 9.53 – Zabbix Create user group page and the External services group\
    \ for use w\uFEFFith Telegram](img/B19803_09_53.jpg)"
  id: totrans-258
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.53 – Zabbix 创建用户组页面及用于 Telegram 的外部服务组](img/B19803_09_53.jpg)'
- en: Figure 9.53 – Zabbix Create user group page and the External services group
    for use with Telegram
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.53 – Zabbix 创建用户组页面及用于 Telegram 的外部服务组
- en: 'Click on the **Host permissions** tab and click on **Select**. Make sure that
    you select all the groups and subgroups with **Read** permissions, as follows:'
  id: totrans-260
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**主机权限**标签并点击**选择**。确保选择所有具有**读取**权限的组和子组，如下所示：
- en: '![Figure 9.54 – Zabbix Create user group Permissions page, External services
    for use with Telegram](img/B19803_09_54.jpg)'
  id: totrans-261
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.54 – Zabbix 创建用户组权限页面，供 Telegram 使用的外部服务](img/B19803_09_54.jpg)'
- en: Figure 9.54 – Zabbix Create user group Permissions page, External services for
    use with Telegram
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.54 – Zabbix 创建用户组权限页面，供 Telegram 使用的外部服务
- en: Now, click on the blue **Add** button and finish creating this user group.
  id: totrans-263
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，点击蓝色的**添加**按钮，完成创建此用户组。
- en: 'At this point, you must create a new user in Zabbix. However, to create this
    user, you are going to need our new group ID. Go back to Telegram and issue **/getgroupid@myidbot**
    in the group chat. You will receive a value that you will need to copy:'
  id: totrans-264
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 此时，你必须在 Zabbix 中创建一个新用户。然而，要创建这个用户，你需要我们新的组 ID。返回 Telegram 并在群聊中发送**/getgroupid@myidbot**。你将收到一个值，并需要复制该值：
- en: "![Figure 9.55 – Telegra\uFEFFm user group ID](img/B19803_09_55.jpg)"
  id: totrans-265
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.55 – Telegram 用户组 ID](img/B19803_09_55.jpg)'
- en: Figure 9.55 – Telegram user group ID
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.55 – Telegram 用户组 ID
- en: 'Let’s navigate to **Users** | **Users** and click the blue **Create user**
    button. Add the following user:'
  id: totrans-267
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，导航到**用户** | **用户**并点击蓝色的**创建用户**按钮。添加以下用户：
- en: '![Figure 9.56 – Zabbix Create user page, Telegram user](img/B19803_09_56.jpg)'
  id: totrans-268
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.56 – Zabbix 创建用户页面，Telegram 用户](img/B19803_09_56.jpg)'
- en: Figure 9.56 – Zabbix Create user page, Telegram user
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.56 – Zabbix 创建用户页面，Telegram 用户
- en: Tip
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 提示
- en: When creating users for things such as alerting or just API access, it is best
    practice to also add the user to a user group that disables the frontend access.
    This is why we added the **No access to the frontend** group here.
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 当为警报或 API 访问创建用户时，最佳实践是将该用户添加到一个禁用前端访问的用户组中。这就是为什么我们在这里添加了**无前端访问**组。
- en: 'Now, select the **Media** tab and click on the underlined **Add** text. Add
    the following media:'
  id: totrans-272
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，选择**媒体**标签并点击带下划线的**添加**文本。添加以下媒体：
- en: "![Figure 9.57 – Zabbix Create user media page, Telegram use\uFEFFr](img/B19803_09_57.jpg)"
  id: totrans-273
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.57 – Zabbix 创建用户媒体页面，Telegram 用户](img/B19803_09_57.jpg)'
- en: Figure 9.57 – Zabbix Create user media page, Telegram user
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.57 – Zabbix 创建用户媒体页面，Telegram 用户
- en: 'All users will also need a **User** role. To add it, go to **Permissions**
    and add the following:'
  id: totrans-275
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 所有用户还需要一个**用户**角色。要添加它，请进入**权限**并添加以下内容：
- en: '![Figure 9.58 – Zabbix Create user media page, Telegram user, Permissions](img/B19803_09_58.jpg)'
  id: totrans-276
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.58 – Zabbix 创建用户媒体页面，Telegram 用户，权限](img/B19803_09_58.jpg)'
- en: Figure 9.58 – Zabbix Create user media page, Telegram user, Permissions
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.58 – Zabbix 创建用户媒体页面，Telegram 用户，权限
- en: Important note
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: For convenience, we are adding the user in the **Super admin** user role in
    the example. This overrides the read-only permissions we assigned to the **External
    services** user group. To limit the permissions, choose a **User** or **Admin**
    role for your user, which will adhere to the host group permissions we assigned
    earlier.
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 为了方便起见，我们在示例中将用户添加到**超级管理员**用户角色中。这会覆盖我们分配给**外部服务**用户组的只读权限。若要限制权限，请为你的用户选择**用户**或**管理员**角色，这将遵循我们之前分配的主机组权限。
- en: Make sure that you add the group ID to the **Send to** field with the **–**
    text and click on the blue **Add** button.
  id: totrans-280
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保将组 ID 添加到**发送至**字段，并带有**–**文本，然后点击蓝色的**添加**按钮。
- en: If you haven’t followed the previous recipes, you will also need to go to **Alerts**
    | **Actions**. Then, on the **Trigger Actions** page, click on the blue **Create**
    **action** button.
  id: totrans-281
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果你没有按照之前的步骤操作，你还需要进入**警报** | **操作**。然后，在**触发操作**页面上，点击蓝色的**创建** **操作**按钮。
- en: Use **Notify external services** for the name of the action. We won’t set up
    any conditions for this example, but it’s recommended to do so in production environments.
    If you do not set any conditions, all problems will be matched on this action.
  id: totrans-282
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用**通知外部服务**作为操作名称。对于本示例，我们不会设置任何条件，但在生产环境中建议这么做。如果你不设置任何条件，所有问题都会匹配此操作。
- en: 'Go to **Operations** and add the following operations:'
  id: totrans-283
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入**操作**并添加以下操作：
- en: "![Figure 9.59 – Zabbix – Create action operations page, Notify external services\
    \ for use w\uFEFFith Telegram](img/B19803_09_22.jpg)"
  id: totrans-284
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.59 – Zabbix – 创建操作页面，通知外部服务以供 Telegram 使用](img/B19803_09_22.jpg)'
- en: Figure 9.59 – Zabbix – Create action operations page, Notify external services
    for use with Telegram
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.59 – Zabbix – 创建操作页面，通知外部服务以供 Telegram 使用
- en: 'Now, click on the blue **Add** button. With that, you’re done. You can now
    view new problems in your Telegram group:'
  id: totrans-286
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，点击蓝色的**添加**按钮。至此，你完成了。现在，你可以在你的 Telegram 群组中查看新的问题：
- en: "![Figure 9.60 – Zabbix notifica\uFEFF\uFEFFtions in Telegram chat](img/B19803_09_60.jpg)"
  id: totrans-287
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.60 – Zabbix 在 Telegram 聊天中通知](img/B19803_09_60.jpg)'
- en: Figure 9.60 – Zabbix notifications in Telegram chat
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.60 – Zabbix 在 Telegram 聊天中的通知
- en: How it works…
  id: totrans-289
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的…
- en: Slack apps, Microsoft connectors, and Telegram bots all work kind of the same
    in the end. There’s just another backend (API) provided by the respective companies,
    but the Zabbix webhook remains.
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: Slack 应用、Microsoft 连接器和 Telegram 机器人最终的工作方式都差不多。它们只是由各自公司提供了另一个后台（API），但 Zabbix
    的 webhook 保持不变。
- en: 'Now that we’ve added our Zabbix Telegram integration, we are receiving notifications
    in our Telegram group via the Zabbix webhook:'
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经添加了 Zabbix Telegram 集成，我们通过 Zabbix webhook 正在向我们的 Telegram 群组发送通知：
- en: '![Figure 9.61 – Zabbix Users | Users, Edit user media page](img/B19803_09_61.jpg)'
  id: totrans-292
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.61 – Zabbix 用户 | 用户，编辑用户媒体页面](img/B19803_09_61.jpg)'
- en: Figure 9.61 – Zabbix Users | Users, Edit user media page
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.61 – Zabbix 用户 | 用户，编辑用户媒体页面
- en: 'However, we will only receive these notifications if they match our configured
    settings. For instance, we’ve added our media type so that it only sends problems
    with a severity of warning or higher to our Telegram bot:'
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，只有当通知符合我们配置的设置时，我们才会接收到这些通知。例如，我们已经添加了媒体类型，以便只将严重性为警告或更高的问题发送到我们的 Telegram
    机器人：
- en: '![Figure 9.62 – Zabbix Telegram integration diagram](img/B19803_09_62.jpg)'
  id: totrans-295
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.62 – Zabbix Telegram 集成图示](img/B19803_09_62.jpg)'
- en: Figure 9.62 – Zabbix Telegram integration diagram
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.62 – Zabbix Telegram 集成图示
- en: Our Zabbix server is now sending our problems that match the **Action** conditions
    to our Telegram bot. The bot catches these problems successfully. Because our
    bot is in our Telegram group, the problems are posted in our Telegram group.
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们的 Zabbix 服务器将符合 **操作** 条件的问题发送到我们的 Telegram 机器人。机器人成功地捕获了这些问题。由于我们的机器人在
    Telegram 群组中，这些问题就被发布到我们的 Telegram 群组中。
- en: There’s more…
  id: totrans-298
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多…
- en: 'There’s a very cool Zabbix community group on Telegram. Now that you have Telegram,
    do not forget to join using the following invitation link: [https://t.me/ZabbixTech](https://t.me/ZabbixTech).'
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: Telegram 上有一个非常酷的 Zabbix 社区群组。既然你已经安装了 Telegram，别忘了通过以下邀请链接加入：[https://t.me/ZabbixTech](https://t.me/ZabbixTech)。
- en: See also
  id: totrans-300
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: 'Make sure that you check out all the awesome features Telegram bots have to
    offer. There’s a lot of information available directly from Telegram, and you
    can build amazing integrations by using them: https://core.telegram.org/bots.'
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 确保你查看 Telegram 机器人所提供的所有精彩功能。Telegram 提供了大量的直接信息，你可以通过使用它们构建出令人惊叹的集成：[https://core.telegram.org/bots](https://core.telegram.org/bots)。
- en: Integrating Atlassian Opsgenie with Zabbix
  id: totrans-302
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将 Atlassian Opsgenie 与 Zabbix 集成
- en: Atlassian Opsgenie is so much more than just another integration service for
    receiving notifications. Opsgenie offers us a call system, an SMS system, iOS
    and Android apps, two-way acknowledgments, and even an on-call schedule.
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: Atlassian Opsgenie 不仅仅是另一个接收通知的集成服务。Opsgenie 为我们提供了一个呼叫系统、短信系统、iOS 和 Android
    应用、双向确认，甚至还有值班安排。
- en: I think Opsgenie (and PagerDuty) are the best tools for replacing old-school
    call and SMS systems and fully integrating them with Zabbix. So, let’s get started
    with Opsgenie and see how we can get this amazing tool set up.
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: 我认为 Opsgenie（和 PagerDuty）是取代老式呼叫和短信系统并与 Zabbix 完全集成的最佳工具。所以，让我们从 Opsgenie 开始，看看如何设置这个惊人的工具。
- en: Getting ready
  id: totrans-305
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Ensure that your Zabbix server is ready. I’ll be using the `lar-book-rocky`
    server, but any Zabbix server ready to send problems should work.
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: 确保你的 Zabbix 服务器已准备好。我将使用 `lar-book-rocky` 服务器，但任何准备好发送问题的 Zabbix 服务器都可以使用。
- en: You are also going to need an Atlassian Opsgenie account with Opsgenie ready
    to go. This integration is slightly different from the previous examples, as we’ll
    also be utilizing some scripts.
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: 你还需要一个 Atlassian Opsgenie 账户，并且确保 Opsgenie 已经准备好。这次的集成与之前的示例稍有不同，因为我们还将使用一些脚本。
- en: I won’t show you how to create accounts, but we’ll start this recipe with Opsgenie
    ready to go.
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: 我不会展示如何创建账户，但我们将从 Opsgenie 已经准备好的状态开始这个方案。
- en: How to do it…
  id: totrans-309
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作…
- en: Let’s start by logging in to our Atlassian Opsgenie setup and going to **Settings**
    on the home page. From the left sidebar, click on **Notifications**.
  id: totrans-310
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，登录到我们的 Atlassian Opsgenie 设置，并进入首页的 **设置**。在左侧边栏中，点击 **通知**。
- en: 'Make sure that you add your email and phone number here by using the **+ Add
    email** and **+ Add phone number** buttons. We need these in order to receive
    notifications:'
  id: totrans-311
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保你通过使用 **+ 添加电子邮件** 和 **+ 添加电话号码** 按钮添加了你的电子邮件和电话号码。我们需要这些信息来接收通知：
- en: '![Figure 9.63 – Opsgenie profile, Contact methods](img/B19803_09_63.jpg)'
  id: totrans-312
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.63 – Opsgenie 配置文件，联系方式](img/B19803_09_63.jpg)'
- en: Figure 9.63 – Opsgenie profile, Contact methods
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.63 – Opsgenie 配置文件，联系方式
- en: Your settings will be automatically saved once you’ve added them, which means
    we can navigate away from **Settings** to **Teams** using the top bar.
  id: totrans-314
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦添加了设置，它们将自动保存，这意味着我们可以从**设置**导航到**团队**，通过顶部的导航栏进行切换。
- en: 'From the **Teams** tab, click on the blue **Add team** button in the top-right
    corner. Then, add the following information:'
  id: totrans-315
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**团队**标签页中，点击右上角的蓝色**添加团队**按钮。然后，添加以下信息：
- en: '![Figure 9.64 – Opsgenie, Add team window](img/B19803_09_64.jpg)'
  id: totrans-316
  prefs: []
  type: TYPE_IMG
  zh: '![图9.64 – Opsgenie，添加团队窗口](img/B19803_09_64.jpg)'
- en: Figure 9.64 – Opsgenie, Add team window
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.64 – Opsgenie，添加团队窗口
- en: I’ve set up our **Consultancy** team with two users that are part of this team.
    Click on the blue **Add** button at the bottom of the window to add the new team.
  id: totrans-318
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我已经为我们的**Consultancy**团队设置了两个用户，他们是该团队的一部分。点击窗口底部的蓝色**添加**按钮以添加新团队。
- en: This will take you to the new **Consultancy** team page. Click on **Integrations**
    and click on the blue **Add integration** button in the top-right corner.
  id: totrans-319
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这将带你到新的**Consultancy**团队页面。点击**集成**，然后点击右上角的蓝色**添加集成**按钮。
- en: 'When we use the search field to search for the Zabbix integration, we can see
    it immediately, as shown in the following screenshot:'
  id: totrans-320
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当我们使用搜索字段搜索Zabbix集成时，我们可以立即看到它，如下截图所示：
- en: '![Figure 9.65 – Opsgenie, Add integration page](img/B19803_09_65.jpg)'
  id: totrans-321
  prefs: []
  type: TYPE_IMG
  zh: '![图9.65 – Opsgenie，添加集成页面](img/B19803_09_65.jpg)'
- en: Figure 9.65 – Opsgenie, Add integration page
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.65 – Opsgenie，添加集成页面
- en: 'Click on the Zabbix integration. This will take you to the next page, where
    a **Name** and **API Key** value will be generated:'
  id: totrans-323
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击Zabbix集成。这将带你到下一个页面，生成**名称**和**API密钥**值：
- en: '![Figure 9.66 – Opsgenie, Add Zabbix integration page](img/B19803_09_66.JPG)'
  id: totrans-324
  prefs: []
  type: TYPE_IMG
  zh: '![图9.66 – Opsgenie，添加Zabbix集成页面](img/B19803_09_66.JPG)'
- en: Figure 9.66 – Opsgenie, Add Zabbix integration page
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.66 – Opsgenie，添加Zabbix集成页面
- en: Copy the **API Key** information and scroll to the bottom of the page. Here,
    click on the blue **Save** **integration** button.
  id: totrans-326
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 复制**API密钥**信息并滚动到底部。在这里，点击蓝色的**保存** **集成**按钮。
- en: Now, navigate to your Zabbix server CLI and execute the following code.
  id: totrans-327
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，导航到你的Zabbix服务器CLI，并执行以下代码。
- en: 'For RHEL-based systems, use the following:'
  id: totrans-328
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 对于基于RHEL的系统，请使用以下命令：
- en: '[PRE0]'
  id: totrans-329
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'We can now install the downloaded Zabbix Opsgenie plugin by issuing the following
    command(s):'
  id: totrans-330
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们现在可以通过执行以下命令来安装下载的Zabbix Opsgenie插件：
- en: 'For RHEL-based systems, use the following:'
  id: totrans-331
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 对于基于RHEL的系统，请使用以下命令：
- en: '[PRE1]'
  id: totrans-332
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'For Ubuntu systems, use the following:'
  id: totrans-333
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 对于Ubuntu系统，请使用以下命令：
- en: '[PRE2]'
  id: totrans-334
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Once you’ve installed the plugin, go to the Zabbix frontend. If you haven’t
    followed any of the previous recipes, create a new user group for our media types
    by navigating to **Users** | **User groups** and clicking the **Create user group**
    button in the top-right corner. Add the following user group:'
  id: totrans-335
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装插件后，前往Zabbix前端。如果你没有按照之前的步骤操作，请通过导航到**用户** | **用户组**并点击右上角的**创建用户组**按钮来为我们的媒体类型创建一个新的用户组。添加以下用户组：
- en: '![Figure 9.67 – Zabbix Create user group page, the External services group
    for use with Opsgenie](img/B19803_09_67.jpg)'
  id: totrans-336
  prefs: []
  type: TYPE_IMG
  zh: '![图9.67 – Zabbix 创建用户组页面，适用于Opsgenie的外部服务组](img/B19803_09_67.jpg)'
- en: Figure 9.67 – Zabbix Create user group page, the External services group for
    use with Opsgenie
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.67 – Zabbix 创建用户组页面，适用于Opsgenie的外部服务组
- en: 'Click on the **Permissions** tab and click on **Select**. Make sure that you
    select all the groups and subgroups with **Read** permissions, as follows:'
  id: totrans-338
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**权限**标签，然后点击**选择**。确保你选择了所有具有**读取**权限的组和子组，如下所示：
- en: '![Figure 9.68 – Zabbix Create user group permissions page, the External services
    group for use with Opsgenie](img/B19803_09_17.jpg)'
  id: totrans-339
  prefs: []
  type: TYPE_IMG
  zh: '![图9.68 – Zabbix 创建用户组权限页面，适用于Opsgenie的外部服务组](img/B19803_09_17.jpg)'
- en: Figure 9.68 – Zabbix Create user group permissions page, the External services
    group for use with Opsgenie
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.68 – Zabbix 创建用户组权限页面，适用于Opsgenie的外部服务组
- en: Now, click on the blue **Add** button and finish creating this user group.
  id: totrans-341
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，点击蓝色的**添加**按钮，完成创建这个用户组。
- en: 'Let’s navigate to **Users** | **Users** and click the blue **Create user**
    button. Add the following user:'
  id: totrans-342
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们导航到**用户** | **用户**，然后点击蓝色的**创建用户**按钮。添加以下用户：
- en: '![Figure 9.69 – Zabbix Create user page, Opsgenie user](img/B19803_09_69.jpg)'
  id: totrans-343
  prefs: []
  type: TYPE_IMG
  zh: '![图9.69 – Zabbix 创建用户页面，Opsgenie用户](img/B19803_09_69.jpg)'
- en: Figure 9.69 – Zabbix Create user page, Opsgenie user
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.69 – Zabbix 创建用户页面，Opsgenie用户
- en: Tip
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: 提示
- en: When creating users for things such as alerting or just API access, it is best
    practice to also add the user to a user group that disables the frontend access.
    This is why we added the **No access to the frontend** group here.
  id: totrans-346
  prefs: []
  type: TYPE_NORMAL
  zh: 在为警报或仅仅是 API 访问创建用户时，最佳实践是将用户添加到一个禁用前端访问的用户组中。这就是我们在这里添加**无前端访问**组的原因。
- en: 'All users will also need a **User** role. To add it, go to **Permissions**
    and add the following:'
  id: totrans-347
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 所有用户还需要一个**用户**角色。要添加此角色，请转到**权限**并添加以下内容：
- en: '![Figure 9.70 – Zabbix Create user media page, Opsgenie user, Permissions](img/B19803_09_70.jpg)'
  id: totrans-348
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.70 – Zabbix 创建用户媒体页面，Opsgenie 用户，权限](img/B19803_09_70.jpg)'
- en: Figure 9.70 – Zabbix Create user media page, Opsgenie user, Permissions
  id: totrans-349
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.70 – Zabbix 创建用户媒体页面，Opsgenie 用户，权限
- en: Important note
  id: totrans-350
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: For convenience, we are adding the user in the **Super admin** user role in
    the example. This overrides the read-only permissions we assigned to the **External
    services** user group. To limit the permissions, choose a **User** or **Admin**
    role for your user, which will adhere to the host group permissions we assigned
    earlier.
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: 为了方便起见，我们在示例中将用户添加到**超级管理员**用户角色中。这会覆盖我们为**外部服务**用户组分配的只读权限。为了限制权限，请为您的用户选择**用户**或**管理员**角色，这将遵循我们之前分配的主机组权限。
- en: For use in our action, we need to set up a script; to do so, navigate to **Alerts**
    | **Scripts** and click on **Create script** in the top-right corner.
  id: totrans-352
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了在我们的操作中使用，我们需要设置一个脚本；为此，请导航到**警报** | **脚本**，然后点击右上角的**创建脚本**。
- en: We’ll name the script **Opsgenie connector**. Set **Scope** to **Action operation**,
    **Type** to **Script**, and **Execute on** to **Zabbix server**.
  id: totrans-353
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将脚本命名为**Opsgenie connector**。将**范围**设置为**操作操作**，**类型**设置为**脚本**，并将**执行于**设置为**Zabbix
    服务器**。
- en: 'Paste the contents of the **/home/opsgenie/oec/opsgenie-zabbix/actionCommand.txt**
    file on the CLI into **Commands**. It should look like the following screenshot:'
  id: totrans-354
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将**/home/opsgenie/oec/opsgenie-zabbix/actionCommand.txt**文件的内容粘贴到 CLI 的**命令**中，应该像下面的截图一样：
- en: '![Figure 9.71 – Zabbix Opsgenie connector script](img/B19803_09_71.jpg)'
  id: totrans-355
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.71 – Zabbix Opsgenie 连接器脚本](img/B19803_09_71.jpg)'
- en: Figure 9.71 – Zabbix Opsgenie connector script
  id: totrans-356
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.71 – Zabbix Opsgenie 连接器脚本
- en: Don’t forget to press the **Add** button at the bottom of the page to save this
    new script.
  id: totrans-357
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 别忘了点击页面底部的**添加**按钮来保存这个新脚本。
- en: Next, navigate to **Alerts** | **Actions**. On the **Trigger actions** page,
    click on the blue **Create action** button in the top-right corner.
  id: totrans-358
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，导航到**警报** | **操作**。在**触发操作**页面上，点击右上角的蓝色**创建操作**按钮。
- en: 'In the **Name** field, type **Opsgenie action** and add the following items
    to **Conditions**:'
  id: totrans-359
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**名称**字段中，输入**Opsgenie 操作**，并将以下项目添加到**条件**中：
- en: '![Figure 9.72 – Zabbix Create new action page, Opsgenie action](img/B19803_09_72.JPG)'
  id: totrans-360
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.72 – Zabbix 创建新操作页面，Opsgenie 操作](img/B19803_09_72.JPG)'
- en: Figure 9.72 – Zabbix Create new action page, Opsgenie action
  id: totrans-361
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.72 – Zabbix 创建新操作页面，Opsgenie 操作
- en: Now, click on the **Operations** tab.
  id: totrans-362
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，点击**操作**标签页。
- en: Click the underlined **Add** text option next to **Operations** to add your
    first operation. For the **Operation** dropdown, select **Opsgenie connector**.
  id: totrans-363
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**操作**旁边下划线的**添加**文本选项以添加第一个操作。在**操作**下拉菜单中，选择**Opsgenie 连接器**。
- en: '![Figure 9.73 – Zabbix Create action operations window, Opsgenie connector](img/B19803_09_73.jpg)'
  id: totrans-364
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.73 – Zabbix 创建操作窗口，Opsgenie 连接器](img/B19803_09_73.jpg)'
- en: Figure 9.73 – Zabbix Create action operations window, Opsgenie connector
  id: totrans-365
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.73 – Zabbix 创建操作窗口，Opsgenie 连接器
- en: 'Repeat *step 24* for **Recovery operations** and **Update operations**. It
    should look like this:'
  id: totrans-366
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对**恢复操作**和**更新操作**重复*步骤 24*。它应该像这样：
- en: '![Figure 9.74 – Zabbix Create action operations page, Opsgenie action](img/B19803_09_74.jpg)'
  id: totrans-367
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.74 – Zabbix 创建操作页面，Opsgenie 操作](img/B19803_09_74.jpg)'
- en: Figure 9.74 – Zabbix Create action operations page, Opsgenie action
  id: totrans-368
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.74 – Zabbix 创建操作页面，Opsgenie 操作
- en: Click on the blue **Add** button at the bottom of the page to finish setting
    up the action.
  id: totrans-369
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击页面底部的蓝色**添加**按钮以完成操作设置。
- en: 'Now, you must configure the Opsgenie Zabbix integration. Edit the **config**
    file with the following command:'
  id: totrans-370
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，您必须配置 Opsgenie Zabbix 集成。使用以下命令编辑**config**文件：
- en: '[PRE3]'
  id: totrans-371
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Make sure that you edit the **apiKey**, **command_url**, **user**, and **password**
    lines, as shown in the following screenshot:'
  id: totrans-372
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保编辑**apiKey**、**command_url**、**user**和**password**行，如下所示的截图所示：
- en: '![Figure 9.75 – Opsgenie config.json file](img/B19803_09_75.jpg)'
  id: totrans-373
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.75 – Opsgenie config.json 文件](img/B19803_09_75.jpg)'
- en: Figure 9.75 – Opsgenie config.json file
  id: totrans-374
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.75 – Opsgenie config.json 文件
- en: Important note
  id: totrans-375
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: You will need to edit **baseUrl** if you are not located in the United States.
    I am in Europe, so I changed it to [https://api.eu.opsgenie.com](https://api.eu.opsgenie.com).
  id: totrans-376
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你不在美国，你需要编辑 **baseUrl**。我在欧洲，所以我将其更改为 [https://api.eu.opsgenie.com](https://api.eu.opsgenie.com)。
- en: 'That’s it! You can now see your alerts coming in and acknowledge them from
    Opsgenie:'
  id: totrans-377
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 就这些！现在你可以看到警报进入并在 Opsgenie 中确认它们：
- en: "![Figure 9\uFEFF\uFEFF.76 – Opsgenie alert from Zabbix](img/B19803_09_76.jpg)"
  id: totrans-378
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.76 – 来自 Zabbix 的 Opsgenie 警报](img/B19803_09_76.jpg)'
- en: Figure 9.76 – Opsgenie alert from Zabbix
  id: totrans-379
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.76 – 来自 Zabbix 的 Opsgenie 警报
- en: How it works…
  id: totrans-380
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的…
- en: 'When an alert is created in Zabbix, it is sent to Opsgenie via the Zabbix integration.
    This integration utilizes the Opsgenie API to catch our Zabbix information and
    send back a reply if required. This way, we have two-way communication between
    the two applications:'
  id: totrans-381
  prefs: []
  type: TYPE_NORMAL
  zh: 当 Zabbix 中创建警报时，它会通过 Zabbix 集成发送到 Opsgenie。这个集成利用了 Opsgenie API 来获取我们的 Zabbix
    信息，并在需要时发送回回复。通过这种方式，我们在两个应用之间实现了双向通信：
- en: '![Figure 9.77 – Opsgenie setup diagram](img/B19803_09_77.jpg)'
  id: totrans-382
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.77 – Opsgenie 设置图](img/B19803_09_77.jpg)'
- en: Figure 9.77 – Opsgenie setup diagram
  id: totrans-383
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.77 – Opsgenie 设置图
- en: 'Opsgenie is an amazing tool that can take several tasks away from your Zabbix
    server. I’ve used it in the past to migrate away from another monitoring tool
    to Zabbix. Opsgenie makes it easy to receive alerts from our products and centralize
    notifications:'
  id: totrans-384
  prefs: []
  type: TYPE_NORMAL
  zh: Opsgenie 是一款出色的工具，可以将多个任务从 Zabbix 服务器中移除。我曾经使用它将监控工具从另一个平台迁移到 Zabbix。Opsgenie
    让我们轻松接收来自产品的警报并集中管理通知：
- en: "![Figure 9.78 – Opsgenie setup example, inspir\uFEFFed by Wadie](img/B19803_09_78.jpg)"
  id: totrans-385
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.78 – Opsgenie 设置示例，灵感来自 Wadie](img/B19803_09_78.jpg)'
- en: Figure 9.78 – Opsgenie setup example, inspired by Wadie
  id: totrans-386
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.78 – Opsgenie 设置示例，灵感来自 Wadie
- en: Another great feature of Atlassian Opsgenie is the integration it offers with
    other Atlassian products. We can build a setup like the one shown in the preceding
    diagram to integrate all the products used in our company.
  id: totrans-387
  prefs: []
  type: TYPE_NORMAL
  zh: Atlassian Opsgenie 的另一个伟大功能是它与其他 Atlassian 产品的集成。我们可以建立一个类似前面图示的设置，将公司中使用的所有产品进行集成。
- en: There’s more…
  id: totrans-388
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多…
- en: 'Opsgenie doesn’t just allow us to send notifications. It also enables us to
    define entire on-call schedules within the product, making it super easy for us
    to create schedules within the program, where Zabbix might be a bit too static.
    Check out the following link for more information about how to do that:'
  id: totrans-389
  prefs: []
  type: TYPE_NORMAL
  zh: Opsgenie 不仅仅允许我们发送通知。它还使我们能够在产品内定义完整的值班时间表，这让我们在程序中创建时间表变得非常简单，而 Zabbix 在这方面可能有些静态。请查看以下链接，了解如何操作：
- en: '[https://support.atlassian.com/opsgenie/docs/manage-on-call-schedules-and-rotations/](https://support.atlassian.com/opsgenie/docs/manage-on-call-schedules-and-rotations/)'
  id: totrans-390
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://support.atlassian.com/opsgenie/docs/manage-on-call-schedules-and-rotations/](https://support.atlassian.com/opsgenie/docs/manage-on-call-schedules-and-rotations/)'
- en: Furthermore, there are also competitive products that integrate just as well
    as Opsgenie. PagerDuty is one of these, with native Zabbix integration. It has
    a similar feature set and it all boils down to preference, other software we might
    already have, and… price!
  id: totrans-391
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，也有一些竞争产品与 Opsgenie 一样集成得很好。PagerDuty 就是其中之一，提供原生的 Zabbix 集成。它具有类似的功能集，最终的选择取决于个人偏好、我们可能已经拥有的其他软件，以及…
    价格！
