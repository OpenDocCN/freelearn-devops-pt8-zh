- en: Management Tools
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 管理工具
- en: 'In this chapter, we will cover:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将介绍：
- en: Auditing your AWS account
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 审计您的 AWS 账户
- en: Recommendations with Trusted Advisor
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用受信顾问的建议
- en: Creating e-mail alarms
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建电子邮件告警
- en: Publishing custom metrics in CloudWatch
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在 CloudWatch 中发布自定义指标
- en: Creating monitoring dashboards
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建监控仪表盘
- en: Creating a budget
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建预算
- en: Feeding log files into CloudWatch logs
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将日志文件输入到 CloudWatch 日志
- en: Introduction
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍
- en: As with all administration, monitoring and alerting is a critical part of using
    AWS-based infrastructure. If anything, due to the ephemeral nature of cloud resources,
    keeping track and measuring your usage is even more important than when using
    on-premises systems.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 和所有管理操作一样，监控和告警是使用基于 AWS 的基础设施时至关重要的一部分。实际上，由于云资源的短暂性，跟踪和衡量使用情况比使用本地系统时更加重要。
- en: Auditing your AWS account
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 审计您的 AWS 账户
- en: We're now going to show you how to set up CloudTrail in your AWS account. Once
    CloudTrail has been enabled, it will start to record all of the API calls made
    in your account to the AWS service and then deliver them to you as log files in
    an S3 bucket.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在将向您展示如何在 AWS 账户中设置 CloudTrail。一旦启用了 CloudTrail，它将开始记录您账户中对 AWS 服务进行的所有 API
    调用，并将其作为日志文件传输到 S3 存储桶中。
- en: 'When we talk about API calls we mean things like:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们谈论 API 调用时，我们指的是类似以下内容：
- en: Actions performed in the AWS console.
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在 AWS 控制台中执行的操作。
- en: Calls made to AWS APIs using the CLI or SDKs.
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 CLI 或 SDK 调用 AWS API。
- en: Calls made on your behalf by AWS services. Think CloudFormation or the auto
    scaling service.
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: AWS 服务代表您所做的调用。比如 CloudFormation 或自动扩展服务。
- en: 'Each entry in the log will contain useful information, such as:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 日志中的每个条目将包含有用的信息，例如：
- en: The service that was called
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 被调用的服务
- en: The action that was requested
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 所请求的操作
- en: The parameters sent with the request
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 请求中发送的参数
- en: The response that was returned by AWS
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: AWS 返回的响应
- en: The identity of the caller (including IP address)
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 调用者的身份（包括 IP 地址）
- en: The date and time of the request
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 请求的日期和时间
- en: How to do it...
  id: totrans-24
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作……
- en: 'Create a new CloudFormation template file; we''re going to define the following
    `Resources`:'
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个新的 CloudFormation 模板文件；我们将定义以下 `Resources`：
- en: An S3 bucket for our CloudTrail log files to be stored in
  id: totrans-26
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 存储我们 CloudTrail 日志文件的 S3 存储桶
- en: A policy for our S3 bucket that allows the CloudTrail service to write to our
    bucket
  id: totrans-27
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个允许 CloudTrail 服务写入我们的 S3 存储桶的策略
- en: A CloudTrail *trail*
  id: totrans-28
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个 CloudTrail *轨迹*
- en: 'Define an S3 bucket like so. We don''t need to give it a name; we''ll add the
    bucket name to the list of `Outputs` later:'
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如此定义一个 S3 存储桶。我们不需要给它命名；稍后我们会将存储桶名称添加到 `Outputs` 列表中：
- en: '[PRE0]'
  id: totrans-30
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Next, we need to define a policy for our bucket. This section is a little wordy
    so you may prefer to get this from the code samples instead. This policy essentially
    allows CloudTrail to do two things to our bucket: `s3:GetBucketAcl` and `s3:PutObject`.'
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们需要为我们的存储桶定义一个策略。本节内容稍微有些冗长，您可以选择从代码示例中获取此内容。该策略基本上允许 CloudTrail 对我们的存储桶执行两项操作：`s3:GetBucketAcl`
    和 `s3:PutObject`。
- en: '[PRE1]'
  id: totrans-32
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Now we can set up our trail.
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们可以设置我们的轨迹。
- en: One thing to note here is that we use `DependsOn` to make CloudFormation create
    this trail after it has created the S3 bucket and policy. If you don't do this
    you'll likely encounter an error when you create the stack because CloudTrail
    won't be able to access the bucket.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 需要注意的是，我们使用 `DependsOn` 来确保 CloudFormation 在创建 S3 存储桶和策略之后再创建这个轨迹。如果不这样做，您在创建堆栈时可能会遇到错误，因为
    CloudTrail 无法访问存储桶。
- en: 'Add the `Trail` to your template like so:'
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 像这样将 `Trail` 添加到您的模板中：
- en: '[PRE2]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Finally, we''re going to output the name of the S3 bucket where our CloudTrail
    logs will be stored:'
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，我们将输出存储我们 CloudTrail 日志的 S3 存储桶名称：
- en: '[PRE3]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'You can go ahead and run your CloudFormation stack using the following command:'
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您可以使用以下命令运行您的 CloudFormation 堆栈：
- en: '[PRE4]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: How it works...
  id: totrans-41
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的……
- en: 'This template will set up CloudTrail with the following configuration:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 此模板将使用以下配置设置 CloudTrail：
- en: CloudTrail will be turned on for all regions in your account. This is a sensible
    place to start because it gives you visibility over where your AWS resources are
    being created. Even if you are the sole user of your AWS account it can be handy
    to know if you are making API calls to other regions by mistake (it's easy to
    do). When you create a multi region trail, new regions will automatically be included
    when they come online with no additional effort on your part.
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: CloudTrail 会在你账户的所有地区启用。这是一个合理的起点，因为它让你能够查看你的 AWS 资源是在哪些地区创建的。即使你是唯一使用 AWS 账户的人，知道自己是否错误地调用了其他地区的
    API 也很有帮助（这很容易发生）。当你创建一个多地区的 trail 时，当新地区上线时，它们将自动被包含在内，且无需你额外操作。
- en: Global service events will also be logged. Again this is a sensible default
    because it includes services that aren't region-specific. CloudFront and IAM are
    two examples of AWS services that aren't region-specific.
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 全球服务事件也将被记录。同样，这也是一个合理的默认设置，因为它包括了那些不是特定于某个地区的服务。CloudFront 和 IAM 是 AWS 中两个不受地区限制的服务示例。
- en: Log file validation is turned on. With this feature enabled, CloudTrail will
    deliver a digest file on an hourly basis that you can use to determine if your
    CloudTrail logs have been tampered with. CloudTrail uses SHA-256 for hashing and
    signing (RSA). The AWS CLI can be used to perform ad hoc validation of CloudTrail
    logs.
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 日志文件验证已启用。启用此功能后，CloudTrail 将每小时提供一个摘要文件，你可以使用该文件来确定你的 CloudTrail 日志是否被篡改。CloudTrail
    使用 SHA-256 进行哈希处理并进行签名（RSA）。AWS CLI 可用于执行 CloudTrail 日志的临时验证。
- en: 'For a quick view of your CloudTrial logs, with some basic search and filter
    functionality, you can head to the AWS web console:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 若想快速查看你的 CloudTrail 日志，并使用一些基本的搜索和过滤功能，你可以前往 AWS 网络控制台：
- en: '![](img/B06236_05_01.png)'
  id: totrans-47
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_01.png)'
- en: CloudTrail web console
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: CloudTrail 网络控制台
- en: There's more...
  id: totrans-49
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多内容...
- en: Log files are encrypted using server side encryption in S3\. This encryption
    is transparent to you, but you can opt to encrypt these files with your own **customer
    master key** (**CMK**) if you wish.
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 日志文件使用服务器端加密在 S3 中进行加密。此加密对你是透明的，但如果你愿意，你可以选择使用你自己的**客户主密钥**（**CMK**）来加密这些文件。
- en: API calls are logged by CloudTrail in under 15 minutes.
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: API 调用会在 15 分钟内被 CloudTrail 记录。
- en: Logs are shipping to your S3 bucket every five minutes.
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 日志每五分钟会被发送到你的 S3 存储桶。
- en: It's possible to aggregate CloudTrail events across many accounts into a single
    bucket. This is a pattern often used to log AWS activity into a *SecOps* or similar
    account for auditing.
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可以将多个账户的 CloudTrail 事件聚合到一个存储桶中。这是一个常见的模式，通常用于将 AWS 活动日志记录到 *SecOps* 或类似账户中进行审计。
- en: Logging aside, CloudTrail keeps your API activity for seven days.
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 除了日志记录外，CloudTrail 会保留你的 API 活动七天。
- en: You can create more than one trail. You might consider creating a trail for
    your developers that is separate from the trail consumed by security.
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你可以创建多个 trail。你可能会考虑为你的开发人员创建一个与安全团队使用的 trail 分开的 trail。
- en: If a CloudFormation stack creates an S3 bucket and that S3 bucket has objects
    in it the delete operation will fail if and when you choose to delete the stack.
    You can manually delete the S3 bucket in the S3 web console if you wish to work
    around this.
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果 CloudFormation 堆栈创建了一个 S3 存储桶，并且该 S3 存储桶中有对象，当你选择删除堆栈时，删除操作将失败。你可以在 S3 网络控制台中手动删除
    S3 存储桶，如果你希望绕过这个问题的话。
- en: Recommendations with Trusted Advisor
  id: totrans-57
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 Trusted Advisor 的建议
- en: 'Trusted Advisor covers four main areas and it is designed to give you some
    guidance around what are considered best practices for your cloud deployment.
    The areas covered are:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: Trusted Advisor 涵盖了四个主要领域，旨在为你的云部署提供一些最佳实践的指导。涵盖的领域有：
- en: Cost Optimization
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 成本优化
- en: Performance
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 性能
- en: Security
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安全性
- en: Fault Tolerance
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 容错
- en: It's available to everyone and free to use—with one fairly large catch. Unless
    you are paying for Business or Enterprise level support with AWS you only get
    access to four checks. At the time of publishing there are 55 possible checks.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 它对所有人开放并且免费使用——但有一个相当大的限制。除非你为 AWS 的商业或企业级支持付费，否则你只能访问四个检查项。在本文发布时，总共有 55 个可能的检查项。
- en: How to do it...
  id: totrans-64
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何操作的...
- en: The good news is you don't need to do anything at all to turn on Trusted Advisor.
    It's automatically enabled when your AWS account is created and will continue
    to update for the lifetime of your account.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 好消息是，你无需做任何事情来启用 Trusted Advisor。当你的 AWS 账户创建时，它会自动启用，并将在你的账户的生命周期内持续更新。
- en: Go ahead and navigate to the Trusted Advisor section of the AWS web console.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 继续访问 AWS 网络控制台中的 Trusted Advisor 部分。
- en: How it works...
  id: totrans-67
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: 'The four checks provided for free with this service are:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 该服务提供的四个免费检查项是：
- en: '**Unrestricted ports**: This is a check on the highest risk ports in your security
    groups. They''ll be flagged if they''re open to everyone (`0.0.0.0/0`).'
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**不受限制的端口**：这是对安全组中最高风险端口的检查。如果这些端口对所有人开放（`0.0.0.0/0`），它们将被标记。'
- en: '**IAM usage**: This is a fairly rudimentary check. If there isn''t at least
    one IAM user in your account this check won''t pass. It''s considered good practice
    to not use your root login credentials for your AWS account and instead create
    IAM users with least privilege access.'
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**IAM 使用情况**：这是一个相对基础的检查。如果你的账户中没有至少一个 IAM 用户，这个检查将不通过。通常的好做法是避免使用根账户凭证登录 AWS，而是创建具有最小权限的
    IAM 用户。'
- en: '**MFA on root account**: This is also a fairly rudimentary check. You need
    to have MFA enabled for your root login in order for this check to pass. It''s
    obviously a good idea to enable MFA for your IAM users too.'
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**根账户启用 MFA**：这也是一个相对基础的检查。你需要为根账户启用 MFA 才能通过此检查。显然，启用 IAM 用户的 MFA 也是一个好主意。'
- en: '**Service l****imits**: This one is quite handy: if you''re approaching 80%
    of your service limits, this check won''t pass. For example, it''s nice to know
    if you''re about to hit the cap of CloudFormation stacks or EC2 instances before
    you attempt to create them.'
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**服务限制**：这个检查很有用：如果你接近服务限制的 80%，这个检查将不通过。例如，知道你是否快要达到 CloudFormation 堆栈或 EC2
    实例的上限，在尝试创建它们之前是很有用的。'
- en: Even though there's only four checks here, these are some of the more useful
    ones so we'd encourage you to pay attention to them.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 即使这里只有四个检查项，这些也是比较有用的，我们鼓励你关注它们。
- en: 'The console uses a color scheme to denote the status of each check:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 控制台使用颜色方案来表示每个检查的状态：
- en: '**Red**: It''s recommended that you take action to remedy this check'
  id: totrans-75
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**红色**：建议你采取措施修复此检查项。'
- en: '**Yellow**: This check requires investigation and possible remediation'
  id: totrans-76
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**黄色**：此检查需要调查并可能进行整改。'
- en: '**Green**: This check is passing and needs no attention'
  id: totrans-77
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**绿色**：此检查通过，无需关注。'
- en: Visit the Preferences page in the Trusted Advisor web console if you'd like
    to have a weekly report e-mailed to you.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你希望每周收到电子邮件报告，可以访问 Trusted Advisor 网站控制台中的偏好设置页面。
- en: '![](img/B06236_05_02.png)'
  id: totrans-79
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_02.png)'
- en: Trusted Advisor console
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: Trusted Advisor 控制台
- en: There's more...
  id: totrans-81
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多内容……
- en: 'As well as opening up the entire suite of Trusted Advisor checks, a Business
    or Enterprise level support arrangement gives you access to the following:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 除了开放整个 Trusted Advisor 检查套件外，企业级或商业级支持还可以访问以下内容：
- en: '**Notifications**: You are able to have notifications delivered to you at a
    higher frequency using a number of delivery methods. Since Trusted Advisor is
    an available source in CloudWatch Events you''ll be able to create notifications
    that can be handled by SNS (e-mail, push, SMS) or even notifications that will
    trigger Lambda functions.'
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**通知**：你可以通过多种方式更频繁地接收通知。由于 Trusted Advisor 是 CloudWatch Events 中的可用源，你将能够创建通知，这些通知可以通过
    SNS（电子邮件、推送、短信）处理，甚至可以触发 Lambda 函数。'
- en: '**API a****ccess**: You''ll have access to a number of Trusted Advisor API
    methods such as `DescribeTrustedAdvisorCheckResult` and `DescribeTrustedAdvisorCheckSummaries`.
    You can use these to integrate the results from checks into your own dashboards
    or monitoring systems. You''ll also be able to use the APIs to refresh Trusted
    Advisor checks (after you''ve taken corrective action on them, for example).'
  id: totrans-84
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**API 访问**：你将能够使用多个 Trusted Advisor API 方法，如 `DescribeTrustedAdvisorCheckResult`
    和 `DescribeTrustedAdvisorCheckSummaries`。你可以使用这些方法将检查结果集成到自己的仪表盘或监控系统中。你还可以使用这些
    API 来刷新 Trusted Advisor 检查（例如，在你采取纠正措施后）。'
- en: '**Exclusion**: You can selectively mute checks that are failing. You''ll sometimes
    want to do this for things such as RDS instances in your development environments
    that aren''t in multi-AZ mode or don''t have backups enabled.'
  id: totrans-85
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**排除**：你可以选择性地静音失败的检查。有时你可能会希望为开发环境中的 RDS 实例（例如没有启用多 AZ 模式或没有启用备份的实例）这样做。'
- en: 'Finally, some of the more useful checks we see for our Business and Enterprise
    level support customers are:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，一些我们为企业级支持客户提供的更有用的检查项包括：
- en: '**Reserved Instances**: A nice cost optimization if you have a reasonably static
    workload.'
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**预留实例**：如果你有相对静态的工作负载，这是一种很好的成本优化方式。'
- en: '**Unassociated Elastic IPs**: If IP addresses are not associated with a network
    interface (on an EC2 instance for example) you will still be charged for them.
    Also if there are unassociated IPs floating around, that is usually a sign that
    they are being allocated manually instead of with CloudFormation. Remember that
    the goal here is for more automation, not less.'
  id: totrans-88
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**未关联的弹性 IP**：如果 IP 地址没有与网络接口（例如 EC2 实例）关联，您仍然需要为其付费。此外，如果存在未关联的 IP，这通常意味着它们是手动分配的，而不是通过
    CloudFormation 配置的。记住，目标是实现更多的自动化，而不是更少。'
- en: '**Idle load balancers**: Again, these cost money and are often easily orphaned
    in low automation environments.'
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**空闲负载均衡器**：同样，这些也需要付费，且在低自动化环境中很容易成为孤立资源。'
- en: '**S3 bucket permissions**: It''s not always obvious if the permissions on an
    S3 bucket have been misconfigured. This check helps you avoid unintentionally
    leaking data.'
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**S3 存储桶权限**：如果 S3 存储桶的权限配置错误，通常并不显而易见。此检查帮助您避免不小心泄露数据。'
- en: Creating e-mail alarms
  id: totrans-91
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建电子邮件警报
- en: While e-mail alarms may not be the most scalable of all alarms (due to the amount
    of e-mail most people get), they are the easiest to integrate—almost everyone
    has an e-mail address!
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然电子邮件警报可能不是所有警报中最具可扩展性的（由于大多数人收到大量电子邮件），但它们是最容易集成的——几乎每个人都有电子邮件地址！
- en: 'This recipe uses two AWS services:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 本示例使用了两个 AWS 服务：
- en: '**CloudWatch** (**CW**)'
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**CloudWatch**（**CW**）'
- en: '**Simple Notification Service** (**SNS**)'
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**简单通知服务**（**SNS**）'
- en: As you will often want to create alarms for metrics after viewing them through
    the CloudWatch dashboard, this recipe will use the console to create the alarms.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 由于您通常会在通过 CloudWatch 仪表板查看指标后创建警报，因此本例将使用控制台创建警报。
- en: How to do it...
  id: totrans-97
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'In the CloudWatch console, go to the Alarms section:'
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 CloudWatch 控制台中，转到警报部分：
- en: '![](img/B06236_05_03.png)'
  id: totrans-99
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_03.png)'
- en: 'Click Create Alarm to start the wizard:'
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击创建警报以启动向导：
- en: '![](img/B06236_05_04.png)'
  id: totrans-101
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_04.png)'
- en: 'Select the metric you are interested in alerting on. In this case, we will
    choose By Function Name under Lambda Metrics:'
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择您希望触发警报的指标。在本例中，我们将在 Lambda 指标下选择按函数名称：
- en: '![](img/B06236_05_05.png)'
  id: totrans-103
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_05.png)'
- en: 'Select the specific metric. You can filter by any of the values in the table.
    In this case, we will select Errors and click Next:'
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择特定的指标。您可以通过表中的任何值进行过滤。在本例中，我们将选择错误并点击下一步：
- en: '![](img/B06236_05_06.png)'
  id: totrans-105
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_06.png)'
- en: 'Define the alarm, giving at least a name and a threshold. In this case, we
    will alert if there are ever *any* errors (such as `> 0`):'
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义警报，至少指定一个名称和阈值。在本例中，我们将在出现*任何*错误（例如 `> 0`）时触发警报：
- en: '![](img/B06236_05_07-1.png)'
  id: totrans-107
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_07-1.png)'
- en: 'In the Actions section, create a new list by giving the e-mail address you
    want to be notified on of a breach, and a topic name (in this example, we use
    `EmailMe`), and then click Create Alarm:'
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在操作部分，通过输入您希望收到违规通知的电子邮件地址和主题名称（本例中使用 `EmailMe`），然后点击创建警报来创建一个新列表：
- en: '![](img/B06236_05_08.png)'
  id: totrans-109
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_08.png)'
- en: You will be asked to confirm the e-mail address, and no notifications will be
    given until it is verified.
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您将被要求确认电子邮件地址，且在确认之前不会收到任何通知。
- en: '![](img/B06236_05_09.png)'
  id: totrans-111
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_09.png)'
- en: 'The confirmation e-mail will look like this:'
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确认电子邮件将如下所示：
- en: '![](img/B06236_05_10.png)'
  id: totrans-113
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_10.png)'
- en: 'Once you have clicked on the Confirm subscription link in the e-mail, you will
    see a confirmation message as follows:'
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦您点击电子邮件中的确认订阅链接，您将看到如下确认信息：
- en: '![](img/image_05_011.png)'
  id: totrans-115
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_05_011.png)'
- en: 'Back in the console the status will update, showing that you have successfully
    confirmed your subscription:'
  id: totrans-116
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 回到控制台后，状态会更新，显示您已成功确认订阅：
- en: '![](img/B06236_05_12.png)'
  id: totrans-117
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_12.png)'
- en: 'You will then see your newly created alarm in the console, and can view its
    status and history:'
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后您将在控制台中看到新创建的警报，并可以查看其状态和历史记录：
- en: '![](img/B06236_05_13.png)'
  id: totrans-119
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_13.png)'
- en: 'In the SNS console, you can see the topic that was created for you as follows:'
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 SNS 控制台中，您可以看到为您创建的主题，如下所示：
- en: '![](img/B06236_05_14.png)'
  id: totrans-121
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_14.png)'
- en: How it works...
  id: totrans-122
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何工作...
- en: While we normally prefer the CLI (or CloudFormation) for creating AWS resources
    the wizard for creating alarms does a lot of work for you, so it is a good place
    to start. Once you know what kinds of alarms you are interested in, you can automate
    them.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然我们通常更倾向于使用 CLI（或 CloudFormation）来创建 AWS 资源，但创建警报的向导为您做了很多工作，所以它是一个很好的起点。一旦您知道自己感兴趣的警报类型，就可以将其自动化。
- en: The CloudWatch console is a great place to keep an eye on the performance of
    your resources. Often when looking at the metrics you might find a scenario that
    you would want to be notified of, and quickly create an alarm on it.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: CloudWatch 控制台是监视您资源性能的好地方。经常在查看指标时，您可能会发现一些需要通知的场景，并迅速创建相应的警报。
- en: While e-mail is probably the easiest way to get started with alarms, it doesn't
    scale all that well (Do you really want more e-mail?). For very important metrics
    you might want a CloudWatch dashboard instead, or a different notification protocol/target.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然电子邮件可能是启动警报的最简单方式，但它的可扩展性并不太好（您真的想要更多电子邮件吗？）。对于非常重要的指标，您可能希望使用 CloudWatch
    仪表板，或者选择不同的通知协议/目标。
- en: We start by selecting the metric we are interested in; in this case, it is errors
    from the example-lambda-function, but the process would work the same regardless
    of the metric you select.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先选择我们感兴趣的指标；在本例中，这是来自示例 Lambda 函数的错误，但无论您选择哪个指标，此过程都将相同。
- en: You must define a name for the alarm, and you can optionally create a description.
    One of the most important parts of the alarm is how you define the threshold that
    will trigger it. You can choose not only the value and comparison operator used
    (for example, greater than (>), less than (<), greater than or equal to (>=),
    and so on), but also the number of failing data points that must occur before
    the alarm is triggered. This can stop you being alerted unnecessarily for temporary
    *spikes* in metric values. In this scenario we want to know if there are *any*
    errors, so we set the value to `1`.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 您必须为警报定义名称，可以选择创建描述。警报的最重要部分之一是如何定义触发它的阈值。您不仅可以选择使用的值和比较运算符（例如，大于（>），小于（<），大于或等于（>=），等等），还可以选择在触发警报前必须发生的失败数据点数量。这可以防止因指标值的临时*波动*而不必要地触发警报。在这种情况下，我们想知道是否存在*任何*错误，因此我们将值设置为`1`。
- en: On the right-hand side you can define the check period and the statistic used
    (for example, Average, Maximum, Minimum, and so on). You can also see the recent
    history of the selected metric in the top-right corner. The red line on the graph
    is where the currently defined threshold will sit, so you can quickly see if the
    alarm would have been triggered.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 在右侧，您可以定义检查周期和使用的统计数据（例如，平均值、最大值、最小值等）。您还可以在右上角查看所选指标的最近历史记录。图表上的红线表示当前定义的阈值，因此您可以快速查看是否会触发警报。
- en: In the Actions section of the alarm, you define what action will be taken when
    triggered. While you can select an existing SNS topic, we will define a new one
    by clicking on New list. You are then prompted for the details of the new topic;
    you must give both a name and an e-mail address to subscribe to the topic.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 在警报的“操作”部分，您定义触发时将采取的操作。虽然您可以选择现有的 SNS 主题，但我们将通过点击“新建列表”来定义一个新的主题。然后，系统会提示您输入新主题的详细信息；您必须提供名称和要订阅主题的电子邮件地址。
- en: When you click Create Alarm, you will see the status of the subscription. After
    receiving the e-mail and clicking on the confirmation link, the status will automatically
    update. It doesn't matter if you navigate away from the window before you confirm
    the subscription. Just remember that your target e-mail address won't receive
    any notifications if you do not confirm the subscription.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 当您点击“创建警报”时，您将看到订阅的状态。收到电子邮件并点击确认链接后，状态将自动更新。在确认订阅之前，您可以从窗口中导航离开，这没有关系。只需记住，如果您不确认订阅，目标电子邮件地址将不会收到任何通知。
- en: 'Viewing the newly created alarm shows its current state, and its recent history.
    An alarm has three possible states:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 查看新创建的警报显示其当前状态和最近的历史记录。警报有三种可能的状态：
- en: 'ALARM: The metric is over the defined threshold'
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ALARM：指标高于定义的阈值
- en: 'INSUFFICIENT_DATA: There were not enough data points to determine if the metric
    is under or over the threshold'
  id: totrans-133
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: INSUFFICIENT_DATA：没有足够的数据点来确定指标是在阈值之上还是之下
- en: 'OK: The metric is under the defined threshold'
  id: totrans-134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: OK：指标低于定义的阈值
- en: You can filter alarms by their state by the links on the side menu, which also
    show an updated view of how many alarms are in each state.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过侧边菜单中的链接按其状态筛选警报，并显示每个状态中有多少警报的更新视图。
- en: Behind the scenes, the wizard has created an SNS topic for you. The topic is
    what handles converting the alarm message to an e-mail, and sending it. Without
    the SNS topic the alarm would still alert (that is change state), but there would
    be no way to tell without looking at the metric in the CloudWatch dashboard.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 在后台，向导已经为你创建了一个SNS主题。该主题负责将警报消息转换为电子邮件并发送出去。如果没有SNS主题，警报仍然会触发（即改变状态），但没有办法知道，除非查看CloudWatch仪表板中的指标。
- en: There's more...
  id: totrans-137
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多……
- en: This recipe represents the simplest useful configuration of SNS topics and CW
    alarms, but there is a lot more depth available to you in this pattern.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 这个食谱展示了SNS主题和CW警报的最简单有效配置，但这个模式还有更多深度可以探索。
- en: Existing topics
  id: totrans-139
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 现有主题
- en: Instead of choosing New list in the wizard, you can use the Select list functionality.
    You then give the name of an existing SNS topic to use, rather than creating a
    new one.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 在向导中，除了选择“新列表”外，你还可以使用“选择列表”功能。然后，你可以提供一个现有SNS主题的名称来使用，而不是创建一个新的主题。
- en: '![](img/B06236_05_15.png)'
  id: totrans-141
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_15.png)'
- en: This means you can set up a single topic to push multiple alarms to. In addition
    to being simpler it also means you only need to confirm the subscription *once*,
    instead of doing it for each alarm.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 这意味着你可以设置一个单独的主题来推送多个警报。除了更简单之外，这还意味着你只需要确认订阅*一次*，而不必为每个警报都进行确认。
- en: Other subscriptions
  id: totrans-143
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 其他订阅
- en: 'An SNS topic that notifies an e-mail is the most common subscription, but not
    the only option. SNS topics can also send notifications to:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 一个通知电子邮件的SNS主题是最常见的订阅方式，但并不是唯一的选择。SNS主题还可以将通知发送到：
- en: HTTP(S) endpoints
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: HTTP(S)端点
- en: Amazon SQS
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Amazon SQS
- en: AWS Lambda
  id: totrans-147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: AWS Lambda
- en: SMS
  id: totrans-148
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 短信
- en: See also
  id: totrans-149
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 另请参见
- en: The *Creating monitoring dashboards* recipe
  id: totrans-150
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*创建监控仪表板*食谱'
- en: Publishing custom metrics in CloudWatch
  id: totrans-151
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在CloudWatch中发布自定义指标
- en: Once you get used to using CloudWatch, it is highly likely that you will want
    to see more than just the built-in AWS metrics.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你习惯了使用CloudWatch，很可能你会希望看到更多的AWS内置指标以外的内容。
- en: One of the most common metrics users ask for after starting to run servers in
    EC2 is memory usage; the built-in metrics for EC2 instances are CPU utilization,
    network in/out, disk reads/writes, and status—memory is not included by default!
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 用户在开始运行EC2服务器后最常问的一个常见指标是内存使用情况；EC2实例的内置指标包括CPU利用率、网络流量、磁盘读写和状态——默认情况下并不包括内存！
- en: This recipe will show you how to feed the amount of memory inuse on your Linux
    instances to CloudWatch, so that you can see them alongside the other instance
    metrics.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 这个食谱将展示如何将Linux实例上使用的内存量传送到CloudWatch，这样你就可以将它们与其他实例指标一起查看。
- en: Knowing how utilized (or not) your instances are is a key component in choosing
    the right instance type to use for your workloads. Getting it wrong can cost you
    a lot of money!
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 知道你的实例是否被充分利用（或根本没有利用）是选择适合工作负载的实例类型的关键因素。选择错误可能会让你付出大量的金钱！
- en: Getting ready
  id: totrans-156
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: You will need an EC2 instance running Linux, with the AWS CLI tool installed
    to perform this recipe. If you use an instance based on AWS Linux, you will have
    the AWS CLI tool installed for you.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要一台运行Linux的EC2实例，并安装AWS CLI工具来执行这个食谱。如果你使用基于AWS Linux的实例，AWS CLI工具将为你预安装。
- en: The instance role or credentials you use to run the following commands must
    have permission to submit metrics to CloudWatch. This is the `CloudWatch:PutMetricData`
    permission.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 你用于运行以下命令的实例角色或凭证必须有权限向CloudWatch提交指标。这是`CloudWatch:PutMetricData`权限。
- en: How to do it...
  id: totrans-159
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何执行……
- en: 'On the instance, run the following AWS CLI command:'
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在实例上，运行以下AWS CLI命令：
- en: '[PRE5]'
  id: totrans-161
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Go to the CloudWatch console, and navigate to the Metrics dashboard. Your metric
    will appear under the namespace CustomMetrics, InstanceId, and the unique ID for
    the instance, with the metric name MemoryUsagePercent.
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入CloudWatch控制台，导航到“指标”仪表板。你的指标将出现在命名空间CustomMetrics下，显示实例ID和实例的唯一ID，并且指标名称为MemoryUsagePercent。
- en: It can take *up to* 15 minutes for a custom metric to appear in the CloudWatch
    dashboard (although it usually takes less). Even for the built-in metrics, it
    may take a minute or two for the metric data to appear in the console.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 自定义指标出现在CloudWatch仪表板上可能需要*最多*15分钟（尽管通常需要的时间较短）。即使是内置的指标，也可能需要一到两分钟才能在控制台中看到该指标数据。
- en: How it works...
  id: totrans-164
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 工作原理……
- en: In this recipe, we use the built-in `put-metric-data` AWS CLI command to send
    our metric to CloudWatch.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个食谱中，我们使用内置的`put-metric-data` AWS CLI命令将我们的指标发送到CloudWatch。
- en: We start by defining the metric name and namespace that the values will appear
    under. This is important because it defines how we will see the metric in the
    console and dashboards. Names should identify and describe the metric. They do
    not need to be unique, as the dimension(s) we add will take care of that (we will
    discuss this later). Namespaces are used to group similar metrics together, like
    a category. The built-in metrics appear under the namespace `AWS/`. For example,
    EC2 metrics appear under the `AWS/EC2` namespace.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先定义度量名称和命名空间，值将显示在该命名空间下。这一点很重要，因为它定义了我们在控制台和仪表板中如何看到该度量。名称应该能够标识并描述度量。名称不需要唯一，因为我们添加的维度（dimension）会处理这个问题（稍后会讨论）。命名空间用于将类似的度量分组，就像是一个类别。内置度量会出现在命名空间`AWS/`下。例如，EC2度量会出现在`AWS/EC2`命名空间下。
- en: We then specify a dimension for the metric. A **dimension** is a way to uniquely
    identify similar metrics. In this case we are using the instance's ID to identify
    the metric, because the metric is unique to that instance, but we will likely
    have many instances of the `MemoryUsagePercent` metric (across many EC2 instances).
    We are obtaining the instance ID by querying (via the `curl` command) the instance
    metadata service, which is accessed over HTTP on the special IP address `169.254.169.254`.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们为度量指定一个维度。**维度**是唯一标识相似度量的方式。在这种情况下，我们使用实例的ID来标识度量，因为该度量是该实例特有的，但我们可能会有许多`MemoryUsagePercent`度量（在许多EC2实例中）。我们通过查询（使用`curl`命令）实例元数据服务来获取实例ID，该服务通过HTTP访问，位于特殊的IP地址`169.254.169.254`。
- en: There's a lot of other useful information in the instance metadata. See the
    AWS documentation on instance metadata for more details [http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html](http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html).
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 实例元数据中有很多其他有用的信息。有关实例元数据的更多细节，请参阅AWS文档：[http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html](http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html)。
- en: Next we specify a percent, because we know what kind of data we are dealing
    with. This argument can be leftoff if you don't know (or care), as CloudWatch
    attaches no significance to it (although some other applications may be able to
    use it, for example, for display).
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来我们指定一个百分比，因为我们知道自己处理的是哪种数据。如果你不知道（或不在意），可以省略这个参数，因为CloudWatch对此没有特殊含义（尽管其他一些应用程序可能会使用它，例如用于显示）。
- en: Finally we specify the value to send. We work this value out dynamically from
    the output of the `free` command and use `awk` to convert it to a percentage of
    memory inuse.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们指定要发送的值。我们通过动态计算`free`命令的输出值，并使用`awk`将其转换为内存使用百分比。
- en: Once the metric is being sent to CloudWatch, we can view it in the console.
    The easiest way is to select your specific metric and view it in the Metrics section
    of the CloudWatch console.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦度量被发送到CloudWatch，我们就可以在控制台中查看它。最简单的方法是选择你的特定度量，并在CloudWatch控制台的度量部分查看它。
- en: There's more...
  id: totrans-172
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多...
- en: This is a good real-world use-case to get started with your own custom metrics,
    but there's a lot more you can do with them.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个很好的实际案例，适合开始使用你自己的自定义度量，但你可以用它做的事情远不止这些。
- en: Cron
  id: totrans-174
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Cron
- en: One-off metric values are rarely useful on their own. The real value comes when
    you can plot and see them over time; how they change, how fast they change, what
    their range is, and so on.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 单次的度量值通常不会单独有太大用处。真正的价值在于你可以将其绘制并查看其随时间的变化；它们如何变化，变化的速度，变化的范围等等。
- en: On Linux you can schedule a command easily with the `cron` command. By putting
    the AWS CLI commands in a script, and scheduling it with `cron` to run periodically,
    you can feed metrics consistently to CloudWatch, without the overhead of running
    a dedicated agent on your instances.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 在Linux上，你可以使用`cron`命令轻松安排任务。通过将AWS CLI命令放入脚本中，并通过`cron`定期调度它运行，你可以持续地将度量数据提供给CloudWatch，而无需在实例上运行专门的代理程序。
- en: Auto scaling
  id: totrans-177
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 自动扩展
- en: Instance-based metrics like memory usage become especially useful when collected
    from all the instances in an auto scaling group.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 像内存使用这样的基于实例的度量在从自动扩展组的所有实例收集时变得尤为有用。
- en: 'By collecting instance or even application-specific metrics (for example: number
    of threads used, internal request duration, and so on) you can make your auto
    scaling groups increase and decrease in size at the most appropriate times to
    your workload and performance profile.'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 通过收集实例甚至应用程序特定的度量（例如：使用的线程数、内部请求持续时间等），你可以在最合适的时间根据工作负载和性能配置，自动调整扩展组的大小。
- en: To do this, make the auto scaling group name one of the dimensions (you can
    define multiple dimensions) sent along with your metric value.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 为了实现这一点，将自动伸缩组名称设置为度量之一的维度（你可以定义多个维度），并将其与度量值一起发送。
- en: Backfilling
  id: totrans-181
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 回填
- en: 'You can backfill metrics by running the same command and supplying an additional
    `--timestamp` argument. The timestamp argument accepts an ISO 8601 date and time
    stamp in UTC time for example: `2017-01-01T12:00:00.000Z`'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过运行相同的命令并提供额外的`--timestamp`参数来回填度量数据。时间戳参数接受UTC时间的ISO 8601日期和时间戳，例如：`2017-01-01T12:00:00.000Z`
- en: 'Keep in mind that CloudWatch will only retain your metrics for a certain period,
    decided by the granularity of your metrics. The retention period is:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住，CloudWatch只会在一定时间内保留你的度量数据，这段时间由度量数据的粒度决定。保留期为：
- en: Data points with a period of 60 seconds (1 minute) are available for 15 days
  id: totrans-184
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 周期为60秒（1分钟）的数据点可保存15天
- en: Data points with a period of 300 seconds (5 minute) are available for 63 days
  id: totrans-185
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 周期为300秒（5分钟）的数据点可保存63天
- en: Data points with a period of 3600 seconds (1 hour) are available for 455 days
    (15 months)
  id: totrans-186
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 周期为3600秒（1小时）的数据点可保存455天（15个月）
- en: While you can send metrics with millisecond precision, the minimum value CloudWatch
    will store is at the 1 minute level. Anything less than the 1 minute level and
    CloudWatch will aggregate the values. When aggregated, you can see some additional
    information about your metric; namely the sample size, minimum and maximum value,
    and the average of the values.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然你可以发送毫秒精度的度量数据，但CloudWatch会以1分钟为最小存储单位存储数据。低于1分钟的数据，CloudWatch会将其汇总。当汇总时，你可以看到一些关于你的度量的附加信息；例如样本大小、最小和最大值，以及值的平均值。
- en: See also
  id: totrans-188
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 另见
- en: The *Creating monitoring dashboards* recipe
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*创建监控仪表板*配方'
- en: The *Launching an Instance* recipe in [Chapter 4](beece917-78ff-43b8-934b-706eca5968f9.xhtml),
    *Using AWS Compute*.
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[第4章](beece917-78ff-43b8-934b-706eca5968f9.xhtml)中*启动实例*的配方，*使用AWS计算*。'
- en: Creating monitoring dashboards
  id: totrans-191
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建监控仪表板
- en: The real value of collecting metrics is the ability to spot trends and relationships
    (often unknown or unexpected) between disparate systems. With this kind of visibility,
    you are able to identify and troubleshoot issues before they become an incident.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 收集度量数据的真正价值在于能够发现不同系统之间的趋势和关系（通常是未知或出乎意料的）。有了这种可见性，你可以在问题成为事件之前识别并排除故障。
- en: In addition to providing a way to aggregate and view metrics from your systems,
    the CloudWatch service also makes it easy to create monitoring dashboards so that
    you can quickly and clearly view the most important metrics.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 除了提供一种汇总和查看系统度量数据的方式外，CloudWatch 服务还使得创建监控仪表板变得容易，这样你就可以快速、清晰地查看最重要的度量数据。
- en: This recipe uses the AWS console because you cannot create dashboards via CloudFormation
    or the AWS CLI tool yet.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 本配方使用AWS控制台，因为目前你不能通过CloudFormation或AWS CLI工具创建仪表板。
- en: Getting ready
  id: totrans-195
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: You will need to have some metrics already present in CloudWatch in order to
    create a dashboard.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要在CloudWatch中已有一些度量数据，才能创建仪表板。
- en: 'If you have been using AWS services (for example: EC2, RDS, DDB, and so on),
    then you should have plenty—almost all the AWS services populate metrics in CloudWatch
    by default.'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你已经在使用AWS服务（例如：EC2、RDS、DDB等），那么你应该有很多——几乎所有AWS服务默认都会在CloudWatch中填充度量数据。
- en: How to do it...
  id: totrans-198
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何执行…
- en: 'Navigate to the CloudWatch section of the AWS console:'
  id: totrans-199
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入AWS控制台的CloudWatch部分：
- en: '![](img/B06236_05_16.png)'
  id: totrans-200
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_16.png)'
- en: 'Go to the Dashboards section of the console via the link on the left-hand menu:'
  id: totrans-201
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过左侧菜单中的链接进入控制台的仪表板部分：
- en: '![](img/B06236_05_17.png)'
  id: totrans-202
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_17.png)'
- en: 'Click the Create Dashboard button:'
  id: totrans-203
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“创建仪表板”按钮：
- en: '![](img/B06236_05_18.png)'
  id: totrans-204
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_18.png)'
- en: 'Choose the type of widget you want to use to display your metric. In this example,
    we will choose the most versatile, Line:'
  id: totrans-205
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择你想用来显示度量的部件类型。在这个例子中，我们将选择最通用的“折线图”：
- en: '![](img/B06236_05_19.png)'
  id: totrans-206
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_19.png)'
- en: 'Navigate the All metrics tab to find the metric(s) you want to include, selecting
    it by clicking the tick box on the left of the metric details. You will see a
    preview of the metric(s) and how they will look:'
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 浏览“所有度量”标签，找到你想要包含的度量，点击度量详细信息左侧的勾选框进行选择。你将看到该度量的预览以及它的显示方式：
- en: '![](img/B06236_05_20.png)'
  id: totrans-208
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_20.png)'
- en: Once selected, you can modify how the metric is displayed via the settings on
    the Graphed metrics tab. In this case we have given the widget a name, and changed
    the Period setting for our metric to 1 Minute to reflect the additional granularity
    available (You can see that the metric line appears *smoother* because of it).
  id: totrans-209
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦选择了你可以通过“图表指标”选项卡上的设置来修改指标的显示方式。在这种情况下，我们给小部件起了一个名字，并将指标的周期设置为 1 分钟，以反映可用的更高精度（你可以看到由于这个设置，指标线变得*更平滑*了）。
- en: '![](img/B06236_05_21.png)'
  id: totrans-210
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_21.png)'
- en: 'Once you click Create widget, you will see your widget on the dashboard. Once
    you click Save dashboard, it will appear under the Dashboards heading on the left-hand
    menu:'
  id: totrans-211
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦你点击“创建小部件”，你将看到小部件出现在仪表板上。一旦你点击“保存仪表板”，它会出现在左侧菜单的“仪表板”标题下：
- en: '![](img/B06236_05_22.png)'
  id: totrans-212
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_22.png)'
- en: 'At a dashboard level, you can turn on Auto refresh and the refresh frequency
    interval:'
  id: totrans-213
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在仪表板级别，你可以打开自动刷新并设置刷新频率间隔：
- en: '![](img/B06236_05_23.png)'
  id: totrans-214
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_23.png)'
- en: 'You can resize and rearrange your widgets by dragging them. Just remember to
    click Save dashboard to persist any changes:'
  id: totrans-215
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你可以通过拖动小部件来调整大小和重新排列它们。只需记住点击“保存仪表板”以保留任何更改：
- en: '![](img/B06236_05_24.png)'
  id: totrans-216
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_24.png)'
- en: There's more...
  id: totrans-217
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多……
- en: CloudWatch dashboard's value is the ease and simplicity that it allows you to
    publicize your most important metrics.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: CloudWatch 仪表板的价值在于，它让你能够轻松简单地公开最重要的指标。
- en: As with any dashboard, make sure that the metrics you choose to display are
    relevant and actionable. There's no point in displaying a metric if there's no
    action required when it changes.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 与任何仪表板一样，确保你选择展示的指标是相关且可操作的。如果更改时没有需要采取的行动，那么展示这个指标就没有意义。
- en: Widget types
  id: totrans-220
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 小部件类型
- en: 'Line graphs are not the only type of widget that can be displayed in a dashboard.
    There is also:'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 线形图并不是仪表板上唯一可以显示的小部件类型。还有：
- en: Stacked area
  id: totrans-222
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 堆叠区域
- en: Number
  id: totrans-223
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数字
- en: Text
  id: totrans-224
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 文本
- en: Depending on the type of metrics you are collecting or are interested in, you
    should experiment with different types of widgets to display them. Not all metrics
    are suited to line graphs.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 根据你收集或感兴趣的指标类型，你应该尝试不同类型的小部件来展示它们。并非所有指标都适合用线形图表示。
- en: See also
  id: totrans-226
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 另见
- en: The *Publishing custom metrics in CloudWatch* recipe.
  id: totrans-227
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*在 CloudWatch 中发布自定义指标* 配方。'
- en: Creating a budget
  id: totrans-228
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建预算
- en: One of the main attractions of using AWS, is its pay-as-you-go model. You only
    pay for what you use, no more and no less.
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 AWS 的主要吸引力之一就是它的按需付费模式。你只需为使用的部分付费，既不多也不少。
- en: Unfortunately, this can sometimes result in what's known as **bill shock** at
    the end of the month. This happens when you do something that you might not know
    is a charged service, or you do not know how much is charged for it, and you don't
    find out until it's too late. Especially when getting started, users may not fully
    appreciate the cost of the activities they're undertaking.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 不幸的是，这有时会导致所谓的**账单震惊**，即在月底时发生的情况。这通常是当你做了一些你可能不知道是收费服务的事情，或者你不知道它的收费标准，而直到太晚才发现时发生的。特别是在刚开始使用时，用户可能没有充分意识到他们所进行活动的费用。
- en: There are also ways to optimize your costs on AWS, for example, by transferring
    at slower speeds, removing external access, and so on. All this means that you
    should be aware of your cost obligations, and manage them in real time. To this
    end, you can create budgets that help you be aware of your usage and spending.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 你也可以通过一些方法来优化 AWS 上的成本，比如降低传输速度、取消外部访问等。这一切意味着你需要关注你的费用义务，并实时管理它们。为此，你可以创建预算，帮助你了解你的使用情况和支出。
- en: While you can create budgets via the AWS CLI tool, it is useful to know how
    the Billing dashboard works for administration purposes, so we will use the AWS
    console for this recipe.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然你可以通过 AWS CLI 工具创建预算，但了解计费仪表板的工作原理对于管理目的很有用，因此我们将使用 AWS 控制台进行本教程。
- en: Getting ready
  id: totrans-233
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备就绪
- en: By default, IAM Users do not have access to the billing section of the AWS console.
    You must perform these steps using the root login details for your account, or
    enable IAM access for other users, which is a one-off step.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，IAM 用户无法访问 AWS 控制台的计费部分。你必须使用账户的根登录信息执行这些步骤，或者为其他用户启用 IAM 访问权限，这是一次性操作。
- en: While you should not generally use the root credentials for your AWS account
    when administering, creating budgets (which should happen only infrequently) is
    an exception.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然在管理 AWS 账户时你通常不应使用根凭证，但创建预算（这种情况应该很少发生）是个例外。
- en: You *should not* be creating access keys for your root account under any circumstances,
    which is another reason why we use the console (and not the CLI) for this recipe.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 在任何情况下，您*不应该*为根帐户创建访问密钥，这也是为什么我们在此示例中使用控制台（而不是CLI）的另一个原因。
- en: How to do it...
  id: totrans-237
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何做...
- en: 'Log in to the AWS console with your root credentials, and navigate to the My
    Billing Dashboard via the user menu accessed by clicking on your name in the top
    right:'
  id: totrans-238
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用根凭据登录AWS控制台，并通过点击右上角的用户名访问的用户菜单导航到我的计费仪表板：
- en: '![](img/B06236_05_25.png)'
  id: totrans-239
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_25.png)'
- en: 'The Billing dashboard displays your up-to-date usage for the month. Click on
    Budgets in the left-hand menu:'
  id: totrans-240
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计费仪表板显示本月的最新使用情况。在左侧菜单中点击“预算”：
- en: '![](img/B06236_05_26.png)'
  id: totrans-241
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_26.png)'
- en: 'When you first arrive at the Budgets console, there will be no budgets to display.
    Click on the Create budget button to get started:'
  id: totrans-242
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当您首次进入预算控制台时，将没有预算可显示。点击“创建预算”按钮开始：
- en: '![](img/image_05_027.png)'
  id: totrans-243
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_05_027.png)'
- en: 'Start by filling out the budget details, such as `Cost` for the measurement
    type, `Monthly` for the period, and the budget amount. Select the Start date (which
    defaults to the first of the current month), and optionally the End date. Leave
    the End date field blank to create a rolling budget that is reset each month:'
  id: totrans-244
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先填写预算详情，例如`成本`作为测量类型，`每月`作为周期，以及预算金额。选择开始日期（默认为当月的第一天），以及可选的结束日期。将结束日期字段留空以创建每月重置的滚动预算：
- en: '![](img/B06236_05_28.png)'
  id: totrans-245
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_28.png)'
- en: 'Next enter the notification details. This includes the threshold for notification,
    which we will set to be 80% (of our budget) in forecasted use. For e-mail notifications,
    simply enter the e-mail addresses you want to receive the notifications. Click
    Create when finished:'
  id: totrans-246
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来输入通知详情。这包括通知阈值，我们将设置为预测使用量的80%（我们的预算）。对于电子邮件通知，只需输入您想要接收通知的电子邮件地址。完成后点击“创建”：
- en: '![](img/B06236_05_29.png)'
  id: totrans-247
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_29.png)'
- en: 'You will be returned to the Budgets section of the Billing dashboard, and you
    can see your newly created budget:'
  id: totrans-248
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您将返回到计费仪表板的预算部分，并可以看到您新创建的预算：
- en: '![](img/B06236_05_30.png)'
  id: totrans-249
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_30.png)'
- en: 'For each of the budgets you create, you can select it to view the full details:'
  id: totrans-250
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您创建的每个预算，都可以选择查看完整详情：
- en: '![](img/B06236_05_31.png)'
  id: totrans-251
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_31.png)'
- en: How it works...
  id: totrans-252
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 工作原理...
- en: The Billing dashboard is closely tied to the account itself, which is why it
    is not part of the regular services in the console. Accessing it via the user
    menu hints at the special access it requires. Generally, you would configure a
    budget when you first open a new AWS account, so you don't get any surprises in
    your bill at the end of the month.
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 计费仪表板与帐户本身紧密相关，这就是为什么它不是控制台中常规服务的一部分。通过用户菜单访问它暗示了它需要特殊访问权限。通常，您会在首次打开新的AWS帐户时配置预算，以便在月底不会有任何意外费用。
- en: If you get access denied messages in the Billing dashboard, it is most likely
    because you are using an IAM user and IAM access has not been enabled. You must
    use your root account credentials (such as that you used to create the account),
    or enable IAM access. IAM access can only be enabled by the root user.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 如果在计费仪表板中收到访问被拒绝的消息，很可能是因为您正在使用IAM用户，而IAM访问尚未启用。您必须使用根帐户凭据（例如您用来创建帐户的凭据），或者启用IAM访问。只有根用户才能启用IAM访问。
- en: When you first arrive at the billing section, you will see a high-level summary
    of your usage and expenses. As I performed this example in a new account, there's
    not much to see at this point. The Month-to-Date Spend by Service graph on the
    right can be particularly useful to find out what the most popular services you
    use are. This is a great place to start when trying to reduce or optimize your
    AWS spending.
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 当您首次进入计费部分时，您将看到您的使用情况和费用的高级摘要。由于我在一个新帐户中执行了此示例，目前没有太多可见的内容。右侧的按服务分类的当月支出图表尤其有用，可以帮助您找出您最常使用的服务是什么。这是在尝试减少或优化AWS支出时的绝佳起点。
- en: We then navigate to the budgets section and create a new budget. Most of the
    details should be self-explanatory, and obvious for the purposes of budgeting.
    Your main choice is to decide if you want to alert on usage or costs. Cost budgets
    work against the dollar (or appropriate billing currency) amount you will be charged.
    Usage budgets work against a selected unit of usage, for example, instance hours
    or data transfer for EC2\. A usage budget can only track one type of usage unit,
    so you will need to create multiple budgets to track the various units that you
    might be charged for. This is one reason why we prefer a cost budget, as it takes
    into account multiple forms of usage.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们进入预算部分并创建一个新预算。大多数细节应该是显而易见的，目的就是为了预算管理。你主要的选择是决定是否要针对使用量或费用发出警报。费用预算是基于你将被收取的美元（或适当的计费货币）金额。使用量预算是基于所选的使用单位，例如EC2的实例小时数或数据传输量。一个使用量预算只能跟踪一种使用单位，因此你需要创建多个预算来跟踪可能会被收费的各种单位。这也是我们更倾向于使用费用预算的原因，因为它考虑了多种使用形式。
- en: Specifying e-mail addresses to alert is the simplest way to send any alerts
    from the budget. For more advanced use cases, you can specify an SNS topic to
    receive notifications. An example might be if you wanted to receive budget alerts
    on your phone via an SMS message, or send the alert to a different system automatically
    (via HTTP/JSON).
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 指定电子邮件地址进行警报通知是发送预算警报的最简单方法。对于更高级的用例，你可以指定一个SNS主题来接收通知。例如，如果你想通过短信在手机上接收预算警报，或者将警报自动发送到其他系统（通过HTTP/JSON），都可以。
- en: Once finished, you can view all your budgets in the dashboard. You can repeat
    the process to create multiple budgets. This means you can create budgets for
    forecast usage and actual usage, as well as different time periods.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 完成后，你可以在仪表盘中查看所有预算。你可以重复这个过程来创建多个预算。这意味着你可以为预测使用量和实际使用量创建预算，也可以为不同的时间段创建预算。
- en: Feeding log files into CloudWatch logs
  id: totrans-259
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将日志文件发送到CloudWatch日志
- en: '**CloudWatch logs** is a managed, highly durable, log storage system in AWS.
    It''s capable of ingesting logs from many sources. We''re going to focus on what
    is probably the most common use case which is shipping logs off your EC2 instances
    into CloudWatch logs.'
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: '**CloudWatch日志**是AWS中一个托管的、高度持久化的日志存储系统。它能够从多个源摄取日志。我们将重点介绍最常见的用例之一，即将日志从EC2实例发送到CloudWatch日志。'
- en: This capability is particularly important in highly dynamic auto scaling environments.
    Since the lifetime of your EC2 instances can be quite short, any logs which are
    written only to a local disk will be lost upon instance termination. You'll inevitably
    find yourself wishing you had access to server logs after an instance has disappeared.
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 这个功能在高度动态的自动扩展环境中尤为重要。由于EC2实例的生命周期可能非常短暂，任何仅写入本地磁盘的日志都会在实例终止时丢失。你不可避免地会发现自己在实例消失后希望能够访问服务器日志。
- en: The following pattern we're about to show you allows you to aggregate, search
    and filter log entries across a number of sources. You can then create custom
    metrics and trigger alarms based on log activity. Super handy!
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 我们即将展示的以下模式允许你聚合、搜索和筛选来自多个源的日志条目。你可以根据日志活动创建自定义指标并触发报警。非常方便！
- en: 'In this recipe we''re going to:'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个方案中，我们将：
- en: Launch an EC2 instance
  id: totrans-264
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 启动一个EC2实例
- en: Configure it to send logs to CloudWatch logs
  id: totrans-265
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置它将日志发送到CloudWatch日志
- en: Create a filter based on SSH logins to the instance
  id: totrans-266
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基于SSH登录实例创建一个筛选器
- en: Send ourselves an e-mail alert on filter matches
  id: totrans-267
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在筛选匹配时向自己发送电子邮件警报
- en: This might be something you'd consider doing on your bastion boxes since they
    will typically be the sole point of SSH access to your environments and it can
    be a good idea to make a lot of noise if people are logging in to production servers.
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 这可能是你考虑在堡垒主机上执行的操作，因为它们通常是你环境中SSH访问的唯一入口点，并且如果有人登录到生产服务器，制造一些噪音是个好主意。
- en: Getting ready
  id: totrans-269
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: We're going to do all of this in `us-east-1` with the AWS Linux AMI. If you
    wish to do this in a different region you'll simply need to provide a different
    AMI ID to the template we're going to create.
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在`us-east-1`区域使用AWS Linux AMI来完成所有操作。如果你希望在其他区域执行此操作，只需向我们将要创建的模板提供不同的AMI
    ID即可。
- en: 'Let''s get in to it; you''ll need the following:'
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们开始吧；你将需要以下内容：
- en: The VPC ID of your default VPC in `us-east-1`. You don't have to use the default
    VPC, you'll just need to make sure you choose a VPC which has a public subnet
    (which is configured to assign public IP addresses)
  id: totrans-272
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`us-east-1`区域中默认VPC的VPC ID。你不必使用默认VPC，只需确保选择一个具有公共子网（已配置为分配公共IP地址）的VPC即可。'
- en: The subnet ID of the public subnet
  id: totrans-273
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 公共子网的子网ID
- en: An SSH key pair configured in `us-east-1`
  id: totrans-274
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在`us-east-1`中配置的SSH密钥对
- en: An e-mail address we can send alerts to
  id: totrans-275
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个我们可以发送警报到的电子邮件地址
- en: How to do it...
  id: totrans-276
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Create a new CloudFormation template. Add the following `Parameters` to it:'
  id: totrans-277
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个新的CloudFormation模板。将以下`Parameters`添加到模板中：
- en: '[PRE6]'
  id: totrans-278
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Now for the `Resources`, we need to define a `Role` and `InstanceProfile` for
    our EC2 instance. This will give our server the appropriate permissions to send
    logs to CloudWatch.
  id: totrans-279
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，对于`Resources`，我们需要为我们的EC2实例定义一个`Role`和`InstanceProfile`。这将赋予我们的服务器适当的权限，允许它将日志发送到CloudWatch。
- en: '[PRE7]'
  id: totrans-280
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Our instance will need to live in a security group which allows SSH access,
    so let''s add that now:'
  id: totrans-281
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们的实例需要位于一个允许SSH访问的安全组中，因此我们现在就添加这个安全组：
- en: '[PRE8]'
  id: totrans-282
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Next we can define our instance. We make sure to use the profile and security
    group we just created and we also add a small amount of user-data which does the
    following:'
  id: totrans-283
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们可以定义我们的实例。我们确保使用我们刚创建的配置文件和安全组，并添加一些用户数据，具体操作如下：
- en: Install the `awslogs` package.
  id: totrans-284
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装`awslogs`包。
- en: Writes a configuration file which will ship `/var/log/secure` to CloudWatch
    logs.
  id: totrans-285
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 写入一个配置文件，将`/var/log/secure`发送到CloudWatch日志。
- en: Starts the `awslogs` service.
  id: totrans-286
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动`awslogs`服务。
- en: Make the `awslogs` service start on boot (in case of reboot).
  id: totrans-287
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使`awslogs`服务在启动时自动启动（以应对重启情况）。
- en: '[PRE9]'
  id: totrans-288
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'We''re now going to add an SNS topic. This topic will receive alerts and forward
    them to the e-mail address we''re using for alerts:'
  id: totrans-289
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们现在将添加一个SNS主题。这个主题将接收警报并将其转发到我们用于接收警报的电子邮件地址：
- en: '[PRE10]'
  id: totrans-290
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Next, we need to filter our `/var/log/secure` logs for logins. A `MetricFilter`
    resource allows us to do this. CloudFormation will throw an error if we refer
    to a log group which doesn''t yet exist, so we add that here too (with a `DependsOn`
    reference):'
  id: totrans-291
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们需要过滤`/var/log/secure`中的登录日志。`MetricFilter`资源允许我们这样做。如果我们引用了一个尚不存在的日志组，CloudFormation会抛出错误，因此我们也在这里添加该日志组（通过`DependsOn`引用）：
- en: '[PRE11]'
  id: totrans-292
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'The last `Resource` we need is the actual `Alarm`. Add it like so:'
  id: totrans-293
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们需要的最后一个`资源`是实际的`Alarm`。像这样添加：
- en: '[PRE12]'
  id: totrans-294
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Lastly, we''ll add the public IP address of our instance to the `Outputs` so
    we don''t need to go to the EC2 web console to look it up:'
  id: totrans-295
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，我们将实例的公共IP地址添加到`Outputs`中，这样我们就不需要进入EC2 web控制台去查找它：
- en: '[PRE13]'
  id: totrans-296
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Go ahead and launch this CloudFormation stack. You can do it from the AWS CLI
    like this:'
  id: totrans-297
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 继续并启动这个CloudFormation堆栈。你可以通过AWS CLI像这样启动：
- en: '[PRE14]'
  id: totrans-298
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Before proceeding you''ll need to check your e-mail and confirm your subscription
    to the SNS topic. If you don''t do this you won''t receive any alerts from CloudWatch:'
  id: totrans-299
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在继续之前，你需要检查你的电子邮件并确认你对SNS主题的订阅。如果你不这样做，就不会收到来自CloudWatch的任何警报：
- en: '![](img/B06236_05_32.png)'
  id: totrans-300
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_32.png)'
- en: 'In the following screenshot, an example of confirmed subscription is illustrated:'
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下截图中，展示了确认订阅的示例：
- en: '![](img/image_05_033.png)'
  id: totrans-302
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_05_033.png)'
- en: 'Go ahead and SSH to your instance. If your login is successful, you''ll see
    your alarm triggered in the CloudWatch web console:'
  id: totrans-303
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 继续并通过SSH连接到你的实例。如果登录成功，你将在CloudWatch web控制台看到触发的警报：
- en: '![](img/B06236_05_34.png)'
  id: totrans-304
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_34.png)'
- en: 'An e-mail will land in your inbox as shown in the following screenshot:'
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 一封电子邮件将发送到你的收件箱，如以下截图所示：
- en: '![](img/B06236_05_35.png)'
  id: totrans-306
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B06236_05_35.png)'
- en: How it works...
  id: totrans-307
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: It's important that you understand the difference between log streams and log
    groups.
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: 理解日志流和日志组之间的区别非常重要。
- en: '**Log streams** are log sequences which come from a single source. This could
    be an EC2 instance, an application process, or another source within AWS. In our
    case the name of our log stream is the ID of our EC2 instance. In fact, the CloudWatch
    logs agent will set the `log_stream_name` to the instance ID by default.'
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: '**日志流**是来自单一源的日志序列。这可以是一个EC2实例、一个应用程序进程，或者AWS中的其他源。在我们的案例中，日志流的名称是我们EC2实例的ID。实际上，CloudWatch日志代理默认会将`log_stream_name`设置为实例ID。'
- en: '**Log groups** are collections of log streams with the same properties. In
    our previous example, the log groups will correspond to `/var/log/secure`. So,
    we end up with a configuration which looks like:'
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: '**日志组**是具有相同属性的日志流的集合。在我们之前的例子中，日志组将对应于`/var/log/secure`。因此，我们最终得到的配置如下：'
- en: '[PRE15]'
  id: totrans-311
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'When you install the CloudWatch logs agent, it actually sets up `/var/log/messages`
    in exactly the same manner as we''ve just described:'
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: 当你安装 CloudWatch 日志代理时，它实际上会以我们刚才描述的相同方式设置`/var/log/messages`：
- en: '[PRE16]'
  id: totrans-313
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Once the agent has started, it will ship new log entries off the box to CloudWatch
    logs approximately every 5 seconds.
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦代理启动，它将大约每 5 秒钟将新的日志条目发送到 CloudWatch 日志。
- en: There's more...
  id: totrans-315
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多...
- en: CloudWatch logs supports ingestion of traditional text-based log entries as
    well as JSON formatted logs.
  id: totrans-316
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: CloudWatch 日志支持传统文本格式日志条目以及 JSON 格式日志的摄取。
- en: Logs can be ingested from other sources including CloudTrail, IAM, Kinesis Streams
    and Lambda.
  id: totrans-317
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 日志可以从其他来源摄取，包括 CloudTrail、IAM、Kinesis Streams 和 Lambda。
- en: By default, logs are stored indefinitely. You can customize this time period
    to suit your needs however.
  id: totrans-318
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 默认情况下，日志会被无限期存储。不过，你可以根据需要自定义这个时间周期。
- en: Metric filters, like the one we created previously, can be used to graph and
    chart in the CloudWatch console. Add them to your dashboards as well as your alerting
    system.
  id: totrans-319
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 度量过滤器（比如我们之前创建的那个）可以用于在 CloudWatch 控制台中绘制图表和图形。将它们添加到你的仪表板以及警报系统中。
- en: 'The CloudWatch web console allows you to test metric filters before you add
    them. Using this feature will save you a lot of trial and error with CloudFormation.
    Don''t rely on the web console completely however: you should move these metric
    filters to CloudFormation as soon as you get them right.'
  id: totrans-320
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: CloudWatch 网页控制台允许你在添加度量过滤器之前进行测试。使用此功能可以节省大量在 CloudFormation 中的试错时间。但请不要完全依赖网页控制台：一旦调试正确，你应该将这些度量过滤器迁移到
    CloudFormation 中。
- en: There is a one-one relationship between a log stream and a log source. For example,
    you can't have multiple instances sending `/var/log/secure` to the same log stream.
  id: totrans-321
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 日志流和日志源之间是 1 对 1 的关系。例如，你不能让多个实例将`/var/log/secure`发送到同一个日志流。
- en: The non-alarm state for the alarm we've created, will be INSUFFICIENT_DATA.
    This is because our metric filter outputs a value only if a login is detected.
  id: totrans-322
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们创建的报警的非警报状态将是 INSUFFICIENT_DATA。这是因为我们的度量过滤器仅在检测到登录时才会输出值。
