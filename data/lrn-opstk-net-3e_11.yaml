- en: Router Redundancy Using VRRP
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 VRRP 的路由冗余
- en: In the Juno release of OpenStack, the Neutron community introduced two methods
    of attaining high availability in routing. This chapter focuses on a method that
    uses the Virtual Routing Redundancy Protocol, also known as VRRP, to implement
    redundancy between two or more Neutron routers. High availability using distributed
    virtual routers, otherwise known as DVR, will be discussed in [*Chapter 12*](b441728b-4377-43cf-b675-166266fef6c9.xhtml)*,
    Distributed Virtual Routers*.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在 OpenStack 的 Juno 版本中，Neutron 社区引入了实现路由高可用性的两种方法。本章重点介绍使用虚拟路由冗余协议（即 VRRP）来实现两个或多个
    Neutron 路由器之间冗余的方法。关于使用分布式虚拟路由器（DVR）实现的高可用性，将在[*第 12 章*](b441728b-4377-43cf-b675-166266fef6c9.xhtml)《分布式虚拟路由器》中讨论。
- en: 'In the previous chapter, we explored the concept of standalone routers and
    how they allow users to route traffic between project networks and external networks
    as well as provide network address translation for instances managed by the user.
    In this chapter, we will cover the following topics:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们探讨了独立路由器的概念以及它们如何允许用户在项目网络和外部网络之间路由流量，并为用户管理的实例提供网络地址转换。在本章中，我们将覆盖以下内容：
- en: High availability of routing using keepalived and VRRP
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 keepalived 和 VRRP 提供高可用性的路由
- en: Installing and configuring additional L3 agents
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装和配置额外的 L3 代理
- en: Demonstrating the creation and management of a highly-available router
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 演示创建和管理高可用性路由器
- en: Using keepalived and VRRP to provide redundancy
  id: totrans-6
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 keepalived 和 VRRP 提供冗余
- en: Keepalived is a software package for Linux that provides load balancing and
    high availability to Linux-based software and infrastructures.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: Keepalived 是一个 Linux 软件包，为基于 Linux 的软件和基础设施提供负载均衡和高可用性。
- en: The Virtual Router Redundancy Protocol, or VRRP, is a first hop redundancy protocol
    that aims to provide high availability of a network's default gateway by allowing
    two or more routers to provide backup for that address. If the active router fails,
    a backup router will take over the address within a brief period of time. VRRP
    is an open standard and is based on the proprietary Hot Standby Router Protocol,
    or HSRP, developed by Cisco.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟路由冗余协议（VRRP）是一种首跳冗余协议，旨在通过允许两个或更多的路由器为网络的默认网关提供备份，从而提供高可用性。如果主用路由器发生故障，备份路由器将在短时间内接管该地址。VRRP
    是一个开放标准，基于 Cisco 开发的专有热备份路由协议（HSRP）。
- en: Neutron uses keepalived, which utilizes VRRP, to provide failover between multiple
    sets of router namespaces.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: Neutron 使用 keepalived，进而利用 VRRP，为多个路由器命名空间提供故障转移。
- en: VRRP groups
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: VRRP 组
- en: With VRRP, a group of routers can be configured to act as a single virtual router.
    Routers in the VRRP group elect a master to act as the active gateway device,
    and hosts in the network only need to configure the virtual router address as
    their default network gateway or next hop address. When a failover occurs, another
    router in the group will take over routing duties while the configuration of hosts
    in the network never changes.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 VRRP，可以将一组路由器配置为充当一个虚拟路由器。VRRP 组中的路由器选举一个主路由器作为活动网关设备，网络中的主机只需将虚拟路由器地址配置为其默认网关或下一跳地址。当发生故障切换时，组中的另一个路由器将接管路由工作，而网络中主机的配置保持不变。
- en: A VRRP virtual router should not be confused with a Neutron virtual router.
    The former represents a logical entity, while the latter actually exists as a
    virtualized routing device, typically implemented as a network namespace.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: VRRP 虚拟路由器不应与 Neutron 虚拟路由器混淆。前者代表一个逻辑实体，而后者实际上作为一个虚拟化的路由设备存在，通常实现为网络命名空间。
- en: 'In the following diagram, Router A, Router B, and Router C form a single virtual
    router. In this configuration, each router has its own IP address and the virtual
    router has its own IP address. Hosts in the network use the virtual router address
    as their default gateway:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 在下图中，路由器 A、路由器 B 和路由器 C 组成一个虚拟路由器。在此配置中，每个路由器都有自己的 IP 地址，而虚拟路由器有自己的 IP 地址。网络中的主机将虚拟路由器地址作为其默认网关：
- en: '![](img/080aa743-df33-458e-98db-67c3c051babf.png)'
  id: totrans-14
  prefs: []
  type: TYPE_IMG
  zh: '![](img/080aa743-df33-458e-98db-67c3c051babf.png)'
- en: As the master router, Router B in the preceding diagram is responsible for the
    virtual address `192.168.1.1`, and routes traffic for hosts using that address
    as their gateway. The master router sends VRRP advertisements to the group, which
    include the priority and state of the master router using the multicast address
    `224.0.0.18`. The backup routers use a variety of timers and configuration options
    to determine when a master router has failed and change their state accordingly.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的图示中，作为主路由器的路由器 B 负责虚拟地址`192.168.1.1`，并为使用该地址作为网关的主机路由流量。主路由器通过多播地址`224.0.0.18`向组发送
    VRRP 广告，广告中包括主路由器的优先级和状态。备份路由器使用多种定时器和配置选项来判断主路由器是否失败，并据此改变其状态。
- en: Routers that make up the virtual router communicate between themselves using
    the multicast IP address `224.0.0.18` and IP protocol number 112\. The network
    setup for this communication is automatically configured and is not impacted by
    security group rules or manageable by users or operators.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 组成虚拟路由器的路由器通过多播 IP 地址`224.0.0.18`和 IP 协议号 112 进行通信。该通信的网络设置是自动配置的，不受安全组规则的影响，且无法由用户或操作员进行管理。
- en: VRRP priority
  id: totrans-17
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: VRRP 优先级
- en: Routers in the VRRP group elect a master router according to their priorities.
    The router with the highest priority is elected master, while the other routers
    in the group are relegated to backup duties. When a master router fails to send
    its VRRP advertisements to the group, the backup routers in the VRRP group elect
    a new master to replace the failed master.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: VRRP 组中的路由器根据优先级选举主路由器。具有最高优先级的路由器被选为主路由器，而组中的其他路由器则担任备份角色。当主路由器未能向组发送其 VRRP
    广告时，VRRP 组中的备份路由器将选举新的主路由器来替代失败的主路由器。
- en: VRRP priorities range from 0 to 255, with 255 being the highest priority. Neutron
    configures each router in a group with the same priority of 50\. Because the priority
    is the same between routers, in the event of a failover, the election process
    falls back to the highest IP address. That is to say that a backup router with
    IP address `192.168.1.200` on the HA interface will be elected master over a router
    with IP address `192.168.1.100`.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: VRRP 优先级的范围是 0 到 255，255 为最高优先级。Neutron 为组中的每个路由器配置相同的优先级 50。由于路由器之间的优先级相同，因此在故障切换时，选举过程将回退到最高
    IP 地址。也就是说，HA 接口上具有 IP 地址`192.168.1.200`的备份路由器将被选为主路由器，而具有 IP 地址`192.168.1.100`的路由器将被替换。
- en: VRRP working mode
  id: totrans-20
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: VRRP 工作模式
- en: 'A router in a VRRP group works in one of two modes: preemptive and non-preemptive.'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: VRRP 组中的路由器工作模式有两种：抢占模式和非抢占模式。
- en: Preemptive
  id: totrans-22
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 抢占模式
- en: In preemptive mode, when a master router fails, it becomes the master router
    again when it returns to a group and has a higher priority than the newly elected
    master.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 在抢占模式下，当主路由器发生故障时，它在重新加入组并且优先级高于新选举的主路由器时，会重新成为主路由器。
- en: Non-preemptive
  id: totrans-24
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 非抢占模式
- en: In non-preemptive mode, when a router in a VRRP group becomes the master, it
    continues to operate as the master under normal working conditions. If a backup
    router is assigned a higher priority later, the active master router will continue
    to operate as the master until it fails.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 在非抢占模式下，当 VRRP 组中的一个路由器成为主路由器时，它将在正常工作条件下继续作为主路由器工作。如果后来为一个备份路由器分配了更高的优先级，当前活动的主路由器将继续作为主路由器，直到它发生故障。
- en: As of the Kilo release of OpenStack, Neutron configures each router to act in
    non-preemptive mode, although this may change in the future. In the event of a
    failure of the HA network, which is used for communication between the routers,
    a failed master router may not detect that it has failed. It can continue to operate
    as a master router, even though another router has been elected master. The lack
    of connectivity between the routers means that all routers may not receive VRRP
    advertisements. When connectivity is re-established, the routers may engage in
    an election to determine a single master router. This failure scenario is not
    common, but one to keep in mind when troubleshooting issues with highly-available
    routers.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 从 OpenStack Kilo 版本开始，Neutron 配置每个路由器以非抢占模式工作，尽管将来可能会有所变化。如果用于路由器间通信的 HA 网络发生故障，失败的主路由器可能无法检测到它已经故障。它仍然可以继续作为主路由器运行，即使另一个路由器已经被选为主路由器。路由器之间的连接丧失意味着所有路由器可能无法接收到
    VRRP 广告。当连接恢复后，路由器可能会进行选举，选出一个主路由器。这种故障场景不常见，但在故障排查高可用路由器的问题时需要注意。
- en: VRRP timers
  id: totrans-27
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: VRRP 定时器
- en: Timers that are used within VRRP include an advertisement interval timer and
    a preemption delay timer.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: VRRP 中使用的定时器包括广告间隔定时器和抢占延迟定时器。
- en: Advertisement interval timer
  id: totrans-29
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 广告间隔定时器
- en: The master router in a VRRP group periodically sends advertisements on an interval
    established by the advertisement interval timer to inform other routers in the
    group that it is operating properly. If a backup router does not receive advertisements
    in a period of three times the interval, the backup regards itself as the master
    and sends VRRP advertisements to start a new master election process. Neutron
    routers in a master state are configured to send advertisements every two seconds.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: VRRP 组中的主路由器会定期发送广告，发送间隔由广告间隔定时器设定，用以通知组中的其他路由器其运行正常。如果备份路由器在三倍于该间隔的时间内没有收到广告，它会认为自己是主路由器，并发送
    VRRP 广告以启动新的主路由器选举流程。Neutron 中处于主路由器状态的路由器配置为每两秒发送一次广告。
- en: Preemption delay timer
  id: totrans-31
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 抢占延迟定时器
- en: After a backup router receives an advertisement with a priority lower than itself,
    it waits for a period of time established by the preemption delay timer before
    sending out VRRP advertisements to start a new master election. This delay helps
    the routers avoid frequent state changes among members of the VRRP group in cases
    of network flapping. Because preemption is not enabled within Neutron routers,
    this timer is not configured.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 当一个备份路由器收到优先级低于自身的广告时，它会在由抢占延迟定时器设定的时间内等待，然后发送 VRRP 广告以启动新的主路由器选举。这个延迟有助于路由器避免在网络波动的情况下，频繁地改变
    VRRP 组成员的状态。由于 Neutron 路由器中没有启用抢占机制，因此不会配置这个定时器。
- en: Networking of highly available routers
  id: totrans-33
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 高可用路由器的网络配置
- en: When a highly-available router is created, Neutron creates a VRRP group composed
    of at least two router namespaces by default. The namespaces are spread across
    multiple hosts running the Neutron L3 agent, and each runs the keepalived service
    with an automatically generated configuration. Traffic between the routers uses
    a dedicated network interface, which is discussed in the following section.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 当创建一个高可用路由器时，Neutron 默认会创建一个由至少两个路由器命名空间组成的 VRRP 组。这些命名空间分布在多个运行 Neutron L3
    代理的主机上，每个命名空间都会运行一个自动生成配置的 keepalived 服务。路由器之间的流量通过一个专用的网络接口进行传输，具体内容将在下一节讨论。
- en: Dedicated HA network
  id: totrans-35
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 专用高可用网络
- en: Routers in a VRRP group communicate among one another over a dedicated HA network.
    An HA router is automatically configured with an interface prefixed with that
    is only used for this communication.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: VRRP 组中的路由器通过专用的高可用网络相互通信。高可用路由器会自动配置一个以该接口为前缀的接口，该接口仅用于此通信。
- en: The first time an HA router is created in a project, Neutron configures a network
    and subnet using the CIDR `169.254.192.0/18`. The network type used is based on
    the default project network type. Only one HA network is created per project,
    and it is used by all HA routers that are created by that project. If all HA routers
    in a project are deleted, the HA network will remain and will be reused for all
    other HA routers that get created by the project in the future.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 在项目中第一次创建高可用路由器时，Neutron 会使用 CIDR `169.254.192.0/18` 配置一个网络和子网。所使用的网络类型基于默认项目网络类型。每个项目仅创建一个高可用网络，并且该网络会被该项目创建的所有高可用路由器使用。如果项目中的所有高可用路由器被删除，该高可用网络将保留，并且在该项目未来创建的所有其他高可用路由器中重新使用。
- en: Networks created by Neutron for VRRP communication between routers are not actually
    assigned to projects. As a result, these networks are hidden from regular users
    in the CLI and GUI. The name of the network reflects the associated project, however,
    and is used by the L3 agent for identification purposes. Under normal conditions,
    an HA network should remain hidden and not be modified by users or administrators.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: Neutron 为路由器之间的 VRRP 通信创建的网络实际上并不会分配给项目。因此，这些网络在 CLI 和 GUI 中对普通用户是隐藏的。然而，网络的名称反映了关联的项目，并被
    L3 代理用于标识目的。在正常情况下，一个高可用网络应保持隐藏状态，且不应由用户或管理员修改。
- en: Limitations
  id: totrans-39
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 限制
- en: VRRP utilizes a virtual router identifier, or VRID, to exchange VRRP protocol
    messages over multicast with other routers using the same VRID to determine which
    is the master router. The VRID is 8 bits in length and the valid range is 1-255\.
    Because each project uses a single administrative network for VRRP communication
    between routers, individual projects are limited to 255 highly-available routers.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: VRRP利用虚拟路由器标识符（VRID）通过多播与使用相同VRID的其他路由器交换VRRP协议消息，以确定哪一个是主路由器。VRID的长度为8位，有效范围为1-255。由于每个项目使用一个单一的管理网络进行路由器之间的VRRP通信，每个项目的高可用路由器数量最多为255个。
- en: Virtual IP
  id: totrans-41
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 虚拟IP
- en: A VRRP virtual router has a virtual IP address that can serve as the default
    gateway for hosts in the network. The master router owns the IP address until
    a failover event occurs, at which time a backup router becomes the new master
    and takes over the IP and associated routing duties.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: VRRP虚拟路由器具有一个虚拟IP地址，可以作为网络中主机的默认网关。主路由器拥有该IP地址，直到发生故障切换事件，此时备份路由器成为新的主路由器，并接管该IP和相关的路由职责。
- en: Due to limitations with keepalived, Neutron HA routers do not completely follow
    the VRRP networking conventions described up to this point. Neutron assigns a
    single virtual IP to an HA router, and that virtual IP is only configured on the
    master router in the group at any given time. While the address does fail over
    between routers during a failover event, it is not actually used as a gateway
    address for any network. As HA routers are created, a new virtual IP address is
    assigned to the respective group.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 由于keepalived的限制，Neutron HA路由器并未完全遵循至此为止描述的VRRP网络规范。Neutron为一个高可用路由器分配一个虚拟IP，并且该虚拟IP仅在该组的主路由器上配置。在故障切换事件中，虽然该地址会在路由器之间进行切换，但它实际上并未作为任何网络的网关地址使用。随着高可用路由器的创建，一个新的虚拟IP地址将分配给相应的组。
- en: Neutron assigns virtual IP addresses from the `169.254.0.0/24` network by default.
    If an HA router's VRID is 5, then the assigned virtual IP would be `169.254.0.5`.
    Using the VRID in the virtual IP assignment process assures that the address is
    consistent among HA router instances on different nodes without having to be stored
    in the database.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Neutron从`169.254.0.0/24`网络分配虚拟IP地址。如果高可用路由器的VRID为5，则分配的虚拟IP将是`169.254.0.5`。在虚拟IP分配过程中使用VRID可以确保不同节点上的高可用路由器实例之间地址的一致性，而无需将其存储在数据库中。
- en: 'Instead of using virtual addresses for each connected subnet, Neutron uses
    the `virtual_ipaddress_excluded` configuration section found within the `keepalived
    configuration` file to specify routes, addresses, and their respective interfaces
    that should be configured when a router becomes master for the group. Likewise,
    the interface configuration will be removed once the router becomes a backup router.
    The following screenshot demonstrates various interfaces and routes that will
    be modified:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: Neutron并不为每个连接的子网使用虚拟地址，而是通过在`keepalived配置`文件中找到的`virtual_ipaddress_excluded`配置节来指定路由、地址及其各自的接口，这些内容将在路由器成为该组的主路由器时进行配置。同样，当路由器成为备份路由器时，接口配置将被移除。以下截图展示了将被修改的各种接口和路由：
- en: '![](img/f9b3befd-420d-4910-9529-7347e2154b17.png)'
  id: totrans-46
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f9b3befd-420d-4910-9529-7347e2154b17.png)'
- en: The keepalived configuration file for an HA router will be discussed in further
    detail later in this chapter.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 本章稍后将详细讨论高可用路由器的keepalived配置文件。
- en: The reason for this behavior is due to the keepalived service being limited
    to 20 configured virtual addresses, which could artificially limit the number
    of subnets attached to a Neutron router. The use of `virtual_ipaddress_excluded`
    is a known workaround of that limitation.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 这种行为的原因是因为keepalived服务对已配置的虚拟地址数量有限制（最多20个），这可能会人为地限制附加到Neutron路由器的子网数量。使用`virtual_ipaddress_excluded`是已知的解决该限制的变通方法。
- en: Determining the master router
  id: totrans-49
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 确定主路由器
- en: 'In the following screenshot, an HA router without any connected gateway or
    project networks is scheduled across three L3 agents running on a single `controller`
    and two compute nodes:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下截图中，一个没有连接任何网关或项目网络的高可用路由器被调度到三个L3代理上，这些L3代理运行在单一的`控制器`和两个计算节点上：
- en: '![](img/59b9a246-80eb-4226-9244-9793e4d9395f.png)'
  id: totrans-51
  prefs: []
  type: TYPE_IMG
  zh: '![](img/59b9a246-80eb-4226-9244-9793e4d9395f.png)'
- en: The Neutron L3 agent is commonly installed on controller or network nodes, but
    can be installed on `compute` nodes as well. This is especially true when distributed
    virtual routers are configured.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: Neutron L3代理通常安装在控制节点或网络节点上，但也可以安装在`计算`节点上。特别是在配置分布式虚拟路由器时，情况尤为如此。
- en: In the preceding example, one router acts as the master while the other two
    are relegated to backup duties. The HA interfaces are used for communication between
    the routers. At any given time, only the master router should have the virtual
    IP address `169.254.0.1` configured on its HA interface.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的示例中，一个路由器充当主路由器，其他两个则作为备份。HA 接口用于路由器之间的通信。任何时候，只有主路由器的 HA 接口上应该配置虚拟 IP 地址
    `169.254.0.1`。
- en: Installing and configuring additional L3 agents
  id: totrans-54
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装和配置额外的 L3 代理
- en: 'To configure HA routers, two or more L3 agents are required. The L3 agent was
    installed on the `controller01` node in the previous chapter. On all remaining
    `compute` nodes, run the following command to install the L3 agent:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 要配置 HA 路由器，需要两个或更多 L3 代理。在前一章中，L3 代理已安装在 `controller01` 节点上。在所有剩余的 `compute`
    节点上，运行以下命令安装 L3 代理：
- en: '[PRE0]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Defining an interface driver
  id: totrans-57
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 定义接口驱动
- en: Both the Linux bridge and Open vSwitch mechanism drivers support HA routers,
    and the Neutron L3 agent must be configured to use the interface driver that corresponds
    to the chosen mechanism driver.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: Linux 桥接和 Open vSwitch 机制驱动都支持 HA 路由器，且必须配置 Neutron L3 代理，以使用与所选机制驱动相对应的接口驱动。
- en: 'Update the Neutron L3 configuration file on the `compute` nodes at `/etc/neutron/l3_agent.ini`
    and specify one of the following interface drivers:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 在 `compute` 节点上更新 Neutron L3 配置文件 `/etc/neutron/l3_agent.ini`，并指定以下接口驱动之一：
- en: 'On `compute01` running the Linux bridge agent:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 在 `compute01` 上运行 Linux 桥接代理：
- en: '[PRE1]'
  id: totrans-61
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'On `compute02` and running the Open vSwitch agent:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 在 `compute02` 上运行 Open vSwitch 代理：
- en: '[PRE2]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Setting the agent mode
  id: totrans-64
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置代理模式
- en: The Neutron `L3` agent considers HA routers as legacy routers, as many of the
    same mechanisms used for standalone routers are shared with HA routers. Therefore,
    the default value for `agent_mode` of `legacy` shall remain unchanged for the
    remainder of this chapter.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: Neutron `L3` 代理将 HA 路由器视为传统路由器，因为许多用于独立路由器的相同机制也适用于 HA 路由器。因此，`agent_mode` 的默认值为
    `legacy`，在本章余下部分应保持不变。
- en: Restarting the Neutron L3 agent
  id: totrans-66
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 重启 Neutron L3 代理
- en: 'After making changes to the configuration of the Neutron L3 agent, issue the
    following command on the `compute` nodes to restart the agent:'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 在修改 Neutron L3 代理的配置后，在 `compute` 节点上执行以下命令重启代理：
- en: '[PRE3]'
  id: totrans-68
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'After a restart of the services, the additional agents should check in. Use
    the following `openstack network agent list` command to return a listing of all L3
    agents:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 服务重启后，额外的代理应会注册。使用以下 `openstack network agent list` 命令列出所有 L3 代理：
- en: '[PRE4]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The output should resemble the following:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 输出应类似于以下内容：
- en: '![](img/03668108-9251-4ba4-863d-17b9888ce895.png)'
  id: totrans-72
  prefs: []
  type: TYPE_IMG
  zh: '![](img/03668108-9251-4ba4-863d-17b9888ce895.png)'
- en: If an agent is not listed in the output as expected, troubleshoot any errors
    that may be indicated in the `/var/log/neutron/l3-agent.log` log file on the respective
    node.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 如果输出中未按预期列出代理，请排查 `/var/log/neutron/l3-agent.log` 日志文件中可能指示的任何错误。
- en: Configuring Neutron
  id: totrans-74
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置 Neutron
- en: Neutron uses default settings to determine the type of routers that users are
    allowed to create. In addition, the settings also specify the number of routers
    that make up a VRRP group, the default HA network CIDR, and the default network
    type.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: Neutron 使用默认设置来确定用户允许创建的路由器类型。此外，这些设置还指定了组成 VRRP 组的路由器数量、默认 HA 网络 CIDR 以及默认网络类型。
- en: 'The following settings are specified within the Neutron configuration file
    at `/etc/neutron/neutron.conf`, and only need to be modified on the host(s) running
    the Neutron API service. In this environment, the `neutron-server` service runs
    on the `controller01` node:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 以下设置在 Neutron 配置文件 `/etc/neutron/neutron.conf` 中指定，仅需在运行 Neutron API 服务的主机上进行修改。在此环境中，`neutron-server`
    服务运行在 `controller01` 节点上：
- en: '[PRE5]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: To set HA routers as the default router type for projects, set the `l3_ha` configuration
    option to `True` in `neutron.conf`. For this demonstration, the default value
    of `False` is sufficient.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 要将 HA 路由器设置为项目的默认路由器类型，请在 `neutron.conf` 中将 `l3_ha` 配置选项设置为 `True`。对于本演示，默认值
    `False` 已足够。
- en: With a value of `False`, only users with the admin role can create HA routers.
    Ordinary users will be limited to the default router type, which in most cases
    is standalone.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 设置值为 `False` 时，只有具有管理员角色的用户才能创建 HA 路由器。普通用户将被限制为默认路由器类型，在大多数情况下是独立路由器。
- en: To set a maximum number of `L3` agents used for a virtual router, set ` max_l3_agents_per_router`
    accordingly. For this demonstration, the default value is sufficient and will
    mean that three network namespaces will be constructed to make up the VRRP virtual
    router.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 要设置虚拟路由器使用的最大 `L3` 代理数，请相应地设置 `max_l3_agents_per_router`。在本示范中，默认值已足够，这意味着将构建三个网络命名空间来组成
    VRRP 虚拟路由器。
- en: To modify the network type used for HA routers, change the value of `l3_ha_network_type`.
    By default, the default project network type is used and is sufficient for this
    demonstration.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 要修改用于 HA 路由器的网络类型，请更改 `l3_ha_network_type` 的值。默认情况下，使用的是默认项目网络类型，这对于本示范来说已足够。
- en: If the default project network type is vlan, VLANs may be consumed at a faster-than-expected
    rate, as each project can consume a single VLAN for the HA network.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 如果默认项目网络类型为 vlan，VLAN 可能会比预期更快地消耗，因为每个项目可以为 HA 网络消耗一个 VLAN。
- en: Once the changes have been made, restart the `neutron-server` service on the
    `controller` node for the changes to take effect.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 修改完成后，需在 `controller` 节点上重启 `neutron-server` 服务才能使更改生效。
- en: Working with highly available routers
  id: totrans-84
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用高可用路由器
- en: With a few exceptions, creating and managing an HA router is no different from
    its standalone counterpart. Neutron's router management commands were covered
    in the previous chapter, and the exceptions can be found in the following sections.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 除少数例外，创建和管理高可用路由器与独立路由器没有区别。Neutron 的路由器管理命令在上一章中已经介绍，例外情况可以在以下章节找到。
- en: Creating highly-available routers
  id: totrans-86
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建高可用路由器
- en: 'Users with the admin role can create highly-available routers using the `--ha`
    argument with the `openstack router create command` shown here:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 拥有管理员角色的用户可以使用 `--ha` 参数和如下所示的 `openstack router create` 命令创建高可用路由器：
- en: '[PRE6]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Users without the admin role do not have the ability to override the default
    router type and cannot specify the `--ha` argument.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 没有管理员角色的用户没有权限覆盖默认的路由器类型，也不能指定 `--ha` 参数。
- en: Deleting highly-available routers
  id: totrans-90
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 删除高可用路由器
- en: 'To delete a highly-available router, simply use the `openstack router delete
    command` shown here:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 要删除高可用路由器，只需使用如下所示的 `openstack router delete` 命令：
- en: '[PRE7]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: When all HA routers in a project are removed, the HA network used for communication
    between routers stays behind. That network will be reused upon the creation of
    HA routers at a later time.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 当项目中的所有 HA 路由器被删除后，用于路由器之间通信的 HA 网络会留下来。该网络将在稍后创建 HA 路由器时被重用。
- en: Decomposing a highly available router
  id: totrans-94
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 解构高可用路由器
- en: 'Using concepts demonstrated in previous chapters, let''s walk through the creation
    and decomposition of a highly available router. In the following example, I''ve
    started out with an external provider network named `GATEWAY_NET` and a project
    network named `PROJECT_NET`:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 使用之前章节演示的概念，让我们一起完成高可用路由器的创建与解构。以下示例中，我以一个名为 `GATEWAY_NET` 的外部提供商网络和一个名为 `PROJECT_NET`
    的项目网络开始：
- en: '![](img/138e2329-e4d3-41c1-bda2-6d05cbc98442.png)'
  id: totrans-96
  prefs: []
  type: TYPE_IMG
  zh: '![](img/138e2329-e4d3-41c1-bda2-6d05cbc98442.png)'
- en: 'Using the `openstack router create` command with the `--ha` argument, we can
    create an HA router named `MyHighlyAvailableRouter`:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 使用带有 `--ha` 参数的 `openstack router create` 命令，我们可以创建一个名为 `MyHighlyAvailableRouter`
    的 HA 路由器：
- en: '![](img/1f590bb4-c404-4624-b2d9-4222b8135136.png)'
  id: totrans-98
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1f590bb4-c404-4624-b2d9-4222b8135136.png)'
- en: Upon creation of the HA router, a network namespace was created on up to three
    hosts running the Neutron L3 agent. In this demonstration, the L3 agent is running
    on the `controller01` and two compute nodes.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建 HA 路由器时，在最多三台运行 Neutron L3 代理的主机上创建了网络命名空间。在本示范中，L3 代理运行在 `controller01`
    和两台计算节点上。
- en: 'In the following screenshot, a router namespace that corresponds to the `MyHighlyAvailableRouter`
    router can be observed on each host:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 在下图中，可以在每个主机上观察到与 `MyHighlyAvailableRouter` 路由器对应的路由器命名空间：
- en: '![](img/8bb73910-2b62-4115-a484-d5556f2c4f89.png)'
  id: totrans-101
  prefs: []
  type: TYPE_IMG
  zh: '![](img/8bb73910-2b62-4115-a484-d5556f2c4f89.png)'
- en: 'Neutron automatically created a network reserved for communication between
    the routers upon creation of the first HA router within a project using the network
    defined by the `l3_ha_net_cidr` configuration option in the L3 agent configuration
    file:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建项目中的第一个 HA 路由器时，Neutron 自动创建了一个专门用于路由器间通信的网络，该网络使用 L3 代理配置文件中的 `l3_ha_net_cidr`
    配置选项定义的网络：
- en: '![](img/14891d53-2fda-4d20-af25-0db340e83821.png)'
  id: totrans-103
  prefs: []
  type: TYPE_IMG
  zh: '![](img/14891d53-2fda-4d20-af25-0db340e83821.png)'
- en: 'The HA network is not directly associated with the project and is not visible
    by anyone but an administrator, who is able to see all networks. The output here
    shows the details of the network:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: HA 网络与项目没有直接关联，除了管理员外，其他人无法看到该网络，管理员能够看到所有网络。这里的输出展示了该网络的详细信息：
- en: '![](img/3c9c377b-1b86-48b1-814a-e7d4abbbf4c2.png)'
  id: totrans-105
  prefs: []
  type: TYPE_IMG
  zh: '![](img/3c9c377b-1b86-48b1-814a-e7d4abbbf4c2.png)'
- en: As you can see, the `project_id` field is blank, while the name of the HA network
    includes the ID of the project. The network is used by Neutron for all HA routers
    created by that project in the future.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 如你所见，`project_id` 字段为空，而 HA 网络的名称中包含了项目的 ID。该网络由 Neutron 用于将来该项目创建的所有 HA 路由器。
- en: The HA network utilizes the default project network type and will consume a
    segmentation ID of that type.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: HA 网络使用默认的项目网络类型，并将消耗该类型的分段 ID。
- en: 'Both a gateway and internal interface have been attached to the router. The
    `openstack port list` command reveals the gateway, internal, and HA ports associated
    with the router:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 路由器已经连接了一个网关和内部接口。使用 `openstack port list` 命令可以查看与路由器相关联的网关、内部和 HA 端口：
- en: '![](img/8f9e1bbf-56f2-4735-aa66-c31bf12bcb20.png)'
  id: totrans-109
  prefs: []
  type: TYPE_IMG
  zh: '![](img/8f9e1bbf-56f2-4735-aa66-c31bf12bcb20.png)'
- en: 'The three HA ports were created automatically by Neutron and are used for communication
    between the router namespaces distributed across the hosts. Inside the network
    namespaces, we can find the corresponding interfaces:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 这三个 HA 端口是 Neutron 自动创建的，用于在分布在各个主机上的路由器命名空间之间进行通信。在网络命名空间内部，我们可以找到相应的接口：
- en: '![](img/691c85b3-6ef0-4610-9e75-093c003daa60.png)'
  id: totrans-111
  prefs: []
  type: TYPE_IMG
  zh: '![](img/691c85b3-6ef0-4610-9e75-093c003daa60.png)'
- en: '![](img/25171b5d-d7fa-426f-adab-c9664d5e91a8.png)'
  id: totrans-112
  prefs: []
  type: TYPE_IMG
  zh: '![](img/25171b5d-d7fa-426f-adab-c9664d5e91a8.png)'
- en: '![](img/71a50c98-1c22-4250-a6c0-aefcefa07d0a.png)'
  id: totrans-113
  prefs: []
  type: TYPE_IMG
  zh: '![](img/71a50c98-1c22-4250-a6c0-aefcefa07d0a.png)'
- en: In the preceding screenshots, the router namespace on  `compute02` has been
    elected as the master router, as evidenced by the virtual IP, `169.254.0.1/24`,
    being configured on the HA interface within the namespace. In addition to the
    HA interface, the `qg` and `qr` interfaces are only fully configured on the master
    router. If more than one router owns the virtual IP, or if you see the `qg` and
    `qr` interfaces fully configured on more than one router, there may be communication
    issues between the routers on the `HA` network.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的截图中，`compute02` 上的路由器命名空间已被选为主路由器，这可以通过命名空间内 HA 接口配置的虚拟 IP `169.254.0.1/24`
    得到验证。除了 HA 接口，`qg` 和 `qr` 接口只会在主路由器上完全配置。如果多个路由器拥有虚拟 IP，或者你看到 `qg` 和 `qr` 接口在多个路由器上都已完全配置，则可能会出现路由器之间的通信问题，特别是在
    `HA` 网络上。
- en: Based on Neutron's configuration of keepalived, the virtual IP is not used as
    a gateway address and is only used as a standardized address that can failover
    to other routers as part of the VRRP failover mechanisms. Neutron does not treat
    addresses on the `qg` or `qr` interfaces as virtual IPs. Along with the virtual
    IP, the `qg` and `qr` interfaces should only be configured and active on the master
    router at any given time.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 根据 Neutron 对 keepalived 的配置，虚拟 IP 并不作为网关地址使用，而是作为一个标准化的地址，用于在 VRRP 故障转移机制中切换到其他路由器。Neutron
    不会将 `qg` 或 `qr` 接口上的地址视为虚拟 IP。虚拟 IP 与 `qg` 和 `qr` 接口应该仅在主路由器上配置并保持活动状态。
- en: 'You can use the `openstack network agent list` command with the `--router`
    and `--long` arguments to determine the agent(s) a router is scheduled to as well
    as see the HA state for the given agent, if applicable:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用 `openstack network agent list` 命令，结合 `--router` 和 `--long` 参数，来确定路由器调度到的代理，并查看给定代理的
    HA 状态（如果适用）：
- en: '![](img/e67ac1c6-09d2-4eef-b51e-10531d4c7e58.png)'
  id: totrans-117
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e67ac1c6-09d2-4eef-b51e-10531d4c7e58.png)'
- en: Examining the keepalived configuration
  id: totrans-118
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 检查 keepalived 配置
- en: 'Neutron has configured keepalived in each qrouter namespace so that, together,
    the namespaces can act as a single virtual router. A keepalived service runs in
    each namespace and uses the following configuration file located on the underlying
    host running the `L3` agent:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: Neutron 已在每个 qrouter 命名空间中配置了 keepalived，以便这些命名空间能够共同作为一个虚拟路由器。每个命名空间中都运行一个
    keepalived 服务，并使用以下配置文件，该文件位于运行 `L3` 代理的基础主机上：
- en: '[PRE8]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'A look at the configuration file for the active router on `compute02` shows
    the keepalived and VRRP configurations currently in use:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 查看 `compute02` 上活动路由器的配置文件，可以看到当前正在使用的 keepalived 和 VRRP 配置：
- en: '![](img/b6af2916-c880-4268-9da9-e1f864948d15.png)'
  id: totrans-122
  prefs: []
  type: TYPE_IMG
  zh: '![](img/b6af2916-c880-4268-9da9-e1f864948d15.png)'
- en: Executing a failover
  id: totrans-123
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 执行故障转移
- en: Under normal circumstances, a node is not likely to fail, and router failover
    is unlikely to occur. A failure scenario can be recreated by manually rebooting
    the node hosting the active router or by putting its physical interfaces into
    a down state.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 在正常情况下，一个节点不太可能发生故障，路由器故障切换的可能性也较低。可以通过手动重启托管活动路由器的节点或将其物理接口置于停用状态来重现故障场景。
- en: 'Failover actions are logged in the following location within the router namespaces:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 故障切换操作会记录在路由器命名空间中的以下位置：
- en: '[PRE9]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'An example of a router going from a backup state to master state once failure
    is detected can be observed in the following screenshot:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦检测到故障，可以在以下截图中看到一个路由器从备份状态切换到主状态的示例：
- en: '![](img/76e2ca61-fbff-4a8b-b7c6-199414e7af1c.png)'
  id: totrans-128
  prefs: []
  type: TYPE_IMG
  zh: '![](img/76e2ca61-fbff-4a8b-b7c6-199414e7af1c.png)'
- en: 'In the preceding screenshot, the router on `compute01` became the new master
    router. In the log, this was identified by the `state_master` message. Once the
    former master router regains connectivity and detects a new master has been elected,
    it moves to a backup state, as indicated by the `state_backup` message seen here:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 在上面的截图中，`compute01`上的路由器成为了新的主路由器。在日志中，通过`state_master`消息可以识别这一变化。一旦原主路由器恢复连接并检测到新主路由器被选举出来，它会转到备份状态，正如在此处看到的`state_backup`消息所示：
- en: '![](img/1f887b6a-1769-440f-bc98-29ad3e8b09df.png)'
  id: totrans-130
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1f887b6a-1769-440f-bc98-29ad3e8b09df.png)'
- en: Summary
  id: totrans-131
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: Highly available routers can be created and managed using the same router command
    set discussed in the previous chapter. Neutron L3 agents are responsible for configuring
    the routers in a VRRP group, and the routers are left to elect a master router
    and implement their respective keepalived configuration based on their master
    or backup state at that time.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 高可用性路由器可以使用上一章讨论的相同路由器命令集进行创建和管理。Neutron L3代理负责配置VRRP组中的路由器，路由器则根据其主备状态自行选举主路由器，并实现各自的keepalived配置。
- en: While HA routers provide a level of redundancy over their standalone counterparts,
    they are not without their drawbacks. A single node hosting a master router is
    still a bottleneck for traffic traversing that router. In addition, if the network
    used for dedicated VRRP traffic between routers experiences a loss of connectivity,
    the routers can become split-brained. This can cause two or more routers to become
    master routers and potentially cause ARP and MAC flapping issues in the network.
    Connection tracking between routers has not been implemented as of the Pike release,
    which means that connections to and from instances may be severed during a failover
    event. These shortcomings are being actively worked on and look to be addressed
    in future releases of OpenStack.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然高可用性路由器（HA路由器）提供了比独立路由器更高的冗余级别，但它们并非没有缺点。单一节点托管主路由器仍然是经过该路由器的流量瓶颈。此外，如果用于路由器之间专用VRRP流量的网络出现连接中断，路由器可能会发生脑裂现象。这会导致两个或多个路由器成为主路由器，并可能引发网络中的ARP和MAC抖动问题。连接跟踪在Pike版本中尚未实现，这意味着在故障切换事件中，实例之间的连接可能会中断。这些问题正在积极修复，并计划在OpenStack的未来版本中得到解决。
- en: In the next chapter, we will look at how virtual routers can be distributed
    across `compute` nodes and serve as the gateway for their respective instances
    using a technology referred to as Distributed Virtual Routers, or DVR.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将探讨如何通过称为分布式虚拟路由器（DVR）技术，将虚拟路由器分布在`计算`节点上，并作为各自实例的网关。
