- en: Installing OpenStack
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装 OpenStack
- en: Manually installing, configuring, and maintaining OpenStack clouds can be an
    arduous task. Many vendors provide downloadable cloud software based on OpenStack
    that provides deployment and management strategies using Chef, Puppet, Ansible,
    and other tools.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 手动安装、配置和维护 OpenStack 云可能是一项艰巨的任务。许多供应商提供基于 OpenStack 的可下载云软件，使用 Chef、Puppet、Ansible
    等工具提供部署和管理策略。
- en: 'This chapter will take you step by step through a package-based installation
    of the following OpenStack components on the Ubuntu 16.04 LTS operating system:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将逐步指导您在 Ubuntu 16.04 LTS 操作系统上安装以下 OpenStack 组件：
- en: OpenStack Identity (Keystone)
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: OpenStack 身份（Keystone）
- en: OpenStack Image Service (Glance)
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: OpenStack 镜像服务（Glance）
- en: OpenStack Compute (Nova)
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: OpenStack 计算（Nova）
- en: OpenStack Dashboard (Horizon)
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: OpenStack 仪表板（Horizon）
- en: The installation process documented within this chapter is based on the *OpenStack
    Installation Guide* found at [http://docs.openstack.org/](http://docs.openstack.org/).
    If you wish to install OpenStack on a different operating system, the guides available
    at that site provide instructions for doing so.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 本章中记录的安装过程基于*OpenStack 安装指南*，该指南可以在 [http://docs.openstack.org/](http://docs.openstack.org/)
    找到。如果您希望在其他操作系统上安装 OpenStack，可以参考该网站上的指南。
- en: 'If you''d rather download and install a third-party cloud distribution based
    on OpenStack, try one of the following URLs:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您更愿意下载并安装基于 OpenStack 的第三方云发行版，可以尝试以下 URL：
- en: OpenStack-Ansible:  [https://docs.openstack.org/openstack-ansible/](https://docs.openstack.org/openstack-ansible/)
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'OpenStack-Ansible: [https://docs.openstack.org/openstack-ansible/](https://docs.openstack.org/openstack-ansible/)'
- en: Red Hat RDO:  [http://openstack.redhat.com/](http://openstack.redhat.com/)
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'Red Hat RDO: [http://openstack.redhat.com/](http://openstack.redhat.com/)'
- en: Kolla: [https://docs.openstack.org/kolla-ansible/latest/](https://docs.openstack.org/kolla-ansible/latest/)
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'Kolla: [https://docs.openstack.org/kolla-ansible/latest/](https://docs.openstack.org/kolla-ansible/latest/)'
- en: Once installed, many of the concepts and examples used throughout this book
    should still apply to the above distributions, but they may require extra effort
    to implement.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦安装完成，本书中使用的大部分概念和示例仍然适用于上述发行版，但可能需要额外的努力才能实现。
- en: System requirements
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 系统要求
- en: OpenStack components are intended to run on standard hardware, ranging from
    desktop machines to enterprise-grade servers. For optimal performance, the processors
    of the `compute` nodes need to support virtualization technologies such as Intel's
    VT-x or AMD's AMD-V.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: OpenStack 组件旨在运行于标准硬件上，从桌面计算机到企业级服务器均可支持。为了获得最佳性能，`计算`节点的处理器需要支持虚拟化技术，如英特尔的
    VT-x 或 AMD 的 AMD-V。
- en: 'This book assumes OpenStack will be installed on servers that meet the following
    minimum requirements:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 本书假设 OpenStack 将安装在满足以下最低要求的服务器上：
- en: '| **Server** | **Hardware requirements** |'
  id: totrans-16
  prefs: []
  type: TYPE_TB
  zh: '| **服务器** | **硬件要求** |'
- en: '| All | Processor: 64-bit x86CPU count: 2-4Memory: 4+ GB RAMDisk space: 32+
    GBNetwork: 3x 1-Gbps network interface cards |'
  id: totrans-17
  prefs: []
  type: TYPE_TB
  zh: '| 所有 | 处理器：64位 x86CPU 数量：2-4内存：4+ GB RAM磁盘空间：32+ GB网络：3x 1-Gbps 网络接口卡 |'
- en: While machines that fail to meet these minimum requirements are capable of installation
    based on the documentation included in this book, these minimums have been set
    to ensure a successful experience. Additional memory and storage is highly recommended
    when creating multiple virtual machine instances for demonstration purposes. Virtualization
    products such as VMware ESXi, VMware Fusion, or VirtualBox may be used in lieu
    of physical hardware, but will require additional configuration to the environment
    and to OpenStack that is outside the scope of this book. If virtualizing the environment,
    consider exposing hardware virtualization extensions for better performance.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然不符合这些最低要求的机器也能根据本书中提供的文档进行安装，但这些最低要求是为了确保顺利的体验。在创建多个虚拟机实例用于演示时，强烈建议增加额外的内存和存储。像
    VMware ESXi、VMware Fusion 或 VirtualBox 等虚拟化产品可以替代物理硬件使用，但需要对环境和 OpenStack 进行额外的配置，这超出了本书的范围。如果选择虚拟化环境，建议启用硬件虚拟化扩展，以提升性能。
- en: Operating system requirements
  id: totrans-19
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 操作系统要求
- en: 'OpenStack can be installed on the following Linux distributions: CentOS, Red
    Hat Enterprise Linux, openSUSE, SUSE Linux Enterprise Server, and Ubuntu. This
    book assumes that the Ubuntu 16.04 LTS server operating system has been installed
    on all hosts prior to installation of OpenStack. You can find Ubuntu Server at
    the following URL: [http://www.ubuntu.com/download/server](http://www.ubuntu.com/download/server).'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: OpenStack可以安装在以下Linux发行版上：CentOS、Red Hat Enterprise Linux、openSUSE、SUSE Linux
    Enterprise Server和Ubuntu。本书假设在安装OpenStack之前，所有主机已经安装了Ubuntu 16.04 LTS服务器操作系统。你可以在以下网址找到Ubuntu
    Server：[http://www.ubuntu.com/download/server](http://www.ubuntu.com/download/server)。
- en: 'In order to support all of the networking features discussed in this book,
    the following minimum kernel version is recommended: `4.13.0-45-generic`.'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 为了支持本书中讨论的所有网络功能，推荐使用以下最小内核版本：`4.13.0-45-generic`。
- en: Initial network configuration
  id: totrans-22
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 初始网络配置
- en: 'To understand how networking should initially be configured on each host, please
    refer to the following diagram:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 为了理解每台主机应该如何初步配置网络，请参考以下图示：
- en: '![](img/1effdc54-7fb1-4547-ab01-8c02063634fb.png)'
  id: totrans-24
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1effdc54-7fb1-4547-ab01-8c02063634fb.png)'
- en: Figure 2.1
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.1
- en: In *figure 2.1*, three interfaces are cabled to each host. The `eth0` interface
    will serve as the management interface for OpenStack services and API access while
    `eth1` will be used for overlay network traffic between hosts. On the `controller`
    node, `eth2` will be used for external network traffic to instances through Neutron
    routers. If VLAN tenant networks are used in lieu of overlay networks, then `eth2`
    will be configured on the `compute` nodes to support those networks.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 在*图 2.1*中，三个接口分别连接到每台主机。`eth0`接口将作为OpenStack服务和API访问的管理接口，而`eth1`将用于主机之间的覆盖网络流量。在`controller`节点，`eth2`将用于通过Neutron路由器向实例传递外部网络流量。如果使用VLAN租户网络代替覆盖网络，则`eth2`将配置在`compute`节点上，以支持这些网络。
- en: At a minimum, the management interface should be configured with an IP address
    that has outbound access to the internet. Internet access is required to download
    OpenStack packages from the Ubuntu package repository. Inbound access to the management
    address of the servers from a trusted network via SSH is recommended.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 至少，管理接口应该配置一个IP地址，并具有访问互联网的外部连接。需要互联网访问才能从Ubuntu软件包仓库下载OpenStack软件包。建议通过SSH从受信任的网络访问服务器的管理地址。
- en: Example networks
  id: totrans-28
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 示例网络
- en: 'Throughout the book, there will be examples of configuring and using various
    OpenStack services. The following table provides the VLANs and associated networks
    used for those services:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 在本书中，将会有配置和使用各种OpenStack服务的示例。下表列出了用于这些服务的VLAN和相关网络：
- en: '| **VLAN name** | **VLAN ID** | **Network** |'
  id: totrans-30
  prefs: []
  type: TYPE_TB
  zh: '| **VLAN 名称** | **VLAN ID** | **网络** |'
- en: '| MGMT_NET | 10 | 10.10.0.0/24 |'
  id: totrans-31
  prefs: []
  type: TYPE_TB
  zh: '| MGMT_NET | 10 | 10.10.0.0/24 |'
- en: '| OVERLAY_NET | 20 | 10.20.0.0/24 |'
  id: totrans-32
  prefs: []
  type: TYPE_TB
  zh: '| OVERLAY_NET | 20 | 10.20.0.0/24 |'
- en: '| GATEWAY_NET | 30 | 10.30.0.0/24 |'
  id: totrans-33
  prefs: []
  type: TYPE_TB
  zh: '| GATEWAY_NET | 30 | 10.30.0.0/24 |'
- en: '| PROJECT_NET40 | 40 | TBD |'
  id: totrans-34
  prefs: []
  type: TYPE_TB
  zh: '| PROJECT_NET40 | 40 | 待定 |'
- en: '| PROJECT_NET41 | 41 | TBD |'
  id: totrans-35
  prefs: []
  type: TYPE_TB
  zh: '| PROJECT_NET41 | 41 | 待定 |'
- en: '| PROJECT_NET42 | 42 | TBD |'
  id: totrans-36
  prefs: []
  type: TYPE_TB
  zh: '| PROJECT_NET42 | 42 | 待定 |'
- en: '| PROJECT_NET43 | 43 | TBD |'
  id: totrans-37
  prefs: []
  type: TYPE_TB
  zh: '| PROJECT_NET43 | 43 | 待定 |'
- en: 'The following tables provide the IP addresses and VLAN IDs recommended for
    each host interface should you choose to follow along with the examples:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 以下表格提供了每个主机接口推荐的IP地址和VLAN ID，供您在跟随示例时参考：
- en: '| **Host Name** | **Interface** | **IP address** | **Switchport** | **VLAN
    ID** |'
  id: totrans-39
  prefs: []
  type: TYPE_TB
  zh: '| **主机名** | **接口** | **IP地址** | **交换端口** | **VLAN ID** |'
- en: '| controller01 | eth0 | 10.10.0.100 | Access Port | VLAN 10(Untagged) |'
  id: totrans-40
  prefs: []
  type: TYPE_TB
  zh: '| controller01 | eth0 | 10.10.0.100 | 访问端口 | VLAN 10（未标记） |'
- en: '| controller01 | eth1 | 10.20.0.100 | Access Port | VLAN 20(Untagged) |'
  id: totrans-41
  prefs: []
  type: TYPE_TB
  zh: '| controller01 | eth1 | 10.20.0.100 | 访问端口 | VLAN 20（未标记） |'
- en: '| controller01 | eth2 | None | Trunk Port | VLAN 30, 40-44(Tagged) |'
  id: totrans-42
  prefs: []
  type: TYPE_TB
  zh: '| controller01 | eth2 | 无 | Trunk端口 | VLAN 30, 40-44（标记） |'
- en: '| **Host Name** | **Interface** | **IP address** | **Switchport** | **VLAN
    ID** |'
  id: totrans-43
  prefs: []
  type: TYPE_TB
  zh: '| **主机名** | **接口** | **IP地址** | **交换端口** | **VLAN ID** |'
- en: '| compute01 | eth0 | 10.10.0.101 | Access Port | VLAN 10(Untagged) |'
  id: totrans-44
  prefs: []
  type: TYPE_TB
  zh: '| compute01 | eth0 | 10.10.0.101 | 访问端口 | VLAN 10（未标记） |'
- en: '| compute01 | eth1 | 10.20.0.101 | Access Port | VLAN 20(Untagged) |'
  id: totrans-45
  prefs: []
  type: TYPE_TB
  zh: '| compute01 | eth1 | 10.20.0.101 | 访问端口 | VLAN 20（未标记） |'
- en: '| compute01 | eth2 | None | Trunk Port | VLAN 30, 40-44 (Tagged) |'
  id: totrans-46
  prefs: []
  type: TYPE_TB
  zh: '| compute01 | eth2 | 无 | Trunk端口 | VLAN 30, 40-44（标记） |'
- en: '| **Host Name** | **Interface** | **IP address** | **Switchport** | **VLAN
    ID** |'
  id: totrans-47
  prefs: []
  type: TYPE_TB
  zh: '| **主机名** | **接口** | **IP地址** | **交换端口** | **VLAN ID** |'
- en: '| compute02 | eth0 | 10.10.0.102 | Access Port | VLAN 10(Untagged) |'
  id: totrans-48
  prefs: []
  type: TYPE_TB
  zh: '| compute02 | eth0 | 10.10.0.102 | 访问端口 | VLAN 10（未标记） |'
- en: '| compute02 | eth1 | 10.20.0.102 | Access Port | VLAN 20(Untagged) |'
  id: totrans-49
  prefs: []
  type: TYPE_TB
  zh: '| compute02 | eth1 | 10.20.0.102 | 访问端口 | VLAN 20（未标记） |'
- en: '| compute02 | eth2 | None | Trunk Port | VLAN 30, 40-44 (Tagged) |'
  id: totrans-50
  prefs: []
  type: TYPE_TB
  zh: '| compute02 | eth2 | 无 | 中继端口 | VLAN 30, 40-44（已标记）|'
- en: '| **Host Name** | **Interface** | **IP address** | **Switchport** | **VLAN
    ID** |'
  id: totrans-51
  prefs: []
  type: TYPE_TB
  zh: '| **主机名** | **接口** | **IP 地址** | **交换端口** | **VLAN ID** |'
- en: '| compute03 | eth0 | 10.10.0.103 | Access Port | VLAN 10(Untagged) |'
  id: totrans-52
  prefs: []
  type: TYPE_TB
  zh: '| compute03 | eth0 | 10.10.0.103 | 访问端口 | VLAN 10（未标记）|'
- en: '| compute03 | eth1 | 10.20.0.103 | Access Port | VLAN 20(Untagged) |'
  id: totrans-53
  prefs: []
  type: TYPE_TB
  zh: '| compute03 | eth1 | 10.20.0.103 | 访问端口 | VLAN 20（未标记）|'
- en: '| compute03 | eth2 | None | Trunk Port | VLAN 30, 40-44 (Tagged) |'
  id: totrans-54
  prefs: []
  type: TYPE_TB
  zh: '| compute03 | eth2 | 无 | 中继端口 | VLAN 30, 40-44（已标记）|'
- en: '| **Host Name** | **Interface** | **IP address** | **Switchport** | **VLAN
    ID** |'
  id: totrans-55
  prefs: []
  type: TYPE_TB
  zh: '| **主机名** | **接口** | **IP 地址** | **交换端口** | **VLAN ID** |'
- en: '| snat01 | eth0 | 10.10.0.104 | Access Port | VLAN 10(Untagged) |'
  id: totrans-56
  prefs: []
  type: TYPE_TB
  zh: '| snat01 | eth0 | 10.10.0.104 | 访问端口 | VLAN 10（未标记）|'
- en: '| snat01 | eth1 | 10.20.0.104 | Access Port | VLAN 20(Untagged) |'
  id: totrans-57
  prefs: []
  type: TYPE_TB
  zh: '| snat01 | eth1 | 10.20.0.104 | 访问端口 | VLAN 20（未标记）|'
- en: '| snat01 | eth2 | None | Trunk Port | VLAN 30, 40-44 (Tagged) |'
  id: totrans-58
  prefs: []
  type: TYPE_TB
  zh: '| snat01 | eth2 | 无 | 中继端口 | VLAN 30, 40-44（已标记）|'
- en: To avoid loss of connectivity due to an interface misconfiguration or other
    mishap, out-of-band management access to the servers or some other mechanism is
    highly recommended.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 为了避免因接口配置错误或其他问题导致连接丢失，强烈建议使用带外管理访问服务器或其他类似机制。
- en: Interface configuration
  id: totrans-60
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 接口配置
- en: Ubuntu 16.04 LTS uses configuration files found in `/etc/network/interfaces.d/`
    or the file`/etc/network/interfaces` that describe how network interfaces should
    be configured.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: Ubuntu 16.04 LTS使用位于`/etc/network/interfaces.d/`目录或`/etc/network/interfaces`文件中的配置文件来描述如何配置网络接口。
- en: Using a text editor, update the network interface file on each host as follows.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 使用文本编辑器，在每个主机上更新网络接口文件，方法如下。
- en: 'For `controller01`:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 对于`controller01`：
- en: '[PRE0]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'For `compute01`:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 对于`compute01`：
- en: '[PRE1]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'For `compute02`:'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 对于`compute02`：
- en: '[PRE2]'
  id: totrans-68
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'For `compute03`:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 对于`compute03`：
- en: '[PRE3]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'For `snat01`:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 对于`snat01`：
- en: '[PRE4]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The `eth2` interface will be used in a network bridge described in further
    detail in upcoming chapters. To activate the changes, cycle the interfaces using
    the `ifdown` and `ifup` commands on each node:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: '`eth2`接口将在后续章节中描述的网络桥接中使用。要激活更改，请使用`ifdown`和`ifup`命令在每个节点上重启接口：'
- en: '[PRE5]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: For more information on configuring network interfaces, please refer to the
    Ubuntu man page at the following URL: [http://manpages.ubuntu.com/manpages/xenial/man5/interfaces.5.html](http://manpages.ubuntu.com/manpages/xenial/man5/interfaces.5.html)
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 有关配置网络接口的更多信息，请参考Ubuntu手册页，网址如下：[http://manpages.ubuntu.com/manpages/xenial/man5/interfaces.5.html](http://manpages.ubuntu.com/manpages/xenial/man5/interfaces.5.html)
- en: Initial steps
  id: totrans-76
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 初步步骤
- en: Before we can install OpenStack, some work must be done to prepare each system
    for a successful installation.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们可以安装OpenStack之前，必须做一些准备工作，以确保每个系统能够成功安装。
- en: Permissions
  id: totrans-78
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 权限
- en: OpenStack services can be installed either as a root user or as a user with
    `sudo` permissions. The latter may require the user to be added to the `sudoers`
    file on each host. For tips on configuring `sudoers`, please visit the following
    URL: [https://help.ubuntu.com/community/RootSudo.](https://help.ubuntu.com/community/RootSudo)
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: OpenStack服务可以作为root用户或具有`sudo`权限的用户安装。后者可能需要将用户添加到每个主机的`sudoers`文件中。有关配置`sudoers`的提示，请访问以下网址：[https://help.ubuntu.com/community/RootSudo.](https://help.ubuntu.com/community/RootSudo)
- en: For this installation, all commands should be run as the root user unless specified
    otherwise.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 对于此安装，除非另有说明，否则所有命令都应以root用户身份运行。
- en: Configuring the OpenStack repository
  id: totrans-81
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置OpenStack仓库
- en: 'When installing versions of OpenStack that are newer than what the operating
    system shipped with, Ubuntu uses the Ubuntu Cloud Archive (UCA). To enable the
    Cloud Archive repository, update the `apt` cache and download and install the `software-properties-common`
    package on all hosts:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 当安装版本比操作系统自带版本更新的OpenStack时，Ubuntu使用Ubuntu Cloud Archive（UCA）。要启用Cloud Archive仓库，请更新`apt`缓存，并在所有主机上下载并安装`software-properties-common`包：
- en: '[PRE6]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Once installed, the OpenStack Pike repository should be added as an apt source
    on all hosts:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完成后，应该将OpenStack Pike仓库添加为所有主机的apt源：
- en: '[PRE7]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Upgrading the system
  id: totrans-86
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 系统升级
- en: 'Before installing OpenStack, it is imperative that the kernel and other system
    packages on each node be upgraded to the latest version provided by Ubuntu for
    the 16.04 LTS release using the Cloud Archive. Issue the following `apt` commands
    on each node:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 在安装OpenStack之前，必须将每个节点上的内核和其他系统包升级到Ubuntu 16.04 LTS版本中通过Cloud Archive提供的最新版本。请在每个节点上执行以下`apt`命令：
- en: '[PRE8]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Setting the hostnames
  id: totrans-89
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置主机名
- en: 'Before installing OpenStack, ensure that each node in the environment has been
    configured with its proper hostname. Use the `hostnamectl` command on each host
    to set the hostname accordingly:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 在安装 OpenStack 之前，确保环境中的每个节点都已配置正确的主机名。使用`hostnamectl`命令在每个主机上相应设置主机名：
- en: '| **Host** | **Command** |'
  id: totrans-91
  prefs: []
  type: TYPE_TB
  zh: '| **主机** | **命令** |'
- en: '| `controller01` | `hostnamectl set-hostname controller01` |'
  id: totrans-92
  prefs: []
  type: TYPE_TB
  zh: '| `controller01` | `hostnamectl set-hostname controller01` |'
- en: '| `compute01` | `hostnamectl set-hostname compute01` |'
  id: totrans-93
  prefs: []
  type: TYPE_TB
  zh: '| `compute01` | `hostnamectl set-hostname compute01` |'
- en: '| `compute02` | `hostnamectl set-hostname compute02` |'
  id: totrans-94
  prefs: []
  type: TYPE_TB
  zh: '| `compute02` | `hostnamectl set-hostname compute02` |'
- en: '| `compute03` | `hostnamectl set-hostname compute03` |'
  id: totrans-95
  prefs: []
  type: TYPE_TB
  zh: '| `compute03` | `hostnamectl set-hostname compute03` |'
- en: '| `snat01` | `hostnamectl set-hostname snat01` |'
  id: totrans-96
  prefs: []
  type: TYPE_TB
  zh: '| `snat01` | `hostnamectl set-hostname snat01` |'
- en: 'To simplify communication between hosts, it is recommended that DNS or a local
    name resolver be used to resolve hostnames. Using a text editor, update the `/etc/hosts`
    file on each node to include the management IP address and hostname of all nodes:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 为简化主机之间的通信，建议使用 DNS 或本地名称解析器来解析主机名。使用文本编辑器，更新每个节点上的`/etc/hosts`文件，以包含所有节点的管理
    IP 地址和主机名：
- en: '[PRE9]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'On each node, use the `hostname -f` command to verify that the fully qualified
    host name is properly reflected:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 在每个节点上，使用`hostname -f`命令验证完全限定的主机名是否正确反映：
- en: '[PRE10]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Installing and configuring Network Time Protocol
  id: totrans-101
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装和配置网络时间协议
- en: A time synchronization program such as Network Time Protocol (**NTP**) is a
    requirement, as OpenStack services depend on consistent and synchronized time
    between hosts.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 如网络时间协议 (**NTP**) 等时间同步程序是必需的，因为 OpenStack 服务依赖于主机之间的一致且同步的时间。
- en: For Nova Compute, having synchronized time helps to avoid problems when scheduling
    VM launches on `compute` nodes. Other services can experience similar issues when
    the time is not synchronized.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 Nova 计算，时间同步有助于避免在 `compute` 节点上调度虚拟机启动时出现问题。其他服务在时间未同步时也会遇到类似问题。
- en: 'To install `chrony`, an NTP implementation, issue the following commands on
    all nodes in the environment:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 要安装 NTP 实现 `chrony`，请在环境中的所有节点上执行以下命令：
- en: '[PRE11]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'On the `controller` node, add the following line to the `/etc/chrony/chrony.conf`
    file to allow other hosts in the environment to synchronize their time against
    the controller:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 在`controller`节点上，将以下行添加到`/etc/chrony/chrony.conf`文件中，以允许环境中的其他主机与控制器同步时间：
- en: '[PRE12]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'On the other nodes, comment out any `pool` lines in the `/etc/chrony/chrony.conf`
    file and add the following line to direct them to synchronize their time against
    the controller:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 在其他节点上，注释掉`/etc/chrony/chrony.conf`文件中的任何`pool`行，并添加以下行，将它们的时间同步指向控制器：
- en: '[PRE13]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'On each host, restart the `chrony` service:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 在每个主机上，重启 `chrony` 服务：
- en: '[PRE14]'
  id: totrans-111
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Rebooting the system
  id: totrans-112
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 重启系统
- en: 'Reboot each host before proceeding with the installation:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 在继续安装之前，重启每个主机：
- en: '[PRE15]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Installing OpenStack
  id: totrans-115
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装 OpenStack
- en: The steps in this section document the installation of OpenStack services including
    Keystone, Glance, Nova, and Horizon on a single controller and three `compute`
    nodes. Neutron, the OpenStack Networking service, will be installed in the next
    chapter.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 本节的步骤记录了在一个控制节点和三个`compute`节点上安装 OpenStack 服务（包括 Keystone、Glance、Nova 和 Horizon）的过程。Neutron，OpenStack
    网络服务，将在下一章进行安装。
- en: 'Prepare for the configuration of various services by installing the OpenStack
    command-line client, `python-openstackclient`, on the `controller` node with the
    following command:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下命令在`controller`节点上安装 OpenStack 命令行客户端 `python-openstackclient`，为配置各种服务做好准备：
- en: '[PRE16]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Installing and configuring the MySQL database server
  id: totrans-119
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装和配置 MySQL 数据库服务器
- en: 'On the `controller` node, use `apt` to install the MySQL database service and
    related Python packages:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 在`controller`节点上，使用`apt`安装 MySQL 数据库服务和相关的 Python 包：
- en: '[PRE17]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: If prompted, set the password to `openstack`.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 如果提示，请将密码设置为`openstack`。
- en: Insecure passwords are used throughout the book to simplify the configuration
    and demonstration of concepts and are not recommended for production environments.
    Visit [http://www.strongpasswordgenerator.org ](http://www.strongpasswordgenerator.org)to
    generate strong passwords for your environment.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 本书中使用了不安全的密码，以简化配置和概念演示，且不推荐用于生产环境。访问[http://www.strongpasswordgenerator.org](http://www.strongpasswordgenerator.org)为您的环境生成强密码。
- en: 'Once installed, create and edit the `/etc/mysql/mariadb.conf.d/99-openstack.cnf`
    configuration file. Add the `[mysqld]` block and the `bind-address` definition.
    Doing so will allow connectivity to MySQL from other hosts in the environment.
    The value for `bind-address` should be the management IP of the controller node:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完成后，创建并编辑 ` /etc/mysql/mariadb.conf.d/99-openstack.cnf` 配置文件。添加 `[mysqld]`
    块和 `bind-address` 定义。这样可以允许其他主机连接 MySQL。`bind-address` 的值应为 `controller` 节点的管理
    IP 地址：
- en: '[PRE18]'
  id: totrans-125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'In addition to adding the `bind-address` definition, add the following options
    to the `[mysqld]`section as well:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 除了添加 `bind-address` 定义外，还需要在 `[mysqld]` 部分添加以下选项：
- en: '[PRE19]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Save and close the file, then restart the `mysql` service:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 保存并关闭文件，然后重新启动 `mysql` 服务：
- en: '[PRE20]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'The MySQL secure installation utility is used to build the default MySQL database
    and to set a password for the MySQL root user. The following command will begin
    the MySQL installation and configuration process:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: MySQL 安全安装工具用于创建默认的 MySQL 数据库并为 MySQL root 用户设置密码。以下命令将开始 MySQL 的安装和配置过程：
- en: '[PRE21]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: During the MySQL installation process, you will be prompted to enter a password
    and change various settings. The default root password may not yet be set. When
    prompted, set a root password of `openstack`. A more secure password suitable
    for your environment is highly recommended.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 在 MySQL 安装过程中，你将被提示输入密码并修改各种设置。默认的 root 密码可能尚未设置。当系统提示时，请设置 root 密码为 `openstack`。建议使用更安全的密码，以适应你的环境。
- en: Answer `[Y]es` to the remaining questions to exit the configuration process.
    At this point, the MySQL server has been successfully installed on the `controller`
    node.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 对其余问题回答 `[Y]es` 以退出配置过程。此时，MySQL 服务器已成功安装在 `controller` 节点上。
- en: Installing and configuring the messaging server
  id: totrans-134
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装和配置消息服务器
- en: '**Advanced Message Queue Protocol** (**AMQP**) is the messaging technology
    powering most OpenStack-based clouds. Components such as Nova, Cinder, and Neutron
    communicate internally and between one another using a message bus. The following
    are instructions for installing RabbitMQ, an AMQP broker.'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: '**高级消息队列协议**（**AMQP**）是支撑大多数基于 OpenStack 的云计算平台的消息技术。像 Nova、Cinder 和 Neutron
    等组件通过消息总线在内部以及彼此之间进行通信。以下是安装 RabbitMQ（AMQP 中介）的说明。'
- en: 'On the `controller` node, install the messaging server:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 在 `controller` 节点上，安装消息服务器：
- en: '[PRE22]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Add a user to RabbitMQ named `openstack` with a password of `rabbit` as shown
    in the following command:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 向 RabbitMQ 中添加名为 `openstack` 的用户，并设置密码为 `rabbit`，如以下命令所示：
- en: '[PRE23]'
  id: totrans-139
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Set RabbitMQ permissions to allow configuration, read, and write access for
    the `openstack` user:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 设置 RabbitMQ 权限，以允许 `openstack` 用户进行配置、读取和写入操作：
- en: '[PRE24]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: At this point, the installation and configuration of RabbitMQ is complete.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 到此为止，RabbitMQ 的安装和配置已经完成。
- en: Installing and configuring memcached
  id: totrans-143
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装和配置 memcached
- en: The `memcached` service is used to cache common data and objects in RAM to reduce
    the numbers of times they are read from disk and it is used by various OpenStack
    services.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: '`memcached` 服务用于将常见的数据和对象缓存到 RAM 中，从而减少它们从磁盘读取的次数，多个 OpenStack 服务都会使用它。'
- en: 'On the `controller` node, install `memcached`:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 在 `controller` 节点上，安装 `memcached`：
- en: '[PRE25]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Edit the `/etc/memcached.conf` file and replace the default listener address
    with the IP address of the `controller` node:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 编辑 `/etc/memcached.conf` 文件，并将默认的监听地址替换为 `controller` 节点的 IP 地址：
- en: 'From: `127.0.0.1`'
  id: totrans-148
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 来源：`127.0.0.1`
- en: 'To: `10.10.0.100`'
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 目标：`10.10.0.100`
- en: 'Restart the `memcached` service:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 重启 `memcached` 服务：
- en: '[PRE26]'
  id: totrans-151
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: Installing and configuring the identity service
  id: totrans-152
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装和配置身份服务
- en: Keystone is the identity service for OpenStack and is used to authenticate and
    authorize users and services in the OpenStack cloud. Keystone should only be installed
    on the `controller` node and will be covered in the following sections.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: Keystone 是 OpenStack 的身份服务，用于在 OpenStack 云中对用户和服务进行认证和授权。Keystone 应该只安装在 `controller`
    节点上，后续部分将进行介绍。
- en: Configuring the database
  id: totrans-154
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置数据库
- en: 'Using the `mysql` client, create the Keystone database and associated user:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 `mysql` 客户端，创建 Keystone 数据库和相关用户：
- en: '[PRE27]'
  id: totrans-156
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Enter the following SQL statements at the `MariaDB [(none)] >` prompt:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 在 `MariaDB [(none)] >` 提示符下输入以下 SQL 语句：
- en: '[PRE28]'
  id: totrans-158
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: Installing Keystone
  id: totrans-159
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装 Keystone
- en: Since the Kilo release of OpenStack, the Keystone project has used the Apache
    HTTP server with `mod_wsgi` to serve requests to the Identity API on ports `5000`
    and `35357`.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 从 OpenStack 的 Kilo 版本开始，Keystone 项目使用 Apache HTTP 服务器和 `mod_wsgi` 来处理对身份 API
    的请求，监听端口 `5000` 和 `35357`。
- en: 'Run the following command to install the Keystone packages on the `controller`
    node:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 在`controller`节点上运行以下命令来安装Keystone软件包：
- en: '[PRE29]'
  id: totrans-162
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'Update the `[database]` section in the `/etc/keystone/keystone.conf` file to
    configure Keystone to use MySQL as its database. In this installation, the username
    and password will be `keystone.` You will need to overwrite the existing connection
    string with the following value on one line:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 更新`/etc/keystone/keystone.conf`文件中的`[database]`部分，将Keystone配置为使用MySQL作为数据库。在此安装中，用户名和密码为`keystone`。你需要用以下单行值覆盖现有的连接字符串：
- en: '[PRE30]'
  id: totrans-164
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: Configuring tokens and drivers
  id: totrans-165
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置令牌和驱动程序
- en: 'Keystone supports customizable token providers that can be defined within the
    `[token]` section of the configuration file. Keystone provides UUID, PKI, and
    Fernet token providers. In this installation, the Fernet token provider will be
    used. Update the `[token]` section in the `/etc/keystone/keystone.conf` file accordingly:'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: Keystone支持可自定义的令牌提供程序，这些提供程序可以在配置文件的`[token]`部分中定义。Keystone提供UUID、PKI和Fernet令牌提供程序。在此安装中，将使用Fernet令牌提供程序。相应地更新`/etc/keystone/keystone.conf`文件中的`[token]`部分：
- en: '[PRE31]'
  id: totrans-167
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'Populate the Keystone database using the `keystone-manage` utility:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`keystone-manage`工具填充Keystone数据库：
- en: '[PRE32]'
  id: totrans-169
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'Initialize the Fernet key repositories with the following commands:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下命令初始化Fernet密钥存储库：
- en: '[PRE33]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: Bootstrap the Identity service
  id: totrans-172
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 引导身份验证服务
- en: 'Using the `keystone-manage` command, bootstrap the service catalog with Identity
    endpoints. In this environment, the password for the `admin` user will be `openstack`:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`keystone-manage`命令，使用身份验证端点引导服务目录。在此环境中，`admin`用户的密码为`openstack`：
- en: '[PRE34]'
  id: totrans-174
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: Configuring the Apache HTTP server
  id: totrans-175
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置Apache HTTP服务器
- en: 'Using `sed`, add the `ServerName` option to the Apache configuration file that
    references the short name of the `controller` node:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`sed`命令，将`ServerName`选项添加到Apache配置文件中，引用`controller`节点的短名称：
- en: '[PRE35]'
  id: totrans-177
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'Restart the Apache web service for the changes to take effect:'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 重启Apache web服务以使更改生效：
- en: '[PRE36]'
  id: totrans-179
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: Setting environment variables
  id: totrans-180
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置环境变量
- en: 'To avoid having to provide credentials every time you run an OpenStack command,
    create a file containing environment variables that can be loaded at any time.
    The following commands will create a file named `adminrc` containing environment
    variables for the `admin` user:'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 为了避免每次运行OpenStack命令时都提供凭据，可以创建一个包含环境变量的文件，以便随时加载。以下命令将创建一个名为`adminrc`的文件，其中包含`admin`用户的环境变量：
- en: '[PRE37]'
  id: totrans-182
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'The following commands will create a file named `demorc` containing environment
    variables for the `demo` user:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 以下命令将创建一个名为`demorc`的文件，其中包含`demo`用户的环境变量：
- en: '[PRE38]'
  id: totrans-184
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'Use the `source` command to load the environment variables from the file:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`source`命令从文件加载环境变量：
- en: '[PRE39]'
  id: totrans-186
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: The `demo` user doesn't exist yet but will be created in the following sections.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: '`demo`用户尚不存在，但将在接下来的步骤中创建。'
- en: Defining services and API endpoints in Keystone
  id: totrans-188
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在Keystone中定义服务和API端点
- en: 'Each OpenStack service that is installed should be registered with the Identity
    service so that its location on the network can be tracked. There are two commands
    involved in registering a service:'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 每个安装的OpenStack服务都应该注册到身份验证服务，以便跟踪其在网络上的位置。注册服务时涉及两个命令：
- en: '`openstack service create`: Describes the service that is being created'
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`openstack service create`：描述正在创建的服务'
- en: '`openstack endpoint create`: Associates API endpoints with the service'
  id: totrans-191
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`openstack endpoint create`：将API端点与服务关联'
- en: 'The OpenStack Identity service and endpoint were created during the bootstrap
    process earlier in this chapter. You can verify the objects were created using
    the `openstack endpoint list` and `openstack service list` commands as shown here:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章之前的引导过程中，已经创建了OpenStack身份验证服务和端点。你可以使用`openstack endpoint list`和`openstack
    service list`命令来验证对象是否已创建，如下所示：
- en: '![](img/d7daca5f-6761-4c07-ab18-3ad03b9ce9b4.png)'
  id: totrans-193
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d7daca5f-6761-4c07-ab18-3ad03b9ce9b4.png)'
- en: 'The IDs of resources within an OpenStack cloud are unique and will vary between
    environments, so don''t worry if yours don''t match those shown here:'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: OpenStack云中的资源ID是唯一的，并且在不同的环境之间会有所不同，因此如果你的ID与这里显示的不一致，请不用担心：
- en: '![](img/8b9c711f-033a-458b-a1e2-6635b1493603.png)'
  id: totrans-195
  prefs: []
  type: TYPE_IMG
  zh: '![](img/8b9c711f-033a-458b-a1e2-6635b1493603.png)'
- en: Defining users, projects, and roles in Keystone
  id: totrans-196
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在Keystone中定义用户、项目和角色
- en: Once the installation of Keystone is complete, it is necessary to set up domains,
    users, projects, roles, and endpoints that will be used by various OpenStack services.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦Keystone的安装完成，就需要设置将被各种OpenStack服务使用的域、用户、项目、角色和端点。
- en: In this installation, the `default` domain will be used.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 在此安装过程中，将使用`default`域。
- en: 'In Keystone, a project (or tenant) represents a logical group of users to which
    resources are assigned. The terms project and tenant are used interchangeably
    throughout various OpenStack services, but project is the preferred term. Resources
    are assigned to projects and not directly to users. An `admin` project, user,
    and role were created during the Keystone bootstrap process. Create a `demo` project
    for regular users and a `service` project for other OpenStack services to use:'
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 在Keystone中，项目（或租户）代表一组逻辑上的用户，资源分配给这些用户。项目和租户在各种OpenStack服务中可互换使用，但项目是优选的术语。资源分配给项目，而不是直接分配给用户。在Keystone引导过程中创建了`admin`项目、用户和角色。为常规用户创建一个`demo`项目，为其他OpenStack服务创建一个`service`项目：
- en: '[PRE40]'
  id: totrans-200
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'Next, create a regular user called `demo`. Specify a secure password for the
    `demo` user:'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，创建一个名为`demo`的常规用户。为`demo`用户指定一个安全密码：
- en: '[PRE41]'
  id: totrans-202
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'Create the `user` role:'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 创建`user`角色：
- en: '[PRE42]'
  id: totrans-204
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'Lastly, add the `user` role to the `demo` user in the `demo` project:'
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，将`user`角色添加到`demo`用户的`demo`项目中：
- en: '[PRE43]'
  id: totrans-206
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: Installing and configuring the image service
  id: totrans-207
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装和配置镜像服务
- en: Glance is the image service for OpenStack. It is responsible for storing images
    and snapshots of instances, and for providing images to `compute` nodes when instances
    are created.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: Glance是OpenStack的镜像服务，负责存储实例的镜像和快照，并在创建实例时向`compute`节点提供镜像。
- en: Configuring the database
  id: totrans-209
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置数据库
- en: 'Using the `mysql` client, create the Glance database and associated user:'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`mysql`客户端创建Glance数据库和关联的用户：
- en: '[PRE44]'
  id: totrans-211
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'Enter the following SQL statements at the `MariaDB [(none)] >` prompt:'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 在`MariaDB [(none)] >`提示符下输入以下SQL语句：
- en: '[PRE45]'
  id: totrans-213
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: Defining the Glance user, service, and endpoints
  id: totrans-214
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 定义Glance用户、服务和端点
- en: 'Using the `openstack` client, create the Glance user:'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`openstack`客户端创建Glance用户：
- en: '[PRE46]'
  id: totrans-216
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'Add the `admin` role to the `glance` user in the `service` project:'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 将`admin`角色添加到`service`项目中的`glance`用户：
- en: '[PRE47]'
  id: totrans-218
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'Next, create the `glance` service entity:'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，创建`glance`服务实体：
- en: '[PRE48]'
  id: totrans-220
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'Lastly, create the Glance endpoints:'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，创建Glance端点：
- en: '[PRE49]'
  id: totrans-222
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: Installing and configuring Glance components
  id: totrans-223
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装和配置Glance组件
- en: 'To install Glance, run the following command from the `controller` node:'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 要安装Glance，请在`controller`节点上运行以下命令：
- en: '[PRE50]'
  id: totrans-225
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'Update the database connection string in the `glance-api` configuration file
    found at `/etc/glance/glance-api.conf` to use the MySQL Glance database:'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 更新位于`/etc/glance/glance-api.conf`的`glance-api`配置文件中的数据库连接字符串，以使用MySQL Glance数据库：
- en: '[PRE51]'
  id: totrans-227
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: 'Repeat the process for the `glance-registry` configuration file found at `/etc/glance/glance-registry.conf`:'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 对位于`/etc/glance/glance-registry.conf`的`glance-registry`配置文件重复该过程：
- en: '[PRE52]'
  id: totrans-229
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: Configuring authentication settings
  id: totrans-230
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置身份验证设置
- en: Both the `glance-api` and `glance-registry` service configuration files must
    be updated with the appropriate authentication settings before the services will
    operate.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 在服务运行之前，必须更新`glance-api`和`glance-registry`服务配置文件中的适当身份验证设置。
- en: 'Update the `[keystone_authtoken]` settings in the `glance-api` configuration
    file found at `/etc/glance/glance-api.conf`:'
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 更新位于`/etc/glance/glance-api.conf`的`glance-api`配置文件中的`[keystone_authtoken]`设置：
- en: '[PRE53]'
  id: totrans-233
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: 'Repeat the process for the `glance-registry` configuration file found at `/etc/glance/glance-registry.conf`:'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 对位于`/etc/glance/glance-registry.conf`的`glance-registry`配置文件重复该过程：
- en: '[PRE54]'
  id: totrans-235
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: Configuring additional settings
  id: totrans-236
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置附加设置
- en: 'Update the `glance-api` configuration file found at `/etc/glance/glance-api.conf`
    with the following additional settings:'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 更新位于`/etc/glance/glance-api.conf`的`glance-api`配置文件，添加以下设置：
- en: '[PRE55]'
  id: totrans-238
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'Next, update the `glance-registry` configuration file found at `/etc/glance/glance-registry.conf`
    with the following additional settings:'
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，更新位于`/etc/glance/glance-registry.conf`的`glance-registry`配置文件，添加以下设置：
- en: '[PRE56]'
  id: totrans-240
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: 'When both files have been updated, populate the Glance database using the `glance-manage`
    utility:'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 当两个文件都更新后，使用`glance-manage`工具填充Glance数据库：
- en: '[PRE57]'
  id: totrans-242
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: 'Lastly, restart the `Glance` services with the following command:'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，使用以下命令重启`Glance`服务：
- en: '[PRE58]'
  id: totrans-244
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: Verifying the Glance image service installation
  id: totrans-245
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 验证Glance镜像服务的安装情况
- en: 'Source the `adminrc` script to set or update the environment variables:'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 运行`adminrc`脚本以设置或更新环境变量：
- en: '[PRE59]'
  id: totrans-247
  prefs: []
  type: TYPE_PRE
  zh: '[PRE59]'
- en: 'To verify that Glance was installed and configured properly, download a test
    image from the internet and verify it can be uploaded to the image server:'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 为了验证Glance是否正确安装和配置，从互联网下载一个测试镜像，并验证其是否可以上传到镜像服务器：
- en: '[PRE60]'
  id: totrans-249
  prefs: []
  type: TYPE_PRE
  zh: '[PRE60]'
- en: 'Upload the image to Glance using the following command:'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下命令将镜像上传到Glance：
- en: '[PRE61]'
  id: totrans-251
  prefs: []
  type: TYPE_PRE
  zh: '[PRE61]'
- en: 'Verify the image exists in Glance using the `openstack image list` command
    shown here:'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`openstack image list`命令验证镜像是否存在于Glance中，如下所示：
- en: '![](img/d9808b2c-5e0b-48c3-877c-260199e6a987.png)'
  id: totrans-253
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d9808b2c-5e0b-48c3-877c-260199e6a987.png)'
- en: Installing additional images
  id: totrans-254
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装额外的镜像
- en: 'The CirrOS image is limited in functionality and is recommended only for testing
    network connectivity and basic Compute services. Multiple vendors provide cloud-ready
    images for use with OpenStack, including the following:'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: CirrOS镜像功能有限，仅推荐用于测试网络连接和基础的计算服务。多个供应商提供适用于OpenStack的云镜像，包括以下内容：
- en: '| **Canonical - Ubuntu ** | [http://cloud-images.ubuntu.com/](http://cloud-images.ubuntu.com/)
    |'
  id: totrans-256
  prefs: []
  type: TYPE_TB
  zh: '| **Canonical - Ubuntu** | [http://cloud-images.ubuntu.com/](http://cloud-images.ubuntu.com/)
    |'
- en: '| **Red Hat - CentOS** | [http://cloud.centos.org/centos/](http://cloud.centos.org/centos/)
    |'
  id: totrans-257
  prefs: []
  type: TYPE_TB
  zh: '| **Red Hat - CentOS** | [http://cloud.centos.org/centos/](http://cloud.centos.org/centos/)
    |'
- en: 'To install the Ubuntu 16.04 LTS image, download the file to `/tmp/images` and
    upload it to Glance:'
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 要安装Ubuntu 16.04 LTS镜像，将文件下载到`/tmp/images`并上传到Glance：
- en: '[PRE62]'
  id: totrans-259
  prefs: []
  type: TYPE_PRE
  zh: '[PRE62]'
- en: 'Use the `openstack image create` command to upload the new image:'
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`openstack image create`命令上传新镜像：
- en: '[PRE63]'
  id: totrans-261
  prefs: []
  type: TYPE_PRE
  zh: '[PRE63]'
- en: 'Another look at the image list shows the new Ubuntu image is available for
    use:'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 再次查看镜像列表，显示新的Ubuntu镜像已准备好使用：
- en: '![](img/eea1c42a-47a3-429c-9910-4327fd092934.png)'
  id: totrans-263
  prefs: []
  type: TYPE_IMG
  zh: '![](img/eea1c42a-47a3-429c-9910-4327fd092934.png)'
- en: Installing and configuring the Compute service
  id: totrans-264
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装和配置计算服务
- en: OpenStack Compute is a collection of services that enable cloud operators and
    users to launch virtual machine instances. Most services run on the `controller`
    node, with the exception of the `nova-compute` service, which runs on the `compute`
    nodes and is responsible for launching the virtual machine instances on those
    nodes.
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: OpenStack计算是一个服务集合，允许云操作员和用户启动虚拟机实例。大多数服务在`controller`节点上运行，除`nova-compute`服务外，后者运行在`compute`节点上，负责在这些节点上启动虚拟机实例。
- en: Configuring the database
  id: totrans-266
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置数据库
- en: 'Using the `mysql` client on the `controller` node, create the Nova database(s)
    and associated user(s):'
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 在`controller`节点上使用`mysql`客户端，创建Nova数据库及相关用户：
- en: '[PRE64]'
  id: totrans-268
  prefs: []
  type: TYPE_PRE
  zh: '[PRE64]'
- en: 'Enter the following SQL statements at the `MariaDB [(none)] >` prompt:'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 在`MariaDB [(none)] >`提示符下输入以下SQL语句：
- en: '[PRE65]'
  id: totrans-270
  prefs: []
  type: TYPE_PRE
  zh: '[PRE65]'
- en: Defining the Nova user, service, and endpoints
  id: totrans-271
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 定义Nova用户、服务和端点
- en: 'Source the `adminrc` credentials as shown here:'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 如下所示，源`adminrc`凭证：
- en: '[PRE66]'
  id: totrans-273
  prefs: []
  type: TYPE_PRE
  zh: '[PRE66]'
- en: 'Using the `openstack` client, create both the `nova` and `placement` users:'
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`openstack`客户端，创建`nova`和`placement`用户：
- en: '[PRE67]'
  id: totrans-275
  prefs: []
  type: TYPE_PRE
  zh: '[PRE67]'
- en: 'Add the `admin` role to the `nova` and `placement` users in the `service` project:'
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 将`admin`角色添加到`nova`和`placement`用户的`service`项目中：
- en: '[PRE68]'
  id: totrans-277
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: 'Next, create the `compute` and `placement` service entities:'
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，创建`compute`和`placement`服务实体：
- en: '[PRE69]'
  id: totrans-279
  prefs: []
  type: TYPE_PRE
  zh: '[PRE69]'
- en: 'Lastly, create the `compute` and `placement` endpoints:'
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，创建`compute`和`placement`端点：
- en: '[PRE70]'
  id: totrans-281
  prefs: []
  type: TYPE_PRE
  zh: '[PRE70]'
- en: Installing and configuring controller node components
  id: totrans-282
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装和配置控制节点组件
- en: 'Execute the following command on the `controller` node to install the various
    `Compute` services used by the controller:'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 在`controller`节点上执行以下命令，以安装控制节点使用的各种`Compute`服务：
- en: '[PRE71]'
  id: totrans-284
  prefs: []
  type: TYPE_PRE
  zh: '[PRE71]'
- en: 'Update the `[database]` and `[api_database]` sections of the Nova configuration
    file found at `/etc/nova/nova.conf` with the following database connection strings:'
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下数据库连接字符串，更新位于`/etc/nova/nova.conf`的Nova配置文件中的`[database]`和`[api_database]`部分：
- en: '[PRE72]'
  id: totrans-286
  prefs: []
  type: TYPE_PRE
  zh: '[PRE72]'
- en: 'Update the `[DEFAULT]` section of the Nova configuration file to configure
    Nova to use the RabbitMQ message broker:'
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 更新Nova配置文件中的`[DEFAULT]`部分，以配置Nova使用RabbitMQ消息代理：
- en: '[PRE73]'
  id: totrans-288
  prefs: []
  type: TYPE_PRE
  zh: '[PRE73]'
- en: The VNC Proxy is an OpenStack component that allows users to access their instances
    through VNC clients. VNC stands for **Virtual Network Computing**, and is a graphical
    desktop sharing system that uses the Remote Frame Buffer protocol to control another
    computer over a network. The controller must be able to communicate with `compute`
    nodes for VNC services to work properly through the Horizon dashboard or other
    VNC clients.
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: VNC代理是一个OpenStack组件，允许用户通过VNC客户端访问他们的实例。VNC代表**虚拟网络计算**，是一种图形化桌面共享系统，使用远程帧缓冲协议通过网络控制另一台计算机。控制节点必须能够与`compute`节点通信，以便通过Horizon仪表板或其他VNC客户端正常工作VNC服务。
- en: 'Update the `[vnc]` section of the Nova configuration file to configure the
    appropriate VNC settings for the `controller` node:'
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 更新Nova配置文件中的`[vnc]`部分，以为`controller`节点配置适当的VNC设置：
- en: '[PRE74]'
  id: totrans-291
  prefs: []
  type: TYPE_PRE
  zh: '[PRE74]'
- en: Configuring authentication settings
  id: totrans-292
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置认证设置
- en: 'Update the Nova configuration file at `/etc/nova/nova.conf` with the following
    Keystone-related attribute:'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下与Keystone相关的属性，更新位于`/etc/nova/nova.conf`的Nova配置文件：
- en: '[PRE75]'
  id: totrans-294
  prefs: []
  type: TYPE_PRE
  zh: '[PRE75]'
- en: Additional controller tasks
  id: totrans-295
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 其他控制器任务
- en: 'Update the Nova configuration file at `/etc/nova/nova.conf` to specify the
    location of the Glance API:'
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 更新位于`/etc/nova/nova.conf`的Nova配置文件，指定Glance API的位置：
- en: '[PRE76]'
  id: totrans-297
  prefs: []
  type: TYPE_PRE
  zh: '[PRE76]'
- en: 'Update the Nova configuration file to set the lock file path for Nova services
    and specify the IP address of the `controller` node:'
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 更新Nova配置文件，设置Nova服务的锁文件路径并指定`controller`节点的IP地址：
- en: '[PRE77]'
  id: totrans-299
  prefs: []
  type: TYPE_PRE
  zh: '[PRE77]'
- en: 'Configure the `[placement]` section within `/etc/nova/nova.conf`. Be sure to
    comment out any existing `os_region_name` configuration:'
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 配置`/etc/nova/nova.conf`中的`[placement]`部分。确保注释掉任何现有的`os_region_name`配置：
- en: '[PRE78]'
  id: totrans-301
  prefs: []
  type: TYPE_PRE
  zh: '[PRE78]'
- en: 'Populate the `nova-api` database using the `nova-manage` utility:'
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`nova-manage`工具填充`nova-api`数据库：
- en: '[PRE79]'
  id: totrans-303
  prefs: []
  type: TYPE_PRE
  zh: '[PRE79]'
- en: 'Register the `cell0` database using the `nova-manage` utility:'
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`nova-manage`工具注册`cell0`数据库：
- en: '[PRE80]'
  id: totrans-305
  prefs: []
  type: TYPE_PRE
  zh: '[PRE80]'
- en: 'Create the `cell1` cell:'
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: 创建`cell1`单元：
- en: '[PRE81]'
  id: totrans-307
  prefs: []
  type: TYPE_PRE
  zh: '[PRE81]'
- en: 'Populate the `nova` database using the `nova-manage` utility:'
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`nova-manage`工具填充`nova`数据库：
- en: '[PRE82]'
  id: totrans-309
  prefs: []
  type: TYPE_PRE
  zh: '[PRE82]'
- en: 'Lastly, restart the controller-based Compute services for the changes to take
    effect:'
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，重启基于控制器的计算服务，使更改生效：
- en: '[PRE83]'
  id: totrans-311
  prefs: []
  type: TYPE_PRE
  zh: '[PRE83]'
- en: Installing and configuring compute node components
  id: totrans-312
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装并配置计算节点组件
- en: Once the `Compute` services have been configured on the `controller` node, at
    least one other host must be configured as a `compute` node. The `compute` node
    receives requests from the `controller` node to host virtual machine instances.
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦在`controller`节点上配置了`Compute`服务，至少还需要配置一个其他主机作为`compute`节点。`compute`节点接收来自`controller`节点的请求，托管虚拟机实例。
- en: 'On the `compute` nodes, install the `nova-compute` package and related packages.
    These packages provide virtualization support services to the `compute` node:'
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 在`compute`节点上，安装`nova-compute`软件包及相关软件包。这些软件包为`compute`节点提供虚拟化支持服务：
- en: '[PRE84]'
  id: totrans-315
  prefs: []
  type: TYPE_PRE
  zh: '[PRE84]'
- en: 'Update the Nova configuration file at `/etc/nova/nova.conf` on the `compute`
    nodes with the following Keystone-related settings:'
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: 在`compute`节点上，使用以下与Keystone相关的设置更新位于`/etc/nova/nova.conf`的Nova配置文件：
- en: '[PRE85]'
  id: totrans-317
  prefs: []
  type: TYPE_PRE
  zh: '[PRE85]'
- en: 'Next, update the `[DEFAULT]` section of the Nova configuration file to configure
    Nova to use the RabbitMQ message broker:'
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，更新Nova配置文件的`[DEFAULT]`部分，配置Nova使用RabbitMQ消息代理：
- en: '[PRE86]'
  id: totrans-319
  prefs: []
  type: TYPE_PRE
  zh: '[PRE86]'
- en: Then, update the Nova configuration file to provide remote console access to
    instances through a proxy on the `controller` node. The remote console is accessible
    through the Horizon dashboard. The IP configured as `my_ip` should be the respective
    management IP of each `compute` node.
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，更新Nova配置文件，以通过`controller`节点的代理提供远程控制台访问实例。远程控制台可以通过Horizon仪表盘访问。配置为`my_ip`的IP应该是每个`compute`节点的管理IP。
- en: '`Compute01`:'
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: '`Compute01`：'
- en: '[PRE87]'
  id: totrans-322
  prefs: []
  type: TYPE_PRE
  zh: '[PRE87]'
- en: '`Compute02`:'
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: '`Compute02`：'
- en: '[PRE88]'
  id: totrans-324
  prefs: []
  type: TYPE_PRE
  zh: '[PRE88]'
- en: '`Compute03`:'
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: '`Compute03`：'
- en: '[PRE89]'
  id: totrans-326
  prefs: []
  type: TYPE_PRE
  zh: '[PRE89]'
- en: Additional compute tasks
  id: totrans-327
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 其他计算任务
- en: 'Update the Nova configuration file at `/etc/nova/nova.conf` to specify the
    location of the Glance API:'
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: 更新位于`/etc/nova/nova.conf`的Nova配置文件，指定Glance API的位置：
- en: '[PRE90]'
  id: totrans-329
  prefs: []
  type: TYPE_PRE
  zh: '[PRE90]'
- en: 'Update the Nova configuration file to set the lock file path for `Nova` services:'
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
  zh: 更新Nova配置文件，设置`Nova`服务的锁文件路径：
- en: '[PRE91]'
  id: totrans-331
  prefs: []
  type: TYPE_PRE
  zh: '[PRE91]'
- en: 'Configure the `[placement]` section within `/etc/nova/nova.conf`. Be sure to
    comment out any existing `os_region_name` configuration:'
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
  zh: 配置`/etc/nova/nova.conf`中的`[placement]`部分。确保注释掉任何现有的`os_region_name`配置：
- en: '[PRE92]'
  id: totrans-333
  prefs: []
  type: TYPE_PRE
  zh: '[PRE92]'
- en: 'Restart the `nova-compute` service on all `compute` nodes:'
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
  zh: 在所有`compute`节点上重启`nova-compute`服务：
- en: '[PRE93]'
  id: totrans-335
  prefs: []
  type: TYPE_PRE
  zh: '[PRE93]'
- en: Adding the compute node(s) to the cell database
  id: totrans-336
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将计算节点添加到单元数据库
- en: 'When compute services are started for the first time on a `compute` node, the
    node is registered via the Nova Placement API. To verify the `compute` node(s)
    are registered, use the `openstack compute service list` command as shown here:'
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: 当计算服务首次在`compute`节点上启动时，该节点通过Nova Placement API进行注册。要验证`compute`节点是否已注册，可以使用如下的`openstack
    compute service list`命令：
- en: '![](img/92a4b63f-82d2-4095-a36c-382dbab74ddc.png)'
  id: totrans-338
  prefs: []
  type: TYPE_IMG
  zh: '![](img/92a4b63f-82d2-4095-a36c-382dbab74ddc.png)'
- en: Installing the OpenStack Dashboard
  id: totrans-339
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装OpenStack仪表盘
- en: The OpenStack Dashboard, also known as Horizon, provides a web-based user interface
    to OpenStack services including Compute, Networking, Storage, and Identity, among
    others.
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
  zh: OpenStack仪表盘，也称为Horizon，提供了一个基于Web的用户界面，用于访问OpenStack服务，包括计算、网络、存储和身份等。
- en: 'To add Horizon to the environment, install the following package on the `controller`
    node:'
  id: totrans-341
  prefs: []
  type: TYPE_NORMAL
  zh: 为了将Horizon添加到环境中，在`controller`节点上安装以下软件包：
- en: '[PRE94]'
  id: totrans-342
  prefs: []
  type: TYPE_PRE
  zh: '[PRE94]'
- en: Updating the host and API version configuration
  id: totrans-343
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 更新主机和API版本配置
- en: 'Edit the `/etc/openstack-dashboard/local_settings.py` file and change the `OPENSTACK_HOST` value
    from its default to the following:'
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
  zh: 编辑`/etc/openstack-dashboard/local_settings.py`文件，并将`OPENSTACK_HOST`的值从默认值更改为以下内容：
- en: '[PRE95]'
  id: totrans-345
  prefs: []
  type: TYPE_PRE
  zh: '[PRE95]'
- en: 'Set the API versions with the following dictionary:'
  id: totrans-346
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下字典设置API版本：
- en: '[PRE96]'
  id: totrans-347
  prefs: []
  type: TYPE_PRE
  zh: '[PRE96]'
- en: Configuring Keystone settings
  id: totrans-348
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置 Keystone 设置
- en: 'Edit the `/etc/openstack-dashboard/local_settings.py` file and replace the
    following Keystone-related configuration options with these values:'
  id: totrans-349
  prefs: []
  type: TYPE_NORMAL
  zh: 编辑`/etc/openstack-dashboard/local_settings.py`文件，并将以下与 Keystone 相关的配置选项替换为这些值：
- en: '[PRE97]'
  id: totrans-350
  prefs: []
  type: TYPE_PRE
  zh: '[PRE97]'
- en: Modifying network configuration
  id: totrans-351
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 修改网络配置
- en: 'The stock Horizon configuration enables certain network functionality that
    has not yet been implemented. As a result, you will experience errors in the dashboard
    that may impact usability. For now, disable all network functions in the dashboard
    by setting the following configuration:'
  id: totrans-352
  prefs: []
  type: TYPE_NORMAL
  zh: 股票 Horizon 配置启用了某些尚未实现的网络功能。因此，您可能会在仪表板中遇到错误，这些错误可能会影响可用性。现在，请通过设置以下配置禁用仪表板中的所有网络功能：
- en: '[PRE98]'
  id: totrans-353
  prefs: []
  type: TYPE_PRE
  zh: '[PRE98]'
- en: Uninstalling default Ubuntu theme (optional)
  id: totrans-354
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 卸载默认的 Ubuntu 主题（可选）
- en: 'By default, installations of the OpenStack Dashboard on Ubuntu include a theme
    that has been customized by Canonical. To remove the theme, update the `/etc/openstack-dashboard/local_settings.py` file
    and replace the `DEFAULT_THEME` value with `default` instead of `ubuntu`:'
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Ubuntu 上的 OpenStack Dashboard 安装包含由 Canonical 定制的主题。要移除该主题，请更新`/etc/openstack-dashboard/local_settings.py`文件，并将`DEFAULT_THEME`值从`ubuntu`替换为`default`：
- en: '[PRE99]'
  id: totrans-356
  prefs: []
  type: TYPE_PRE
  zh: '[PRE99]'
- en: The examples in this book assume the default theme is in place.
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
  zh: 本书中的示例假设已安装默认主题。
- en: Reloading Apache
  id: totrans-358
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 重新加载 Apache
- en: 'Once the above changes have been made, reload the Apache web server configuration
    using the following command:'
  id: totrans-359
  prefs: []
  type: TYPE_NORMAL
  zh: 完成上述更改后，使用以下命令重新加载 Apache Web 服务器配置：
- en: '[PRE100]'
  id: totrans-360
  prefs: []
  type: TYPE_PRE
  zh: '[PRE100]'
- en: Testing connectivity to the dashboard
  id: totrans-361
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 测试与仪表板的连接
- en: From a machine that has access to the management network of the `controller01` node,
    open the following URL in a web browser: [http://controller01/horizon/.](http://controller01/horizon/)
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
  zh: 在可以访问`controller01`节点管理网络的机器上，打开以下 URL：[http://controller01/horizon/.](http://controller01/horizon/)
- en: The API network is reachable from my workstation and the `/etc/hosts` file on
    my client workstation has been updated to include the same hostname-to-IP mappings
    configured earlier in this chapter.
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
  zh: 我的工作站能够访问 API 网络，并且客户端工作站上的`/etc/hosts`文件已更新，以包含本章前面配置的相同主机名到 IP 的映射。
- en: The following screenshot demonstrates a successful connection to the dashboard.
    The username and password were created in the *Defining users, projects, and roles
    in Keystone* section earlier in this chapter. In this installation, the domain
    is `Default`, the username is `admin,` and the password is `openstack`.
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图演示了成功连接到仪表板。用户名和密码是在本章前面的*定义用户、项目和 Keystone 中的角色*部分中创建的。在此安装中，域名为`Default`，用户名为`admin`，密码为`openstack`。
- en: Familiarizing yourself with the dashboard
  id: totrans-365
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 熟悉仪表板
- en: 'Once you have successfully logged in, the dashboard defaults to the Identity panel.
    Project-related tasks can be completed in the Project panel, while users with
    the `admin` role will find an Admin panel that allows for administrative tasks
    to be completed:'
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: 成功登录后，仪表板默认显示身份面板。项目相关任务可以在项目面板中完成，而具有`admin`角色的用户将在管理员面板中找到可以完成管理任务的选项：
- en: '![](img/4004c6df-de06-40d9-94c1-bd5b43c59395.png)'
  id: totrans-367
  prefs: []
  type: TYPE_IMG
  zh: '![](img/4004c6df-de06-40d9-94c1-bd5b43c59395.png)'
- en: 'By navigating to the System Information page within the Admin / System panel,
    we can see services listed that correspond to those installed earlier in this
    chapter:'
  id: totrans-368
  prefs: []
  type: TYPE_NORMAL
  zh: 通过进入管理员 / 系统面板中的系统信息页面，我们可以看到与本章前面安装的服务相对应的服务列表：
- en: '![](img/a6c19155-c30e-4f8c-92db-2fd750a53567.png)'
  id: totrans-369
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a6c19155-c30e-4f8c-92db-2fd750a53567.png)'
- en: 'The OpenStack Dashboard allows users to make changes within any project for
    which they have permissions. The menu located to the right of the OpenStack logo
    is a drop-down menu that allows users to select the project they''d like to work
    with:'
  id: totrans-370
  prefs: []
  type: TYPE_NORMAL
  zh: OpenStack Dashboard 允许用户在其拥有权限的任何项目中进行更改。位于 OpenStack 标志右侧的菜单是一个下拉菜单，允许用户选择他们想要操作的项目：
- en: '![](img/9832a490-2327-4046-847d-d0e0b528b299.png)'
  id: totrans-371
  prefs: []
  type: TYPE_IMG
  zh: '![](img/9832a490-2327-4046-847d-d0e0b528b299.png)'
- en: Only projects to which the user is assigned will be listed. If the user has
    the `admin` role, additional cloud-wide changes can be made within the Admin panel.
    Using the Horizon dashboard to perform networking functions will be covered in
    later chapters.
  id: totrans-372
  prefs: []
  type: TYPE_NORMAL
  zh: 只有用户被分配的项目才会列出。如果用户具有`admin`角色，可以在管理员面板中进行其他云范围的更改。使用 Horizon 仪表板执行网络功能将在后续章节中介绍。
- en: Summary
  id: totrans-373
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: At this point in the installation, the OpenStack Identity, Image, Dashboard,
    and Compute services have been successfully deployed across the nodes of the cloud.
    The environment is not ready to host instances just yet, as OpenStack Networking
    services have not been installed or configured. If issues arise during the installation
    of services described in this chapter, be sure to check the log messages found
    in `/var/log/nova/`, `/var/log/glance/`, `/var/log/apache2/`, and `/var/log/keystone/` for
    assistance in troubleshooting. For additional information regarding the installation
    process, feel free to check out the documentation available the OpenStack website
    at the following URL: [http://docs.openstack.org](http://docs.openstack.org).
  id: totrans-374
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，OpenStack 身份、镜像、仪表盘和计算服务已成功部署到云的各个节点。此时，环境尚未准备好托管实例，因为 OpenStack 网络服务尚未安装或配置。如果在本章描述的服务安装过程中出现问题，请务必查看
    `/var/log/nova/`、`/var/log/glance/`、`/var/log/apache2/` 和 `/var/log/keystone/`
    中的日志消息，以帮助故障排除。有关安装过程的更多信息，请随时查看 OpenStack 网站上提供的文档，网址为：[http://docs.openstack.org](http://docs.openstack.org)。
- en: In the next chapter, we will begin the installation of Neutron networking services
    and discover additional information about the internal architecture of OpenStack
    Networking.
  id: totrans-375
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章，我们将开始安装 Neutron 网络服务，并探索关于 OpenStack 网络内部架构的更多信息。
