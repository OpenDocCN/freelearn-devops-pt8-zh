- en: Chapter 7. Securing Proxmox VE
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第 7 章：确保 Proxmox VE 安全
- en: '|   | "Abstraction may be discovered or produced, may be material or immaterial,
    but abstraction is what every hack produces and affirms....To hack is to produce
    or apply the abstract to information and the possibility of new worlds" |   |'
  id: totrans-1
  prefs: []
  type: TYPE_TB
  zh: '|   | "抽象可以被发现或产生，可以是物质的也可以是非物质的，但每一个黑客行为都会产生并确认抽象……黑客行为是将抽象应用到信息上，从而开启新世界的可能性。"
    |   |'
- en: '|   | -- *A Hacker Manifesto, McKenzie Wark* |'
  id: totrans-2
  prefs: []
  type: TYPE_TB
  zh: '|   | -- *黑客宣言，麦肯齐·沃克* |'
- en: '|   | *"Putting it bluntly, virtualization is deception."* |   |'
  id: totrans-3
  prefs: []
  type: TYPE_TB
  zh: '|   | *“直白地说，虚拟化就是欺骗。”* |   |'
- en: '|   | -- *Data Center Virtualization Essentials, Gustavo Alessandro Andrade
    Santana* |'
  id: totrans-4
  prefs: []
  type: TYPE_TB
  zh: '|   | -- *数据中心虚拟化要点，古斯塔沃·亚历山德罗·安德拉德·桑塔纳* |'
- en: '|   | *"The enemy knows the system being used..."* |   |'
  id: totrans-5
  prefs: []
  type: TYPE_TB
  zh: '|   | *“敌人了解正在使用的系统……”* |   |'
- en: '|   | -- *Shannon''s Maxim* |'
  id: totrans-6
  prefs: []
  type: TYPE_TB
  zh: '|   | -- *香农法则* |'
- en: '|   | *"Security through obscurity is not an answer."* |   |'
  id: totrans-7
  prefs: []
  type: TYPE_TB
  zh: '|   | *“通过模糊性实现的安全并不是解决方案。”* |   |'
- en: '|   | -- *Information Security: Principles and Practices, Merkow and Breithaupt*
    |'
  id: totrans-8
  prefs: []
  type: TYPE_TB
  zh: '|   | -- *信息安全：原则与实践，Merkow 和 Breithaupt* |'
- en: '|   | *"Containers have quickly become a popular cloud-optimization strategy
    for enterprises, however, what do we really know about the security implications?"*
    |   |'
  id: totrans-9
  prefs: []
  type: TYPE_TB
  zh: '|   | *“容器已经迅速成为企业云优化战略中的一个热门选择，但我们对其安全影响究竟了解多少？”* |   |'
- en: '|   | -- *Kowsik Guruswamy* |'
  id: totrans-10
  prefs: []
  type: TYPE_TB
  zh: '|   | -- *Kowsik Guruswamy* |'
- en: The end goal of this chapter is to support you in mitigating threats to the
    security of your Proxmox VE infrastructure.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的最终目标是帮助你减轻 Proxmox VE 基础设施的安全威胁。
- en: We start by enumerating and articulating the potential benefits of virtualization
    on infrastructure security.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先列举并阐明虚拟化对基础设施安全可能带来的好处。
- en: However, these benefits must not be relied on unconditionally or discussed uncritically;
    we must qualify them here.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，这些好处不能无条件地依赖或无批判地讨论；我们必须在此加以限定。
- en: Moreover, we must expose the potential security risks virtualization can inject
    into the infrastructure.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，我们必须揭示虚拟化可能给基础设施带来的潜在安全风险。
- en: Ultimately, this chapter commits to providing strategies for mitigating security
    threats to our Proxmox VE hosts and guests.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 最终，本章致力于提供减轻 Proxmox VE 主机和客户机安全威胁的策略。
- en: Security assurance is, of course, a sprawling field, and often includes not
    only threat mitigation, but also policy making, monitoring, incident response,
    and forensics. Our focus here is exclusively on mitigating vulnerabilities specific to
    Proxmox VE hosts.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 安全保证当然是一个广泛的领域，通常不仅包括威胁缓解，还涉及政策制定、监控、事件响应和取证。我们在这里的重点是专注于减轻特定于 Proxmox VE 主机的漏洞。
- en: 'Towards that end, then, the goals of security are defined here in accordance
    with tradition:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 为此，安全的目标在这里按照传统进行定义：
- en: Maintaining the *confidentiality* of a system
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 维护系统的*保密性*
- en: Assuring its *integrity*
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确保其*完整性*
- en: Providing consistent *availability* of services
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 提供服务的一致*可用性*
- en: '![Securing Proxmox VE](img/B01784_07_01-3.png)'
  id: totrans-21
  prefs: []
  type: TYPE_IMG
  zh: '![确保 Proxmox VE 安全](img/B01784_07_01-3.png)'
- en: Security triad
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 安全三要素
- en: 'The preceding illustration suggests that these three points are not isolated:
    the whole picture consists of three mutual relationships: one between confidentiality
    and integrity; one between confidentiality and availability; and, finally, one
    between integrity and availability. Too much or too little emphasis on one point
    distorts our Platonic triangle, a symbolic representation of our impossible ideal.'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 上面的插图表明，这三点并不是孤立的：整个图景由三个相互关系组成：保密性与完整性之间的关系；保密性与可用性之间的关系；最后是完整性与可用性之间的关系。对某一点的过度或不足的强调会扭曲我们的柏拉图三角形，这是一种我们不可能实现的理想的象征。
- en: 'Given our end goal—mitigating threats—this chapter proceeds along the following
    vector:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 鉴于我们的最终目标——减轻威胁——本章沿着以下方向进行：
- en: Examining the potential security rewards of virtualization
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 审视虚拟化可能带来的安全回报
- en: Interrogating those rewards and exploring the potential vulnerabilities virtualization
    introduces
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 审视这些回报，并探索虚拟化可能引入的潜在漏洞
- en: Acting directly to mitigate threats
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 直接采取行动以减轻威胁
- en: Security benefits of virtualization
  id: totrans-28
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 虚拟化的安全好处
- en: Introducing well-planned, deliberate, and well-executed virtualization into
    an infrastructure delivers some very compelling security benefits.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 在基础设施中引入经过精心规划、深思熟虑和执行良好的虚拟化，会带来一些非常有力的安全好处。
- en: Note
  id: totrans-30
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注
- en: '|   | "The abstraction of IT resources that masks the physical nature and boundaries
    of those resources..." |   |'
  id: totrans-31
  prefs: []
  type: TYPE_TB
  zh: '|   | "IT 资源的抽象掩盖了这些资源的物理性质和边界……" |   |'
- en: '|   | -- *Virtualization as defined by Gartner''s IT Glossary ([http://www.gartner.com/it-glossary/virtualization](http://www.gartner.com/it-glossary/virtualization)).*
    |'
  id: totrans-32
  prefs: []
  type: TYPE_TB
  zh: '|   | -- *根据Gartner的IT词汇表定义的虚拟化（[http://www.gartner.com/it-glossary/virtualization](http://www.gartner.com/it-glossary/virtualization))。*
    |'
- en: 'Let''s be clear about one thing with regard to this common trope representing
    virtualization as a deceptive masquerade: security through obscurity does not
    work. The use of secrecy for the design or implementation of a system to provide
    security is a failing proposition.'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 关于将虚拟化表现为一种欺骗性伪装的常见说法，我们需要明确一点：安全性通过模糊化的方式是行不通的。为了提供安全性而设计或实施系统的秘密性是一种失败的方案。
- en: In enumerating the security benefits of virtualization, this section purposefully
    avoids suggesting that abstraction and the obfuscation it permits are an effective
    security strategy.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 在枚举虚拟化的安全优势时，本节有意避免暗示抽象化及其所允许的模糊化是一种有效的安全策略。
- en: 'We''ll see as the chapter develops that none of the security rewards promised
    by virtualization advocates can be realized without a good understanding of networking,
    systems administration, type 2 hypervisors, VMs, and containers. The following
    is also required:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 随着章节的发展，我们将看到，没有对网络、系统管理、二型虚拟机监控器、虚拟机和容器的良好理解，虚拟化倡导者所承诺的任何安全回报都是无法实现的。还需要以下内容：
- en: Rigorous planning based in part on defense in depth
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 部分基于深度防御的严格规划
- en: Flawless realization of those plans
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 完美实现这些计划
- en: Excellent management throughout the lifecycle of all guests.
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在所有虚拟机的生命周期中进行卓越的管理。
- en: 'Given all of the preceding, there are very clear security benefits to virtualization
    with Proxmox VE:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 鉴于前述所有内容，虚拟化使用Proxmox VE确实带来了非常明确的安全好处：
- en: Reduction of the physical attack surface
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 减少物理攻击面
- en: VM isolation
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 虚拟机隔离
- en: Ability to restore to prior states
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 恢复到先前状态的能力
- en: Hardware abstraction
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 硬件抽象
- en: Network segmentation support
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网络分段支持
- en: Encapsulation and portability
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 封装和可移植性
- en: Physical security
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 物理安全
- en: Fine privilege control
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 精细的权限控制
- en: Integrated firewalls
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 集成防火墙
- en: Attack surface reduction
  id: totrans-49
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 攻击面缩减
- en: Moving to a virtual infrastructure reduces your physical attack surface in accordance
    with your virtual machine density. The more physical servers we convert to Proxmox
    VE guests, in conjunction with how densely we pack guests onto our Proxmox VE
    hosts, the fewer servers there are to ensure protection from potentially devastating
    physical attacks, for example.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 转向虚拟化基础设施会根据虚拟机的密度减少物理攻击面。我们将更多的物理服务器转为Proxmox VE虚拟机，并根据我们将虚拟机密集地放置在Proxmox
    VE主机上的方式，物理服务器的数量减少，进而减少了遭受潜在致命物理攻击的风险。
- en: Virtualization has an inherent potential to reduce the attack surface of an
    infrastructure in several ways; we'll focus here on how it reduces the number
    of physical hosts providing services.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟化本身有潜力以多种方式减少基础设施的攻击面；我们将重点讨论它如何减少提供服务的物理主机数量。
- en: '![Attack surface reduction](img/B01784_07_02-3.png)'
  id: totrans-52
  prefs: []
  type: TYPE_IMG
  zh: '![攻击面缩减](img/B01784_07_02-3.png)'
- en: Visualizing attack vectors and the attack surface
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 可视化攻击向量和攻击面
- en: Where we were once protecting, say, 15 machines from physical attack, there
    might be one or two physical Proxmox VE hosts to protect, for example.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 曾经我们可能在保护15台机器免受物理攻击，现在可能只需要保护一两台物理Proxmox VE主机。
- en: We have to be critical here and realize this can open up new vulnerabilities
    and frustrating problems to resolve.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 我们必须保持批判性思维，意识到这可能会带来新的漏洞和令人沮丧的解决问题。
- en: 'The Proxmox VE host becomes monolithic, so:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: Proxmox VE主机变得更加单一，因此：
- en: If there's an unpatched vulnerability in Debian 8, PVE, or KVM and QEMU, the
    confidentiality, integrity, and availability of all the virtual machines hosted
    by that instance are also threatened.
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果Debian 8、PVE或KVM与QEMU存在未修补的漏洞，那么该实例托管的所有虚拟机的机密性、完整性和可用性也会受到威胁。
- en: If an attacker gains physical access to the PVE host or hosts, the security
    and sanctity of all guests, both containers and virtual machines, are most certainly
    in doubt. If that's troubling, consider too that your snapshots and backups may
    have disappeared.
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果攻击者获得了对PVE主机或主机的物理访问权限，那么所有虚拟机和容器的安全性和完整性肯定会受到怀疑。如果这令人担忧，还要考虑到你的快照和备份可能已经丢失。
- en: There's no doubt virtualization reduces the overall attack surface of your infrastructure,
    and in several ways; however, as articulated previously, this does not relieve
    us of any burdens, it just gives those burdens higher stakes while making them
    less complex to address.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 毫无疑问，虚拟化减少了基础设施的整体攻击面，并且在多个方面如此；然而，如前所述，这并不会减轻我们的任何负担，它只是让这些负担具有更高的风险，同时使其变得不那么复杂。
- en: Isolation
  id: totrans-60
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 隔离
- en: Virtualization encourages isolation. One VM doesn't naturally affect another
    VM, even if it is on the same host.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟化鼓励隔离。即使在同一主机上，一个虚拟机也不会自然地影响另一个虚拟机。
- en: This tendency toward isolation suggests that destructive malware infecting a
    virtual server won't necessarily escape and spread to other virtual servers, even
    when they share a host.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 这种隔离的趋势表明，破坏性的恶意软件感染虚拟服务器时，不一定会逃逸并传播到其他虚拟服务器，即使它们共享同一主机。
- en: If there's an oversight however, such as naively sharing data between two guests,
    or (worse) sharing data between a guest and the host, attacks can be devastating. Therefore,
    resist the temptation to create file shares among VMs on PVE; for the sake of
    security, do not share files between a Proxmox VE host and any of its guests.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，如果出现疏忽，比如天真地在两个来宾之间共享数据，或更糟糕的是在来宾和主机之间共享数据，攻击可能会造成灾难性后果。因此，要抵制在 PVE 上创建虚拟机共享文件的诱惑；为了安全起见，不要在
    Proxmox VE 主机和其任何来宾之间共享文件。
- en: Here the importance of documenting your infrastructure and writing a well-deliberated
    and well-enforced security policy is clear.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 这里，文档化你的基础设施并编写经过深思熟虑且严格执行的安全政策的重要性显而易见。
- en: Availability of prior states
  id: totrans-65
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 先前状态的可用性
- en: In the event an attack against a Proxmox VE guest succeeds, the guest can be
    rolled back to a prior state via backups or snapshots, effectively minimizing
    the time it takes to recover from an attack. (Note, however, that any data or
    information that changed between the time of the selected backup and the moment
    it is restored will be lost during a rollback.)
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 如果攻击成功针对 Proxmox VE 来宾，来宾可以通过备份或快照回滚到先前状态，从而有效地缩短从攻击中恢复的时间。然而需要注意的是，任何在选定备份时间与恢复时刻之间发生的更改，都会在回滚时丢失。
- en: '![Availability of prior states](img/B01784_07_03-3.png)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
  zh: '![先前状态的可用性](img/B01784_07_03-3.png)'
- en: Rolling back involves applying a former version of a guest's storage file to
    the virtual machine or container
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 回滚涉及将先前版本的来宾存储文件应用到虚拟机或容器中
- en: So, it's logical that the ability to restore to a prior state isn't an unconditional
    advantage of virtualization, even if it's an integrated feature of Proxmox VE;
    snapshots and backups must be integral to the well-thought out and executed lifecycle
    of the PVE guests and part of a well-defined and enforced policy.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，恢复到先前状态的能力并不是虚拟化的无条件优势，尽管它是 Proxmox VE 的集成功能；快照和备份必须是精心规划和执行的 PVE 来宾生命周期的组成部分，并且是一个明确且强制执行的政策的一部分。
- en: Hardware abstraction
  id: totrans-70
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 硬件抽象
- en: A fundamentally compelling characteristic of full virtualization is the abstraction
    of a computer from the physical hardware.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 完全虚拟化的一个根本性吸引人的特点是将计算机从物理硬件中抽象出来。
- en: Imagine that a Proxmox VE guest with a well-organized trove of information collected
    over months is compromised and its hard drive destroyed in an attack that would
    have rendered physical storage unsalvageable—destruction of storage on a virtual
    disk does no damage to the physical storage that hosted it. When prior states
    are available to restore from, a snapshot or a backup can be restored onto the
    same hardware.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 想象一下，一个 Proxmox VE 来宾在几个月内收集的资料经过精心组织，在一次攻击中被破坏，硬盘被摧毁，这种攻击本来会使物理存储无法恢复——在虚拟磁盘上的存储破坏不会对其所托管的物理存储造成任何损害。当有可恢复的先前状态时，快照或备份可以恢复到相同的硬件上。
- en: Without condition, damage dealt to virtual components has no effect on the physical
    host. This is an inherent reward for abstraction.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 无条件地，虚拟组件所遭受的损坏不会对物理主机产生任何影响。这是抽象化的固有奖励。
- en: Segmentation
  id: totrans-74
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 分段
- en: If an infrastructure is to be virtualized with Proxmox VE, take advantage of
    the network segmentation technologies it supports, such as VLAN tags, bridges,
    IPs masquerading with NAT, and per-guest firewalls. Use these technologies to
    make VMs or containers available to a limited population of users with legitimate
    business needs that call for a limited level of access.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 如果要使用 Proxmox VE 虚拟化基础设施，请利用它支持的网络分段技术，例如 VLAN 标签、桥接、NAT 伪装的 IP 和每个来宾的防火墙。使用这些技术使虚拟机或容器仅对有合法业务需求并需要有限访问权限的用户群体可用。
- en: '![Segmentation](img/B01784_07_04-4.png)'
  id: totrans-76
  prefs: []
  type: TYPE_IMG
  zh: '![分段](img/B01784_07_04-4.png)'
- en: Visualizing segmentation and trust zones with Proxmox VE
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Proxmox VE可视化分段和信任区
- en: To make the most of this valuable potential, think rigorously about sufficient
    trust zones as you plan your infrastructure.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 为了最大限度地发挥这一宝贵潜力，在规划您的基础设施时，请严格思考足够的信任区。
- en: Note
  id: totrans-79
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: A trust zone is a network segment within which data flows relatively unrestricted,
    while data flowing in and out of the trust zone is subject to stronger restrictions.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 信任区是一个网络段，数据在其中流动时相对不受限制，而流入和流出信任区的数据则受到更严格的限制。
- en: Tip
  id: totrans-81
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: '**Open vSwitch**'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: '**Open vSwitch**'
- en: As an alternative to the bridges, bonds, and VLAN interfaces native to Linux,
    Proxmox VE supports Open vSwitch.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 作为Linux原生的桥接、绑定和VLAN接口的替代方案，Proxmox VE支持Open vSwitch。
- en: Open vSwitch is an open source, software implementation of a distributed, multilayer
    switch. It's production-ready and designed with virtualization specifically in
    mind.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: Open vSwitch是一种开源的软件实现，提供了一个分布式的多层交换机。它已经具备生产就绪能力，专为虚拟化设计。
- en: To learn more about Open vSwitch, including features and potential drawbacks,
    visit its website at [http://openvswitch.org](http://openvswitch.org). To learn
    more about Proxmox VE's support of Open vSwitch, visit the Proxmox wiki at [https://pve.proxmox.com/wiki/Open_vSwitch](https://pve.proxmox.com/wiki/Open_vSwitch).
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解更多关于Open vSwitch的信息，包括其功能和潜在的缺点，请访问其官网：[http://openvswitch.org](http://openvswitch.org)。要了解Proxmox
    VE对Open vSwitch的支持，请访问Proxmox维基：[https://pve.proxmox.com/wiki/Open_vSwitch](https://pve.proxmox.com/wiki/Open_vSwitch)。
- en: Encapsulation and portability
  id: totrans-86
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 封装性和可移植性
- en: As described in [Chapter 5](ch05.html "Chapter 5. Working with Virtual Disks"), *Working
    with Virtual Disks*, with full virtualization all information on virtual servers,
    including boot disks, is saved as a file; this is an example of encapsulation.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 如[第5章](ch05.html "第5章。虚拟磁盘操作")《虚拟磁盘操作》所述，在完全虚拟化环境下，虚拟服务器上的所有信息，包括启动磁盘，都会作为文件保存；这是封装性的一个例子。
- en: Invaluably, encapsulation serves the portability of the VM; even as an attacker
    works to compromise a PVE host, its guests can be moved, without halting, to another
    host in a cluster. Live migration—migrating an active guest from one PVE host
    to another in the same cluster—helps assure availability even in the case of an
    ongoing attack against a host.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 封装性极大地服务于虚拟机的可移植性；即使攻击者试图攻破PVE主机，其虚拟机也可以在不中断的情况下移动到集群中的另一台主机。实时迁移——将活跃的虚拟机从一个PVE主机迁移到同一集群中的另一个主机——有助于确保即便在主机遭受攻击时，也能保持可用性。
- en: Tip
  id: totrans-89
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: '**On Clustering and High Availability**'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: '**关于集群和高可用性**'
- en: For more on these topics, see *Mastering Proxmox, Proxmox High Availability*,
    and *Proxmox Cookbook* from Packt Publishing.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 有关这些主题的更多信息，请参见Packt出版的《Mastering Proxmox》、《Proxmox High Availability》和《Proxmox
    Cookbook》。
- en: Physical security
  id: totrans-92
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 物理安全
- en: When an attacker gains access to a physical server, the availability, confidentiality,
    and integrity it should demonstrate are absolutely in doubt.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 当攻击者获得物理服务器的访问权限时，其应展示的可用性、保密性和完整性将绝对受到怀疑。
- en: To put it bluntly (and to appropriate a phrase from Scott Culp), if an attacker
    has physical access to your Proxmox VE host, it's not your host anymore.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 简单来说（借用Scott Culp的说法），如果攻击者获得了对Proxmox VE主机的物理访问权限，那么它就不再是您的主机了。
- en: As described previously, a very powerful benefit of virtualization is that the
    number of physical hosts decreases as the services they provided move to VMs or
    containers, effectively reducing the attack vectors, since the fewer machines
    there are to find physical space for, the fewer there are to gain illegitimate
    access to.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，虚拟化的一个非常强大的好处是，随着服务向虚拟机或容器迁移，物理主机数量减少，从而有效地减少了攻击面，因为需要为的机器越少，就能获得非法访问的机器也越少。
- en: Nevertheless, include in your policy the procedures by which the PVE hosts,
    the storage, and the intermediate distribution frame (that is, the wiring closet)
    are to be physically secured against illegitimate access, and enforce the policy
    consistently and without exception; this means you've mitigated a potentially
    devastating threat.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管如此，请在您的策略中包括PVE主机、存储和中间配线架（即配线室）在物理上如何防止非法访问的程序，并始终如一地严格执行该策略；这意味着您已经降低了一个潜在的灾难性威胁。
- en: Fine privilege control
  id: totrans-97
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 精细的权限控制
- en: With defense in depth and the principle of least-privilege in mind, consider
    the fine control of user access and restrictions that's realized when each service
    is moved to a discrete VM or container—in contrast to keeping multiple services
    running on a single physical server.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 本着深度防御和最小权限原则的考虑，考虑将每个服务移至单独的虚拟机或容器时，如何实现对用户访问和限制的精细控制——与将多个服务运行在单一物理服务器上的做法相对比。
- en: In a virtual infrastructure, a user privileged to access one service is not
    explicitly privileged to another as we can imagine they would be if the services
    were shared on a single hardware server. We can restrict access to Debian, finely
    define a user's role in relation to each VM and container via the PVE web interface,
    and further refine privileges on the guest OS level and the application level.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 在虚拟基础设施中，获得访问某个服务权限的用户，并不意味着自动获得访问其他服务的权限——就像我们如果服务共享在一台硬件服务器上，通常会认为它们是共享的那样。我们可以限制对
    Debian 的访问，通过 PVE Web 界面精确定义每个用户在与每个虚拟机和容器相关的角色，进一步细化在来宾操作系统和应用层的权限。
- en: '![Fine privilege control](img/B01784_07_06-3.png)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
  zh: '![精细的权限控制](img/B01784_07_06-3.png)'
- en: Some layers to consider in the practice of "defense in depth"
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 在“深度防御”实践中需要考虑的一些层次
- en: By default, the Proxmox VE management interface is authorized through GNU/Linux's
    default authentication system (**PAM**), and root is the only user. However, the
    authentication system for the web interface can be changed from PAM to PVE's system,
    to Active Directory, or to LDAP.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Proxmox VE 管理界面通过 GNU/Linux 的默认认证系统（**PAM**）进行授权，且 root 是唯一的用户。然而，Web
    界面的认证系统可以从 PAM 更改为 PVE 系统、Active Directory 或 LDAP。
- en: Whatever the authentication mechanism, specific users can be assigned different
    roles, or privileges, for each individual VM or container.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 无论认证机制如何，特定用户可以为每个独立的虚拟机或容器分配不同的角色或权限。
- en: Tip
  id: totrans-104
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: '**PVE User Management**'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: '**PVE 用户管理**'
- en: 'To learn more about PVE''s user management features, see the user management
    page of the Proxmox wiki: [https://pve.proxmox.com/wiki/User_Management](https://pve.proxmox.com/wiki/User_Management).'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解更多关于 PVE 用户管理功能的信息，请访问 Proxmox wiki 的用户管理页面：[https://pve.proxmox.com/wiki/User_Management](https://pve.proxmox.com/wiki/User_Management)。
- en: There are a host of predefined roles for users or groups that ship with PVE;
    and we can create new roles with different privileges and restrictions as necessary.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: PVE 提供了许多预定义的角色，适用于用户或组；我们还可以根据需要创建具有不同权限和限制的新角色。
- en: PVE firewall features
  id: totrans-108
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: PVE 防火墙功能
- en: Proxmox VE provides flexible firewall features based on iptables.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: Proxmox VE 提供基于 iptables 的灵活防火墙功能。
- en: These features can be configured via the administration interface or the command
    line to provide several layers of protection, as this allows rulesets to accept
    and reject traffic per guest server, per PVE host, and for an entire cluster.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 这些功能可以通过管理界面或命令行进行配置，提供多层保护，因为这允许规则集根据每个来宾服务器、每个 PVE 主机和整个集群的情况来接受和拒绝流量。
- en: Note
  id: totrans-111
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: To learn more about the Proxmox VE firewall, visit the official documentation
    at [https://pve.proxmox.com/wiki/Proxmox_VE_Firewall](https://pve.proxmox.com/wiki/Proxmox_VE_Firewall),
    where detailed configuration examples are available.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解更多关于 Proxmox VE 防火墙的信息，请访问官方文档：[https://pve.proxmox.com/wiki/Proxmox_VE_Firewall](https://pve.proxmox.com/wiki/Proxmox_VE_Firewall)，详细的配置示例可在此处找到。
- en: It's rather critical that PVE be protected by a firewall.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: PVE 必须通过防火墙保护，这一点非常关键。
- en: 'Proxmox VE 3.4 relies on the following ports:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: Proxmox VE 3.4 依赖以下端口：
- en: 8006 (web interface)
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 8006（Web 界面）
- en: 85 (pvedaemon—configured to listen only on 127.0.0.1)
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 85（pvedaemon—配置为仅监听 127.0.0.1）
- en: 5900-5999 (VNC web console)
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 5900-5999（VNC Web 控制台）
- en: 22 (sshd; used for cluster actions as well as a means to access a remote shell)
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 22（sshd；用于集群操作以及访问远程 Shell）
- en: 5404, 5405 UDP (CMAN multicast—if you run a cluster)
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 5404, 5405 UDP（CMAN 多播—如果你运行集群的话）
- en: 'Proxmox VE 4.0 saw some changes to Proxmox VE''s port usage:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: Proxmox VE 4.0 对 Proxmox VE 的端口使用进行了若干改动：
- en: 8006 (web interface)
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 8006（Web 界面）
- en: 85 (pvedaemon-configured to listen only on 127.0.0.1)
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 85（pvedaemon—配置为仅监听 127.0.0.1）
- en: 5900-5999 (VNC web console)
  id: totrans-123
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 5900-5999（VNC Web 控制台）
- en: 3128 (SPICE console)
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 3128（SPICE 控制台）
- en: 22 (SSH access-now optional)
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 22（SSH 访问—现在是可选的）
- en: 111 (rpcbind)
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 111（rpcbind）
- en: 5404, 5405 UDP (corosync multicast if you run a cluster)
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 5404, 5405 UDP（corosync 多播，如果你运行集群的话）
- en: Use your firewall experience to restrict access to these ports from subnets
    and IP ranges that don't have a legitimate need to access them.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 利用你在防火墙方面的经验，限制来自没有合法访问需求的子网和 IP 范围对这些端口的访问。
- en: Aggravated vulnerabilities
  id: totrans-129
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 严重的漏洞
- en: Virtualization's potential security benefits are certainly compelling, but many
    are quite conditional and altogether they are certainly no panacea.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟化的潜在安全优势无疑令人信服，但其中许多都是有条件的，总体而言，它们绝不是万能的解决方案。
- en: Moreover, virtualization introduces new threats to an infrastructure—threats
    that otherwise either wouldn't be a concern at all or are exacerbated by virtualization.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，虚拟化为基础设施带来了新的威胁——这些威胁在虚拟化之前可能根本不会成为问题，或者在虚拟化的影响下变得更加严重。
- en: 'This section calls attention to vulnerabilities that are historically problematic
    for virtual infrastructures:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 本节重点关注虚拟基础设施历史上存在的问题性漏洞：
- en: Denial of service attacks
  id: totrans-133
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 拒绝服务攻击
- en: VM escape and hyper jumping
  id: totrans-134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 虚拟机逃逸和超跳
- en: Server sprawl
  id: totrans-135
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务器扩展
- en: Growing complexity
  id: totrans-136
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 日益复杂
- en: Denial of service attacks
  id: totrans-137
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 拒绝服务攻击
- en: '**Denial of service** (**DoS**) attacks come in a wide variety of flavors.
    However, the immediate intent is the same: overwhelming a network, and its administrators,
    by generating large amounts of illegitimate traffic.'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: '**拒绝服务**（**DoS**）攻击有多种形式。然而，其直接目的都是一样的：通过产生大量非法流量来压垮网络及其管理员。'
- en: '**Distributed denial of service** (**DDoS**) and DoS attacks are cheap, effective,
    and increasingly common. On the surface, they seem to be most effective at rendering
    services unavailable or unusable. More insidious, perhaps, is that, by keeping
    administrators'' hands full as they cope with illegitimate traffic, other attacks
    can be launched without attracting their immediate attention.'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: '**分布式拒绝服务**（**DDoS**）和DoS攻击成本低、有效且日益普遍。从表面上看，它们似乎最有效的方式是让服务无法使用或不可用。更为阴险的是，通过让管理员应对非法流量忙得不可开交，其他攻击可以在不引起他们注意的情况下发起。'
- en: Unfortunately, DoS attacks are particularly powerful against virtual infrastructures,
    wherein overwhelmed virtual hosts will certainly threaten the availability of
    virtual guests and the services they provide.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 不幸的是，DoS攻击在虚拟化基础设施中尤其强大，其中被压垮的虚拟主机会威胁到虚拟客户机及其提供的服务的可用性。
- en: '![Denial of service attacks](img/B01784_07_07-3.png)'
  id: totrans-141
  prefs: []
  type: TYPE_IMG
  zh: '![拒绝服务攻击](img/B01784_07_07-3.png)'
- en: Visualizing a DDoS attack
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 可视化DDoS攻击
- en: 'In addition, research published in 2013 found that DoS attacks are significantly
    more potent where virtual machines are involved:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，2013年发布的研究发现，虚拟机涉及的DoS攻击要强大得多：
- en: '|   | *"[Under] DoS attack, the performance of a web server hosted in a VM
    can degrade by up to 23%, while that of a nonvirtualized server hosted on the
    same hardware degrades by only 8%. Even with relatively light attacks, the file
    system and memory access performance of hypervisor-based virtualization degrades
    at a much higher rate than their nonvirtualized counterparts."* |   |'
  id: totrans-144
  prefs: []
  type: TYPE_TB
  zh: '|   | *"[在] DoS攻击下，虚拟机托管的Web服务器性能可能下降最多达23%，而在同一硬件上托管的非虚拟化服务器性能仅下降8%。即使在相对轻微的攻击下，基于虚拟机监控程序的虚拟化系统的文件系统和内存访问性能也会比其非虚拟化对等物下降得更快。"*
    |   |'
- en: '|   | -- *Performance of Virtual Machines Under Networked Denial of Service
    Attacks: Experiments and Analysis, Shea and Liu, [http://www.cs.sfu.ca/~jcliu/Papers/PerformanceofVirtualMachines.pdf](http://www.cs.sfu.ca/~jcliu/Papers/PerformanceofVirtualMachines.pdf)*
    |'
  id: totrans-145
  prefs: []
  type: TYPE_TB
  zh: '|   | -- *《网络拒绝服务攻击下虚拟机性能：实验与分析》，Shea和Liu， [http://www.cs.sfu.ca/~jcliu/Papers/PerformanceofVirtualMachines.pdf](http://www.cs.sfu.ca/~jcliu/Papers/PerformanceofVirtualMachines.pdf)*
    |'
- en: Clearly, in some areas, we may take solace in some security benefits of virtualization;
    however, DoS and DDoS attacks are one threat we cannot turn away from.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 显然，在某些领域，我们可能会对虚拟化带来的某些安全优势感到安慰；然而，DoS和DDoS攻击是我们无法忽视的威胁。
- en: When migrating services from physical machines to Proxmox VE guests, work to
    define and deploy not only preventative measures, but also rapid response protocols.
    This calls for the implementation of monitoring and alert systems, as well as
    a firewall configuration that deliberately takes such attacks into consideration.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 在将服务从物理机器迁移到Proxmox VE虚拟机时，工作不仅要定义和部署预防措施，还要制定快速响应协议。这要求实施监控和警报系统，并配置防火墙，以便有意识地考虑到这些攻击。
- en: Each type of DoS attack has its own array of detection and mitigation strategies.
    To mitigate against SYN flooding attacks, for example, see section three of [http://tools.ietf.org/html/rfc4987](http://tools.ietf.org/html/rfc4987).
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 每种类型的DoS攻击都有各自的检测和缓解策略。例如，要缓解SYN洪水攻击，请参见[http://tools.ietf.org/html/rfc4987](http://tools.ietf.org/html/rfc4987)的第三部分。
- en: VM escape and hyper jumping
  id: totrans-149
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 虚拟机逃逸和超跳
- en: '**Virtual machine escape** occurs when an attacker successfully "breaks out"
    of a virtual machine and interacts with the host operating system.'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: '**虚拟机逃逸**发生在攻击者成功“突破”虚拟机并与主机操作系统交互时。'
- en: In a similar vein, **VM jumping**, or hyper jumping as it is sometimes referred
    to, is the process of gaining illegitimate access to a virtual machine via another
    virtual machine.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 同样地，**虚拟机跳跃**，有时也称为超跳，是通过另一个虚拟机非法访问虚拟机的过程。
- en: Presumably encapsulated and isolated environments, virtual machines run operating
    systems that shouldn't know that they are virtualized; there should be no way
    to break out of the virtual machine to interact directly with the parent hypervisor.
    For the same reasons, it should be impossible to illegitimately access a virtual
    machine through another virtual machine.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 可以推测，封装和隔离的环境中，虚拟机运行的操作系统不应该知道它们是虚拟化的；不应该有任何方式能让虚拟机突破虚拟化，与父级虚拟机监控程序直接交互。出于相同的原因，通过另一个虚拟机非法访问虚拟机应该是不可能的。
- en: VM escape exploits are particularly devastating since the hypervisor controls
    the execution of all of the virtual machines and containers on the host. Consequently,
    an attacker that can gain access to the hypervisor can then win control over every
    guest running on the PVE host; since the hypervisor is between the physical hardware
    and the guest operating system, a successful VM escape will enable attackers to
    simply circumvent security controls implemented on the virtual machine.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟机逃逸漏洞特别具有毁灭性，因为虚拟机监控程序控制着主机上所有虚拟机和容器的执行。因此，能够访问虚拟机监控程序的攻击者将能够控制在PVE主机上运行的所有虚拟机；由于虚拟机监控程序位于物理硬件和虚拟机操作系统之间，成功的虚拟机逃逸将使攻击者能够简单地绕过在虚拟机上实施的安全控制。
- en: VM escapes and hyper jumping should be an intellectual exercise, a fascinating
    theoretical problem. Unfortunately, that's simply not the case.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟机逃逸和虚拟机跳跃本应是一个智力练习，是一个迷人的理论性问题。不幸的是，事实并非如此。
- en: 'During the production of this book, for example, several VM escape vulnerabilities
    have emerged. Perhaps the vulnerability that captured the most attention was the
    one dubbed *VENOM* by researchers ([http://venom.crowdstrike.com/](http://venom.crowdstrike.com/)):'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，在本书的制作过程中，已经出现了几种虚拟机逃逸漏洞。或许最引人注目的漏洞是被研究人员称为*VENOM*的漏洞（[http://venom.crowdstrike.com/](http://venom.crowdstrike.com/)）：
- en: '*"VENOM, CVE-2015-3456, is a security vulnerability in the virtual floppy drive
    code used by many computer virtualization platforms. This vulnerability may allow
    an attacker to escape from the confines of an affected virtual machine (VM) guest
    and potentially obtain code-execution access to the host. Absent mitigation, this
    VM escape could open access to the host system and all other VMs running on that
    host, potentially giving adversaries significant elevated access to the host''s
    local network and adjacent systems.*'
  id: totrans-156
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '*“VENOM，CVE-2015-3456，是一个存在于许多计算机虚拟化平台使用的虚拟软盘驱动程序中的安全漏洞。该漏洞可能允许攻击者突破受影响虚拟机（VM）的限制，进而可能获得对主机的代码执行访问权限。如果没有采取缓解措施，这种虚拟机逃逸可能会打开对主机系统及该主机上运行的所有其他虚拟机的访问权限，从而可能使攻击者获得对主机本地网络及相邻系统的显著权限。”*'
- en: '*"Exploitation of the VENOM vulnerability can expose access to corporate intellectual
    property (IP), in addition to sensitive and personally identifiable information
    (PII), potentially impacting the thousands of organizations and millions of end
    users that rely on affected VMs for the allocation of shared computing resources,
    as well as connectivity, storage, security, and privacy."*'
  id: totrans-157
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '*“VENOM漏洞的利用可能暴露企业知识产权（IP）的访问权限，除此之外，还可能泄露敏感的个人身份信息（PII），并可能影响成千上万的组织和依赖受影响虚拟机（VM）分配共享计算资源的数百万终端用户，此外还可能影响连接性、存储、安全性和隐私。”*'
- en: '![VM escape and hyper jumping](img/B01784_07_09-3.png)'
  id: totrans-158
  prefs: []
  type: TYPE_IMG
  zh: '![虚拟机逃逸与虚拟机跳跃](img/B01784_07_09-3.png)'
- en: Venom attack scenario
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: Venom攻击场景
- en: Unfortunately, the many "computer virtualization platforms" invoked by the disclosure
    included all QEMU-based platforms; this includes Proxmox VE.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 不幸的是，披露中提到的许多“计算机虚拟化平台”包括了所有基于QEMU的虚拟化平台；这也包括Proxmox VE。
- en: 'In the case of VENOM, a patch was available from Debian the same day the vulnerability
    was disclosed. A PVE administrator simply had to upgrade, in Debian fashion, and
    then restart guest virtual machines:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 对于VENOM漏洞，Debian在漏洞披露当天就发布了补丁。PVE管理员只需要按照Debian的方式升级，然后重启虚拟机：
- en: '[PRE0]'
  id: totrans-162
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: After a shutdown and restart of all VMs on the Proxmox VE host, the vulnerability
    was gone. There was no need to even reboot the PVE host.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Proxmox VE 主机上关闭并重启所有虚拟机后，漏洞问题消失了。甚至无需重新启动 PVE 主机。
- en: Note
  id: totrans-164
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The bug was introduced unknowingly in the QEMU source when the QEMU Floppy Drive
    Controller was introduced in 2004.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 该漏洞在 QEMU 源代码中无意中引入，当 QEMU 软盘驱动控制器在 2004 年被引入时。
- en: So it seems virtualization's celebrated isolation is not absolute.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 所以看起来虚拟化的隔离并不是绝对的。
- en: 'From VENOM, we can learn some direct preventative actions that can be taken
    to mitigate emerging VM escape vulnerabilities:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 从 VENOM 中，我们可以学习到一些直接的预防措施，以缓解新出现的虚拟机逃逸漏洞：
- en: Keep Proxmox VE and Debian routinely patched. There are a variety of ways to
    automate the patching process; we'll walk through one method in the next section.
    Since Proxmox VE is patched through the same mechanism as Debian, patches to both
    are applied simultaneously.
  id: totrans-168
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 定期对 Proxmox VE 和 Debian 进行修补。有多种方法可以自动化修补过程；我们将在下一节中介绍其中一种方法。由于 Proxmox VE 通过与
    Debian 相同的机制进行修补，两个系统的补丁将同时应用。
- en: Patch operating systems and applications running on virtual machines and containers.
    On Debian and Ubuntu guests, use the apt tool; on Microsoft Windows and Server
    guests, set a reasonable Windows Update policy to ensure urgent updates are applied.
  id: totrans-169
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对虚拟机和容器上运行的操作系统和应用程序进行修补。在 Debian 和 Ubuntu 客户机上，使用 apt 工具；在 Microsoft Windows
    和 Server 客户机上，设置合理的 Windows 更新策略，以确保紧急更新被应用。
- en: '*Don''t* install virtual machine features you do not need. Doing so increases
    your attack surface unnecessarily. Be particularly attentive to what virtual devices
    are attached to your VM; if you don''t need a virtual optical drive or floppy
    disk drive on the VM, either deliberately avoid installing them or remove them
    from the VM when you no longer need them.'
  id: totrans-170
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*不要* 安装你不需要的虚拟机功能。这样做会不必要地增加你的攻击面。特别要注意虚拟设备是否附加到虚拟机上；如果你不需要虚拟光驱或软盘驱动器，可以在虚拟机上安装时避免它们，或者当你不再需要时将其从虚拟机中移除。'
- en: Avoid running software and services that are not essential to your guests' primary
    roles.
  id: totrans-171
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 避免运行那些对客户机的主要角色不必要的软件和服务。
- en: However, weigh the benefits of running endpoint security software on a virtual
    machine; in his September 2015 article, "The Curious Case of the Escaping Virtual
    Machine," Bunmi Sowandi suggests that such software will detect malicious code
    trying to run in a VM before it has a chance to "escape". ([http://vmturbo.com/about-virtualization/the-curious-case-of-the-escaping-virtual-machine/](http://vmturbo.com/about-virtualization/the-curious-case-of-the-escaping-virtual-machine/))
  id: totrans-172
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 然而，运行终端安全软件在虚拟机上的好处值得权衡；在他 2015 年 9 月的文章《逃脱的虚拟机的奇怪案例》中，Bunmi Sowandi 建议，这种软件将在恶意代码有机会“逃脱”之前，检测出它试图在虚拟机中运行的行为。([http://vmturbo.com/about-virtualization/the-curious-case-of-the-escaping-virtual-machine/](http://vmturbo.com/about-virtualization/the-curious-case-of-the-escaping-virtual-machine/))
- en: As we learned from VENOM, the best protection against VM escape and hyper jumping
    exploits is routine and well-thought out patch management.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们从 VENOM 中了解到的，防止虚拟机逃逸和超级跳跃漏洞的最佳保护措施是常规的、经过深思熟虑的补丁管理。
- en: Virtualization sprawl
  id: totrans-174
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 虚拟化蔓延
- en: In the context of virtual infrastructure, sprawl refers to the tendency of virtual
    servers to proliferate faster than administrators can properly manage. Sprawl
    encourages poor management decisions, hasty undeliberated action, sloppy configuration
    mistakes, and missed opportunities to mitigate threats.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 在虚拟基础设施的背景下，蔓延指的是虚拟服务器的扩展速度超过管理员能够妥善管理的速度。蔓延促使了不良管理决策、草率的未经过深思熟虑的行动、马虎的配置错误以及错失缓解威胁的机会。
- en: From a security perspective, therefore, virtualization sprawl presents dire
    problems as administrators miss security patches, fail to harden services, and
    perhaps expose the network, the hypervisors, and storage nodes unnecessarily.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，从安全的角度来看，虚拟化蔓延带来了严重的问题，因为管理员会错过安全补丁，未能加固服务，甚至可能不必要地暴露网络、虚拟化程序和存储节点。
- en: 'A helpful article on the Hewlett Packard site suggests some best practices
    to reduce the impact of sprawl effectively. Like many security issues explored
    in this chapter, the suggested solution is excellent planning, deliberated deployment,
    and writing and enforcing a security policy that includes VM lifecycle management.
    The article ([http://h30499.www3.hp.com/t5/Grounded-in-the-Cloud/5-ways-to-get-control-of-virtualization-sprawl/ba-p/6170959](http://h30499.www3.hp.com/t5/Grounded-in-the-Cloud/5-ways-to-get-control-of-virtualization-sprawl/ba-p/6170959))
    puts particular emphasis on the following:'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 惠普网站上的一篇有帮助的文章建议了一些最佳实践，有效地减少蔓延的影响。像本章中探讨的许多安全问题一样，建议的解决方案是优秀的规划、深思熟虑的部署，以及编写和执行包含虚拟机生命周期管理的安全政策。文章（[http://h30499.www3.hp.com/t5/Grounded-in-the-Cloud/5-ways-to-get-control-of-virtualization-sprawl/ba-p/6170959](http://h30499.www3.hp.com/t5/Grounded-in-the-Cloud/5-ways-to-get-control-of-virtualization-sprawl/ba-p/6170959)）特别强调以下内容：
- en: Whenever possible, create VMs and containers from "golden images" that include
    patches, patch policy, audit policies, software, and software policies
  id: totrans-178
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在可能的情况下，从包含补丁、补丁策略、审计政策、软件及软件政策的“黄金镜像”创建虚拟机和容器
- en: '![Virtualization sprawl](img/B01784_07_10-3.png)'
  id: totrans-179
  prefs: []
  type: TYPE_IMG
  zh: '![虚拟化蔓延](img/B01784_07_10-3.png)'
- en: End-to-end lifecycle and policy management for VMs and VM template
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟机及虚拟机模板的端到端生命周期和策略管理
- en: Proactively update policy-based enforcement on VMs as well as VM templates (and
    containers and container templates)
  id: totrans-181
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 主动更新虚拟机以及虚拟机模板（包括容器及容器模板）的基于政策的执行
- en: '![Virtualization sprawl](img/B01784_07_11-3.png)'
  id: totrans-182
  prefs: []
  type: TYPE_IMG
  zh: '![虚拟化蔓延](img/B01784_07_11-3.png)'
- en: Systematically manage the lifecycle and compliance of virtual servers from end
    to end (including, for example, routine snapshots or backups, and applying patches
    and upgrades)
  id: totrans-183
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 系统化地管理虚拟服务器的生命周期和合规性，贯穿始终（例如，包括定期快照或备份，以及应用补丁和升级）
- en: 'The article is insistent on conveying two messages successfully:'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 本文坚持传达两个成功的信息：
- en: A well-thought-out security policy, which administrators can realistically comply
    with, is absolutely essential for keeping sprawl in check
  id: totrans-185
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一项精心设计的安全政策，对管理员而言是完全可遵守的，对于控制虚拟化蔓延至关重要
- en: Tasks that can be automated must be automated
  id: totrans-186
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可以自动化的任务必须自动化
- en: Virtualization sprawl encourages disorder; tame it with automation driven by
    a well-thought-out policy that's followed in the practice of daily administration.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟化蔓延会促使混乱；通过自动化以及精心设计并在日常管理实践中遵循的政策来加以控制。
- en: At war with complexity
  id: totrans-188
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 与复杂性作斗争
- en: '|   | *"A network architecture should be as clean and simple to understand
    as it can be. It should be possible to briefly...draw a few simple pictures to
    illustrate that design...."**"Having a clear understanding of the traffic flow
    on your network puts you in control of it. Not understanding the network puts
    you at the mercy of its vagaries."* |   |'
  id: totrans-189
  prefs: []
  type: TYPE_TB
  zh: '|   | *“网络架构应尽可能简单易懂，应该能够简要地画出几个简单的图示来说明该设计……”**“清楚理解网络流量的流动，使你能掌控网络。不理解网络，则会受其变化的摆布。”*
    |   |'
- en: '|   | -- *The Practice of System and Network Administration, 2E 2007* |'
  id: totrans-190
  prefs: []
  type: TYPE_TB
  zh: '|   | -- *《系统与网络管理实务，第2版 2007》* |'
- en: Given that virtualization encourages sprawl and given that secure virtual infrastructures
    demand segmentation, it's not entirely surprising that virtualization encourages
    problematic network complexity.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑到虚拟化促使蔓延，同时安全的虚拟化基础设施要求分段，虚拟化鼓励问题网络复杂性的现象也就不足为奇。
- en: As network complexity goes up, so too does the pain that administrators suffer,
    since they must keep accurate documentation, troubleshoot connectivity problems
    on the fly, and sometimes provide actionable information for third-party support
    providers.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 随着网络复杂性的增加，管理员所承受的痛苦也在增加，因为他们必须保持准确的文档，随时排查连接问题，有时还需要为第三方支持提供可操作的信息。
- en: The "chaos approach" encouraged by infrastructure virtualization is not a reliable
    model to use in a network where the availability of every component matters (*The
    Practice of System and Network Administration*).
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 基础设施虚拟化所倡导的“混乱方法”并不是在每个组件的可用性都至关重要的网络中可以依赖的模型（《系统与网络管理实务》）。
- en: To limit network complexity, consider that the campus' network architects, engineers,
    and administrators should all be able to sketch, without aids, the key features
    and basic structure of the network topology.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 为了限制网络复杂性，考虑到校园的网络架构师、工程师和管理员都应该能够在不借助任何辅助工具的情况下，简要勾画出网络拓扑的关键特征和基本结构。
- en: According to Limoncelli, Hogan, and Chalup, the network architecture is neither
    clean enough, comprehensible enough, nor simple enough if this network map can't
    be relatively easily rendered. Maps of the physical and logical networks should
    absolutely be part of the system documentation and revised to reflect any modifications
    from the previous topology.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 根据 Limoncelli、Hogan 和 Chalup 的说法，如果网络图不能相对容易地呈现，那么网络架构既不够干净、也不够易懂、也不够简单。物理和逻辑网络的地图应该绝对成为系统文档的一部分，并且应当修订以反映前一个拓扑结构的任何修改。
- en: Taking the risk of sounding redundant squarely in the face, the best way to
    tame network complexity is to ensure the network can be explained and diagrammed,
    logically and physically, without the support of additional resources. If that's
    not the case, re-evaluate the architecture and see where it can be simplified
    without sacrificing security.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 冒着显得重复的风险，最好的方式来驾驭网络的复杂性是确保网络能够在没有额外资源支持的情况下，逻辑上和物理上清晰地被解释和绘制。如果不能做到这一点，重新评估架构，看看在哪些方面可以简化，而不牺牲安全性。
- en: Taking action
  id: totrans-197
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 采取行动
- en: 'If you''re not yet virtualizing infrastructure, or you''re not otherwise in
    a position to develop a strategic security policy, there''re tactics you can take
    in the meantime to mitigate some threats to your Proxmox virtual environment:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你还没有虚拟化基础设施，或者你暂时无法制定战略安全政策，仍然有一些策略可以采取，以减轻一些对你的 Proxmox 虚拟环境的威胁：
- en: Secure the bootloader
  id: totrans-199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 保护引导加载程序
- en: If possible, lock down the BIOS/UEFI
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果可能，锁定 BIOS/UEFI
- en: Absolutely prohibit remote access to Proxmox VE's user interfaces
  id: totrans-201
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 绝对禁止远程访问 Proxmox VE 的用户界面
- en: Disable root access via SSH; consider prohibiting sudo access as well
  id: totrans-202
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 禁用通过 SSH 的 root 访问；也可以考虑禁止 sudo 权限
- en: Use Fail2ban to prevent brute-force attacks
  id: totrans-203
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 Fail2ban 防止暴力破解攻击
- en: Rely on key-based SSH authentication
  id: totrans-204
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 依赖基于密钥的 SSH 认证
- en: Maintain security patches for Proxmox VE and its guests
  id: totrans-205
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 维护 Proxmox VE 及其虚拟机的安全补丁
- en: Consider an enterprise support subscription
  id: totrans-206
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 考虑企业支持订阅
- en: The practical procedures that follow are a strong (and immediate) complement
    to the less concrete strategies articulated previously.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来的实际操作是对之前提到的更抽象策略的有力（且立即可用的）补充。
- en: This concluding section thus walks through these immediate tactical mitigation
    objectives to provide immediate support as you come to terms with Proxmox VE.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 本节总结了这些即时的战术性缓解目标，以提供即时支持，帮助你熟悉 Proxmox VE。
- en: Protecting the boot process
  id: totrans-209
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 保护引导过程
- en: In this section, we work to assure that OS and application-level authentication
    isn't rendered useless by an attacker with physical access who can thoroughly
    bypass these mechanisms.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们致力于确保操作系统和应用级认证不会因物理访问攻击者而被绕过，确保这些机制不被彻底破坏。
- en: 'We can think of booting as a four-stage process:'
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以将引导过程视为四个阶段：
- en: '![Protecting the boot process](img/B01784_07_12-3.png)'
  id: totrans-212
  prefs: []
  type: TYPE_IMG
  zh: '![保护引导过程](img/B01784_07_12-3.png)'
- en: A generic boot process
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 通用引导过程
- en: 'During this process, the system can be vulnerable:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个过程中，系统可能会存在漏洞：
- en: An unsecured BIOS can be directed to boot from an attacker's storage device,
    allowing them to compromise the confidentiality and integrity of data stored on
    the Proxmox VE host and interfere with the availability of the services and virtual
    servers the host has intended to provide.
  id: totrans-215
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个没有安全保护的 BIOS 可以被指示从攻击者的存储设备引导，这使得攻击者能够破坏存储在 Proxmox VE 主机上的数据的机密性和完整性，并干扰主机旨在提供的服务和虚拟服务器的可用性。
- en: By manipulating an unsecured bootloader, attackers can gain root access to a
    machine and compromise its confidentiality, integrity, and availability.
  id: totrans-216
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过操控未加固的引导加载程序，攻击者可以获得机器的 root 权限，并危害其机密性、完整性和可用性。
- en: Using either method, the attacker effectively owns the machine. Let's do our
    best to lock down the BIOS/UEFI on our hosts and GRUB 2.0, the bootloader for
    Proxmox VE 3.4 and 4.1.
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 使用任一方法，攻击者实际上已经控制了这台机器。让我们尽最大努力锁定主机的 BIOS/UEFI 以及 GRUB 2.0，这是 Proxmox VE 3.4
    和 4.1 的引导加载程序。
- en: Tip
  id: totrans-218
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: To learn more about the Debian bootstrap process, visit [https://www.debian.org/doc/manuals/debian-reference/ch03.en.html#_an_overview_of_the_boot_strap_process](https://www.debian.org/doc/manuals/debian-reference/ch03.en.html#_an_overview_of_the_boot_strap_process).
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解更多关于 Debian 启动过程的信息，请访问 [https://www.debian.org/doc/manuals/debian-reference/ch03.en.html#_an_overview_of_the_boot_strap_process](https://www.debian.org/doc/manuals/debian-reference/ch03.en.html#_an_overview_of_the_boot_strap_process)。
- en: Locking down the bootloader
  id: totrans-220
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 锁定引导加载程序
- en: 'OS-level authentication restrictions can be very simply defeated on an otherwise
    secure Proxmox VE machine by manipulating GRUB 2, Proxmox VE''s bootloader. See,
    for example, [http://linuxconfig.org/ubuntu-14-04-lost-password-recovery](http://linuxconfig.org/ubuntu-14-04-lost-password-recovery),
    wherein the process is fully articulated. The gist of an attack looks like this:'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 操作系统级的身份验证限制可以通过操作 GRUB 2（Proxmox VE 的引导加载程序）非常简单地被破解，尽管 Proxmox VE 机器本身是安全的。例如，参见
    [http://linuxconfig.org/ubuntu-14-04-lost-password-recovery](http://linuxconfig.org/ubuntu-14-04-lost-password-recovery)，该过程中详细描述了这一过程。攻击的要点大致如下：
- en: Reboot and enter the GRUB 2 menu immediately after startup.
  id: totrans-222
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重启并在启动后立即进入 GRUB 2 菜单。
- en: Modify the boot options.
  id: totrans-223
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 修改引导选项。
- en: Boot the system based on your modifications.
  id: totrans-224
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 根据您的修改启动系统。
- en: Change the root password of the system.
  id: totrans-225
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 更改系统的 root 密码。
- en: Shutdown and restart.
  id: totrans-226
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 关闭并重启。
- en: Login with the new password.
  id: totrans-227
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用新密码登录。
- en: For an experienced GNU/Linux administrator, it's likely a familiar process;
    it's identical to how we reset a lost root password.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 对于有经验的 GNU/Linux 管理员来说，这个过程应该很熟悉；它与我们重置丢失的 root 密码的方式完全相同。
- en: GRUB 2 offers extensive customization, and with it, the power to disable access
    to GRUB 2 options generally, as well as to specific menu options.
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: GRUB 2 提供了广泛的自定义功能，通过它，您可以禁用一般的 GRUB 2 选项访问，以及特定菜单选项的访问。
- en: We will walk through the universal protection of GRUB 2 menu entries to enable
    access by a single superuser with an unencrypted password. This will prohibit
    attackers as well as sloppy or disgruntled colleagues from editing a GRUB entry
    or accessing a GRUB command line.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将介绍 GRUB 2 菜单条目的通用保护措施，以允许通过一个未加密密码的超级用户访问。这将禁止攻击者以及疏忽或不满的同事编辑 GRUB 条目或访问
    GRUB 命令行。
- en: 'To follow this procedure, you must:'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 要执行此过程，您必须：
- en: Have root privileges
  id: totrans-232
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 拥有 root 权限。
- en: Determine a superuser name and password to be used (we will use the name `admin`
    and the password `pve`)
  id: totrans-233
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确定将使用的超级用户名称和密码（我们将使用名称 `admin` 和密码 `pve`）。
- en: Edit GRUB configuration files from the command line
  id: totrans-234
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从命令行编辑 GRUB 配置文件。
- en: Update the GRUB 2 configuration with the update-grub command
  id: totrans-235
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 update-grub 命令更新 GRUB 2 配置。
- en: 'Let''s get started:'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们开始吧：
- en: 'Log into a shell on your Proxmox VE host; if PVE is configured with an IP address
    of 192.168.1.200, access a shell via SSH from a workstation on the same network:'
  id: totrans-237
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到 Proxmox VE 主机的 shell；如果 PVE 配置了 192.168.1.200 的 IP 地址，可以通过同一网络上的工作站通过 SSH
    访问 shell：
- en: '[PRE1]'
  id: totrans-238
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Open `/etc/grub.d/00_header` using a plaintext editor; this example uses `nano`
    as the editor:'
  id: totrans-239
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用纯文本编辑器打开 `/etc/grub.d/00_header`；此示例使用 `nano` 作为编辑器：
- en: '[PRE2]'
  id: totrans-240
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Append the following lines to the bottom of the text:'
  id: totrans-241
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将以下行附加到文本的底部：
- en: '[PRE3]'
  id: totrans-242
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Save the document and exit the editor; in `nano`, use  *Ctrl* +*X*, then *Y*,
    and then  *Enter* to return to a shell prompt.
  id: totrans-243
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存文档并退出编辑器；在 `nano` 中，使用 *Ctrl* + *X*，然后 *Y*，接着 *Enter* 返回到 shell 提示符。
- en: 'Open `/etc/grub.d/10_linux` in `nano`:'
  id: totrans-244
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 `nano` 中打开 `/etc/grub.d/10_linux`：
- en: '[PRE4]'
  id: totrans-245
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Seek the following group of lines in `/etc/grub.d/10_linux`:'
  id: totrans-246
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 `/etc/grub.d/10_linux` 中查找以下一组行：
- en: '[PRE5]'
  id: totrans-247
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'In the last line, insert `--unrestricted` between `${CLASS}` and `\$menuentry;`
    the resultant line appears as follows:'
  id: totrans-248
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在最后一行，在 `${CLASS}` 和 `\$menuentry;` 之间插入 `--unrestricted`，最终的行如下所示：
- en: '[PRE6]'
  id: totrans-249
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Save the revised document and exit the editor; in `nano`, use  **Ctrl** +  **X**
    to exit, press  **Y** to confirm, and then press  **Enter** to return to a shell
    prompt.
  id: totrans-250
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存修改后的文档并退出编辑器；在 `nano` 中，使用 **Ctrl** + **X** 退出，按 **Y** 确认，然后按 **Enter** 返回到
    shell 提示符。
- en: 'Finally, prompt GRUB 2 to reconfigure itself based on the changes:'
  id: totrans-251
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，提示 GRUB 2 根据更改重新配置自身：
- en: '[PRE7]'
  id: totrans-252
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: When you reboot, you should find that PVE will start normally if left uninterrupted.
    However, if you try to edit a menu entry, boot from a submenu, or access a GRUB
    command line, you should find that you're required to authenticate.
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 当您重启时，如果不被打断，您应该发现 PVE 会正常启动。但是，如果您尝试编辑菜单项、从子菜单启动或访问 GRUB 命令行，您应该会发现需要进行身份验证。
- en: Tip
  id: totrans-254
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: For more on GRUB security, visit the following links:[https://help.ubuntu.com/community/Grub2/Passwords](https://help.ubuntu.com/community/Grub2/Passwords)
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 有关 GRUB 安全性的更多信息，请访问以下链接：[https://help.ubuntu.com/community/Grub2/Passwords](https://help.ubuntu.com/community/Grub2/Passwords)
- en: '[http://www.gnu.org/software/grub/manual/grub.html#Security](http://www.gnu.org/software/grub/manual/grub.html#Security)'
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: '[http://www.gnu.org/software/grub/manual/grub.html#Security](http://www.gnu.org/software/grub/manual/grub.html#Security)'
- en: As the article at [http://opensourceforu.efytimes.com/2013/03/playing-hide-and-seek-with-passwords/](http://opensourceforu.efytimes.com/2013/03/playing-hide-and-seek-with-passwords/)
    points out, this password can still be bypassed by configuring BIOS/UEFI to boot
    from the attacker's boot device. If your hardware allows, you probably want to
    secure this first stage of the boot process so would-be malefactors won't be able
    to finagle the Proxmox VE host to boot from their own devices.
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 正如 [http://opensourceforu.efytimes.com/2013/03/playing-hide-and-seek-with-passwords/](http://opensourceforu.efytimes.com/2013/03/playing-hide-and-seek-with-passwords/)
    文章中指出的那样，这个密码仍然可以通过将 BIOS/UEFI 配置为从攻击者的启动设备启动来绕过。如果你的硬件允许，你可能需要先保护启动过程的这一阶段，这样潜在的恶意分子就无法操控
    Proxmox VE 主机从他们自己的设备启动。
- en: Locking down BIOS/UEFI
  id: totrans-258
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 锁定 BIOS/UEFI
- en: By securing the bootloader, GRUB 2, we can prevent a user from bypassing OS
    security and gaining root privileges on the Proxmox VE host.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 通过保护引导加载程序 GRUB 2，我们可以防止用户绕过操作系统安全性并获得 Proxmox VE 主机上的 root 权限。
- en: However, attackers can still simply bypass even the bootloader's security by
    booting instead from their own media. From there, they can mount the machine's
    secondary storage and make immediate decisions for you about its confidentiality
    and integrity. If an attacker is particularly deliberate, he/she can install a
    cunning means to access the machine remotely at a later date.
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，攻击者仍然可以通过从他们自己的媒体启动来轻松绕过引导加载程序的安全性。从那里，他们可以挂载计算机的次级存储，并立即为你做出关于其机密性和完整性的决定。如果攻击者特别有计划，他/她可以安装一种巧妙的方式，稍后远程访问这台计算机。
- en: To mitigate this threat, we can, depending on our firmware, password protect
    the boot device settings in either the BIOS or UEFI.
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 为了减轻这一威胁，我们可以根据固件的不同，密码保护 BIOS 或 UEFI 中的启动设备设置。
- en: Since there's an unwieldy array of BIOS and UEFI firmware vendors, we'll articulate
    a vision for what we'd like to do, and then hope our systems will cooperate.
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 由于有各种各样的 BIOS 和 UEFI 固件供应商，我们将阐明我们想要做的目标，然后希望我们的系统能够合作。
- en: 'The objective is to manipulate the BIOS/UEFI so it operates as follows:'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 目标是调整 BIOS/UEFI 使其按以下方式运行：
- en: Allows the system to cold-boot without any interruption
  id: totrans-264
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 允许系统在没有任何中断的情况下冷启动
- en: Requires authentication to change the boot device
  id: totrans-265
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 更改启动设备需要身份验证
- en: Prohibits entering the setup manager without authentication
  id: totrans-266
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 禁止在未身份验证的情况下进入设置管理器
- en: This configuration can be tricky and is largely contingent on the BIOS/UEFI
    vendor.
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 这个配置可能有些棘手，很大程度上取决于 BIOS/UEFI 供应商。
- en: 'Ideally, a machine with BIOS will allow you to do the following:'
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 理想情况下，带有 BIOS 的计算机将允许你执行以下操作：
- en: Enter the BIOS configuration when starting your PC. After power on, press the
    prompted key to enter **BIOS Setup Utility**; sometimes, it's the F key, **Delete**,or **ESC**.
    On some Lenovo machines, it's **Enter**. In the case of VMWare's PhoenixBIOS, **F2**
    is used to access the setup utility (access to this interface is what we want
    to make impossible or frustrating for an attacker):![Locking down BIOS/UEFI](img/image_07_012.png)
  id: totrans-269
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在启动 PC 时进入 BIOS 配置。开机后，按提示键进入**BIOS 设置实用程序**；有时是 F 键、**Delete** 或 **ESC**。在某些联想机器上，是
    **Enter**。在 VMware 的 PhoenixBIOS 中，**F2** 用于访问设置实用程序（访问此界面是我们希望对攻击者来说不可行或令人沮丧的）：![Locking
    down BIOS/UEFI](img/image_07_012.png)
- en: PhoenixBIOS, included with VMware Workstation, uses F2 to enter setup, F12 for
    network boot, and ESC for the boot menu.
  id: totrans-270
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: VMware Workstation 附带的 PhoenixBIOS 使用 F2 进入设置，F12 用于网络启动，ESC 用于启动菜单。
- en: Once you enter **SETUP**, navigate to a security tab. On the machines I've accessed,
    setting the administrator password will require the same credentials of anyone
    trying to enter the setup utility. On the PhoenixBios for VMware Workstation virtual
    machines, I can still boot without authenticating. So far so good.
  id: totrans-271
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦进入 **SETUP**，导航到安全选项卡。在我访问过的计算机上，设置管理员密码将要求任何尝试进入设置实用程序的人提供相同的凭据。在 VMware
    Workstation 虚拟机的 PhoenixBios 中，我仍然可以在未进行身份验证的情况下启动。到目前为止，一切正常。
- en: However, when the preceding screenshot invites users to press  *F12* for network
    boot or *Esc* for the boot menu, they'll find these are unrestricted. In this
    case, any attempt to lock down BIOS for security is really quite devastated.
  id: totrans-272
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然而，当前面的截图提示用户按 *F12* 进行网络启动或按 *Esc* 进入启动菜单时，他们会发现这些选项没有限制。在这种情况下，任何试图锁定 BIOS
    以增强安全性的行为都将被彻底破坏。
- en: If available, navigate to the boot settings in the SETUP utility. If the option
    is available in the Boot menu, disable devices that aren't used and that you don't
    want to use, such as network boot and boot from optical drives or USB devices.
  id: totrans-273
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果可用，进入 SETUP 工具中的启动设置。如果启动菜单中有该选项，请禁用不使用的设备，如网络启动、光驱启动或 USB 启动设备。
- en: Again, depending on availability, navigate to boot priority and set the boot
    priority of the remaining devices. Some systems allow you to use the  **D** key
    to disable devices.
  id: totrans-274
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 再次，根据可用性，进入启动优先级并设置剩余设备的启动优先级。某些系统允许你使用 **D** 键禁用设备。
- en: Ideally, your BIOS setup tool allows you to disable boot devices or password
    protect the boot device menu as well as the SETUP tool itself. Furthermore, it'll
    hopefully let you set a supervisor password without prompting you to authenticate
    to boot. If the boot process is interrupted to ask for authentication, there's
    the potential for a lot of unnecessary, and perhaps unplanned, down-time for the
    services users are relying on.
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 理想情况下，你的 BIOS 设置工具允许你禁用启动设备或为启动设备菜单和 SETUP 工具本身设置密码保护。此外，它应该允许你设置主管密码，而无需在启动时进行身份验证。如果启动过程被中断以要求身份验证，可能会导致服务用户依赖的系统出现不必要的、甚至是未计划的停机时间。
- en: The settings recommended previously were possible in about half of the physical
    machines I surveyed for the chapter.
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 在我为本章调查的物理机器中，大约一半的机器可以实现之前推荐的设置。
- en: If your machine does provide for this ideal scenario, realize that, at best,
    losing the BIOS passwords means you've lost your license to reconfigure or troubleshoot
    the physical machine. In case of a lost password, you'll need to research how
    to bypass the security that you once felt was keeping bad guys out. The reset
    process is awkward, inconsistent, a time sink, and may not work.
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你的机器支持这种理想场景，请意识到，最糟糕的情况是丢失 BIOS 密码意味着你失去了重新配置或故障排除物理机器的许可。如果密码丢失，你需要研究如何绕过你曾认为能防止坏人入侵的安全措施。重置过程繁琐、不一致、耗时且可能不起作用。
- en: It's essential, therefore, to keep a safe copy of any credentials you use to
    restrict access to BIOS or UEFI.
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，保持任何用于限制 BIOS 或 UEFI 访问的凭据的安全副本是至关重要的。
- en: To learn more about securing the specific BIOS/UEFI system for your Proxmox
    VE host, look for the documentation from the computer or BIOS manufacturers or
    from community users on the Web.
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解如何保护你的 Proxmox VE 主机的具体 BIOS/UEFI 系统，请查阅计算机或 BIOS 制造商的文档，或者在网上查找社区用户的相关资料。
- en: If protecting the boot process to your satisfaction is not possible with the
    BIOS or UEFI you're stuck with, compensate by making sure access to the physical
    host is absolutely secure with alarmed door locks, key passes that log ingress
    and egress, and so on.
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 如果无法通过你所使用的 BIOS 或 UEFI 完全保护启动过程，可以通过确保物理主机的访问绝对安全来弥补，如带警报的门锁、记录进出日志的钥匙通行证等。
- en: Tip
  id: totrans-281
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: '**Secure Boot and Proxmox**'
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: '**Secure Boot 和 Proxmox**'
- en: Proxmox VE does not support the Secure Boot feature of UEFI.
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: Proxmox VE 不支持 UEFI 的 Secure Boot 功能。
- en: Hardening the OS and hypervisor
  id: totrans-284
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 强化操作系统和虚拟化管理程序
- en: The objective here is to ensure the security of both Proxmox VE (3.4 and 4.0)
    and Debian, its underlying operating system. Because Proxmox VE and Debian are
    inextricably bound, it's appropriate to address them together.
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 这里的目标是确保 Proxmox VE（3.4 和 4.0）以及其底层操作系统 Debian 的安全性。由于 Proxmox VE 和 Debian 紧密相连，因此将它们一起讨论是合适的。
- en: Prohibit remote access to the hypervisor
  id: totrans-286
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 禁止远程访问虚拟化管理程序
- en: 'Pundits specifically committed to secure virtual infrastructures are insistent
    on this point: remote access to the hypervisor must be forbidden.'
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 专注于安全虚拟化基础设施的专家坚决主张这一点：必须禁止远程访问虚拟化管理程序。
- en: 'This directive must be qualified: it''s absolutely appropriate it''s absolutely
    appropriate to run a Proxmox VE host heedlessly (sans display) and to access it
    from another workstation on the same LAN via both SSH and the web-based administration
    interface.'
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 这个指令必须得到明确说明：在没有显示器的情况下运行 Proxmox VE 主机并通过 SSH 和基于 Web 的管理界面从同一局域网的另一台工作站访问它是完全合适的。
- en: What you want to avoid at all costs is making PVE ports, particularly 22 and
    8006, public-facing and accessible to the Internet. Unless VPN is configured,
    Proxmox VE absolutely should not be available from outside the LAN.
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要避免的一件事是将 PVE 端口，特别是 22 和 8006，暴露到互联网。如果没有配置 VPN，Proxmox VE 绝对不应该从局域网外部访问。
- en: Tip
  id: totrans-290
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: OpenVPN is an open-source package for providing VPN services; if you're considering
    a VPN solution, read more about OpenVPN at [https:///wiki.debian.org/OpenVPN](https://wiki.debian.org/OpenVPN).
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: OpenVPN 是一个开源包，用于提供 VPN 服务；如果你正在考虑 VPN 解决方案，可以在 [https:///wiki.debian.org/OpenVPN](https://wiki.debian.org/OpenVPN)
    了解更多关于 OpenVPN 的信息。
- en: Harden SSH
  id: totrans-292
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 加固 SSH 安全
- en: 'Proxmox VE is designed to have two access alternatives:'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: Proxmox VE 设计时有两种访问方式：
- en: Access to a command line interface via SSH
  id: totrans-294
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过 SSH 访问命令行界面
- en: Access via the Web-based administrative interface
  id: totrans-295
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过基于 Web 的管理界面进行访问
- en: SSH must be an available option so administrators can make configuration changes
    to the underlying operating system. Moreover, as we saw in [Chapter 3](ch03.html
    "Chapter 3. Creating Containers"), *Creating Containers* and [Chapter 4](ch04.html
    "Chapter 4. Creating Virtual Machines"), *Creating Virtual Machines*, we may choose
    to take care of a significant amount of Proxmox VE administrative tasks via the
    command line.
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 必须启用 SSH 选项，以便管理员能够对底层操作系统进行配置更改。此外，正如我们在[第 3 章](ch03.html "第 3 章. 创建容器")中所见，*创建容器*
    和[第 4 章](ch04.html "第 4 章. 创建虚拟机")，*创建虚拟机*，我们可能选择通过命令行处理大量的 Proxmox VE 管理任务。
- en: So SSH can't be disabled outright in the name of security. However, in the name
    of security assurance, we must fine-tune the configuration of SSH to mitigate
    threats, whether from disgruntled or sloppy colleagues or outside attacks.
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，不能仅凭安全理由禁用 SSH。然而，为了确保安全性，我们必须微调 SSH 的配置，以缓解潜在的威胁，无论是来自不满的或疏忽的同事，还是外部的攻击。
- en: 'Our objectives here are as follows:'
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的目标如下：
- en: Disabling direct root account access via SSH
  id: totrans-299
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 禁用直接通过 SSH 访问 root 账户
- en: Mitigating brute-force password attacks against SSH
  id: totrans-300
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 缓解针对 SSH 的暴力破解密码攻击
- en: Limiting access by IP
  id: totrans-301
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 限制按 IP 访问
- en: Using encrypted keys rather than passwords to authenticate over SSH
  id: totrans-302
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用加密密钥而非密码进行 SSH 身份验证
- en: Disabling root account access via SSH
  id: totrans-303
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 禁用 root 账户通过 SSH 登录
- en: This procedure is critical and absolutely necessary. First, let's create our
    own accounts with which to log in. We'll then use the new account to log in, escalate
    privileges using the `su -` command, and then follow a simple procedure to disable
    the root from logging in through SSH.
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: 这个过程至关重要且绝对必要。首先，我们需要创建自己的账户以用于登录。接着，我们将使用新账户登录，使用 `su -` 命令提升权限，然后按照简单的步骤禁用
    root 用户通过 SSH 登录。
- en: 'Once this procedure is complete, we''ll log in using the new account for the
    foreseeable future; to perform a procedure that requires root''s privileges, we''ll
    simply use the `su -` command to temporarily escalate the privileges of this user
    account, by following these steps:'
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦完成此过程，我们将在可预见的未来使用新账户登录；要执行需要 root 权限的操作时，我们只需使用 `su -` 命令临时提升该用户账户的权限，具体步骤如下：
- en: Choose a username and password you intend to use to administer Proxmox VE via
    SSH.
  id: totrans-306
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择一个用户名和密码，用于通过 SSH 管理 Proxmox VE。
- en: Via SSH, log in as the root using the credentials you created during the installation
    of Proxmox VE.
  id: totrans-307
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过 SSH，使用在安装 Proxmox VE 时创建的凭据以 root 用户身份登录。
- en: 'Use the adduser command, followed by the username you''ve chosen, to create
    a new account:'
  id: totrans-308
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 adduser 命令，后跟你选择的用户名，创建新账户：
- en: '[PRE8]'
  id: totrans-309
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Follow the prompts to create and confirm the new account's password.
  id: totrans-310
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照提示创建并确认新账户的密码。
- en: Enter the full name you'd like associated with the new account.
  id: totrans-311
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入你希望与新账户关联的全名。
- en: You may choose to ignore the remaining prompts for additional information, such
    as office number, address, and telephone number.
  id: totrans-312
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你可以选择忽略其余的提示信息，如办公室号码、地址和电话号码等。
- en: Press *Y* and *Enter* to confirm the creation of the new user.![Disabling root
    account access via SSH](img/image_07_013.png)
  id: totrans-313
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按 *Y* 然后按 *Enter* 键确认创建新用户。![通过 SSH 禁用 root 账户访问](img/image_07_013.png)
- en: Creating a new user within a command line prompt
  id: totrans-314
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在命令行提示符下创建新用户
- en: Use the `exit` command to close the SSH session.
  id: totrans-315
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `exit` 命令关闭 SSH 会话。
- en: 'Reconnect to Proxmox VE using the new account name:'
  id: totrans-316
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用新账户名重新连接到 Proxmox VE：
- en: '[PRE9]'
  id: totrans-317
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Use the `su -` command to escalate privileges and enter the root's password
    to continue.
  id: totrans-318
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `su -` 命令提升权限，并输入 root 密码以继续。
- en: 'Edit `/etc/ssh/sshd_config` using `nano`:'
  id: totrans-319
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `nano` 编辑 `/etc/ssh/sshd_config`：
- en: '[PRE10]'
  id: totrans-320
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Seek the following section using the arrow keys or the  **PageDown** key:'
  id: totrans-321
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用箭头键或 **PageDown** 键找到以下部分：
- en: '[PRE11]'
  id: totrans-322
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'In this file, the `#` symbol signifies that the line is a comment and is not
    to be considered as part of the SSH daemon''s configuration. Let''s remove the `#`
    symbol from the second line to enable the directive:'
  id: totrans-323
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在此文件中，`#` 符号表示该行是注释，不应视为 SSH 守护进程配置的一部分。让我们从第二行删除 `#` 符号以启用该指令：
- en: '[PRE12]'
  id: totrans-324
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Save and exit the revised configuration file:  *Ctrl* + *X*, *Y*, *Enter*.
  id: totrans-325
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存并退出修订后的配置文件： *Ctrl* + *X*，*Y*，*Enter*。
- en: 'We can restart the SSH daemon without it affecting our session:'
  id: totrans-326
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以在不影响会话的情况下重启 SSH 守护进程：
- en: '[PRE13]'
  id: totrans-327
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Now, let's test to ensure root can no longer log in. Start by entering `exit`
    to leave the `su` mode, and `exit` again to close SSH.
  id: totrans-328
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，进行测试，确保 root 用户无法再登录。首先输入 `exit` 退出 `su` 模式，再次输入 `exit` 关闭 SSH。
- en: 'Start a new SSH session as the root:'
  id: totrans-329
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以 root 用户身份启动新的 SSH 会话：
- en: '[PRE14]'
  id: totrans-330
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Access should be denied, without the opportunity to enter a password.
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: 访问应被拒绝，且没有输入密码的机会。
- en: Preventing brute-force attacks against SSH
  id: totrans-332
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 防止针对 SSH 的暴力破解攻击
- en: As long as SSH daemon is configured to use password authentication, it's vulnerable
    to brute-force password attacks. One mitigation strategy is to install and configure
    Fail2ban, a powerful tool designed to detect attacks on a service and ban the
    offending IP address from which the attacks originate for a predefined period.
    Fail2ban effectively increases the cost in resources and the time attackers have
    to invest to continue a brute force password attack.
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
  zh: 只要 SSH 守护进程配置为使用密码认证，它就容易受到暴力破解密码攻击。一种缓解策略是安装并配置 Fail2ban，这是一个强大的工具，旨在检测服务上的攻击，并将攻击来源的
    IP 地址在预定义的时间段内禁止访问。Fail2ban 有效地提高了攻击者进行暴力破解攻击所需的资源和时间成本。
- en: 'To make use of Fail2ban, follow this procedure:'
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
  zh: 若要使用 Fail2ban，请按以下步骤操作：
- en: Login via SSH and your new user account.
  id: totrans-335
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过 SSH 和新用户账户登录。
- en: 'Escalate privileges:'
  id: totrans-336
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提升权限：
- en: '[PRE15]'
  id: totrans-337
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Install Fail2ban:'
  id: totrans-338
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装 Fail2ban：
- en: '[PRE16]'
  id: totrans-339
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Copy the default configuration called `jail.conf` to a new file called `jail.local`:'
  id: totrans-340
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将默认配置文件 `jail.conf` 复制到新文件 `jail.local`：
- en: '[PRE17]'
  id: totrans-341
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Open the new file in an editor such as `nano`:'
  id: totrans-342
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用编辑器（如 `nano`）打开新文件：
- en: '[PRE18]'
  id: totrans-343
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Cofirm Fail2ban''s configuration for SSH in the following stanza:'
  id: totrans-344
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在以下节中确认 Fail2ban 的 SSH 配置：
- en: '[PRE19]'
  id: totrans-345
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Save the file and exit `nano` with  *Ctrl* + *X*, *Y*,  *Enter*.
  id: totrans-346
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存文件并使用 *Ctrl* + *X*，*Y*，*Enter* 退出 `nano`。
- en: 'If any changes were necessary, restart Fail2ban:'
  id: totrans-347
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果需要任何更改，请重启 Fail2ban：
- en: '[PRE20]'
  id: totrans-348
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: Note
  id: totrans-349
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Fail2ban can also be configured to protect PVE's web-based administration interface
    from brute-force attacks.
  id: totrans-350
  prefs: []
  type: TYPE_NORMAL
  zh: Fail2ban 还可以配置为保护 PVE 的基于 Web 的管理界面免受暴力破解攻击。
- en: 'First, add the following to `/etc/fail2ban/jail.local`:'
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，将以下内容添加到 `/etc/fail2ban/jail.local`：
- en: '[PRE21]'
  id: totrans-352
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: Note
  id: totrans-353
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Then, create the filter by entering `nano /etc/fail2ban/filter.d/proxmox.conf`
    at the command line.
  id: totrans-354
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，输入命令 `nano /etc/fail2ban/filter.d/proxmox.conf` 来创建过滤器。
- en: 'Enter the following lines:'
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
  zh: 输入以下内容：
- en: '[PRE22]'
  id: totrans-356
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: Note
  id: totrans-357
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'Save the file and exit `nano` with  *Ctrl* +*X*, *Y*, *Enter*. *Restart* Fail2ban
    to activate the new configuration:'
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
  zh: 保存文件并使用 *Ctrl* + *X*，*Y*，*Enter* 退出 `nano`。*重启* Fail2ban 以激活新配置：
- en: '[PRE23]'
  id: totrans-359
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: Note
  id: totrans-360
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'With Fail2ban configured as described previously, failure to authenticate successfully
    three times in a row in the web interface will prohibit the client from connecting
    again for a full hour:'
  id: totrans-361
  prefs: []
  type: TYPE_NORMAL
  zh: 按照之前描述的 Fail2ban 配置，如果在 Web 界面中连续三次验证失败，客户端将被禁止连接一小时：
- en: '![Preventing brute-force attacks against SSH](img/B01784_07_15.png)'
  id: totrans-362
  prefs: []
  type: TYPE_IMG
  zh: '![防止针对 SSH 的暴力破解攻击](img/B01784_07_15.png)'
- en: After three unsuccessful attempts to log in to the PVE web interface
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
  zh: 在尝试三次登录 PVE Web 界面失败后
- en: Tip
  id: totrans-364
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: '**More on Fail2ban**'
  id: totrans-365
  prefs: []
  type: TYPE_NORMAL
  zh: '**更多关于 Fail2ban 的信息**'
- en: To learn more about Fail2ban and how it works, visit [http://www.fail2ban.org/wiki/index.php/Main_Page](http://www.fail2ban.org/wiki/index.php/Main_Page).
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解更多有关 Fail2ban 及其工作原理的信息，请访问 [http://www.fail2ban.org/wiki/index.php/Main_Page](http://www.fail2ban.org/wiki/index.php/Main_Page)。
- en: To learn more about Fail2ban and Proxmox VE, visit the Proxmox Wiki at [https://pve.proxmox.com/wiki/Fail2ban](https://pve.proxmox.com/wiki/Fail2ban).
  id: totrans-367
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解更多有关 Fail2ban 和 Proxmox VE的信息，请访问 Proxmox Wiki：[https://pve.proxmox.com/wiki/Fail2ban](https://pve.proxmox.com/wiki/Fail2ban)。
- en: Relying on key-based authentication
  id: totrans-368
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 依赖基于密钥的认证
- en: Another way to secure SSH access to a Proxmox VE server is to rely on key-based
    authentication instead of password authentication. The advantage to this authentication
    method is that you can disable password authentication altogether and not have
    to worry about the strength of legitimate users' passwords. Another benefit is
    that you can use the same key to authenticate to any number of SSH servers.
  id: totrans-369
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种保护Proxmox VE服务器SSH访问的方法是依赖于基于密钥的身份验证，而非密码认证。这种身份验证方法的优点在于你可以完全禁用密码认证，避免担心合法用户密码的强度。另一个好处是，你可以使用相同的密钥来对任何数量的SSH服务器进行身份验证。
- en: To make use of this feature, we'll start by generating an SSH key pair. Once
    you have a public and private key that can be used to authenticate, we'll place
    the public key on the PVE host so that we can use SSH key authentication to log
    in. Once these two procedures are complete, you'll check to see whether you can
    log in to your PVE host.
  id: totrans-370
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使用此功能，我们将首先生成一对SSH密钥。一旦你拥有了可以用来进行身份验证的公钥和私钥，我们将把公钥放置到PVE主机上，以便使用SSH密钥认证进行登录。一旦完成这两个步骤，你将检查是否能够登录到PVE主机。
- en: Tip
  id: totrans-371
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: In the examples that follow, `rgoldman` is used as a placeholder for the username,
    while 192.168.1.200 is used as a placeholder for PVE's IP address. Please replace
    each as appropriate.
  id: totrans-372
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的示例中，`rgoldman`作为用户名的占位符，而`192.168.1.200`作为PVE的IP地址占位符。请根据实际情况替换它们。
- en: 'On a workstation on the same LAN as the PVE host, generate an SSH key pair:'
  id: totrans-373
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在与PVE主机处于同一局域网的工作站上，生成一对SSH密钥：
- en: '[PRE24]'
  id: totrans-374
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'Confirm the key location at the first prompt by pressing  **Enter**:'
  id: totrans-375
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在第一个提示中，按**Enter**确认密钥位置：
- en: '[PRE25]'
  id: totrans-376
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'At the next prompts, you may choose to create and confirm an optional passphrase;
    using a passphrase will prevent an attacker from accessing the PVE host from your
    workstation. On the other hand, you''ll have to enter the passphrase every time
    you wish to authenticate with the key:'
  id: totrans-377
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在接下来的提示中，你可以选择创建并确认一个可选的密码短语；使用密码短语将防止攻击者从你的工作站访问PVE主机。另一方面，每次你希望使用密钥进行身份验证时，都需要输入密码短语：
- en: '[PRE26]'
  id: totrans-378
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Look for confirmation that the key has been created—you should see an output
    to the terminal similar to the following:'
  id: totrans-379
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 查看是否有确认信息显示密钥已创建，你应该会看到类似以下的终端输出：
- en: '[PRE27]'
  id: totrans-380
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: An output similar to the preceding example confirms that you have a public and
    private key that you can use to authenticate.
  id: totrans-381
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 类似于前面示例的输出确认了你已经拥有公钥和私钥，可以用来进行身份验证。
- en: Next, let's place the public key on the PVE host so that you can use the SSH
    key authentication to login.
  id: totrans-382
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 接下来，让我们将公钥放置到PVE主机上，这样你就可以使用SSH密钥认证登录。
- en: 'Confirm the presence of the keys by listing the contents of `~/.ssh/`; ensure
    that both `id_rsa` and `id_rsa.pub` are present in the results:'
  id: totrans-383
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过列出`~/.ssh/`的内容来确认密钥是否存在；确保`id_rsa`和`id_rsa.pub`都出现在结果中：
- en: '[PRE28]'
  id: totrans-384
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'Next, push the new public key to the PVE host using the `ssh-copy-id` tool
    with the following syntax (assuming the username is `rgoldman` and the PVE host
    is at `192.168.1.200`):'
  id: totrans-385
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用`ssh-copy-id`工具将新的公钥推送到PVE主机，语法如下（假设用户名为`rgoldman`，PVE主机的IP地址为`192.168.1.200`）：
- en: '[PRE29]'
  id: totrans-386
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'That''s it. Now confirm you can login without a password:'
  id: totrans-387
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 就这样。现在确认你能在没有密码的情况下登录：
- en: '[PRE30]'
  id: totrans-388
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE30]'
- en: If you were able to login to your PVE account using SSH without a password,
    you have successfully configured SSH key-based authentication for your account.
  id: totrans-389
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你能够在不输入密码的情况下通过SSH登录到PVE帐户，那么你已经成功为你的帐户配置了基于SSH密钥的身份验证。
- en: 'The image that follows illustrates the transaction:'
  id: totrans-390
  prefs: []
  type: TYPE_NORMAL
  zh: 以下的图片展示了该交易过程：
- en: '![Relying on key-based authentication](img/B01784_07_16-3.png)'
  id: totrans-391
  prefs: []
  type: TYPE_IMG
  zh: '![依赖于基于密钥的身份验证](img/B01784_07_16-3.png)'
- en: SSH key authentication
  id: totrans-392
  prefs: []
  type: TYPE_NORMAL
  zh: SSH密钥认证
- en: Note, however, that your password-based authentication mechanism is still active;
    the SSH server is still exposed to brute-force or social engineering attacks.
  id: totrans-393
  prefs: []
  type: TYPE_NORMAL
  zh: 但请注意，你的基于密码的身份验证机制仍然处于活动状态；SSH服务器仍然暴露在暴力破解或社交工程攻击下。
- en: 'The following steps will disable password-based authentication on your server.
    Certainly, don''t proceed here if you plan to access PVE from other hosts but
    haven''t copied the key yet (or if you are not yet confident with key-based authentication):'
  id: totrans-394
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤将禁用服务器上的基于密码的身份验证。如果你计划从其他主机访问PVE，但尚未复制密钥（或者你还不确定基于密钥的身份验证是否有效），那么请勿继续此步骤：
- en: Using SSH, log in to the PVE host from a local workstation.
  id: totrans-395
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用SSH从本地工作站登录到PVE主机。
- en: 'Escalate privileges:'
  id: totrans-396
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提升权限：
- en: '[PRE31]'
  id: totrans-397
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'Open the SSH daemon configuration using `nano` or another plaintext editor:'
  id: totrans-398
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`nano`或其他纯文本编辑器打开SSH守护进程配置文件：
- en: '[PRE32]'
  id: totrans-399
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'Browse the contents of the file for the following directive:'
  id: totrans-400
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 浏览文件内容，查找以下指令：
- en: '[PRE33]'
  id: totrans-401
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'Change the directive so it is as follows:'
  id: totrans-402
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将指令更改为如下所示：
- en: '[PRE34]'
  id: totrans-403
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE34]'
- en: Save the file and close the editor with  *Ctrl* + *X*, *Y* , *Enter*.
  id: totrans-404
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 *Ctrl* + *X*，*Y*，*Enter* 保存文件并关闭编辑器。
- en: 'Restart the SSH daemon:'
  id: totrans-405
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重启SSH守护进程：
- en: '[PRE35]'
  id: totrans-406
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE35]'
- en: We can now access Proxmox VE via SSH without worrying about the strength of
    our passwords or being vulnerable to brute force attacks or social engineering
    attacks.
  id: totrans-407
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以通过SSH访问Proxmox VE，而无需担心密码强度或受到暴力破解攻击或社会工程学攻击的风险。
- en: Note, however, it's imperative when we rely on key-based authentication that
    we keep our keys absolutely secure. This means, in part, remembering consistently
    to lock our workstations and protect our workstation accounts with strong passwords.
  id: totrans-408
  prefs: []
  type: TYPE_NORMAL
  zh: 然而需要注意的是，当我们依赖基于密钥的认证时，确保密钥的安全至关重要。这意味着，我们需要始终记得锁定工作站，并用强密码保护我们的工作站账户。
- en: Tip
  id: totrans-409
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: '**Learn more about SSH**'
  id: totrans-410
  prefs: []
  type: TYPE_NORMAL
  zh: '**了解更多关于SSH的信息**'
- en: 'To learn more about SSH and authentication, consider visiting the following
    resources:'
  id: totrans-411
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解更多关于SSH和认证的信息，可以访问以下资源：
- en: '[https://www.debian-administration.org/article/530/SSH_with_authentication_key_instead_of_password](https://www.debian-administration.org/article/530/SSH_with_authentication_key_instead_of_password)'
  id: totrans-412
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://www.debian-administration.org/article/530/SSH_with_authentication_key_instead_of_password](https://www.debian-administration.org/article/530/SSH_with_authentication_key_instead_of_password)'
- en: '[https://www.digitalocean.com/community/tutorials/how-to-configure-ssh-key-based-authentication-on-a-linux-server](https://www.digitalocean.com/community/tutorials/how-to-configure-ssh-key-based-authentication-on-a-linux-server)'
  id: totrans-413
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://www.digitalocean.com/community/tutorials/how-to-configure-ssh-key-based-authentication-on-a-linux-server](https://www.digitalocean.com/community/tutorials/how-to-configure-ssh-key-based-authentication-on-a-linux-server)'
- en: '[https://debian-handbook.info/browse/stable/sect.remote-login.html](https://debian-handbook.info/browse/stable/sect.remote-login.html)'
  id: totrans-414
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://debian-handbook.info/browse/stable/sect.remote-login.html](https://debian-handbook.info/browse/stable/sect.remote-login.html)'
- en: For additional hardening strategies for SSH, visit [http://howto.biapy.com/en/debian-gnu-linux/system/security/harden-the-ssh-access-security-on-debian](http://howto.biapy.com/en/debian-gnu-linux/system/security/harden-the-ssh-access-security-on-debian).
  id: totrans-415
  prefs: []
  type: TYPE_NORMAL
  zh: 若要了解更多关于SSH的强化策略，请访问 [http://howto.biapy.com/en/debian-gnu-linux/system/security/harden-the-ssh-access-security-on-debian](http://howto.biapy.com/en/debian-gnu-linux/system/security/harden-the-ssh-access-security-on-debian)。
- en: Managing patches
  id: totrans-416
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 管理补丁
- en: As we discovered, the patch for the VENOM exploit was available for Debian the
    same day the exploit was made public; PVE administrators simply had to update
    and upgrade and restart PVE guests to eliminate the threat. This should drive
    home the importance of applying security patches not only for the Proxmox VE host,
    but also for its guests, whether they are containers or virtual machines.
  id: totrans-417
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们所发现的，针对VENOM漏洞的补丁在漏洞公开的同一天就已提供给Debian；PVE管理员只需要更新和升级并重启PVE来宾，就能消除这一威胁。这应当让我们更加重视为Proxmox
    VE主机及其来宾（无论是容器还是虚拟机）应用安全补丁的重要性。
- en: However, routinely applying patches for several machines is tedious no matter
    the assurance it provides.
  id: totrans-418
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，无论它提供多少保障，定期为多台机器应用补丁仍然是件繁琐的事情。
- en: For the PVE hosts and Ubuntu or Debian guests, there are several tools to relieve
    the tedium. Finding the sweet spot between fully automated upgrades with minimal
    interactivity and doing due diligence to ensure patch candidates won't disrupt
    operations is where the magic happens.
  id: totrans-419
  prefs: []
  type: TYPE_NORMAL
  zh: 对于PVE主机和Ubuntu或Debian来宾，有几种工具可以减轻单调的工作。找到全自动升级与最小交互之间的最佳平衡，同时确保补丁不会干扰操作，是其中的关键所在。
- en: In this section, we'll configure a tool called **unattended-upgrades** to routinely
    apply only security upgrades. We'll leave other patches to our best judgement.
  id: totrans-420
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将配置一个名为**unattended-upgrades**的工具，定期只应用安全升级。其他补丁则留给我们凭借最佳判断来处理。
- en: 'Use the APT tool to install unattended-upgrades:'
  id: totrans-421
  prefs: []
  type: TYPE_NORMAL
  zh: 使用APT工具安装unattended-upgrades：
- en: '[PRE36]'
  id: totrans-422
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'Then, configure the automated security upgrades:'
  id: totrans-423
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，配置自动化的安全升级：
- en: 'The default configuration file for the unattended-upgrades package is at `/etc/apt/apt.conf.d/50unattended-upgrades`;
    let''s take a look at it:'
  id: totrans-424
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: unattended-upgrades软件包的默认配置文件位于`/etc/apt/apt.conf.d/50unattended-upgrades`；我们来看看它：
- en: '[PRE37]'
  id: totrans-425
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'Look for the following stanza (the `//` characters preceding some lines effectively
    comment out directives so they are ignored):'
  id: totrans-426
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 查找以下配置段落（`//`符号前置于某些行前，这样会将指令注释掉，忽略这些指令）：
- en: '[PRE38]'
  id: totrans-427
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE38]'
- en: Ensure that the line with "`${distro_id}:${distro_codename}-security`"; is not
    commented out. This directive signals the utility to allow unattended-upgrades
    from security repositories, and only from security repositories.
  id: totrans-428
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保包含 "`${distro_id}:${distro_codename}-security`"; 的行没有被注释掉。此指令指示该工具允许从安全仓库进行
    unattended-upgrades，仅限于安全仓库。
- en: Exit the configuration file by pressing  *Ctrl* +  *X* ,  *Y* , and  *Enter*
    to preserve any changes you may have made.
  id: totrans-429
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过按下 *Ctrl* + *X*、*Y* 和 *Enter* 键退出配置文件，以保存你所做的任何更改。
- en: 'Next, let''s check the configuration of `/etc/apt/apt.conf.d/20auto-upgrade`
    to ensure that Debian is configured to periodically update package lists and that
    unattended-upgrades are enabled:'
  id: totrans-430
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，让我们检查 ` /etc/apt/apt.conf.d/20auto-upgrade` 的配置，以确保 Debian 配置为定期更新包列表，并启用了
    unattended-upgrades：
- en: '[PRE39]'
  id: totrans-431
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'Ensure that the following lines appear in the file as they do here:'
  id: totrans-432
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保文件中出现以下几行，和这里一样：
- en: '[PRE40]'
  id: totrans-433
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE40]'
- en: With unattended-upgrades configured, de-escalate privileges by entering `exit`
    in the terminal.
  id: totrans-434
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置了 unattended-upgrades 后，通过在终端输入 `exit` 来降低权限。
- en: Tip
  id: totrans-435
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: Changes made by the unattended-upgrades utility are logged in `/var/log/unattended-upgrades/unattended-upgrades.log`.
  id: totrans-436
  prefs: []
  type: TYPE_NORMAL
  zh: unattended-upgrades 工具所做的更改会记录在 `/var/log/unattended-upgrades/unattended-upgrades.log`
    中。
- en: The same package can be used to automate security patch applications for Proxmox
    VE guests running Ubuntu, Debian, or LinuxMint.
  id: totrans-437
  prefs: []
  type: TYPE_NORMAL
  zh: 相同的包可以用于自动化为运行 Ubuntu、Debian 或 LinuxMint 的 Proxmox VE 客户机应用安全补丁。
- en: Tip
  id: totrans-438
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: To learn more about the unattended-upgrades package, see the following documentation:[https://wiki.debian.org/UnattendedUpgrades](https://wiki.debian.org/UnattendedUpgrades)
  id: totrans-439
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解更多关于 unattended-upgrades 包的信息，请参阅以下文档：[https://wiki.debian.org/UnattendedUpgrades](https://wiki.debian.org/UnattendedUpgrades)
- en: '[https://debian-handbook.info/browse/stable/sect.regular-upgrades.html](https://debian-handbook.info/browse/stable/sect.regular-upgrades.html)'
  id: totrans-440
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://debian-handbook.info/browse/stable/sect.regular-upgrades.html](https://debian-handbook.info/browse/stable/sect.regular-upgrades.html)'
- en: Enterprise subscriptions
  id: totrans-441
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 企业订阅
- en: 'Though PVE may be open source, Proxmox Server Solutions (the company behind
    Proxmox VE) very strongly encourages users to invest in subscriptions for Proxmox
    VE ([https://www.proxmox.com/en/proxmox-ve/support](https://www.proxmox.com/en/proxmox-ve/support)):'
  id: totrans-442
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然 PVE 可能是开源的，但 Proxmox Server Solutions（Proxmox VE 背后的公司）强烈鼓励用户为 Proxmox VE
    购买订阅（[https://www.proxmox.com/en/proxmox-ve/support](https://www.proxmox.com/en/proxmox-ve/support)）：
- en: '*"A Proxmox VE subscription is the easy and affordable solution to get access
    to the Proxmox VE Enterprise repository, to stable software updates and security
    enhancements, as well as to technical support services. A subscription helps you
    to run Proxmox VE with confidence in your company."*'
  id: totrans-443
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '*"Proxmox VE 订阅是一个简单且实惠的解决方案，可让你访问 Proxmox VE 企业仓库，获得稳定的软件更新和安全增强功能，以及技术支持服务。订阅帮助你在公司内自信地运行
    Proxmox VE。"*'
- en: '*"By combining great open source software with quality-assured services and
    support the Proxmox VE Subscription helps you to deploy and maintain the best
    stable and secure open source virtualization environment"*'
  id: totrans-444
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '*"通过将优秀的开源软件与经过质量保证的服务和支持相结合，Proxmox VE 订阅帮助你部署和维护最稳定、安全的开源虚拟化环境。"*'
- en: 'Security wise, there is a strong advantage to obtaining a subscription: Proxmox
    Server Solutions provides subscribers with access to the enterprise repository,
    which provides stable and "enhanced" security updates.'
  id: totrans-445
  prefs: []
  type: TYPE_NORMAL
  zh: 从安全角度来看，获得订阅具有很大的优势：Proxmox Server Solutions 为订阅者提供企业仓库的访问权限，企业仓库提供稳定的“增强版”安全更新。
- en: In contrast, users of the `pve-no-subscription` repositories have access to
    patches that are perhaps more cutting-edge, but also less stable.
  id: totrans-446
  prefs: []
  type: TYPE_NORMAL
  zh: 相反，使用 `pve-no-subscription` 仓库的用户可以访问更前沿的补丁，但也可能不太稳定。
- en: Tip
  id: totrans-447
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: Another benefit of a Proxmox subscription is access to dedicated, professional
    support. This is far from a commentary on community support, which has in all
    cases been fantastic in my experience. However, subscription support will track
    a ticket and promise prompt solutions. In a production environment, this can certainly
    make a critical difference.
  id: totrans-448
  prefs: []
  type: TYPE_NORMAL
  zh: Proxmox 订阅的另一个好处是可以获得专门的、专业的支持。这并不是在评论社区支持，在我的经验中，社区支持一直非常出色。然而，订阅支持会跟踪工单并承诺提供迅速的解决方案。在生产环境中，这无疑会产生至关重要的影响。
- en: 'There are four subscription plans available: premium, standard, basic, and
    community (this last plan does not offer a support plan, but it does offer access
    to the enterprise repository). Plans are priced per month per CPU socket ([https://www.proxmox.com/en/proxmox-ve/pricing](https://www.proxmox.com/en/proxmox-ve/pricing)).'
  id: totrans-449
  prefs: []
  type: TYPE_NORMAL
  zh: 提供四种订阅计划：高级版、标准版、基础版和社区版（最后一种计划不提供支持服务，但可以访问企业仓库）。各计划按 CPU 插槽每月收费 ([https://www.proxmox.com/en/proxmox-ve/pricing](https://www.proxmox.com/en/proxmox-ve/pricing))。
- en: '*"Subscriptions are licensed per physical server and CPU socket. In a Proxmox
    VE Cluster, you need to have the same subscription level for all your servers.
    Subscription period is one year from purchase date."*'
  id: totrans-450
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '*“订阅按物理服务器和 CPU 插槽授权。在 Proxmox VE 集群中，所有服务器需要具有相同的订阅级别。订阅期为购买日起的一年。”*'
- en: Technical support is provided to subscribers via a web and email-based customer
    portal (in English or German).
  id: totrans-451
  prefs: []
  type: TYPE_NORMAL
  zh: 技术支持通过基于网络和电子邮件的客户门户提供给订阅用户（支持英语或德语）。
- en: Community support, by contrast, is available via the public support forum ([https://forum.proxmox.com](https://forum.proxmox.com))
    or via IRC (the `##proxmox` channel on the Freenode network).
  id: totrans-452
  prefs: []
  type: TYPE_NORMAL
  zh: 相比之下，社区支持可以通过公共支持论坛 ([https://forum.proxmox.com](https://forum.proxmox.com))
    或通过 IRC（Freenode 网络上的 `##proxmox` 频道）获得。
- en: '![Enterprise subscriptions](img/image_07_016.png)'
  id: totrans-453
  prefs: []
  type: TYPE_IMG
  zh: '![企业订阅](img/image_07_016.png)'
- en: Proxmox community support forum
  id: totrans-454
  prefs: []
  type: TYPE_NORMAL
  zh: Proxmox 社区支持论坛
- en: A video tutorial is available to guide subscribers in uploading a subscription
    key to Proxmox VE and installing new updates at [https://www.proxmox.com/en/training/video-tutorials/item/install-updates](https://www.proxmox.com/en/training/video-tutorials/item/install-updates).
  id: totrans-455
  prefs: []
  type: TYPE_NORMAL
  zh: 提供了一段视频教程，指导订阅用户上传订阅密钥到 Proxmox VE 并安装新更新，网址为 [https://www.proxmox.com/en/training/video-tutorials/item/install-updates](https://www.proxmox.com/en/training/video-tutorials/item/install-updates)。
- en: From a security perspective then, the `pve-no-subscription` repository is characterized
    on the site as offering patches that are not quite stable enough for production,
    while the enterprise repository promises enhanced security patches. You'll have
    to make a deliberate choice for your use case.
  id: totrans-456
  prefs: []
  type: TYPE_NORMAL
  zh: 从安全角度来看，`pve-no-subscription` 仓库在网站上被描述为提供的补丁不够稳定，不适合生产环境，而企业仓库承诺提供增强的安全补丁。你需要为你的使用案例做出有意识的选择。
- en: If you're moving services that are not mission-critical to a virtual infrastructure
    with Proxmox VE, perhaps community support and the `pve-no-subscription` options
    will work well for you. Otherwise, give all due consideration to an appropriate
    subscription option.
  id: totrans-457
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你将非关键业务服务迁移到 Proxmox VE 虚拟基础架构中，或许社区支持和 `pve-no-subscription` 选项对你来说就足够了。否则，请充分考虑合适的订阅选项。
- en: Summary
  id: totrans-458
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: The security and information that assurance administrators can realistically
    provide is clearly never as exhaustive as it is exhausting.
  id: totrans-459
  prefs: []
  type: TYPE_NORMAL
  zh: 保证管理员可以提供的安全性和信息显然永远不如它所消耗的精力那样全面。
- en: In the first section of this chapter, you learned that hardware virtualization
    has inherent security benefits.
  id: totrans-460
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章的第一部分，你了解了硬件虚拟化具有固有的安全优势。
- en: However, you also learned that many promising benefits are undermined if they're
    not supported by thorough planning of the virtual infrastructure, explicit policy-making
    up front, and a flawless deployment, all followed by unflagging policy enforcement
    and ongoing virtual server lifecycle management.
  id: totrans-461
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，你也了解到，如果没有充分规划虚拟基础架构、事先明确的政策制定、无懈可击的部署，并且随后的政策执行和持续的虚拟服务器生命周期管理，许多有前景的好处将会被削弱。
- en: We then outlined threats that are either unique to virtualized infrastructures
    or aggravated in the context of virtualization. Each point was followed by either
    concrete action to mitigate the threat or links to resources for more details
    on addressing a potential problem.
  id: totrans-462
  prefs: []
  type: TYPE_NORMAL
  zh: 接着我们概述了那些对虚拟化基础架构独有的，或在虚拟化环境中被加剧的威胁。每个要点后面都跟着具体的应对措施或更多资源的链接，帮助你解决潜在问题。
- en: We concluded with concrete, step-by-step remedies that could be initiated immediately,
    even as you continue to explore and assess Proxmox VE.
  id: totrans-463
  prefs: []
  type: TYPE_NORMAL
  zh: 我们以具体的逐步措施总结，提出可以立即执行的补救方案，即使你继续探索和评估 Proxmox VE。
